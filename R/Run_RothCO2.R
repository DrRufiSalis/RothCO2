#' Run the RothC Model and quantify C and CO2 fluxes
#'
#' The Run_RothCO2 function is the main function of the Package. It buils up on the RothC-related functions from the package SoilR (Sierra and Mueller 2022) to create six different folder with the following information:
#' (1) VXC_Models: considers a continuous input of C each year (1tC/year)
#' (2) VXP_Models: considers a one-off input of C in the first year (1tC/fist-year)
#' (3) CTailsP: yearly C tails (considering a one-off input of 1tC in the first year) - i.e. what remains on the soil
#' (4) CO2Emissions_P_NoDelay: yearly CO2 emissions (considering a one-off input of 1tC in the first year)
#' (5) CO2Emissions_P_Delay: yearly CO2 emissions considering a GWP100 with delay (considering a one-off input of 1tC in the first year)
#' (6) CEmissions_P: yearly C emissions considering a GWP100 with delay (considering a one-off input of 1tC in the first year)
#'
#' Besides defining values for some parameters for the RothC Model (Simulation Lenght, Tillage Rate Modifiers, Soil Thickness, etc.), the user can select among 6 different model combinations (parameter "Scope") to calculate the information described above:
#' (1) Litter, Conventional Tillage, 0-100% (+10%) Clay
#' (2) Litter, Reduced Tillage, 0-100% (+10%) Clay
#' (3) Litter, No Tillage, 0-100% (+10%) Clay
#' (4) Manure, Conventional Tillage, 0-100% (+10%) Clay
#' (5) Manure, Reduced Tillage, 0-100% (+10%) Clay
#' (6) Manure, No Tillage, 0-100% (+10%) Clay
#'
#' If the user set Scope = "All", all following files will be created, sorted in their respective folders (VXC_Models, VXP_Models, CTailsP, CO2Emissions_P_NoDelay, CO2Emissions_P_Delay):
#'
#' Model Combinations - Litter, Conventional Tillage, 0-100% (10%) Clay
#' VLC0) Litter; 0%clay; Conventional tillage
#' VLC1) Litter; 10%clay; Conventional tillage
#' VLC2) Litter; 20%clay; Conventional tillage
#' VLC3) Litter; 30%clay; Conventional tillage
#' VLC4) Litter; 40%clay; Conventional tillage
#' VLC5) Litter; 50%clay; Conventional tillage
#' VLC6) Litter; 60%clay; Conventional tillage
#' VLC7) Litter; 70%clay; Conventional tillage
#' VLC8) Litter; 80%clay; Conventional tillage
#' VLC9) Litter; 90%clay; Conventional tillage
#' VLC10) Litter; 100%clay; Conventional tillage

#' Model Combinations - Litter; Reduced Tillage, 0-100% (+10%) Clay
#' VLR0) Litter; 0%clay; Reduced tillage
#' VLR1) Litter; 10%clay; Reduced tillage
#' VLR2) Litter; 20%clay; Reduced tillage
#' VLR3) Litter; 30%clay; Reduced tillage
#' VLR4) Litter; 40%clay; Reduced tillage
#' VLR5) Litter; 50%clay; Reduced tillage
#' VLR6) Litter; 60%clay; Reduced tillage
#' VLR7) Litter; 70%clay; Reduced tillage
#' VLR8) Litter; 80%clay; Reduced tillage
#' VLR9) Litter; 90%clay; Reduced tillage
#' VLR10) Litter; 100%clay; Reduced tillage

#' Model Combinations - Litter; No Tillage, 0-100% (+10%) Clay
#' VLN0) Litter; 0%clay; No tillage
#' VLN1) Litter; 10%clay; No Tillage
#' VLN2) Litter; 20%clay; No Tillage
#' VLN3) Litter; 30%clay; No Tillage
#' VLN4) Litter; 40%clay; No Tillage
#' VLN5) Litter; 50%clay; No Tillage
#' VLN6) Litter; 60%clay; No Tillage
#' VLN7) Litter; 70%clay; No Tillage
#' VLN8) Litter; 80%clay; No Tillage
#' VLN9) Litter; 90%clay; No Tillage
#' VLN10) Litter; 100%clay; No Tillage

#' Model Combinations - Manure; Conventional Tillage, 0-100% (+10%) Clay
#' VMC0) Manure; 0%clay; Conventional tillage
#' VMC1) Manure; 10%clay; Conventional tillage
#' VMC2) Manure; 20%clay; Conventional tillage
#' VMC3) Manure; 30%clay; Conventional tillage
#' VMC4) Manure; 40%clay; Conventional tillage
#' VMC5) Manure; 50%clay; Conventional tillage
#' VMC6) Manure; 60%clay; Conventional tillage
#' VMC7) Manure; 70%clay; Conventional tillage
#' VMC8) Manure; 80%clay; Conventional tillage
#' VMC9) Manure; 90%clay; Conventional tillage
#' VMC10) Manure; 100%clay; Conventional tillage

#' Model Combinations - Manure; Reduced Tillage, 0-100% (+10%) Clay
#' VMR0) Manure; 0%clay; Reduced tillage
#' VMR1) Manure; 10%clay; Reduced tillage
#' VMR2) Manure; 20%clay; Reduced tillage
#' VMR3) Manure; 30%clay; Reduced tillage
#' VMR4) Manure; 40%clay; Reduced tillage
#' VMR5) Manure; 50%clay; Reduced tillage
#' VMR6) Manure; 60%clay; Reduced tillage
#' VMR7) Manure; 70%clay; Reduced tillage
#' VMR8) Manure; 80%clay; Reduced tillage
#' VMR9) Manure; 90%clay; Reduced tillage
#' VMR10) Manure; 100%clay; Reduced tillage

#' Model Combinations - Manure; No Tillage, 0-100% (+10%) Clay
#' VMN0) Manure; 0%clay; No tillage
#' VMN1) Manure; 10%clay; No Tillage
#' VMN2) Manure; 20%clay; No Tillage
#' VMN3) Manure; 30%clay; No Tillage
#' VMN4) Manure; 40%clay; No Tillage
#' VMN5) Manure; 50%clay; No Tillage
#' VMN6) Manure; 60%clay; No Tillage
#' VMN7) Manure; 70%clay; No Tillage
#' VMN8) Manure; 80%clay; No Tillage
#' VMN9) Manure; 90%clay; No Tillage
#' VMN10) Manure; 100%clay; No Tillage
#'
#' To merge the models by folder, refer to function Merge_Models() from this package.
#'
#' Relevant sources:
#' (1) Falloon, P., Smith, P., Coleman, K., and Marshall, S. (1998). Estimating the size of the inert organic matter pool from total soil organic carbon content for use in the Rothamsted carbon model. Soil Biology and Biochemistry, 30:1207-1211.
#' (2) Sierra, C.A., Mueller, M., and Trumbore, S.E. (2012). Models of soil organic matter decomposition: the SoilR package, version 1.0. Geosci. Model Dev., 5:1045-1060.
#' (3) Sierra, C.A., and Mueller, M. (2015). A general mathematical framework for representing soil organic matter dynamics. Ecological Monographs, 85:505-524.
#' (4) Weihermueller, L., Graf, A., Herbst, M., and Vereecken, H. (2013). Simple pedotransfer functions to initialize reactive carbon pools of the RothC model. European Journal of Soil Science, 64:567-575.
#' (5) Zimmermann, M., Leifeld, J., Schmidt, M.W.I., Smith, P., and Fuhrer, J. (2007). Measured soil organic matter fractions can be related to pools in the RothC model. European Journal of Soil Science, 58:658-667.
#' (6) Sierra, C.A. and Mueller, M. (2012). Package 'SoilR', version 1.2.105. Date: 2022-1-21. Documentation available here: https://cran.r-project.org/web/packages/SoilR/SoilR.pdf
#' (7) Sierra, C.A. (2015). Run the RothC model for a site. Date: 2015-11-19. Available here: https://www.bgc-jena.mpg.de/TEE/basics/2015/11/19/RothC/
#' (8) Jordon, M. W., & Smith, P. (2022). Modelling soil carbon stocks following reduced tillage intensity: A framework to estimate decomposition rate constant modifiers for RothC-26.3, demonstrated in north-west Europe. Soil and Tillage Research, 222, 105428.
#'
#' @param Scope Define the model combination that the user is interested in. Defaults to "All", but can also be: "VLC", "VLR", "VLN", "VMC", "VMR", "VMN". L and M stand for Litter and Manure (type of C input). C, R and N stand for Conventional, Reduced and No (Tillage practices).
#' @param SL_years Simulation Length of the model in years. Defaults to 100. SL_years doesn't affect the results but the cut-off (when the model stops).
#' @param soil.thick Soil thickness in cm. Defaults to 23 as in the original RothC model from Soil R Package.
#' @param Tem Temperature dataframe with one column with a sequence 1:12 (months) and the second column with monthly temperature values (in celsius degrees). The function Set_Temp() can be used to create the dataframe, which is then used as a Default.
#' @param Precip Precipitation dataframe with one column with a sequence 1:12 (months) and the second column with monthly precipitation values (in mm). The function Set_Precip() can be used to create the dataframe, which is then used as a Default.
#' @param Eva Evapotrasnpiration dataframe with one column with a sequence 1:12 (months) and the second column with monthly evapotranspiration values (in mm). The function Set_Evp() can be used to create the dataframe, which is then used as a Default.
#' @param CTRM Conventional Tillage Rate Modifier. Defaults to 1.00. Source: https://doi.org/10.1016/j.still.2022.105428
#' @param RTRM Reduced Tillage Rate Modifier. Defaults to 0.93. Source: https://doi.org/10.1016/j.still.2022.105428
#' @param NTRM No Tillage Rate Modifier. Defaults to 0.95. Source: https://doi.org/10.1016/j.still.2022.105428
#' @import SoilR ggplot2 stringr
#' @export

#Function to Run and Create the multiple RothC Combinations
Run_RothCO2 <- function(Scope = "All", #Can be: All, VLC, VLR, VLN, VMC, VMR, VMN.
                             SL_years = 100,
                             soil.thick = 23,
                             Tem = Temp,
                             Pre = Precip,
                             Eva = Evp,
                             CTRM = 1.00,
                             RTRM = 0.93,
                             NTRM = 0.95)

{
#### Pre-requisites

  # Create Folders to Save Models
  dir.create(file.path("VXC_Models"))
  dir.create(file.path("VXP_Models"))
  dir.create(file.path("CO2Emissions_P_NoDelay"))
  dir.create(file.path("CO2Emissions_P_Delay"))
  dir.create(file.path("CEmissions_P"))
  dir.create(file.path("CTails_P"))

  #Source Climatic Variables
  #Define Clay Range (Fixed)
  clay0=0        #0% - Percentage of clay
  clay100=100    #100% - Percentage of clay
  #Any other percentage of clay will be represented as clay100*X, e.g. 20% clay = clay100*0.2

  #Define C-Input Simulation Parameters
  Scalar_LitterCinputs=1 #Litter ANNUAL C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
  M_Scalar_LitterCinputs=Scalar_LitterCinputs/12 #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
  Scalar_ManureCinputs=1 #Manure ANNUAL C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
  M_Scalar_ManureCinputs=Scalar_ManureCinputs/12 #Manure MONHTLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams

  #Wrangle Simulation Length
  SimulationLength_months = SL_years*12
  years = seq(1/12, SL_years, by=1/12) #Writing this instead of just "SimulationLengthYear" increases the resolution of the model

  if(Scope == "All"){

#### 7) Model Combinations - Litter; Conventional Tillage, 0-100% (+10%) Clay ####
#### 7.1 - VLC0) Litter; 0%clay; Conventional tillage ####
#The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
fT_VLC0=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
fW_VLC0=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
            S.Thick = soil.thick, pClay = clay0,
            pE = 1.0, bare = FALSE)$b #Moisture effects per month
xi.frame_VLC0=data.frame(years,rep(fT_VLC0*fW_VLC0,length.out=length(years)))

#To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
Model_VLC0=SoilR::RothCModel(
  t=years, #Simulation Length
  ks=c(k.DPM = 10*CTRM, k.RPM = 0.3*CTRM, k.BIO = 0.66*CTRM, k.HUM = 0.02*CTRM, k.IOM = 0*CTRM), #Decomposition rates for the different pools
  C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
  In=Scalar_LitterCinputs*1, #Amount of litter inputs by time
  FYM = Scalar_ManureCinputs*0, #Amount of Farm Yard Manure by time
  clay=clay0, #Percent clay in mineral soil
  xi=xi.frame_VLC0) #Loads the model

Ct_VLC0=getC(Model_VLC0) #Calculates stocks for each pool per month

VEC_Lit_VLC0 <- rep(M_Scalar_LitterCinputs*1, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
VEC_Man_VLC0 <- rep(M_Scalar_ManureCinputs*0, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

VEC_LitDF_VLC0 <- as.data.frame(VEC_Lit_VLC0) #Converting the Litter vector to a data frame
VEC_LitDF_VLC0$MNumber <- seq(from = 1, to = SimulationLength_months)
VEC_ManDF_VLC0 <- as.data.frame(VEC_Man_VLC0) #Converting the Manure vector to a data frame
VEC_ManDF_VLC0$MNumber <- seq(from = 1, to = SimulationLength_months)

sapply(VEC_LitDF_VLC0, class) #Check that class is numeric
sapply(VEC_ManDF_VLC0, class) #Check that class is numeric
LitterCinputs_VLC0=VEC_LitDF_VLC0   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
ManureCinputs_VLC0=VEC_ManDF_VLC0 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
MCinputs_VLC0 <- merge(LitterCinputs_VLC0, ManureCinputs_VLC0, by = "MNumber")
MCinputs_VLC0$MInput_VLC0 <- MCinputs_VLC0$VEC_Lit_VLC0 + MCinputs_VLC0$VEC_Man_VLC0

#Change names of litter and manure columns for more common ones
colnames(MCinputs_VLC0)[which(names(MCinputs_VLC0) == "VEC_Lit_VLC0")] <- "LitterC_VLC0"
colnames(MCinputs_VLC0)[which(names(MCinputs_VLC0) == "VEC_Man_VLC0")] <- "ManureC_VLC0"

#Create a dataframe with the data considering the simulation length
ModelDF_VLC0 <- as.data.frame(Ct_VLC0)
colnames(ModelDF_VLC0) <- c('DPM_VLC0','RPM_VLC0','BIO_VLC0', 'HUM_VLC0', 'IOM_VLC0')
ModelDFS_VLC0 <- ModelDF_VLC0[1:SimulationLength_months, ]

#Create a column with the number of month of analysis
ModelDFS_VLC0$MNumber <- seq(from = 1, to = SimulationLength_months)

#Create a column that sums all pools
ModelDFS_VLC0$AllPools_VLC0 <- ModelDFS_VLC0$DPM_VLC0 + ModelDFS_VLC0$RPM_VLC0 + ModelDFS_VLC0$BIO_VLC0 + ModelDFS_VLC0$HUM_VLC0 + ModelDFS_VLC0$IOM_VLC0

#Create a column that sums all pools except IOM (static)
ModelDFS_VLC0$AllPools_noIOM_VLC0 <- ModelDFS_VLC0$DPM_VLC0 + ModelDFS_VLC0$RPM_VLC0 + ModelDFS_VLC0$BIO_VLC0 + ModelDFS_VLC0$HUM_VLC0

#Create a column that add the monthly input of C (manure and litter separately)
ModelDFSL_VLC0 <- merge(ModelDFS_VLC0, MCinputs_VLC0, by = "MNumber")

ModelDFSL_VLC0$MInput_VLC0 <- ModelDFSL_VLC0$LitterC_VLC0 + ModelDFSL_VLC0$ManureC_VLC0
#ModelDF_SL$MInput[1] <- 0

#Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
ModelDFSL_VLC0$CTails_VLC0 <- ModelDFSL_VLC0$AllPools_noIOM_VLC0 + ModelDFSL_VLC0$MInput_VLC0

#Create Monthly Accumulated input of C
ModelDFSL_VLC0$AccumInput_VLC0 = ModelDFSL_VLC0$AccumInput_VLC0=cumsum(ModelDFSL_VLC0$MInput_VLC0)

#Create Monthly Growths for each carbon pool
ModelDFSL_VLC0$MGrowth_DPM_VLC0 <- ave(ModelDFSL_VLC0$DPM_VLC0, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLC0$MGrowth_RPM_VLC0 <- ave(ModelDFSL_VLC0$RPM_VLC0, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLC0$MGrowth_BIO_VLC0 <- ave(ModelDFSL_VLC0$BIO_VLC0, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLC0$MGrowth_HUM_VLC0 <- ave(ModelDFSL_VLC0$HUM_VLC0, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLC0$MGrowth_IOM_VLC0 <- ave(ModelDFSL_VLC0$IOM_VLC0, FUN = function(x) c(0, diff(x)))

#Create column for Monthly and Accumulated C-CO2 emissions
ModelDFSL_VLC0$M_CCO2_VLC0 <- ModelDFSL_VLC0$MInput_VLC0 - ModelDFSL_VLC0$MGrowth_DPM_VLC0 - ModelDFSL_VLC0$MGrowth_RPM_VLC0 - ModelDFSL_VLC0$MGrowth_BIO_VLC0 - ModelDFSL_VLC0$MGrowth_HUM_VLC0
ModelDFSL_VLC0$Accum_CCO2_VLC0 <- ModelDFSL_VLC0$AccumInput_VLC0 - ModelDFSL_VLC0$AllPools_noIOM_VLC0

#Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
ModelDFSL_VLC0$M_CCO2_VLC0[1] <- 0
ModelDFSL_VLC0$Accum_CCO2_VLC0[1] <- 0

#Balance validation
ModelDFSL_VLC0$Balance_VLC0 <- ModelDFSL_VLC0$AccumInput_VLC0 - ModelDFSL_VLC0$Accum_CCO2_VLC0 - (ModelDFSL_VLC0$DPM_VLC0 + ModelDFSL_VLC0$RPM_VLC0 + ModelDFSL_VLC0$BIO_VLC0 + ModelDFSL_VLC0$HUM_VLC0)

#Convert C-CO2 emissions into CO2 emissions
ModelDFSL_VLC0$M_CO2_VLC0 <- ModelDFSL_VLC0$M_CCO2_VLC0 * 44/12
ModelDFSL_VLC0$Accum_CO2_VLC0 <- ModelDFSL_VLC0$Accum_CCO2_VLC0 * 44/12

#This model will be called VLC0C because implies a continuous input of C
ModelDFSL_VLC0C <- ModelDFSL_VLC0

#Export the dataframe
write_xlsx(ModelDFSL_VLC0C,"VXC_Models\\ModelDFSL_R_VLC0C.xlsx")

#Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
#Create two equal models by using the above general script
#Create model t=x
ModelDFSLt0_VLC0 <- ModelDFSL_VLC0 #Create model t=x

#Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
ModelDFSLt1_VLC0.1 <- rbind(c(0:0), ModelDFSLt0_VLC0)
ModelDFSLt1_VLC0.2 <- rbind(c(0:0), ModelDFSLt1_VLC0.1)
ModelDFSLt1_VLC0.3 <- rbind(c(0:0), ModelDFSLt1_VLC0.2)
ModelDFSLt1_VLC0.4 <- rbind(c(0:0), ModelDFSLt1_VLC0.3)
ModelDFSLt1_VLC0.5 <- rbind(c(0:0), ModelDFSLt1_VLC0.4)
ModelDFSLt1_VLC0.6 <- rbind(c(0:0), ModelDFSLt1_VLC0.5)
ModelDFSLt1_VLC0.7 <- rbind(c(0:0), ModelDFSLt1_VLC0.6)
ModelDFSLt1_VLC0.8 <- rbind(c(0:0), ModelDFSLt1_VLC0.7)
ModelDFSLt1_VLC0.9 <- rbind(c(0:0), ModelDFSLt1_VLC0.8)
ModelDFSLt1_VLC0.10 <- rbind(c(0:0), ModelDFSLt1_VLC0.9)
ModelDFSLt1_VLC0.11 <- rbind(c(0:0), ModelDFSLt1_VLC0.10)
ModelDFSLt1_VLC0.12 <- rbind(c(0:0), ModelDFSLt1_VLC0.11)
ModelDFSLt1_VLC0.13 <- ModelDFSLt1_VLC0.12[-nrow(ModelDFSLt1_VLC0.12),]
ModelDFSLt1_VLC0.14 <- ModelDFSLt1_VLC0.13[-nrow(ModelDFSLt1_VLC0.13),]
ModelDFSLt1_VLC0.15 <- ModelDFSLt1_VLC0.14[-nrow(ModelDFSLt1_VLC0.14),]
ModelDFSLt1_VLC0.16 <- ModelDFSLt1_VLC0.15[-nrow(ModelDFSLt1_VLC0.15),]
ModelDFSLt1_VLC0.17 <- ModelDFSLt1_VLC0.16[-nrow(ModelDFSLt1_VLC0.16),]
ModelDFSLt1_VLC0.18 <- ModelDFSLt1_VLC0.17[-nrow(ModelDFSLt1_VLC0.17),]
ModelDFSLt1_VLC0.19 <- ModelDFSLt1_VLC0.18[-nrow(ModelDFSLt1_VLC0.18),]
ModelDFSLt1_VLC0.20 <- ModelDFSLt1_VLC0.19[-nrow(ModelDFSLt1_VLC0.19),]
ModelDFSLt1_VLC0.21 <- ModelDFSLt1_VLC0.20[-nrow(ModelDFSLt1_VLC0.20),]
ModelDFSLt1_VLC0.22 <- ModelDFSLt1_VLC0.21[-nrow(ModelDFSLt1_VLC0.21),]
ModelDFSLt1_VLC0.23 <- ModelDFSLt1_VLC0.22[-nrow(ModelDFSLt1_VLC0.22),]
ModelDFSLt1_VLC0.24 <- ModelDFSLt1_VLC0.23[-nrow(ModelDFSLt1_VLC0.23),]

ModelDFSLt1_VLC0 <- ModelDFSLt1_VLC0.24 #Create model t=x+1

#Subtract model (t=x) - (t=x+1)
ModelDFSL1y_VLC0 <- ModelDFSLt0_VLC0 - ModelDFSLt1_VLC0

#Re-do Month Number column because the substraction was also applied to it
ModelDFSL1y_VLC0$MNumber <- seq(from = 1, to = SimulationLength_months)

#This model will be called VLC0P because implies a one-off input of C
ModelDFSL_VLC0P <- ModelDFSL1y_VLC0

#Export the dataframe
write_xlsx(ModelDFSL_VLC0P,"VXP_Models\\ModelDFSL_R_VLC0P.xlsx")

#Plot 3.1: Interactive Yearly CO2 emissions #
MY <- 12
ModelDFSL_VLC0P_YCO2 <- ModelDFSL_VLC0P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VLC0)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLC0P_YCO2) <- c("Year", "Months", "AnnualCO2_VLC_0")

#Plot 3.2: Interactive Yearly CO2 emissions considering a delay
GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
ModelDFSL_VLC0P_YCO2D <- merge(ModelDFSL_VLC0P_YCO2, GWP100delay, by = "Year")
ModelDFSL_VLC0P_YCO2D$AnnualCO2D_VLC_0 <- ModelDFSL_VLC0P_YCO2D$AnnualCO2_VLC_0 * ModelDFSL_VLC0P_YCO2D$GWP100

#Plot 4: Interactive Yearly C emissions #
MY <- 12
ModelDFSL_VLC0P_YC <- ModelDFSL_VLC0P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VLC0)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLC0P_YC) <- c("Year", "Months", "CEmissions_VLC_0")

#Plot 5: Interactive Yearly C tails (remaining C in Soil) #
MY <- 12
ModelDFSL_VLC0P_YCT <- ModelDFSL_VLC0P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VLC0)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLC0P_YCT) <- c("Year", "Months", "CTail_VLC_0")

#Save Dataframes for Plots 3.1, 3.2, 4 and 5
write_xlsx(ModelDFSL_VLC0P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VLC0P.xlsx") #Yearly CO2 emissions (no delay)
write_xlsx(ModelDFSL_VLC0P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VLC0P.xlsx") #Yearly CO2 emissions (delay)
write_xlsx(ModelDFSL_VLC0P_YC,"CEmissions_P\\ModelDFSL_R_CE_VLC0P.xlsx") #Yearly C emissions
write_xlsx(ModelDFSL_VLC0P_YCT,"CTails_P\\ModelDFSL_R_CT_VLC0P.xlsx") #Yearly C emissions


#### 7.2 - VLC1) Litter; 10%clay; Conventional tillage ####
#The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
fT_VLC1=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
fW_VLC1=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
               S.Thick = soil.thick, pClay = clay100*0.1,
               pE = 1.0, bare = FALSE)$b #Moisture effects per month
xi.frame_VLC1=data.frame(years,rep(fT_VLC1*fW_VLC1,length.out=length(years)))

#To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
Model_VLC1=SoilR::RothCModel(
  t=years, #Simulation Length
  ks=c(k.DPM = 10*CTRM, k.RPM = 0.3*CTRM, k.BIO = 0.66*CTRM, k.HUM = 0.02*CTRM, k.IOM = 0*CTRM), #Decomposition rates for the different pools
  C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
  In=Scalar_LitterCinputs*1, #Amount of litter inputs by time
  FYM = Scalar_ManureCinputs*0, #Amount of Farm Yard Manure by time
  clay=clay100*0.1, #Percent clay in mineral soil
  xi=xi.frame_VLC1) #Loads the model

Ct_VLC1=getC(Model_VLC1) #Calculates stocks for each pool per month

#The results can be plotted with the commands
matplot(years, Ct_VLC1, type="l", lty=1, col=1:5,
        xlab="Time (years)", ylab="C stocks (Mg/ha)")
legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
       lty=1, col=1:5, bty="n")

VEC_Lit_VLC1 <- rep(M_Scalar_LitterCinputs*1, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
VEC_Man_VLC1 <- rep(M_Scalar_ManureCinputs*0, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

VEC_LitDF_VLC1 <- as.data.frame(VEC_Lit_VLC1) #Converting the Litter vector to a data frame
VEC_LitDF_VLC1$MNumber <- seq(from = 1, to = SimulationLength_months)
VEC_ManDF_VLC1 <- as.data.frame(VEC_Man_VLC1) #Converting the Manure vector to a data frame
VEC_ManDF_VLC1$MNumber <- seq(from = 1, to = SimulationLength_months)

sapply(VEC_LitDF_VLC1, class) #Check that class is numeric
sapply(VEC_ManDF_VLC1, class) #Check that class is numeric
LitterCinputs_VLC1=VEC_LitDF_VLC1   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
ManureCinputs_VLC1=VEC_ManDF_VLC1 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
MCinputs_VLC1 <- merge(LitterCinputs_VLC1, ManureCinputs_VLC1, by = "MNumber")
MCinputs_VLC1$MInput_VLC1 <- MCinputs_VLC1$VEC_Lit_VLC1 + MCinputs_VLC1$VEC_Man_VLC1

#Change names of litter and manure columns for more common ones
colnames(MCinputs_VLC1)[which(names(MCinputs_VLC1) == "VEC_Lit_VLC1")] <- "LitterC_VLC1"
colnames(MCinputs_VLC1)[which(names(MCinputs_VLC1) == "VEC_Man_VLC1")] <- "ManureC_VLC1"

#Create a dataframe with the data considering the simulation length
ModelDF_VLC1 <- as.data.frame(Ct_VLC1)
colnames(ModelDF_VLC1) <- c('DPM_VLC1','RPM_VLC1','BIO_VLC1', 'HUM_VLC1', 'IOM_VLC1')
ModelDFS_VLC1 <- ModelDF_VLC1[1:SimulationLength_months, ]

#Create a column with the number of month of analysis
ModelDFS_VLC1$MNumber <- seq(from = 1, to = SimulationLength_months)

#Create a column that sums all pools
ModelDFS_VLC1$AllPools_VLC1 <- ModelDFS_VLC1$DPM_VLC1 + ModelDFS_VLC1$RPM_VLC1 + ModelDFS_VLC1$BIO_VLC1 + ModelDFS_VLC1$HUM_VLC1 + ModelDFS_VLC1$IOM_VLC1

#Create a column that sums all pools except IOM (static)
ModelDFS_VLC1$AllPools_noIOM_VLC1 <- ModelDFS_VLC1$DPM_VLC1 + ModelDFS_VLC1$RPM_VLC1 + ModelDFS_VLC1$BIO_VLC1 + ModelDFS_VLC1$HUM_VLC1

#Create a column that add the monthly input of C (manure and litter separately)
ModelDFSL_VLC1 <- merge(ModelDFS_VLC1, MCinputs_VLC1, by = "MNumber")

ModelDFSL_VLC1$MInput_VLC1 <- ModelDFSL_VLC1$LitterC_VLC1 + ModelDFSL_VLC1$ManureC_VLC1
#ModelDF_SL$MInput[1] <- 0

#Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
ModelDFSL_VLC1$CTails_VLC1 <- ModelDFSL_VLC1$AllPools_noIOM_VLC1 + ModelDFSL_VLC1$MInput_VLC1

#Create Monthly Accumulated input of C
ModelDFSL_VLC1$AccumInput_VLC1 = ModelDFSL_VLC1$AccumInput_VLC1=cumsum(ModelDFSL_VLC1$MInput_VLC1)

#Create Monthly Growths for each carbon pool
ModelDFSL_VLC1$MGrowth_DPM_VLC1 <- ave(ModelDFSL_VLC1$DPM_VLC1, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLC1$MGrowth_RPM_VLC1 <- ave(ModelDFSL_VLC1$RPM_VLC1, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLC1$MGrowth_BIO_VLC1 <- ave(ModelDFSL_VLC1$BIO_VLC1, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLC1$MGrowth_HUM_VLC1 <- ave(ModelDFSL_VLC1$HUM_VLC1, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLC1$MGrowth_IOM_VLC1 <- ave(ModelDFSL_VLC1$IOM_VLC1, FUN = function(x) c(0, diff(x)))

#Create column for Monthly and Accumulated C-CO2 emissions
ModelDFSL_VLC1$M_CCO2_VLC1 <- ModelDFSL_VLC1$MInput_VLC1 - ModelDFSL_VLC1$MGrowth_DPM_VLC1 - ModelDFSL_VLC1$MGrowth_RPM_VLC1 - ModelDFSL_VLC1$MGrowth_BIO_VLC1 - ModelDFSL_VLC1$MGrowth_HUM_VLC1
ModelDFSL_VLC1$Accum_CCO2_VLC1 <- ModelDFSL_VLC1$AccumInput_VLC1 - ModelDFSL_VLC1$AllPools_noIOM_VLC1

#Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
ModelDFSL_VLC1$M_CCO2_VLC1[1] <- 0
ModelDFSL_VLC1$Accum_CCO2_VLC1[1] <- 0

#Balance validation
ModelDFSL_VLC1$Balance_VLC1 <- ModelDFSL_VLC1$AccumInput_VLC1 - ModelDFSL_VLC1$Accum_CCO2_VLC1 - (ModelDFSL_VLC1$DPM_VLC1 + ModelDFSL_VLC1$RPM_VLC1 + ModelDFSL_VLC1$BIO_VLC1 + ModelDFSL_VLC1$HUM_VLC1)

#Convert C-CO2 emissions into CO2 emissions
ModelDFSL_VLC1$M_CO2_VLC1 <- ModelDFSL_VLC1$M_CCO2_VLC1 * 44/12
ModelDFSL_VLC1$Accum_CO2_VLC1 <- ModelDFSL_VLC1$Accum_CCO2_VLC1 * 44/12

#This model will be called VLC1C because implies a continuous input of C
ModelDFSL_VLC1C <- ModelDFSL_VLC1

#Export the dataframe
write_xlsx(ModelDFSL_VLC1C,"VXC_Models\\ModelDFSL_R_VLC1C.xlsx")

#Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
#Create two equal models by using the above general script
#Create model t=x
ModelDFSLt0_VLC1 <- ModelDFSL_VLC1 #Create model t=x

#Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
ModelDFSLt1_VLC1.1 <- rbind(c(0:0), ModelDFSLt0_VLC1)
ModelDFSLt1_VLC1.2 <- rbind(c(0:0), ModelDFSLt1_VLC1.1)
ModelDFSLt1_VLC1.3 <- rbind(c(0:0), ModelDFSLt1_VLC1.2)
ModelDFSLt1_VLC1.4 <- rbind(c(0:0), ModelDFSLt1_VLC1.3)
ModelDFSLt1_VLC1.5 <- rbind(c(0:0), ModelDFSLt1_VLC1.4)
ModelDFSLt1_VLC1.6 <- rbind(c(0:0), ModelDFSLt1_VLC1.5)
ModelDFSLt1_VLC1.7 <- rbind(c(0:0), ModelDFSLt1_VLC1.6)
ModelDFSLt1_VLC1.8 <- rbind(c(0:0), ModelDFSLt1_VLC1.7)
ModelDFSLt1_VLC1.9 <- rbind(c(0:0), ModelDFSLt1_VLC1.8)
ModelDFSLt1_VLC1.10 <- rbind(c(0:0), ModelDFSLt1_VLC1.9)
ModelDFSLt1_VLC1.11 <- rbind(c(0:0), ModelDFSLt1_VLC1.10)
ModelDFSLt1_VLC1.12 <- rbind(c(0:0), ModelDFSLt1_VLC1.11)
ModelDFSLt1_VLC1.13 <- ModelDFSLt1_VLC1.12[-nrow(ModelDFSLt1_VLC1.12),]
ModelDFSLt1_VLC1.14 <- ModelDFSLt1_VLC1.13[-nrow(ModelDFSLt1_VLC1.13),]
ModelDFSLt1_VLC1.15 <- ModelDFSLt1_VLC1.14[-nrow(ModelDFSLt1_VLC1.14),]
ModelDFSLt1_VLC1.16 <- ModelDFSLt1_VLC1.15[-nrow(ModelDFSLt1_VLC1.15),]
ModelDFSLt1_VLC1.17 <- ModelDFSLt1_VLC1.16[-nrow(ModelDFSLt1_VLC1.16),]
ModelDFSLt1_VLC1.18 <- ModelDFSLt1_VLC1.17[-nrow(ModelDFSLt1_VLC1.17),]
ModelDFSLt1_VLC1.19 <- ModelDFSLt1_VLC1.18[-nrow(ModelDFSLt1_VLC1.18),]
ModelDFSLt1_VLC1.20 <- ModelDFSLt1_VLC1.19[-nrow(ModelDFSLt1_VLC1.19),]
ModelDFSLt1_VLC1.21 <- ModelDFSLt1_VLC1.20[-nrow(ModelDFSLt1_VLC1.20),]
ModelDFSLt1_VLC1.22 <- ModelDFSLt1_VLC1.21[-nrow(ModelDFSLt1_VLC1.21),]
ModelDFSLt1_VLC1.23 <- ModelDFSLt1_VLC1.22[-nrow(ModelDFSLt1_VLC1.22),]
ModelDFSLt1_VLC1.24 <- ModelDFSLt1_VLC1.23[-nrow(ModelDFSLt1_VLC1.23),]

ModelDFSLt1_VLC1 <- ModelDFSLt1_VLC1.24 #Create model t=x+1

#Subtract model (t=x) - (t=x+1)
ModelDFSL1y_VLC1 <- ModelDFSLt0_VLC1 - ModelDFSLt1_VLC1

#Re-do Month Number column because the substraction was also applied to it
ModelDFSL1y_VLC1$MNumber <- seq(from = 1, to = SimulationLength_months)

#This model will be called VLC1P because implies a one-off input of C
ModelDFSL_VLC1P <- ModelDFSL1y_VLC1

#Export the dataframe
write_xlsx(ModelDFSL_VLC1P,"VXP_Models\\ModelDFSL_R_VLC1P.xlsx")

#Plot 3: Interactive Yearly CO2 emissions #
MY <- 12
ModelDFSL_VLC1P_YCO2 <- ModelDFSL_VLC1P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VLC1)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLC1P_YCO2) <- c("Year", "Months", "AnnualCO2_VLC_1")

#Plot 3: Interactive Yearly CO2 emissions considering a delay
GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
ModelDFSL_VLC1P_YCO2D <- merge(ModelDFSL_VLC1P_YCO2, GWP100delay, by = "Year")
ModelDFSL_VLC1P_YCO2D$AnnualCO2D_VLC_1 <- ModelDFSL_VLC1P_YCO2D$AnnualCO2_VLC_1 * ModelDFSL_VLC1P_YCO2D$GWP100

#Plot 4: Interactive Yearly C emissions #
MY <- 12
ModelDFSL_VLC1P_YC <- ModelDFSL_VLC1P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VLC1)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLC1P_YC) <- c("Year", "Months", "CEmissions_VLC_1")

#Plot 5: Interactive Yearly C tails (remaining C in Soil) #
MY <- 12
ModelDFSL_VLC1P_YCT <- ModelDFSL_VLC1P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VLC1)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLC1P_YCT) <- c("Year", "Months", "CTail_VLC_1")

#Save Dataframes for Plots 3.1, 3.2, 4 and 5
write_xlsx(ModelDFSL_VLC1P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VLC1P.xlsx") #Yearly CO2 emissions (no delay)
write_xlsx(ModelDFSL_VLC1P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VLC1P.xlsx") #Yearly CO2 emissions (delay)
write_xlsx(ModelDFSL_VLC1P_YC,"CEmissions_P\\ModelDFSL_R_CE_VLC1P.xlsx") #Yearly C emissions
write_xlsx(ModelDFSL_VLC1P_YCT,"CTails_P\\ModelDFSL_R_CT_VLC1P.xlsx") #Yearly C emissions



#### 7.3 - VLC2) Litter; 20%clay; Conventional tillage ####
#The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
fT_VLC2=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
fW_VLC2=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
               S.Thick = soil.thick, pClay = clay100*0.2,
               pE = 1.0, bare = FALSE)$b #Moisture effects per month
xi.frame_VLC2=data.frame(years,rep(fT_VLC2*fW_VLC2,length.out=length(years)))

#To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
Model_VLC2=SoilR::RothCModel(
  t=years, #Simulation Length
  ks=c(k.DPM = 10*CTRM, k.RPM = 0.3*CTRM, k.BIO = 0.66*CTRM, k.HUM = 0.02*CTRM, k.IOM = 0*CTRM), #Decomposition rates for the different pools
  C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
  In=Scalar_LitterCinputs*1, #Amount of litter inputs by time
  FYM = Scalar_ManureCinputs*0, #Amount of Farm Yard Manure by time
  clay=clay100*0.2, #Percent clay in mineral soil
  xi=xi.frame_VLC2) #Loads the model

Ct_VLC2=getC(Model_VLC2) #Calculates stocks for each pool per month

#The results can be plotted with the commands
matplot(years, Ct_VLC2, type="l", lty=1, col=1:5,
        xlab="Time (years)", ylab="C stocks (Mg/ha)")
legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
       lty=1, col=1:5, bty="n")

VEC_Lit_VLC2 <- rep(M_Scalar_LitterCinputs*1, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
VEC_Man_VLC2 <- rep(M_Scalar_ManureCinputs*0, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

VEC_LitDF_VLC2 <- as.data.frame(VEC_Lit_VLC2) #Converting the Litter vector to a data frame
VEC_LitDF_VLC2$MNumber <- seq(from = 1, to = SimulationLength_months)
VEC_ManDF_VLC2 <- as.data.frame(VEC_Man_VLC2) #Converting the Manure vector to a data frame
VEC_ManDF_VLC2$MNumber <- seq(from = 1, to = SimulationLength_months)

sapply(VEC_LitDF_VLC2, class) #Check that class is numeric
sapply(VEC_ManDF_VLC2, class) #Check that class is numeric
LitterCinputs_VLC2=VEC_LitDF_VLC2   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
ManureCinputs_VLC2=VEC_ManDF_VLC2 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
MCinputs_VLC2 <- merge(LitterCinputs_VLC2, ManureCinputs_VLC2, by = "MNumber")
MCinputs_VLC2$MInput_VLC2 <- MCinputs_VLC2$VEC_Lit_VLC2 + MCinputs_VLC2$VEC_Man_VLC2

#Change names of litter and manure columns for more common ones
colnames(MCinputs_VLC2)[which(names(MCinputs_VLC2) == "VEC_Lit_VLC2")] <- "LitterC_VLC2"
colnames(MCinputs_VLC2)[which(names(MCinputs_VLC2) == "VEC_Man_VLC2")] <- "ManureC_VLC2"

#Create a dataframe with the data considering the simulation length
ModelDF_VLC2 <- as.data.frame(Ct_VLC2)
colnames(ModelDF_VLC2) <- c('DPM_VLC2','RPM_VLC2','BIO_VLC2', 'HUM_VLC2', 'IOM_VLC2')
ModelDFS_VLC2 <- ModelDF_VLC2[1:SimulationLength_months, ]

#Create a column with the number of month of analysis
ModelDFS_VLC2$MNumber <- seq(from = 1, to = SimulationLength_months)

#Create a column that sums all pools
ModelDFS_VLC2$AllPools_VLC2 <- ModelDFS_VLC2$DPM_VLC2 + ModelDFS_VLC2$RPM_VLC2 + ModelDFS_VLC2$BIO_VLC2 + ModelDFS_VLC2$HUM_VLC2 + ModelDFS_VLC2$IOM_VLC2

#Create a column that sums all pools except IOM (static)
ModelDFS_VLC2$AllPools_noIOM_VLC2 <- ModelDFS_VLC2$DPM_VLC2 + ModelDFS_VLC2$RPM_VLC2 + ModelDFS_VLC2$BIO_VLC2 + ModelDFS_VLC2$HUM_VLC2

#Create a column that add the monthly input of C (manure and litter separately)
ModelDFSL_VLC2 <- merge(ModelDFS_VLC2, MCinputs_VLC2, by = "MNumber")

ModelDFSL_VLC2$MInput_VLC2 <- ModelDFSL_VLC2$LitterC_VLC2 + ModelDFSL_VLC2$ManureC_VLC2
#ModelDF_SL$MInput[1] <- 0

#Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
ModelDFSL_VLC2$CTails_VLC2 <- ModelDFSL_VLC2$AllPools_noIOM_VLC2 + ModelDFSL_VLC2$MInput_VLC2

#Create Monthly Accumulated input of C
ModelDFSL_VLC2$AccumInput_VLC2 = ModelDFSL_VLC2$AccumInput_VLC2=cumsum(ModelDFSL_VLC2$MInput_VLC2)

#Create Monthly Growths for each carbon pool
ModelDFSL_VLC2$MGrowth_DPM_VLC2 <- ave(ModelDFSL_VLC2$DPM_VLC2, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLC2$MGrowth_RPM_VLC2 <- ave(ModelDFSL_VLC2$RPM_VLC2, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLC2$MGrowth_BIO_VLC2 <- ave(ModelDFSL_VLC2$BIO_VLC2, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLC2$MGrowth_HUM_VLC2 <- ave(ModelDFSL_VLC2$HUM_VLC2, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLC2$MGrowth_IOM_VLC2 <- ave(ModelDFSL_VLC2$IOM_VLC2, FUN = function(x) c(0, diff(x)))

#Create column for Monthly and Accumulated C-CO2 emissions
ModelDFSL_VLC2$M_CCO2_VLC2 <- ModelDFSL_VLC2$MInput_VLC2 - ModelDFSL_VLC2$MGrowth_DPM_VLC2 - ModelDFSL_VLC2$MGrowth_RPM_VLC2 - ModelDFSL_VLC2$MGrowth_BIO_VLC2 - ModelDFSL_VLC2$MGrowth_HUM_VLC2
ModelDFSL_VLC2$Accum_CCO2_VLC2 <- ModelDFSL_VLC2$AccumInput_VLC2 - ModelDFSL_VLC2$AllPools_noIOM_VLC2

#Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
ModelDFSL_VLC2$M_CCO2_VLC2[1] <- 0
ModelDFSL_VLC2$Accum_CCO2_VLC2[1] <- 0

#Balance validation
ModelDFSL_VLC2$Balance_VLC2 <- ModelDFSL_VLC2$AccumInput_VLC2 - ModelDFSL_VLC2$Accum_CCO2_VLC2 - (ModelDFSL_VLC2$DPM_VLC2 + ModelDFSL_VLC2$RPM_VLC2 + ModelDFSL_VLC2$BIO_VLC2 + ModelDFSL_VLC2$HUM_VLC2)

#Convert C-CO2 emissions into CO2 emissions
ModelDFSL_VLC2$M_CO2_VLC2 <- ModelDFSL_VLC2$M_CCO2_VLC2 * 44/12
ModelDFSL_VLC2$Accum_CO2_VLC2 <- ModelDFSL_VLC2$Accum_CCO2_VLC2 * 44/12

#This model will be called VLC2C because implies a continuous input of C
ModelDFSL_VLC2C <- ModelDFSL_VLC2

#Export the dataframe
write_xlsx(ModelDFSL_VLC2C,"VXC_Models\\ModelDFSL_R_VLC2C.xlsx")

#Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
#Create two equal models by using the above general script
#Create model t=x
ModelDFSLt0_VLC2 <- ModelDFSL_VLC2 #Create model t=x

#Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
ModelDFSLt1_VLC2.1 <- rbind(c(0:0), ModelDFSLt0_VLC2)
ModelDFSLt1_VLC2.2 <- rbind(c(0:0), ModelDFSLt1_VLC2.1)
ModelDFSLt1_VLC2.3 <- rbind(c(0:0), ModelDFSLt1_VLC2.2)
ModelDFSLt1_VLC2.4 <- rbind(c(0:0), ModelDFSLt1_VLC2.3)
ModelDFSLt1_VLC2.5 <- rbind(c(0:0), ModelDFSLt1_VLC2.4)
ModelDFSLt1_VLC2.6 <- rbind(c(0:0), ModelDFSLt1_VLC2.5)
ModelDFSLt1_VLC2.7 <- rbind(c(0:0), ModelDFSLt1_VLC2.6)
ModelDFSLt1_VLC2.8 <- rbind(c(0:0), ModelDFSLt1_VLC2.7)
ModelDFSLt1_VLC2.9 <- rbind(c(0:0), ModelDFSLt1_VLC2.8)
ModelDFSLt1_VLC2.10 <- rbind(c(0:0), ModelDFSLt1_VLC2.9)
ModelDFSLt1_VLC2.11 <- rbind(c(0:0), ModelDFSLt1_VLC2.10)
ModelDFSLt1_VLC2.12 <- rbind(c(0:0), ModelDFSLt1_VLC2.11)
ModelDFSLt1_VLC2.13 <- ModelDFSLt1_VLC2.12[-nrow(ModelDFSLt1_VLC2.12),]
ModelDFSLt1_VLC2.14 <- ModelDFSLt1_VLC2.13[-nrow(ModelDFSLt1_VLC2.13),]
ModelDFSLt1_VLC2.15 <- ModelDFSLt1_VLC2.14[-nrow(ModelDFSLt1_VLC2.14),]
ModelDFSLt1_VLC2.16 <- ModelDFSLt1_VLC2.15[-nrow(ModelDFSLt1_VLC2.15),]
ModelDFSLt1_VLC2.17 <- ModelDFSLt1_VLC2.16[-nrow(ModelDFSLt1_VLC2.16),]
ModelDFSLt1_VLC2.18 <- ModelDFSLt1_VLC2.17[-nrow(ModelDFSLt1_VLC2.17),]
ModelDFSLt1_VLC2.19 <- ModelDFSLt1_VLC2.18[-nrow(ModelDFSLt1_VLC2.18),]
ModelDFSLt1_VLC2.20 <- ModelDFSLt1_VLC2.19[-nrow(ModelDFSLt1_VLC2.19),]
ModelDFSLt1_VLC2.21 <- ModelDFSLt1_VLC2.20[-nrow(ModelDFSLt1_VLC2.20),]
ModelDFSLt1_VLC2.22 <- ModelDFSLt1_VLC2.21[-nrow(ModelDFSLt1_VLC2.21),]
ModelDFSLt1_VLC2.23 <- ModelDFSLt1_VLC2.22[-nrow(ModelDFSLt1_VLC2.22),]
ModelDFSLt1_VLC2.24 <- ModelDFSLt1_VLC2.23[-nrow(ModelDFSLt1_VLC2.23),]

ModelDFSLt1_VLC2 <- ModelDFSLt1_VLC2.24 #Create model t=x+1

#Subtract model (t=x) - (t=x+1)
ModelDFSL1y_VLC2 <- ModelDFSLt0_VLC2 - ModelDFSLt1_VLC2

#Re-do Month Number column because the substraction was also applied to it
ModelDFSL1y_VLC2$MNumber <- seq(from = 1, to = SimulationLength_months)

#This model will be called VLC2P because implies a one-off input of C
ModelDFSL_VLC2P <- ModelDFSL1y_VLC2

#Export the dataframe
write_xlsx(ModelDFSL_VLC2P,"VXP_Models\\ModelDFSL_R_VLC2P.xlsx")

#Plot 3: Interactive Yearly CO2 emissions #
MY <- 12
ModelDFSL_VLC2P_YCO2 <- ModelDFSL_VLC2P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VLC2)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLC2P_YCO2) <- c("Year", "Months", "AnnualCO2_VLC_2")

#Plot 3: Interactive Yearly CO2 emissions considering a delay
GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
ModelDFSL_VLC2P_YCO2D <- merge(ModelDFSL_VLC2P_YCO2, GWP100delay, by = "Year")
ModelDFSL_VLC2P_YCO2D$AnnualCO2D_VLC_2 <- ModelDFSL_VLC2P_YCO2D$AnnualCO2_VLC_2 * ModelDFSL_VLC2P_YCO2D$GWP100

#Plot 4: Interactive Yearly C emissions #
MY <- 12
ModelDFSL_VLC2P_YC <- ModelDFSL_VLC2P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VLC2)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLC2P_YC) <- c("Year", "Months", "CEmissions_VLC_2")

#Plot 5: Interactive Yearly C tails (remaining C in Soil) #
MY <- 12
ModelDFSL_VLC2P_YCT <- ModelDFSL_VLC2P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VLC2)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLC2P_YCT) <- c("Year", "Months", "CTail_VLC_2")

#Save Dataframes for Plots 3.1, 3.2, 4 and 5
write_xlsx(ModelDFSL_VLC2P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VLC2P.xlsx") #Yearly CO2 emissions (no delay)
write_xlsx(ModelDFSL_VLC2P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VLC2P.xlsx") #Yearly CO2 emissions (delay)
write_xlsx(ModelDFSL_VLC2P_YC,"CEmissions_P\\ModelDFSL_R_CE_VLC2P.xlsx") #Yearly C emissions
write_xlsx(ModelDFSL_VLC2P_YCT,"CTails_P\\ModelDFSL_R_CT_VLC2P.xlsx") #Yearly C emissions



#### 7.4 - VLC3) Litter; 30%clay; Conventional tillage ####
#The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
fT_VLC3=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
fW_VLC3=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
               S.Thick = soil.thick, pClay = clay100*0.3,
               pE = 1.0, bare = FALSE)$b #Moisture effects per month
xi.frame_VLC3=data.frame(years,rep(fT_VLC3*fW_VLC3,length.out=length(years)))

#To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
Model_VLC3=SoilR::RothCModel(
  t=years, #Simulation Length
  ks=c(k.DPM = 10*CTRM, k.RPM = 0.3*CTRM, k.BIO = 0.66*CTRM, k.HUM = 0.02*CTRM, k.IOM = 0*CTRM), #Decomposition rates for the different pools
  C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
  In=Scalar_LitterCinputs*1, #Amount of litter inputs by time
  FYM = Scalar_ManureCinputs*0, #Amount of Farm Yard Manure by time
  clay=clay100*0.3, #Percent clay in mineral soil
  xi=xi.frame_VLC3) #Loads the model

Ct_VLC3=getC(Model_VLC3) #Calculates stocks for each pool per month

#The results can be plotted with the commands
matplot(years, Ct_VLC3, type="l", lty=1, col=1:5,
        xlab="Time (years)", ylab="C stocks (Mg/ha)")
legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
       lty=1, col=1:5, bty="n")

VEC_Lit_VLC3 <- rep(M_Scalar_LitterCinputs*1, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
VEC_Man_VLC3 <- rep(M_Scalar_ManureCinputs*0, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

VEC_LitDF_VLC3 <- as.data.frame(VEC_Lit_VLC3) #Converting the Litter vector to a data frame
VEC_LitDF_VLC3$MNumber <- seq(from = 1, to = SimulationLength_months)
VEC_ManDF_VLC3 <- as.data.frame(VEC_Man_VLC3) #Converting the Manure vector to a data frame
VEC_ManDF_VLC3$MNumber <- seq(from = 1, to = SimulationLength_months)

sapply(VEC_LitDF_VLC3, class) #Check that class is numeric
sapply(VEC_ManDF_VLC3, class) #Check that class is numeric
LitterCinputs_VLC3=VEC_LitDF_VLC3   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
ManureCinputs_VLC3=VEC_ManDF_VLC3 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
MCinputs_VLC3 <- merge(LitterCinputs_VLC3, ManureCinputs_VLC3, by = "MNumber")
MCinputs_VLC3$MInput_VLC3 <- MCinputs_VLC3$VEC_Lit_VLC3 + MCinputs_VLC3$VEC_Man_VLC3

#Change names of litter and manure columns for more common ones
colnames(MCinputs_VLC3)[which(names(MCinputs_VLC3) == "VEC_Lit_VLC3")] <- "LitterC_VLC3"
colnames(MCinputs_VLC3)[which(names(MCinputs_VLC3) == "VEC_Man_VLC3")] <- "ManureC_VLC3"

#Create a dataframe with the data considering the simulation length
ModelDF_VLC3 <- as.data.frame(Ct_VLC3)
colnames(ModelDF_VLC3) <- c('DPM_VLC3','RPM_VLC3','BIO_VLC3', 'HUM_VLC3', 'IOM_VLC3')
ModelDFS_VLC3 <- ModelDF_VLC3[1:SimulationLength_months, ]

#Create a column with the number of month of analysis
ModelDFS_VLC3$MNumber <- seq(from = 1, to = SimulationLength_months)

#Create a column that sums all pools
ModelDFS_VLC3$AllPools_VLC3 <- ModelDFS_VLC3$DPM_VLC3 + ModelDFS_VLC3$RPM_VLC3 + ModelDFS_VLC3$BIO_VLC3 + ModelDFS_VLC3$HUM_VLC3 + ModelDFS_VLC3$IOM_VLC3

#Create a column that sums all pools except IOM (static)
ModelDFS_VLC3$AllPools_noIOM_VLC3 <- ModelDFS_VLC3$DPM_VLC3 + ModelDFS_VLC3$RPM_VLC3 + ModelDFS_VLC3$BIO_VLC3 + ModelDFS_VLC3$HUM_VLC3

#Create a column that add the monthly input of C (manure and litter separately)
ModelDFSL_VLC3 <- merge(ModelDFS_VLC3, MCinputs_VLC3, by = "MNumber")

ModelDFSL_VLC3$MInput_VLC3 <- ModelDFSL_VLC3$LitterC_VLC3 + ModelDFSL_VLC3$ManureC_VLC3
#ModelDF_SL$MInput[1] <- 0

#Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
ModelDFSL_VLC3$CTails_VLC3 <- ModelDFSL_VLC3$AllPools_noIOM_VLC3 + ModelDFSL_VLC3$MInput_VLC3

#Create Monthly Accumulated input of C
ModelDFSL_VLC3$AccumInput_VLC3 = ModelDFSL_VLC3$AccumInput_VLC3=cumsum(ModelDFSL_VLC3$MInput_VLC3)

#Create Monthly Growths for each carbon pool
ModelDFSL_VLC3$MGrowth_DPM_VLC3 <- ave(ModelDFSL_VLC3$DPM_VLC3, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLC3$MGrowth_RPM_VLC3 <- ave(ModelDFSL_VLC3$RPM_VLC3, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLC3$MGrowth_BIO_VLC3 <- ave(ModelDFSL_VLC3$BIO_VLC3, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLC3$MGrowth_HUM_VLC3 <- ave(ModelDFSL_VLC3$HUM_VLC3, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLC3$MGrowth_IOM_VLC3 <- ave(ModelDFSL_VLC3$IOM_VLC3, FUN = function(x) c(0, diff(x)))

#Create column for Monthly and Accumulated C-CO2 emissions
ModelDFSL_VLC3$M_CCO2_VLC3 <- ModelDFSL_VLC3$MInput_VLC3 - ModelDFSL_VLC3$MGrowth_DPM_VLC3 - ModelDFSL_VLC3$MGrowth_RPM_VLC3 - ModelDFSL_VLC3$MGrowth_BIO_VLC3 - ModelDFSL_VLC3$MGrowth_HUM_VLC3
ModelDFSL_VLC3$Accum_CCO2_VLC3 <- ModelDFSL_VLC3$AccumInput_VLC3 - ModelDFSL_VLC3$AllPools_noIOM_VLC3

#Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
ModelDFSL_VLC3$M_CCO2_VLC3[1] <- 0
ModelDFSL_VLC3$Accum_CCO2_VLC3[1] <- 0

#Balance validation
ModelDFSL_VLC3$Balance_VLC3 <- ModelDFSL_VLC3$AccumInput_VLC3 - ModelDFSL_VLC3$Accum_CCO2_VLC3 - (ModelDFSL_VLC3$DPM_VLC3 + ModelDFSL_VLC3$RPM_VLC3 + ModelDFSL_VLC3$BIO_VLC3 + ModelDFSL_VLC3$HUM_VLC3)

#Convert C-CO2 emissions into CO2 emissions
ModelDFSL_VLC3$M_CO2_VLC3 <- ModelDFSL_VLC3$M_CCO2_VLC3 * 44/12
ModelDFSL_VLC3$Accum_CO2_VLC3 <- ModelDFSL_VLC3$Accum_CCO2_VLC3 * 44/12

#This model will be called VLC3C because implies a continuous input of C
ModelDFSL_VLC3C <- ModelDFSL_VLC3

#Export the dataframe
write_xlsx(ModelDFSL_VLC3C,"VXC_Models\\ModelDFSL_R_VLC3C.xlsx")

#Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
#Create two equal models by using the above general script
#Create model t=x
ModelDFSLt0_VLC3 <- ModelDFSL_VLC3 #Create model t=x

#Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
ModelDFSLt1_VLC3.1 <- rbind(c(0:0), ModelDFSLt0_VLC3)
ModelDFSLt1_VLC3.2 <- rbind(c(0:0), ModelDFSLt1_VLC3.1)
ModelDFSLt1_VLC3.3 <- rbind(c(0:0), ModelDFSLt1_VLC3.2)
ModelDFSLt1_VLC3.4 <- rbind(c(0:0), ModelDFSLt1_VLC3.3)
ModelDFSLt1_VLC3.5 <- rbind(c(0:0), ModelDFSLt1_VLC3.4)
ModelDFSLt1_VLC3.6 <- rbind(c(0:0), ModelDFSLt1_VLC3.5)
ModelDFSLt1_VLC3.7 <- rbind(c(0:0), ModelDFSLt1_VLC3.6)
ModelDFSLt1_VLC3.8 <- rbind(c(0:0), ModelDFSLt1_VLC3.7)
ModelDFSLt1_VLC3.9 <- rbind(c(0:0), ModelDFSLt1_VLC3.8)
ModelDFSLt1_VLC3.10 <- rbind(c(0:0), ModelDFSLt1_VLC3.9)
ModelDFSLt1_VLC3.11 <- rbind(c(0:0), ModelDFSLt1_VLC3.10)
ModelDFSLt1_VLC3.12 <- rbind(c(0:0), ModelDFSLt1_VLC3.11)
ModelDFSLt1_VLC3.13 <- ModelDFSLt1_VLC3.12[-nrow(ModelDFSLt1_VLC3.12),]
ModelDFSLt1_VLC3.14 <- ModelDFSLt1_VLC3.13[-nrow(ModelDFSLt1_VLC3.13),]
ModelDFSLt1_VLC3.15 <- ModelDFSLt1_VLC3.14[-nrow(ModelDFSLt1_VLC3.14),]
ModelDFSLt1_VLC3.16 <- ModelDFSLt1_VLC3.15[-nrow(ModelDFSLt1_VLC3.15),]
ModelDFSLt1_VLC3.17 <- ModelDFSLt1_VLC3.16[-nrow(ModelDFSLt1_VLC3.16),]
ModelDFSLt1_VLC3.18 <- ModelDFSLt1_VLC3.17[-nrow(ModelDFSLt1_VLC3.17),]
ModelDFSLt1_VLC3.19 <- ModelDFSLt1_VLC3.18[-nrow(ModelDFSLt1_VLC3.18),]
ModelDFSLt1_VLC3.20 <- ModelDFSLt1_VLC3.19[-nrow(ModelDFSLt1_VLC3.19),]
ModelDFSLt1_VLC3.21 <- ModelDFSLt1_VLC3.20[-nrow(ModelDFSLt1_VLC3.20),]
ModelDFSLt1_VLC3.22 <- ModelDFSLt1_VLC3.21[-nrow(ModelDFSLt1_VLC3.21),]
ModelDFSLt1_VLC3.23 <- ModelDFSLt1_VLC3.22[-nrow(ModelDFSLt1_VLC3.22),]
ModelDFSLt1_VLC3.24 <- ModelDFSLt1_VLC3.23[-nrow(ModelDFSLt1_VLC3.23),]

ModelDFSLt1_VLC3 <- ModelDFSLt1_VLC3.24 #Create model t=x+1

#Subtract model (t=x) - (t=x+1)
ModelDFSL1y_VLC3 <- ModelDFSLt0_VLC3 - ModelDFSLt1_VLC3

#Re-do Month Number column because the substraction was also applied to it
ModelDFSL1y_VLC3$MNumber <- seq(from = 1, to = SimulationLength_months)

#This model will be called VLC3P because implies a one-off input of C
ModelDFSL_VLC3P <- ModelDFSL1y_VLC3

#Export the dataframe
write_xlsx(ModelDFSL_VLC3P,"VXP_Models\\ModelDFSL_R_VLC3P.xlsx")

#Plot 3: Interactive Yearly CO2 emissions #
MY <- 12
ModelDFSL_VLC3P_YCO2 <- ModelDFSL_VLC3P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VLC3)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLC3P_YCO2) <- c("Year", "Months", "AnnualCO2_VLC_3")

#Plot 3: Interactive Yearly CO2 emissions considering a delay
GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
ModelDFSL_VLC3P_YCO2D <- merge(ModelDFSL_VLC3P_YCO2, GWP100delay, by = "Year")
ModelDFSL_VLC3P_YCO2D$AnnualCO2D_VLC_3 <- ModelDFSL_VLC3P_YCO2D$AnnualCO2_VLC_3 * ModelDFSL_VLC3P_YCO2D$GWP100

#Plot 4: Interactive Yearly C emissions #
MY <- 12
ModelDFSL_VLC3P_YC <- ModelDFSL_VLC3P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VLC3)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLC3P_YC) <- c("Year", "Months", "CEmissions_VLC_3")

#Plot 5: Interactive Yearly C tails (remaining C in Soil) #
MY <- 12
ModelDFSL_VLC3P_YCT <- ModelDFSL_VLC3P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VLC3)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLC3P_YCT) <- c("Year", "Months", "CTail_VLC_3")

#Save Dataframes for Plots 3.1, 3.2, 4 and 5
write_xlsx(ModelDFSL_VLC3P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VLC3P.xlsx") #Yearly CO2 emissions (no delay)
write_xlsx(ModelDFSL_VLC3P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VLC3P.xlsx") #Yearly CO2 emissions (delay)
write_xlsx(ModelDFSL_VLC3P_YC,"CEmissions_P\\ModelDFSL_R_CE_VLC3P.xlsx") #Yearly C emissions
write_xlsx(ModelDFSL_VLC3P_YCT,"CTails_P\\ModelDFSL_R_CT_VLC3P.xlsx") #Yearly C emissions



#### 7.5 - VLC4) Litter; 40%clay; Conventional tillage ####
#The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
fT_VLC4=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
fW_VLC4=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
               S.Thick = soil.thick, pClay = clay100*0.4,
               pE = 1.0, bare = FALSE)$b #Moisture effects per month
xi.frame_VLC4=data.frame(years,rep(fT_VLC4*fW_VLC4,length.out=length(years)))

#To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
Model_VLC4=SoilR::RothCModel(
  t=years, #Simulation Length
  ks=c(k.DPM = 10*CTRM, k.RPM = 0.3*CTRM, k.BIO = 0.66*CTRM, k.HUM = 0.02*CTRM, k.IOM = 0*CTRM), #Decomposition rates for the different pools
  C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
  In=Scalar_LitterCinputs*1, #Amount of litter inputs by time
  FYM = Scalar_ManureCinputs*0, #Amount of Farm Yard Manure by time
  clay=clay100*0.4, #Percent clay in mineral soil
  xi=xi.frame_VLC4) #Loads the model

Ct_VLC4=getC(Model_VLC4) #Calculates stocks for each pool per month

#The results can be plotted with the commands
matplot(years, Ct_VLC4, type="l", lty=1, col=1:5,
        xlab="Time (years)", ylab="C stocks (Mg/ha)")
legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
       lty=1, col=1:5, bty="n")

VEC_Lit_VLC4 <- rep(M_Scalar_LitterCinputs*1, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
VEC_Man_VLC4 <- rep(M_Scalar_ManureCinputs*0, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

VEC_LitDF_VLC4 <- as.data.frame(VEC_Lit_VLC4) #Converting the Litter vector to a data frame
VEC_LitDF_VLC4$MNumber <- seq(from = 1, to = SimulationLength_months)
VEC_ManDF_VLC4 <- as.data.frame(VEC_Man_VLC4) #Converting the Manure vector to a data frame
VEC_ManDF_VLC4$MNumber <- seq(from = 1, to = SimulationLength_months)

sapply(VEC_LitDF_VLC4, class) #Check that class is numeric
sapply(VEC_ManDF_VLC4, class) #Check that class is numeric
LitterCinputs_VLC4=VEC_LitDF_VLC4   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
ManureCinputs_VLC4=VEC_ManDF_VLC4 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
MCinputs_VLC4 <- merge(LitterCinputs_VLC4, ManureCinputs_VLC4, by = "MNumber")
MCinputs_VLC4$MInput_VLC4 <- MCinputs_VLC4$VEC_Lit_VLC4 + MCinputs_VLC4$VEC_Man_VLC4

#Change names of litter and manure columns for more common ones
colnames(MCinputs_VLC4)[which(names(MCinputs_VLC4) == "VEC_Lit_VLC4")] <- "LitterC_VLC4"
colnames(MCinputs_VLC4)[which(names(MCinputs_VLC4) == "VEC_Man_VLC4")] <- "ManureC_VLC4"

#Create a dataframe with the data considering the simulation length
ModelDF_VLC4 <- as.data.frame(Ct_VLC4)
colnames(ModelDF_VLC4) <- c('DPM_VLC4','RPM_VLC4','BIO_VLC4', 'HUM_VLC4', 'IOM_VLC4')
ModelDFS_VLC4 <- ModelDF_VLC4[1:SimulationLength_months, ]

#Create a column with the number of month of analysis
ModelDFS_VLC4$MNumber <- seq(from = 1, to = SimulationLength_months)

#Create a column that sums all pools
ModelDFS_VLC4$AllPools_VLC4 <- ModelDFS_VLC4$DPM_VLC4 + ModelDFS_VLC4$RPM_VLC4 + ModelDFS_VLC4$BIO_VLC4 + ModelDFS_VLC4$HUM_VLC4 + ModelDFS_VLC4$IOM_VLC4

#Create a column that sums all pools except IOM (static)
ModelDFS_VLC4$AllPools_noIOM_VLC4 <- ModelDFS_VLC4$DPM_VLC4 + ModelDFS_VLC4$RPM_VLC4 + ModelDFS_VLC4$BIO_VLC4 + ModelDFS_VLC4$HUM_VLC4

#Create a column that add the monthly input of C (manure and litter separately)
ModelDFSL_VLC4 <- merge(ModelDFS_VLC4, MCinputs_VLC4, by = "MNumber")

ModelDFSL_VLC4$MInput_VLC4 <- ModelDFSL_VLC4$LitterC_VLC4 + ModelDFSL_VLC4$ManureC_VLC4
#ModelDF_SL$MInput[1] <- 0

#Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
ModelDFSL_VLC4$CTails_VLC4 <- ModelDFSL_VLC4$AllPools_noIOM_VLC4 + ModelDFSL_VLC4$MInput_VLC4

#Create Monthly Accumulated input of C
ModelDFSL_VLC4$AccumInput_VLC4 = ModelDFSL_VLC4$AccumInput_VLC4=cumsum(ModelDFSL_VLC4$MInput_VLC4)

#Create Monthly Growths for each carbon pool
ModelDFSL_VLC4$MGrowth_DPM_VLC4 <- ave(ModelDFSL_VLC4$DPM_VLC4, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLC4$MGrowth_RPM_VLC4 <- ave(ModelDFSL_VLC4$RPM_VLC4, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLC4$MGrowth_BIO_VLC4 <- ave(ModelDFSL_VLC4$BIO_VLC4, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLC4$MGrowth_HUM_VLC4 <- ave(ModelDFSL_VLC4$HUM_VLC4, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLC4$MGrowth_IOM_VLC4 <- ave(ModelDFSL_VLC4$IOM_VLC4, FUN = function(x) c(0, diff(x)))

#Create column for Monthly and Accumulated C-CO2 emissions
ModelDFSL_VLC4$M_CCO2_VLC4 <- ModelDFSL_VLC4$MInput_VLC4 - ModelDFSL_VLC4$MGrowth_DPM_VLC4 - ModelDFSL_VLC4$MGrowth_RPM_VLC4 - ModelDFSL_VLC4$MGrowth_BIO_VLC4 - ModelDFSL_VLC4$MGrowth_HUM_VLC4
ModelDFSL_VLC4$Accum_CCO2_VLC4 <- ModelDFSL_VLC4$AccumInput_VLC4 - ModelDFSL_VLC4$AllPools_noIOM_VLC4

#Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
ModelDFSL_VLC4$M_CCO2_VLC4[1] <- 0
ModelDFSL_VLC4$Accum_CCO2_VLC4[1] <- 0

#Balance validation
ModelDFSL_VLC4$Balance_VLC4 <- ModelDFSL_VLC4$AccumInput_VLC4 - ModelDFSL_VLC4$Accum_CCO2_VLC4 - (ModelDFSL_VLC4$DPM_VLC4 + ModelDFSL_VLC4$RPM_VLC4 + ModelDFSL_VLC4$BIO_VLC4 + ModelDFSL_VLC4$HUM_VLC4)

#Convert C-CO2 emissions into CO2 emissions
ModelDFSL_VLC4$M_CO2_VLC4 <- ModelDFSL_VLC4$M_CCO2_VLC4 * 44/12
ModelDFSL_VLC4$Accum_CO2_VLC4 <- ModelDFSL_VLC4$Accum_CCO2_VLC4 * 44/12

#This model will be called VLC4C because implies a continuous input of C
ModelDFSL_VLC4C <- ModelDFSL_VLC4

#Export the dataframe
write_xlsx(ModelDFSL_VLC4C,"VXC_Models\\ModelDFSL_R_VLC4C.xlsx")

#Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
#Create two equal models by using the above general script
#Create model t=x
ModelDFSLt0_VLC4 <- ModelDFSL_VLC4 #Create model t=x

#Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
ModelDFSLt1_VLC4.1 <- rbind(c(0:0), ModelDFSLt0_VLC4)
ModelDFSLt1_VLC4.2 <- rbind(c(0:0), ModelDFSLt1_VLC4.1)
ModelDFSLt1_VLC4.3 <- rbind(c(0:0), ModelDFSLt1_VLC4.2)
ModelDFSLt1_VLC4.4 <- rbind(c(0:0), ModelDFSLt1_VLC4.3)
ModelDFSLt1_VLC4.5 <- rbind(c(0:0), ModelDFSLt1_VLC4.4)
ModelDFSLt1_VLC4.6 <- rbind(c(0:0), ModelDFSLt1_VLC4.5)
ModelDFSLt1_VLC4.7 <- rbind(c(0:0), ModelDFSLt1_VLC4.6)
ModelDFSLt1_VLC4.8 <- rbind(c(0:0), ModelDFSLt1_VLC4.7)
ModelDFSLt1_VLC4.9 <- rbind(c(0:0), ModelDFSLt1_VLC4.8)
ModelDFSLt1_VLC4.10 <- rbind(c(0:0), ModelDFSLt1_VLC4.9)
ModelDFSLt1_VLC4.11 <- rbind(c(0:0), ModelDFSLt1_VLC4.10)
ModelDFSLt1_VLC4.12 <- rbind(c(0:0), ModelDFSLt1_VLC4.11)
ModelDFSLt1_VLC4.13 <- ModelDFSLt1_VLC4.12[-nrow(ModelDFSLt1_VLC4.12),]
ModelDFSLt1_VLC4.14 <- ModelDFSLt1_VLC4.13[-nrow(ModelDFSLt1_VLC4.13),]
ModelDFSLt1_VLC4.15 <- ModelDFSLt1_VLC4.14[-nrow(ModelDFSLt1_VLC4.14),]
ModelDFSLt1_VLC4.16 <- ModelDFSLt1_VLC4.15[-nrow(ModelDFSLt1_VLC4.15),]
ModelDFSLt1_VLC4.17 <- ModelDFSLt1_VLC4.16[-nrow(ModelDFSLt1_VLC4.16),]
ModelDFSLt1_VLC4.18 <- ModelDFSLt1_VLC4.17[-nrow(ModelDFSLt1_VLC4.17),]
ModelDFSLt1_VLC4.19 <- ModelDFSLt1_VLC4.18[-nrow(ModelDFSLt1_VLC4.18),]
ModelDFSLt1_VLC4.20 <- ModelDFSLt1_VLC4.19[-nrow(ModelDFSLt1_VLC4.19),]
ModelDFSLt1_VLC4.21 <- ModelDFSLt1_VLC4.20[-nrow(ModelDFSLt1_VLC4.20),]
ModelDFSLt1_VLC4.22 <- ModelDFSLt1_VLC4.21[-nrow(ModelDFSLt1_VLC4.21),]
ModelDFSLt1_VLC4.23 <- ModelDFSLt1_VLC4.22[-nrow(ModelDFSLt1_VLC4.22),]
ModelDFSLt1_VLC4.24 <- ModelDFSLt1_VLC4.23[-nrow(ModelDFSLt1_VLC4.23),]

ModelDFSLt1_VLC4 <- ModelDFSLt1_VLC4.24 #Create model t=x+1

#Subtract model (t=x) - (t=x+1)
ModelDFSL1y_VLC4 <- ModelDFSLt0_VLC4 - ModelDFSLt1_VLC4

#Re-do Month Number column because the substraction was also applied to it
ModelDFSL1y_VLC4$MNumber <- seq(from = 1, to = SimulationLength_months)

#This model will be called VLC4P because implies a one-off input of C
ModelDFSL_VLC4P <- ModelDFSL1y_VLC4

#Export the dataframe
write_xlsx(ModelDFSL_VLC4P,"VXP_Models\\ModelDFSL_R_VLC4P.xlsx")

#Plot 3: Interactive Yearly CO2 emissions #
MY <- 12
ModelDFSL_VLC4P_YCO2 <- ModelDFSL_VLC4P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VLC4)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLC4P_YCO2) <- c("Year", "Months", "AnnualCO2_VLC_4")

#Plot 3: Interactive Yearly CO2 emissions considering a delay
GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
ModelDFSL_VLC4P_YCO2D <- merge(ModelDFSL_VLC4P_YCO2, GWP100delay, by = "Year")
ModelDFSL_VLC4P_YCO2D$AnnualCO2D_VLC_4 <- ModelDFSL_VLC4P_YCO2D$AnnualCO2_VLC_4 * ModelDFSL_VLC4P_YCO2D$GWP100

#Plot 4: Interactive Yearly C emissions #
MY <- 12
ModelDFSL_VLC4P_YC <- ModelDFSL_VLC4P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VLC4)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLC4P_YC) <- c("Year", "Months", "CEmissions_VLC_4")

#Plot 5: Interactive Yearly C tails (remaining C in Soil) #
MY <- 12
ModelDFSL_VLC4P_YCT <- ModelDFSL_VLC4P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VLC4)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLC4P_YCT) <- c("Year", "Months", "CTail_VLC_4")

#Save Dataframes for Plots 3.1, 3.2, 4 and 5
write_xlsx(ModelDFSL_VLC4P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VLC4P.xlsx") #Yearly CO2 emissions (no delay)
write_xlsx(ModelDFSL_VLC4P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VLC4P.xlsx") #Yearly CO2 emissions (delay)
write_xlsx(ModelDFSL_VLC4P_YC,"CEmissions_P\\ModelDFSL_R_CE_VLC4P.xlsx") #Yearly C emissions
write_xlsx(ModelDFSL_VLC4P_YCT,"CTails_P\\ModelDFSL_R_CT_VLC4P.xlsx") #Yearly C emissions



#### 7.6 - VLC5) Litter; 50%clay; Conventional tillage ####
#The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
fT_VLC5=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
fW_VLC5=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
               S.Thick = soil.thick, pClay = clay100*0.5,
               pE = 1.0, bare = FALSE)$b #Moisture effects per month
xi.frame_VLC5=data.frame(years,rep(fT_VLC5*fW_VLC5,length.out=length(years)))

#To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
Model_VLC5=SoilR::RothCModel(
  t=years, #Simulation Length
  ks=c(k.DPM = 10*CTRM, k.RPM = 0.3*CTRM, k.BIO = 0.66*CTRM, k.HUM = 0.02*CTRM, k.IOM = 0*CTRM), #Decomposition rates for the different pools
  C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
  In=Scalar_LitterCinputs*1, #Amount of litter inputs by time
  FYM = Scalar_ManureCinputs*0, #Amount of Farm Yard Manure by time
  clay=clay100*0.5, #Percent clay in mineral soil
  xi=xi.frame_VLC5) #Loads the model

Ct_VLC5=getC(Model_VLC5) #Calculates stocks for each pool per month

#The results can be plotted with the commands
matplot(years, Ct_VLC5, type="l", lty=1, col=1:5,
        xlab="Time (years)", ylab="C stocks (Mg/ha)")
legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
       lty=1, col=1:5, bty="n")

VEC_Lit_VLC5 <- rep(M_Scalar_LitterCinputs*1, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
VEC_Man_VLC5 <- rep(M_Scalar_ManureCinputs*0, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

VEC_LitDF_VLC5 <- as.data.frame(VEC_Lit_VLC5) #Converting the Litter vector to a data frame
VEC_LitDF_VLC5$MNumber <- seq(from = 1, to = SimulationLength_months)
VEC_ManDF_VLC5 <- as.data.frame(VEC_Man_VLC5) #Converting the Manure vector to a data frame
VEC_ManDF_VLC5$MNumber <- seq(from = 1, to = SimulationLength_months)

sapply(VEC_LitDF_VLC5, class) #Check that class is numeric
sapply(VEC_ManDF_VLC5, class) #Check that class is numeric
LitterCinputs_VLC5=VEC_LitDF_VLC5   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
ManureCinputs_VLC5=VEC_ManDF_VLC5 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
MCinputs_VLC5 <- merge(LitterCinputs_VLC5, ManureCinputs_VLC5, by = "MNumber")
MCinputs_VLC5$MInput_VLC5 <- MCinputs_VLC5$VEC_Lit_VLC5 + MCinputs_VLC5$VEC_Man_VLC5

#Change names of litter and manure columns for more common ones
colnames(MCinputs_VLC5)[which(names(MCinputs_VLC5) == "VEC_Lit_VLC5")] <- "LitterC_VLC5"
colnames(MCinputs_VLC5)[which(names(MCinputs_VLC5) == "VEC_Man_VLC5")] <- "ManureC_VLC5"

#Create a dataframe with the data considering the simulation length
ModelDF_VLC5 <- as.data.frame(Ct_VLC5)
colnames(ModelDF_VLC5) <- c('DPM_VLC5','RPM_VLC5','BIO_VLC5', 'HUM_VLC5', 'IOM_VLC5')
ModelDFS_VLC5 <- ModelDF_VLC5[1:SimulationLength_months, ]

#Create a column with the number of month of analysis
ModelDFS_VLC5$MNumber <- seq(from = 1, to = SimulationLength_months)

#Create a column that sums all pools
ModelDFS_VLC5$AllPools_VLC5 <- ModelDFS_VLC5$DPM_VLC5 + ModelDFS_VLC5$RPM_VLC5 + ModelDFS_VLC5$BIO_VLC5 + ModelDFS_VLC5$HUM_VLC5 + ModelDFS_VLC5$IOM_VLC5

#Create a column that sums all pools except IOM (static)
ModelDFS_VLC5$AllPools_noIOM_VLC5 <- ModelDFS_VLC5$DPM_VLC5 + ModelDFS_VLC5$RPM_VLC5 + ModelDFS_VLC5$BIO_VLC5 + ModelDFS_VLC5$HUM_VLC5

#Create a column that add the monthly input of C (manure and litter separately)
ModelDFSL_VLC5 <- merge(ModelDFS_VLC5, MCinputs_VLC5, by = "MNumber")

ModelDFSL_VLC5$MInput_VLC5 <- ModelDFSL_VLC5$LitterC_VLC5 + ModelDFSL_VLC5$ManureC_VLC5
#ModelDF_SL$MInput[1] <- 0

#Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
ModelDFSL_VLC5$CTails_VLC5 <- ModelDFSL_VLC5$AllPools_noIOM_VLC5 + ModelDFSL_VLC5$MInput_VLC5

#Create Monthly Accumulated input of C
ModelDFSL_VLC5$AccumInput_VLC5 = ModelDFSL_VLC5$AccumInput_VLC5=cumsum(ModelDFSL_VLC5$MInput_VLC5)

#Create Monthly Growths for each carbon pool
ModelDFSL_VLC5$MGrowth_DPM_VLC5 <- ave(ModelDFSL_VLC5$DPM_VLC5, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLC5$MGrowth_RPM_VLC5 <- ave(ModelDFSL_VLC5$RPM_VLC5, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLC5$MGrowth_BIO_VLC5 <- ave(ModelDFSL_VLC5$BIO_VLC5, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLC5$MGrowth_HUM_VLC5 <- ave(ModelDFSL_VLC5$HUM_VLC5, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLC5$MGrowth_IOM_VLC5 <- ave(ModelDFSL_VLC5$IOM_VLC5, FUN = function(x) c(0, diff(x)))

#Create column for Monthly and Accumulated C-CO2 emissions
ModelDFSL_VLC5$M_CCO2_VLC5 <- ModelDFSL_VLC5$MInput_VLC5 - ModelDFSL_VLC5$MGrowth_DPM_VLC5 - ModelDFSL_VLC5$MGrowth_RPM_VLC5 - ModelDFSL_VLC5$MGrowth_BIO_VLC5 - ModelDFSL_VLC5$MGrowth_HUM_VLC5
ModelDFSL_VLC5$Accum_CCO2_VLC5 <- ModelDFSL_VLC5$AccumInput_VLC5 - ModelDFSL_VLC5$AllPools_noIOM_VLC5

#Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
ModelDFSL_VLC5$M_CCO2_VLC5[1] <- 0
ModelDFSL_VLC5$Accum_CCO2_VLC5[1] <- 0

#Balance validation
ModelDFSL_VLC5$Balance_VLC5 <- ModelDFSL_VLC5$AccumInput_VLC5 - ModelDFSL_VLC5$Accum_CCO2_VLC5 - (ModelDFSL_VLC5$DPM_VLC5 + ModelDFSL_VLC5$RPM_VLC5 + ModelDFSL_VLC5$BIO_VLC5 + ModelDFSL_VLC5$HUM_VLC5)

#Convert C-CO2 emissions into CO2 emissions
ModelDFSL_VLC5$M_CO2_VLC5 <- ModelDFSL_VLC5$M_CCO2_VLC5 * 44/12
ModelDFSL_VLC5$Accum_CO2_VLC5 <- ModelDFSL_VLC5$Accum_CCO2_VLC5 * 44/12

#This model will be called VLC5C because implies a continuous input of C
ModelDFSL_VLC5C <- ModelDFSL_VLC5

#Export the dataframe
write_xlsx(ModelDFSL_VLC5C,"VXC_Models\\ModelDFSL_R_VLC5C.xlsx")

#Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
#Create two equal models by using the above general script
#Create model t=x
ModelDFSLt0_VLC5 <- ModelDFSL_VLC5 #Create model t=x

#Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
ModelDFSLt1_VLC5.1 <- rbind(c(0:0), ModelDFSLt0_VLC5)
ModelDFSLt1_VLC5.2 <- rbind(c(0:0), ModelDFSLt1_VLC5.1)
ModelDFSLt1_VLC5.3 <- rbind(c(0:0), ModelDFSLt1_VLC5.2)
ModelDFSLt1_VLC5.4 <- rbind(c(0:0), ModelDFSLt1_VLC5.3)
ModelDFSLt1_VLC5.5 <- rbind(c(0:0), ModelDFSLt1_VLC5.4)
ModelDFSLt1_VLC5.6 <- rbind(c(0:0), ModelDFSLt1_VLC5.5)
ModelDFSLt1_VLC5.7 <- rbind(c(0:0), ModelDFSLt1_VLC5.6)
ModelDFSLt1_VLC5.8 <- rbind(c(0:0), ModelDFSLt1_VLC5.7)
ModelDFSLt1_VLC5.9 <- rbind(c(0:0), ModelDFSLt1_VLC5.8)
ModelDFSLt1_VLC5.10 <- rbind(c(0:0), ModelDFSLt1_VLC5.9)
ModelDFSLt1_VLC5.11 <- rbind(c(0:0), ModelDFSLt1_VLC5.10)
ModelDFSLt1_VLC5.12 <- rbind(c(0:0), ModelDFSLt1_VLC5.11)
ModelDFSLt1_VLC5.13 <- ModelDFSLt1_VLC5.12[-nrow(ModelDFSLt1_VLC5.12),]
ModelDFSLt1_VLC5.14 <- ModelDFSLt1_VLC5.13[-nrow(ModelDFSLt1_VLC5.13),]
ModelDFSLt1_VLC5.15 <- ModelDFSLt1_VLC5.14[-nrow(ModelDFSLt1_VLC5.14),]
ModelDFSLt1_VLC5.16 <- ModelDFSLt1_VLC5.15[-nrow(ModelDFSLt1_VLC5.15),]
ModelDFSLt1_VLC5.17 <- ModelDFSLt1_VLC5.16[-nrow(ModelDFSLt1_VLC5.16),]
ModelDFSLt1_VLC5.18 <- ModelDFSLt1_VLC5.17[-nrow(ModelDFSLt1_VLC5.17),]
ModelDFSLt1_VLC5.19 <- ModelDFSLt1_VLC5.18[-nrow(ModelDFSLt1_VLC5.18),]
ModelDFSLt1_VLC5.20 <- ModelDFSLt1_VLC5.19[-nrow(ModelDFSLt1_VLC5.19),]
ModelDFSLt1_VLC5.21 <- ModelDFSLt1_VLC5.20[-nrow(ModelDFSLt1_VLC5.20),]
ModelDFSLt1_VLC5.22 <- ModelDFSLt1_VLC5.21[-nrow(ModelDFSLt1_VLC5.21),]
ModelDFSLt1_VLC5.23 <- ModelDFSLt1_VLC5.22[-nrow(ModelDFSLt1_VLC5.22),]
ModelDFSLt1_VLC5.24 <- ModelDFSLt1_VLC5.23[-nrow(ModelDFSLt1_VLC5.23),]

ModelDFSLt1_VLC5 <- ModelDFSLt1_VLC5.24 #Create model t=x+1

#Subtract model (t=x) - (t=x+1)
ModelDFSL1y_VLC5 <- ModelDFSLt0_VLC5 - ModelDFSLt1_VLC5

#Re-do Month Number column because the substraction was also applied to it
ModelDFSL1y_VLC5$MNumber <- seq(from = 1, to = SimulationLength_months)

#This model will be called VLC5P because implies a one-off input of C
ModelDFSL_VLC5P <- ModelDFSL1y_VLC5

#Export the dataframe
write_xlsx(ModelDFSL_VLC5P,"VXP_Models\\ModelDFSL_R_VLC5P.xlsx")


#Plot 3: Interactive Yearly CO2 emissions #
MY <- 12
ModelDFSL_VLC5P_YCO2 <- ModelDFSL_VLC5P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VLC5)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLC5P_YCO2) <- c("Year", "Months", "AnnualCO2_VLC_5")


#Plot 3: Interactive Yearly CO2 emissions considering a delay
GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
ModelDFSL_VLC5P_YCO2D <- merge(ModelDFSL_VLC5P_YCO2, GWP100delay, by = "Year")
ModelDFSL_VLC5P_YCO2D$AnnualCO2D_VLC_5 <- ModelDFSL_VLC5P_YCO2D$AnnualCO2_VLC_5 * ModelDFSL_VLC5P_YCO2D$GWP100

#Plot 4: Interactive Yearly C emissions #
MY <- 12
ModelDFSL_VLC5P_YC <- ModelDFSL_VLC5P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VLC5)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLC5P_YC) <- c("Year", "Months", "CEmissions_VLC_5")


#Plot 5: Interactive Yearly C tails (remaining C in Soil) #
MY <- 12
ModelDFSL_VLC5P_YCT <- ModelDFSL_VLC5P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VLC5)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLC5P_YCT) <- c("Year", "Months", "CTail_VLC_5")

#Save Dataframes for Plots 3.1, 3.2, 4 and 5
write_xlsx(ModelDFSL_VLC5P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VLC5P.xlsx") #Yearly CO2 emissions (no delay)
write_xlsx(ModelDFSL_VLC5P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VLC5P.xlsx") #Yearly CO2 emissions (delay)
write_xlsx(ModelDFSL_VLC5P_YC,"CEmissions_P\\ModelDFSL_R_CE_VLC5P.xlsx") #Yearly C emissions
write_xlsx(ModelDFSL_VLC5P_YCT,"CTails_P\\ModelDFSL_R_CT_VLC5P.xlsx") #Yearly C emissions



#### 7.7 - VLC6) Litter; 60%clay; Conventional tillage ####
#The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
fT_VLC6=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
fW_VLC6=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
               S.Thick = soil.thick, pClay = clay100*0.6,
               pE = 1.0, bare = FALSE)$b #Moisture effects per month
xi.frame_VLC6=data.frame(years,rep(fT_VLC6*fW_VLC6,length.out=length(years)))

#To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
Model_VLC6=SoilR::RothCModel(
  t=years, #Simulation Length
  ks=c(k.DPM = 10*CTRM, k.RPM = 0.3*CTRM, k.BIO = 0.66*CTRM, k.HUM = 0.02*CTRM, k.IOM = 0*CTRM), #Decomposition rates for the different pools
  C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
  In=Scalar_LitterCinputs*1, #Amount of litter inputs by time
  FYM = Scalar_ManureCinputs*0, #Amount of Farm Yard Manure by time
  clay=clay100*0.6, #Percent clay in mineral soil
  xi=xi.frame_VLC6) #Loads the model

Ct_VLC6=getC(Model_VLC6) #Calculates stocks for each pool per month

#The results can be plotted with the commands
matplot(years, Ct_VLC6, type="l", lty=1, col=1:5,
        xlab="Time (years)", ylab="C stocks (Mg/ha)")
legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
       lty=1, col=1:5, bty="n")

VEC_Lit_VLC6 <- rep(M_Scalar_LitterCinputs*1, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
VEC_Man_VLC6 <- rep(M_Scalar_ManureCinputs*0, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

VEC_LitDF_VLC6 <- as.data.frame(VEC_Lit_VLC6) #Converting the Litter vector to a data frame
VEC_LitDF_VLC6$MNumber <- seq(from = 1, to = SimulationLength_months)
VEC_ManDF_VLC6 <- as.data.frame(VEC_Man_VLC6) #Converting the Manure vector to a data frame
VEC_ManDF_VLC6$MNumber <- seq(from = 1, to = SimulationLength_months)

sapply(VEC_LitDF_VLC6, class) #Check that class is numeric
sapply(VEC_ManDF_VLC6, class) #Check that class is numeric
LitterCinputs_VLC6=VEC_LitDF_VLC6   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
ManureCinputs_VLC6=VEC_ManDF_VLC6 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
MCinputs_VLC6 <- merge(LitterCinputs_VLC6, ManureCinputs_VLC6, by = "MNumber")
MCinputs_VLC6$MInput_VLC6 <- MCinputs_VLC6$VEC_Lit_VLC6 + MCinputs_VLC6$VEC_Man_VLC6

#Change names of litter and manure columns for more common ones
colnames(MCinputs_VLC6)[which(names(MCinputs_VLC6) == "VEC_Lit_VLC6")] <- "LitterC_VLC6"
colnames(MCinputs_VLC6)[which(names(MCinputs_VLC6) == "VEC_Man_VLC6")] <- "ManureC_VLC6"

#Create a dataframe with the data considering the simulation length
ModelDF_VLC6 <- as.data.frame(Ct_VLC6)
colnames(ModelDF_VLC6) <- c('DPM_VLC6','RPM_VLC6','BIO_VLC6', 'HUM_VLC6', 'IOM_VLC6')
ModelDFS_VLC6 <- ModelDF_VLC6[1:SimulationLength_months, ]

#Create a column with the number of month of analysis
ModelDFS_VLC6$MNumber <- seq(from = 1, to = SimulationLength_months)

#Create a column that sums all pools
ModelDFS_VLC6$AllPools_VLC6 <- ModelDFS_VLC6$DPM_VLC6 + ModelDFS_VLC6$RPM_VLC6 + ModelDFS_VLC6$BIO_VLC6 + ModelDFS_VLC6$HUM_VLC6 + ModelDFS_VLC6$IOM_VLC6

#Create a column that sums all pools except IOM (static)
ModelDFS_VLC6$AllPools_noIOM_VLC6 <- ModelDFS_VLC6$DPM_VLC6 + ModelDFS_VLC6$RPM_VLC6 + ModelDFS_VLC6$BIO_VLC6 + ModelDFS_VLC6$HUM_VLC6

#Create a column that add the monthly input of C (manure and litter separately)
ModelDFSL_VLC6 <- merge(ModelDFS_VLC6, MCinputs_VLC6, by = "MNumber")

ModelDFSL_VLC6$MInput_VLC6 <- ModelDFSL_VLC6$LitterC_VLC6 + ModelDFSL_VLC6$ManureC_VLC6
#ModelDF_SL$MInput[1] <- 0

#Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
ModelDFSL_VLC6$CTails_VLC6 <- ModelDFSL_VLC6$AllPools_noIOM_VLC6 + ModelDFSL_VLC6$MInput_VLC6

#Create Monthly Accumulated input of C
ModelDFSL_VLC6$AccumInput_VLC6 = ModelDFSL_VLC6$AccumInput_VLC6=cumsum(ModelDFSL_VLC6$MInput_VLC6)

#Create Monthly Growths for each carbon pool
ModelDFSL_VLC6$MGrowth_DPM_VLC6 <- ave(ModelDFSL_VLC6$DPM_VLC6, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLC6$MGrowth_RPM_VLC6 <- ave(ModelDFSL_VLC6$RPM_VLC6, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLC6$MGrowth_BIO_VLC6 <- ave(ModelDFSL_VLC6$BIO_VLC6, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLC6$MGrowth_HUM_VLC6 <- ave(ModelDFSL_VLC6$HUM_VLC6, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLC6$MGrowth_IOM_VLC6 <- ave(ModelDFSL_VLC6$IOM_VLC6, FUN = function(x) c(0, diff(x)))

#Create column for Monthly and Accumulated C-CO2 emissions
ModelDFSL_VLC6$M_CCO2_VLC6 <- ModelDFSL_VLC6$MInput_VLC6 - ModelDFSL_VLC6$MGrowth_DPM_VLC6 - ModelDFSL_VLC6$MGrowth_RPM_VLC6 - ModelDFSL_VLC6$MGrowth_BIO_VLC6 - ModelDFSL_VLC6$MGrowth_HUM_VLC6
ModelDFSL_VLC6$Accum_CCO2_VLC6 <- ModelDFSL_VLC6$AccumInput_VLC6 - ModelDFSL_VLC6$AllPools_noIOM_VLC6

#Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
ModelDFSL_VLC6$M_CCO2_VLC6[1] <- 0
ModelDFSL_VLC6$Accum_CCO2_VLC6[1] <- 0

#Balance validation
ModelDFSL_VLC6$Balance_VLC6 <- ModelDFSL_VLC6$AccumInput_VLC6 - ModelDFSL_VLC6$Accum_CCO2_VLC6 - (ModelDFSL_VLC6$DPM_VLC6 + ModelDFSL_VLC6$RPM_VLC6 + ModelDFSL_VLC6$BIO_VLC6 + ModelDFSL_VLC6$HUM_VLC6)

#Convert C-CO2 emissions into CO2 emissions
ModelDFSL_VLC6$M_CO2_VLC6 <- ModelDFSL_VLC6$M_CCO2_VLC6 * 44/12
ModelDFSL_VLC6$Accum_CO2_VLC6 <- ModelDFSL_VLC6$Accum_CCO2_VLC6 * 44/12

#This model will be called VLC6C because implies a continuous input of C
ModelDFSL_VLC6C <- ModelDFSL_VLC6

#Export the dataframe
write_xlsx(ModelDFSL_VLC6C,"VXC_Models\\ModelDFSL_R_VLC6C.xlsx")

#Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
#Create two equal models by using the above general script
#Create model t=x
ModelDFSLt0_VLC6 <- ModelDFSL_VLC6 #Create model t=x

#Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
ModelDFSLt1_VLC6.1 <- rbind(c(0:0), ModelDFSLt0_VLC6)
ModelDFSLt1_VLC6.2 <- rbind(c(0:0), ModelDFSLt1_VLC6.1)
ModelDFSLt1_VLC6.3 <- rbind(c(0:0), ModelDFSLt1_VLC6.2)
ModelDFSLt1_VLC6.4 <- rbind(c(0:0), ModelDFSLt1_VLC6.3)
ModelDFSLt1_VLC6.5 <- rbind(c(0:0), ModelDFSLt1_VLC6.4)
ModelDFSLt1_VLC6.6 <- rbind(c(0:0), ModelDFSLt1_VLC6.5)
ModelDFSLt1_VLC6.7 <- rbind(c(0:0), ModelDFSLt1_VLC6.6)
ModelDFSLt1_VLC6.8 <- rbind(c(0:0), ModelDFSLt1_VLC6.7)
ModelDFSLt1_VLC6.9 <- rbind(c(0:0), ModelDFSLt1_VLC6.8)
ModelDFSLt1_VLC6.10 <- rbind(c(0:0), ModelDFSLt1_VLC6.9)
ModelDFSLt1_VLC6.11 <- rbind(c(0:0), ModelDFSLt1_VLC6.10)
ModelDFSLt1_VLC6.12 <- rbind(c(0:0), ModelDFSLt1_VLC6.11)
ModelDFSLt1_VLC6.13 <- ModelDFSLt1_VLC6.12[-nrow(ModelDFSLt1_VLC6.12),]
ModelDFSLt1_VLC6.14 <- ModelDFSLt1_VLC6.13[-nrow(ModelDFSLt1_VLC6.13),]
ModelDFSLt1_VLC6.15 <- ModelDFSLt1_VLC6.14[-nrow(ModelDFSLt1_VLC6.14),]
ModelDFSLt1_VLC6.16 <- ModelDFSLt1_VLC6.15[-nrow(ModelDFSLt1_VLC6.15),]
ModelDFSLt1_VLC6.17 <- ModelDFSLt1_VLC6.16[-nrow(ModelDFSLt1_VLC6.16),]
ModelDFSLt1_VLC6.18 <- ModelDFSLt1_VLC6.17[-nrow(ModelDFSLt1_VLC6.17),]
ModelDFSLt1_VLC6.19 <- ModelDFSLt1_VLC6.18[-nrow(ModelDFSLt1_VLC6.18),]
ModelDFSLt1_VLC6.20 <- ModelDFSLt1_VLC6.19[-nrow(ModelDFSLt1_VLC6.19),]
ModelDFSLt1_VLC6.21 <- ModelDFSLt1_VLC6.20[-nrow(ModelDFSLt1_VLC6.20),]
ModelDFSLt1_VLC6.22 <- ModelDFSLt1_VLC6.21[-nrow(ModelDFSLt1_VLC6.21),]
ModelDFSLt1_VLC6.23 <- ModelDFSLt1_VLC6.22[-nrow(ModelDFSLt1_VLC6.22),]
ModelDFSLt1_VLC6.24 <- ModelDFSLt1_VLC6.23[-nrow(ModelDFSLt1_VLC6.23),]

ModelDFSLt1_VLC6 <- ModelDFSLt1_VLC6.24 #Create model t=x+1

#Subtract model (t=x) - (t=x+1)
ModelDFSL1y_VLC6 <- ModelDFSLt0_VLC6 - ModelDFSLt1_VLC6

#Re-do Month Number column because the substraction was also applied to it
ModelDFSL1y_VLC6$MNumber <- seq(from = 1, to = SimulationLength_months)

#This model will be called VLC6P because implies a one-off input of C
ModelDFSL_VLC6P <- ModelDFSL1y_VLC6

#Export the dataframe
write_xlsx(ModelDFSL_VLC6P,"VXP_Models\\ModelDFSL_R_VLC6P.xlsx")

#Plot 3: Interactive Yearly CO2 emissions #
MY <- 12
ModelDFSL_VLC6P_YCO2 <- ModelDFSL_VLC6P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VLC6)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLC6P_YCO2) <- c("Year", "Months", "AnnualCO2_VLC_6")


#Plot 3: Interactive Yearly CO2 emissions considering a delay
GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
ModelDFSL_VLC6P_YCO2D <- merge(ModelDFSL_VLC6P_YCO2, GWP100delay, by = "Year")
ModelDFSL_VLC6P_YCO2D$AnnualCO2D_VLC_6 <- ModelDFSL_VLC6P_YCO2D$AnnualCO2_VLC_6 * ModelDFSL_VLC6P_YCO2D$GWP100

#Plot 4: Interactive Yearly C emissions #
MY <- 12
ModelDFSL_VLC6P_YC <- ModelDFSL_VLC6P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VLC6)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLC6P_YC) <- c("Year", "Months", "CEmissions_VLC_6")


#Plot 5: Interactive Yearly C tails (remaining C in Soil) #
MY <- 12
ModelDFSL_VLC6P_YCT <- ModelDFSL_VLC6P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VLC6)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLC6P_YCT) <- c("Year", "Months", "CTail_VLC_6")

#Save Dataframes for Plots 3.1, 3.2, 4 and 5
write_xlsx(ModelDFSL_VLC6P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VLC6P.xlsx") #Yearly CO2 emissions (no delay)
write_xlsx(ModelDFSL_VLC6P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VLC6P.xlsx") #Yearly CO2 emissions (delay)
write_xlsx(ModelDFSL_VLC6P_YC,"CEmissions_P\\ModelDFSL_R_CE_VLC6P.xlsx") #Yearly C emissions
write_xlsx(ModelDFSL_VLC6P_YCT,"CTails_P\\ModelDFSL_R_CT_VLC6P.xlsx") #Yearly C emissions



#### 7.8 - VLC7) Litter; 70%clay; Conventional tillage ####
#The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
fT_VLC7=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
fW_VLC7=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
               S.Thick = soil.thick, pClay = clay100*0.7,
               pE = 1.0, bare = FALSE)$b #Moisture effects per month
xi.frame_VLC7=data.frame(years,rep(fT_VLC7*fW_VLC7,length.out=length(years)))

#To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
Model_VLC7=SoilR::RothCModel(
  t=years, #Simulation Length
  ks=c(k.DPM = 10*CTRM, k.RPM = 0.3*CTRM, k.BIO = 0.66*CTRM, k.HUM = 0.02*CTRM, k.IOM = 0*CTRM), #Decomposition rates for the different pools
  C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
  In=Scalar_LitterCinputs*1, #Amount of litter inputs by time
  FYM = Scalar_ManureCinputs*0, #Amount of Farm Yard Manure by time
  clay=clay100*0.7, #Percent clay in mineral soil
  xi=xi.frame_VLC7) #Loads the model

Ct_VLC7=getC(Model_VLC7) #Calculates stocks for each pool per month

#The results can be plotted with the commands
matplot(years, Ct_VLC7, type="l", lty=1, col=1:5,
        xlab="Time (years)", ylab="C stocks (Mg/ha)")
legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
       lty=1, col=1:5, bty="n")

VEC_Lit_VLC7 <- rep(M_Scalar_LitterCinputs*1, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
VEC_Man_VLC7 <- rep(M_Scalar_ManureCinputs*0, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

VEC_LitDF_VLC7 <- as.data.frame(VEC_Lit_VLC7) #Converting the Litter vector to a data frame
VEC_LitDF_VLC7$MNumber <- seq(from = 1, to = SimulationLength_months)
VEC_ManDF_VLC7 <- as.data.frame(VEC_Man_VLC7) #Converting the Manure vector to a data frame
VEC_ManDF_VLC7$MNumber <- seq(from = 1, to = SimulationLength_months)

sapply(VEC_LitDF_VLC7, class) #Check that class is numeric
sapply(VEC_ManDF_VLC7, class) #Check that class is numeric
LitterCinputs_VLC7=VEC_LitDF_VLC7   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
ManureCinputs_VLC7=VEC_ManDF_VLC7 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
MCinputs_VLC7 <- merge(LitterCinputs_VLC7, ManureCinputs_VLC7, by = "MNumber")
MCinputs_VLC7$MInput_VLC7 <- MCinputs_VLC7$VEC_Lit_VLC7 + MCinputs_VLC7$VEC_Man_VLC7

#Change names of litter and manure columns for more common ones
colnames(MCinputs_VLC7)[which(names(MCinputs_VLC7) == "VEC_Lit_VLC7")] <- "LitterC_VLC7"
colnames(MCinputs_VLC7)[which(names(MCinputs_VLC7) == "VEC_Man_VLC7")] <- "ManureC_VLC7"

#Create a dataframe with the data considering the simulation length
ModelDF_VLC7 <- as.data.frame(Ct_VLC7)
colnames(ModelDF_VLC7) <- c('DPM_VLC7','RPM_VLC7','BIO_VLC7', 'HUM_VLC7', 'IOM_VLC7')
ModelDFS_VLC7 <- ModelDF_VLC7[1:SimulationLength_months, ]

#Create a column with the number of month of analysis
ModelDFS_VLC7$MNumber <- seq(from = 1, to = SimulationLength_months)

#Create a column that sums all pools
ModelDFS_VLC7$AllPools_VLC7 <- ModelDFS_VLC7$DPM_VLC7 + ModelDFS_VLC7$RPM_VLC7 + ModelDFS_VLC7$BIO_VLC7 + ModelDFS_VLC7$HUM_VLC7 + ModelDFS_VLC7$IOM_VLC7

#Create a column that sums all pools except IOM (static)
ModelDFS_VLC7$AllPools_noIOM_VLC7 <- ModelDFS_VLC7$DPM_VLC7 + ModelDFS_VLC7$RPM_VLC7 + ModelDFS_VLC7$BIO_VLC7 + ModelDFS_VLC7$HUM_VLC7

#Create a column that add the monthly input of C (manure and litter separately)
ModelDFSL_VLC7 <- merge(ModelDFS_VLC7, MCinputs_VLC7, by = "MNumber")

ModelDFSL_VLC7$MInput_VLC7 <- ModelDFSL_VLC7$LitterC_VLC7 + ModelDFSL_VLC7$ManureC_VLC7
#ModelDF_SL$MInput[1] <- 0

#Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
ModelDFSL_VLC7$CTails_VLC7 <- ModelDFSL_VLC7$AllPools_noIOM_VLC7 + ModelDFSL_VLC7$MInput_VLC7

#Create Monthly Accumulated input of C
ModelDFSL_VLC7$AccumInput_VLC7 = ModelDFSL_VLC7$AccumInput_VLC7=cumsum(ModelDFSL_VLC7$MInput_VLC7)

#Create Monthly Growths for each carbon pool
ModelDFSL_VLC7$MGrowth_DPM_VLC7 <- ave(ModelDFSL_VLC7$DPM_VLC7, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLC7$MGrowth_RPM_VLC7 <- ave(ModelDFSL_VLC7$RPM_VLC7, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLC7$MGrowth_BIO_VLC7 <- ave(ModelDFSL_VLC7$BIO_VLC7, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLC7$MGrowth_HUM_VLC7 <- ave(ModelDFSL_VLC7$HUM_VLC7, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLC7$MGrowth_IOM_VLC7 <- ave(ModelDFSL_VLC7$IOM_VLC7, FUN = function(x) c(0, diff(x)))

#Create column for Monthly and Accumulated C-CO2 emissions
ModelDFSL_VLC7$M_CCO2_VLC7 <- ModelDFSL_VLC7$MInput_VLC7 - ModelDFSL_VLC7$MGrowth_DPM_VLC7 - ModelDFSL_VLC7$MGrowth_RPM_VLC7 - ModelDFSL_VLC7$MGrowth_BIO_VLC7 - ModelDFSL_VLC7$MGrowth_HUM_VLC7
ModelDFSL_VLC7$Accum_CCO2_VLC7 <- ModelDFSL_VLC7$AccumInput_VLC7 - ModelDFSL_VLC7$AllPools_noIOM_VLC7

#Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
ModelDFSL_VLC7$M_CCO2_VLC7[1] <- 0
ModelDFSL_VLC7$Accum_CCO2_VLC7[1] <- 0

#Balance validation
ModelDFSL_VLC7$Balance_VLC7 <- ModelDFSL_VLC7$AccumInput_VLC7 - ModelDFSL_VLC7$Accum_CCO2_VLC7 - (ModelDFSL_VLC7$DPM_VLC7 + ModelDFSL_VLC7$RPM_VLC7 + ModelDFSL_VLC7$BIO_VLC7 + ModelDFSL_VLC7$HUM_VLC7)

#Convert C-CO2 emissions into CO2 emissions
ModelDFSL_VLC7$M_CO2_VLC7 <- ModelDFSL_VLC7$M_CCO2_VLC7 * 44/12
ModelDFSL_VLC7$Accum_CO2_VLC7 <- ModelDFSL_VLC7$Accum_CCO2_VLC7 * 44/12

#This model will be called VLC7C because implies a continuous input of C
ModelDFSL_VLC7C <- ModelDFSL_VLC7

#Export the dataframe
write_xlsx(ModelDFSL_VLC7C,"VXC_Models\\ModelDFSL_R_VLC7C.xlsx")

#Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
#Create two equal models by using the above general script
#Create model t=x
ModelDFSLt0_VLC7 <- ModelDFSL_VLC7 #Create model t=x

#Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
ModelDFSLt1_VLC7.1 <- rbind(c(0:0), ModelDFSLt0_VLC7)
ModelDFSLt1_VLC7.2 <- rbind(c(0:0), ModelDFSLt1_VLC7.1)
ModelDFSLt1_VLC7.3 <- rbind(c(0:0), ModelDFSLt1_VLC7.2)
ModelDFSLt1_VLC7.4 <- rbind(c(0:0), ModelDFSLt1_VLC7.3)
ModelDFSLt1_VLC7.5 <- rbind(c(0:0), ModelDFSLt1_VLC7.4)
ModelDFSLt1_VLC7.6 <- rbind(c(0:0), ModelDFSLt1_VLC7.5)
ModelDFSLt1_VLC7.7 <- rbind(c(0:0), ModelDFSLt1_VLC7.6)
ModelDFSLt1_VLC7.8 <- rbind(c(0:0), ModelDFSLt1_VLC7.7)
ModelDFSLt1_VLC7.9 <- rbind(c(0:0), ModelDFSLt1_VLC7.8)
ModelDFSLt1_VLC7.10 <- rbind(c(0:0), ModelDFSLt1_VLC7.9)
ModelDFSLt1_VLC7.11 <- rbind(c(0:0), ModelDFSLt1_VLC7.10)
ModelDFSLt1_VLC7.12 <- rbind(c(0:0), ModelDFSLt1_VLC7.11)
ModelDFSLt1_VLC7.13 <- ModelDFSLt1_VLC7.12[-nrow(ModelDFSLt1_VLC7.12),]
ModelDFSLt1_VLC7.14 <- ModelDFSLt1_VLC7.13[-nrow(ModelDFSLt1_VLC7.13),]
ModelDFSLt1_VLC7.15 <- ModelDFSLt1_VLC7.14[-nrow(ModelDFSLt1_VLC7.14),]
ModelDFSLt1_VLC7.16 <- ModelDFSLt1_VLC7.15[-nrow(ModelDFSLt1_VLC7.15),]
ModelDFSLt1_VLC7.17 <- ModelDFSLt1_VLC7.16[-nrow(ModelDFSLt1_VLC7.16),]
ModelDFSLt1_VLC7.18 <- ModelDFSLt1_VLC7.17[-nrow(ModelDFSLt1_VLC7.17),]
ModelDFSLt1_VLC7.19 <- ModelDFSLt1_VLC7.18[-nrow(ModelDFSLt1_VLC7.18),]
ModelDFSLt1_VLC7.20 <- ModelDFSLt1_VLC7.19[-nrow(ModelDFSLt1_VLC7.19),]
ModelDFSLt1_VLC7.21 <- ModelDFSLt1_VLC7.20[-nrow(ModelDFSLt1_VLC7.20),]
ModelDFSLt1_VLC7.22 <- ModelDFSLt1_VLC7.21[-nrow(ModelDFSLt1_VLC7.21),]
ModelDFSLt1_VLC7.23 <- ModelDFSLt1_VLC7.22[-nrow(ModelDFSLt1_VLC7.22),]
ModelDFSLt1_VLC7.24 <- ModelDFSLt1_VLC7.23[-nrow(ModelDFSLt1_VLC7.23),]

ModelDFSLt1_VLC7 <- ModelDFSLt1_VLC7.24 #Create model t=x+1

#Subtract model (t=x) - (t=x+1)
ModelDFSL1y_VLC7 <- ModelDFSLt0_VLC7 - ModelDFSLt1_VLC7

#Re-do Month Number column because the substraction was also applied to it
ModelDFSL1y_VLC7$MNumber <- seq(from = 1, to = SimulationLength_months)

#This model will be called VLC7P because implies a one-off input of C
ModelDFSL_VLC7P <- ModelDFSL1y_VLC7

#Export the dataframe
write_xlsx(ModelDFSL_VLC7P,"VXP_Models\\ModelDFSL_R_VLC7P.xlsx")

#Plot 3: Interactive Yearly CO2 emissions #
MY <- 12
ModelDFSL_VLC7P_YCO2 <- ModelDFSL_VLC7P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VLC7)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLC7P_YCO2) <- c("Year", "Months", "AnnualCO2_VLC_7")


#Plot 3: Interactive Yearly CO2 emissions considering a delay
GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
ModelDFSL_VLC7P_YCO2D <- merge(ModelDFSL_VLC7P_YCO2, GWP100delay, by = "Year")
ModelDFSL_VLC7P_YCO2D$AnnualCO2D_VLC_7 <- ModelDFSL_VLC7P_YCO2D$AnnualCO2_VLC_7 * ModelDFSL_VLC7P_YCO2D$GWP100

#Plot 4: Interactive Yearly C emissions #
MY <- 12
ModelDFSL_VLC7P_YC <- ModelDFSL_VLC7P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VLC7)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLC7P_YC) <- c("Year", "Months", "CEmissions_VLC_7")


#Plot 5: Interactive Yearly C tails (remaining C in Soil) #
MY <- 12
ModelDFSL_VLC7P_YCT <- ModelDFSL_VLC7P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VLC7)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLC7P_YCT) <- c("Year", "Months", "CTail_VLC_7")


#Save Dataframes for Plots 3.1, 3.2, 4 and 5
write_xlsx(ModelDFSL_VLC7P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VLC7P.xlsx") #Yearly CO2 emissions (no delay)
write_xlsx(ModelDFSL_VLC7P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VLC7P.xlsx") #Yearly CO2 emissions (delay)
write_xlsx(ModelDFSL_VLC7P_YC,"CEmissions_P\\ModelDFSL_R_CE_VLC7P.xlsx") #Yearly C emissions
write_xlsx(ModelDFSL_VLC7P_YCT,"CTails_P\\ModelDFSL_R_CT_VLC7P.xlsx") #Yearly C emissions



#### 7.9 - VLC8) Litter; 80%clay; Conventional tillage ####
#The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
fT_VLC8=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
fW_VLC8=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
               S.Thick = soil.thick, pClay = clay100*0.8,
               pE = 1.0, bare = FALSE)$b #Moisture effects per month
xi.frame_VLC8=data.frame(years,rep(fT_VLC8*fW_VLC8,length.out=length(years)))

#To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
Model_VLC8=SoilR::RothCModel(
  t=years, #Simulation Length
  ks=c(k.DPM = 10*CTRM, k.RPM = 0.3*CTRM, k.BIO = 0.66*CTRM, k.HUM = 0.02*CTRM, k.IOM = 0*CTRM), #Decomposition rates for the different pools
  C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
  In=Scalar_LitterCinputs*1, #Amount of litter inputs by time
  FYM = Scalar_ManureCinputs*0, #Amount of Farm Yard Manure by time
  clay=clay100*0.8, #Percent clay in mineral soil
  xi=xi.frame_VLC8) #Loads the model

Ct_VLC8=getC(Model_VLC8) #Calculates stocks for each pool per month

#The results can be plotted with the commands
matplot(years, Ct_VLC8, type="l", lty=1, col=1:5,
        xlab="Time (years)", ylab="C stocks (Mg/ha)")
legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
       lty=1, col=1:5, bty="n")

VEC_Lit_VLC8 <- rep(M_Scalar_LitterCinputs*1, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
VEC_Man_VLC8 <- rep(M_Scalar_ManureCinputs*0, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

VEC_LitDF_VLC8 <- as.data.frame(VEC_Lit_VLC8) #Converting the Litter vector to a data frame
VEC_LitDF_VLC8$MNumber <- seq(from = 1, to = SimulationLength_months)
VEC_ManDF_VLC8 <- as.data.frame(VEC_Man_VLC8) #Converting the Manure vector to a data frame
VEC_ManDF_VLC8$MNumber <- seq(from = 1, to = SimulationLength_months)

sapply(VEC_LitDF_VLC8, class) #Check that class is numeric
sapply(VEC_ManDF_VLC8, class) #Check that class is numeric
LitterCinputs_VLC8=VEC_LitDF_VLC8   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
ManureCinputs_VLC8=VEC_ManDF_VLC8 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
MCinputs_VLC8 <- merge(LitterCinputs_VLC8, ManureCinputs_VLC8, by = "MNumber")
MCinputs_VLC8$MInput_VLC8 <- MCinputs_VLC8$VEC_Lit_VLC8 + MCinputs_VLC8$VEC_Man_VLC8

#Change names of litter and manure columns for more common ones
colnames(MCinputs_VLC8)[which(names(MCinputs_VLC8) == "VEC_Lit_VLC8")] <- "LitterC_VLC8"
colnames(MCinputs_VLC8)[which(names(MCinputs_VLC8) == "VEC_Man_VLC8")] <- "ManureC_VLC8"

#Create a dataframe with the data considering the simulation length
ModelDF_VLC8 <- as.data.frame(Ct_VLC8)
colnames(ModelDF_VLC8) <- c('DPM_VLC8','RPM_VLC8','BIO_VLC8', 'HUM_VLC8', 'IOM_VLC8')
ModelDFS_VLC8 <- ModelDF_VLC8[1:SimulationLength_months, ]

#Create a column with the number of month of analysis
ModelDFS_VLC8$MNumber <- seq(from = 1, to = SimulationLength_months)

#Create a column that sums all pools
ModelDFS_VLC8$AllPools_VLC8 <- ModelDFS_VLC8$DPM_VLC8 + ModelDFS_VLC8$RPM_VLC8 + ModelDFS_VLC8$BIO_VLC8 + ModelDFS_VLC8$HUM_VLC8 + ModelDFS_VLC8$IOM_VLC8

#Create a column that sums all pools except IOM (static)
ModelDFS_VLC8$AllPools_noIOM_VLC8 <- ModelDFS_VLC8$DPM_VLC8 + ModelDFS_VLC8$RPM_VLC8 + ModelDFS_VLC8$BIO_VLC8 + ModelDFS_VLC8$HUM_VLC8

#Create a column that add the monthly input of C (manure and litter separately)
ModelDFSL_VLC8 <- merge(ModelDFS_VLC8, MCinputs_VLC8, by = "MNumber")

ModelDFSL_VLC8$MInput_VLC8 <- ModelDFSL_VLC8$LitterC_VLC8 + ModelDFSL_VLC8$ManureC_VLC8
#ModelDF_SL$MInput[1] <- 0

#Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
ModelDFSL_VLC8$CTails_VLC8 <- ModelDFSL_VLC8$AllPools_noIOM_VLC8 + ModelDFSL_VLC8$MInput_VLC8

#Create Monthly Accumulated input of C
ModelDFSL_VLC8$AccumInput_VLC8 = ModelDFSL_VLC8$AccumInput_VLC8=cumsum(ModelDFSL_VLC8$MInput_VLC8)

#Create Monthly Growths for each carbon pool
ModelDFSL_VLC8$MGrowth_DPM_VLC8 <- ave(ModelDFSL_VLC8$DPM_VLC8, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLC8$MGrowth_RPM_VLC8 <- ave(ModelDFSL_VLC8$RPM_VLC8, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLC8$MGrowth_BIO_VLC8 <- ave(ModelDFSL_VLC8$BIO_VLC8, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLC8$MGrowth_HUM_VLC8 <- ave(ModelDFSL_VLC8$HUM_VLC8, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLC8$MGrowth_IOM_VLC8 <- ave(ModelDFSL_VLC8$IOM_VLC8, FUN = function(x) c(0, diff(x)))

#Create column for Monthly and Accumulated C-CO2 emissions
ModelDFSL_VLC8$M_CCO2_VLC8 <- ModelDFSL_VLC8$MInput_VLC8 - ModelDFSL_VLC8$MGrowth_DPM_VLC8 - ModelDFSL_VLC8$MGrowth_RPM_VLC8 - ModelDFSL_VLC8$MGrowth_BIO_VLC8 - ModelDFSL_VLC8$MGrowth_HUM_VLC8
ModelDFSL_VLC8$Accum_CCO2_VLC8 <- ModelDFSL_VLC8$AccumInput_VLC8 - ModelDFSL_VLC8$AllPools_noIOM_VLC8

#Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
ModelDFSL_VLC8$M_CCO2_VLC8[1] <- 0
ModelDFSL_VLC8$Accum_CCO2_VLC8[1] <- 0

#Balance validation
ModelDFSL_VLC8$Balance_VLC8 <- ModelDFSL_VLC8$AccumInput_VLC8 - ModelDFSL_VLC8$Accum_CCO2_VLC8 - (ModelDFSL_VLC8$DPM_VLC8 + ModelDFSL_VLC8$RPM_VLC8 + ModelDFSL_VLC8$BIO_VLC8 + ModelDFSL_VLC8$HUM_VLC8)

#Convert C-CO2 emissions into CO2 emissions
ModelDFSL_VLC8$M_CO2_VLC8 <- ModelDFSL_VLC8$M_CCO2_VLC8 * 44/12
ModelDFSL_VLC8$Accum_CO2_VLC8 <- ModelDFSL_VLC8$Accum_CCO2_VLC8 * 44/12

#This model will be called VLC8C because implies a continuous input of C
ModelDFSL_VLC8C <- ModelDFSL_VLC8

#Export the dataframe
write_xlsx(ModelDFSL_VLC8C,"VXC_Models\\ModelDFSL_R_VLC8C.xlsx")

#Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
#Create two equal models by using the above general script
#Create model t=x
ModelDFSLt0_VLC8 <- ModelDFSL_VLC8 #Create model t=x

#Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
ModelDFSLt1_VLC8.1 <- rbind(c(0:0), ModelDFSLt0_VLC8)
ModelDFSLt1_VLC8.2 <- rbind(c(0:0), ModelDFSLt1_VLC8.1)
ModelDFSLt1_VLC8.3 <- rbind(c(0:0), ModelDFSLt1_VLC8.2)
ModelDFSLt1_VLC8.4 <- rbind(c(0:0), ModelDFSLt1_VLC8.3)
ModelDFSLt1_VLC8.5 <- rbind(c(0:0), ModelDFSLt1_VLC8.4)
ModelDFSLt1_VLC8.6 <- rbind(c(0:0), ModelDFSLt1_VLC8.5)
ModelDFSLt1_VLC8.7 <- rbind(c(0:0), ModelDFSLt1_VLC8.6)
ModelDFSLt1_VLC8.8 <- rbind(c(0:0), ModelDFSLt1_VLC8.7)
ModelDFSLt1_VLC8.9 <- rbind(c(0:0), ModelDFSLt1_VLC8.8)
ModelDFSLt1_VLC8.10 <- rbind(c(0:0), ModelDFSLt1_VLC8.9)
ModelDFSLt1_VLC8.11 <- rbind(c(0:0), ModelDFSLt1_VLC8.10)
ModelDFSLt1_VLC8.12 <- rbind(c(0:0), ModelDFSLt1_VLC8.11)
ModelDFSLt1_VLC8.13 <- ModelDFSLt1_VLC8.12[-nrow(ModelDFSLt1_VLC8.12),]
ModelDFSLt1_VLC8.14 <- ModelDFSLt1_VLC8.13[-nrow(ModelDFSLt1_VLC8.13),]
ModelDFSLt1_VLC8.15 <- ModelDFSLt1_VLC8.14[-nrow(ModelDFSLt1_VLC8.14),]
ModelDFSLt1_VLC8.16 <- ModelDFSLt1_VLC8.15[-nrow(ModelDFSLt1_VLC8.15),]
ModelDFSLt1_VLC8.17 <- ModelDFSLt1_VLC8.16[-nrow(ModelDFSLt1_VLC8.16),]
ModelDFSLt1_VLC8.18 <- ModelDFSLt1_VLC8.17[-nrow(ModelDFSLt1_VLC8.17),]
ModelDFSLt1_VLC8.19 <- ModelDFSLt1_VLC8.18[-nrow(ModelDFSLt1_VLC8.18),]
ModelDFSLt1_VLC8.20 <- ModelDFSLt1_VLC8.19[-nrow(ModelDFSLt1_VLC8.19),]
ModelDFSLt1_VLC8.21 <- ModelDFSLt1_VLC8.20[-nrow(ModelDFSLt1_VLC8.20),]
ModelDFSLt1_VLC8.22 <- ModelDFSLt1_VLC8.21[-nrow(ModelDFSLt1_VLC8.21),]
ModelDFSLt1_VLC8.23 <- ModelDFSLt1_VLC8.22[-nrow(ModelDFSLt1_VLC8.22),]
ModelDFSLt1_VLC8.24 <- ModelDFSLt1_VLC8.23[-nrow(ModelDFSLt1_VLC8.23),]

ModelDFSLt1_VLC8 <- ModelDFSLt1_VLC8.24 #Create model t=x+1

#Subtract model (t=x) - (t=x+1)
ModelDFSL1y_VLC8 <- ModelDFSLt0_VLC8 - ModelDFSLt1_VLC8

#Re-do Month Number column because the substraction was also applied to it
ModelDFSL1y_VLC8$MNumber <- seq(from = 1, to = SimulationLength_months)

#This model will be called VLC8P because implies a one-off input of C
ModelDFSL_VLC8P <- ModelDFSL1y_VLC8

#Export the dataframe
write_xlsx(ModelDFSL_VLC8P,"VXP_Models\\ModelDFSL_R_VLC8P.xlsx")


#Plot 3: Interactive Yearly CO2 emissions #
MY <- 12
ModelDFSL_VLC8P_YCO2 <- ModelDFSL_VLC8P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VLC8)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLC8P_YCO2) <- c("Year", "Months", "AnnualCO2_VLC_8")

#Plot 3: Interactive Yearly CO2 emissions considering a delay
GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
ModelDFSL_VLC8P_YCO2D <- merge(ModelDFSL_VLC8P_YCO2, GWP100delay, by = "Year")
ModelDFSL_VLC8P_YCO2D$AnnualCO2D_VLC_8 <- ModelDFSL_VLC8P_YCO2D$AnnualCO2_VLC_8 * ModelDFSL_VLC8P_YCO2D$GWP100


#Plot 4: Interactive Yearly C emissions #
MY <- 12
ModelDFSL_VLC8P_YC <- ModelDFSL_VLC8P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VLC8)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLC8P_YC) <- c("Year", "Months", "CEmissions_VLC_8")

#Plot 5: Interactive Yearly C tails (remaining C in Soil) #
MY <- 12
ModelDFSL_VLC8P_YCT <- ModelDFSL_VLC8P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VLC8)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLC8P_YCT) <- c("Year", "Months", "CTail_VLC_8")

#Save Dataframes for Plots 3.1, 3.2, 4 and 5
write_xlsx(ModelDFSL_VLC8P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VLC8P.xlsx") #Yearly CO2 emissions (no delay)
write_xlsx(ModelDFSL_VLC8P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VLC8P.xlsx") #Yearly CO2 emissions (delay)
write_xlsx(ModelDFSL_VLC8P_YC,"CEmissions_P\\ModelDFSL_R_CE_VLC8P.xlsx") #Yearly C emissions
write_xlsx(ModelDFSL_VLC8P_YCT,"CTails_P\\ModelDFSL_R_CT_VLC8P.xlsx") #Yearly C emissions



#### 7.10 - VLC9) Litter; 90%clay; Conventional tillage ####
#The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
fT_VLC9=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
fW_VLC9=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
               S.Thick = soil.thick, pClay = clay100*0.9,
               pE = 1.0, bare = FALSE)$b #Moisture effects per month
xi.frame_VLC9=data.frame(years,rep(fT_VLC9*fW_VLC9,length.out=length(years)))

#To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
Model_VLC9=SoilR::RothCModel(
  t=years, #Simulation Length
  ks=c(k.DPM = 10*CTRM, k.RPM = 0.3*CTRM, k.BIO = 0.66*CTRM, k.HUM = 0.02*CTRM, k.IOM = 0*CTRM), #Decomposition rates for the different pools
  C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
  In=Scalar_LitterCinputs*1, #Amount of litter inputs by time
  FYM = Scalar_ManureCinputs*0, #Amount of Farm Yard Manure by time
  clay=clay100*0.9, #Percent clay in mineral soil
  xi=xi.frame_VLC9) #Loads the model

Ct_VLC9=getC(Model_VLC9) #Calculates stocks for each pool per month

#The results can be plotted with the commands
matplot(years, Ct_VLC9, type="l", lty=1, col=1:5,
        xlab="Time (years)", ylab="C stocks (Mg/ha)")
legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
       lty=1, col=1:5, bty="n")

VEC_Lit_VLC9 <- rep(M_Scalar_LitterCinputs*1, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
VEC_Man_VLC9 <- rep(M_Scalar_ManureCinputs*0, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

VEC_LitDF_VLC9 <- as.data.frame(VEC_Lit_VLC9) #Converting the Litter vector to a data frame
VEC_LitDF_VLC9$MNumber <- seq(from = 1, to = SimulationLength_months)
VEC_ManDF_VLC9 <- as.data.frame(VEC_Man_VLC9) #Converting the Manure vector to a data frame
VEC_ManDF_VLC9$MNumber <- seq(from = 1, to = SimulationLength_months)

sapply(VEC_LitDF_VLC9, class) #Check that class is numeric
sapply(VEC_ManDF_VLC9, class) #Check that class is numeric
LitterCinputs_VLC9=VEC_LitDF_VLC9   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
ManureCinputs_VLC9=VEC_ManDF_VLC9 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
MCinputs_VLC9 <- merge(LitterCinputs_VLC9, ManureCinputs_VLC9, by = "MNumber")
MCinputs_VLC9$MInput_VLC9 <- MCinputs_VLC9$VEC_Lit_VLC9 + MCinputs_VLC9$VEC_Man_VLC9

#Change names of litter and manure columns for more common ones
colnames(MCinputs_VLC9)[which(names(MCinputs_VLC9) == "VEC_Lit_VLC9")] <- "LitterC_VLC9"
colnames(MCinputs_VLC9)[which(names(MCinputs_VLC9) == "VEC_Man_VLC9")] <- "ManureC_VLC9"

#Create a dataframe with the data considering the simulation length
ModelDF_VLC9 <- as.data.frame(Ct_VLC9)
colnames(ModelDF_VLC9) <- c('DPM_VLC9','RPM_VLC9','BIO_VLC9', 'HUM_VLC9', 'IOM_VLC9')
ModelDFS_VLC9 <- ModelDF_VLC9[1:SimulationLength_months, ]

#Create a column with the number of month of analysis
ModelDFS_VLC9$MNumber <- seq(from = 1, to = SimulationLength_months)

#Create a column that sums all pools
ModelDFS_VLC9$AllPools_VLC9 <- ModelDFS_VLC9$DPM_VLC9 + ModelDFS_VLC9$RPM_VLC9 + ModelDFS_VLC9$BIO_VLC9 + ModelDFS_VLC9$HUM_VLC9 + ModelDFS_VLC9$IOM_VLC9

#Create a column that sums all pools except IOM (static)
ModelDFS_VLC9$AllPools_noIOM_VLC9 <- ModelDFS_VLC9$DPM_VLC9 + ModelDFS_VLC9$RPM_VLC9 + ModelDFS_VLC9$BIO_VLC9 + ModelDFS_VLC9$HUM_VLC9

#Create a column that add the monthly input of C (manure and litter separately)
ModelDFSL_VLC9 <- merge(ModelDFS_VLC9, MCinputs_VLC9, by = "MNumber")

ModelDFSL_VLC9$MInput_VLC9 <- ModelDFSL_VLC9$LitterC_VLC9 + ModelDFSL_VLC9$ManureC_VLC9
#ModelDF_SL$MInput[1] <- 0

#Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
ModelDFSL_VLC9$CTails_VLC9 <- ModelDFSL_VLC9$AllPools_noIOM_VLC9 + ModelDFSL_VLC9$MInput_VLC9

#Create Monthly Accumulated input of C
ModelDFSL_VLC9$AccumInput_VLC9 = ModelDFSL_VLC9$AccumInput_VLC9=cumsum(ModelDFSL_VLC9$MInput_VLC9)

#Create Monthly Growths for each carbon pool
ModelDFSL_VLC9$MGrowth_DPM_VLC9 <- ave(ModelDFSL_VLC9$DPM_VLC9, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLC9$MGrowth_RPM_VLC9 <- ave(ModelDFSL_VLC9$RPM_VLC9, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLC9$MGrowth_BIO_VLC9 <- ave(ModelDFSL_VLC9$BIO_VLC9, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLC9$MGrowth_HUM_VLC9 <- ave(ModelDFSL_VLC9$HUM_VLC9, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLC9$MGrowth_IOM_VLC9 <- ave(ModelDFSL_VLC9$IOM_VLC9, FUN = function(x) c(0, diff(x)))

#Create column for Monthly and Accumulated C-CO2 emissions
ModelDFSL_VLC9$M_CCO2_VLC9 <- ModelDFSL_VLC9$MInput_VLC9 - ModelDFSL_VLC9$MGrowth_DPM_VLC9 - ModelDFSL_VLC9$MGrowth_RPM_VLC9 - ModelDFSL_VLC9$MGrowth_BIO_VLC9 - ModelDFSL_VLC9$MGrowth_HUM_VLC9
ModelDFSL_VLC9$Accum_CCO2_VLC9 <- ModelDFSL_VLC9$AccumInput_VLC9 - ModelDFSL_VLC9$AllPools_noIOM_VLC9

#Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
ModelDFSL_VLC9$M_CCO2_VLC9[1] <- 0
ModelDFSL_VLC9$Accum_CCO2_VLC9[1] <- 0

#Balance validation
ModelDFSL_VLC9$Balance_VLC9 <- ModelDFSL_VLC9$AccumInput_VLC9 - ModelDFSL_VLC9$Accum_CCO2_VLC9 - (ModelDFSL_VLC9$DPM_VLC9 + ModelDFSL_VLC9$RPM_VLC9 + ModelDFSL_VLC9$BIO_VLC9 + ModelDFSL_VLC9$HUM_VLC9)

#Convert C-CO2 emissions into CO2 emissions
ModelDFSL_VLC9$M_CO2_VLC9 <- ModelDFSL_VLC9$M_CCO2_VLC9 * 44/12
ModelDFSL_VLC9$Accum_CO2_VLC9 <- ModelDFSL_VLC9$Accum_CCO2_VLC9 * 44/12

#This model will be called VLC9C because implies a continuous input of C
ModelDFSL_VLC9C <- ModelDFSL_VLC9

#Export the dataframe
write_xlsx(ModelDFSL_VLC9C,"VXC_Models\\ModelDFSL_R_VLC9C.xlsx")

#Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
#Create two equal models by using the above general script
#Create model t=x
ModelDFSLt0_VLC9 <- ModelDFSL_VLC9 #Create model t=x

#Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
ModelDFSLt1_VLC9.1 <- rbind(c(0:0), ModelDFSLt0_VLC9)
ModelDFSLt1_VLC9.2 <- rbind(c(0:0), ModelDFSLt1_VLC9.1)
ModelDFSLt1_VLC9.3 <- rbind(c(0:0), ModelDFSLt1_VLC9.2)
ModelDFSLt1_VLC9.4 <- rbind(c(0:0), ModelDFSLt1_VLC9.3)
ModelDFSLt1_VLC9.5 <- rbind(c(0:0), ModelDFSLt1_VLC9.4)
ModelDFSLt1_VLC9.6 <- rbind(c(0:0), ModelDFSLt1_VLC9.5)
ModelDFSLt1_VLC9.7 <- rbind(c(0:0), ModelDFSLt1_VLC9.6)
ModelDFSLt1_VLC9.8 <- rbind(c(0:0), ModelDFSLt1_VLC9.7)
ModelDFSLt1_VLC9.9 <- rbind(c(0:0), ModelDFSLt1_VLC9.8)
ModelDFSLt1_VLC9.10 <- rbind(c(0:0), ModelDFSLt1_VLC9.9)
ModelDFSLt1_VLC9.11 <- rbind(c(0:0), ModelDFSLt1_VLC9.10)
ModelDFSLt1_VLC9.12 <- rbind(c(0:0), ModelDFSLt1_VLC9.11)
ModelDFSLt1_VLC9.13 <- ModelDFSLt1_VLC9.12[-nrow(ModelDFSLt1_VLC9.12),]
ModelDFSLt1_VLC9.14 <- ModelDFSLt1_VLC9.13[-nrow(ModelDFSLt1_VLC9.13),]
ModelDFSLt1_VLC9.15 <- ModelDFSLt1_VLC9.14[-nrow(ModelDFSLt1_VLC9.14),]
ModelDFSLt1_VLC9.16 <- ModelDFSLt1_VLC9.15[-nrow(ModelDFSLt1_VLC9.15),]
ModelDFSLt1_VLC9.17 <- ModelDFSLt1_VLC9.16[-nrow(ModelDFSLt1_VLC9.16),]
ModelDFSLt1_VLC9.18 <- ModelDFSLt1_VLC9.17[-nrow(ModelDFSLt1_VLC9.17),]
ModelDFSLt1_VLC9.19 <- ModelDFSLt1_VLC9.18[-nrow(ModelDFSLt1_VLC9.18),]
ModelDFSLt1_VLC9.20 <- ModelDFSLt1_VLC9.19[-nrow(ModelDFSLt1_VLC9.19),]
ModelDFSLt1_VLC9.21 <- ModelDFSLt1_VLC9.20[-nrow(ModelDFSLt1_VLC9.20),]
ModelDFSLt1_VLC9.22 <- ModelDFSLt1_VLC9.21[-nrow(ModelDFSLt1_VLC9.21),]
ModelDFSLt1_VLC9.23 <- ModelDFSLt1_VLC9.22[-nrow(ModelDFSLt1_VLC9.22),]
ModelDFSLt1_VLC9.24 <- ModelDFSLt1_VLC9.23[-nrow(ModelDFSLt1_VLC9.23),]

ModelDFSLt1_VLC9 <- ModelDFSLt1_VLC9.24 #Create model t=x+1

#Subtract model (t=x) - (t=x+1)
ModelDFSL1y_VLC9 <- ModelDFSLt0_VLC9 - ModelDFSLt1_VLC9

#Re-do Month Number column because the substraction was also applied to it
ModelDFSL1y_VLC9$MNumber <- seq(from = 1, to = SimulationLength_months)

#This model will be called VLC9P because implies a one-off input of C
ModelDFSL_VLC9P <- ModelDFSL1y_VLC9

#Export the dataframe
write_xlsx(ModelDFSL_VLC9P,"VXP_Models\\ModelDFSL_R_VLC9P.xlsx")


#Plot 3: Interactive Yearly CO2 emissions #
MY <- 12
ModelDFSL_VLC9P_YCO2 <- ModelDFSL_VLC9P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VLC9)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLC9P_YCO2) <- c("Year", "Months", "AnnualCO2_VLC_9")

#Plot 3: Interactive Yearly CO2 emissions considering a delay
GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
ModelDFSL_VLC9P_YCO2D <- merge(ModelDFSL_VLC9P_YCO2, GWP100delay, by = "Year")
ModelDFSL_VLC9P_YCO2D$AnnualCO2D_VLC_9 <- ModelDFSL_VLC9P_YCO2D$AnnualCO2_VLC_9 * ModelDFSL_VLC9P_YCO2D$GWP100


#Plot 4: Interactive Yearly C emissions #
MY <- 12
ModelDFSL_VLC9P_YC <- ModelDFSL_VLC9P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VLC9)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLC9P_YC) <- c("Year", "Months", "CEmissions_VLC_9")

#Plot 5: Interactive Yearly C tails (remaining C in Soil) #
MY <- 12
ModelDFSL_VLC9P_YCT <- ModelDFSL_VLC9P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VLC9)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLC9P_YCT) <- c("Year", "Months", "CTail_VLC_9")

#Save Dataframes for Plots 3.1, 3.2, 4 and 5
write_xlsx(ModelDFSL_VLC9P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VLC9P.xlsx") #Yearly CO2 emissions (no delay)
write_xlsx(ModelDFSL_VLC9P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VLC9P.xlsx") #Yearly CO2 emissions (delay)
write_xlsx(ModelDFSL_VLC9P_YC,"CEmissions_P\\ModelDFSL_R_CE_VLC9P.xlsx") #Yearly C emissions
write_xlsx(ModelDFSL_VLC9P_YCT,"CTails_P\\ModelDFSL_R_CT_VLC9P.xlsx") #Yearly C emissions



#### 7.11 - VLC10) Litter; 100%clay; Conventional tillage ####
#The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
fT_VLC10=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
fW_VLC10=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
               S.Thick = soil.thick, pClay = clay100,
               pE = 1.0, bare = FALSE)$b #Moisture effects per month
xi.frame_VLC10=data.frame(years,rep(fT_VLC10*fW_VLC10,length.out=length(years)))

#To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
Model_VLC10=SoilR::RothCModel(
  t=years, #Simulation Length
  ks=c(k.DPM = 10*CTRM, k.RPM = 0.3*CTRM, k.BIO = 0.66*CTRM, k.HUM = 0.02*CTRM, k.IOM = 0*CTRM), #Decomposition rates for the different pools
  C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
  In=Scalar_LitterCinputs*1, #Amount of litter inputs by time
  FYM = Scalar_ManureCinputs*0, #Amount of Farm Yard Manure by time
  clay=clay100, #Percent clay in mineral soil
  xi=xi.frame_VLC10) #Loads the model

Ct_VLC10=getC(Model_VLC10) #Calculates stocks for each pool per month

#The results can be plotted with the commands
matplot(years, Ct_VLC10, type="l", lty=1, col=1:5,
        xlab="Time (years)", ylab="C stocks (Mg/ha)")
legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
       lty=1, col=1:5, bty="n")

VEC_Lit_VLC10 <- rep(M_Scalar_LitterCinputs*1, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
VEC_Man_VLC10 <- rep(M_Scalar_ManureCinputs*0, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

VEC_LitDF_VLC10 <- as.data.frame(VEC_Lit_VLC10) #Converting the Litter vector to a data frame
VEC_LitDF_VLC10$MNumber <- seq(from = 1, to = SimulationLength_months)
VEC_ManDF_VLC10 <- as.data.frame(VEC_Man_VLC10) #Converting the Manure vector to a data frame
VEC_ManDF_VLC10$MNumber <- seq(from = 1, to = SimulationLength_months)

sapply(VEC_LitDF_VLC10, class) #Check that class is numeric
sapply(VEC_ManDF_VLC10, class) #Check that class is numeric
LitterCinputs_VLC10=VEC_LitDF_VLC10   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
ManureCinputs_VLC10=VEC_ManDF_VLC10 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
MCinputs_VLC10 <- merge(LitterCinputs_VLC10, ManureCinputs_VLC10, by = "MNumber")
MCinputs_VLC10$MInput_VLC10 <- MCinputs_VLC10$VEC_Lit_VLC10 + MCinputs_VLC10$VEC_Man_VLC10

#Change names of litter and manure columns for more common ones
colnames(MCinputs_VLC10)[which(names(MCinputs_VLC10) == "VEC_Lit_VLC10")] <- "LitterC_VLC10"
colnames(MCinputs_VLC10)[which(names(MCinputs_VLC10) == "VEC_Man_VLC10")] <- "ManureC_VLC10"

#Create a dataframe with the data considering the simulation length
ModelDF_VLC10 <- as.data.frame(Ct_VLC10)
colnames(ModelDF_VLC10) <- c('DPM_VLC10','RPM_VLC10','BIO_VLC10', 'HUM_VLC10', 'IOM_VLC10')
ModelDFS_VLC10 <- ModelDF_VLC10[1:SimulationLength_months, ]

#Create a column with the number of month of analysis
ModelDFS_VLC10$MNumber <- seq(from = 1, to = SimulationLength_months)

#Create a column that sums all pools
ModelDFS_VLC10$AllPools_VLC10 <- ModelDFS_VLC10$DPM_VLC10 + ModelDFS_VLC10$RPM_VLC10 + ModelDFS_VLC10$BIO_VLC10 + ModelDFS_VLC10$HUM_VLC10 + ModelDFS_VLC10$IOM_VLC10

#Create a column that sums all pools except IOM (static)
ModelDFS_VLC10$AllPools_noIOM_VLC10 <- ModelDFS_VLC10$DPM_VLC10 + ModelDFS_VLC10$RPM_VLC10 + ModelDFS_VLC10$BIO_VLC10 + ModelDFS_VLC10$HUM_VLC10

#Create a column that add the monthly input of C (manure and litter separately)
ModelDFSL_VLC10 <- merge(ModelDFS_VLC10, MCinputs_VLC10, by = "MNumber")

ModelDFSL_VLC10$MInput_VLC10 <- ModelDFSL_VLC10$LitterC_VLC10 + ModelDFSL_VLC10$ManureC_VLC10
#ModelDF_SL$MInput[1] <- 0

#Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
ModelDFSL_VLC10$CTails_VLC10 <- ModelDFSL_VLC10$AllPools_noIOM_VLC10 + ModelDFSL_VLC10$MInput_VLC10

#Create Monthly Accumulated input of C
ModelDFSL_VLC10$AccumInput_VLC10 = ModelDFSL_VLC10$AccumInput_VLC10=cumsum(ModelDFSL_VLC10$MInput_VLC10)

#Create Monthly Growths for each carbon pool
ModelDFSL_VLC10$MGrowth_DPM_VLC10 <- ave(ModelDFSL_VLC10$DPM_VLC10, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLC10$MGrowth_RPM_VLC10 <- ave(ModelDFSL_VLC10$RPM_VLC10, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLC10$MGrowth_BIO_VLC10 <- ave(ModelDFSL_VLC10$BIO_VLC10, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLC10$MGrowth_HUM_VLC10 <- ave(ModelDFSL_VLC10$HUM_VLC10, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLC10$MGrowth_IOM_VLC10 <- ave(ModelDFSL_VLC10$IOM_VLC10, FUN = function(x) c(0, diff(x)))

#Create column for Monthly and Accumulated C-CO2 emissions
ModelDFSL_VLC10$M_CCO2_VLC10 <- ModelDFSL_VLC10$MInput_VLC10 - ModelDFSL_VLC10$MGrowth_DPM_VLC10 - ModelDFSL_VLC10$MGrowth_RPM_VLC10 - ModelDFSL_VLC10$MGrowth_BIO_VLC10 - ModelDFSL_VLC10$MGrowth_HUM_VLC10
ModelDFSL_VLC10$Accum_CCO2_VLC10 <- ModelDFSL_VLC10$AccumInput_VLC10 - ModelDFSL_VLC10$AllPools_noIOM_VLC10

#Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
ModelDFSL_VLC10$M_CCO2_VLC10[1] <- 0
ModelDFSL_VLC10$Accum_CCO2_VLC10[1] <- 0

#Balance validation
ModelDFSL_VLC10$Balance_VLC10 <- ModelDFSL_VLC10$AccumInput_VLC10 - ModelDFSL_VLC10$Accum_CCO2_VLC10 - (ModelDFSL_VLC10$DPM_VLC10 + ModelDFSL_VLC10$RPM_VLC10 + ModelDFSL_VLC10$BIO_VLC10 + ModelDFSL_VLC10$HUM_VLC10)

#Convert C-CO2 emissions into CO2 emissions
ModelDFSL_VLC10$M_CO2_VLC10 <- ModelDFSL_VLC10$M_CCO2_VLC10 * 44/12
ModelDFSL_VLC10$Accum_CO2_VLC10 <- ModelDFSL_VLC10$Accum_CCO2_VLC10 * 44/12

#This model will be called VLC10C because implies a continuous input of C
ModelDFSL_VLC10C <- ModelDFSL_VLC10

#Export the dataframe
write_xlsx(ModelDFSL_VLC10C,"VXC_Models\\ModelDFSL_R_VLC10C.xlsx")

#Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
#Create two equal models by using the above general script
#Create model t=x
ModelDFSLt0_VLC10 <- ModelDFSL_VLC10 #Create model t=x

#Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
ModelDFSLt1_VLC10.1 <- rbind(c(0:0), ModelDFSLt0_VLC10)
ModelDFSLt1_VLC10.2 <- rbind(c(0:0), ModelDFSLt1_VLC10.1)
ModelDFSLt1_VLC10.3 <- rbind(c(0:0), ModelDFSLt1_VLC10.2)
ModelDFSLt1_VLC10.4 <- rbind(c(0:0), ModelDFSLt1_VLC10.3)
ModelDFSLt1_VLC10.5 <- rbind(c(0:0), ModelDFSLt1_VLC10.4)
ModelDFSLt1_VLC10.6 <- rbind(c(0:0), ModelDFSLt1_VLC10.5)
ModelDFSLt1_VLC10.7 <- rbind(c(0:0), ModelDFSLt1_VLC10.6)
ModelDFSLt1_VLC10.8 <- rbind(c(0:0), ModelDFSLt1_VLC10.7)
ModelDFSLt1_VLC10.9 <- rbind(c(0:0), ModelDFSLt1_VLC10.8)
ModelDFSLt1_VLC10.10 <- rbind(c(0:0), ModelDFSLt1_VLC10.9)
ModelDFSLt1_VLC10.11 <- rbind(c(0:0), ModelDFSLt1_VLC10.10)
ModelDFSLt1_VLC10.12 <- rbind(c(0:0), ModelDFSLt1_VLC10.11)
ModelDFSLt1_VLC10.13 <- ModelDFSLt1_VLC10.12[-nrow(ModelDFSLt1_VLC10.12),]
ModelDFSLt1_VLC10.14 <- ModelDFSLt1_VLC10.13[-nrow(ModelDFSLt1_VLC10.13),]
ModelDFSLt1_VLC10.15 <- ModelDFSLt1_VLC10.14[-nrow(ModelDFSLt1_VLC10.14),]
ModelDFSLt1_VLC10.16 <- ModelDFSLt1_VLC10.15[-nrow(ModelDFSLt1_VLC10.15),]
ModelDFSLt1_VLC10.17 <- ModelDFSLt1_VLC10.16[-nrow(ModelDFSLt1_VLC10.16),]
ModelDFSLt1_VLC10.18 <- ModelDFSLt1_VLC10.17[-nrow(ModelDFSLt1_VLC10.17),]
ModelDFSLt1_VLC10.19 <- ModelDFSLt1_VLC10.18[-nrow(ModelDFSLt1_VLC10.18),]
ModelDFSLt1_VLC10.20 <- ModelDFSLt1_VLC10.19[-nrow(ModelDFSLt1_VLC10.19),]
ModelDFSLt1_VLC10.21 <- ModelDFSLt1_VLC10.20[-nrow(ModelDFSLt1_VLC10.20),]
ModelDFSLt1_VLC10.22 <- ModelDFSLt1_VLC10.21[-nrow(ModelDFSLt1_VLC10.21),]
ModelDFSLt1_VLC10.23 <- ModelDFSLt1_VLC10.22[-nrow(ModelDFSLt1_VLC10.22),]
ModelDFSLt1_VLC10.24 <- ModelDFSLt1_VLC10.23[-nrow(ModelDFSLt1_VLC10.23),]

ModelDFSLt1_VLC10 <- ModelDFSLt1_VLC10.24 #Create model t=x+1

#Subtract model (t=x) - (t=x+1)
ModelDFSL1y_VLC10 <- ModelDFSLt0_VLC10 - ModelDFSLt1_VLC10

#Re-do Month Number column because the substraction was also applied to it
ModelDFSL1y_VLC10$MNumber <- seq(from = 1, to = SimulationLength_months)

#This model will be called VLC10P because implies a one-off input of C
ModelDFSL_VLC10P <- ModelDFSL1y_VLC10

#Export the dataframe
write_xlsx(ModelDFSL_VLC10P,"VXP_Models\\ModelDFSL_R_VLC10P.xlsx")


#Plot 3: Interactive Yearly CO2 emissions #
MY <- 12
ModelDFSL_VLC10P_YCO2 <- ModelDFSL_VLC10P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VLC10)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLC10P_YCO2) <- c("Year", "Months", "AnnualCO2_VLC10")

#Plot 3: Interactive Yearly CO2 emissions considering a delay
GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
ModelDFSL_VLC10P_YCO2D <- merge(ModelDFSL_VLC10P_YCO2, GWP100delay, by = "Year")
ModelDFSL_VLC10P_YCO2D$AnnualCO2D_VLC10 <- ModelDFSL_VLC10P_YCO2D$AnnualCO2_VLC10 * ModelDFSL_VLC10P_YCO2D$GWP100

#Plot 4: Interactive Yearly C emissions #
MY <- 12
ModelDFSL_VLC10P_YC <- ModelDFSL_VLC10P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VLC10)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLC10P_YC) <- c("Year", "Months", "CEmissions_VLC10")

#Plot 5: Interactive Yearly C tails (remaining C in Soil) #
MY <- 12
ModelDFSL_VLC10P_YCT <- ModelDFSL_VLC10P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VLC10)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLC10P_YCT) <- c("Year", "Months", "CTail_VLC10")

#Save Dataframes for Plots 3.1, 3.2, 4 and 5
write_xlsx(ModelDFSL_VLC10P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VLC10P.xlsx") #Yearly CO2 emissions (no delay)
write_xlsx(ModelDFSL_VLC10P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VLC10P.xlsx") #Yearly CO2 emissions (delay)
write_xlsx(ModelDFSL_VLC10P_YC,"CEmissions_P\\ModelDFSL_R_CE_VLC10P.xlsx") #Yearly C emissions
write_xlsx(ModelDFSL_VLC10P_YCT,"CTails_P\\ModelDFSL_R_CT_VLC10P.xlsx") #Yearly C emissions

#### - #####
#### 8) Model Combinations - Litter; Reduced Tillage, 0-100% (+10%) Clay ####
#### 8.1 - VLR0) Litter; 0%clay; Reduced Tillage ####
#The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
fT_VLR0=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
fW_VLR0=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                        S.Thick = soil.thick, pClay = clay0,
                        pE = 1.0, bare = FALSE)$b #Moisture effects per month
xi.frame_VLR0=data.frame(years,rep(fT_VLR0*fW_VLR0,length.out=length(years)))

#To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
Model_VLR0=SoilR::RothCModel(
  t=years, #Simulation Length
  ks=c(k.DPM = 10*RTRM, k.RPM = 0.3*RTRM, k.BIO = 0.66*RTRM, k.HUM = 0.02*RTRM, k.IOM = 0*RTRM), #Decomposition rates for the different pools
  C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
  In=Scalar_LitterCinputs*1, #Amount of litter inputs by time
  FYM = Scalar_ManureCinputs*0, #Amount of Farm Yard Manure by time
  clay=clay0, #Percent clay in mineral soil
  xi=xi.frame_VLR0) #Loads the model

Ct_VLR0=getC(Model_VLR0) #Calculates stocks for each pool per month

VEC_Lit_VLR0 <- rep(M_Scalar_LitterCinputs*1, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
VEC_Man_VLR0 <- rep(M_Scalar_ManureCinputs*0, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

VEC_LitDF_VLR0 <- as.data.frame(VEC_Lit_VLR0) #Converting the Litter vector to a data frame
VEC_LitDF_VLR0$MNumber <- seq(from = 1, to = SimulationLength_months)
VEC_ManDF_VLR0 <- as.data.frame(VEC_Man_VLR0) #Converting the Manure vector to a data frame
VEC_ManDF_VLR0$MNumber <- seq(from = 1, to = SimulationLength_months)

sapply(VEC_LitDF_VLR0, class) #Check that class is numeric
sapply(VEC_ManDF_VLR0, class) #Check that class is numeric
LitterCinputs_VLR0=VEC_LitDF_VLR0   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
ManureCinputs_VLR0=VEC_ManDF_VLR0 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
MCinputs_VLR0 <- merge(LitterCinputs_VLR0, ManureCinputs_VLR0, by = "MNumber")
MCinputs_VLR0$MInput_VLR0 <- MCinputs_VLR0$VEC_Lit_VLR0 + MCinputs_VLR0$VEC_Man_VLR0

#Change names of litter and manure columns for more common ones
colnames(MCinputs_VLR0)[which(names(MCinputs_VLR0) == "VEC_Lit_VLR0")] <- "LitterC_VLR0"
colnames(MCinputs_VLR0)[which(names(MCinputs_VLR0) == "VEC_Man_VLR0")] <- "ManureC_VLR0"

#Create a dataframe with the data considering the simulation length
ModelDF_VLR0 <- as.data.frame(Ct_VLR0)
colnames(ModelDF_VLR0) <- c('DPM_VLR0','RPM_VLR0','BIO_VLR0', 'HUM_VLR0', 'IOM_VLR0')
ModelDFS_VLR0 <- ModelDF_VLR0[1:SimulationLength_months, ]

#Create a column with the number of month of analysis
ModelDFS_VLR0$MNumber <- seq(from = 1, to = SimulationLength_months)

#Create a column that sums all pools
ModelDFS_VLR0$AllPools_VLR0 <- ModelDFS_VLR0$DPM_VLR0 + ModelDFS_VLR0$RPM_VLR0 + ModelDFS_VLR0$BIO_VLR0 + ModelDFS_VLR0$HUM_VLR0 + ModelDFS_VLR0$IOM_VLR0

#Create a column that sums all pools except IOM (static)
ModelDFS_VLR0$AllPools_noIOM_VLR0 <- ModelDFS_VLR0$DPM_VLR0 + ModelDFS_VLR0$RPM_VLR0 + ModelDFS_VLR0$BIO_VLR0 + ModelDFS_VLR0$HUM_VLR0

#Create a column that add the monthly input of C (manure and litter separately)
ModelDFSL_VLR0 <- merge(ModelDFS_VLR0, MCinputs_VLR0, by = "MNumber")

ModelDFSL_VLR0$MInput_VLR0 <- ModelDFSL_VLR0$LitterC_VLR0 + ModelDFSL_VLR0$ManureC_VLR0
#ModelDF_SL$MInput[1] <- 0

#Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
ModelDFSL_VLR0$CTails_VLR0 <- ModelDFSL_VLR0$AllPools_noIOM_VLR0 + ModelDFSL_VLR0$MInput_VLR0

#Create Monthly Accumulated input of C
ModelDFSL_VLR0$AccumInput_VLR0 = ModelDFSL_VLR0$AccumInput_VLR0=cumsum(ModelDFSL_VLR0$MInput_VLR0)

#Create Monthly Growths for each carbon pool
ModelDFSL_VLR0$MGrowth_DPM_VLR0 <- ave(ModelDFSL_VLR0$DPM_VLR0, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLR0$MGrowth_RPM_VLR0 <- ave(ModelDFSL_VLR0$RPM_VLR0, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLR0$MGrowth_BIO_VLR0 <- ave(ModelDFSL_VLR0$BIO_VLR0, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLR0$MGrowth_HUM_VLR0 <- ave(ModelDFSL_VLR0$HUM_VLR0, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLR0$MGrowth_IOM_VLR0 <- ave(ModelDFSL_VLR0$IOM_VLR0, FUN = function(x) c(0, diff(x)))

#Create column for Monthly and Accumulated C-CO2 emissions
ModelDFSL_VLR0$M_CCO2_VLR0 <- ModelDFSL_VLR0$MInput_VLR0 - ModelDFSL_VLR0$MGrowth_DPM_VLR0 - ModelDFSL_VLR0$MGrowth_RPM_VLR0 - ModelDFSL_VLR0$MGrowth_BIO_VLR0 - ModelDFSL_VLR0$MGrowth_HUM_VLR0
ModelDFSL_VLR0$Accum_CCO2_VLR0 <- ModelDFSL_VLR0$AccumInput_VLR0 - ModelDFSL_VLR0$AllPools_noIOM_VLR0

#Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
ModelDFSL_VLR0$M_CCO2_VLR0[1] <- 0
ModelDFSL_VLR0$Accum_CCO2_VLR0[1] <- 0

#Balance validation
ModelDFSL_VLR0$Balance_VLR0 <- ModelDFSL_VLR0$AccumInput_VLR0 - ModelDFSL_VLR0$Accum_CCO2_VLR0 - (ModelDFSL_VLR0$DPM_VLR0 + ModelDFSL_VLR0$RPM_VLR0 + ModelDFSL_VLR0$BIO_VLR0 + ModelDFSL_VLR0$HUM_VLR0)

#Convert C-CO2 emissions into CO2 emissions
ModelDFSL_VLR0$M_CO2_VLR0 <- ModelDFSL_VLR0$M_CCO2_VLR0 * 44/12
ModelDFSL_VLR0$Accum_CO2_VLR0 <- ModelDFSL_VLR0$Accum_CCO2_VLR0 * 44/12

#This model will be called VLR0C because implies a continuous input of C
ModelDFSL_VLR0C <- ModelDFSL_VLR0

#Export the dataframe
write_xlsx(ModelDFSL_VLR0C,"VXC_Models\\ModelDFSL_R_VLR0C.xlsx")

#Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
#Create two equal models by using the above general script
#Create model t=x
ModelDFSLt0_VLR0 <- ModelDFSL_VLR0 #Create model t=x

#Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
ModelDFSLt1_VLR0.1 <- rbind(c(0:0), ModelDFSLt0_VLR0)
ModelDFSLt1_VLR0.2 <- rbind(c(0:0), ModelDFSLt1_VLR0.1)
ModelDFSLt1_VLR0.3 <- rbind(c(0:0), ModelDFSLt1_VLR0.2)
ModelDFSLt1_VLR0.4 <- rbind(c(0:0), ModelDFSLt1_VLR0.3)
ModelDFSLt1_VLR0.5 <- rbind(c(0:0), ModelDFSLt1_VLR0.4)
ModelDFSLt1_VLR0.6 <- rbind(c(0:0), ModelDFSLt1_VLR0.5)
ModelDFSLt1_VLR0.7 <- rbind(c(0:0), ModelDFSLt1_VLR0.6)
ModelDFSLt1_VLR0.8 <- rbind(c(0:0), ModelDFSLt1_VLR0.7)
ModelDFSLt1_VLR0.9 <- rbind(c(0:0), ModelDFSLt1_VLR0.8)
ModelDFSLt1_VLR0.10 <- rbind(c(0:0), ModelDFSLt1_VLR0.9)
ModelDFSLt1_VLR0.11 <- rbind(c(0:0), ModelDFSLt1_VLR0.10)
ModelDFSLt1_VLR0.12 <- rbind(c(0:0), ModelDFSLt1_VLR0.11)
ModelDFSLt1_VLR0.13 <- ModelDFSLt1_VLR0.12[-nrow(ModelDFSLt1_VLR0.12),]
ModelDFSLt1_VLR0.14 <- ModelDFSLt1_VLR0.13[-nrow(ModelDFSLt1_VLR0.13),]
ModelDFSLt1_VLR0.15 <- ModelDFSLt1_VLR0.14[-nrow(ModelDFSLt1_VLR0.14),]
ModelDFSLt1_VLR0.16 <- ModelDFSLt1_VLR0.15[-nrow(ModelDFSLt1_VLR0.15),]
ModelDFSLt1_VLR0.17 <- ModelDFSLt1_VLR0.16[-nrow(ModelDFSLt1_VLR0.16),]
ModelDFSLt1_VLR0.18 <- ModelDFSLt1_VLR0.17[-nrow(ModelDFSLt1_VLR0.17),]
ModelDFSLt1_VLR0.19 <- ModelDFSLt1_VLR0.18[-nrow(ModelDFSLt1_VLR0.18),]
ModelDFSLt1_VLR0.20 <- ModelDFSLt1_VLR0.19[-nrow(ModelDFSLt1_VLR0.19),]
ModelDFSLt1_VLR0.21 <- ModelDFSLt1_VLR0.20[-nrow(ModelDFSLt1_VLR0.20),]
ModelDFSLt1_VLR0.22 <- ModelDFSLt1_VLR0.21[-nrow(ModelDFSLt1_VLR0.21),]
ModelDFSLt1_VLR0.23 <- ModelDFSLt1_VLR0.22[-nrow(ModelDFSLt1_VLR0.22),]
ModelDFSLt1_VLR0.24 <- ModelDFSLt1_VLR0.23[-nrow(ModelDFSLt1_VLR0.23),]

ModelDFSLt1_VLR0 <- ModelDFSLt1_VLR0.24 #Create model t=x+1

#Subtract model (t=x) - (t=x+1)
ModelDFSL1y_VLR0 <- ModelDFSLt0_VLR0 - ModelDFSLt1_VLR0

#Re-do Month Number column because the substraction was also applied to it
ModelDFSL1y_VLR0$MNumber <- seq(from = 1, to = SimulationLength_months)

#This model will be called VLR0P because implies a one-off input of C
ModelDFSL_VLR0P <- ModelDFSL1y_VLR0

#Export the dataframe
write_xlsx(ModelDFSL_VLR0P,"VXP_Models\\ModelDFSL_R_VLR0P.xlsx")

#Plot 3.1: Interactive Yearly CO2 emissions #
MY <- 12
ModelDFSL_VLR0P_YCO2 <- ModelDFSL_VLR0P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VLR0)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLR0P_YCO2) <- c("Year", "Months", "AnnualCO2_VLR_0")

#Plot 3.2: Interactive Yearly CO2 emissions considering a delay
GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
ModelDFSL_VLR0P_YCO2D <- merge(ModelDFSL_VLR0P_YCO2, GWP100delay, by = "Year")
ModelDFSL_VLR0P_YCO2D$AnnualCO2D_VLR_0 <- ModelDFSL_VLR0P_YCO2D$AnnualCO2_VLR_0 * ModelDFSL_VLR0P_YCO2D$GWP100

#Plot 4: Interactive Yearly C emissions #
MY <- 12
ModelDFSL_VLR0P_YC <- ModelDFSL_VLR0P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VLR0)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLR0P_YC) <- c("Year", "Months", "CEmissions_VLR_0")

#Plot 5: Interactive Yearly C tails (remaining C in Soil) #
MY <- 12
ModelDFSL_VLR0P_YCT <- ModelDFSL_VLR0P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VLR0)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLR0P_YCT) <- c("Year", "Months", "CTail_VLR_0")

#Save Dataframes for Plots 3.1, 3.2, 4 and 5
write_xlsx(ModelDFSL_VLR0P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VLR0P.xlsx") #Yearly CO2 emissions (no delay)
write_xlsx(ModelDFSL_VLR0P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VLR0P.xlsx") #Yearly CO2 emissions (delay)
write_xlsx(ModelDFSL_VLR0P_YC,"CEmissions_P\\ModelDFSL_R_CE_VLR0P.xlsx") #Yearly C emissions
write_xlsx(ModelDFSL_VLR0P_YCT,"CTails_P\\ModelDFSL_R_CT_VLR0P.xlsx") #Yearly C emissions


#### 8.2 - VLR1) Litter; 10%clay; Reduced Tillage ####
#The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
fT_VLR1=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
fW_VLR1=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                        S.Thick = soil.thick, pClay = clay100*0.1,
                        pE = 1.0, bare = FALSE)$b #Moisture effects per month
xi.frame_VLR1=data.frame(years,rep(fT_VLR1*fW_VLR1,length.out=length(years)))

#To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
Model_VLR1=SoilR::RothCModel(
  t=years, #Simulation Length
  ks=c(k.DPM = 10*RTRM, k.RPM = 0.3*RTRM, k.BIO = 0.66*RTRM, k.HUM = 0.02*RTRM, k.IOM = 0*RTRM), #Decomposition rates for the different pools
  C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
  In=Scalar_LitterCinputs*1, #Amount of litter inputs by time
  FYM = Scalar_ManureCinputs*0, #Amount of Farm Yard Manure by time
  clay=clay100*0.1, #Percent clay in mineral soil
  xi=xi.frame_VLR1) #Loads the model

Ct_VLR1=getC(Model_VLR1) #Calculates stocks for each pool per month

#The results can be plotted with the commands
matplot(years, Ct_VLR1, type="l", lty=1, col=1:5,
        xlab="Time (years)", ylab="C stocks (Mg/ha)")
legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
       lty=1, col=1:5, bty="n")

VEC_Lit_VLR1 <- rep(M_Scalar_LitterCinputs*1, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
VEC_Man_VLR1 <- rep(M_Scalar_ManureCinputs*0, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

VEC_LitDF_VLR1 <- as.data.frame(VEC_Lit_VLR1) #Converting the Litter vector to a data frame
VEC_LitDF_VLR1$MNumber <- seq(from = 1, to = SimulationLength_months)
VEC_ManDF_VLR1 <- as.data.frame(VEC_Man_VLR1) #Converting the Manure vector to a data frame
VEC_ManDF_VLR1$MNumber <- seq(from = 1, to = SimulationLength_months)

sapply(VEC_LitDF_VLR1, class) #Check that class is numeric
sapply(VEC_ManDF_VLR1, class) #Check that class is numeric
LitterCinputs_VLR1=VEC_LitDF_VLR1   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
ManureCinputs_VLR1=VEC_ManDF_VLR1 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
MCinputs_VLR1 <- merge(LitterCinputs_VLR1, ManureCinputs_VLR1, by = "MNumber")
MCinputs_VLR1$MInput_VLR1 <- MCinputs_VLR1$VEC_Lit_VLR1 + MCinputs_VLR1$VEC_Man_VLR1

#Change names of litter and manure columns for more common ones
colnames(MCinputs_VLR1)[which(names(MCinputs_VLR1) == "VEC_Lit_VLR1")] <- "LitterC_VLR1"
colnames(MCinputs_VLR1)[which(names(MCinputs_VLR1) == "VEC_Man_VLR1")] <- "ManureC_VLR1"

#Create a dataframe with the data considering the simulation length
ModelDF_VLR1 <- as.data.frame(Ct_VLR1)
colnames(ModelDF_VLR1) <- c('DPM_VLR1','RPM_VLR1','BIO_VLR1', 'HUM_VLR1', 'IOM_VLR1')
ModelDFS_VLR1 <- ModelDF_VLR1[1:SimulationLength_months, ]

#Create a column with the number of month of analysis
ModelDFS_VLR1$MNumber <- seq(from = 1, to = SimulationLength_months)

#Create a column that sums all pools
ModelDFS_VLR1$AllPools_VLR1 <- ModelDFS_VLR1$DPM_VLR1 + ModelDFS_VLR1$RPM_VLR1 + ModelDFS_VLR1$BIO_VLR1 + ModelDFS_VLR1$HUM_VLR1 + ModelDFS_VLR1$IOM_VLR1

#Create a column that sums all pools except IOM (static)
ModelDFS_VLR1$AllPools_noIOM_VLR1 <- ModelDFS_VLR1$DPM_VLR1 + ModelDFS_VLR1$RPM_VLR1 + ModelDFS_VLR1$BIO_VLR1 + ModelDFS_VLR1$HUM_VLR1

#Create a column that add the monthly input of C (manure and litter separately)
ModelDFSL_VLR1 <- merge(ModelDFS_VLR1, MCinputs_VLR1, by = "MNumber")

ModelDFSL_VLR1$MInput_VLR1 <- ModelDFSL_VLR1$LitterC_VLR1 + ModelDFSL_VLR1$ManureC_VLR1
#ModelDF_SL$MInput[1] <- 0

#Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
ModelDFSL_VLR1$CTails_VLR1 <- ModelDFSL_VLR1$AllPools_noIOM_VLR1 + ModelDFSL_VLR1$MInput_VLR1

#Create Monthly Accumulated input of C
ModelDFSL_VLR1$AccumInput_VLR1 = ModelDFSL_VLR1$AccumInput_VLR1=cumsum(ModelDFSL_VLR1$MInput_VLR1)

#Create Monthly Growths for each carbon pool
ModelDFSL_VLR1$MGrowth_DPM_VLR1 <- ave(ModelDFSL_VLR1$DPM_VLR1, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLR1$MGrowth_RPM_VLR1 <- ave(ModelDFSL_VLR1$RPM_VLR1, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLR1$MGrowth_BIO_VLR1 <- ave(ModelDFSL_VLR1$BIO_VLR1, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLR1$MGrowth_HUM_VLR1 <- ave(ModelDFSL_VLR1$HUM_VLR1, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLR1$MGrowth_IOM_VLR1 <- ave(ModelDFSL_VLR1$IOM_VLR1, FUN = function(x) c(0, diff(x)))

#Create column for Monthly and Accumulated C-CO2 emissions
ModelDFSL_VLR1$M_CCO2_VLR1 <- ModelDFSL_VLR1$MInput_VLR1 - ModelDFSL_VLR1$MGrowth_DPM_VLR1 - ModelDFSL_VLR1$MGrowth_RPM_VLR1 - ModelDFSL_VLR1$MGrowth_BIO_VLR1 - ModelDFSL_VLR1$MGrowth_HUM_VLR1
ModelDFSL_VLR1$Accum_CCO2_VLR1 <- ModelDFSL_VLR1$AccumInput_VLR1 - ModelDFSL_VLR1$AllPools_noIOM_VLR1

#Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
ModelDFSL_VLR1$M_CCO2_VLR1[1] <- 0
ModelDFSL_VLR1$Accum_CCO2_VLR1[1] <- 0

#Balance validation
ModelDFSL_VLR1$Balance_VLR1 <- ModelDFSL_VLR1$AccumInput_VLR1 - ModelDFSL_VLR1$Accum_CCO2_VLR1 - (ModelDFSL_VLR1$DPM_VLR1 + ModelDFSL_VLR1$RPM_VLR1 + ModelDFSL_VLR1$BIO_VLR1 + ModelDFSL_VLR1$HUM_VLR1)

#Convert C-CO2 emissions into CO2 emissions
ModelDFSL_VLR1$M_CO2_VLR1 <- ModelDFSL_VLR1$M_CCO2_VLR1 * 44/12
ModelDFSL_VLR1$Accum_CO2_VLR1 <- ModelDFSL_VLR1$Accum_CCO2_VLR1 * 44/12

#This model will be called VLR1C because implies a continuous input of C
ModelDFSL_VLR1C <- ModelDFSL_VLR1

#Export the dataframe
write_xlsx(ModelDFSL_VLR1C,"VXC_Models\\ModelDFSL_R_VLR1C.xlsx")

#Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
#Create two equal models by using the above general script
#Create model t=x
ModelDFSLt0_VLR1 <- ModelDFSL_VLR1 #Create model t=x

#Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
ModelDFSLt1_VLR1.1 <- rbind(c(0:0), ModelDFSLt0_VLR1)
ModelDFSLt1_VLR1.2 <- rbind(c(0:0), ModelDFSLt1_VLR1.1)
ModelDFSLt1_VLR1.3 <- rbind(c(0:0), ModelDFSLt1_VLR1.2)
ModelDFSLt1_VLR1.4 <- rbind(c(0:0), ModelDFSLt1_VLR1.3)
ModelDFSLt1_VLR1.5 <- rbind(c(0:0), ModelDFSLt1_VLR1.4)
ModelDFSLt1_VLR1.6 <- rbind(c(0:0), ModelDFSLt1_VLR1.5)
ModelDFSLt1_VLR1.7 <- rbind(c(0:0), ModelDFSLt1_VLR1.6)
ModelDFSLt1_VLR1.8 <- rbind(c(0:0), ModelDFSLt1_VLR1.7)
ModelDFSLt1_VLR1.9 <- rbind(c(0:0), ModelDFSLt1_VLR1.8)
ModelDFSLt1_VLR1.10 <- rbind(c(0:0), ModelDFSLt1_VLR1.9)
ModelDFSLt1_VLR1.11 <- rbind(c(0:0), ModelDFSLt1_VLR1.10)
ModelDFSLt1_VLR1.12 <- rbind(c(0:0), ModelDFSLt1_VLR1.11)
ModelDFSLt1_VLR1.13 <- ModelDFSLt1_VLR1.12[-nrow(ModelDFSLt1_VLR1.12),]
ModelDFSLt1_VLR1.14 <- ModelDFSLt1_VLR1.13[-nrow(ModelDFSLt1_VLR1.13),]
ModelDFSLt1_VLR1.15 <- ModelDFSLt1_VLR1.14[-nrow(ModelDFSLt1_VLR1.14),]
ModelDFSLt1_VLR1.16 <- ModelDFSLt1_VLR1.15[-nrow(ModelDFSLt1_VLR1.15),]
ModelDFSLt1_VLR1.17 <- ModelDFSLt1_VLR1.16[-nrow(ModelDFSLt1_VLR1.16),]
ModelDFSLt1_VLR1.18 <- ModelDFSLt1_VLR1.17[-nrow(ModelDFSLt1_VLR1.17),]
ModelDFSLt1_VLR1.19 <- ModelDFSLt1_VLR1.18[-nrow(ModelDFSLt1_VLR1.18),]
ModelDFSLt1_VLR1.20 <- ModelDFSLt1_VLR1.19[-nrow(ModelDFSLt1_VLR1.19),]
ModelDFSLt1_VLR1.21 <- ModelDFSLt1_VLR1.20[-nrow(ModelDFSLt1_VLR1.20),]
ModelDFSLt1_VLR1.22 <- ModelDFSLt1_VLR1.21[-nrow(ModelDFSLt1_VLR1.21),]
ModelDFSLt1_VLR1.23 <- ModelDFSLt1_VLR1.22[-nrow(ModelDFSLt1_VLR1.22),]
ModelDFSLt1_VLR1.24 <- ModelDFSLt1_VLR1.23[-nrow(ModelDFSLt1_VLR1.23),]

ModelDFSLt1_VLR1 <- ModelDFSLt1_VLR1.24 #Create model t=x+1

#Subtract model (t=x) - (t=x+1)
ModelDFSL1y_VLR1 <- ModelDFSLt0_VLR1 - ModelDFSLt1_VLR1

#Re-do Month Number column because the substraction was also applied to it
ModelDFSL1y_VLR1$MNumber <- seq(from = 1, to = SimulationLength_months)

#This model will be called VLR1P because implies a one-off input of C
ModelDFSL_VLR1P <- ModelDFSL1y_VLR1

#Export the dataframe
write_xlsx(ModelDFSL_VLR1P,"VXP_Models\\ModelDFSL_R_VLR1P.xlsx")

#Plot 3: Interactive Yearly CO2 emissions #
MY <- 12
ModelDFSL_VLR1P_YCO2 <- ModelDFSL_VLR1P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VLR1)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLR1P_YCO2) <- c("Year", "Months", "AnnualCO2_VLR_1")

#Plot 3: Interactive Yearly CO2 emissions considering a delay
GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
ModelDFSL_VLR1P_YCO2D <- merge(ModelDFSL_VLR1P_YCO2, GWP100delay, by = "Year")
ModelDFSL_VLR1P_YCO2D$AnnualCO2D_VLR_1 <- ModelDFSL_VLR1P_YCO2D$AnnualCO2_VLR_1 * ModelDFSL_VLR1P_YCO2D$GWP100

#Plot 4: Interactive Yearly C emissions #
MY <- 12
ModelDFSL_VLR1P_YC <- ModelDFSL_VLR1P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VLR1)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLR1P_YC) <- c("Year", "Months", "CEmissions_VLR_1")

#Plot 5: Interactive Yearly C tails (remaining C in Soil) #
MY <- 12
ModelDFSL_VLR1P_YCT <- ModelDFSL_VLR1P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VLR1)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLR1P_YCT) <- c("Year", "Months", "CTail_VLR_1")

#Save Dataframes for Plots 3.1, 3.2, 4 and 5
write_xlsx(ModelDFSL_VLR1P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VLR1P.xlsx") #Yearly CO2 emissions (no delay)
write_xlsx(ModelDFSL_VLR1P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VLR1P.xlsx") #Yearly CO2 emissions (delay)
write_xlsx(ModelDFSL_VLR1P_YC,"CEmissions_P\\ModelDFSL_R_CE_VLR1P.xlsx") #Yearly C emissions
write_xlsx(ModelDFSL_VLR1P_YCT,"CTails_P\\ModelDFSL_R_CT_VLR1P.xlsx") #Yearly C emissions



#### 8.3 - VLR2) Litter; 20%clay; Reduced Tillage ####
#The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
fT_VLR2=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
fW_VLR2=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                        S.Thick = soil.thick, pClay = clay100*0.2,
                        pE = 1.0, bare = FALSE)$b #Moisture effects per month
xi.frame_VLR2=data.frame(years,rep(fT_VLR2*fW_VLR2,length.out=length(years)))

#To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
Model_VLR2=SoilR::RothCModel(
  t=years, #Simulation Length
  ks=c(k.DPM = 10*RTRM, k.RPM = 0.3*RTRM, k.BIO = 0.66*RTRM, k.HUM = 0.02*RTRM, k.IOM = 0*RTRM), #Decomposition rates for the different pools
  C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
  In=Scalar_LitterCinputs*1, #Amount of litter inputs by time
  FYM = Scalar_ManureCinputs*0, #Amount of Farm Yard Manure by time
  clay=clay100*0.2, #Percent clay in mineral soil
  xi=xi.frame_VLR2) #Loads the model

Ct_VLR2=getC(Model_VLR2) #Calculates stocks for each pool per month

#The results can be plotted with the commands
matplot(years, Ct_VLR2, type="l", lty=1, col=1:5,
        xlab="Time (years)", ylab="C stocks (Mg/ha)")
legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
       lty=1, col=1:5, bty="n")

VEC_Lit_VLR2 <- rep(M_Scalar_LitterCinputs*1, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
VEC_Man_VLR2 <- rep(M_Scalar_ManureCinputs*0, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

VEC_LitDF_VLR2 <- as.data.frame(VEC_Lit_VLR2) #Converting the Litter vector to a data frame
VEC_LitDF_VLR2$MNumber <- seq(from = 1, to = SimulationLength_months)
VEC_ManDF_VLR2 <- as.data.frame(VEC_Man_VLR2) #Converting the Manure vector to a data frame
VEC_ManDF_VLR2$MNumber <- seq(from = 1, to = SimulationLength_months)

sapply(VEC_LitDF_VLR2, class) #Check that class is numeric
sapply(VEC_ManDF_VLR2, class) #Check that class is numeric
LitterCinputs_VLR2=VEC_LitDF_VLR2   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
ManureCinputs_VLR2=VEC_ManDF_VLR2 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
MCinputs_VLR2 <- merge(LitterCinputs_VLR2, ManureCinputs_VLR2, by = "MNumber")
MCinputs_VLR2$MInput_VLR2 <- MCinputs_VLR2$VEC_Lit_VLR2 + MCinputs_VLR2$VEC_Man_VLR2

#Change names of litter and manure columns for more common ones
colnames(MCinputs_VLR2)[which(names(MCinputs_VLR2) == "VEC_Lit_VLR2")] <- "LitterC_VLR2"
colnames(MCinputs_VLR2)[which(names(MCinputs_VLR2) == "VEC_Man_VLR2")] <- "ManureC_VLR2"

#Create a dataframe with the data considering the simulation length
ModelDF_VLR2 <- as.data.frame(Ct_VLR2)
colnames(ModelDF_VLR2) <- c('DPM_VLR2','RPM_VLR2','BIO_VLR2', 'HUM_VLR2', 'IOM_VLR2')
ModelDFS_VLR2 <- ModelDF_VLR2[1:SimulationLength_months, ]

#Create a column with the number of month of analysis
ModelDFS_VLR2$MNumber <- seq(from = 1, to = SimulationLength_months)

#Create a column that sums all pools
ModelDFS_VLR2$AllPools_VLR2 <- ModelDFS_VLR2$DPM_VLR2 + ModelDFS_VLR2$RPM_VLR2 + ModelDFS_VLR2$BIO_VLR2 + ModelDFS_VLR2$HUM_VLR2 + ModelDFS_VLR2$IOM_VLR2

#Create a column that sums all pools except IOM (static)
ModelDFS_VLR2$AllPools_noIOM_VLR2 <- ModelDFS_VLR2$DPM_VLR2 + ModelDFS_VLR2$RPM_VLR2 + ModelDFS_VLR2$BIO_VLR2 + ModelDFS_VLR2$HUM_VLR2

#Create a column that add the monthly input of C (manure and litter separately)
ModelDFSL_VLR2 <- merge(ModelDFS_VLR2, MCinputs_VLR2, by = "MNumber")

ModelDFSL_VLR2$MInput_VLR2 <- ModelDFSL_VLR2$LitterC_VLR2 + ModelDFSL_VLR2$ManureC_VLR2
#ModelDF_SL$MInput[1] <- 0

#Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
ModelDFSL_VLR2$CTails_VLR2 <- ModelDFSL_VLR2$AllPools_noIOM_VLR2 + ModelDFSL_VLR2$MInput_VLR2

#Create Monthly Accumulated input of C
ModelDFSL_VLR2$AccumInput_VLR2 = ModelDFSL_VLR2$AccumInput_VLR2=cumsum(ModelDFSL_VLR2$MInput_VLR2)

#Create Monthly Growths for each carbon pool
ModelDFSL_VLR2$MGrowth_DPM_VLR2 <- ave(ModelDFSL_VLR2$DPM_VLR2, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLR2$MGrowth_RPM_VLR2 <- ave(ModelDFSL_VLR2$RPM_VLR2, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLR2$MGrowth_BIO_VLR2 <- ave(ModelDFSL_VLR2$BIO_VLR2, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLR2$MGrowth_HUM_VLR2 <- ave(ModelDFSL_VLR2$HUM_VLR2, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLR2$MGrowth_IOM_VLR2 <- ave(ModelDFSL_VLR2$IOM_VLR2, FUN = function(x) c(0, diff(x)))

#Create column for Monthly and Accumulated C-CO2 emissions
ModelDFSL_VLR2$M_CCO2_VLR2 <- ModelDFSL_VLR2$MInput_VLR2 - ModelDFSL_VLR2$MGrowth_DPM_VLR2 - ModelDFSL_VLR2$MGrowth_RPM_VLR2 - ModelDFSL_VLR2$MGrowth_BIO_VLR2 - ModelDFSL_VLR2$MGrowth_HUM_VLR2
ModelDFSL_VLR2$Accum_CCO2_VLR2 <- ModelDFSL_VLR2$AccumInput_VLR2 - ModelDFSL_VLR2$AllPools_noIOM_VLR2

#Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
ModelDFSL_VLR2$M_CCO2_VLR2[1] <- 0
ModelDFSL_VLR2$Accum_CCO2_VLR2[1] <- 0

#Balance validation
ModelDFSL_VLR2$Balance_VLR2 <- ModelDFSL_VLR2$AccumInput_VLR2 - ModelDFSL_VLR2$Accum_CCO2_VLR2 - (ModelDFSL_VLR2$DPM_VLR2 + ModelDFSL_VLR2$RPM_VLR2 + ModelDFSL_VLR2$BIO_VLR2 + ModelDFSL_VLR2$HUM_VLR2)

#Convert C-CO2 emissions into CO2 emissions
ModelDFSL_VLR2$M_CO2_VLR2 <- ModelDFSL_VLR2$M_CCO2_VLR2 * 44/12
ModelDFSL_VLR2$Accum_CO2_VLR2 <- ModelDFSL_VLR2$Accum_CCO2_VLR2 * 44/12

#This model will be called VLR2C because implies a continuous input of C
ModelDFSL_VLR2C <- ModelDFSL_VLR2

#Export the dataframe
write_xlsx(ModelDFSL_VLR2C,"VXC_Models\\ModelDFSL_R_VLR2C.xlsx")

#Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
#Create two equal models by using the above general script
#Create model t=x
ModelDFSLt0_VLR2 <- ModelDFSL_VLR2 #Create model t=x

#Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
ModelDFSLt1_VLR2.1 <- rbind(c(0:0), ModelDFSLt0_VLR2)
ModelDFSLt1_VLR2.2 <- rbind(c(0:0), ModelDFSLt1_VLR2.1)
ModelDFSLt1_VLR2.3 <- rbind(c(0:0), ModelDFSLt1_VLR2.2)
ModelDFSLt1_VLR2.4 <- rbind(c(0:0), ModelDFSLt1_VLR2.3)
ModelDFSLt1_VLR2.5 <- rbind(c(0:0), ModelDFSLt1_VLR2.4)
ModelDFSLt1_VLR2.6 <- rbind(c(0:0), ModelDFSLt1_VLR2.5)
ModelDFSLt1_VLR2.7 <- rbind(c(0:0), ModelDFSLt1_VLR2.6)
ModelDFSLt1_VLR2.8 <- rbind(c(0:0), ModelDFSLt1_VLR2.7)
ModelDFSLt1_VLR2.9 <- rbind(c(0:0), ModelDFSLt1_VLR2.8)
ModelDFSLt1_VLR2.10 <- rbind(c(0:0), ModelDFSLt1_VLR2.9)
ModelDFSLt1_VLR2.11 <- rbind(c(0:0), ModelDFSLt1_VLR2.10)
ModelDFSLt1_VLR2.12 <- rbind(c(0:0), ModelDFSLt1_VLR2.11)
ModelDFSLt1_VLR2.13 <- ModelDFSLt1_VLR2.12[-nrow(ModelDFSLt1_VLR2.12),]
ModelDFSLt1_VLR2.14 <- ModelDFSLt1_VLR2.13[-nrow(ModelDFSLt1_VLR2.13),]
ModelDFSLt1_VLR2.15 <- ModelDFSLt1_VLR2.14[-nrow(ModelDFSLt1_VLR2.14),]
ModelDFSLt1_VLR2.16 <- ModelDFSLt1_VLR2.15[-nrow(ModelDFSLt1_VLR2.15),]
ModelDFSLt1_VLR2.17 <- ModelDFSLt1_VLR2.16[-nrow(ModelDFSLt1_VLR2.16),]
ModelDFSLt1_VLR2.18 <- ModelDFSLt1_VLR2.17[-nrow(ModelDFSLt1_VLR2.17),]
ModelDFSLt1_VLR2.19 <- ModelDFSLt1_VLR2.18[-nrow(ModelDFSLt1_VLR2.18),]
ModelDFSLt1_VLR2.20 <- ModelDFSLt1_VLR2.19[-nrow(ModelDFSLt1_VLR2.19),]
ModelDFSLt1_VLR2.21 <- ModelDFSLt1_VLR2.20[-nrow(ModelDFSLt1_VLR2.20),]
ModelDFSLt1_VLR2.22 <- ModelDFSLt1_VLR2.21[-nrow(ModelDFSLt1_VLR2.21),]
ModelDFSLt1_VLR2.23 <- ModelDFSLt1_VLR2.22[-nrow(ModelDFSLt1_VLR2.22),]
ModelDFSLt1_VLR2.24 <- ModelDFSLt1_VLR2.23[-nrow(ModelDFSLt1_VLR2.23),]

ModelDFSLt1_VLR2 <- ModelDFSLt1_VLR2.24 #Create model t=x+1

#Subtract model (t=x) - (t=x+1)
ModelDFSL1y_VLR2 <- ModelDFSLt0_VLR2 - ModelDFSLt1_VLR2

#Re-do Month Number column because the substraction was also applied to it
ModelDFSL1y_VLR2$MNumber <- seq(from = 1, to = SimulationLength_months)

#This model will be called VLR2P because implies a one-off input of C
ModelDFSL_VLR2P <- ModelDFSL1y_VLR2

#Export the dataframe
write_xlsx(ModelDFSL_VLR2P,"VXP_Models\\ModelDFSL_R_VLR2P.xlsx")

#Plot 3: Interactive Yearly CO2 emissions #
MY <- 12
ModelDFSL_VLR2P_YCO2 <- ModelDFSL_VLR2P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VLR2)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLR2P_YCO2) <- c("Year", "Months", "AnnualCO2_VLR_2")

#Plot 3: Interactive Yearly CO2 emissions considering a delay
GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
ModelDFSL_VLR2P_YCO2D <- merge(ModelDFSL_VLR2P_YCO2, GWP100delay, by = "Year")
ModelDFSL_VLR2P_YCO2D$AnnualCO2D_VLR_2 <- ModelDFSL_VLR2P_YCO2D$AnnualCO2_VLR_2 * ModelDFSL_VLR2P_YCO2D$GWP100

#Plot 4: Interactive Yearly C emissions #
MY <- 12
ModelDFSL_VLR2P_YC <- ModelDFSL_VLR2P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VLR2)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLR2P_YC) <- c("Year", "Months", "CEmissions_VLR_2")

#Plot 5: Interactive Yearly C tails (remaining C in Soil) #
MY <- 12
ModelDFSL_VLR2P_YCT <- ModelDFSL_VLR2P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VLR2)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLR2P_YCT) <- c("Year", "Months", "CTail_VLR_2")

#Save Dataframes for Plots 3.1, 3.2, 4 and 5
write_xlsx(ModelDFSL_VLR2P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VLR2P.xlsx") #Yearly CO2 emissions (no delay)
write_xlsx(ModelDFSL_VLR2P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VLR2P.xlsx") #Yearly CO2 emissions (delay)
write_xlsx(ModelDFSL_VLR2P_YC,"CEmissions_P\\ModelDFSL_R_CE_VLR2P.xlsx") #Yearly C emissions
write_xlsx(ModelDFSL_VLR2P_YCT,"CTails_P\\ModelDFSL_R_CT_VLR2P.xlsx") #Yearly C emissions



#### 8.4 - VLR3) Litter; 30%clay; Reduced Tillage ####
#The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
fT_VLR3=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
fW_VLR3=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                        S.Thick = soil.thick, pClay = clay100*0.3,
                        pE = 1.0, bare = FALSE)$b #Moisture effects per month
xi.frame_VLR3=data.frame(years,rep(fT_VLR3*fW_VLR3,length.out=length(years)))

#To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
Model_VLR3=SoilR::RothCModel(
  t=years, #Simulation Length
  ks=c(k.DPM = 10*RTRM, k.RPM = 0.3*RTRM, k.BIO = 0.66*RTRM, k.HUM = 0.02*RTRM, k.IOM = 0*RTRM), #Decomposition rates for the different pools
  C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
  In=Scalar_LitterCinputs*1, #Amount of litter inputs by time
  FYM = Scalar_ManureCinputs*0, #Amount of Farm Yard Manure by time
  clay=clay100*0.3, #Percent clay in mineral soil
  xi=xi.frame_VLR3) #Loads the model

Ct_VLR3=getC(Model_VLR3) #Calculates stocks for each pool per month

#The results can be plotted with the commands
matplot(years, Ct_VLR3, type="l", lty=1, col=1:5,
        xlab="Time (years)", ylab="C stocks (Mg/ha)")
legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
       lty=1, col=1:5, bty="n")

VEC_Lit_VLR3 <- rep(M_Scalar_LitterCinputs*1, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
VEC_Man_VLR3 <- rep(M_Scalar_ManureCinputs*0, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

VEC_LitDF_VLR3 <- as.data.frame(VEC_Lit_VLR3) #Converting the Litter vector to a data frame
VEC_LitDF_VLR3$MNumber <- seq(from = 1, to = SimulationLength_months)
VEC_ManDF_VLR3 <- as.data.frame(VEC_Man_VLR3) #Converting the Manure vector to a data frame
VEC_ManDF_VLR3$MNumber <- seq(from = 1, to = SimulationLength_months)

sapply(VEC_LitDF_VLR3, class) #Check that class is numeric
sapply(VEC_ManDF_VLR3, class) #Check that class is numeric
LitterCinputs_VLR3=VEC_LitDF_VLR3   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
ManureCinputs_VLR3=VEC_ManDF_VLR3 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
MCinputs_VLR3 <- merge(LitterCinputs_VLR3, ManureCinputs_VLR3, by = "MNumber")
MCinputs_VLR3$MInput_VLR3 <- MCinputs_VLR3$VEC_Lit_VLR3 + MCinputs_VLR3$VEC_Man_VLR3

#Change names of litter and manure columns for more common ones
colnames(MCinputs_VLR3)[which(names(MCinputs_VLR3) == "VEC_Lit_VLR3")] <- "LitterC_VLR3"
colnames(MCinputs_VLR3)[which(names(MCinputs_VLR3) == "VEC_Man_VLR3")] <- "ManureC_VLR3"

#Create a dataframe with the data considering the simulation length
ModelDF_VLR3 <- as.data.frame(Ct_VLR3)
colnames(ModelDF_VLR3) <- c('DPM_VLR3','RPM_VLR3','BIO_VLR3', 'HUM_VLR3', 'IOM_VLR3')
ModelDFS_VLR3 <- ModelDF_VLR3[1:SimulationLength_months, ]

#Create a column with the number of month of analysis
ModelDFS_VLR3$MNumber <- seq(from = 1, to = SimulationLength_months)

#Create a column that sums all pools
ModelDFS_VLR3$AllPools_VLR3 <- ModelDFS_VLR3$DPM_VLR3 + ModelDFS_VLR3$RPM_VLR3 + ModelDFS_VLR3$BIO_VLR3 + ModelDFS_VLR3$HUM_VLR3 + ModelDFS_VLR3$IOM_VLR3

#Create a column that sums all pools except IOM (static)
ModelDFS_VLR3$AllPools_noIOM_VLR3 <- ModelDFS_VLR3$DPM_VLR3 + ModelDFS_VLR3$RPM_VLR3 + ModelDFS_VLR3$BIO_VLR3 + ModelDFS_VLR3$HUM_VLR3

#Create a column that add the monthly input of C (manure and litter separately)
ModelDFSL_VLR3 <- merge(ModelDFS_VLR3, MCinputs_VLR3, by = "MNumber")

ModelDFSL_VLR3$MInput_VLR3 <- ModelDFSL_VLR3$LitterC_VLR3 + ModelDFSL_VLR3$ManureC_VLR3
#ModelDF_SL$MInput[1] <- 0

#Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
ModelDFSL_VLR3$CTails_VLR3 <- ModelDFSL_VLR3$AllPools_noIOM_VLR3 + ModelDFSL_VLR3$MInput_VLR3

#Create Monthly Accumulated input of C
ModelDFSL_VLR3$AccumInput_VLR3 = ModelDFSL_VLR3$AccumInput_VLR3=cumsum(ModelDFSL_VLR3$MInput_VLR3)

#Create Monthly Growths for each carbon pool
ModelDFSL_VLR3$MGrowth_DPM_VLR3 <- ave(ModelDFSL_VLR3$DPM_VLR3, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLR3$MGrowth_RPM_VLR3 <- ave(ModelDFSL_VLR3$RPM_VLR3, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLR3$MGrowth_BIO_VLR3 <- ave(ModelDFSL_VLR3$BIO_VLR3, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLR3$MGrowth_HUM_VLR3 <- ave(ModelDFSL_VLR3$HUM_VLR3, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLR3$MGrowth_IOM_VLR3 <- ave(ModelDFSL_VLR3$IOM_VLR3, FUN = function(x) c(0, diff(x)))

#Create column for Monthly and Accumulated C-CO2 emissions
ModelDFSL_VLR3$M_CCO2_VLR3 <- ModelDFSL_VLR3$MInput_VLR3 - ModelDFSL_VLR3$MGrowth_DPM_VLR3 - ModelDFSL_VLR3$MGrowth_RPM_VLR3 - ModelDFSL_VLR3$MGrowth_BIO_VLR3 - ModelDFSL_VLR3$MGrowth_HUM_VLR3
ModelDFSL_VLR3$Accum_CCO2_VLR3 <- ModelDFSL_VLR3$AccumInput_VLR3 - ModelDFSL_VLR3$AllPools_noIOM_VLR3

#Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
ModelDFSL_VLR3$M_CCO2_VLR3[1] <- 0
ModelDFSL_VLR3$Accum_CCO2_VLR3[1] <- 0

#Balance validation
ModelDFSL_VLR3$Balance_VLR3 <- ModelDFSL_VLR3$AccumInput_VLR3 - ModelDFSL_VLR3$Accum_CCO2_VLR3 - (ModelDFSL_VLR3$DPM_VLR3 + ModelDFSL_VLR3$RPM_VLR3 + ModelDFSL_VLR3$BIO_VLR3 + ModelDFSL_VLR3$HUM_VLR3)

#Convert C-CO2 emissions into CO2 emissions
ModelDFSL_VLR3$M_CO2_VLR3 <- ModelDFSL_VLR3$M_CCO2_VLR3 * 44/12
ModelDFSL_VLR3$Accum_CO2_VLR3 <- ModelDFSL_VLR3$Accum_CCO2_VLR3 * 44/12

#This model will be called VLR3C because implies a continuous input of C
ModelDFSL_VLR3C <- ModelDFSL_VLR3

#Export the dataframe
write_xlsx(ModelDFSL_VLR3C,"VXC_Models\\ModelDFSL_R_VLR3C.xlsx")

#Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
#Create two equal models by using the above general script
#Create model t=x
ModelDFSLt0_VLR3 <- ModelDFSL_VLR3 #Create model t=x

#Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
ModelDFSLt1_VLR3.1 <- rbind(c(0:0), ModelDFSLt0_VLR3)
ModelDFSLt1_VLR3.2 <- rbind(c(0:0), ModelDFSLt1_VLR3.1)
ModelDFSLt1_VLR3.3 <- rbind(c(0:0), ModelDFSLt1_VLR3.2)
ModelDFSLt1_VLR3.4 <- rbind(c(0:0), ModelDFSLt1_VLR3.3)
ModelDFSLt1_VLR3.5 <- rbind(c(0:0), ModelDFSLt1_VLR3.4)
ModelDFSLt1_VLR3.6 <- rbind(c(0:0), ModelDFSLt1_VLR3.5)
ModelDFSLt1_VLR3.7 <- rbind(c(0:0), ModelDFSLt1_VLR3.6)
ModelDFSLt1_VLR3.8 <- rbind(c(0:0), ModelDFSLt1_VLR3.7)
ModelDFSLt1_VLR3.9 <- rbind(c(0:0), ModelDFSLt1_VLR3.8)
ModelDFSLt1_VLR3.10 <- rbind(c(0:0), ModelDFSLt1_VLR3.9)
ModelDFSLt1_VLR3.11 <- rbind(c(0:0), ModelDFSLt1_VLR3.10)
ModelDFSLt1_VLR3.12 <- rbind(c(0:0), ModelDFSLt1_VLR3.11)
ModelDFSLt1_VLR3.13 <- ModelDFSLt1_VLR3.12[-nrow(ModelDFSLt1_VLR3.12),]
ModelDFSLt1_VLR3.14 <- ModelDFSLt1_VLR3.13[-nrow(ModelDFSLt1_VLR3.13),]
ModelDFSLt1_VLR3.15 <- ModelDFSLt1_VLR3.14[-nrow(ModelDFSLt1_VLR3.14),]
ModelDFSLt1_VLR3.16 <- ModelDFSLt1_VLR3.15[-nrow(ModelDFSLt1_VLR3.15),]
ModelDFSLt1_VLR3.17 <- ModelDFSLt1_VLR3.16[-nrow(ModelDFSLt1_VLR3.16),]
ModelDFSLt1_VLR3.18 <- ModelDFSLt1_VLR3.17[-nrow(ModelDFSLt1_VLR3.17),]
ModelDFSLt1_VLR3.19 <- ModelDFSLt1_VLR3.18[-nrow(ModelDFSLt1_VLR3.18),]
ModelDFSLt1_VLR3.20 <- ModelDFSLt1_VLR3.19[-nrow(ModelDFSLt1_VLR3.19),]
ModelDFSLt1_VLR3.21 <- ModelDFSLt1_VLR3.20[-nrow(ModelDFSLt1_VLR3.20),]
ModelDFSLt1_VLR3.22 <- ModelDFSLt1_VLR3.21[-nrow(ModelDFSLt1_VLR3.21),]
ModelDFSLt1_VLR3.23 <- ModelDFSLt1_VLR3.22[-nrow(ModelDFSLt1_VLR3.22),]
ModelDFSLt1_VLR3.24 <- ModelDFSLt1_VLR3.23[-nrow(ModelDFSLt1_VLR3.23),]

ModelDFSLt1_VLR3 <- ModelDFSLt1_VLR3.24 #Create model t=x+1

#Subtract model (t=x) - (t=x+1)
ModelDFSL1y_VLR3 <- ModelDFSLt0_VLR3 - ModelDFSLt1_VLR3

#Re-do Month Number column because the substraction was also applied to it
ModelDFSL1y_VLR3$MNumber <- seq(from = 1, to = SimulationLength_months)

#This model will be called VLR3P because implies a one-off input of C
ModelDFSL_VLR3P <- ModelDFSL1y_VLR3

#Export the dataframe
write_xlsx(ModelDFSL_VLR3P,"VXP_Models\\ModelDFSL_R_VLR3P.xlsx")

#Plot 3: Interactive Yearly CO2 emissions #
MY <- 12
ModelDFSL_VLR3P_YCO2 <- ModelDFSL_VLR3P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VLR3)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLR3P_YCO2) <- c("Year", "Months", "AnnualCO2_VLR_3")

#Plot 3: Interactive Yearly CO2 emissions considering a delay
GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
ModelDFSL_VLR3P_YCO2D <- merge(ModelDFSL_VLR3P_YCO2, GWP100delay, by = "Year")
ModelDFSL_VLR3P_YCO2D$AnnualCO2D_VLR_3 <- ModelDFSL_VLR3P_YCO2D$AnnualCO2_VLR_3 * ModelDFSL_VLR3P_YCO2D$GWP100

#Plot 4: Interactive Yearly C emissions #
MY <- 12
ModelDFSL_VLR3P_YC <- ModelDFSL_VLR3P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VLR3)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLR3P_YC) <- c("Year", "Months", "CEmissions_VLR_3")

#Plot 5: Interactive Yearly C tails (remaining C in Soil) #
MY <- 12
ModelDFSL_VLR3P_YCT <- ModelDFSL_VLR3P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VLR3)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLR3P_YCT) <- c("Year", "Months", "CTail_VLR_3")

#Save Dataframes for Plots 3.1, 3.2, 4 and 5
write_xlsx(ModelDFSL_VLR3P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VLR3P.xlsx") #Yearly CO2 emissions (no delay)
write_xlsx(ModelDFSL_VLR3P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VLR3P.xlsx") #Yearly CO2 emissions (delay)
write_xlsx(ModelDFSL_VLR3P_YC,"CEmissions_P\\ModelDFSL_R_CE_VLR3P.xlsx") #Yearly C emissions
write_xlsx(ModelDFSL_VLR3P_YCT,"CTails_P\\ModelDFSL_R_CT_VLR3P.xlsx") #Yearly C emissions



#### 8.5 - VLR4) Litter; 40%clay; Reduced Tillage ####
#The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
fT_VLR4=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
fW_VLR4=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                        S.Thick = soil.thick, pClay = clay100*0.4,
                        pE = 1.0, bare = FALSE)$b #Moisture effects per month
xi.frame_VLR4=data.frame(years,rep(fT_VLR4*fW_VLR4,length.out=length(years)))

#To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
Model_VLR4=SoilR::RothCModel(
  t=years, #Simulation Length
  ks=c(k.DPM = 10*RTRM, k.RPM = 0.3*RTRM, k.BIO = 0.66*RTRM, k.HUM = 0.02*RTRM, k.IOM = 0*RTRM), #Decomposition rates for the different pools
  C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
  In=Scalar_LitterCinputs*1, #Amount of litter inputs by time
  FYM = Scalar_ManureCinputs*0, #Amount of Farm Yard Manure by time
  clay=clay100*0.4, #Percent clay in mineral soil
  xi=xi.frame_VLR4) #Loads the model

Ct_VLR4=getC(Model_VLR4) #Calculates stocks for each pool per month

#The results can be plotted with the commands
matplot(years, Ct_VLR4, type="l", lty=1, col=1:5,
        xlab="Time (years)", ylab="C stocks (Mg/ha)")
legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
       lty=1, col=1:5, bty="n")

VEC_Lit_VLR4 <- rep(M_Scalar_LitterCinputs*1, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
VEC_Man_VLR4 <- rep(M_Scalar_ManureCinputs*0, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

VEC_LitDF_VLR4 <- as.data.frame(VEC_Lit_VLR4) #Converting the Litter vector to a data frame
VEC_LitDF_VLR4$MNumber <- seq(from = 1, to = SimulationLength_months)
VEC_ManDF_VLR4 <- as.data.frame(VEC_Man_VLR4) #Converting the Manure vector to a data frame
VEC_ManDF_VLR4$MNumber <- seq(from = 1, to = SimulationLength_months)

sapply(VEC_LitDF_VLR4, class) #Check that class is numeric
sapply(VEC_ManDF_VLR4, class) #Check that class is numeric
LitterCinputs_VLR4=VEC_LitDF_VLR4   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
ManureCinputs_VLR4=VEC_ManDF_VLR4 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
MCinputs_VLR4 <- merge(LitterCinputs_VLR4, ManureCinputs_VLR4, by = "MNumber")
MCinputs_VLR4$MInput_VLR4 <- MCinputs_VLR4$VEC_Lit_VLR4 + MCinputs_VLR4$VEC_Man_VLR4

#Change names of litter and manure columns for more common ones
colnames(MCinputs_VLR4)[which(names(MCinputs_VLR4) == "VEC_Lit_VLR4")] <- "LitterC_VLR4"
colnames(MCinputs_VLR4)[which(names(MCinputs_VLR4) == "VEC_Man_VLR4")] <- "ManureC_VLR4"

#Create a dataframe with the data considering the simulation length
ModelDF_VLR4 <- as.data.frame(Ct_VLR4)
colnames(ModelDF_VLR4) <- c('DPM_VLR4','RPM_VLR4','BIO_VLR4', 'HUM_VLR4', 'IOM_VLR4')
ModelDFS_VLR4 <- ModelDF_VLR4[1:SimulationLength_months, ]

#Create a column with the number of month of analysis
ModelDFS_VLR4$MNumber <- seq(from = 1, to = SimulationLength_months)

#Create a column that sums all pools
ModelDFS_VLR4$AllPools_VLR4 <- ModelDFS_VLR4$DPM_VLR4 + ModelDFS_VLR4$RPM_VLR4 + ModelDFS_VLR4$BIO_VLR4 + ModelDFS_VLR4$HUM_VLR4 + ModelDFS_VLR4$IOM_VLR4

#Create a column that sums all pools except IOM (static)
ModelDFS_VLR4$AllPools_noIOM_VLR4 <- ModelDFS_VLR4$DPM_VLR4 + ModelDFS_VLR4$RPM_VLR4 + ModelDFS_VLR4$BIO_VLR4 + ModelDFS_VLR4$HUM_VLR4

#Create a column that add the monthly input of C (manure and litter separately)
ModelDFSL_VLR4 <- merge(ModelDFS_VLR4, MCinputs_VLR4, by = "MNumber")

ModelDFSL_VLR4$MInput_VLR4 <- ModelDFSL_VLR4$LitterC_VLR4 + ModelDFSL_VLR4$ManureC_VLR4
#ModelDF_SL$MInput[1] <- 0

#Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
ModelDFSL_VLR4$CTails_VLR4 <- ModelDFSL_VLR4$AllPools_noIOM_VLR4 + ModelDFSL_VLR4$MInput_VLR4

#Create Monthly Accumulated input of C
ModelDFSL_VLR4$AccumInput_VLR4 = ModelDFSL_VLR4$AccumInput_VLR4=cumsum(ModelDFSL_VLR4$MInput_VLR4)

#Create Monthly Growths for each carbon pool
ModelDFSL_VLR4$MGrowth_DPM_VLR4 <- ave(ModelDFSL_VLR4$DPM_VLR4, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLR4$MGrowth_RPM_VLR4 <- ave(ModelDFSL_VLR4$RPM_VLR4, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLR4$MGrowth_BIO_VLR4 <- ave(ModelDFSL_VLR4$BIO_VLR4, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLR4$MGrowth_HUM_VLR4 <- ave(ModelDFSL_VLR4$HUM_VLR4, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLR4$MGrowth_IOM_VLR4 <- ave(ModelDFSL_VLR4$IOM_VLR4, FUN = function(x) c(0, diff(x)))

#Create column for Monthly and Accumulated C-CO2 emissions
ModelDFSL_VLR4$M_CCO2_VLR4 <- ModelDFSL_VLR4$MInput_VLR4 - ModelDFSL_VLR4$MGrowth_DPM_VLR4 - ModelDFSL_VLR4$MGrowth_RPM_VLR4 - ModelDFSL_VLR4$MGrowth_BIO_VLR4 - ModelDFSL_VLR4$MGrowth_HUM_VLR4
ModelDFSL_VLR4$Accum_CCO2_VLR4 <- ModelDFSL_VLR4$AccumInput_VLR4 - ModelDFSL_VLR4$AllPools_noIOM_VLR4

#Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
ModelDFSL_VLR4$M_CCO2_VLR4[1] <- 0
ModelDFSL_VLR4$Accum_CCO2_VLR4[1] <- 0

#Balance validation
ModelDFSL_VLR4$Balance_VLR4 <- ModelDFSL_VLR4$AccumInput_VLR4 - ModelDFSL_VLR4$Accum_CCO2_VLR4 - (ModelDFSL_VLR4$DPM_VLR4 + ModelDFSL_VLR4$RPM_VLR4 + ModelDFSL_VLR4$BIO_VLR4 + ModelDFSL_VLR4$HUM_VLR4)

#Convert C-CO2 emissions into CO2 emissions
ModelDFSL_VLR4$M_CO2_VLR4 <- ModelDFSL_VLR4$M_CCO2_VLR4 * 44/12
ModelDFSL_VLR4$Accum_CO2_VLR4 <- ModelDFSL_VLR4$Accum_CCO2_VLR4 * 44/12

#This model will be called VLR4C because implies a continuous input of C
ModelDFSL_VLR4C <- ModelDFSL_VLR4

#Export the dataframe
write_xlsx(ModelDFSL_VLR4C,"VXC_Models\\ModelDFSL_R_VLR4C.xlsx")

#Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
#Create two equal models by using the above general script
#Create model t=x
ModelDFSLt0_VLR4 <- ModelDFSL_VLR4 #Create model t=x

#Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
ModelDFSLt1_VLR4.1 <- rbind(c(0:0), ModelDFSLt0_VLR4)
ModelDFSLt1_VLR4.2 <- rbind(c(0:0), ModelDFSLt1_VLR4.1)
ModelDFSLt1_VLR4.3 <- rbind(c(0:0), ModelDFSLt1_VLR4.2)
ModelDFSLt1_VLR4.4 <- rbind(c(0:0), ModelDFSLt1_VLR4.3)
ModelDFSLt1_VLR4.5 <- rbind(c(0:0), ModelDFSLt1_VLR4.4)
ModelDFSLt1_VLR4.6 <- rbind(c(0:0), ModelDFSLt1_VLR4.5)
ModelDFSLt1_VLR4.7 <- rbind(c(0:0), ModelDFSLt1_VLR4.6)
ModelDFSLt1_VLR4.8 <- rbind(c(0:0), ModelDFSLt1_VLR4.7)
ModelDFSLt1_VLR4.9 <- rbind(c(0:0), ModelDFSLt1_VLR4.8)
ModelDFSLt1_VLR4.10 <- rbind(c(0:0), ModelDFSLt1_VLR4.9)
ModelDFSLt1_VLR4.11 <- rbind(c(0:0), ModelDFSLt1_VLR4.10)
ModelDFSLt1_VLR4.12 <- rbind(c(0:0), ModelDFSLt1_VLR4.11)
ModelDFSLt1_VLR4.13 <- ModelDFSLt1_VLR4.12[-nrow(ModelDFSLt1_VLR4.12),]
ModelDFSLt1_VLR4.14 <- ModelDFSLt1_VLR4.13[-nrow(ModelDFSLt1_VLR4.13),]
ModelDFSLt1_VLR4.15 <- ModelDFSLt1_VLR4.14[-nrow(ModelDFSLt1_VLR4.14),]
ModelDFSLt1_VLR4.16 <- ModelDFSLt1_VLR4.15[-nrow(ModelDFSLt1_VLR4.15),]
ModelDFSLt1_VLR4.17 <- ModelDFSLt1_VLR4.16[-nrow(ModelDFSLt1_VLR4.16),]
ModelDFSLt1_VLR4.18 <- ModelDFSLt1_VLR4.17[-nrow(ModelDFSLt1_VLR4.17),]
ModelDFSLt1_VLR4.19 <- ModelDFSLt1_VLR4.18[-nrow(ModelDFSLt1_VLR4.18),]
ModelDFSLt1_VLR4.20 <- ModelDFSLt1_VLR4.19[-nrow(ModelDFSLt1_VLR4.19),]
ModelDFSLt1_VLR4.21 <- ModelDFSLt1_VLR4.20[-nrow(ModelDFSLt1_VLR4.20),]
ModelDFSLt1_VLR4.22 <- ModelDFSLt1_VLR4.21[-nrow(ModelDFSLt1_VLR4.21),]
ModelDFSLt1_VLR4.23 <- ModelDFSLt1_VLR4.22[-nrow(ModelDFSLt1_VLR4.22),]
ModelDFSLt1_VLR4.24 <- ModelDFSLt1_VLR4.23[-nrow(ModelDFSLt1_VLR4.23),]

ModelDFSLt1_VLR4 <- ModelDFSLt1_VLR4.24 #Create model t=x+1

#Subtract model (t=x) - (t=x+1)
ModelDFSL1y_VLR4 <- ModelDFSLt0_VLR4 - ModelDFSLt1_VLR4

#Re-do Month Number column because the substraction was also applied to it
ModelDFSL1y_VLR4$MNumber <- seq(from = 1, to = SimulationLength_months)

#This model will be called VLR4P because implies a one-off input of C
ModelDFSL_VLR4P <- ModelDFSL1y_VLR4

#Export the dataframe
write_xlsx(ModelDFSL_VLR4P,"VXP_Models\\ModelDFSL_R_VLR4P.xlsx")

#Plot 3: Interactive Yearly CO2 emissions #
MY <- 12
ModelDFSL_VLR4P_YCO2 <- ModelDFSL_VLR4P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VLR4)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLR4P_YCO2) <- c("Year", "Months", "AnnualCO2_VLR_4")

#Plot 3: Interactive Yearly CO2 emissions considering a delay
GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
ModelDFSL_VLR4P_YCO2D <- merge(ModelDFSL_VLR4P_YCO2, GWP100delay, by = "Year")
ModelDFSL_VLR4P_YCO2D$AnnualCO2D_VLR_4 <- ModelDFSL_VLR4P_YCO2D$AnnualCO2_VLR_4 * ModelDFSL_VLR4P_YCO2D$GWP100

#Plot 4: Interactive Yearly C emissions #
MY <- 12
ModelDFSL_VLR4P_YC <- ModelDFSL_VLR4P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VLR4)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLR4P_YC) <- c("Year", "Months", "CEmissions_VLR_4")

#Plot 5: Interactive Yearly C tails (remaining C in Soil) #
MY <- 12
ModelDFSL_VLR4P_YCT <- ModelDFSL_VLR4P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VLR4)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLR4P_YCT) <- c("Year", "Months", "CTail_VLR_4")

#Save Dataframes for Plots 3.1, 3.2, 4 and 5
write_xlsx(ModelDFSL_VLR4P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VLR4P.xlsx") #Yearly CO2 emissions (no delay)
write_xlsx(ModelDFSL_VLR4P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VLR4P.xlsx") #Yearly CO2 emissions (delay)
write_xlsx(ModelDFSL_VLR4P_YC,"CEmissions_P\\ModelDFSL_R_CE_VLR4P.xlsx") #Yearly C emissions
write_xlsx(ModelDFSL_VLR4P_YCT,"CTails_P\\ModelDFSL_R_CT_VLR4P.xlsx") #Yearly C emissions



#### 8.6 - VLR5) Litter; 50%clay; Reduced Tillage ####
#The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
fT_VLR5=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
fW_VLR5=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                        S.Thick = soil.thick, pClay = clay100*0.5,
                        pE = 1.0, bare = FALSE)$b #Moisture effects per month
xi.frame_VLR5=data.frame(years,rep(fT_VLR5*fW_VLR5,length.out=length(years)))

#To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
Model_VLR5=SoilR::RothCModel(
  t=years, #Simulation Length
  ks=c(k.DPM = 10*RTRM, k.RPM = 0.3*RTRM, k.BIO = 0.66*RTRM, k.HUM = 0.02*RTRM, k.IOM = 0*RTRM), #Decomposition rates for the different pools
  C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
  In=Scalar_LitterCinputs*1, #Amount of litter inputs by time
  FYM = Scalar_ManureCinputs*0, #Amount of Farm Yard Manure by time
  clay=clay100*0.5, #Percent clay in mineral soil
  xi=xi.frame_VLR5) #Loads the model

Ct_VLR5=getC(Model_VLR5) #Calculates stocks for each pool per month

#The results can be plotted with the commands
matplot(years, Ct_VLR5, type="l", lty=1, col=1:5,
        xlab="Time (years)", ylab="C stocks (Mg/ha)")
legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
       lty=1, col=1:5, bty="n")

VEC_Lit_VLR5 <- rep(M_Scalar_LitterCinputs*1, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
VEC_Man_VLR5 <- rep(M_Scalar_ManureCinputs*0, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

VEC_LitDF_VLR5 <- as.data.frame(VEC_Lit_VLR5) #Converting the Litter vector to a data frame
VEC_LitDF_VLR5$MNumber <- seq(from = 1, to = SimulationLength_months)
VEC_ManDF_VLR5 <- as.data.frame(VEC_Man_VLR5) #Converting the Manure vector to a data frame
VEC_ManDF_VLR5$MNumber <- seq(from = 1, to = SimulationLength_months)

sapply(VEC_LitDF_VLR5, class) #Check that class is numeric
sapply(VEC_ManDF_VLR5, class) #Check that class is numeric
LitterCinputs_VLR5=VEC_LitDF_VLR5   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
ManureCinputs_VLR5=VEC_ManDF_VLR5 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
MCinputs_VLR5 <- merge(LitterCinputs_VLR5, ManureCinputs_VLR5, by = "MNumber")
MCinputs_VLR5$MInput_VLR5 <- MCinputs_VLR5$VEC_Lit_VLR5 + MCinputs_VLR5$VEC_Man_VLR5

#Change names of litter and manure columns for more common ones
colnames(MCinputs_VLR5)[which(names(MCinputs_VLR5) == "VEC_Lit_VLR5")] <- "LitterC_VLR5"
colnames(MCinputs_VLR5)[which(names(MCinputs_VLR5) == "VEC_Man_VLR5")] <- "ManureC_VLR5"

#Create a dataframe with the data considering the simulation length
ModelDF_VLR5 <- as.data.frame(Ct_VLR5)
colnames(ModelDF_VLR5) <- c('DPM_VLR5','RPM_VLR5','BIO_VLR5', 'HUM_VLR5', 'IOM_VLR5')
ModelDFS_VLR5 <- ModelDF_VLR5[1:SimulationLength_months, ]

#Create a column with the number of month of analysis
ModelDFS_VLR5$MNumber <- seq(from = 1, to = SimulationLength_months)

#Create a column that sums all pools
ModelDFS_VLR5$AllPools_VLR5 <- ModelDFS_VLR5$DPM_VLR5 + ModelDFS_VLR5$RPM_VLR5 + ModelDFS_VLR5$BIO_VLR5 + ModelDFS_VLR5$HUM_VLR5 + ModelDFS_VLR5$IOM_VLR5

#Create a column that sums all pools except IOM (static)
ModelDFS_VLR5$AllPools_noIOM_VLR5 <- ModelDFS_VLR5$DPM_VLR5 + ModelDFS_VLR5$RPM_VLR5 + ModelDFS_VLR5$BIO_VLR5 + ModelDFS_VLR5$HUM_VLR5

#Create a column that add the monthly input of C (manure and litter separately)
ModelDFSL_VLR5 <- merge(ModelDFS_VLR5, MCinputs_VLR5, by = "MNumber")

ModelDFSL_VLR5$MInput_VLR5 <- ModelDFSL_VLR5$LitterC_VLR5 + ModelDFSL_VLR5$ManureC_VLR5
#ModelDF_SL$MInput[1] <- 0

#Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
ModelDFSL_VLR5$CTails_VLR5 <- ModelDFSL_VLR5$AllPools_noIOM_VLR5 + ModelDFSL_VLR5$MInput_VLR5

#Create Monthly Accumulated input of C
ModelDFSL_VLR5$AccumInput_VLR5 = ModelDFSL_VLR5$AccumInput_VLR5=cumsum(ModelDFSL_VLR5$MInput_VLR5)

#Create Monthly Growths for each carbon pool
ModelDFSL_VLR5$MGrowth_DPM_VLR5 <- ave(ModelDFSL_VLR5$DPM_VLR5, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLR5$MGrowth_RPM_VLR5 <- ave(ModelDFSL_VLR5$RPM_VLR5, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLR5$MGrowth_BIO_VLR5 <- ave(ModelDFSL_VLR5$BIO_VLR5, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLR5$MGrowth_HUM_VLR5 <- ave(ModelDFSL_VLR5$HUM_VLR5, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLR5$MGrowth_IOM_VLR5 <- ave(ModelDFSL_VLR5$IOM_VLR5, FUN = function(x) c(0, diff(x)))

#Create column for Monthly and Accumulated C-CO2 emissions
ModelDFSL_VLR5$M_CCO2_VLR5 <- ModelDFSL_VLR5$MInput_VLR5 - ModelDFSL_VLR5$MGrowth_DPM_VLR5 - ModelDFSL_VLR5$MGrowth_RPM_VLR5 - ModelDFSL_VLR5$MGrowth_BIO_VLR5 - ModelDFSL_VLR5$MGrowth_HUM_VLR5
ModelDFSL_VLR5$Accum_CCO2_VLR5 <- ModelDFSL_VLR5$AccumInput_VLR5 - ModelDFSL_VLR5$AllPools_noIOM_VLR5

#Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
ModelDFSL_VLR5$M_CCO2_VLR5[1] <- 0
ModelDFSL_VLR5$Accum_CCO2_VLR5[1] <- 0

#Balance validation
ModelDFSL_VLR5$Balance_VLR5 <- ModelDFSL_VLR5$AccumInput_VLR5 - ModelDFSL_VLR5$Accum_CCO2_VLR5 - (ModelDFSL_VLR5$DPM_VLR5 + ModelDFSL_VLR5$RPM_VLR5 + ModelDFSL_VLR5$BIO_VLR5 + ModelDFSL_VLR5$HUM_VLR5)

#Convert C-CO2 emissions into CO2 emissions
ModelDFSL_VLR5$M_CO2_VLR5 <- ModelDFSL_VLR5$M_CCO2_VLR5 * 44/12
ModelDFSL_VLR5$Accum_CO2_VLR5 <- ModelDFSL_VLR5$Accum_CCO2_VLR5 * 44/12

#This model will be called VLR5C because implies a continuous input of C
ModelDFSL_VLR5C <- ModelDFSL_VLR5

#Export the dataframe
write_xlsx(ModelDFSL_VLR5C,"VXC_Models\\ModelDFSL_R_VLR5C.xlsx")

#Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
#Create two equal models by using the above general script
#Create model t=x
ModelDFSLt0_VLR5 <- ModelDFSL_VLR5 #Create model t=x

#Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
ModelDFSLt1_VLR5.1 <- rbind(c(0:0), ModelDFSLt0_VLR5)
ModelDFSLt1_VLR5.2 <- rbind(c(0:0), ModelDFSLt1_VLR5.1)
ModelDFSLt1_VLR5.3 <- rbind(c(0:0), ModelDFSLt1_VLR5.2)
ModelDFSLt1_VLR5.4 <- rbind(c(0:0), ModelDFSLt1_VLR5.3)
ModelDFSLt1_VLR5.5 <- rbind(c(0:0), ModelDFSLt1_VLR5.4)
ModelDFSLt1_VLR5.6 <- rbind(c(0:0), ModelDFSLt1_VLR5.5)
ModelDFSLt1_VLR5.7 <- rbind(c(0:0), ModelDFSLt1_VLR5.6)
ModelDFSLt1_VLR5.8 <- rbind(c(0:0), ModelDFSLt1_VLR5.7)
ModelDFSLt1_VLR5.9 <- rbind(c(0:0), ModelDFSLt1_VLR5.8)
ModelDFSLt1_VLR5.10 <- rbind(c(0:0), ModelDFSLt1_VLR5.9)
ModelDFSLt1_VLR5.11 <- rbind(c(0:0), ModelDFSLt1_VLR5.10)
ModelDFSLt1_VLR5.12 <- rbind(c(0:0), ModelDFSLt1_VLR5.11)
ModelDFSLt1_VLR5.13 <- ModelDFSLt1_VLR5.12[-nrow(ModelDFSLt1_VLR5.12),]
ModelDFSLt1_VLR5.14 <- ModelDFSLt1_VLR5.13[-nrow(ModelDFSLt1_VLR5.13),]
ModelDFSLt1_VLR5.15 <- ModelDFSLt1_VLR5.14[-nrow(ModelDFSLt1_VLR5.14),]
ModelDFSLt1_VLR5.16 <- ModelDFSLt1_VLR5.15[-nrow(ModelDFSLt1_VLR5.15),]
ModelDFSLt1_VLR5.17 <- ModelDFSLt1_VLR5.16[-nrow(ModelDFSLt1_VLR5.16),]
ModelDFSLt1_VLR5.18 <- ModelDFSLt1_VLR5.17[-nrow(ModelDFSLt1_VLR5.17),]
ModelDFSLt1_VLR5.19 <- ModelDFSLt1_VLR5.18[-nrow(ModelDFSLt1_VLR5.18),]
ModelDFSLt1_VLR5.20 <- ModelDFSLt1_VLR5.19[-nrow(ModelDFSLt1_VLR5.19),]
ModelDFSLt1_VLR5.21 <- ModelDFSLt1_VLR5.20[-nrow(ModelDFSLt1_VLR5.20),]
ModelDFSLt1_VLR5.22 <- ModelDFSLt1_VLR5.21[-nrow(ModelDFSLt1_VLR5.21),]
ModelDFSLt1_VLR5.23 <- ModelDFSLt1_VLR5.22[-nrow(ModelDFSLt1_VLR5.22),]
ModelDFSLt1_VLR5.24 <- ModelDFSLt1_VLR5.23[-nrow(ModelDFSLt1_VLR5.23),]

ModelDFSLt1_VLR5 <- ModelDFSLt1_VLR5.24 #Create model t=x+1

#Subtract model (t=x) - (t=x+1)
ModelDFSL1y_VLR5 <- ModelDFSLt0_VLR5 - ModelDFSLt1_VLR5

#Re-do Month Number column because the substraction was also applied to it
ModelDFSL1y_VLR5$MNumber <- seq(from = 1, to = SimulationLength_months)

#This model will be called VLR5P because implies a one-off input of C
ModelDFSL_VLR5P <- ModelDFSL1y_VLR5

#Export the dataframe
write_xlsx(ModelDFSL_VLR5P,"VXP_Models\\ModelDFSL_R_VLR5P.xlsx")


#Plot 3: Interactive Yearly CO2 emissions #
MY <- 12
ModelDFSL_VLR5P_YCO2 <- ModelDFSL_VLR5P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VLR5)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLR5P_YCO2) <- c("Year", "Months", "AnnualCO2_VLR_5")


#Plot 3: Interactive Yearly CO2 emissions considering a delay
GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
ModelDFSL_VLR5P_YCO2D <- merge(ModelDFSL_VLR5P_YCO2, GWP100delay, by = "Year")
ModelDFSL_VLR5P_YCO2D$AnnualCO2D_VLR_5 <- ModelDFSL_VLR5P_YCO2D$AnnualCO2_VLR_5 * ModelDFSL_VLR5P_YCO2D$GWP100

#Plot 4: Interactive Yearly C emissions #
MY <- 12
ModelDFSL_VLR5P_YC <- ModelDFSL_VLR5P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VLR5)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLR5P_YC) <- c("Year", "Months", "CEmissions_VLR_5")


#Plot 5: Interactive Yearly C tails (remaining C in Soil) #
MY <- 12
ModelDFSL_VLR5P_YCT <- ModelDFSL_VLR5P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VLR5)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLR5P_YCT) <- c("Year", "Months", "CTail_VLR_5")

#Save Dataframes for Plots 3.1, 3.2, 4 and 5
write_xlsx(ModelDFSL_VLR5P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VLR5P.xlsx") #Yearly CO2 emissions (no delay)
write_xlsx(ModelDFSL_VLR5P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VLR5P.xlsx") #Yearly CO2 emissions (delay)
write_xlsx(ModelDFSL_VLR5P_YC,"CEmissions_P\\ModelDFSL_R_CE_VLR5P.xlsx") #Yearly C emissions
write_xlsx(ModelDFSL_VLR5P_YCT,"CTails_P\\ModelDFSL_R_CT_VLR5P.xlsx") #Yearly C emissions



#### 8.7 - VLR6) Litter; 60%clay; Reduced Tillage ####
#The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
fT_VLR6=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
fW_VLR6=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                        S.Thick = soil.thick, pClay = clay100*0.6,
                        pE = 1.0, bare = FALSE)$b #Moisture effects per month
xi.frame_VLR6=data.frame(years,rep(fT_VLR6*fW_VLR6,length.out=length(years)))

#To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
Model_VLR6=SoilR::RothCModel(
  t=years, #Simulation Length
  ks=c(k.DPM = 10*RTRM, k.RPM = 0.3*RTRM, k.BIO = 0.66*RTRM, k.HUM = 0.02*RTRM, k.IOM = 0*RTRM), #Decomposition rates for the different pools
  C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
  In=Scalar_LitterCinputs*1, #Amount of litter inputs by time
  FYM = Scalar_ManureCinputs*0, #Amount of Farm Yard Manure by time
  clay=clay100*0.6, #Percent clay in mineral soil
  xi=xi.frame_VLR6) #Loads the model

Ct_VLR6=getC(Model_VLR6) #Calculates stocks for each pool per month

#The results can be plotted with the commands
matplot(years, Ct_VLR6, type="l", lty=1, col=1:5,
        xlab="Time (years)", ylab="C stocks (Mg/ha)")
legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
       lty=1, col=1:5, bty="n")

VEC_Lit_VLR6 <- rep(M_Scalar_LitterCinputs*1, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
VEC_Man_VLR6 <- rep(M_Scalar_ManureCinputs*0, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

VEC_LitDF_VLR6 <- as.data.frame(VEC_Lit_VLR6) #Converting the Litter vector to a data frame
VEC_LitDF_VLR6$MNumber <- seq(from = 1, to = SimulationLength_months)
VEC_ManDF_VLR6 <- as.data.frame(VEC_Man_VLR6) #Converting the Manure vector to a data frame
VEC_ManDF_VLR6$MNumber <- seq(from = 1, to = SimulationLength_months)

sapply(VEC_LitDF_VLR6, class) #Check that class is numeric
sapply(VEC_ManDF_VLR6, class) #Check that class is numeric
LitterCinputs_VLR6=VEC_LitDF_VLR6   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
ManureCinputs_VLR6=VEC_ManDF_VLR6 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
MCinputs_VLR6 <- merge(LitterCinputs_VLR6, ManureCinputs_VLR6, by = "MNumber")
MCinputs_VLR6$MInput_VLR6 <- MCinputs_VLR6$VEC_Lit_VLR6 + MCinputs_VLR6$VEC_Man_VLR6

#Change names of litter and manure columns for more common ones
colnames(MCinputs_VLR6)[which(names(MCinputs_VLR6) == "VEC_Lit_VLR6")] <- "LitterC_VLR6"
colnames(MCinputs_VLR6)[which(names(MCinputs_VLR6) == "VEC_Man_VLR6")] <- "ManureC_VLR6"

#Create a dataframe with the data considering the simulation length
ModelDF_VLR6 <- as.data.frame(Ct_VLR6)
colnames(ModelDF_VLR6) <- c('DPM_VLR6','RPM_VLR6','BIO_VLR6', 'HUM_VLR6', 'IOM_VLR6')
ModelDFS_VLR6 <- ModelDF_VLR6[1:SimulationLength_months, ]

#Create a column with the number of month of analysis
ModelDFS_VLR6$MNumber <- seq(from = 1, to = SimulationLength_months)

#Create a column that sums all pools
ModelDFS_VLR6$AllPools_VLR6 <- ModelDFS_VLR6$DPM_VLR6 + ModelDFS_VLR6$RPM_VLR6 + ModelDFS_VLR6$BIO_VLR6 + ModelDFS_VLR6$HUM_VLR6 + ModelDFS_VLR6$IOM_VLR6

#Create a column that sums all pools except IOM (static)
ModelDFS_VLR6$AllPools_noIOM_VLR6 <- ModelDFS_VLR6$DPM_VLR6 + ModelDFS_VLR6$RPM_VLR6 + ModelDFS_VLR6$BIO_VLR6 + ModelDFS_VLR6$HUM_VLR6

#Create a column that add the monthly input of C (manure and litter separately)
ModelDFSL_VLR6 <- merge(ModelDFS_VLR6, MCinputs_VLR6, by = "MNumber")

ModelDFSL_VLR6$MInput_VLR6 <- ModelDFSL_VLR6$LitterC_VLR6 + ModelDFSL_VLR6$ManureC_VLR6
#ModelDF_SL$MInput[1] <- 0

#Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
ModelDFSL_VLR6$CTails_VLR6 <- ModelDFSL_VLR6$AllPools_noIOM_VLR6 + ModelDFSL_VLR6$MInput_VLR6

#Create Monthly Accumulated input of C
ModelDFSL_VLR6$AccumInput_VLR6 = ModelDFSL_VLR6$AccumInput_VLR6=cumsum(ModelDFSL_VLR6$MInput_VLR6)

#Create Monthly Growths for each carbon pool
ModelDFSL_VLR6$MGrowth_DPM_VLR6 <- ave(ModelDFSL_VLR6$DPM_VLR6, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLR6$MGrowth_RPM_VLR6 <- ave(ModelDFSL_VLR6$RPM_VLR6, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLR6$MGrowth_BIO_VLR6 <- ave(ModelDFSL_VLR6$BIO_VLR6, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLR6$MGrowth_HUM_VLR6 <- ave(ModelDFSL_VLR6$HUM_VLR6, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLR6$MGrowth_IOM_VLR6 <- ave(ModelDFSL_VLR6$IOM_VLR6, FUN = function(x) c(0, diff(x)))

#Create column for Monthly and Accumulated C-CO2 emissions
ModelDFSL_VLR6$M_CCO2_VLR6 <- ModelDFSL_VLR6$MInput_VLR6 - ModelDFSL_VLR6$MGrowth_DPM_VLR6 - ModelDFSL_VLR6$MGrowth_RPM_VLR6 - ModelDFSL_VLR6$MGrowth_BIO_VLR6 - ModelDFSL_VLR6$MGrowth_HUM_VLR6
ModelDFSL_VLR6$Accum_CCO2_VLR6 <- ModelDFSL_VLR6$AccumInput_VLR6 - ModelDFSL_VLR6$AllPools_noIOM_VLR6

#Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
ModelDFSL_VLR6$M_CCO2_VLR6[1] <- 0
ModelDFSL_VLR6$Accum_CCO2_VLR6[1] <- 0

#Balance validation
ModelDFSL_VLR6$Balance_VLR6 <- ModelDFSL_VLR6$AccumInput_VLR6 - ModelDFSL_VLR6$Accum_CCO2_VLR6 - (ModelDFSL_VLR6$DPM_VLR6 + ModelDFSL_VLR6$RPM_VLR6 + ModelDFSL_VLR6$BIO_VLR6 + ModelDFSL_VLR6$HUM_VLR6)

#Convert C-CO2 emissions into CO2 emissions
ModelDFSL_VLR6$M_CO2_VLR6 <- ModelDFSL_VLR6$M_CCO2_VLR6 * 44/12
ModelDFSL_VLR6$Accum_CO2_VLR6 <- ModelDFSL_VLR6$Accum_CCO2_VLR6 * 44/12

#This model will be called VLR6C because implies a continuous input of C
ModelDFSL_VLR6C <- ModelDFSL_VLR6

#Export the dataframe
write_xlsx(ModelDFSL_VLR6C,"VXC_Models\\ModelDFSL_R_VLR6C.xlsx")

#Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
#Create two equal models by using the above general script
#Create model t=x
ModelDFSLt0_VLR6 <- ModelDFSL_VLR6 #Create model t=x

#Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
ModelDFSLt1_VLR6.1 <- rbind(c(0:0), ModelDFSLt0_VLR6)
ModelDFSLt1_VLR6.2 <- rbind(c(0:0), ModelDFSLt1_VLR6.1)
ModelDFSLt1_VLR6.3 <- rbind(c(0:0), ModelDFSLt1_VLR6.2)
ModelDFSLt1_VLR6.4 <- rbind(c(0:0), ModelDFSLt1_VLR6.3)
ModelDFSLt1_VLR6.5 <- rbind(c(0:0), ModelDFSLt1_VLR6.4)
ModelDFSLt1_VLR6.6 <- rbind(c(0:0), ModelDFSLt1_VLR6.5)
ModelDFSLt1_VLR6.7 <- rbind(c(0:0), ModelDFSLt1_VLR6.6)
ModelDFSLt1_VLR6.8 <- rbind(c(0:0), ModelDFSLt1_VLR6.7)
ModelDFSLt1_VLR6.9 <- rbind(c(0:0), ModelDFSLt1_VLR6.8)
ModelDFSLt1_VLR6.10 <- rbind(c(0:0), ModelDFSLt1_VLR6.9)
ModelDFSLt1_VLR6.11 <- rbind(c(0:0), ModelDFSLt1_VLR6.10)
ModelDFSLt1_VLR6.12 <- rbind(c(0:0), ModelDFSLt1_VLR6.11)
ModelDFSLt1_VLR6.13 <- ModelDFSLt1_VLR6.12[-nrow(ModelDFSLt1_VLR6.12),]
ModelDFSLt1_VLR6.14 <- ModelDFSLt1_VLR6.13[-nrow(ModelDFSLt1_VLR6.13),]
ModelDFSLt1_VLR6.15 <- ModelDFSLt1_VLR6.14[-nrow(ModelDFSLt1_VLR6.14),]
ModelDFSLt1_VLR6.16 <- ModelDFSLt1_VLR6.15[-nrow(ModelDFSLt1_VLR6.15),]
ModelDFSLt1_VLR6.17 <- ModelDFSLt1_VLR6.16[-nrow(ModelDFSLt1_VLR6.16),]
ModelDFSLt1_VLR6.18 <- ModelDFSLt1_VLR6.17[-nrow(ModelDFSLt1_VLR6.17),]
ModelDFSLt1_VLR6.19 <- ModelDFSLt1_VLR6.18[-nrow(ModelDFSLt1_VLR6.18),]
ModelDFSLt1_VLR6.20 <- ModelDFSLt1_VLR6.19[-nrow(ModelDFSLt1_VLR6.19),]
ModelDFSLt1_VLR6.21 <- ModelDFSLt1_VLR6.20[-nrow(ModelDFSLt1_VLR6.20),]
ModelDFSLt1_VLR6.22 <- ModelDFSLt1_VLR6.21[-nrow(ModelDFSLt1_VLR6.21),]
ModelDFSLt1_VLR6.23 <- ModelDFSLt1_VLR6.22[-nrow(ModelDFSLt1_VLR6.22),]
ModelDFSLt1_VLR6.24 <- ModelDFSLt1_VLR6.23[-nrow(ModelDFSLt1_VLR6.23),]

ModelDFSLt1_VLR6 <- ModelDFSLt1_VLR6.24 #Create model t=x+1

#Subtract model (t=x) - (t=x+1)
ModelDFSL1y_VLR6 <- ModelDFSLt0_VLR6 - ModelDFSLt1_VLR6

#Re-do Month Number column because the substraction was also applied to it
ModelDFSL1y_VLR6$MNumber <- seq(from = 1, to = SimulationLength_months)

#This model will be called VLR6P because implies a one-off input of C
ModelDFSL_VLR6P <- ModelDFSL1y_VLR6

#Export the dataframe
write_xlsx(ModelDFSL_VLR6P,"VXP_Models\\ModelDFSL_R_VLR6P.xlsx")

#Plot 3: Interactive Yearly CO2 emissions #
MY <- 12
ModelDFSL_VLR6P_YCO2 <- ModelDFSL_VLR6P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VLR6)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLR6P_YCO2) <- c("Year", "Months", "AnnualCO2_VLR_6")


#Plot 3: Interactive Yearly CO2 emissions considering a delay
GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
ModelDFSL_VLR6P_YCO2D <- merge(ModelDFSL_VLR6P_YCO2, GWP100delay, by = "Year")
ModelDFSL_VLR6P_YCO2D$AnnualCO2D_VLR_6 <- ModelDFSL_VLR6P_YCO2D$AnnualCO2_VLR_6 * ModelDFSL_VLR6P_YCO2D$GWP100

#Plot 4: Interactive Yearly C emissions #
MY <- 12
ModelDFSL_VLR6P_YC <- ModelDFSL_VLR6P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VLR6)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLR6P_YC) <- c("Year", "Months", "CEmissions_VLR_6")


#Plot 5: Interactive Yearly C tails (remaining C in Soil) #
MY <- 12
ModelDFSL_VLR6P_YCT <- ModelDFSL_VLR6P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VLR6)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLR6P_YCT) <- c("Year", "Months", "CTail_VLR_6")

#Save Dataframes for Plots 3.1, 3.2, 4 and 5
write_xlsx(ModelDFSL_VLR6P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VLR6P.xlsx") #Yearly CO2 emissions (no delay)
write_xlsx(ModelDFSL_VLR6P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VLR6P.xlsx") #Yearly CO2 emissions (delay)
write_xlsx(ModelDFSL_VLR6P_YC,"CEmissions_P\\ModelDFSL_R_CE_VLR6P.xlsx") #Yearly C emissions
write_xlsx(ModelDFSL_VLR6P_YCT,"CTails_P\\ModelDFSL_R_CT_VLR6P.xlsx") #Yearly C emissions



#### 8.8 - VLR7) Litter; 70%clay; Reduced Tillage ####
#The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
fT_VLR7=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
fW_VLR7=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                        S.Thick = soil.thick, pClay = clay100*0.7,
                        pE = 1.0, bare = FALSE)$b #Moisture effects per month
xi.frame_VLR7=data.frame(years,rep(fT_VLR7*fW_VLR7,length.out=length(years)))

#To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
Model_VLR7=SoilR::RothCModel(
  t=years, #Simulation Length
  ks=c(k.DPM = 10*RTRM, k.RPM = 0.3*RTRM, k.BIO = 0.66*RTRM, k.HUM = 0.02*RTRM, k.IOM = 0*RTRM), #Decomposition rates for the different pools
  C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
  In=Scalar_LitterCinputs*1, #Amount of litter inputs by time
  FYM = Scalar_ManureCinputs*0, #Amount of Farm Yard Manure by time
  clay=clay100*0.7, #Percent clay in mineral soil
  xi=xi.frame_VLR7) #Loads the model

Ct_VLR7=getC(Model_VLR7) #Calculates stocks for each pool per month

#The results can be plotted with the commands
matplot(years, Ct_VLR7, type="l", lty=1, col=1:5,
        xlab="Time (years)", ylab="C stocks (Mg/ha)")
legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
       lty=1, col=1:5, bty="n")

VEC_Lit_VLR7 <- rep(M_Scalar_LitterCinputs*1, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
VEC_Man_VLR7 <- rep(M_Scalar_ManureCinputs*0, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

VEC_LitDF_VLR7 <- as.data.frame(VEC_Lit_VLR7) #Converting the Litter vector to a data frame
VEC_LitDF_VLR7$MNumber <- seq(from = 1, to = SimulationLength_months)
VEC_ManDF_VLR7 <- as.data.frame(VEC_Man_VLR7) #Converting the Manure vector to a data frame
VEC_ManDF_VLR7$MNumber <- seq(from = 1, to = SimulationLength_months)

sapply(VEC_LitDF_VLR7, class) #Check that class is numeric
sapply(VEC_ManDF_VLR7, class) #Check that class is numeric
LitterCinputs_VLR7=VEC_LitDF_VLR7   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
ManureCinputs_VLR7=VEC_ManDF_VLR7 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
MCinputs_VLR7 <- merge(LitterCinputs_VLR7, ManureCinputs_VLR7, by = "MNumber")
MCinputs_VLR7$MInput_VLR7 <- MCinputs_VLR7$VEC_Lit_VLR7 + MCinputs_VLR7$VEC_Man_VLR7

#Change names of litter and manure columns for more common ones
colnames(MCinputs_VLR7)[which(names(MCinputs_VLR7) == "VEC_Lit_VLR7")] <- "LitterC_VLR7"
colnames(MCinputs_VLR7)[which(names(MCinputs_VLR7) == "VEC_Man_VLR7")] <- "ManureC_VLR7"

#Create a dataframe with the data considering the simulation length
ModelDF_VLR7 <- as.data.frame(Ct_VLR7)
colnames(ModelDF_VLR7) <- c('DPM_VLR7','RPM_VLR7','BIO_VLR7', 'HUM_VLR7', 'IOM_VLR7')
ModelDFS_VLR7 <- ModelDF_VLR7[1:SimulationLength_months, ]

#Create a column with the number of month of analysis
ModelDFS_VLR7$MNumber <- seq(from = 1, to = SimulationLength_months)

#Create a column that sums all pools
ModelDFS_VLR7$AllPools_VLR7 <- ModelDFS_VLR7$DPM_VLR7 + ModelDFS_VLR7$RPM_VLR7 + ModelDFS_VLR7$BIO_VLR7 + ModelDFS_VLR7$HUM_VLR7 + ModelDFS_VLR7$IOM_VLR7

#Create a column that sums all pools except IOM (static)
ModelDFS_VLR7$AllPools_noIOM_VLR7 <- ModelDFS_VLR7$DPM_VLR7 + ModelDFS_VLR7$RPM_VLR7 + ModelDFS_VLR7$BIO_VLR7 + ModelDFS_VLR7$HUM_VLR7

#Create a column that add the monthly input of C (manure and litter separately)
ModelDFSL_VLR7 <- merge(ModelDFS_VLR7, MCinputs_VLR7, by = "MNumber")

ModelDFSL_VLR7$MInput_VLR7 <- ModelDFSL_VLR7$LitterC_VLR7 + ModelDFSL_VLR7$ManureC_VLR7
#ModelDF_SL$MInput[1] <- 0

#Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
ModelDFSL_VLR7$CTails_VLR7 <- ModelDFSL_VLR7$AllPools_noIOM_VLR7 + ModelDFSL_VLR7$MInput_VLR7

#Create Monthly Accumulated input of C
ModelDFSL_VLR7$AccumInput_VLR7 = ModelDFSL_VLR7$AccumInput_VLR7=cumsum(ModelDFSL_VLR7$MInput_VLR7)

#Create Monthly Growths for each carbon pool
ModelDFSL_VLR7$MGrowth_DPM_VLR7 <- ave(ModelDFSL_VLR7$DPM_VLR7, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLR7$MGrowth_RPM_VLR7 <- ave(ModelDFSL_VLR7$RPM_VLR7, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLR7$MGrowth_BIO_VLR7 <- ave(ModelDFSL_VLR7$BIO_VLR7, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLR7$MGrowth_HUM_VLR7 <- ave(ModelDFSL_VLR7$HUM_VLR7, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLR7$MGrowth_IOM_VLR7 <- ave(ModelDFSL_VLR7$IOM_VLR7, FUN = function(x) c(0, diff(x)))

#Create column for Monthly and Accumulated C-CO2 emissions
ModelDFSL_VLR7$M_CCO2_VLR7 <- ModelDFSL_VLR7$MInput_VLR7 - ModelDFSL_VLR7$MGrowth_DPM_VLR7 - ModelDFSL_VLR7$MGrowth_RPM_VLR7 - ModelDFSL_VLR7$MGrowth_BIO_VLR7 - ModelDFSL_VLR7$MGrowth_HUM_VLR7
ModelDFSL_VLR7$Accum_CCO2_VLR7 <- ModelDFSL_VLR7$AccumInput_VLR7 - ModelDFSL_VLR7$AllPools_noIOM_VLR7

#Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
ModelDFSL_VLR7$M_CCO2_VLR7[1] <- 0
ModelDFSL_VLR7$Accum_CCO2_VLR7[1] <- 0

#Balance validation
ModelDFSL_VLR7$Balance_VLR7 <- ModelDFSL_VLR7$AccumInput_VLR7 - ModelDFSL_VLR7$Accum_CCO2_VLR7 - (ModelDFSL_VLR7$DPM_VLR7 + ModelDFSL_VLR7$RPM_VLR7 + ModelDFSL_VLR7$BIO_VLR7 + ModelDFSL_VLR7$HUM_VLR7)

#Convert C-CO2 emissions into CO2 emissions
ModelDFSL_VLR7$M_CO2_VLR7 <- ModelDFSL_VLR7$M_CCO2_VLR7 * 44/12
ModelDFSL_VLR7$Accum_CO2_VLR7 <- ModelDFSL_VLR7$Accum_CCO2_VLR7 * 44/12

#This model will be called VLR7C because implies a continuous input of C
ModelDFSL_VLR7C <- ModelDFSL_VLR7

#Export the dataframe
write_xlsx(ModelDFSL_VLR7C,"VXC_Models\\ModelDFSL_R_VLR7C.xlsx")

#Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
#Create two equal models by using the above general script
#Create model t=x
ModelDFSLt0_VLR7 <- ModelDFSL_VLR7 #Create model t=x

#Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
ModelDFSLt1_VLR7.1 <- rbind(c(0:0), ModelDFSLt0_VLR7)
ModelDFSLt1_VLR7.2 <- rbind(c(0:0), ModelDFSLt1_VLR7.1)
ModelDFSLt1_VLR7.3 <- rbind(c(0:0), ModelDFSLt1_VLR7.2)
ModelDFSLt1_VLR7.4 <- rbind(c(0:0), ModelDFSLt1_VLR7.3)
ModelDFSLt1_VLR7.5 <- rbind(c(0:0), ModelDFSLt1_VLR7.4)
ModelDFSLt1_VLR7.6 <- rbind(c(0:0), ModelDFSLt1_VLR7.5)
ModelDFSLt1_VLR7.7 <- rbind(c(0:0), ModelDFSLt1_VLR7.6)
ModelDFSLt1_VLR7.8 <- rbind(c(0:0), ModelDFSLt1_VLR7.7)
ModelDFSLt1_VLR7.9 <- rbind(c(0:0), ModelDFSLt1_VLR7.8)
ModelDFSLt1_VLR7.10 <- rbind(c(0:0), ModelDFSLt1_VLR7.9)
ModelDFSLt1_VLR7.11 <- rbind(c(0:0), ModelDFSLt1_VLR7.10)
ModelDFSLt1_VLR7.12 <- rbind(c(0:0), ModelDFSLt1_VLR7.11)
ModelDFSLt1_VLR7.13 <- ModelDFSLt1_VLR7.12[-nrow(ModelDFSLt1_VLR7.12),]
ModelDFSLt1_VLR7.14 <- ModelDFSLt1_VLR7.13[-nrow(ModelDFSLt1_VLR7.13),]
ModelDFSLt1_VLR7.15 <- ModelDFSLt1_VLR7.14[-nrow(ModelDFSLt1_VLR7.14),]
ModelDFSLt1_VLR7.16 <- ModelDFSLt1_VLR7.15[-nrow(ModelDFSLt1_VLR7.15),]
ModelDFSLt1_VLR7.17 <- ModelDFSLt1_VLR7.16[-nrow(ModelDFSLt1_VLR7.16),]
ModelDFSLt1_VLR7.18 <- ModelDFSLt1_VLR7.17[-nrow(ModelDFSLt1_VLR7.17),]
ModelDFSLt1_VLR7.19 <- ModelDFSLt1_VLR7.18[-nrow(ModelDFSLt1_VLR7.18),]
ModelDFSLt1_VLR7.20 <- ModelDFSLt1_VLR7.19[-nrow(ModelDFSLt1_VLR7.19),]
ModelDFSLt1_VLR7.21 <- ModelDFSLt1_VLR7.20[-nrow(ModelDFSLt1_VLR7.20),]
ModelDFSLt1_VLR7.22 <- ModelDFSLt1_VLR7.21[-nrow(ModelDFSLt1_VLR7.21),]
ModelDFSLt1_VLR7.23 <- ModelDFSLt1_VLR7.22[-nrow(ModelDFSLt1_VLR7.22),]
ModelDFSLt1_VLR7.24 <- ModelDFSLt1_VLR7.23[-nrow(ModelDFSLt1_VLR7.23),]

ModelDFSLt1_VLR7 <- ModelDFSLt1_VLR7.24 #Create model t=x+1

#Subtract model (t=x) - (t=x+1)
ModelDFSL1y_VLR7 <- ModelDFSLt0_VLR7 - ModelDFSLt1_VLR7

#Re-do Month Number column because the substraction was also applied to it
ModelDFSL1y_VLR7$MNumber <- seq(from = 1, to = SimulationLength_months)

#This model will be called VLR7P because implies a one-off input of C
ModelDFSL_VLR7P <- ModelDFSL1y_VLR7

#Export the dataframe
write_xlsx(ModelDFSL_VLR7P,"VXP_Models\\ModelDFSL_R_VLR7P.xlsx")

#Plot 3: Interactive Yearly CO2 emissions #
MY <- 12
ModelDFSL_VLR7P_YCO2 <- ModelDFSL_VLR7P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VLR7)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLR7P_YCO2) <- c("Year", "Months", "AnnualCO2_VLR_7")


#Plot 3: Interactive Yearly CO2 emissions considering a delay
GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
ModelDFSL_VLR7P_YCO2D <- merge(ModelDFSL_VLR7P_YCO2, GWP100delay, by = "Year")
ModelDFSL_VLR7P_YCO2D$AnnualCO2D_VLR_7 <- ModelDFSL_VLR7P_YCO2D$AnnualCO2_VLR_7 * ModelDFSL_VLR7P_YCO2D$GWP100

#Plot 4: Interactive Yearly C emissions #
MY <- 12
ModelDFSL_VLR7P_YC <- ModelDFSL_VLR7P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VLR7)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLR7P_YC) <- c("Year", "Months", "CEmissions_VLR_7")


#Plot 5: Interactive Yearly C tails (remaining C in Soil) #
MY <- 12
ModelDFSL_VLR7P_YCT <- ModelDFSL_VLR7P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VLR7)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLR7P_YCT) <- c("Year", "Months", "CTail_VLR_7")


#Save Dataframes for Plots 3.1, 3.2, 4 and 5
write_xlsx(ModelDFSL_VLR7P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VLR7P.xlsx") #Yearly CO2 emissions (no delay)
write_xlsx(ModelDFSL_VLR7P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VLR7P.xlsx") #Yearly CO2 emissions (delay)
write_xlsx(ModelDFSL_VLR7P_YC,"CEmissions_P\\ModelDFSL_R_CE_VLR7P.xlsx") #Yearly C emissions
write_xlsx(ModelDFSL_VLR7P_YCT,"CTails_P\\ModelDFSL_R_CT_VLR7P.xlsx") #Yearly C emissions



#### 8.9 - VLR8) Litter; 80%clay; Reduced Tillage ####
#The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
fT_VLR8=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
fW_VLR8=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                        S.Thick = soil.thick, pClay = clay100*0.8,
                        pE = 1.0, bare = FALSE)$b #Moisture effects per month
xi.frame_VLR8=data.frame(years,rep(fT_VLR8*fW_VLR8,length.out=length(years)))

#To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
Model_VLR8=SoilR::RothCModel(
  t=years, #Simulation Length
  ks=c(k.DPM = 10*RTRM, k.RPM = 0.3*RTRM, k.BIO = 0.66*RTRM, k.HUM = 0.02*RTRM, k.IOM = 0*RTRM), #Decomposition rates for the different pools
  C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
  In=Scalar_LitterCinputs*1, #Amount of litter inputs by time
  FYM = Scalar_ManureCinputs*0, #Amount of Farm Yard Manure by time
  clay=clay100*0.8, #Percent clay in mineral soil
  xi=xi.frame_VLR8) #Loads the model

Ct_VLR8=getC(Model_VLR8) #Calculates stocks for each pool per month

#The results can be plotted with the commands
matplot(years, Ct_VLR8, type="l", lty=1, col=1:5,
        xlab="Time (years)", ylab="C stocks (Mg/ha)")
legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
       lty=1, col=1:5, bty="n")

VEC_Lit_VLR8 <- rep(M_Scalar_LitterCinputs*1, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
VEC_Man_VLR8 <- rep(M_Scalar_ManureCinputs*0, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

VEC_LitDF_VLR8 <- as.data.frame(VEC_Lit_VLR8) #Converting the Litter vector to a data frame
VEC_LitDF_VLR8$MNumber <- seq(from = 1, to = SimulationLength_months)
VEC_ManDF_VLR8 <- as.data.frame(VEC_Man_VLR8) #Converting the Manure vector to a data frame
VEC_ManDF_VLR8$MNumber <- seq(from = 1, to = SimulationLength_months)

sapply(VEC_LitDF_VLR8, class) #Check that class is numeric
sapply(VEC_ManDF_VLR8, class) #Check that class is numeric
LitterCinputs_VLR8=VEC_LitDF_VLR8   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
ManureCinputs_VLR8=VEC_ManDF_VLR8 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
MCinputs_VLR8 <- merge(LitterCinputs_VLR8, ManureCinputs_VLR8, by = "MNumber")
MCinputs_VLR8$MInput_VLR8 <- MCinputs_VLR8$VEC_Lit_VLR8 + MCinputs_VLR8$VEC_Man_VLR8

#Change names of litter and manure columns for more common ones
colnames(MCinputs_VLR8)[which(names(MCinputs_VLR8) == "VEC_Lit_VLR8")] <- "LitterC_VLR8"
colnames(MCinputs_VLR8)[which(names(MCinputs_VLR8) == "VEC_Man_VLR8")] <- "ManureC_VLR8"

#Create a dataframe with the data considering the simulation length
ModelDF_VLR8 <- as.data.frame(Ct_VLR8)
colnames(ModelDF_VLR8) <- c('DPM_VLR8','RPM_VLR8','BIO_VLR8', 'HUM_VLR8', 'IOM_VLR8')
ModelDFS_VLR8 <- ModelDF_VLR8[1:SimulationLength_months, ]

#Create a column with the number of month of analysis
ModelDFS_VLR8$MNumber <- seq(from = 1, to = SimulationLength_months)

#Create a column that sums all pools
ModelDFS_VLR8$AllPools_VLR8 <- ModelDFS_VLR8$DPM_VLR8 + ModelDFS_VLR8$RPM_VLR8 + ModelDFS_VLR8$BIO_VLR8 + ModelDFS_VLR8$HUM_VLR8 + ModelDFS_VLR8$IOM_VLR8

#Create a column that sums all pools except IOM (static)
ModelDFS_VLR8$AllPools_noIOM_VLR8 <- ModelDFS_VLR8$DPM_VLR8 + ModelDFS_VLR8$RPM_VLR8 + ModelDFS_VLR8$BIO_VLR8 + ModelDFS_VLR8$HUM_VLR8

#Create a column that add the monthly input of C (manure and litter separately)
ModelDFSL_VLR8 <- merge(ModelDFS_VLR8, MCinputs_VLR8, by = "MNumber")

ModelDFSL_VLR8$MInput_VLR8 <- ModelDFSL_VLR8$LitterC_VLR8 + ModelDFSL_VLR8$ManureC_VLR8
#ModelDF_SL$MInput[1] <- 0

#Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
ModelDFSL_VLR8$CTails_VLR8 <- ModelDFSL_VLR8$AllPools_noIOM_VLR8 + ModelDFSL_VLR8$MInput_VLR8

#Create Monthly Accumulated input of C
ModelDFSL_VLR8$AccumInput_VLR8 = ModelDFSL_VLR8$AccumInput_VLR8=cumsum(ModelDFSL_VLR8$MInput_VLR8)

#Create Monthly Growths for each carbon pool
ModelDFSL_VLR8$MGrowth_DPM_VLR8 <- ave(ModelDFSL_VLR8$DPM_VLR8, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLR8$MGrowth_RPM_VLR8 <- ave(ModelDFSL_VLR8$RPM_VLR8, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLR8$MGrowth_BIO_VLR8 <- ave(ModelDFSL_VLR8$BIO_VLR8, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLR8$MGrowth_HUM_VLR8 <- ave(ModelDFSL_VLR8$HUM_VLR8, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLR8$MGrowth_IOM_VLR8 <- ave(ModelDFSL_VLR8$IOM_VLR8, FUN = function(x) c(0, diff(x)))

#Create column for Monthly and Accumulated C-CO2 emissions
ModelDFSL_VLR8$M_CCO2_VLR8 <- ModelDFSL_VLR8$MInput_VLR8 - ModelDFSL_VLR8$MGrowth_DPM_VLR8 - ModelDFSL_VLR8$MGrowth_RPM_VLR8 - ModelDFSL_VLR8$MGrowth_BIO_VLR8 - ModelDFSL_VLR8$MGrowth_HUM_VLR8
ModelDFSL_VLR8$Accum_CCO2_VLR8 <- ModelDFSL_VLR8$AccumInput_VLR8 - ModelDFSL_VLR8$AllPools_noIOM_VLR8

#Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
ModelDFSL_VLR8$M_CCO2_VLR8[1] <- 0
ModelDFSL_VLR8$Accum_CCO2_VLR8[1] <- 0

#Balance validation
ModelDFSL_VLR8$Balance_VLR8 <- ModelDFSL_VLR8$AccumInput_VLR8 - ModelDFSL_VLR8$Accum_CCO2_VLR8 - (ModelDFSL_VLR8$DPM_VLR8 + ModelDFSL_VLR8$RPM_VLR8 + ModelDFSL_VLR8$BIO_VLR8 + ModelDFSL_VLR8$HUM_VLR8)

#Convert C-CO2 emissions into CO2 emissions
ModelDFSL_VLR8$M_CO2_VLR8 <- ModelDFSL_VLR8$M_CCO2_VLR8 * 44/12
ModelDFSL_VLR8$Accum_CO2_VLR8 <- ModelDFSL_VLR8$Accum_CCO2_VLR8 * 44/12

#This model will be called VLR8C because implies a continuous input of C
ModelDFSL_VLR8C <- ModelDFSL_VLR8

#Export the dataframe
write_xlsx(ModelDFSL_VLR8C,"VXC_Models\\ModelDFSL_R_VLR8C.xlsx")

#Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
#Create two equal models by using the above general script
#Create model t=x
ModelDFSLt0_VLR8 <- ModelDFSL_VLR8 #Create model t=x

#Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
ModelDFSLt1_VLR8.1 <- rbind(c(0:0), ModelDFSLt0_VLR8)
ModelDFSLt1_VLR8.2 <- rbind(c(0:0), ModelDFSLt1_VLR8.1)
ModelDFSLt1_VLR8.3 <- rbind(c(0:0), ModelDFSLt1_VLR8.2)
ModelDFSLt1_VLR8.4 <- rbind(c(0:0), ModelDFSLt1_VLR8.3)
ModelDFSLt1_VLR8.5 <- rbind(c(0:0), ModelDFSLt1_VLR8.4)
ModelDFSLt1_VLR8.6 <- rbind(c(0:0), ModelDFSLt1_VLR8.5)
ModelDFSLt1_VLR8.7 <- rbind(c(0:0), ModelDFSLt1_VLR8.6)
ModelDFSLt1_VLR8.8 <- rbind(c(0:0), ModelDFSLt1_VLR8.7)
ModelDFSLt1_VLR8.9 <- rbind(c(0:0), ModelDFSLt1_VLR8.8)
ModelDFSLt1_VLR8.10 <- rbind(c(0:0), ModelDFSLt1_VLR8.9)
ModelDFSLt1_VLR8.11 <- rbind(c(0:0), ModelDFSLt1_VLR8.10)
ModelDFSLt1_VLR8.12 <- rbind(c(0:0), ModelDFSLt1_VLR8.11)
ModelDFSLt1_VLR8.13 <- ModelDFSLt1_VLR8.12[-nrow(ModelDFSLt1_VLR8.12),]
ModelDFSLt1_VLR8.14 <- ModelDFSLt1_VLR8.13[-nrow(ModelDFSLt1_VLR8.13),]
ModelDFSLt1_VLR8.15 <- ModelDFSLt1_VLR8.14[-nrow(ModelDFSLt1_VLR8.14),]
ModelDFSLt1_VLR8.16 <- ModelDFSLt1_VLR8.15[-nrow(ModelDFSLt1_VLR8.15),]
ModelDFSLt1_VLR8.17 <- ModelDFSLt1_VLR8.16[-nrow(ModelDFSLt1_VLR8.16),]
ModelDFSLt1_VLR8.18 <- ModelDFSLt1_VLR8.17[-nrow(ModelDFSLt1_VLR8.17),]
ModelDFSLt1_VLR8.19 <- ModelDFSLt1_VLR8.18[-nrow(ModelDFSLt1_VLR8.18),]
ModelDFSLt1_VLR8.20 <- ModelDFSLt1_VLR8.19[-nrow(ModelDFSLt1_VLR8.19),]
ModelDFSLt1_VLR8.21 <- ModelDFSLt1_VLR8.20[-nrow(ModelDFSLt1_VLR8.20),]
ModelDFSLt1_VLR8.22 <- ModelDFSLt1_VLR8.21[-nrow(ModelDFSLt1_VLR8.21),]
ModelDFSLt1_VLR8.23 <- ModelDFSLt1_VLR8.22[-nrow(ModelDFSLt1_VLR8.22),]
ModelDFSLt1_VLR8.24 <- ModelDFSLt1_VLR8.23[-nrow(ModelDFSLt1_VLR8.23),]

ModelDFSLt1_VLR8 <- ModelDFSLt1_VLR8.24 #Create model t=x+1

#Subtract model (t=x) - (t=x+1)
ModelDFSL1y_VLR8 <- ModelDFSLt0_VLR8 - ModelDFSLt1_VLR8

#Re-do Month Number column because the substraction was also applied to it
ModelDFSL1y_VLR8$MNumber <- seq(from = 1, to = SimulationLength_months)

#This model will be called VLR8P because implies a one-off input of C
ModelDFSL_VLR8P <- ModelDFSL1y_VLR8

#Export the dataframe
write_xlsx(ModelDFSL_VLR8P,"VXP_Models\\ModelDFSL_R_VLR8P.xlsx")


#Plot 3: Interactive Yearly CO2 emissions #
MY <- 12
ModelDFSL_VLR8P_YCO2 <- ModelDFSL_VLR8P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VLR8)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLR8P_YCO2) <- c("Year", "Months", "AnnualCO2_VLR_8")

#Plot 3: Interactive Yearly CO2 emissions considering a delay
GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
ModelDFSL_VLR8P_YCO2D <- merge(ModelDFSL_VLR8P_YCO2, GWP100delay, by = "Year")
ModelDFSL_VLR8P_YCO2D$AnnualCO2D_VLR_8 <- ModelDFSL_VLR8P_YCO2D$AnnualCO2_VLR_8 * ModelDFSL_VLR8P_YCO2D$GWP100


#Plot 4: Interactive Yearly C emissions #
MY <- 12
ModelDFSL_VLR8P_YC <- ModelDFSL_VLR8P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VLR8)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLR8P_YC) <- c("Year", "Months", "CEmissions_VLR_8")

#Plot 5: Interactive Yearly C tails (remaining C in Soil) #
MY <- 12
ModelDFSL_VLR8P_YCT <- ModelDFSL_VLR8P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VLR8)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLR8P_YCT) <- c("Year", "Months", "CTail_VLR_8")

#Save Dataframes for Plots 3.1, 3.2, 4 and 5
write_xlsx(ModelDFSL_VLR8P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VLR8P.xlsx") #Yearly CO2 emissions (no delay)
write_xlsx(ModelDFSL_VLR8P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VLR8P.xlsx") #Yearly CO2 emissions (delay)
write_xlsx(ModelDFSL_VLR8P_YC,"CEmissions_P\\ModelDFSL_R_CE_VLR8P.xlsx") #Yearly C emissions
write_xlsx(ModelDFSL_VLR8P_YCT,"CTails_P\\ModelDFSL_R_CT_VLR8P.xlsx") #Yearly C emissions



#### 8.10 - VLR9) Litter; 90%clay; Reduced Tillage ####
#The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
fT_VLR9=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
fW_VLR9=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                        S.Thick = soil.thick, pClay = clay100*0.9,
                        pE = 1.0, bare = FALSE)$b #Moisture effects per month
xi.frame_VLR9=data.frame(years,rep(fT_VLR9*fW_VLR9,length.out=length(years)))

#To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
Model_VLR9=SoilR::RothCModel(
  t=years, #Simulation Length
  ks=c(k.DPM = 10*RTRM, k.RPM = 0.3*RTRM, k.BIO = 0.66*RTRM, k.HUM = 0.02*RTRM, k.IOM = 0*RTRM), #Decomposition rates for the different pools
  C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
  In=Scalar_LitterCinputs*1, #Amount of litter inputs by time
  FYM = Scalar_ManureCinputs*0, #Amount of Farm Yard Manure by time
  clay=clay100*0.9, #Percent clay in mineral soil
  xi=xi.frame_VLR9) #Loads the model

Ct_VLR9=getC(Model_VLR9) #Calculates stocks for each pool per month

#The results can be plotted with the commands
matplot(years, Ct_VLR9, type="l", lty=1, col=1:5,
        xlab="Time (years)", ylab="C stocks (Mg/ha)")
legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
       lty=1, col=1:5, bty="n")

VEC_Lit_VLR9 <- rep(M_Scalar_LitterCinputs*1, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
VEC_Man_VLR9 <- rep(M_Scalar_ManureCinputs*0, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

VEC_LitDF_VLR9 <- as.data.frame(VEC_Lit_VLR9) #Converting the Litter vector to a data frame
VEC_LitDF_VLR9$MNumber <- seq(from = 1, to = SimulationLength_months)
VEC_ManDF_VLR9 <- as.data.frame(VEC_Man_VLR9) #Converting the Manure vector to a data frame
VEC_ManDF_VLR9$MNumber <- seq(from = 1, to = SimulationLength_months)

sapply(VEC_LitDF_VLR9, class) #Check that class is numeric
sapply(VEC_ManDF_VLR9, class) #Check that class is numeric
LitterCinputs_VLR9=VEC_LitDF_VLR9   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
ManureCinputs_VLR9=VEC_ManDF_VLR9 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
MCinputs_VLR9 <- merge(LitterCinputs_VLR9, ManureCinputs_VLR9, by = "MNumber")
MCinputs_VLR9$MInput_VLR9 <- MCinputs_VLR9$VEC_Lit_VLR9 + MCinputs_VLR9$VEC_Man_VLR9

#Change names of litter and manure columns for more common ones
colnames(MCinputs_VLR9)[which(names(MCinputs_VLR9) == "VEC_Lit_VLR9")] <- "LitterC_VLR9"
colnames(MCinputs_VLR9)[which(names(MCinputs_VLR9) == "VEC_Man_VLR9")] <- "ManureC_VLR9"

#Create a dataframe with the data considering the simulation length
ModelDF_VLR9 <- as.data.frame(Ct_VLR9)
colnames(ModelDF_VLR9) <- c('DPM_VLR9','RPM_VLR9','BIO_VLR9', 'HUM_VLR9', 'IOM_VLR9')
ModelDFS_VLR9 <- ModelDF_VLR9[1:SimulationLength_months, ]

#Create a column with the number of month of analysis
ModelDFS_VLR9$MNumber <- seq(from = 1, to = SimulationLength_months)

#Create a column that sums all pools
ModelDFS_VLR9$AllPools_VLR9 <- ModelDFS_VLR9$DPM_VLR9 + ModelDFS_VLR9$RPM_VLR9 + ModelDFS_VLR9$BIO_VLR9 + ModelDFS_VLR9$HUM_VLR9 + ModelDFS_VLR9$IOM_VLR9

#Create a column that sums all pools except IOM (static)
ModelDFS_VLR9$AllPools_noIOM_VLR9 <- ModelDFS_VLR9$DPM_VLR9 + ModelDFS_VLR9$RPM_VLR9 + ModelDFS_VLR9$BIO_VLR9 + ModelDFS_VLR9$HUM_VLR9

#Create a column that add the monthly input of C (manure and litter separately)
ModelDFSL_VLR9 <- merge(ModelDFS_VLR9, MCinputs_VLR9, by = "MNumber")

ModelDFSL_VLR9$MInput_VLR9 <- ModelDFSL_VLR9$LitterC_VLR9 + ModelDFSL_VLR9$ManureC_VLR9
#ModelDF_SL$MInput[1] <- 0

#Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
ModelDFSL_VLR9$CTails_VLR9 <- ModelDFSL_VLR9$AllPools_noIOM_VLR9 + ModelDFSL_VLR9$MInput_VLR9

#Create Monthly Accumulated input of C
ModelDFSL_VLR9$AccumInput_VLR9 = ModelDFSL_VLR9$AccumInput_VLR9=cumsum(ModelDFSL_VLR9$MInput_VLR9)

#Create Monthly Growths for each carbon pool
ModelDFSL_VLR9$MGrowth_DPM_VLR9 <- ave(ModelDFSL_VLR9$DPM_VLR9, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLR9$MGrowth_RPM_VLR9 <- ave(ModelDFSL_VLR9$RPM_VLR9, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLR9$MGrowth_BIO_VLR9 <- ave(ModelDFSL_VLR9$BIO_VLR9, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLR9$MGrowth_HUM_VLR9 <- ave(ModelDFSL_VLR9$HUM_VLR9, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLR9$MGrowth_IOM_VLR9 <- ave(ModelDFSL_VLR9$IOM_VLR9, FUN = function(x) c(0, diff(x)))

#Create column for Monthly and Accumulated C-CO2 emissions
ModelDFSL_VLR9$M_CCO2_VLR9 <- ModelDFSL_VLR9$MInput_VLR9 - ModelDFSL_VLR9$MGrowth_DPM_VLR9 - ModelDFSL_VLR9$MGrowth_RPM_VLR9 - ModelDFSL_VLR9$MGrowth_BIO_VLR9 - ModelDFSL_VLR9$MGrowth_HUM_VLR9
ModelDFSL_VLR9$Accum_CCO2_VLR9 <- ModelDFSL_VLR9$AccumInput_VLR9 - ModelDFSL_VLR9$AllPools_noIOM_VLR9

#Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
ModelDFSL_VLR9$M_CCO2_VLR9[1] <- 0
ModelDFSL_VLR9$Accum_CCO2_VLR9[1] <- 0

#Balance validation
ModelDFSL_VLR9$Balance_VLR9 <- ModelDFSL_VLR9$AccumInput_VLR9 - ModelDFSL_VLR9$Accum_CCO2_VLR9 - (ModelDFSL_VLR9$DPM_VLR9 + ModelDFSL_VLR9$RPM_VLR9 + ModelDFSL_VLR9$BIO_VLR9 + ModelDFSL_VLR9$HUM_VLR9)

#Convert C-CO2 emissions into CO2 emissions
ModelDFSL_VLR9$M_CO2_VLR9 <- ModelDFSL_VLR9$M_CCO2_VLR9 * 44/12
ModelDFSL_VLR9$Accum_CO2_VLR9 <- ModelDFSL_VLR9$Accum_CCO2_VLR9 * 44/12

#This model will be called VLR9C because implies a continuous input of C
ModelDFSL_VLR9C <- ModelDFSL_VLR9

#Export the dataframe
write_xlsx(ModelDFSL_VLR9C,"VXC_Models\\ModelDFSL_R_VLR9C.xlsx")

#Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
#Create two equal models by using the above general script
#Create model t=x
ModelDFSLt0_VLR9 <- ModelDFSL_VLR9 #Create model t=x

#Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
ModelDFSLt1_VLR9.1 <- rbind(c(0:0), ModelDFSLt0_VLR9)
ModelDFSLt1_VLR9.2 <- rbind(c(0:0), ModelDFSLt1_VLR9.1)
ModelDFSLt1_VLR9.3 <- rbind(c(0:0), ModelDFSLt1_VLR9.2)
ModelDFSLt1_VLR9.4 <- rbind(c(0:0), ModelDFSLt1_VLR9.3)
ModelDFSLt1_VLR9.5 <- rbind(c(0:0), ModelDFSLt1_VLR9.4)
ModelDFSLt1_VLR9.6 <- rbind(c(0:0), ModelDFSLt1_VLR9.5)
ModelDFSLt1_VLR9.7 <- rbind(c(0:0), ModelDFSLt1_VLR9.6)
ModelDFSLt1_VLR9.8 <- rbind(c(0:0), ModelDFSLt1_VLR9.7)
ModelDFSLt1_VLR9.9 <- rbind(c(0:0), ModelDFSLt1_VLR9.8)
ModelDFSLt1_VLR9.10 <- rbind(c(0:0), ModelDFSLt1_VLR9.9)
ModelDFSLt1_VLR9.11 <- rbind(c(0:0), ModelDFSLt1_VLR9.10)
ModelDFSLt1_VLR9.12 <- rbind(c(0:0), ModelDFSLt1_VLR9.11)
ModelDFSLt1_VLR9.13 <- ModelDFSLt1_VLR9.12[-nrow(ModelDFSLt1_VLR9.12),]
ModelDFSLt1_VLR9.14 <- ModelDFSLt1_VLR9.13[-nrow(ModelDFSLt1_VLR9.13),]
ModelDFSLt1_VLR9.15 <- ModelDFSLt1_VLR9.14[-nrow(ModelDFSLt1_VLR9.14),]
ModelDFSLt1_VLR9.16 <- ModelDFSLt1_VLR9.15[-nrow(ModelDFSLt1_VLR9.15),]
ModelDFSLt1_VLR9.17 <- ModelDFSLt1_VLR9.16[-nrow(ModelDFSLt1_VLR9.16),]
ModelDFSLt1_VLR9.18 <- ModelDFSLt1_VLR9.17[-nrow(ModelDFSLt1_VLR9.17),]
ModelDFSLt1_VLR9.19 <- ModelDFSLt1_VLR9.18[-nrow(ModelDFSLt1_VLR9.18),]
ModelDFSLt1_VLR9.20 <- ModelDFSLt1_VLR9.19[-nrow(ModelDFSLt1_VLR9.19),]
ModelDFSLt1_VLR9.21 <- ModelDFSLt1_VLR9.20[-nrow(ModelDFSLt1_VLR9.20),]
ModelDFSLt1_VLR9.22 <- ModelDFSLt1_VLR9.21[-nrow(ModelDFSLt1_VLR9.21),]
ModelDFSLt1_VLR9.23 <- ModelDFSLt1_VLR9.22[-nrow(ModelDFSLt1_VLR9.22),]
ModelDFSLt1_VLR9.24 <- ModelDFSLt1_VLR9.23[-nrow(ModelDFSLt1_VLR9.23),]

ModelDFSLt1_VLR9 <- ModelDFSLt1_VLR9.24 #Create model t=x+1

#Subtract model (t=x) - (t=x+1)
ModelDFSL1y_VLR9 <- ModelDFSLt0_VLR9 - ModelDFSLt1_VLR9

#Re-do Month Number column because the substraction was also applied to it
ModelDFSL1y_VLR9$MNumber <- seq(from = 1, to = SimulationLength_months)

#This model will be called VLR9P because implies a one-off input of C
ModelDFSL_VLR9P <- ModelDFSL1y_VLR9

#Export the dataframe
write_xlsx(ModelDFSL_VLR9P,"VXP_Models\\ModelDFSL_R_VLR9P.xlsx")


#Plot 3: Interactive Yearly CO2 emissions #
MY <- 12
ModelDFSL_VLR9P_YCO2 <- ModelDFSL_VLR9P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VLR9)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLR9P_YCO2) <- c("Year", "Months", "AnnualCO2_VLR_9")

#Plot 3: Interactive Yearly CO2 emissions considering a delay
GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
ModelDFSL_VLR9P_YCO2D <- merge(ModelDFSL_VLR9P_YCO2, GWP100delay, by = "Year")
ModelDFSL_VLR9P_YCO2D$AnnualCO2D_VLR_9 <- ModelDFSL_VLR9P_YCO2D$AnnualCO2_VLR_9 * ModelDFSL_VLR9P_YCO2D$GWP100


#Plot 4: Interactive Yearly C emissions #
MY <- 12
ModelDFSL_VLR9P_YC <- ModelDFSL_VLR9P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VLR9)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLR9P_YC) <- c("Year", "Months", "CEmissions_VLR_9")

#Plot 5: Interactive Yearly C tails (remaining C in Soil) #
MY <- 12
ModelDFSL_VLR9P_YCT <- ModelDFSL_VLR9P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VLR9)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLR9P_YCT) <- c("Year", "Months", "CTail_VLR_9")

#Save Dataframes for Plots 3.1, 3.2, 4 and 5
write_xlsx(ModelDFSL_VLR9P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VLR9P.xlsx") #Yearly CO2 emissions (no delay)
write_xlsx(ModelDFSL_VLR9P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VLR9P.xlsx") #Yearly CO2 emissions (delay)
write_xlsx(ModelDFSL_VLR9P_YC,"CEmissions_P\\ModelDFSL_R_CE_VLR9P.xlsx") #Yearly C emissions
write_xlsx(ModelDFSL_VLR9P_YCT,"CTails_P\\ModelDFSL_R_CT_VLR9P.xlsx") #Yearly C emissions



#### 8.11 - VLR10) Litter; 100%clay; Reduced Tillage ####
#The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
fT_VLR10=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
fW_VLR10=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                         S.Thick = soil.thick, pClay = clay100,
                         pE = 1.0, bare = FALSE)$b #Moisture effects per month
xi.frame_VLR10=data.frame(years,rep(fT_VLR10*fW_VLR10,length.out=length(years)))

#To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
Model_VLR10=SoilR::RothCModel(
  t=years, #Simulation Length
  ks=c(k.DPM = 10*RTRM, k.RPM = 0.3*RTRM, k.BIO = 0.66*RTRM, k.HUM = 0.02*RTRM, k.IOM = 0*RTRM), #Decomposition rates for the different pools
  C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
  In=Scalar_LitterCinputs*1, #Amount of litter inputs by time
  FYM = Scalar_ManureCinputs*0, #Amount of Farm Yard Manure by time
  clay=clay100, #Percent clay in mineral soil
  xi=xi.frame_VLR10) #Loads the model

Ct_VLR10=getC(Model_VLR10) #Calculates stocks for each pool per month

#The results can be plotted with the commands
matplot(years, Ct_VLR10, type="l", lty=1, col=1:5,
        xlab="Time (years)", ylab="C stocks (Mg/ha)")
legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
       lty=1, col=1:5, bty="n")

VEC_Lit_VLR10 <- rep(M_Scalar_LitterCinputs*1, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
VEC_Man_VLR10 <- rep(M_Scalar_ManureCinputs*0, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

VEC_LitDF_VLR10 <- as.data.frame(VEC_Lit_VLR10) #Converting the Litter vector to a data frame
VEC_LitDF_VLR10$MNumber <- seq(from = 1, to = SimulationLength_months)
VEC_ManDF_VLR10 <- as.data.frame(VEC_Man_VLR10) #Converting the Manure vector to a data frame
VEC_ManDF_VLR10$MNumber <- seq(from = 1, to = SimulationLength_months)

sapply(VEC_LitDF_VLR10, class) #Check that class is numeric
sapply(VEC_ManDF_VLR10, class) #Check that class is numeric
LitterCinputs_VLR10=VEC_LitDF_VLR10   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
ManureCinputs_VLR10=VEC_ManDF_VLR10 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
MCinputs_VLR10 <- merge(LitterCinputs_VLR10, ManureCinputs_VLR10, by = "MNumber")
MCinputs_VLR10$MInput_VLR10 <- MCinputs_VLR10$VEC_Lit_VLR10 + MCinputs_VLR10$VEC_Man_VLR10

#Change names of litter and manure columns for more common ones
colnames(MCinputs_VLR10)[which(names(MCinputs_VLR10) == "VEC_Lit_VLR10")] <- "LitterC_VLR10"
colnames(MCinputs_VLR10)[which(names(MCinputs_VLR10) == "VEC_Man_VLR10")] <- "ManureC_VLR10"

#Create a dataframe with the data considering the simulation length
ModelDF_VLR10 <- as.data.frame(Ct_VLR10)
colnames(ModelDF_VLR10) <- c('DPM_VLR10','RPM_VLR10','BIO_VLR10', 'HUM_VLR10', 'IOM_VLR10')
ModelDFS_VLR10 <- ModelDF_VLR10[1:SimulationLength_months, ]

#Create a column with the number of month of analysis
ModelDFS_VLR10$MNumber <- seq(from = 1, to = SimulationLength_months)

#Create a column that sums all pools
ModelDFS_VLR10$AllPools_VLR10 <- ModelDFS_VLR10$DPM_VLR10 + ModelDFS_VLR10$RPM_VLR10 + ModelDFS_VLR10$BIO_VLR10 + ModelDFS_VLR10$HUM_VLR10 + ModelDFS_VLR10$IOM_VLR10

#Create a column that sums all pools except IOM (static)
ModelDFS_VLR10$AllPools_noIOM_VLR10 <- ModelDFS_VLR10$DPM_VLR10 + ModelDFS_VLR10$RPM_VLR10 + ModelDFS_VLR10$BIO_VLR10 + ModelDFS_VLR10$HUM_VLR10

#Create a column that add the monthly input of C (manure and litter separately)
ModelDFSL_VLR10 <- merge(ModelDFS_VLR10, MCinputs_VLR10, by = "MNumber")

ModelDFSL_VLR10$MInput_VLR10 <- ModelDFSL_VLR10$LitterC_VLR10 + ModelDFSL_VLR10$ManureC_VLR10
#ModelDF_SL$MInput[1] <- 0

#Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
ModelDFSL_VLR10$CTails_VLR10 <- ModelDFSL_VLR10$AllPools_noIOM_VLR10 + ModelDFSL_VLR10$MInput_VLR10

#Create Monthly Accumulated input of C
ModelDFSL_VLR10$AccumInput_VLR10 = ModelDFSL_VLR10$AccumInput_VLR10=cumsum(ModelDFSL_VLR10$MInput_VLR10)

#Create Monthly Growths for each carbon pool
ModelDFSL_VLR10$MGrowth_DPM_VLR10 <- ave(ModelDFSL_VLR10$DPM_VLR10, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLR10$MGrowth_RPM_VLR10 <- ave(ModelDFSL_VLR10$RPM_VLR10, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLR10$MGrowth_BIO_VLR10 <- ave(ModelDFSL_VLR10$BIO_VLR10, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLR10$MGrowth_HUM_VLR10 <- ave(ModelDFSL_VLR10$HUM_VLR10, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLR10$MGrowth_IOM_VLR10 <- ave(ModelDFSL_VLR10$IOM_VLR10, FUN = function(x) c(0, diff(x)))

#Create column for Monthly and Accumulated C-CO2 emissions
ModelDFSL_VLR10$M_CCO2_VLR10 <- ModelDFSL_VLR10$MInput_VLR10 - ModelDFSL_VLR10$MGrowth_DPM_VLR10 - ModelDFSL_VLR10$MGrowth_RPM_VLR10 - ModelDFSL_VLR10$MGrowth_BIO_VLR10 - ModelDFSL_VLR10$MGrowth_HUM_VLR10
ModelDFSL_VLR10$Accum_CCO2_VLR10 <- ModelDFSL_VLR10$AccumInput_VLR10 - ModelDFSL_VLR10$AllPools_noIOM_VLR10

#Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
ModelDFSL_VLR10$M_CCO2_VLR10[1] <- 0
ModelDFSL_VLR10$Accum_CCO2_VLR10[1] <- 0

#Balance validation
ModelDFSL_VLR10$Balance_VLR10 <- ModelDFSL_VLR10$AccumInput_VLR10 - ModelDFSL_VLR10$Accum_CCO2_VLR10 - (ModelDFSL_VLR10$DPM_VLR10 + ModelDFSL_VLR10$RPM_VLR10 + ModelDFSL_VLR10$BIO_VLR10 + ModelDFSL_VLR10$HUM_VLR10)

#Convert C-CO2 emissions into CO2 emissions
ModelDFSL_VLR10$M_CO2_VLR10 <- ModelDFSL_VLR10$M_CCO2_VLR10 * 44/12
ModelDFSL_VLR10$Accum_CO2_VLR10 <- ModelDFSL_VLR10$Accum_CCO2_VLR10 * 44/12

#This model will be called VLR10C because implies a continuous input of C
ModelDFSL_VLR10C <- ModelDFSL_VLR10

#Export the dataframe
write_xlsx(ModelDFSL_VLR10C,"VXC_Models\\ModelDFSL_R_VLR10C.xlsx")

#Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
#Create two equal models by using the above general script
#Create model t=x
ModelDFSLt0_VLR10 <- ModelDFSL_VLR10 #Create model t=x

#Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
ModelDFSLt1_VLR10.1 <- rbind(c(0:0), ModelDFSLt0_VLR10)
ModelDFSLt1_VLR10.2 <- rbind(c(0:0), ModelDFSLt1_VLR10.1)
ModelDFSLt1_VLR10.3 <- rbind(c(0:0), ModelDFSLt1_VLR10.2)
ModelDFSLt1_VLR10.4 <- rbind(c(0:0), ModelDFSLt1_VLR10.3)
ModelDFSLt1_VLR10.5 <- rbind(c(0:0), ModelDFSLt1_VLR10.4)
ModelDFSLt1_VLR10.6 <- rbind(c(0:0), ModelDFSLt1_VLR10.5)
ModelDFSLt1_VLR10.7 <- rbind(c(0:0), ModelDFSLt1_VLR10.6)
ModelDFSLt1_VLR10.8 <- rbind(c(0:0), ModelDFSLt1_VLR10.7)
ModelDFSLt1_VLR10.9 <- rbind(c(0:0), ModelDFSLt1_VLR10.8)
ModelDFSLt1_VLR10.10 <- rbind(c(0:0), ModelDFSLt1_VLR10.9)
ModelDFSLt1_VLR10.11 <- rbind(c(0:0), ModelDFSLt1_VLR10.10)
ModelDFSLt1_VLR10.12 <- rbind(c(0:0), ModelDFSLt1_VLR10.11)
ModelDFSLt1_VLR10.13 <- ModelDFSLt1_VLR10.12[-nrow(ModelDFSLt1_VLR10.12),]
ModelDFSLt1_VLR10.14 <- ModelDFSLt1_VLR10.13[-nrow(ModelDFSLt1_VLR10.13),]
ModelDFSLt1_VLR10.15 <- ModelDFSLt1_VLR10.14[-nrow(ModelDFSLt1_VLR10.14),]
ModelDFSLt1_VLR10.16 <- ModelDFSLt1_VLR10.15[-nrow(ModelDFSLt1_VLR10.15),]
ModelDFSLt1_VLR10.17 <- ModelDFSLt1_VLR10.16[-nrow(ModelDFSLt1_VLR10.16),]
ModelDFSLt1_VLR10.18 <- ModelDFSLt1_VLR10.17[-nrow(ModelDFSLt1_VLR10.17),]
ModelDFSLt1_VLR10.19 <- ModelDFSLt1_VLR10.18[-nrow(ModelDFSLt1_VLR10.18),]
ModelDFSLt1_VLR10.20 <- ModelDFSLt1_VLR10.19[-nrow(ModelDFSLt1_VLR10.19),]
ModelDFSLt1_VLR10.21 <- ModelDFSLt1_VLR10.20[-nrow(ModelDFSLt1_VLR10.20),]
ModelDFSLt1_VLR10.22 <- ModelDFSLt1_VLR10.21[-nrow(ModelDFSLt1_VLR10.21),]
ModelDFSLt1_VLR10.23 <- ModelDFSLt1_VLR10.22[-nrow(ModelDFSLt1_VLR10.22),]
ModelDFSLt1_VLR10.24 <- ModelDFSLt1_VLR10.23[-nrow(ModelDFSLt1_VLR10.23),]

ModelDFSLt1_VLR10 <- ModelDFSLt1_VLR10.24 #Create model t=x+1

#Subtract model (t=x) - (t=x+1)
ModelDFSL1y_VLR10 <- ModelDFSLt0_VLR10 - ModelDFSLt1_VLR10

#Re-do Month Number column because the substraction was also applied to it
ModelDFSL1y_VLR10$MNumber <- seq(from = 1, to = SimulationLength_months)

#This model will be called VLR10P because implies a one-off input of C
ModelDFSL_VLR10P <- ModelDFSL1y_VLR10

#Export the dataframe
write_xlsx(ModelDFSL_VLR10P,"VXP_Models\\ModelDFSL_R_VLR10P.xlsx")


#Plot 3: Interactive Yearly CO2 emissions #
MY <- 12
ModelDFSL_VLR10P_YCO2 <- ModelDFSL_VLR10P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VLR10)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLR10P_YCO2) <- c("Year", "Months", "AnnualCO2_VLR10")

#Plot 3: Interactive Yearly CO2 emissions considering a delay
GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
ModelDFSL_VLR10P_YCO2D <- merge(ModelDFSL_VLR10P_YCO2, GWP100delay, by = "Year")
ModelDFSL_VLR10P_YCO2D$AnnualCO2D_VLR10 <- ModelDFSL_VLR10P_YCO2D$AnnualCO2_VLR10 * ModelDFSL_VLR10P_YCO2D$GWP100

#Plot 4: Interactive Yearly C emissions #
MY <- 12
ModelDFSL_VLR10P_YC <- ModelDFSL_VLR10P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VLR10)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLR10P_YC) <- c("Year", "Months", "CEmissions_VLR10")

#Plot 5: Interactive Yearly C tails (remaining C in Soil) #
MY <- 12
ModelDFSL_VLR10P_YCT <- ModelDFSL_VLR10P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VLR10)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLR10P_YCT) <- c("Year", "Months", "CTail_VLR10")

#Save Dataframes for Plots 3.1, 3.2, 4 and 5
write_xlsx(ModelDFSL_VLR10P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VLR10P.xlsx") #Yearly CO2 emissions (no delay)
write_xlsx(ModelDFSL_VLR10P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VLR10P.xlsx") #Yearly CO2 emissions (delay)
write_xlsx(ModelDFSL_VLR10P_YC,"CEmissions_P\\ModelDFSL_R_CE_VLR10P.xlsx") #Yearly C emissions
write_xlsx(ModelDFSL_VLR10P_YCT,"CTails_P\\ModelDFSL_R_CT_VLR10P.xlsx") #Yearly C emissions



#### - #####
#### 9) Model Combinations - Litter; No Tillage, 0-100% (+10%) Clay ####
#### 9.1 - VLN0) Litter; 0%clay; No Tillage ####
#The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
fT_VLN0=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
fW_VLN0=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                        S.Thick = soil.thick, pClay = clay0,
                        pE = 1.0, bare = FALSE)$b #Moisture effects per month
xi.frame_VLN0=data.frame(years,rep(fT_VLN0*fW_VLN0,length.out=length(years)))

#To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
Model_VLN0=SoilR::RothCModel(
  t=years, #Simulation Length
  ks=c(k.DPM = 10*NTRM, k.RPM = 0.3*NTRM, k.BIO = 0.66*NTRM, k.HUM = 0.02*NTRM, k.IOM = 0*NTRM), #Decomposition rates for the different pools
  C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
  In=Scalar_LitterCinputs*1, #Amount of litter inputs by time
  FYM = Scalar_ManureCinputs*0, #Amount of Farm Yard Manure by time
  clay=clay0, #Percent clay in mineral soil
  xi=xi.frame_VLN0) #Loads the model

Ct_VLN0=getC(Model_VLN0) #Calculates stocks for each pool per month

VEC_Lit_VLN0 <- rep(M_Scalar_LitterCinputs*1, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
VEC_Man_VLN0 <- rep(M_Scalar_ManureCinputs*0, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

VEC_LitDF_VLN0 <- as.data.frame(VEC_Lit_VLN0) #Converting the Litter vector to a data frame
VEC_LitDF_VLN0$MNumber <- seq(from = 1, to = SimulationLength_months)
VEC_ManDF_VLN0 <- as.data.frame(VEC_Man_VLN0) #Converting the Manure vector to a data frame
VEC_ManDF_VLN0$MNumber <- seq(from = 1, to = SimulationLength_months)

sapply(VEC_LitDF_VLN0, class) #Check that class is numeric
sapply(VEC_ManDF_VLN0, class) #Check that class is numeric
LitterCinputs_VLN0=VEC_LitDF_VLN0   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
ManureCinputs_VLN0=VEC_ManDF_VLN0 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
MCinputs_VLN0 <- merge(LitterCinputs_VLN0, ManureCinputs_VLN0, by = "MNumber")
MCinputs_VLN0$MInput_VLN0 <- MCinputs_VLN0$VEC_Lit_VLN0 + MCinputs_VLN0$VEC_Man_VLN0

#Change names of litter and manure columns for more common ones
colnames(MCinputs_VLN0)[which(names(MCinputs_VLN0) == "VEC_Lit_VLN0")] <- "LitterC_VLN0"
colnames(MCinputs_VLN0)[which(names(MCinputs_VLN0) == "VEC_Man_VLN0")] <- "ManureC_VLN0"

#Create a dataframe with the data considering the simulation length
ModelDF_VLN0 <- as.data.frame(Ct_VLN0)
colnames(ModelDF_VLN0) <- c('DPM_VLN0','RPM_VLN0','BIO_VLN0', 'HUM_VLN0', 'IOM_VLN0')
ModelDFS_VLN0 <- ModelDF_VLN0[1:SimulationLength_months, ]

#Create a column with the number of month of analysis
ModelDFS_VLN0$MNumber <- seq(from = 1, to = SimulationLength_months)

#Create a column that sums all pools
ModelDFS_VLN0$AllPools_VLN0 <- ModelDFS_VLN0$DPM_VLN0 + ModelDFS_VLN0$RPM_VLN0 + ModelDFS_VLN0$BIO_VLN0 + ModelDFS_VLN0$HUM_VLN0 + ModelDFS_VLN0$IOM_VLN0

#Create a column that sums all pools except IOM (static)
ModelDFS_VLN0$AllPools_noIOM_VLN0 <- ModelDFS_VLN0$DPM_VLN0 + ModelDFS_VLN0$RPM_VLN0 + ModelDFS_VLN0$BIO_VLN0 + ModelDFS_VLN0$HUM_VLN0

#Create a column that add the monthly input of C (manure and litter separately)
ModelDFSL_VLN0 <- merge(ModelDFS_VLN0, MCinputs_VLN0, by = "MNumber")

ModelDFSL_VLN0$MInput_VLN0 <- ModelDFSL_VLN0$LitterC_VLN0 + ModelDFSL_VLN0$ManureC_VLN0
#ModelDF_SL$MInput[1] <- 0

#Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
ModelDFSL_VLN0$CTails_VLN0 <- ModelDFSL_VLN0$AllPools_noIOM_VLN0 + ModelDFSL_VLN0$MInput_VLN0

#Create Monthly Accumulated input of C
ModelDFSL_VLN0$AccumInput_VLN0 = ModelDFSL_VLN0$AccumInput_VLN0=cumsum(ModelDFSL_VLN0$MInput_VLN0)

#Create Monthly Growths for each carbon pool
ModelDFSL_VLN0$MGrowth_DPM_VLN0 <- ave(ModelDFSL_VLN0$DPM_VLN0, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLN0$MGrowth_RPM_VLN0 <- ave(ModelDFSL_VLN0$RPM_VLN0, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLN0$MGrowth_BIO_VLN0 <- ave(ModelDFSL_VLN0$BIO_VLN0, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLN0$MGrowth_HUM_VLN0 <- ave(ModelDFSL_VLN0$HUM_VLN0, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLN0$MGrowth_IOM_VLN0 <- ave(ModelDFSL_VLN0$IOM_VLN0, FUN = function(x) c(0, diff(x)))

#Create column for Monthly and Accumulated C-CO2 emissions
ModelDFSL_VLN0$M_CCO2_VLN0 <- ModelDFSL_VLN0$MInput_VLN0 - ModelDFSL_VLN0$MGrowth_DPM_VLN0 - ModelDFSL_VLN0$MGrowth_RPM_VLN0 - ModelDFSL_VLN0$MGrowth_BIO_VLN0 - ModelDFSL_VLN0$MGrowth_HUM_VLN0
ModelDFSL_VLN0$Accum_CCO2_VLN0 <- ModelDFSL_VLN0$AccumInput_VLN0 - ModelDFSL_VLN0$AllPools_noIOM_VLN0

#Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
ModelDFSL_VLN0$M_CCO2_VLN0[1] <- 0
ModelDFSL_VLN0$Accum_CCO2_VLN0[1] <- 0

#Balance validation
ModelDFSL_VLN0$Balance_VLN0 <- ModelDFSL_VLN0$AccumInput_VLN0 - ModelDFSL_VLN0$Accum_CCO2_VLN0 - (ModelDFSL_VLN0$DPM_VLN0 + ModelDFSL_VLN0$RPM_VLN0 + ModelDFSL_VLN0$BIO_VLN0 + ModelDFSL_VLN0$HUM_VLN0)

#Convert C-CO2 emissions into CO2 emissions
ModelDFSL_VLN0$M_CO2_VLN0 <- ModelDFSL_VLN0$M_CCO2_VLN0 * 44/12
ModelDFSL_VLN0$Accum_CO2_VLN0 <- ModelDFSL_VLN0$Accum_CCO2_VLN0 * 44/12

#This model will be called VLN0C because implies a continuous input of C
ModelDFSL_VLN0C <- ModelDFSL_VLN0

#Export the dataframe
write_xlsx(ModelDFSL_VLN0C,"VXC_Models\\ModelDFSL_R_VLN0C.xlsx")

#Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
#Create two equal models by using the above general script
#Create model t=x
ModelDFSLt0_VLN0 <- ModelDFSL_VLN0 #Create model t=x

#Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
ModelDFSLt1_VLN0.1 <- rbind(c(0:0), ModelDFSLt0_VLN0)
ModelDFSLt1_VLN0.2 <- rbind(c(0:0), ModelDFSLt1_VLN0.1)
ModelDFSLt1_VLN0.3 <- rbind(c(0:0), ModelDFSLt1_VLN0.2)
ModelDFSLt1_VLN0.4 <- rbind(c(0:0), ModelDFSLt1_VLN0.3)
ModelDFSLt1_VLN0.5 <- rbind(c(0:0), ModelDFSLt1_VLN0.4)
ModelDFSLt1_VLN0.6 <- rbind(c(0:0), ModelDFSLt1_VLN0.5)
ModelDFSLt1_VLN0.7 <- rbind(c(0:0), ModelDFSLt1_VLN0.6)
ModelDFSLt1_VLN0.8 <- rbind(c(0:0), ModelDFSLt1_VLN0.7)
ModelDFSLt1_VLN0.9 <- rbind(c(0:0), ModelDFSLt1_VLN0.8)
ModelDFSLt1_VLN0.10 <- rbind(c(0:0), ModelDFSLt1_VLN0.9)
ModelDFSLt1_VLN0.11 <- rbind(c(0:0), ModelDFSLt1_VLN0.10)
ModelDFSLt1_VLN0.12 <- rbind(c(0:0), ModelDFSLt1_VLN0.11)
ModelDFSLt1_VLN0.13 <- ModelDFSLt1_VLN0.12[-nrow(ModelDFSLt1_VLN0.12),]
ModelDFSLt1_VLN0.14 <- ModelDFSLt1_VLN0.13[-nrow(ModelDFSLt1_VLN0.13),]
ModelDFSLt1_VLN0.15 <- ModelDFSLt1_VLN0.14[-nrow(ModelDFSLt1_VLN0.14),]
ModelDFSLt1_VLN0.16 <- ModelDFSLt1_VLN0.15[-nrow(ModelDFSLt1_VLN0.15),]
ModelDFSLt1_VLN0.17 <- ModelDFSLt1_VLN0.16[-nrow(ModelDFSLt1_VLN0.16),]
ModelDFSLt1_VLN0.18 <- ModelDFSLt1_VLN0.17[-nrow(ModelDFSLt1_VLN0.17),]
ModelDFSLt1_VLN0.19 <- ModelDFSLt1_VLN0.18[-nrow(ModelDFSLt1_VLN0.18),]
ModelDFSLt1_VLN0.20 <- ModelDFSLt1_VLN0.19[-nrow(ModelDFSLt1_VLN0.19),]
ModelDFSLt1_VLN0.21 <- ModelDFSLt1_VLN0.20[-nrow(ModelDFSLt1_VLN0.20),]
ModelDFSLt1_VLN0.22 <- ModelDFSLt1_VLN0.21[-nrow(ModelDFSLt1_VLN0.21),]
ModelDFSLt1_VLN0.23 <- ModelDFSLt1_VLN0.22[-nrow(ModelDFSLt1_VLN0.22),]
ModelDFSLt1_VLN0.24 <- ModelDFSLt1_VLN0.23[-nrow(ModelDFSLt1_VLN0.23),]

ModelDFSLt1_VLN0 <- ModelDFSLt1_VLN0.24 #Create model t=x+1

#Subtract model (t=x) - (t=x+1)
ModelDFSL1y_VLN0 <- ModelDFSLt0_VLN0 - ModelDFSLt1_VLN0

#Re-do Month Number column because the substraction was also applied to it
ModelDFSL1y_VLN0$MNumber <- seq(from = 1, to = SimulationLength_months)

#This model will be called VLN0P because implies a one-off input of C
ModelDFSL_VLN0P <- ModelDFSL1y_VLN0

#Export the dataframe
write_xlsx(ModelDFSL_VLN0P,"VXP_Models\\ModelDFSL_R_VLN0P.xlsx")

#Plot 3.1: Interactive Yearly CO2 emissions #
MY <- 12
ModelDFSL_VLN0P_YCO2 <- ModelDFSL_VLN0P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VLN0)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLN0P_YCO2) <- c("Year", "Months", "AnnualCO2_VLN_0")

#Plot 3.2: Interactive Yearly CO2 emissions considering a delay
GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
ModelDFSL_VLN0P_YCO2D <- merge(ModelDFSL_VLN0P_YCO2, GWP100delay, by = "Year")
ModelDFSL_VLN0P_YCO2D$AnnualCO2D_VLN_0 <- ModelDFSL_VLN0P_YCO2D$AnnualCO2_VLN_0 * ModelDFSL_VLN0P_YCO2D$GWP100

#Plot 4: Interactive Yearly C emissions #
MY <- 12
ModelDFSL_VLN0P_YC <- ModelDFSL_VLN0P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VLN0)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLN0P_YC) <- c("Year", "Months", "CEmissions_VLN_0")

#Plot 5: Interactive Yearly C tails (remaining C in Soil) #
MY <- 12
ModelDFSL_VLN0P_YCT <- ModelDFSL_VLN0P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VLN0)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLN0P_YCT) <- c("Year", "Months", "CTail_VLN_0")

#Save Dataframes for Plots 3.1, 3.2, 4 and 5
write_xlsx(ModelDFSL_VLN0P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VLN0P.xlsx") #Yearly CO2 emissions (no delay)
write_xlsx(ModelDFSL_VLN0P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VLN0P.xlsx") #Yearly CO2 emissions (delay)
write_xlsx(ModelDFSL_VLN0P_YC,"CEmissions_P\\ModelDFSL_R_CE_VLN0P.xlsx") #Yearly C emissions
write_xlsx(ModelDFSL_VLN0P_YCT,"CTails_P\\ModelDFSL_R_CT_VLN0P.xlsx") #Yearly C emissions


#### 9.2 - VLN1) Litter; 10%clay; No Tillage ####
#The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
fT_VLN1=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
fW_VLN1=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                        S.Thick = soil.thick, pClay = clay100*0.1,
                        pE = 1.0, bare = FALSE)$b #Moisture effects per month
xi.frame_VLN1=data.frame(years,rep(fT_VLN1*fW_VLN1,length.out=length(years)))

#To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
Model_VLN1=SoilR::RothCModel(
  t=years, #Simulation Length
  ks=c(k.DPM = 10*NTRM, k.RPM = 0.3*NTRM, k.BIO = 0.66*NTRM, k.HUM = 0.02*NTRM, k.IOM = 0*NTRM), #Decomposition rates for the different pools
  C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
  In=Scalar_LitterCinputs*1, #Amount of litter inputs by time
  FYM = Scalar_ManureCinputs*0, #Amount of Farm Yard Manure by time
  clay=clay100*0.1, #Percent clay in mineral soil
  xi=xi.frame_VLN1) #Loads the model

Ct_VLN1=getC(Model_VLN1) #Calculates stocks for each pool per month

#The results can be plotted with the commands
matplot(years, Ct_VLN1, type="l", lty=1, col=1:5,
        xlab="Time (years)", ylab="C stocks (Mg/ha)")
legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
       lty=1, col=1:5, bty="n")

VEC_Lit_VLN1 <- rep(M_Scalar_LitterCinputs*1, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
VEC_Man_VLN1 <- rep(M_Scalar_ManureCinputs*0, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

VEC_LitDF_VLN1 <- as.data.frame(VEC_Lit_VLN1) #Converting the Litter vector to a data frame
VEC_LitDF_VLN1$MNumber <- seq(from = 1, to = SimulationLength_months)
VEC_ManDF_VLN1 <- as.data.frame(VEC_Man_VLN1) #Converting the Manure vector to a data frame
VEC_ManDF_VLN1$MNumber <- seq(from = 1, to = SimulationLength_months)

sapply(VEC_LitDF_VLN1, class) #Check that class is numeric
sapply(VEC_ManDF_VLN1, class) #Check that class is numeric
LitterCinputs_VLN1=VEC_LitDF_VLN1   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
ManureCinputs_VLN1=VEC_ManDF_VLN1 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
MCinputs_VLN1 <- merge(LitterCinputs_VLN1, ManureCinputs_VLN1, by = "MNumber")
MCinputs_VLN1$MInput_VLN1 <- MCinputs_VLN1$VEC_Lit_VLN1 + MCinputs_VLN1$VEC_Man_VLN1

#Change names of litter and manure columns for more common ones
colnames(MCinputs_VLN1)[which(names(MCinputs_VLN1) == "VEC_Lit_VLN1")] <- "LitterC_VLN1"
colnames(MCinputs_VLN1)[which(names(MCinputs_VLN1) == "VEC_Man_VLN1")] <- "ManureC_VLN1"

#Create a dataframe with the data considering the simulation length
ModelDF_VLN1 <- as.data.frame(Ct_VLN1)
colnames(ModelDF_VLN1) <- c('DPM_VLN1','RPM_VLN1','BIO_VLN1', 'HUM_VLN1', 'IOM_VLN1')
ModelDFS_VLN1 <- ModelDF_VLN1[1:SimulationLength_months, ]

#Create a column with the number of month of analysis
ModelDFS_VLN1$MNumber <- seq(from = 1, to = SimulationLength_months)

#Create a column that sums all pools
ModelDFS_VLN1$AllPools_VLN1 <- ModelDFS_VLN1$DPM_VLN1 + ModelDFS_VLN1$RPM_VLN1 + ModelDFS_VLN1$BIO_VLN1 + ModelDFS_VLN1$HUM_VLN1 + ModelDFS_VLN1$IOM_VLN1

#Create a column that sums all pools except IOM (static)
ModelDFS_VLN1$AllPools_noIOM_VLN1 <- ModelDFS_VLN1$DPM_VLN1 + ModelDFS_VLN1$RPM_VLN1 + ModelDFS_VLN1$BIO_VLN1 + ModelDFS_VLN1$HUM_VLN1

#Create a column that add the monthly input of C (manure and litter separately)
ModelDFSL_VLN1 <- merge(ModelDFS_VLN1, MCinputs_VLN1, by = "MNumber")

ModelDFSL_VLN1$MInput_VLN1 <- ModelDFSL_VLN1$LitterC_VLN1 + ModelDFSL_VLN1$ManureC_VLN1
#ModelDF_SL$MInput[1] <- 0

#Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
ModelDFSL_VLN1$CTails_VLN1 <- ModelDFSL_VLN1$AllPools_noIOM_VLN1 + ModelDFSL_VLN1$MInput_VLN1

#Create Monthly Accumulated input of C
ModelDFSL_VLN1$AccumInput_VLN1 = ModelDFSL_VLN1$AccumInput_VLN1=cumsum(ModelDFSL_VLN1$MInput_VLN1)

#Create Monthly Growths for each carbon pool
ModelDFSL_VLN1$MGrowth_DPM_VLN1 <- ave(ModelDFSL_VLN1$DPM_VLN1, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLN1$MGrowth_RPM_VLN1 <- ave(ModelDFSL_VLN1$RPM_VLN1, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLN1$MGrowth_BIO_VLN1 <- ave(ModelDFSL_VLN1$BIO_VLN1, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLN1$MGrowth_HUM_VLN1 <- ave(ModelDFSL_VLN1$HUM_VLN1, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLN1$MGrowth_IOM_VLN1 <- ave(ModelDFSL_VLN1$IOM_VLN1, FUN = function(x) c(0, diff(x)))

#Create column for Monthly and Accumulated C-CO2 emissions
ModelDFSL_VLN1$M_CCO2_VLN1 <- ModelDFSL_VLN1$MInput_VLN1 - ModelDFSL_VLN1$MGrowth_DPM_VLN1 - ModelDFSL_VLN1$MGrowth_RPM_VLN1 - ModelDFSL_VLN1$MGrowth_BIO_VLN1 - ModelDFSL_VLN1$MGrowth_HUM_VLN1
ModelDFSL_VLN1$Accum_CCO2_VLN1 <- ModelDFSL_VLN1$AccumInput_VLN1 - ModelDFSL_VLN1$AllPools_noIOM_VLN1

#Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
ModelDFSL_VLN1$M_CCO2_VLN1[1] <- 0
ModelDFSL_VLN1$Accum_CCO2_VLN1[1] <- 0

#Balance validation
ModelDFSL_VLN1$Balance_VLN1 <- ModelDFSL_VLN1$AccumInput_VLN1 - ModelDFSL_VLN1$Accum_CCO2_VLN1 - (ModelDFSL_VLN1$DPM_VLN1 + ModelDFSL_VLN1$RPM_VLN1 + ModelDFSL_VLN1$BIO_VLN1 + ModelDFSL_VLN1$HUM_VLN1)

#Convert C-CO2 emissions into CO2 emissions
ModelDFSL_VLN1$M_CO2_VLN1 <- ModelDFSL_VLN1$M_CCO2_VLN1 * 44/12
ModelDFSL_VLN1$Accum_CO2_VLN1 <- ModelDFSL_VLN1$Accum_CCO2_VLN1 * 44/12

#This model will be called VLN1C because implies a continuous input of C
ModelDFSL_VLN1C <- ModelDFSL_VLN1

#Export the dataframe
write_xlsx(ModelDFSL_VLN1C,"VXC_Models\\ModelDFSL_R_VLN1C.xlsx")

#Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
#Create two equal models by using the above general script
#Create model t=x
ModelDFSLt0_VLN1 <- ModelDFSL_VLN1 #Create model t=x

#Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
ModelDFSLt1_VLN1.1 <- rbind(c(0:0), ModelDFSLt0_VLN1)
ModelDFSLt1_VLN1.2 <- rbind(c(0:0), ModelDFSLt1_VLN1.1)
ModelDFSLt1_VLN1.3 <- rbind(c(0:0), ModelDFSLt1_VLN1.2)
ModelDFSLt1_VLN1.4 <- rbind(c(0:0), ModelDFSLt1_VLN1.3)
ModelDFSLt1_VLN1.5 <- rbind(c(0:0), ModelDFSLt1_VLN1.4)
ModelDFSLt1_VLN1.6 <- rbind(c(0:0), ModelDFSLt1_VLN1.5)
ModelDFSLt1_VLN1.7 <- rbind(c(0:0), ModelDFSLt1_VLN1.6)
ModelDFSLt1_VLN1.8 <- rbind(c(0:0), ModelDFSLt1_VLN1.7)
ModelDFSLt1_VLN1.9 <- rbind(c(0:0), ModelDFSLt1_VLN1.8)
ModelDFSLt1_VLN1.10 <- rbind(c(0:0), ModelDFSLt1_VLN1.9)
ModelDFSLt1_VLN1.11 <- rbind(c(0:0), ModelDFSLt1_VLN1.10)
ModelDFSLt1_VLN1.12 <- rbind(c(0:0), ModelDFSLt1_VLN1.11)
ModelDFSLt1_VLN1.13 <- ModelDFSLt1_VLN1.12[-nrow(ModelDFSLt1_VLN1.12),]
ModelDFSLt1_VLN1.14 <- ModelDFSLt1_VLN1.13[-nrow(ModelDFSLt1_VLN1.13),]
ModelDFSLt1_VLN1.15 <- ModelDFSLt1_VLN1.14[-nrow(ModelDFSLt1_VLN1.14),]
ModelDFSLt1_VLN1.16 <- ModelDFSLt1_VLN1.15[-nrow(ModelDFSLt1_VLN1.15),]
ModelDFSLt1_VLN1.17 <- ModelDFSLt1_VLN1.16[-nrow(ModelDFSLt1_VLN1.16),]
ModelDFSLt1_VLN1.18 <- ModelDFSLt1_VLN1.17[-nrow(ModelDFSLt1_VLN1.17),]
ModelDFSLt1_VLN1.19 <- ModelDFSLt1_VLN1.18[-nrow(ModelDFSLt1_VLN1.18),]
ModelDFSLt1_VLN1.20 <- ModelDFSLt1_VLN1.19[-nrow(ModelDFSLt1_VLN1.19),]
ModelDFSLt1_VLN1.21 <- ModelDFSLt1_VLN1.20[-nrow(ModelDFSLt1_VLN1.20),]
ModelDFSLt1_VLN1.22 <- ModelDFSLt1_VLN1.21[-nrow(ModelDFSLt1_VLN1.21),]
ModelDFSLt1_VLN1.23 <- ModelDFSLt1_VLN1.22[-nrow(ModelDFSLt1_VLN1.22),]
ModelDFSLt1_VLN1.24 <- ModelDFSLt1_VLN1.23[-nrow(ModelDFSLt1_VLN1.23),]

ModelDFSLt1_VLN1 <- ModelDFSLt1_VLN1.24 #Create model t=x+1

#Subtract model (t=x) - (t=x+1)
ModelDFSL1y_VLN1 <- ModelDFSLt0_VLN1 - ModelDFSLt1_VLN1

#Re-do Month Number column because the substraction was also applied to it
ModelDFSL1y_VLN1$MNumber <- seq(from = 1, to = SimulationLength_months)

#This model will be called VLN1P because implies a one-off input of C
ModelDFSL_VLN1P <- ModelDFSL1y_VLN1

#Export the dataframe
write_xlsx(ModelDFSL_VLN1P,"VXP_Models\\ModelDFSL_R_VLN1P.xlsx")

#Plot 3: Interactive Yearly CO2 emissions #
MY <- 12
ModelDFSL_VLN1P_YCO2 <- ModelDFSL_VLN1P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VLN1)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLN1P_YCO2) <- c("Year", "Months", "AnnualCO2_VLN_1")

#Plot 3: Interactive Yearly CO2 emissions considering a delay
GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
ModelDFSL_VLN1P_YCO2D <- merge(ModelDFSL_VLN1P_YCO2, GWP100delay, by = "Year")
ModelDFSL_VLN1P_YCO2D$AnnualCO2D_VLN_1 <- ModelDFSL_VLN1P_YCO2D$AnnualCO2_VLN_1 * ModelDFSL_VLN1P_YCO2D$GWP100

#Plot 4: Interactive Yearly C emissions #
MY <- 12
ModelDFSL_VLN1P_YC <- ModelDFSL_VLN1P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VLN1)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLN1P_YC) <- c("Year", "Months", "CEmissions_VLN_1")

#Plot 5: Interactive Yearly C tails (remaining C in Soil) #
MY <- 12
ModelDFSL_VLN1P_YCT <- ModelDFSL_VLN1P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VLN1)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLN1P_YCT) <- c("Year", "Months", "CTail_VLN_1")

#Save Dataframes for Plots 3.1, 3.2, 4 and 5
write_xlsx(ModelDFSL_VLN1P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VLN1P.xlsx") #Yearly CO2 emissions (no delay)
write_xlsx(ModelDFSL_VLN1P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VLN1P.xlsx") #Yearly CO2 emissions (delay)
write_xlsx(ModelDFSL_VLN1P_YC,"CEmissions_P\\ModelDFSL_R_CE_VLN1P.xlsx") #Yearly C emissions
write_xlsx(ModelDFSL_VLN1P_YCT,"CTails_P\\ModelDFSL_R_CT_VLN1P.xlsx") #Yearly C emissions



#### 9.3 - VLN2) Litter; 20%clay; No Tillage ####
#The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
fT_VLN2=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
fW_VLN2=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                        S.Thick = soil.thick, pClay = clay100*0.2,
                        pE = 1.0, bare = FALSE)$b #Moisture effects per month
xi.frame_VLN2=data.frame(years,rep(fT_VLN2*fW_VLN2,length.out=length(years)))

#To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
Model_VLN2=SoilR::RothCModel(
  t=years, #Simulation Length
  ks=c(k.DPM = 10*NTRM, k.RPM = 0.3*NTRM, k.BIO = 0.66*NTRM, k.HUM = 0.02*NTRM, k.IOM = 0*NTRM), #Decomposition rates for the different pools
  C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
  In=Scalar_LitterCinputs*1, #Amount of litter inputs by time
  FYM = Scalar_ManureCinputs*0, #Amount of Farm Yard Manure by time
  clay=clay100*0.2, #Percent clay in mineral soil
  xi=xi.frame_VLN2) #Loads the model

Ct_VLN2=getC(Model_VLN2) #Calculates stocks for each pool per month

#The results can be plotted with the commands
matplot(years, Ct_VLN2, type="l", lty=1, col=1:5,
        xlab="Time (years)", ylab="C stocks (Mg/ha)")
legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
       lty=1, col=1:5, bty="n")

VEC_Lit_VLN2 <- rep(M_Scalar_LitterCinputs*1, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
VEC_Man_VLN2 <- rep(M_Scalar_ManureCinputs*0, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

VEC_LitDF_VLN2 <- as.data.frame(VEC_Lit_VLN2) #Converting the Litter vector to a data frame
VEC_LitDF_VLN2$MNumber <- seq(from = 1, to = SimulationLength_months)
VEC_ManDF_VLN2 <- as.data.frame(VEC_Man_VLN2) #Converting the Manure vector to a data frame
VEC_ManDF_VLN2$MNumber <- seq(from = 1, to = SimulationLength_months)

sapply(VEC_LitDF_VLN2, class) #Check that class is numeric
sapply(VEC_ManDF_VLN2, class) #Check that class is numeric
LitterCinputs_VLN2=VEC_LitDF_VLN2   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
ManureCinputs_VLN2=VEC_ManDF_VLN2 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
MCinputs_VLN2 <- merge(LitterCinputs_VLN2, ManureCinputs_VLN2, by = "MNumber")
MCinputs_VLN2$MInput_VLN2 <- MCinputs_VLN2$VEC_Lit_VLN2 + MCinputs_VLN2$VEC_Man_VLN2

#Change names of litter and manure columns for more common ones
colnames(MCinputs_VLN2)[which(names(MCinputs_VLN2) == "VEC_Lit_VLN2")] <- "LitterC_VLN2"
colnames(MCinputs_VLN2)[which(names(MCinputs_VLN2) == "VEC_Man_VLN2")] <- "ManureC_VLN2"

#Create a dataframe with the data considering the simulation length
ModelDF_VLN2 <- as.data.frame(Ct_VLN2)
colnames(ModelDF_VLN2) <- c('DPM_VLN2','RPM_VLN2','BIO_VLN2', 'HUM_VLN2', 'IOM_VLN2')
ModelDFS_VLN2 <- ModelDF_VLN2[1:SimulationLength_months, ]

#Create a column with the number of month of analysis
ModelDFS_VLN2$MNumber <- seq(from = 1, to = SimulationLength_months)

#Create a column that sums all pools
ModelDFS_VLN2$AllPools_VLN2 <- ModelDFS_VLN2$DPM_VLN2 + ModelDFS_VLN2$RPM_VLN2 + ModelDFS_VLN2$BIO_VLN2 + ModelDFS_VLN2$HUM_VLN2 + ModelDFS_VLN2$IOM_VLN2

#Create a column that sums all pools except IOM (static)
ModelDFS_VLN2$AllPools_noIOM_VLN2 <- ModelDFS_VLN2$DPM_VLN2 + ModelDFS_VLN2$RPM_VLN2 + ModelDFS_VLN2$BIO_VLN2 + ModelDFS_VLN2$HUM_VLN2

#Create a column that add the monthly input of C (manure and litter separately)
ModelDFSL_VLN2 <- merge(ModelDFS_VLN2, MCinputs_VLN2, by = "MNumber")

ModelDFSL_VLN2$MInput_VLN2 <- ModelDFSL_VLN2$LitterC_VLN2 + ModelDFSL_VLN2$ManureC_VLN2
#ModelDF_SL$MInput[1] <- 0

#Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
ModelDFSL_VLN2$CTails_VLN2 <- ModelDFSL_VLN2$AllPools_noIOM_VLN2 + ModelDFSL_VLN2$MInput_VLN2

#Create Monthly Accumulated input of C
ModelDFSL_VLN2$AccumInput_VLN2 = ModelDFSL_VLN2$AccumInput_VLN2=cumsum(ModelDFSL_VLN2$MInput_VLN2)

#Create Monthly Growths for each carbon pool
ModelDFSL_VLN2$MGrowth_DPM_VLN2 <- ave(ModelDFSL_VLN2$DPM_VLN2, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLN2$MGrowth_RPM_VLN2 <- ave(ModelDFSL_VLN2$RPM_VLN2, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLN2$MGrowth_BIO_VLN2 <- ave(ModelDFSL_VLN2$BIO_VLN2, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLN2$MGrowth_HUM_VLN2 <- ave(ModelDFSL_VLN2$HUM_VLN2, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLN2$MGrowth_IOM_VLN2 <- ave(ModelDFSL_VLN2$IOM_VLN2, FUN = function(x) c(0, diff(x)))

#Create column for Monthly and Accumulated C-CO2 emissions
ModelDFSL_VLN2$M_CCO2_VLN2 <- ModelDFSL_VLN2$MInput_VLN2 - ModelDFSL_VLN2$MGrowth_DPM_VLN2 - ModelDFSL_VLN2$MGrowth_RPM_VLN2 - ModelDFSL_VLN2$MGrowth_BIO_VLN2 - ModelDFSL_VLN2$MGrowth_HUM_VLN2
ModelDFSL_VLN2$Accum_CCO2_VLN2 <- ModelDFSL_VLN2$AccumInput_VLN2 - ModelDFSL_VLN2$AllPools_noIOM_VLN2

#Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
ModelDFSL_VLN2$M_CCO2_VLN2[1] <- 0
ModelDFSL_VLN2$Accum_CCO2_VLN2[1] <- 0

#Balance validation
ModelDFSL_VLN2$Balance_VLN2 <- ModelDFSL_VLN2$AccumInput_VLN2 - ModelDFSL_VLN2$Accum_CCO2_VLN2 - (ModelDFSL_VLN2$DPM_VLN2 + ModelDFSL_VLN2$RPM_VLN2 + ModelDFSL_VLN2$BIO_VLN2 + ModelDFSL_VLN2$HUM_VLN2)

#Convert C-CO2 emissions into CO2 emissions
ModelDFSL_VLN2$M_CO2_VLN2 <- ModelDFSL_VLN2$M_CCO2_VLN2 * 44/12
ModelDFSL_VLN2$Accum_CO2_VLN2 <- ModelDFSL_VLN2$Accum_CCO2_VLN2 * 44/12

#This model will be called VLN2C because implies a continuous input of C
ModelDFSL_VLN2C <- ModelDFSL_VLN2

#Export the dataframe
write_xlsx(ModelDFSL_VLN2C,"VXC_Models\\ModelDFSL_R_VLN2C.xlsx")

#Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
#Create two equal models by using the above general script
#Create model t=x
ModelDFSLt0_VLN2 <- ModelDFSL_VLN2 #Create model t=x

#Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
ModelDFSLt1_VLN2.1 <- rbind(c(0:0), ModelDFSLt0_VLN2)
ModelDFSLt1_VLN2.2 <- rbind(c(0:0), ModelDFSLt1_VLN2.1)
ModelDFSLt1_VLN2.3 <- rbind(c(0:0), ModelDFSLt1_VLN2.2)
ModelDFSLt1_VLN2.4 <- rbind(c(0:0), ModelDFSLt1_VLN2.3)
ModelDFSLt1_VLN2.5 <- rbind(c(0:0), ModelDFSLt1_VLN2.4)
ModelDFSLt1_VLN2.6 <- rbind(c(0:0), ModelDFSLt1_VLN2.5)
ModelDFSLt1_VLN2.7 <- rbind(c(0:0), ModelDFSLt1_VLN2.6)
ModelDFSLt1_VLN2.8 <- rbind(c(0:0), ModelDFSLt1_VLN2.7)
ModelDFSLt1_VLN2.9 <- rbind(c(0:0), ModelDFSLt1_VLN2.8)
ModelDFSLt1_VLN2.10 <- rbind(c(0:0), ModelDFSLt1_VLN2.9)
ModelDFSLt1_VLN2.11 <- rbind(c(0:0), ModelDFSLt1_VLN2.10)
ModelDFSLt1_VLN2.12 <- rbind(c(0:0), ModelDFSLt1_VLN2.11)
ModelDFSLt1_VLN2.13 <- ModelDFSLt1_VLN2.12[-nrow(ModelDFSLt1_VLN2.12),]
ModelDFSLt1_VLN2.14 <- ModelDFSLt1_VLN2.13[-nrow(ModelDFSLt1_VLN2.13),]
ModelDFSLt1_VLN2.15 <- ModelDFSLt1_VLN2.14[-nrow(ModelDFSLt1_VLN2.14),]
ModelDFSLt1_VLN2.16 <- ModelDFSLt1_VLN2.15[-nrow(ModelDFSLt1_VLN2.15),]
ModelDFSLt1_VLN2.17 <- ModelDFSLt1_VLN2.16[-nrow(ModelDFSLt1_VLN2.16),]
ModelDFSLt1_VLN2.18 <- ModelDFSLt1_VLN2.17[-nrow(ModelDFSLt1_VLN2.17),]
ModelDFSLt1_VLN2.19 <- ModelDFSLt1_VLN2.18[-nrow(ModelDFSLt1_VLN2.18),]
ModelDFSLt1_VLN2.20 <- ModelDFSLt1_VLN2.19[-nrow(ModelDFSLt1_VLN2.19),]
ModelDFSLt1_VLN2.21 <- ModelDFSLt1_VLN2.20[-nrow(ModelDFSLt1_VLN2.20),]
ModelDFSLt1_VLN2.22 <- ModelDFSLt1_VLN2.21[-nrow(ModelDFSLt1_VLN2.21),]
ModelDFSLt1_VLN2.23 <- ModelDFSLt1_VLN2.22[-nrow(ModelDFSLt1_VLN2.22),]
ModelDFSLt1_VLN2.24 <- ModelDFSLt1_VLN2.23[-nrow(ModelDFSLt1_VLN2.23),]

ModelDFSLt1_VLN2 <- ModelDFSLt1_VLN2.24 #Create model t=x+1

#Subtract model (t=x) - (t=x+1)
ModelDFSL1y_VLN2 <- ModelDFSLt0_VLN2 - ModelDFSLt1_VLN2

#Re-do Month Number column because the substraction was also applied to it
ModelDFSL1y_VLN2$MNumber <- seq(from = 1, to = SimulationLength_months)

#This model will be called VLN2P because implies a one-off input of C
ModelDFSL_VLN2P <- ModelDFSL1y_VLN2

#Export the dataframe
write_xlsx(ModelDFSL_VLN2P,"VXP_Models\\ModelDFSL_R_VLN2P.xlsx")

#Plot 3: Interactive Yearly CO2 emissions #
MY <- 12
ModelDFSL_VLN2P_YCO2 <- ModelDFSL_VLN2P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VLN2)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLN2P_YCO2) <- c("Year", "Months", "AnnualCO2_VLN_2")

#Plot 3: Interactive Yearly CO2 emissions considering a delay
GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
ModelDFSL_VLN2P_YCO2D <- merge(ModelDFSL_VLN2P_YCO2, GWP100delay, by = "Year")
ModelDFSL_VLN2P_YCO2D$AnnualCO2D_VLN_2 <- ModelDFSL_VLN2P_YCO2D$AnnualCO2_VLN_2 * ModelDFSL_VLN2P_YCO2D$GWP100

#Plot 4: Interactive Yearly C emissions #
MY <- 12
ModelDFSL_VLN2P_YC <- ModelDFSL_VLN2P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VLN2)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLN2P_YC) <- c("Year", "Months", "CEmissions_VLN_2")

#Plot 5: Interactive Yearly C tails (remaining C in Soil) #
MY <- 12
ModelDFSL_VLN2P_YCT <- ModelDFSL_VLN2P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VLN2)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLN2P_YCT) <- c("Year", "Months", "CTail_VLN_2")

#Save Dataframes for Plots 3.1, 3.2, 4 and 5
write_xlsx(ModelDFSL_VLN2P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VLN2P.xlsx") #Yearly CO2 emissions (no delay)
write_xlsx(ModelDFSL_VLN2P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VLN2P.xlsx") #Yearly CO2 emissions (delay)
write_xlsx(ModelDFSL_VLN2P_YC,"CEmissions_P\\ModelDFSL_R_CE_VLN2P.xlsx") #Yearly C emissions
write_xlsx(ModelDFSL_VLN2P_YCT,"CTails_P\\ModelDFSL_R_CT_VLN2P.xlsx") #Yearly C emissions



#### 9.4 - VLN3) Litter; 30%clay; No Tillage ####
#The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
fT_VLN3=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
fW_VLN3=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                        S.Thick = soil.thick, pClay = clay100*0.3,
                        pE = 1.0, bare = FALSE)$b #Moisture effects per month
xi.frame_VLN3=data.frame(years,rep(fT_VLN3*fW_VLN3,length.out=length(years)))

#To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
Model_VLN3=SoilR::RothCModel(
  t=years, #Simulation Length
  ks=c(k.DPM = 10*NTRM, k.RPM = 0.3*NTRM, k.BIO = 0.66*NTRM, k.HUM = 0.02*NTRM, k.IOM = 0*NTRM), #Decomposition rates for the different pools
  C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
  In=Scalar_LitterCinputs*1, #Amount of litter inputs by time
  FYM = Scalar_ManureCinputs*0, #Amount of Farm Yard Manure by time
  clay=clay100*0.3, #Percent clay in mineral soil
  xi=xi.frame_VLN3) #Loads the model

Ct_VLN3=getC(Model_VLN3) #Calculates stocks for each pool per month

#The results can be plotted with the commands
matplot(years, Ct_VLN3, type="l", lty=1, col=1:5,
        xlab="Time (years)", ylab="C stocks (Mg/ha)")
legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
       lty=1, col=1:5, bty="n")

VEC_Lit_VLN3 <- rep(M_Scalar_LitterCinputs*1, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
VEC_Man_VLN3 <- rep(M_Scalar_ManureCinputs*0, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

VEC_LitDF_VLN3 <- as.data.frame(VEC_Lit_VLN3) #Converting the Litter vector to a data frame
VEC_LitDF_VLN3$MNumber <- seq(from = 1, to = SimulationLength_months)
VEC_ManDF_VLN3 <- as.data.frame(VEC_Man_VLN3) #Converting the Manure vector to a data frame
VEC_ManDF_VLN3$MNumber <- seq(from = 1, to = SimulationLength_months)

sapply(VEC_LitDF_VLN3, class) #Check that class is numeric
sapply(VEC_ManDF_VLN3, class) #Check that class is numeric
LitterCinputs_VLN3=VEC_LitDF_VLN3   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
ManureCinputs_VLN3=VEC_ManDF_VLN3 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
MCinputs_VLN3 <- merge(LitterCinputs_VLN3, ManureCinputs_VLN3, by = "MNumber")
MCinputs_VLN3$MInput_VLN3 <- MCinputs_VLN3$VEC_Lit_VLN3 + MCinputs_VLN3$VEC_Man_VLN3

#Change names of litter and manure columns for more common ones
colnames(MCinputs_VLN3)[which(names(MCinputs_VLN3) == "VEC_Lit_VLN3")] <- "LitterC_VLN3"
colnames(MCinputs_VLN3)[which(names(MCinputs_VLN3) == "VEC_Man_VLN3")] <- "ManureC_VLN3"

#Create a dataframe with the data considering the simulation length
ModelDF_VLN3 <- as.data.frame(Ct_VLN3)
colnames(ModelDF_VLN3) <- c('DPM_VLN3','RPM_VLN3','BIO_VLN3', 'HUM_VLN3', 'IOM_VLN3')
ModelDFS_VLN3 <- ModelDF_VLN3[1:SimulationLength_months, ]

#Create a column with the number of month of analysis
ModelDFS_VLN3$MNumber <- seq(from = 1, to = SimulationLength_months)

#Create a column that sums all pools
ModelDFS_VLN3$AllPools_VLN3 <- ModelDFS_VLN3$DPM_VLN3 + ModelDFS_VLN3$RPM_VLN3 + ModelDFS_VLN3$BIO_VLN3 + ModelDFS_VLN3$HUM_VLN3 + ModelDFS_VLN3$IOM_VLN3

#Create a column that sums all pools except IOM (static)
ModelDFS_VLN3$AllPools_noIOM_VLN3 <- ModelDFS_VLN3$DPM_VLN3 + ModelDFS_VLN3$RPM_VLN3 + ModelDFS_VLN3$BIO_VLN3 + ModelDFS_VLN3$HUM_VLN3

#Create a column that add the monthly input of C (manure and litter separately)
ModelDFSL_VLN3 <- merge(ModelDFS_VLN3, MCinputs_VLN3, by = "MNumber")

ModelDFSL_VLN3$MInput_VLN3 <- ModelDFSL_VLN3$LitterC_VLN3 + ModelDFSL_VLN3$ManureC_VLN3
#ModelDF_SL$MInput[1] <- 0

#Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
ModelDFSL_VLN3$CTails_VLN3 <- ModelDFSL_VLN3$AllPools_noIOM_VLN3 + ModelDFSL_VLN3$MInput_VLN3

#Create Monthly Accumulated input of C
ModelDFSL_VLN3$AccumInput_VLN3 = ModelDFSL_VLN3$AccumInput_VLN3=cumsum(ModelDFSL_VLN3$MInput_VLN3)

#Create Monthly Growths for each carbon pool
ModelDFSL_VLN3$MGrowth_DPM_VLN3 <- ave(ModelDFSL_VLN3$DPM_VLN3, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLN3$MGrowth_RPM_VLN3 <- ave(ModelDFSL_VLN3$RPM_VLN3, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLN3$MGrowth_BIO_VLN3 <- ave(ModelDFSL_VLN3$BIO_VLN3, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLN3$MGrowth_HUM_VLN3 <- ave(ModelDFSL_VLN3$HUM_VLN3, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLN3$MGrowth_IOM_VLN3 <- ave(ModelDFSL_VLN3$IOM_VLN3, FUN = function(x) c(0, diff(x)))

#Create column for Monthly and Accumulated C-CO2 emissions
ModelDFSL_VLN3$M_CCO2_VLN3 <- ModelDFSL_VLN3$MInput_VLN3 - ModelDFSL_VLN3$MGrowth_DPM_VLN3 - ModelDFSL_VLN3$MGrowth_RPM_VLN3 - ModelDFSL_VLN3$MGrowth_BIO_VLN3 - ModelDFSL_VLN3$MGrowth_HUM_VLN3
ModelDFSL_VLN3$Accum_CCO2_VLN3 <- ModelDFSL_VLN3$AccumInput_VLN3 - ModelDFSL_VLN3$AllPools_noIOM_VLN3

#Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
ModelDFSL_VLN3$M_CCO2_VLN3[1] <- 0
ModelDFSL_VLN3$Accum_CCO2_VLN3[1] <- 0

#Balance validation
ModelDFSL_VLN3$Balance_VLN3 <- ModelDFSL_VLN3$AccumInput_VLN3 - ModelDFSL_VLN3$Accum_CCO2_VLN3 - (ModelDFSL_VLN3$DPM_VLN3 + ModelDFSL_VLN3$RPM_VLN3 + ModelDFSL_VLN3$BIO_VLN3 + ModelDFSL_VLN3$HUM_VLN3)

#Convert C-CO2 emissions into CO2 emissions
ModelDFSL_VLN3$M_CO2_VLN3 <- ModelDFSL_VLN3$M_CCO2_VLN3 * 44/12
ModelDFSL_VLN3$Accum_CO2_VLN3 <- ModelDFSL_VLN3$Accum_CCO2_VLN3 * 44/12

#This model will be called VLN3C because implies a continuous input of C
ModelDFSL_VLN3C <- ModelDFSL_VLN3

#Export the dataframe
write_xlsx(ModelDFSL_VLN3C,"VXC_Models\\ModelDFSL_R_VLN3C.xlsx")

#Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
#Create two equal models by using the above general script
#Create model t=x
ModelDFSLt0_VLN3 <- ModelDFSL_VLN3 #Create model t=x

#Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
ModelDFSLt1_VLN3.1 <- rbind(c(0:0), ModelDFSLt0_VLN3)
ModelDFSLt1_VLN3.2 <- rbind(c(0:0), ModelDFSLt1_VLN3.1)
ModelDFSLt1_VLN3.3 <- rbind(c(0:0), ModelDFSLt1_VLN3.2)
ModelDFSLt1_VLN3.4 <- rbind(c(0:0), ModelDFSLt1_VLN3.3)
ModelDFSLt1_VLN3.5 <- rbind(c(0:0), ModelDFSLt1_VLN3.4)
ModelDFSLt1_VLN3.6 <- rbind(c(0:0), ModelDFSLt1_VLN3.5)
ModelDFSLt1_VLN3.7 <- rbind(c(0:0), ModelDFSLt1_VLN3.6)
ModelDFSLt1_VLN3.8 <- rbind(c(0:0), ModelDFSLt1_VLN3.7)
ModelDFSLt1_VLN3.9 <- rbind(c(0:0), ModelDFSLt1_VLN3.8)
ModelDFSLt1_VLN3.10 <- rbind(c(0:0), ModelDFSLt1_VLN3.9)
ModelDFSLt1_VLN3.11 <- rbind(c(0:0), ModelDFSLt1_VLN3.10)
ModelDFSLt1_VLN3.12 <- rbind(c(0:0), ModelDFSLt1_VLN3.11)
ModelDFSLt1_VLN3.13 <- ModelDFSLt1_VLN3.12[-nrow(ModelDFSLt1_VLN3.12),]
ModelDFSLt1_VLN3.14 <- ModelDFSLt1_VLN3.13[-nrow(ModelDFSLt1_VLN3.13),]
ModelDFSLt1_VLN3.15 <- ModelDFSLt1_VLN3.14[-nrow(ModelDFSLt1_VLN3.14),]
ModelDFSLt1_VLN3.16 <- ModelDFSLt1_VLN3.15[-nrow(ModelDFSLt1_VLN3.15),]
ModelDFSLt1_VLN3.17 <- ModelDFSLt1_VLN3.16[-nrow(ModelDFSLt1_VLN3.16),]
ModelDFSLt1_VLN3.18 <- ModelDFSLt1_VLN3.17[-nrow(ModelDFSLt1_VLN3.17),]
ModelDFSLt1_VLN3.19 <- ModelDFSLt1_VLN3.18[-nrow(ModelDFSLt1_VLN3.18),]
ModelDFSLt1_VLN3.20 <- ModelDFSLt1_VLN3.19[-nrow(ModelDFSLt1_VLN3.19),]
ModelDFSLt1_VLN3.21 <- ModelDFSLt1_VLN3.20[-nrow(ModelDFSLt1_VLN3.20),]
ModelDFSLt1_VLN3.22 <- ModelDFSLt1_VLN3.21[-nrow(ModelDFSLt1_VLN3.21),]
ModelDFSLt1_VLN3.23 <- ModelDFSLt1_VLN3.22[-nrow(ModelDFSLt1_VLN3.22),]
ModelDFSLt1_VLN3.24 <- ModelDFSLt1_VLN3.23[-nrow(ModelDFSLt1_VLN3.23),]

ModelDFSLt1_VLN3 <- ModelDFSLt1_VLN3.24 #Create model t=x+1

#Subtract model (t=x) - (t=x+1)
ModelDFSL1y_VLN3 <- ModelDFSLt0_VLN3 - ModelDFSLt1_VLN3

#Re-do Month Number column because the substraction was also applied to it
ModelDFSL1y_VLN3$MNumber <- seq(from = 1, to = SimulationLength_months)

#This model will be called VLN3P because implies a one-off input of C
ModelDFSL_VLN3P <- ModelDFSL1y_VLN3

#Export the dataframe
write_xlsx(ModelDFSL_VLN3P,"VXP_Models\\ModelDFSL_R_VLN3P.xlsx")

#Plot 3: Interactive Yearly CO2 emissions #
MY <- 12
ModelDFSL_VLN3P_YCO2 <- ModelDFSL_VLN3P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VLN3)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLN3P_YCO2) <- c("Year", "Months", "AnnualCO2_VLN_3")

#Plot 3: Interactive Yearly CO2 emissions considering a delay
GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
ModelDFSL_VLN3P_YCO2D <- merge(ModelDFSL_VLN3P_YCO2, GWP100delay, by = "Year")
ModelDFSL_VLN3P_YCO2D$AnnualCO2D_VLN_3 <- ModelDFSL_VLN3P_YCO2D$AnnualCO2_VLN_3 * ModelDFSL_VLN3P_YCO2D$GWP100

#Plot 4: Interactive Yearly C emissions #
MY <- 12
ModelDFSL_VLN3P_YC <- ModelDFSL_VLN3P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VLN3)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLN3P_YC) <- c("Year", "Months", "CEmissions_VLN_3")

#Plot 5: Interactive Yearly C tails (remaining C in Soil) #
MY <- 12
ModelDFSL_VLN3P_YCT <- ModelDFSL_VLN3P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VLN3)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLN3P_YCT) <- c("Year", "Months", "CTail_VLN_3")

#Save Dataframes for Plots 3.1, 3.2, 4 and 5
write_xlsx(ModelDFSL_VLN3P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VLN3P.xlsx") #Yearly CO2 emissions (no delay)
write_xlsx(ModelDFSL_VLN3P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VLN3P.xlsx") #Yearly CO2 emissions (delay)
write_xlsx(ModelDFSL_VLN3P_YC,"CEmissions_P\\ModelDFSL_R_CE_VLN3P.xlsx") #Yearly C emissions
write_xlsx(ModelDFSL_VLN3P_YCT,"CTails_P\\ModelDFSL_R_CT_VLN3P.xlsx") #Yearly C emissions



#### 9.5 - VLN4) Litter; 40%clay; No Tillage ####
#The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
fT_VLN4=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
fW_VLN4=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                        S.Thick = soil.thick, pClay = clay100*0.4,
                        pE = 1.0, bare = FALSE)$b #Moisture effects per month
xi.frame_VLN4=data.frame(years,rep(fT_VLN4*fW_VLN4,length.out=length(years)))

#To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
Model_VLN4=SoilR::RothCModel(
  t=years, #Simulation Length
  ks=c(k.DPM = 10*NTRM, k.RPM = 0.3*NTRM, k.BIO = 0.66*NTRM, k.HUM = 0.02*NTRM, k.IOM = 0*NTRM), #Decomposition rates for the different pools
  C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
  In=Scalar_LitterCinputs*1, #Amount of litter inputs by time
  FYM = Scalar_ManureCinputs*0, #Amount of Farm Yard Manure by time
  clay=clay100*0.4, #Percent clay in mineral soil
  xi=xi.frame_VLN4) #Loads the model

Ct_VLN4=getC(Model_VLN4) #Calculates stocks for each pool per month

#The results can be plotted with the commands
matplot(years, Ct_VLN4, type="l", lty=1, col=1:5,
        xlab="Time (years)", ylab="C stocks (Mg/ha)")
legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
       lty=1, col=1:5, bty="n")

VEC_Lit_VLN4 <- rep(M_Scalar_LitterCinputs*1, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
VEC_Man_VLN4 <- rep(M_Scalar_ManureCinputs*0, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

VEC_LitDF_VLN4 <- as.data.frame(VEC_Lit_VLN4) #Converting the Litter vector to a data frame
VEC_LitDF_VLN4$MNumber <- seq(from = 1, to = SimulationLength_months)
VEC_ManDF_VLN4 <- as.data.frame(VEC_Man_VLN4) #Converting the Manure vector to a data frame
VEC_ManDF_VLN4$MNumber <- seq(from = 1, to = SimulationLength_months)

sapply(VEC_LitDF_VLN4, class) #Check that class is numeric
sapply(VEC_ManDF_VLN4, class) #Check that class is numeric
LitterCinputs_VLN4=VEC_LitDF_VLN4   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
ManureCinputs_VLN4=VEC_ManDF_VLN4 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
MCinputs_VLN4 <- merge(LitterCinputs_VLN4, ManureCinputs_VLN4, by = "MNumber")
MCinputs_VLN4$MInput_VLN4 <- MCinputs_VLN4$VEC_Lit_VLN4 + MCinputs_VLN4$VEC_Man_VLN4

#Change names of litter and manure columns for more common ones
colnames(MCinputs_VLN4)[which(names(MCinputs_VLN4) == "VEC_Lit_VLN4")] <- "LitterC_VLN4"
colnames(MCinputs_VLN4)[which(names(MCinputs_VLN4) == "VEC_Man_VLN4")] <- "ManureC_VLN4"

#Create a dataframe with the data considering the simulation length
ModelDF_VLN4 <- as.data.frame(Ct_VLN4)
colnames(ModelDF_VLN4) <- c('DPM_VLN4','RPM_VLN4','BIO_VLN4', 'HUM_VLN4', 'IOM_VLN4')
ModelDFS_VLN4 <- ModelDF_VLN4[1:SimulationLength_months, ]

#Create a column with the number of month of analysis
ModelDFS_VLN4$MNumber <- seq(from = 1, to = SimulationLength_months)

#Create a column that sums all pools
ModelDFS_VLN4$AllPools_VLN4 <- ModelDFS_VLN4$DPM_VLN4 + ModelDFS_VLN4$RPM_VLN4 + ModelDFS_VLN4$BIO_VLN4 + ModelDFS_VLN4$HUM_VLN4 + ModelDFS_VLN4$IOM_VLN4

#Create a column that sums all pools except IOM (static)
ModelDFS_VLN4$AllPools_noIOM_VLN4 <- ModelDFS_VLN4$DPM_VLN4 + ModelDFS_VLN4$RPM_VLN4 + ModelDFS_VLN4$BIO_VLN4 + ModelDFS_VLN4$HUM_VLN4

#Create a column that add the monthly input of C (manure and litter separately)
ModelDFSL_VLN4 <- merge(ModelDFS_VLN4, MCinputs_VLN4, by = "MNumber")

ModelDFSL_VLN4$MInput_VLN4 <- ModelDFSL_VLN4$LitterC_VLN4 + ModelDFSL_VLN4$ManureC_VLN4
#ModelDF_SL$MInput[1] <- 0

#Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
ModelDFSL_VLN4$CTails_VLN4 <- ModelDFSL_VLN4$AllPools_noIOM_VLN4 + ModelDFSL_VLN4$MInput_VLN4

#Create Monthly Accumulated input of C
ModelDFSL_VLN4$AccumInput_VLN4 = ModelDFSL_VLN4$AccumInput_VLN4=cumsum(ModelDFSL_VLN4$MInput_VLN4)

#Create Monthly Growths for each carbon pool
ModelDFSL_VLN4$MGrowth_DPM_VLN4 <- ave(ModelDFSL_VLN4$DPM_VLN4, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLN4$MGrowth_RPM_VLN4 <- ave(ModelDFSL_VLN4$RPM_VLN4, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLN4$MGrowth_BIO_VLN4 <- ave(ModelDFSL_VLN4$BIO_VLN4, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLN4$MGrowth_HUM_VLN4 <- ave(ModelDFSL_VLN4$HUM_VLN4, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLN4$MGrowth_IOM_VLN4 <- ave(ModelDFSL_VLN4$IOM_VLN4, FUN = function(x) c(0, diff(x)))

#Create column for Monthly and Accumulated C-CO2 emissions
ModelDFSL_VLN4$M_CCO2_VLN4 <- ModelDFSL_VLN4$MInput_VLN4 - ModelDFSL_VLN4$MGrowth_DPM_VLN4 - ModelDFSL_VLN4$MGrowth_RPM_VLN4 - ModelDFSL_VLN4$MGrowth_BIO_VLN4 - ModelDFSL_VLN4$MGrowth_HUM_VLN4
ModelDFSL_VLN4$Accum_CCO2_VLN4 <- ModelDFSL_VLN4$AccumInput_VLN4 - ModelDFSL_VLN4$AllPools_noIOM_VLN4

#Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
ModelDFSL_VLN4$M_CCO2_VLN4[1] <- 0
ModelDFSL_VLN4$Accum_CCO2_VLN4[1] <- 0

#Balance validation
ModelDFSL_VLN4$Balance_VLN4 <- ModelDFSL_VLN4$AccumInput_VLN4 - ModelDFSL_VLN4$Accum_CCO2_VLN4 - (ModelDFSL_VLN4$DPM_VLN4 + ModelDFSL_VLN4$RPM_VLN4 + ModelDFSL_VLN4$BIO_VLN4 + ModelDFSL_VLN4$HUM_VLN4)

#Convert C-CO2 emissions into CO2 emissions
ModelDFSL_VLN4$M_CO2_VLN4 <- ModelDFSL_VLN4$M_CCO2_VLN4 * 44/12
ModelDFSL_VLN4$Accum_CO2_VLN4 <- ModelDFSL_VLN4$Accum_CCO2_VLN4 * 44/12

#This model will be called VLN4C because implies a continuous input of C
ModelDFSL_VLN4C <- ModelDFSL_VLN4

#Export the dataframe
write_xlsx(ModelDFSL_VLN4C,"VXC_Models\\ModelDFSL_R_VLN4C.xlsx")

#Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
#Create two equal models by using the above general script
#Create model t=x
ModelDFSLt0_VLN4 <- ModelDFSL_VLN4 #Create model t=x

#Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
ModelDFSLt1_VLN4.1 <- rbind(c(0:0), ModelDFSLt0_VLN4)
ModelDFSLt1_VLN4.2 <- rbind(c(0:0), ModelDFSLt1_VLN4.1)
ModelDFSLt1_VLN4.3 <- rbind(c(0:0), ModelDFSLt1_VLN4.2)
ModelDFSLt1_VLN4.4 <- rbind(c(0:0), ModelDFSLt1_VLN4.3)
ModelDFSLt1_VLN4.5 <- rbind(c(0:0), ModelDFSLt1_VLN4.4)
ModelDFSLt1_VLN4.6 <- rbind(c(0:0), ModelDFSLt1_VLN4.5)
ModelDFSLt1_VLN4.7 <- rbind(c(0:0), ModelDFSLt1_VLN4.6)
ModelDFSLt1_VLN4.8 <- rbind(c(0:0), ModelDFSLt1_VLN4.7)
ModelDFSLt1_VLN4.9 <- rbind(c(0:0), ModelDFSLt1_VLN4.8)
ModelDFSLt1_VLN4.10 <- rbind(c(0:0), ModelDFSLt1_VLN4.9)
ModelDFSLt1_VLN4.11 <- rbind(c(0:0), ModelDFSLt1_VLN4.10)
ModelDFSLt1_VLN4.12 <- rbind(c(0:0), ModelDFSLt1_VLN4.11)
ModelDFSLt1_VLN4.13 <- ModelDFSLt1_VLN4.12[-nrow(ModelDFSLt1_VLN4.12),]
ModelDFSLt1_VLN4.14 <- ModelDFSLt1_VLN4.13[-nrow(ModelDFSLt1_VLN4.13),]
ModelDFSLt1_VLN4.15 <- ModelDFSLt1_VLN4.14[-nrow(ModelDFSLt1_VLN4.14),]
ModelDFSLt1_VLN4.16 <- ModelDFSLt1_VLN4.15[-nrow(ModelDFSLt1_VLN4.15),]
ModelDFSLt1_VLN4.17 <- ModelDFSLt1_VLN4.16[-nrow(ModelDFSLt1_VLN4.16),]
ModelDFSLt1_VLN4.18 <- ModelDFSLt1_VLN4.17[-nrow(ModelDFSLt1_VLN4.17),]
ModelDFSLt1_VLN4.19 <- ModelDFSLt1_VLN4.18[-nrow(ModelDFSLt1_VLN4.18),]
ModelDFSLt1_VLN4.20 <- ModelDFSLt1_VLN4.19[-nrow(ModelDFSLt1_VLN4.19),]
ModelDFSLt1_VLN4.21 <- ModelDFSLt1_VLN4.20[-nrow(ModelDFSLt1_VLN4.20),]
ModelDFSLt1_VLN4.22 <- ModelDFSLt1_VLN4.21[-nrow(ModelDFSLt1_VLN4.21),]
ModelDFSLt1_VLN4.23 <- ModelDFSLt1_VLN4.22[-nrow(ModelDFSLt1_VLN4.22),]
ModelDFSLt1_VLN4.24 <- ModelDFSLt1_VLN4.23[-nrow(ModelDFSLt1_VLN4.23),]

ModelDFSLt1_VLN4 <- ModelDFSLt1_VLN4.24 #Create model t=x+1

#Subtract model (t=x) - (t=x+1)
ModelDFSL1y_VLN4 <- ModelDFSLt0_VLN4 - ModelDFSLt1_VLN4

#Re-do Month Number column because the substraction was also applied to it
ModelDFSL1y_VLN4$MNumber <- seq(from = 1, to = SimulationLength_months)

#This model will be called VLN4P because implies a one-off input of C
ModelDFSL_VLN4P <- ModelDFSL1y_VLN4

#Export the dataframe
write_xlsx(ModelDFSL_VLN4P,"VXP_Models\\ModelDFSL_R_VLN4P.xlsx")

#Plot 3: Interactive Yearly CO2 emissions #
MY <- 12
ModelDFSL_VLN4P_YCO2 <- ModelDFSL_VLN4P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VLN4)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLN4P_YCO2) <- c("Year", "Months", "AnnualCO2_VLN_4")

#Plot 3: Interactive Yearly CO2 emissions considering a delay
GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
ModelDFSL_VLN4P_YCO2D <- merge(ModelDFSL_VLN4P_YCO2, GWP100delay, by = "Year")
ModelDFSL_VLN4P_YCO2D$AnnualCO2D_VLN_4 <- ModelDFSL_VLN4P_YCO2D$AnnualCO2_VLN_4 * ModelDFSL_VLN4P_YCO2D$GWP100

#Plot 4: Interactive Yearly C emissions #
MY <- 12
ModelDFSL_VLN4P_YC <- ModelDFSL_VLN4P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VLN4)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLN4P_YC) <- c("Year", "Months", "CEmissions_VLN_4")

#Plot 5: Interactive Yearly C tails (remaining C in Soil) #
MY <- 12
ModelDFSL_VLN4P_YCT <- ModelDFSL_VLN4P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VLN4)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLN4P_YCT) <- c("Year", "Months", "CTail_VLN_4")

#Save Dataframes for Plots 3.1, 3.2, 4 and 5
write_xlsx(ModelDFSL_VLN4P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VLN4P.xlsx") #Yearly CO2 emissions (no delay)
write_xlsx(ModelDFSL_VLN4P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VLN4P.xlsx") #Yearly CO2 emissions (delay)
write_xlsx(ModelDFSL_VLN4P_YC,"CEmissions_P\\ModelDFSL_R_CE_VLN4P.xlsx") #Yearly C emissions
write_xlsx(ModelDFSL_VLN4P_YCT,"CTails_P\\ModelDFSL_R_CT_VLN4P.xlsx") #Yearly C emissions



#### 9.6 - VLN5) Litter; 50%clay; No Tillage ####
#The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
fT_VLN5=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
fW_VLN5=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                        S.Thick = soil.thick, pClay = clay100*0.5,
                        pE = 1.0, bare = FALSE)$b #Moisture effects per month
xi.frame_VLN5=data.frame(years,rep(fT_VLN5*fW_VLN5,length.out=length(years)))

#To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
Model_VLN5=SoilR::RothCModel(
  t=years, #Simulation Length
  ks=c(k.DPM = 10*NTRM, k.RPM = 0.3*NTRM, k.BIO = 0.66*NTRM, k.HUM = 0.02*NTRM, k.IOM = 0*NTRM), #Decomposition rates for the different pools
  C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
  In=Scalar_LitterCinputs*1, #Amount of litter inputs by time
  FYM = Scalar_ManureCinputs*0, #Amount of Farm Yard Manure by time
  clay=clay100*0.5, #Percent clay in mineral soil
  xi=xi.frame_VLN5) #Loads the model

Ct_VLN5=getC(Model_VLN5) #Calculates stocks for each pool per month

#The results can be plotted with the commands
matplot(years, Ct_VLN5, type="l", lty=1, col=1:5,
        xlab="Time (years)", ylab="C stocks (Mg/ha)")
legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
       lty=1, col=1:5, bty="n")

VEC_Lit_VLN5 <- rep(M_Scalar_LitterCinputs*1, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
VEC_Man_VLN5 <- rep(M_Scalar_ManureCinputs*0, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

VEC_LitDF_VLN5 <- as.data.frame(VEC_Lit_VLN5) #Converting the Litter vector to a data frame
VEC_LitDF_VLN5$MNumber <- seq(from = 1, to = SimulationLength_months)
VEC_ManDF_VLN5 <- as.data.frame(VEC_Man_VLN5) #Converting the Manure vector to a data frame
VEC_ManDF_VLN5$MNumber <- seq(from = 1, to = SimulationLength_months)

sapply(VEC_LitDF_VLN5, class) #Check that class is numeric
sapply(VEC_ManDF_VLN5, class) #Check that class is numeric
LitterCinputs_VLN5=VEC_LitDF_VLN5   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
ManureCinputs_VLN5=VEC_ManDF_VLN5 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
MCinputs_VLN5 <- merge(LitterCinputs_VLN5, ManureCinputs_VLN5, by = "MNumber")
MCinputs_VLN5$MInput_VLN5 <- MCinputs_VLN5$VEC_Lit_VLN5 + MCinputs_VLN5$VEC_Man_VLN5

#Change names of litter and manure columns for more common ones
colnames(MCinputs_VLN5)[which(names(MCinputs_VLN5) == "VEC_Lit_VLN5")] <- "LitterC_VLN5"
colnames(MCinputs_VLN5)[which(names(MCinputs_VLN5) == "VEC_Man_VLN5")] <- "ManureC_VLN5"

#Create a dataframe with the data considering the simulation length
ModelDF_VLN5 <- as.data.frame(Ct_VLN5)
colnames(ModelDF_VLN5) <- c('DPM_VLN5','RPM_VLN5','BIO_VLN5', 'HUM_VLN5', 'IOM_VLN5')
ModelDFS_VLN5 <- ModelDF_VLN5[1:SimulationLength_months, ]

#Create a column with the number of month of analysis
ModelDFS_VLN5$MNumber <- seq(from = 1, to = SimulationLength_months)

#Create a column that sums all pools
ModelDFS_VLN5$AllPools_VLN5 <- ModelDFS_VLN5$DPM_VLN5 + ModelDFS_VLN5$RPM_VLN5 + ModelDFS_VLN5$BIO_VLN5 + ModelDFS_VLN5$HUM_VLN5 + ModelDFS_VLN5$IOM_VLN5

#Create a column that sums all pools except IOM (static)
ModelDFS_VLN5$AllPools_noIOM_VLN5 <- ModelDFS_VLN5$DPM_VLN5 + ModelDFS_VLN5$RPM_VLN5 + ModelDFS_VLN5$BIO_VLN5 + ModelDFS_VLN5$HUM_VLN5

#Create a column that add the monthly input of C (manure and litter separately)
ModelDFSL_VLN5 <- merge(ModelDFS_VLN5, MCinputs_VLN5, by = "MNumber")

ModelDFSL_VLN5$MInput_VLN5 <- ModelDFSL_VLN5$LitterC_VLN5 + ModelDFSL_VLN5$ManureC_VLN5
#ModelDF_SL$MInput[1] <- 0

#Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
ModelDFSL_VLN5$CTails_VLN5 <- ModelDFSL_VLN5$AllPools_noIOM_VLN5 + ModelDFSL_VLN5$MInput_VLN5

#Create Monthly Accumulated input of C
ModelDFSL_VLN5$AccumInput_VLN5 = ModelDFSL_VLN5$AccumInput_VLN5=cumsum(ModelDFSL_VLN5$MInput_VLN5)

#Create Monthly Growths for each carbon pool
ModelDFSL_VLN5$MGrowth_DPM_VLN5 <- ave(ModelDFSL_VLN5$DPM_VLN5, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLN5$MGrowth_RPM_VLN5 <- ave(ModelDFSL_VLN5$RPM_VLN5, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLN5$MGrowth_BIO_VLN5 <- ave(ModelDFSL_VLN5$BIO_VLN5, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLN5$MGrowth_HUM_VLN5 <- ave(ModelDFSL_VLN5$HUM_VLN5, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLN5$MGrowth_IOM_VLN5 <- ave(ModelDFSL_VLN5$IOM_VLN5, FUN = function(x) c(0, diff(x)))

#Create column for Monthly and Accumulated C-CO2 emissions
ModelDFSL_VLN5$M_CCO2_VLN5 <- ModelDFSL_VLN5$MInput_VLN5 - ModelDFSL_VLN5$MGrowth_DPM_VLN5 - ModelDFSL_VLN5$MGrowth_RPM_VLN5 - ModelDFSL_VLN5$MGrowth_BIO_VLN5 - ModelDFSL_VLN5$MGrowth_HUM_VLN5
ModelDFSL_VLN5$Accum_CCO2_VLN5 <- ModelDFSL_VLN5$AccumInput_VLN5 - ModelDFSL_VLN5$AllPools_noIOM_VLN5

#Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
ModelDFSL_VLN5$M_CCO2_VLN5[1] <- 0
ModelDFSL_VLN5$Accum_CCO2_VLN5[1] <- 0

#Balance validation
ModelDFSL_VLN5$Balance_VLN5 <- ModelDFSL_VLN5$AccumInput_VLN5 - ModelDFSL_VLN5$Accum_CCO2_VLN5 - (ModelDFSL_VLN5$DPM_VLN5 + ModelDFSL_VLN5$RPM_VLN5 + ModelDFSL_VLN5$BIO_VLN5 + ModelDFSL_VLN5$HUM_VLN5)

#Convert C-CO2 emissions into CO2 emissions
ModelDFSL_VLN5$M_CO2_VLN5 <- ModelDFSL_VLN5$M_CCO2_VLN5 * 44/12
ModelDFSL_VLN5$Accum_CO2_VLN5 <- ModelDFSL_VLN5$Accum_CCO2_VLN5 * 44/12

#This model will be called VLN5C because implies a continuous input of C
ModelDFSL_VLN5C <- ModelDFSL_VLN5

#Export the dataframe
write_xlsx(ModelDFSL_VLN5C,"VXC_Models\\ModelDFSL_R_VLN5C.xlsx")

#Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
#Create two equal models by using the above general script
#Create model t=x
ModelDFSLt0_VLN5 <- ModelDFSL_VLN5 #Create model t=x

#Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
ModelDFSLt1_VLN5.1 <- rbind(c(0:0), ModelDFSLt0_VLN5)
ModelDFSLt1_VLN5.2 <- rbind(c(0:0), ModelDFSLt1_VLN5.1)
ModelDFSLt1_VLN5.3 <- rbind(c(0:0), ModelDFSLt1_VLN5.2)
ModelDFSLt1_VLN5.4 <- rbind(c(0:0), ModelDFSLt1_VLN5.3)
ModelDFSLt1_VLN5.5 <- rbind(c(0:0), ModelDFSLt1_VLN5.4)
ModelDFSLt1_VLN5.6 <- rbind(c(0:0), ModelDFSLt1_VLN5.5)
ModelDFSLt1_VLN5.7 <- rbind(c(0:0), ModelDFSLt1_VLN5.6)
ModelDFSLt1_VLN5.8 <- rbind(c(0:0), ModelDFSLt1_VLN5.7)
ModelDFSLt1_VLN5.9 <- rbind(c(0:0), ModelDFSLt1_VLN5.8)
ModelDFSLt1_VLN5.10 <- rbind(c(0:0), ModelDFSLt1_VLN5.9)
ModelDFSLt1_VLN5.11 <- rbind(c(0:0), ModelDFSLt1_VLN5.10)
ModelDFSLt1_VLN5.12 <- rbind(c(0:0), ModelDFSLt1_VLN5.11)
ModelDFSLt1_VLN5.13 <- ModelDFSLt1_VLN5.12[-nrow(ModelDFSLt1_VLN5.12),]
ModelDFSLt1_VLN5.14 <- ModelDFSLt1_VLN5.13[-nrow(ModelDFSLt1_VLN5.13),]
ModelDFSLt1_VLN5.15 <- ModelDFSLt1_VLN5.14[-nrow(ModelDFSLt1_VLN5.14),]
ModelDFSLt1_VLN5.16 <- ModelDFSLt1_VLN5.15[-nrow(ModelDFSLt1_VLN5.15),]
ModelDFSLt1_VLN5.17 <- ModelDFSLt1_VLN5.16[-nrow(ModelDFSLt1_VLN5.16),]
ModelDFSLt1_VLN5.18 <- ModelDFSLt1_VLN5.17[-nrow(ModelDFSLt1_VLN5.17),]
ModelDFSLt1_VLN5.19 <- ModelDFSLt1_VLN5.18[-nrow(ModelDFSLt1_VLN5.18),]
ModelDFSLt1_VLN5.20 <- ModelDFSLt1_VLN5.19[-nrow(ModelDFSLt1_VLN5.19),]
ModelDFSLt1_VLN5.21 <- ModelDFSLt1_VLN5.20[-nrow(ModelDFSLt1_VLN5.20),]
ModelDFSLt1_VLN5.22 <- ModelDFSLt1_VLN5.21[-nrow(ModelDFSLt1_VLN5.21),]
ModelDFSLt1_VLN5.23 <- ModelDFSLt1_VLN5.22[-nrow(ModelDFSLt1_VLN5.22),]
ModelDFSLt1_VLN5.24 <- ModelDFSLt1_VLN5.23[-nrow(ModelDFSLt1_VLN5.23),]

ModelDFSLt1_VLN5 <- ModelDFSLt1_VLN5.24 #Create model t=x+1

#Subtract model (t=x) - (t=x+1)
ModelDFSL1y_VLN5 <- ModelDFSLt0_VLN5 - ModelDFSLt1_VLN5

#Re-do Month Number column because the substraction was also applied to it
ModelDFSL1y_VLN5$MNumber <- seq(from = 1, to = SimulationLength_months)

#This model will be called VLN5P because implies a one-off input of C
ModelDFSL_VLN5P <- ModelDFSL1y_VLN5

#Export the dataframe
write_xlsx(ModelDFSL_VLN5P,"VXP_Models\\ModelDFSL_R_VLN5P.xlsx")


#Plot 3: Interactive Yearly CO2 emissions #
MY <- 12
ModelDFSL_VLN5P_YCO2 <- ModelDFSL_VLN5P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VLN5)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLN5P_YCO2) <- c("Year", "Months", "AnnualCO2_VLN_5")


#Plot 3: Interactive Yearly CO2 emissions considering a delay
GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
ModelDFSL_VLN5P_YCO2D <- merge(ModelDFSL_VLN5P_YCO2, GWP100delay, by = "Year")
ModelDFSL_VLN5P_YCO2D$AnnualCO2D_VLN_5 <- ModelDFSL_VLN5P_YCO2D$AnnualCO2_VLN_5 * ModelDFSL_VLN5P_YCO2D$GWP100

#Plot 4: Interactive Yearly C emissions #
MY <- 12
ModelDFSL_VLN5P_YC <- ModelDFSL_VLN5P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VLN5)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLN5P_YC) <- c("Year", "Months", "CEmissions_VLN_5")


#Plot 5: Interactive Yearly C tails (remaining C in Soil) #
MY <- 12
ModelDFSL_VLN5P_YCT <- ModelDFSL_VLN5P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VLN5)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLN5P_YCT) <- c("Year", "Months", "CTail_VLN_5")

#Save Dataframes for Plots 3.1, 3.2, 4 and 5
write_xlsx(ModelDFSL_VLN5P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VLN5P.xlsx") #Yearly CO2 emissions (no delay)
write_xlsx(ModelDFSL_VLN5P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VLN5P.xlsx") #Yearly CO2 emissions (delay)
write_xlsx(ModelDFSL_VLN5P_YC,"CEmissions_P\\ModelDFSL_R_CE_VLN5P.xlsx") #Yearly C emissions
write_xlsx(ModelDFSL_VLN5P_YCT,"CTails_P\\ModelDFSL_R_CT_VLN5P.xlsx") #Yearly C emissions



#### 9.7 - VLN6) Litter; 60%clay; No Tillage ####
#The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
fT_VLN6=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
fW_VLN6=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                        S.Thick = soil.thick, pClay = clay100*0.6,
                        pE = 1.0, bare = FALSE)$b #Moisture effects per month
xi.frame_VLN6=data.frame(years,rep(fT_VLN6*fW_VLN6,length.out=length(years)))

#To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
Model_VLN6=SoilR::RothCModel(
  t=years, #Simulation Length
  ks=c(k.DPM = 10*NTRM, k.RPM = 0.3*NTRM, k.BIO = 0.66*NTRM, k.HUM = 0.02*NTRM, k.IOM = 0*NTRM), #Decomposition rates for the different pools
  C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
  In=Scalar_LitterCinputs*1, #Amount of litter inputs by time
  FYM = Scalar_ManureCinputs*0, #Amount of Farm Yard Manure by time
  clay=clay100*0.6, #Percent clay in mineral soil
  xi=xi.frame_VLN6) #Loads the model

Ct_VLN6=getC(Model_VLN6) #Calculates stocks for each pool per month

#The results can be plotted with the commands
matplot(years, Ct_VLN6, type="l", lty=1, col=1:5,
        xlab="Time (years)", ylab="C stocks (Mg/ha)")
legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
       lty=1, col=1:5, bty="n")

VEC_Lit_VLN6 <- rep(M_Scalar_LitterCinputs*1, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
VEC_Man_VLN6 <- rep(M_Scalar_ManureCinputs*0, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

VEC_LitDF_VLN6 <- as.data.frame(VEC_Lit_VLN6) #Converting the Litter vector to a data frame
VEC_LitDF_VLN6$MNumber <- seq(from = 1, to = SimulationLength_months)
VEC_ManDF_VLN6 <- as.data.frame(VEC_Man_VLN6) #Converting the Manure vector to a data frame
VEC_ManDF_VLN6$MNumber <- seq(from = 1, to = SimulationLength_months)

sapply(VEC_LitDF_VLN6, class) #Check that class is numeric
sapply(VEC_ManDF_VLN6, class) #Check that class is numeric
LitterCinputs_VLN6=VEC_LitDF_VLN6   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
ManureCinputs_VLN6=VEC_ManDF_VLN6 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
MCinputs_VLN6 <- merge(LitterCinputs_VLN6, ManureCinputs_VLN6, by = "MNumber")
MCinputs_VLN6$MInput_VLN6 <- MCinputs_VLN6$VEC_Lit_VLN6 + MCinputs_VLN6$VEC_Man_VLN6

#Change names of litter and manure columns for more common ones
colnames(MCinputs_VLN6)[which(names(MCinputs_VLN6) == "VEC_Lit_VLN6")] <- "LitterC_VLN6"
colnames(MCinputs_VLN6)[which(names(MCinputs_VLN6) == "VEC_Man_VLN6")] <- "ManureC_VLN6"

#Create a dataframe with the data considering the simulation length
ModelDF_VLN6 <- as.data.frame(Ct_VLN6)
colnames(ModelDF_VLN6) <- c('DPM_VLN6','RPM_VLN6','BIO_VLN6', 'HUM_VLN6', 'IOM_VLN6')
ModelDFS_VLN6 <- ModelDF_VLN6[1:SimulationLength_months, ]

#Create a column with the number of month of analysis
ModelDFS_VLN6$MNumber <- seq(from = 1, to = SimulationLength_months)

#Create a column that sums all pools
ModelDFS_VLN6$AllPools_VLN6 <- ModelDFS_VLN6$DPM_VLN6 + ModelDFS_VLN6$RPM_VLN6 + ModelDFS_VLN6$BIO_VLN6 + ModelDFS_VLN6$HUM_VLN6 + ModelDFS_VLN6$IOM_VLN6

#Create a column that sums all pools except IOM (static)
ModelDFS_VLN6$AllPools_noIOM_VLN6 <- ModelDFS_VLN6$DPM_VLN6 + ModelDFS_VLN6$RPM_VLN6 + ModelDFS_VLN6$BIO_VLN6 + ModelDFS_VLN6$HUM_VLN6

#Create a column that add the monthly input of C (manure and litter separately)
ModelDFSL_VLN6 <- merge(ModelDFS_VLN6, MCinputs_VLN6, by = "MNumber")

ModelDFSL_VLN6$MInput_VLN6 <- ModelDFSL_VLN6$LitterC_VLN6 + ModelDFSL_VLN6$ManureC_VLN6
#ModelDF_SL$MInput[1] <- 0

#Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
ModelDFSL_VLN6$CTails_VLN6 <- ModelDFSL_VLN6$AllPools_noIOM_VLN6 + ModelDFSL_VLN6$MInput_VLN6

#Create Monthly Accumulated input of C
ModelDFSL_VLN6$AccumInput_VLN6 = ModelDFSL_VLN6$AccumInput_VLN6=cumsum(ModelDFSL_VLN6$MInput_VLN6)

#Create Monthly Growths for each carbon pool
ModelDFSL_VLN6$MGrowth_DPM_VLN6 <- ave(ModelDFSL_VLN6$DPM_VLN6, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLN6$MGrowth_RPM_VLN6 <- ave(ModelDFSL_VLN6$RPM_VLN6, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLN6$MGrowth_BIO_VLN6 <- ave(ModelDFSL_VLN6$BIO_VLN6, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLN6$MGrowth_HUM_VLN6 <- ave(ModelDFSL_VLN6$HUM_VLN6, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLN6$MGrowth_IOM_VLN6 <- ave(ModelDFSL_VLN6$IOM_VLN6, FUN = function(x) c(0, diff(x)))

#Create column for Monthly and Accumulated C-CO2 emissions
ModelDFSL_VLN6$M_CCO2_VLN6 <- ModelDFSL_VLN6$MInput_VLN6 - ModelDFSL_VLN6$MGrowth_DPM_VLN6 - ModelDFSL_VLN6$MGrowth_RPM_VLN6 - ModelDFSL_VLN6$MGrowth_BIO_VLN6 - ModelDFSL_VLN6$MGrowth_HUM_VLN6
ModelDFSL_VLN6$Accum_CCO2_VLN6 <- ModelDFSL_VLN6$AccumInput_VLN6 - ModelDFSL_VLN6$AllPools_noIOM_VLN6

#Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
ModelDFSL_VLN6$M_CCO2_VLN6[1] <- 0
ModelDFSL_VLN6$Accum_CCO2_VLN6[1] <- 0

#Balance validation
ModelDFSL_VLN6$Balance_VLN6 <- ModelDFSL_VLN6$AccumInput_VLN6 - ModelDFSL_VLN6$Accum_CCO2_VLN6 - (ModelDFSL_VLN6$DPM_VLN6 + ModelDFSL_VLN6$RPM_VLN6 + ModelDFSL_VLN6$BIO_VLN6 + ModelDFSL_VLN6$HUM_VLN6)

#Convert C-CO2 emissions into CO2 emissions
ModelDFSL_VLN6$M_CO2_VLN6 <- ModelDFSL_VLN6$M_CCO2_VLN6 * 44/12
ModelDFSL_VLN6$Accum_CO2_VLN6 <- ModelDFSL_VLN6$Accum_CCO2_VLN6 * 44/12

#This model will be called VLN6C because implies a continuous input of C
ModelDFSL_VLN6C <- ModelDFSL_VLN6

#Export the dataframe
write_xlsx(ModelDFSL_VLN6C,"VXC_Models\\ModelDFSL_R_VLN6C.xlsx")

#Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
#Create two equal models by using the above general script
#Create model t=x
ModelDFSLt0_VLN6 <- ModelDFSL_VLN6 #Create model t=x

#Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
ModelDFSLt1_VLN6.1 <- rbind(c(0:0), ModelDFSLt0_VLN6)
ModelDFSLt1_VLN6.2 <- rbind(c(0:0), ModelDFSLt1_VLN6.1)
ModelDFSLt1_VLN6.3 <- rbind(c(0:0), ModelDFSLt1_VLN6.2)
ModelDFSLt1_VLN6.4 <- rbind(c(0:0), ModelDFSLt1_VLN6.3)
ModelDFSLt1_VLN6.5 <- rbind(c(0:0), ModelDFSLt1_VLN6.4)
ModelDFSLt1_VLN6.6 <- rbind(c(0:0), ModelDFSLt1_VLN6.5)
ModelDFSLt1_VLN6.7 <- rbind(c(0:0), ModelDFSLt1_VLN6.6)
ModelDFSLt1_VLN6.8 <- rbind(c(0:0), ModelDFSLt1_VLN6.7)
ModelDFSLt1_VLN6.9 <- rbind(c(0:0), ModelDFSLt1_VLN6.8)
ModelDFSLt1_VLN6.10 <- rbind(c(0:0), ModelDFSLt1_VLN6.9)
ModelDFSLt1_VLN6.11 <- rbind(c(0:0), ModelDFSLt1_VLN6.10)
ModelDFSLt1_VLN6.12 <- rbind(c(0:0), ModelDFSLt1_VLN6.11)
ModelDFSLt1_VLN6.13 <- ModelDFSLt1_VLN6.12[-nrow(ModelDFSLt1_VLN6.12),]
ModelDFSLt1_VLN6.14 <- ModelDFSLt1_VLN6.13[-nrow(ModelDFSLt1_VLN6.13),]
ModelDFSLt1_VLN6.15 <- ModelDFSLt1_VLN6.14[-nrow(ModelDFSLt1_VLN6.14),]
ModelDFSLt1_VLN6.16 <- ModelDFSLt1_VLN6.15[-nrow(ModelDFSLt1_VLN6.15),]
ModelDFSLt1_VLN6.17 <- ModelDFSLt1_VLN6.16[-nrow(ModelDFSLt1_VLN6.16),]
ModelDFSLt1_VLN6.18 <- ModelDFSLt1_VLN6.17[-nrow(ModelDFSLt1_VLN6.17),]
ModelDFSLt1_VLN6.19 <- ModelDFSLt1_VLN6.18[-nrow(ModelDFSLt1_VLN6.18),]
ModelDFSLt1_VLN6.20 <- ModelDFSLt1_VLN6.19[-nrow(ModelDFSLt1_VLN6.19),]
ModelDFSLt1_VLN6.21 <- ModelDFSLt1_VLN6.20[-nrow(ModelDFSLt1_VLN6.20),]
ModelDFSLt1_VLN6.22 <- ModelDFSLt1_VLN6.21[-nrow(ModelDFSLt1_VLN6.21),]
ModelDFSLt1_VLN6.23 <- ModelDFSLt1_VLN6.22[-nrow(ModelDFSLt1_VLN6.22),]
ModelDFSLt1_VLN6.24 <- ModelDFSLt1_VLN6.23[-nrow(ModelDFSLt1_VLN6.23),]

ModelDFSLt1_VLN6 <- ModelDFSLt1_VLN6.24 #Create model t=x+1

#Subtract model (t=x) - (t=x+1)
ModelDFSL1y_VLN6 <- ModelDFSLt0_VLN6 - ModelDFSLt1_VLN6

#Re-do Month Number column because the substraction was also applied to it
ModelDFSL1y_VLN6$MNumber <- seq(from = 1, to = SimulationLength_months)

#This model will be called VLN6P because implies a one-off input of C
ModelDFSL_VLN6P <- ModelDFSL1y_VLN6

#Export the dataframe
write_xlsx(ModelDFSL_VLN6P,"VXP_Models\\ModelDFSL_R_VLN6P.xlsx")

#Plot 3: Interactive Yearly CO2 emissions #
MY <- 12
ModelDFSL_VLN6P_YCO2 <- ModelDFSL_VLN6P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VLN6)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLN6P_YCO2) <- c("Year", "Months", "AnnualCO2_VLN_6")


#Plot 3: Interactive Yearly CO2 emissions considering a delay
GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
ModelDFSL_VLN6P_YCO2D <- merge(ModelDFSL_VLN6P_YCO2, GWP100delay, by = "Year")
ModelDFSL_VLN6P_YCO2D$AnnualCO2D_VLN_6 <- ModelDFSL_VLN6P_YCO2D$AnnualCO2_VLN_6 * ModelDFSL_VLN6P_YCO2D$GWP100

#Plot 4: Interactive Yearly C emissions #
MY <- 12
ModelDFSL_VLN6P_YC <- ModelDFSL_VLN6P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VLN6)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLN6P_YC) <- c("Year", "Months", "CEmissions_VLN_6")


#Plot 5: Interactive Yearly C tails (remaining C in Soil) #
MY <- 12
ModelDFSL_VLN6P_YCT <- ModelDFSL_VLN6P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VLN6)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLN6P_YCT) <- c("Year", "Months", "CTail_VLN_6")

#Save Dataframes for Plots 3.1, 3.2, 4 and 5
write_xlsx(ModelDFSL_VLN6P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VLN6P.xlsx") #Yearly CO2 emissions (no delay)
write_xlsx(ModelDFSL_VLN6P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VLN6P.xlsx") #Yearly CO2 emissions (delay)
write_xlsx(ModelDFSL_VLN6P_YC,"CEmissions_P\\ModelDFSL_R_CE_VLN6P.xlsx") #Yearly C emissions
write_xlsx(ModelDFSL_VLN6P_YCT,"CTails_P\\ModelDFSL_R_CT_VLN6P.xlsx") #Yearly C emissions



#### 9.8 - VLN7) Litter; 70%clay; No Tillage ####
#The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
fT_VLN7=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
fW_VLN7=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                        S.Thick = soil.thick, pClay = clay100*0.7,
                        pE = 1.0, bare = FALSE)$b #Moisture effects per month
xi.frame_VLN7=data.frame(years,rep(fT_VLN7*fW_VLN7,length.out=length(years)))

#To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
Model_VLN7=SoilR::RothCModel(
  t=years, #Simulation Length
  ks=c(k.DPM = 10*NTRM, k.RPM = 0.3*NTRM, k.BIO = 0.66*NTRM, k.HUM = 0.02*NTRM, k.IOM = 0*NTRM), #Decomposition rates for the different pools
  C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
  In=Scalar_LitterCinputs*1, #Amount of litter inputs by time
  FYM = Scalar_ManureCinputs*0, #Amount of Farm Yard Manure by time
  clay=clay100*0.7, #Percent clay in mineral soil
  xi=xi.frame_VLN7) #Loads the model

Ct_VLN7=getC(Model_VLN7) #Calculates stocks for each pool per month

#The results can be plotted with the commands
matplot(years, Ct_VLN7, type="l", lty=1, col=1:5,
        xlab="Time (years)", ylab="C stocks (Mg/ha)")
legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
       lty=1, col=1:5, bty="n")

VEC_Lit_VLN7 <- rep(M_Scalar_LitterCinputs*1, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
VEC_Man_VLN7 <- rep(M_Scalar_ManureCinputs*0, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

VEC_LitDF_VLN7 <- as.data.frame(VEC_Lit_VLN7) #Converting the Litter vector to a data frame
VEC_LitDF_VLN7$MNumber <- seq(from = 1, to = SimulationLength_months)
VEC_ManDF_VLN7 <- as.data.frame(VEC_Man_VLN7) #Converting the Manure vector to a data frame
VEC_ManDF_VLN7$MNumber <- seq(from = 1, to = SimulationLength_months)

sapply(VEC_LitDF_VLN7, class) #Check that class is numeric
sapply(VEC_ManDF_VLN7, class) #Check that class is numeric
LitterCinputs_VLN7=VEC_LitDF_VLN7   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
ManureCinputs_VLN7=VEC_ManDF_VLN7 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
MCinputs_VLN7 <- merge(LitterCinputs_VLN7, ManureCinputs_VLN7, by = "MNumber")
MCinputs_VLN7$MInput_VLN7 <- MCinputs_VLN7$VEC_Lit_VLN7 + MCinputs_VLN7$VEC_Man_VLN7

#Change names of litter and manure columns for more common ones
colnames(MCinputs_VLN7)[which(names(MCinputs_VLN7) == "VEC_Lit_VLN7")] <- "LitterC_VLN7"
colnames(MCinputs_VLN7)[which(names(MCinputs_VLN7) == "VEC_Man_VLN7")] <- "ManureC_VLN7"

#Create a dataframe with the data considering the simulation length
ModelDF_VLN7 <- as.data.frame(Ct_VLN7)
colnames(ModelDF_VLN7) <- c('DPM_VLN7','RPM_VLN7','BIO_VLN7', 'HUM_VLN7', 'IOM_VLN7')
ModelDFS_VLN7 <- ModelDF_VLN7[1:SimulationLength_months, ]

#Create a column with the number of month of analysis
ModelDFS_VLN7$MNumber <- seq(from = 1, to = SimulationLength_months)

#Create a column that sums all pools
ModelDFS_VLN7$AllPools_VLN7 <- ModelDFS_VLN7$DPM_VLN7 + ModelDFS_VLN7$RPM_VLN7 + ModelDFS_VLN7$BIO_VLN7 + ModelDFS_VLN7$HUM_VLN7 + ModelDFS_VLN7$IOM_VLN7

#Create a column that sums all pools except IOM (static)
ModelDFS_VLN7$AllPools_noIOM_VLN7 <- ModelDFS_VLN7$DPM_VLN7 + ModelDFS_VLN7$RPM_VLN7 + ModelDFS_VLN7$BIO_VLN7 + ModelDFS_VLN7$HUM_VLN7

#Create a column that add the monthly input of C (manure and litter separately)
ModelDFSL_VLN7 <- merge(ModelDFS_VLN7, MCinputs_VLN7, by = "MNumber")

ModelDFSL_VLN7$MInput_VLN7 <- ModelDFSL_VLN7$LitterC_VLN7 + ModelDFSL_VLN7$ManureC_VLN7
#ModelDF_SL$MInput[1] <- 0

#Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
ModelDFSL_VLN7$CTails_VLN7 <- ModelDFSL_VLN7$AllPools_noIOM_VLN7 + ModelDFSL_VLN7$MInput_VLN7

#Create Monthly Accumulated input of C
ModelDFSL_VLN7$AccumInput_VLN7 = ModelDFSL_VLN7$AccumInput_VLN7=cumsum(ModelDFSL_VLN7$MInput_VLN7)

#Create Monthly Growths for each carbon pool
ModelDFSL_VLN7$MGrowth_DPM_VLN7 <- ave(ModelDFSL_VLN7$DPM_VLN7, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLN7$MGrowth_RPM_VLN7 <- ave(ModelDFSL_VLN7$RPM_VLN7, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLN7$MGrowth_BIO_VLN7 <- ave(ModelDFSL_VLN7$BIO_VLN7, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLN7$MGrowth_HUM_VLN7 <- ave(ModelDFSL_VLN7$HUM_VLN7, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLN7$MGrowth_IOM_VLN7 <- ave(ModelDFSL_VLN7$IOM_VLN7, FUN = function(x) c(0, diff(x)))

#Create column for Monthly and Accumulated C-CO2 emissions
ModelDFSL_VLN7$M_CCO2_VLN7 <- ModelDFSL_VLN7$MInput_VLN7 - ModelDFSL_VLN7$MGrowth_DPM_VLN7 - ModelDFSL_VLN7$MGrowth_RPM_VLN7 - ModelDFSL_VLN7$MGrowth_BIO_VLN7 - ModelDFSL_VLN7$MGrowth_HUM_VLN7
ModelDFSL_VLN7$Accum_CCO2_VLN7 <- ModelDFSL_VLN7$AccumInput_VLN7 - ModelDFSL_VLN7$AllPools_noIOM_VLN7

#Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
ModelDFSL_VLN7$M_CCO2_VLN7[1] <- 0
ModelDFSL_VLN7$Accum_CCO2_VLN7[1] <- 0

#Balance validation
ModelDFSL_VLN7$Balance_VLN7 <- ModelDFSL_VLN7$AccumInput_VLN7 - ModelDFSL_VLN7$Accum_CCO2_VLN7 - (ModelDFSL_VLN7$DPM_VLN7 + ModelDFSL_VLN7$RPM_VLN7 + ModelDFSL_VLN7$BIO_VLN7 + ModelDFSL_VLN7$HUM_VLN7)

#Convert C-CO2 emissions into CO2 emissions
ModelDFSL_VLN7$M_CO2_VLN7 <- ModelDFSL_VLN7$M_CCO2_VLN7 * 44/12
ModelDFSL_VLN7$Accum_CO2_VLN7 <- ModelDFSL_VLN7$Accum_CCO2_VLN7 * 44/12

#This model will be called VLN7C because implies a continuous input of C
ModelDFSL_VLN7C <- ModelDFSL_VLN7

#Export the dataframe
write_xlsx(ModelDFSL_VLN7C,"VXC_Models\\ModelDFSL_R_VLN7C.xlsx")

#Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
#Create two equal models by using the above general script
#Create model t=x
ModelDFSLt0_VLN7 <- ModelDFSL_VLN7 #Create model t=x

#Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
ModelDFSLt1_VLN7.1 <- rbind(c(0:0), ModelDFSLt0_VLN7)
ModelDFSLt1_VLN7.2 <- rbind(c(0:0), ModelDFSLt1_VLN7.1)
ModelDFSLt1_VLN7.3 <- rbind(c(0:0), ModelDFSLt1_VLN7.2)
ModelDFSLt1_VLN7.4 <- rbind(c(0:0), ModelDFSLt1_VLN7.3)
ModelDFSLt1_VLN7.5 <- rbind(c(0:0), ModelDFSLt1_VLN7.4)
ModelDFSLt1_VLN7.6 <- rbind(c(0:0), ModelDFSLt1_VLN7.5)
ModelDFSLt1_VLN7.7 <- rbind(c(0:0), ModelDFSLt1_VLN7.6)
ModelDFSLt1_VLN7.8 <- rbind(c(0:0), ModelDFSLt1_VLN7.7)
ModelDFSLt1_VLN7.9 <- rbind(c(0:0), ModelDFSLt1_VLN7.8)
ModelDFSLt1_VLN7.10 <- rbind(c(0:0), ModelDFSLt1_VLN7.9)
ModelDFSLt1_VLN7.11 <- rbind(c(0:0), ModelDFSLt1_VLN7.10)
ModelDFSLt1_VLN7.12 <- rbind(c(0:0), ModelDFSLt1_VLN7.11)
ModelDFSLt1_VLN7.13 <- ModelDFSLt1_VLN7.12[-nrow(ModelDFSLt1_VLN7.12),]
ModelDFSLt1_VLN7.14 <- ModelDFSLt1_VLN7.13[-nrow(ModelDFSLt1_VLN7.13),]
ModelDFSLt1_VLN7.15 <- ModelDFSLt1_VLN7.14[-nrow(ModelDFSLt1_VLN7.14),]
ModelDFSLt1_VLN7.16 <- ModelDFSLt1_VLN7.15[-nrow(ModelDFSLt1_VLN7.15),]
ModelDFSLt1_VLN7.17 <- ModelDFSLt1_VLN7.16[-nrow(ModelDFSLt1_VLN7.16),]
ModelDFSLt1_VLN7.18 <- ModelDFSLt1_VLN7.17[-nrow(ModelDFSLt1_VLN7.17),]
ModelDFSLt1_VLN7.19 <- ModelDFSLt1_VLN7.18[-nrow(ModelDFSLt1_VLN7.18),]
ModelDFSLt1_VLN7.20 <- ModelDFSLt1_VLN7.19[-nrow(ModelDFSLt1_VLN7.19),]
ModelDFSLt1_VLN7.21 <- ModelDFSLt1_VLN7.20[-nrow(ModelDFSLt1_VLN7.20),]
ModelDFSLt1_VLN7.22 <- ModelDFSLt1_VLN7.21[-nrow(ModelDFSLt1_VLN7.21),]
ModelDFSLt1_VLN7.23 <- ModelDFSLt1_VLN7.22[-nrow(ModelDFSLt1_VLN7.22),]
ModelDFSLt1_VLN7.24 <- ModelDFSLt1_VLN7.23[-nrow(ModelDFSLt1_VLN7.23),]

ModelDFSLt1_VLN7 <- ModelDFSLt1_VLN7.24 #Create model t=x+1

#Subtract model (t=x) - (t=x+1)
ModelDFSL1y_VLN7 <- ModelDFSLt0_VLN7 - ModelDFSLt1_VLN7

#Re-do Month Number column because the substraction was also applied to it
ModelDFSL1y_VLN7$MNumber <- seq(from = 1, to = SimulationLength_months)

#This model will be called VLN7P because implies a one-off input of C
ModelDFSL_VLN7P <- ModelDFSL1y_VLN7

#Export the dataframe
write_xlsx(ModelDFSL_VLN7P,"VXP_Models\\ModelDFSL_R_VLN7P.xlsx")

#Plot 3: Interactive Yearly CO2 emissions #
MY <- 12
ModelDFSL_VLN7P_YCO2 <- ModelDFSL_VLN7P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VLN7)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLN7P_YCO2) <- c("Year", "Months", "AnnualCO2_VLN_7")


#Plot 3: Interactive Yearly CO2 emissions considering a delay
GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
ModelDFSL_VLN7P_YCO2D <- merge(ModelDFSL_VLN7P_YCO2, GWP100delay, by = "Year")
ModelDFSL_VLN7P_YCO2D$AnnualCO2D_VLN_7 <- ModelDFSL_VLN7P_YCO2D$AnnualCO2_VLN_7 * ModelDFSL_VLN7P_YCO2D$GWP100

#Plot 4: Interactive Yearly C emissions #
MY <- 12
ModelDFSL_VLN7P_YC <- ModelDFSL_VLN7P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VLN7)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLN7P_YC) <- c("Year", "Months", "CEmissions_VLN_7")


#Plot 5: Interactive Yearly C tails (remaining C in Soil) #
MY <- 12
ModelDFSL_VLN7P_YCT <- ModelDFSL_VLN7P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VLN7)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLN7P_YCT) <- c("Year", "Months", "CTail_VLN_7")


#Save Dataframes for Plots 3.1, 3.2, 4 and 5
write_xlsx(ModelDFSL_VLN7P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VLN7P.xlsx") #Yearly CO2 emissions (no delay)
write_xlsx(ModelDFSL_VLN7P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VLN7P.xlsx") #Yearly CO2 emissions (delay)
write_xlsx(ModelDFSL_VLN7P_YC,"CEmissions_P\\ModelDFSL_R_CE_VLN7P.xlsx") #Yearly C emissions
write_xlsx(ModelDFSL_VLN7P_YCT,"CTails_P\\ModelDFSL_R_CT_VLN7P.xlsx") #Yearly C emissions



#### 9.9 - VLN8) Litter; 80%clay; No Tillage ####
#The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
fT_VLN8=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
fW_VLN8=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                        S.Thick = soil.thick, pClay = clay100*0.8,
                        pE = 1.0, bare = FALSE)$b #Moisture effects per month
xi.frame_VLN8=data.frame(years,rep(fT_VLN8*fW_VLN8,length.out=length(years)))

#To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
Model_VLN8=SoilR::RothCModel(
  t=years, #Simulation Length
  ks=c(k.DPM = 10*NTRM, k.RPM = 0.3*NTRM, k.BIO = 0.66*NTRM, k.HUM = 0.02*NTRM, k.IOM = 0*NTRM), #Decomposition rates for the different pools
  C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
  In=Scalar_LitterCinputs*1, #Amount of litter inputs by time
  FYM = Scalar_ManureCinputs*0, #Amount of Farm Yard Manure by time
  clay=clay100*0.8, #Percent clay in mineral soil
  xi=xi.frame_VLN8) #Loads the model

Ct_VLN8=getC(Model_VLN8) #Calculates stocks for each pool per month

#The results can be plotted with the commands
matplot(years, Ct_VLN8, type="l", lty=1, col=1:5,
        xlab="Time (years)", ylab="C stocks (Mg/ha)")
legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
       lty=1, col=1:5, bty="n")

VEC_Lit_VLN8 <- rep(M_Scalar_LitterCinputs*1, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
VEC_Man_VLN8 <- rep(M_Scalar_ManureCinputs*0, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

VEC_LitDF_VLN8 <- as.data.frame(VEC_Lit_VLN8) #Converting the Litter vector to a data frame
VEC_LitDF_VLN8$MNumber <- seq(from = 1, to = SimulationLength_months)
VEC_ManDF_VLN8 <- as.data.frame(VEC_Man_VLN8) #Converting the Manure vector to a data frame
VEC_ManDF_VLN8$MNumber <- seq(from = 1, to = SimulationLength_months)

sapply(VEC_LitDF_VLN8, class) #Check that class is numeric
sapply(VEC_ManDF_VLN8, class) #Check that class is numeric
LitterCinputs_VLN8=VEC_LitDF_VLN8   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
ManureCinputs_VLN8=VEC_ManDF_VLN8 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
MCinputs_VLN8 <- merge(LitterCinputs_VLN8, ManureCinputs_VLN8, by = "MNumber")
MCinputs_VLN8$MInput_VLN8 <- MCinputs_VLN8$VEC_Lit_VLN8 + MCinputs_VLN8$VEC_Man_VLN8

#Change names of litter and manure columns for more common ones
colnames(MCinputs_VLN8)[which(names(MCinputs_VLN8) == "VEC_Lit_VLN8")] <- "LitterC_VLN8"
colnames(MCinputs_VLN8)[which(names(MCinputs_VLN8) == "VEC_Man_VLN8")] <- "ManureC_VLN8"

#Create a dataframe with the data considering the simulation length
ModelDF_VLN8 <- as.data.frame(Ct_VLN8)
colnames(ModelDF_VLN8) <- c('DPM_VLN8','RPM_VLN8','BIO_VLN8', 'HUM_VLN8', 'IOM_VLN8')
ModelDFS_VLN8 <- ModelDF_VLN8[1:SimulationLength_months, ]

#Create a column with the number of month of analysis
ModelDFS_VLN8$MNumber <- seq(from = 1, to = SimulationLength_months)

#Create a column that sums all pools
ModelDFS_VLN8$AllPools_VLN8 <- ModelDFS_VLN8$DPM_VLN8 + ModelDFS_VLN8$RPM_VLN8 + ModelDFS_VLN8$BIO_VLN8 + ModelDFS_VLN8$HUM_VLN8 + ModelDFS_VLN8$IOM_VLN8

#Create a column that sums all pools except IOM (static)
ModelDFS_VLN8$AllPools_noIOM_VLN8 <- ModelDFS_VLN8$DPM_VLN8 + ModelDFS_VLN8$RPM_VLN8 + ModelDFS_VLN8$BIO_VLN8 + ModelDFS_VLN8$HUM_VLN8

#Create a column that add the monthly input of C (manure and litter separately)
ModelDFSL_VLN8 <- merge(ModelDFS_VLN8, MCinputs_VLN8, by = "MNumber")

ModelDFSL_VLN8$MInput_VLN8 <- ModelDFSL_VLN8$LitterC_VLN8 + ModelDFSL_VLN8$ManureC_VLN8
#ModelDF_SL$MInput[1] <- 0

#Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
ModelDFSL_VLN8$CTails_VLN8 <- ModelDFSL_VLN8$AllPools_noIOM_VLN8 + ModelDFSL_VLN8$MInput_VLN8

#Create Monthly Accumulated input of C
ModelDFSL_VLN8$AccumInput_VLN8 = ModelDFSL_VLN8$AccumInput_VLN8=cumsum(ModelDFSL_VLN8$MInput_VLN8)

#Create Monthly Growths for each carbon pool
ModelDFSL_VLN8$MGrowth_DPM_VLN8 <- ave(ModelDFSL_VLN8$DPM_VLN8, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLN8$MGrowth_RPM_VLN8 <- ave(ModelDFSL_VLN8$RPM_VLN8, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLN8$MGrowth_BIO_VLN8 <- ave(ModelDFSL_VLN8$BIO_VLN8, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLN8$MGrowth_HUM_VLN8 <- ave(ModelDFSL_VLN8$HUM_VLN8, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLN8$MGrowth_IOM_VLN8 <- ave(ModelDFSL_VLN8$IOM_VLN8, FUN = function(x) c(0, diff(x)))

#Create column for Monthly and Accumulated C-CO2 emissions
ModelDFSL_VLN8$M_CCO2_VLN8 <- ModelDFSL_VLN8$MInput_VLN8 - ModelDFSL_VLN8$MGrowth_DPM_VLN8 - ModelDFSL_VLN8$MGrowth_RPM_VLN8 - ModelDFSL_VLN8$MGrowth_BIO_VLN8 - ModelDFSL_VLN8$MGrowth_HUM_VLN8
ModelDFSL_VLN8$Accum_CCO2_VLN8 <- ModelDFSL_VLN8$AccumInput_VLN8 - ModelDFSL_VLN8$AllPools_noIOM_VLN8

#Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
ModelDFSL_VLN8$M_CCO2_VLN8[1] <- 0
ModelDFSL_VLN8$Accum_CCO2_VLN8[1] <- 0

#Balance validation
ModelDFSL_VLN8$Balance_VLN8 <- ModelDFSL_VLN8$AccumInput_VLN8 - ModelDFSL_VLN8$Accum_CCO2_VLN8 - (ModelDFSL_VLN8$DPM_VLN8 + ModelDFSL_VLN8$RPM_VLN8 + ModelDFSL_VLN8$BIO_VLN8 + ModelDFSL_VLN8$HUM_VLN8)

#Convert C-CO2 emissions into CO2 emissions
ModelDFSL_VLN8$M_CO2_VLN8 <- ModelDFSL_VLN8$M_CCO2_VLN8 * 44/12
ModelDFSL_VLN8$Accum_CO2_VLN8 <- ModelDFSL_VLN8$Accum_CCO2_VLN8 * 44/12

#This model will be called VLN8C because implies a continuous input of C
ModelDFSL_VLN8C <- ModelDFSL_VLN8

#Export the dataframe
write_xlsx(ModelDFSL_VLN8C,"VXC_Models\\ModelDFSL_R_VLN8C.xlsx")

#Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
#Create two equal models by using the above general script
#Create model t=x
ModelDFSLt0_VLN8 <- ModelDFSL_VLN8 #Create model t=x

#Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
ModelDFSLt1_VLN8.1 <- rbind(c(0:0), ModelDFSLt0_VLN8)
ModelDFSLt1_VLN8.2 <- rbind(c(0:0), ModelDFSLt1_VLN8.1)
ModelDFSLt1_VLN8.3 <- rbind(c(0:0), ModelDFSLt1_VLN8.2)
ModelDFSLt1_VLN8.4 <- rbind(c(0:0), ModelDFSLt1_VLN8.3)
ModelDFSLt1_VLN8.5 <- rbind(c(0:0), ModelDFSLt1_VLN8.4)
ModelDFSLt1_VLN8.6 <- rbind(c(0:0), ModelDFSLt1_VLN8.5)
ModelDFSLt1_VLN8.7 <- rbind(c(0:0), ModelDFSLt1_VLN8.6)
ModelDFSLt1_VLN8.8 <- rbind(c(0:0), ModelDFSLt1_VLN8.7)
ModelDFSLt1_VLN8.9 <- rbind(c(0:0), ModelDFSLt1_VLN8.8)
ModelDFSLt1_VLN8.10 <- rbind(c(0:0), ModelDFSLt1_VLN8.9)
ModelDFSLt1_VLN8.11 <- rbind(c(0:0), ModelDFSLt1_VLN8.10)
ModelDFSLt1_VLN8.12 <- rbind(c(0:0), ModelDFSLt1_VLN8.11)
ModelDFSLt1_VLN8.13 <- ModelDFSLt1_VLN8.12[-nrow(ModelDFSLt1_VLN8.12),]
ModelDFSLt1_VLN8.14 <- ModelDFSLt1_VLN8.13[-nrow(ModelDFSLt1_VLN8.13),]
ModelDFSLt1_VLN8.15 <- ModelDFSLt1_VLN8.14[-nrow(ModelDFSLt1_VLN8.14),]
ModelDFSLt1_VLN8.16 <- ModelDFSLt1_VLN8.15[-nrow(ModelDFSLt1_VLN8.15),]
ModelDFSLt1_VLN8.17 <- ModelDFSLt1_VLN8.16[-nrow(ModelDFSLt1_VLN8.16),]
ModelDFSLt1_VLN8.18 <- ModelDFSLt1_VLN8.17[-nrow(ModelDFSLt1_VLN8.17),]
ModelDFSLt1_VLN8.19 <- ModelDFSLt1_VLN8.18[-nrow(ModelDFSLt1_VLN8.18),]
ModelDFSLt1_VLN8.20 <- ModelDFSLt1_VLN8.19[-nrow(ModelDFSLt1_VLN8.19),]
ModelDFSLt1_VLN8.21 <- ModelDFSLt1_VLN8.20[-nrow(ModelDFSLt1_VLN8.20),]
ModelDFSLt1_VLN8.22 <- ModelDFSLt1_VLN8.21[-nrow(ModelDFSLt1_VLN8.21),]
ModelDFSLt1_VLN8.23 <- ModelDFSLt1_VLN8.22[-nrow(ModelDFSLt1_VLN8.22),]
ModelDFSLt1_VLN8.24 <- ModelDFSLt1_VLN8.23[-nrow(ModelDFSLt1_VLN8.23),]

ModelDFSLt1_VLN8 <- ModelDFSLt1_VLN8.24 #Create model t=x+1

#Subtract model (t=x) - (t=x+1)
ModelDFSL1y_VLN8 <- ModelDFSLt0_VLN8 - ModelDFSLt1_VLN8

#Re-do Month Number column because the substraction was also applied to it
ModelDFSL1y_VLN8$MNumber <- seq(from = 1, to = SimulationLength_months)

#This model will be called VLN8P because implies a one-off input of C
ModelDFSL_VLN8P <- ModelDFSL1y_VLN8

#Export the dataframe
write_xlsx(ModelDFSL_VLN8P,"VXP_Models\\ModelDFSL_R_VLN8P.xlsx")


#Plot 3: Interactive Yearly CO2 emissions #
MY <- 12
ModelDFSL_VLN8P_YCO2 <- ModelDFSL_VLN8P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VLN8)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLN8P_YCO2) <- c("Year", "Months", "AnnualCO2_VLN_8")

#Plot 3: Interactive Yearly CO2 emissions considering a delay
GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
ModelDFSL_VLN8P_YCO2D <- merge(ModelDFSL_VLN8P_YCO2, GWP100delay, by = "Year")
ModelDFSL_VLN8P_YCO2D$AnnualCO2D_VLN_8 <- ModelDFSL_VLN8P_YCO2D$AnnualCO2_VLN_8 * ModelDFSL_VLN8P_YCO2D$GWP100


#Plot 4: Interactive Yearly C emissions #
MY <- 12
ModelDFSL_VLN8P_YC <- ModelDFSL_VLN8P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VLN8)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLN8P_YC) <- c("Year", "Months", "CEmissions_VLN_8")

#Plot 5: Interactive Yearly C tails (remaining C in Soil) #
MY <- 12
ModelDFSL_VLN8P_YCT <- ModelDFSL_VLN8P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VLN8)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLN8P_YCT) <- c("Year", "Months", "CTail_VLN_8")

#Save Dataframes for Plots 3.1, 3.2, 4 and 5
write_xlsx(ModelDFSL_VLN8P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VLN8P.xlsx") #Yearly CO2 emissions (no delay)
write_xlsx(ModelDFSL_VLN8P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VLN8P.xlsx") #Yearly CO2 emissions (delay)
write_xlsx(ModelDFSL_VLN8P_YC,"CEmissions_P\\ModelDFSL_R_CE_VLN8P.xlsx") #Yearly C emissions
write_xlsx(ModelDFSL_VLN8P_YCT,"CTails_P\\ModelDFSL_R_CT_VLN8P.xlsx") #Yearly C emissions



#### 9.10 - VLN9) Litter; 90%clay; No Tillage ####
#The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
fT_VLN9=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
fW_VLN9=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                        S.Thick = soil.thick, pClay = clay100*0.9,
                        pE = 1.0, bare = FALSE)$b #Moisture effects per month
xi.frame_VLN9=data.frame(years,rep(fT_VLN9*fW_VLN9,length.out=length(years)))

#To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
Model_VLN9=SoilR::RothCModel(
  t=years, #Simulation Length
  ks=c(k.DPM = 10*NTRM, k.RPM = 0.3*NTRM, k.BIO = 0.66*NTRM, k.HUM = 0.02*NTRM, k.IOM = 0*NTRM), #Decomposition rates for the different pools
  C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
  In=Scalar_LitterCinputs*1, #Amount of litter inputs by time
  FYM = Scalar_ManureCinputs*0, #Amount of Farm Yard Manure by time
  clay=clay100*0.9, #Percent clay in mineral soil
  xi=xi.frame_VLN9) #Loads the model

Ct_VLN9=getC(Model_VLN9) #Calculates stocks for each pool per month

#The results can be plotted with the commands
matplot(years, Ct_VLN9, type="l", lty=1, col=1:5,
        xlab="Time (years)", ylab="C stocks (Mg/ha)")
legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
       lty=1, col=1:5, bty="n")

VEC_Lit_VLN9 <- rep(M_Scalar_LitterCinputs*1, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
VEC_Man_VLN9 <- rep(M_Scalar_ManureCinputs*0, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

VEC_LitDF_VLN9 <- as.data.frame(VEC_Lit_VLN9) #Converting the Litter vector to a data frame
VEC_LitDF_VLN9$MNumber <- seq(from = 1, to = SimulationLength_months)
VEC_ManDF_VLN9 <- as.data.frame(VEC_Man_VLN9) #Converting the Manure vector to a data frame
VEC_ManDF_VLN9$MNumber <- seq(from = 1, to = SimulationLength_months)

sapply(VEC_LitDF_VLN9, class) #Check that class is numeric
sapply(VEC_ManDF_VLN9, class) #Check that class is numeric
LitterCinputs_VLN9=VEC_LitDF_VLN9   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
ManureCinputs_VLN9=VEC_ManDF_VLN9 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
MCinputs_VLN9 <- merge(LitterCinputs_VLN9, ManureCinputs_VLN9, by = "MNumber")
MCinputs_VLN9$MInput_VLN9 <- MCinputs_VLN9$VEC_Lit_VLN9 + MCinputs_VLN9$VEC_Man_VLN9

#Change names of litter and manure columns for more common ones
colnames(MCinputs_VLN9)[which(names(MCinputs_VLN9) == "VEC_Lit_VLN9")] <- "LitterC_VLN9"
colnames(MCinputs_VLN9)[which(names(MCinputs_VLN9) == "VEC_Man_VLN9")] <- "ManureC_VLN9"

#Create a dataframe with the data considering the simulation length
ModelDF_VLN9 <- as.data.frame(Ct_VLN9)
colnames(ModelDF_VLN9) <- c('DPM_VLN9','RPM_VLN9','BIO_VLN9', 'HUM_VLN9', 'IOM_VLN9')
ModelDFS_VLN9 <- ModelDF_VLN9[1:SimulationLength_months, ]

#Create a column with the number of month of analysis
ModelDFS_VLN9$MNumber <- seq(from = 1, to = SimulationLength_months)

#Create a column that sums all pools
ModelDFS_VLN9$AllPools_VLN9 <- ModelDFS_VLN9$DPM_VLN9 + ModelDFS_VLN9$RPM_VLN9 + ModelDFS_VLN9$BIO_VLN9 + ModelDFS_VLN9$HUM_VLN9 + ModelDFS_VLN9$IOM_VLN9

#Create a column that sums all pools except IOM (static)
ModelDFS_VLN9$AllPools_noIOM_VLN9 <- ModelDFS_VLN9$DPM_VLN9 + ModelDFS_VLN9$RPM_VLN9 + ModelDFS_VLN9$BIO_VLN9 + ModelDFS_VLN9$HUM_VLN9

#Create a column that add the monthly input of C (manure and litter separately)
ModelDFSL_VLN9 <- merge(ModelDFS_VLN9, MCinputs_VLN9, by = "MNumber")

ModelDFSL_VLN9$MInput_VLN9 <- ModelDFSL_VLN9$LitterC_VLN9 + ModelDFSL_VLN9$ManureC_VLN9
#ModelDF_SL$MInput[1] <- 0

#Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
ModelDFSL_VLN9$CTails_VLN9 <- ModelDFSL_VLN9$AllPools_noIOM_VLN9 + ModelDFSL_VLN9$MInput_VLN9

#Create Monthly Accumulated input of C
ModelDFSL_VLN9$AccumInput_VLN9 = ModelDFSL_VLN9$AccumInput_VLN9=cumsum(ModelDFSL_VLN9$MInput_VLN9)

#Create Monthly Growths for each carbon pool
ModelDFSL_VLN9$MGrowth_DPM_VLN9 <- ave(ModelDFSL_VLN9$DPM_VLN9, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLN9$MGrowth_RPM_VLN9 <- ave(ModelDFSL_VLN9$RPM_VLN9, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLN9$MGrowth_BIO_VLN9 <- ave(ModelDFSL_VLN9$BIO_VLN9, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLN9$MGrowth_HUM_VLN9 <- ave(ModelDFSL_VLN9$HUM_VLN9, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLN9$MGrowth_IOM_VLN9 <- ave(ModelDFSL_VLN9$IOM_VLN9, FUN = function(x) c(0, diff(x)))

#Create column for Monthly and Accumulated C-CO2 emissions
ModelDFSL_VLN9$M_CCO2_VLN9 <- ModelDFSL_VLN9$MInput_VLN9 - ModelDFSL_VLN9$MGrowth_DPM_VLN9 - ModelDFSL_VLN9$MGrowth_RPM_VLN9 - ModelDFSL_VLN9$MGrowth_BIO_VLN9 - ModelDFSL_VLN9$MGrowth_HUM_VLN9
ModelDFSL_VLN9$Accum_CCO2_VLN9 <- ModelDFSL_VLN9$AccumInput_VLN9 - ModelDFSL_VLN9$AllPools_noIOM_VLN9

#Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
ModelDFSL_VLN9$M_CCO2_VLN9[1] <- 0
ModelDFSL_VLN9$Accum_CCO2_VLN9[1] <- 0

#Balance validation
ModelDFSL_VLN9$Balance_VLN9 <- ModelDFSL_VLN9$AccumInput_VLN9 - ModelDFSL_VLN9$Accum_CCO2_VLN9 - (ModelDFSL_VLN9$DPM_VLN9 + ModelDFSL_VLN9$RPM_VLN9 + ModelDFSL_VLN9$BIO_VLN9 + ModelDFSL_VLN9$HUM_VLN9)

#Convert C-CO2 emissions into CO2 emissions
ModelDFSL_VLN9$M_CO2_VLN9 <- ModelDFSL_VLN9$M_CCO2_VLN9 * 44/12
ModelDFSL_VLN9$Accum_CO2_VLN9 <- ModelDFSL_VLN9$Accum_CCO2_VLN9 * 44/12

#This model will be called VLN9C because implies a continuous input of C
ModelDFSL_VLN9C <- ModelDFSL_VLN9

#Export the dataframe
write_xlsx(ModelDFSL_VLN9C,"VXC_Models\\ModelDFSL_R_VLN9C.xlsx")

#Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
#Create two equal models by using the above general script
#Create model t=x
ModelDFSLt0_VLN9 <- ModelDFSL_VLN9 #Create model t=x

#Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
ModelDFSLt1_VLN9.1 <- rbind(c(0:0), ModelDFSLt0_VLN9)
ModelDFSLt1_VLN9.2 <- rbind(c(0:0), ModelDFSLt1_VLN9.1)
ModelDFSLt1_VLN9.3 <- rbind(c(0:0), ModelDFSLt1_VLN9.2)
ModelDFSLt1_VLN9.4 <- rbind(c(0:0), ModelDFSLt1_VLN9.3)
ModelDFSLt1_VLN9.5 <- rbind(c(0:0), ModelDFSLt1_VLN9.4)
ModelDFSLt1_VLN9.6 <- rbind(c(0:0), ModelDFSLt1_VLN9.5)
ModelDFSLt1_VLN9.7 <- rbind(c(0:0), ModelDFSLt1_VLN9.6)
ModelDFSLt1_VLN9.8 <- rbind(c(0:0), ModelDFSLt1_VLN9.7)
ModelDFSLt1_VLN9.9 <- rbind(c(0:0), ModelDFSLt1_VLN9.8)
ModelDFSLt1_VLN9.10 <- rbind(c(0:0), ModelDFSLt1_VLN9.9)
ModelDFSLt1_VLN9.11 <- rbind(c(0:0), ModelDFSLt1_VLN9.10)
ModelDFSLt1_VLN9.12 <- rbind(c(0:0), ModelDFSLt1_VLN9.11)
ModelDFSLt1_VLN9.13 <- ModelDFSLt1_VLN9.12[-nrow(ModelDFSLt1_VLN9.12),]
ModelDFSLt1_VLN9.14 <- ModelDFSLt1_VLN9.13[-nrow(ModelDFSLt1_VLN9.13),]
ModelDFSLt1_VLN9.15 <- ModelDFSLt1_VLN9.14[-nrow(ModelDFSLt1_VLN9.14),]
ModelDFSLt1_VLN9.16 <- ModelDFSLt1_VLN9.15[-nrow(ModelDFSLt1_VLN9.15),]
ModelDFSLt1_VLN9.17 <- ModelDFSLt1_VLN9.16[-nrow(ModelDFSLt1_VLN9.16),]
ModelDFSLt1_VLN9.18 <- ModelDFSLt1_VLN9.17[-nrow(ModelDFSLt1_VLN9.17),]
ModelDFSLt1_VLN9.19 <- ModelDFSLt1_VLN9.18[-nrow(ModelDFSLt1_VLN9.18),]
ModelDFSLt1_VLN9.20 <- ModelDFSLt1_VLN9.19[-nrow(ModelDFSLt1_VLN9.19),]
ModelDFSLt1_VLN9.21 <- ModelDFSLt1_VLN9.20[-nrow(ModelDFSLt1_VLN9.20),]
ModelDFSLt1_VLN9.22 <- ModelDFSLt1_VLN9.21[-nrow(ModelDFSLt1_VLN9.21),]
ModelDFSLt1_VLN9.23 <- ModelDFSLt1_VLN9.22[-nrow(ModelDFSLt1_VLN9.22),]
ModelDFSLt1_VLN9.24 <- ModelDFSLt1_VLN9.23[-nrow(ModelDFSLt1_VLN9.23),]

ModelDFSLt1_VLN9 <- ModelDFSLt1_VLN9.24 #Create model t=x+1

#Subtract model (t=x) - (t=x+1)
ModelDFSL1y_VLN9 <- ModelDFSLt0_VLN9 - ModelDFSLt1_VLN9

#Re-do Month Number column because the substraction was also applied to it
ModelDFSL1y_VLN9$MNumber <- seq(from = 1, to = SimulationLength_months)

#This model will be called VLN9P because implies a one-off input of C
ModelDFSL_VLN9P <- ModelDFSL1y_VLN9

#Export the dataframe
write_xlsx(ModelDFSL_VLN9P,"VXP_Models\\ModelDFSL_R_VLN9P.xlsx")


#Plot 3: Interactive Yearly CO2 emissions #
MY <- 12
ModelDFSL_VLN9P_YCO2 <- ModelDFSL_VLN9P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VLN9)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLN9P_YCO2) <- c("Year", "Months", "AnnualCO2_VLN_9")

#Plot 3: Interactive Yearly CO2 emissions considering a delay
GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
ModelDFSL_VLN9P_YCO2D <- merge(ModelDFSL_VLN9P_YCO2, GWP100delay, by = "Year")
ModelDFSL_VLN9P_YCO2D$AnnualCO2D_VLN_9 <- ModelDFSL_VLN9P_YCO2D$AnnualCO2_VLN_9 * ModelDFSL_VLN9P_YCO2D$GWP100


#Plot 4: Interactive Yearly C emissions #
MY <- 12
ModelDFSL_VLN9P_YC <- ModelDFSL_VLN9P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VLN9)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLN9P_YC) <- c("Year", "Months", "CEmissions_VLN_9")

#Plot 5: Interactive Yearly C tails (remaining C in Soil) #
MY <- 12
ModelDFSL_VLN9P_YCT <- ModelDFSL_VLN9P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VLN9)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLN9P_YCT) <- c("Year", "Months", "CTail_VLN_9")

#Save Dataframes for Plots 3.1, 3.2, 4 and 5
write_xlsx(ModelDFSL_VLN9P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VLN9P.xlsx") #Yearly CO2 emissions (no delay)
write_xlsx(ModelDFSL_VLN9P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VLN9P.xlsx") #Yearly CO2 emissions (delay)
write_xlsx(ModelDFSL_VLN9P_YC,"CEmissions_P\\ModelDFSL_R_CE_VLN9P.xlsx") #Yearly C emissions
write_xlsx(ModelDFSL_VLN9P_YCT,"CTails_P\\ModelDFSL_R_CT_VLN9P.xlsx") #Yearly C emissions



#### 9.11 - VLN10) Litter; 100%clay; No Tillage ####
#The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
fT_VLN10=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
fW_VLN10=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                         S.Thick = soil.thick, pClay = clay100,
                         pE = 1.0, bare = FALSE)$b #Moisture effects per month
xi.frame_VLN10=data.frame(years,rep(fT_VLN10*fW_VLN10,length.out=length(years)))

#To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
Model_VLN10=SoilR::RothCModel(
  t=years, #Simulation Length
  ks=c(k.DPM = 10*NTRM, k.RPM = 0.3*NTRM, k.BIO = 0.66*NTRM, k.HUM = 0.02*NTRM, k.IOM = 0*NTRM), #Decomposition rates for the different pools
  C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
  In=Scalar_LitterCinputs*1, #Amount of litter inputs by time
  FYM = Scalar_ManureCinputs*0, #Amount of Farm Yard Manure by time
  clay=clay100, #Percent clay in mineral soil
  xi=xi.frame_VLN10) #Loads the model

Ct_VLN10=getC(Model_VLN10) #Calculates stocks for each pool per month

#The results can be plotted with the commands
matplot(years, Ct_VLN10, type="l", lty=1, col=1:5,
        xlab="Time (years)", ylab="C stocks (Mg/ha)")
legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
       lty=1, col=1:5, bty="n")

VEC_Lit_VLN10 <- rep(M_Scalar_LitterCinputs*1, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
VEC_Man_VLN10 <- rep(M_Scalar_ManureCinputs*0, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

VEC_LitDF_VLN10 <- as.data.frame(VEC_Lit_VLN10) #Converting the Litter vector to a data frame
VEC_LitDF_VLN10$MNumber <- seq(from = 1, to = SimulationLength_months)
VEC_ManDF_VLN10 <- as.data.frame(VEC_Man_VLN10) #Converting the Manure vector to a data frame
VEC_ManDF_VLN10$MNumber <- seq(from = 1, to = SimulationLength_months)

sapply(VEC_LitDF_VLN10, class) #Check that class is numeric
sapply(VEC_ManDF_VLN10, class) #Check that class is numeric
LitterCinputs_VLN10=VEC_LitDF_VLN10   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
ManureCinputs_VLN10=VEC_ManDF_VLN10 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
MCinputs_VLN10 <- merge(LitterCinputs_VLN10, ManureCinputs_VLN10, by = "MNumber")
MCinputs_VLN10$MInput_VLN10 <- MCinputs_VLN10$VEC_Lit_VLN10 + MCinputs_VLN10$VEC_Man_VLN10

#Change names of litter and manure columns for more common ones
colnames(MCinputs_VLN10)[which(names(MCinputs_VLN10) == "VEC_Lit_VLN10")] <- "LitterC_VLN10"
colnames(MCinputs_VLN10)[which(names(MCinputs_VLN10) == "VEC_Man_VLN10")] <- "ManureC_VLN10"

#Create a dataframe with the data considering the simulation length
ModelDF_VLN10 <- as.data.frame(Ct_VLN10)
colnames(ModelDF_VLN10) <- c('DPM_VLN10','RPM_VLN10','BIO_VLN10', 'HUM_VLN10', 'IOM_VLN10')
ModelDFS_VLN10 <- ModelDF_VLN10[1:SimulationLength_months, ]

#Create a column with the number of month of analysis
ModelDFS_VLN10$MNumber <- seq(from = 1, to = SimulationLength_months)

#Create a column that sums all pools
ModelDFS_VLN10$AllPools_VLN10 <- ModelDFS_VLN10$DPM_VLN10 + ModelDFS_VLN10$RPM_VLN10 + ModelDFS_VLN10$BIO_VLN10 + ModelDFS_VLN10$HUM_VLN10 + ModelDFS_VLN10$IOM_VLN10

#Create a column that sums all pools except IOM (static)
ModelDFS_VLN10$AllPools_noIOM_VLN10 <- ModelDFS_VLN10$DPM_VLN10 + ModelDFS_VLN10$RPM_VLN10 + ModelDFS_VLN10$BIO_VLN10 + ModelDFS_VLN10$HUM_VLN10

#Create a column that add the monthly input of C (manure and litter separately)
ModelDFSL_VLN10 <- merge(ModelDFS_VLN10, MCinputs_VLN10, by = "MNumber")

ModelDFSL_VLN10$MInput_VLN10 <- ModelDFSL_VLN10$LitterC_VLN10 + ModelDFSL_VLN10$ManureC_VLN10
#ModelDF_SL$MInput[1] <- 0

#Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
ModelDFSL_VLN10$CTails_VLN10 <- ModelDFSL_VLN10$AllPools_noIOM_VLN10 + ModelDFSL_VLN10$MInput_VLN10

#Create Monthly Accumulated input of C
ModelDFSL_VLN10$AccumInput_VLN10 = ModelDFSL_VLN10$AccumInput_VLN10=cumsum(ModelDFSL_VLN10$MInput_VLN10)

#Create Monthly Growths for each carbon pool
ModelDFSL_VLN10$MGrowth_DPM_VLN10 <- ave(ModelDFSL_VLN10$DPM_VLN10, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLN10$MGrowth_RPM_VLN10 <- ave(ModelDFSL_VLN10$RPM_VLN10, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLN10$MGrowth_BIO_VLN10 <- ave(ModelDFSL_VLN10$BIO_VLN10, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLN10$MGrowth_HUM_VLN10 <- ave(ModelDFSL_VLN10$HUM_VLN10, FUN = function(x) c(0, diff(x)))
ModelDFSL_VLN10$MGrowth_IOM_VLN10 <- ave(ModelDFSL_VLN10$IOM_VLN10, FUN = function(x) c(0, diff(x)))

#Create column for Monthly and Accumulated C-CO2 emissions
ModelDFSL_VLN10$M_CCO2_VLN10 <- ModelDFSL_VLN10$MInput_VLN10 - ModelDFSL_VLN10$MGrowth_DPM_VLN10 - ModelDFSL_VLN10$MGrowth_RPM_VLN10 - ModelDFSL_VLN10$MGrowth_BIO_VLN10 - ModelDFSL_VLN10$MGrowth_HUM_VLN10
ModelDFSL_VLN10$Accum_CCO2_VLN10 <- ModelDFSL_VLN10$AccumInput_VLN10 - ModelDFSL_VLN10$AllPools_noIOM_VLN10

#Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
ModelDFSL_VLN10$M_CCO2_VLN10[1] <- 0
ModelDFSL_VLN10$Accum_CCO2_VLN10[1] <- 0

#Balance validation
ModelDFSL_VLN10$Balance_VLN10 <- ModelDFSL_VLN10$AccumInput_VLN10 - ModelDFSL_VLN10$Accum_CCO2_VLN10 - (ModelDFSL_VLN10$DPM_VLN10 + ModelDFSL_VLN10$RPM_VLN10 + ModelDFSL_VLN10$BIO_VLN10 + ModelDFSL_VLN10$HUM_VLN10)

#Convert C-CO2 emissions into CO2 emissions
ModelDFSL_VLN10$M_CO2_VLN10 <- ModelDFSL_VLN10$M_CCO2_VLN10 * 44/12
ModelDFSL_VLN10$Accum_CO2_VLN10 <- ModelDFSL_VLN10$Accum_CCO2_VLN10 * 44/12

#This model will be called VLN10C because implies a continuous input of C
ModelDFSL_VLN10C <- ModelDFSL_VLN10

#Export the dataframe
write_xlsx(ModelDFSL_VLN10C,"VXC_Models\\ModelDFSL_R_VLN10C.xlsx")

#Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
#Create two equal models by using the above general script
#Create model t=x
ModelDFSLt0_VLN10 <- ModelDFSL_VLN10 #Create model t=x

#Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
ModelDFSLt1_VLN10.1 <- rbind(c(0:0), ModelDFSLt0_VLN10)
ModelDFSLt1_VLN10.2 <- rbind(c(0:0), ModelDFSLt1_VLN10.1)
ModelDFSLt1_VLN10.3 <- rbind(c(0:0), ModelDFSLt1_VLN10.2)
ModelDFSLt1_VLN10.4 <- rbind(c(0:0), ModelDFSLt1_VLN10.3)
ModelDFSLt1_VLN10.5 <- rbind(c(0:0), ModelDFSLt1_VLN10.4)
ModelDFSLt1_VLN10.6 <- rbind(c(0:0), ModelDFSLt1_VLN10.5)
ModelDFSLt1_VLN10.7 <- rbind(c(0:0), ModelDFSLt1_VLN10.6)
ModelDFSLt1_VLN10.8 <- rbind(c(0:0), ModelDFSLt1_VLN10.7)
ModelDFSLt1_VLN10.9 <- rbind(c(0:0), ModelDFSLt1_VLN10.8)
ModelDFSLt1_VLN10.10 <- rbind(c(0:0), ModelDFSLt1_VLN10.9)
ModelDFSLt1_VLN10.11 <- rbind(c(0:0), ModelDFSLt1_VLN10.10)
ModelDFSLt1_VLN10.12 <- rbind(c(0:0), ModelDFSLt1_VLN10.11)
ModelDFSLt1_VLN10.13 <- ModelDFSLt1_VLN10.12[-nrow(ModelDFSLt1_VLN10.12),]
ModelDFSLt1_VLN10.14 <- ModelDFSLt1_VLN10.13[-nrow(ModelDFSLt1_VLN10.13),]
ModelDFSLt1_VLN10.15 <- ModelDFSLt1_VLN10.14[-nrow(ModelDFSLt1_VLN10.14),]
ModelDFSLt1_VLN10.16 <- ModelDFSLt1_VLN10.15[-nrow(ModelDFSLt1_VLN10.15),]
ModelDFSLt1_VLN10.17 <- ModelDFSLt1_VLN10.16[-nrow(ModelDFSLt1_VLN10.16),]
ModelDFSLt1_VLN10.18 <- ModelDFSLt1_VLN10.17[-nrow(ModelDFSLt1_VLN10.17),]
ModelDFSLt1_VLN10.19 <- ModelDFSLt1_VLN10.18[-nrow(ModelDFSLt1_VLN10.18),]
ModelDFSLt1_VLN10.20 <- ModelDFSLt1_VLN10.19[-nrow(ModelDFSLt1_VLN10.19),]
ModelDFSLt1_VLN10.21 <- ModelDFSLt1_VLN10.20[-nrow(ModelDFSLt1_VLN10.20),]
ModelDFSLt1_VLN10.22 <- ModelDFSLt1_VLN10.21[-nrow(ModelDFSLt1_VLN10.21),]
ModelDFSLt1_VLN10.23 <- ModelDFSLt1_VLN10.22[-nrow(ModelDFSLt1_VLN10.22),]
ModelDFSLt1_VLN10.24 <- ModelDFSLt1_VLN10.23[-nrow(ModelDFSLt1_VLN10.23),]

ModelDFSLt1_VLN10 <- ModelDFSLt1_VLN10.24 #Create model t=x+1

#Subtract model (t=x) - (t=x+1)
ModelDFSL1y_VLN10 <- ModelDFSLt0_VLN10 - ModelDFSLt1_VLN10

#Re-do Month Number column because the substraction was also applied to it
ModelDFSL1y_VLN10$MNumber <- seq(from = 1, to = SimulationLength_months)

#This model will be called VLN10P because implies a one-off input of C
ModelDFSL_VLN10P <- ModelDFSL1y_VLN10

#Export the dataframe
write_xlsx(ModelDFSL_VLN10P,"VXP_Models\\ModelDFSL_R_VLN10P.xlsx")


#Plot 3: Interactive Yearly CO2 emissions #
MY <- 12
ModelDFSL_VLN10P_YCO2 <- ModelDFSL_VLN10P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VLN10)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLN10P_YCO2) <- c("Year", "Months", "AnnualCO2_VLN10")

#Plot 3: Interactive Yearly CO2 emissions considering a delay
GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
ModelDFSL_VLN10P_YCO2D <- merge(ModelDFSL_VLN10P_YCO2, GWP100delay, by = "Year")
ModelDFSL_VLN10P_YCO2D$AnnualCO2D_VLN10 <- ModelDFSL_VLN10P_YCO2D$AnnualCO2_VLN10 * ModelDFSL_VLN10P_YCO2D$GWP100

#Plot 4: Interactive Yearly C emissions #
MY <- 12
ModelDFSL_VLN10P_YC <- ModelDFSL_VLN10P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VLN10)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLN10P_YC) <- c("Year", "Months", "CEmissions_VLN10")

#Plot 5: Interactive Yearly C tails (remaining C in Soil) #
MY <- 12
ModelDFSL_VLN10P_YCT <- ModelDFSL_VLN10P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VLN10)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VLN10P_YCT) <- c("Year", "Months", "CTail_VLN10")

#Save Dataframes for Plots 3.1, 3.2, 4 and 5
write_xlsx(ModelDFSL_VLN10P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VLN10P.xlsx") #Yearly CO2 emissions (no delay)
write_xlsx(ModelDFSL_VLN10P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VLN10P.xlsx") #Yearly CO2 emissions (delay)
write_xlsx(ModelDFSL_VLN10P_YC,"CEmissions_P\\ModelDFSL_R_CE_VLN10P.xlsx") #Yearly C emissions
write_xlsx(ModelDFSL_VLN10P_YCT,"CTails_P\\ModelDFSL_R_CT_VLN10P.xlsx") #Yearly C emissions

#### - ####
#### 10) Model Combinations - Manure; Conventional Tillage, 0-100% (+10%) Clay ####
#### 10.1 - VMC0) Manure; 0%clay; Conventional tillage ####
#The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
fT_VMC0=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
fW_VMC0=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                        S.Thick = soil.thick, pClay = clay0,
                        pE = 1.0, bare = FALSE)$b #Moisture effects per month
xi.frame_VMC0=data.frame(years,rep(fT_VMC0*fW_VMC0,length.out=length(years)))

#To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
Model_VMC0=SoilR::RothCModel(
  t=years, #Simulation Length
  ks=c(k.DPM = 10*CTRM, k.RPM = 0.3*CTRM, k.BIO = 0.66*CTRM, k.HUM = 0.02*CTRM, k.IOM = 0*CTRM), #Decomposition rates for the different pools
  C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
  In=Scalar_LitterCinputs*0, #Amount of litter inputs by time
  FYM = Scalar_ManureCinputs*1, #Amount of Farm Yard Manure by time
  clay=clay0, #Percent clay in mineral soil
  xi=xi.frame_VMC0) #Loads the model

Ct_VMC0=getC(Model_VMC0) #Calculates stocks for each pool per month

VEC_Lit_VMC0 <- rep(M_Scalar_LitterCinputs*0, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
VEC_Man_VMC0 <- rep(M_Scalar_ManureCinputs*1, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

VEC_LitDF_VMC0 <- as.data.frame(VEC_Lit_VMC0) #Converting the Litter vector to a data frame
VEC_LitDF_VMC0$MNumber <- seq(from = 1, to = SimulationLength_months)
VEC_ManDF_VMC0 <- as.data.frame(VEC_Man_VMC0) #Converting the Manure vector to a data frame
VEC_ManDF_VMC0$MNumber <- seq(from = 1, to = SimulationLength_months)

sapply(VEC_LitDF_VMC0, class) #Check that class is numeric
sapply(VEC_ManDF_VMC0, class) #Check that class is numeric
LitterCinputs_VMC0=VEC_LitDF_VMC0   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
ManureCinputs_VMC0=VEC_ManDF_VMC0 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
MCinputs_VMC0 <- merge(LitterCinputs_VMC0, ManureCinputs_VMC0, by = "MNumber")
MCinputs_VMC0$MInput_VMC0 <- MCinputs_VMC0$VEC_Lit_VMC0 + MCinputs_VMC0$VEC_Man_VMC0

#Change names of litter and manure columns for more common ones
colnames(MCinputs_VMC0)[which(names(MCinputs_VMC0) == "VEC_Lit_VMC0")] <- "LitterC_VMC0"
colnames(MCinputs_VMC0)[which(names(MCinputs_VMC0) == "VEC_Man_VMC0")] <- "ManureC_VMC0"

#Create a dataframe with the data considering the simulation length
ModelDF_VMC0 <- as.data.frame(Ct_VMC0)
colnames(ModelDF_VMC0) <- c('DPM_VMC0','RPM_VMC0','BIO_VMC0', 'HUM_VMC0', 'IOM_VMC0')
ModelDFS_VMC0 <- ModelDF_VMC0[1:SimulationLength_months, ]

#Create a column with the number of month of analysis
ModelDFS_VMC0$MNumber <- seq(from = 1, to = SimulationLength_months)

#Create a column that sums all pools
ModelDFS_VMC0$AllPools_VMC0 <- ModelDFS_VMC0$DPM_VMC0 + ModelDFS_VMC0$RPM_VMC0 + ModelDFS_VMC0$BIO_VMC0 + ModelDFS_VMC0$HUM_VMC0 + ModelDFS_VMC0$IOM_VMC0

#Create a column that sums all pools except IOM (static)
ModelDFS_VMC0$AllPools_noIOM_VMC0 <- ModelDFS_VMC0$DPM_VMC0 + ModelDFS_VMC0$RPM_VMC0 + ModelDFS_VMC0$BIO_VMC0 + ModelDFS_VMC0$HUM_VMC0

#Create a column that add the monthly input of C (manure and litter separately)
ModelDFSL_VMC0 <- merge(ModelDFS_VMC0, MCinputs_VMC0, by = "MNumber")

ModelDFSL_VMC0$MInput_VMC0 <- ModelDFSL_VMC0$LitterC_VMC0 + ModelDFSL_VMC0$ManureC_VMC0
#ModelDF_SL$MInput[1] <- 0

#Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
ModelDFSL_VMC0$CTails_VMC0 <- ModelDFSL_VMC0$AllPools_noIOM_VMC0 + ModelDFSL_VMC0$MInput_VMC0

#Create Monthly Accumulated input of C
ModelDFSL_VMC0$AccumInput_VMC0 = ModelDFSL_VMC0$AccumInput_VMC0=cumsum(ModelDFSL_VMC0$MInput_VMC0)

#Create Monthly Growths for each carbon pool
ModelDFSL_VMC0$MGrowth_DPM_VMC0 <- ave(ModelDFSL_VMC0$DPM_VMC0, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMC0$MGrowth_RPM_VMC0 <- ave(ModelDFSL_VMC0$RPM_VMC0, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMC0$MGrowth_BIO_VMC0 <- ave(ModelDFSL_VMC0$BIO_VMC0, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMC0$MGrowth_HUM_VMC0 <- ave(ModelDFSL_VMC0$HUM_VMC0, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMC0$MGrowth_IOM_VMC0 <- ave(ModelDFSL_VMC0$IOM_VMC0, FUN = function(x) c(0, diff(x)))

#Create column for Monthly and Accumulated C-CO2 emissions
ModelDFSL_VMC0$M_CCO2_VMC0 <- ModelDFSL_VMC0$MInput_VMC0 - ModelDFSL_VMC0$MGrowth_DPM_VMC0 - ModelDFSL_VMC0$MGrowth_RPM_VMC0 - ModelDFSL_VMC0$MGrowth_BIO_VMC0 - ModelDFSL_VMC0$MGrowth_HUM_VMC0
ModelDFSL_VMC0$Accum_CCO2_VMC0 <- ModelDFSL_VMC0$AccumInput_VMC0 - ModelDFSL_VMC0$AllPools_noIOM_VMC0

#Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
ModelDFSL_VMC0$M_CCO2_VMC0[1] <- 0
ModelDFSL_VMC0$Accum_CCO2_VMC0[1] <- 0

#Balance validation
ModelDFSL_VMC0$Balance_VMC0 <- ModelDFSL_VMC0$AccumInput_VMC0 - ModelDFSL_VMC0$Accum_CCO2_VMC0 - (ModelDFSL_VMC0$DPM_VMC0 + ModelDFSL_VMC0$RPM_VMC0 + ModelDFSL_VMC0$BIO_VMC0 + ModelDFSL_VMC0$HUM_VMC0)

#Convert C-CO2 emissions into CO2 emissions
ModelDFSL_VMC0$M_CO2_VMC0 <- ModelDFSL_VMC0$M_CCO2_VMC0 * 44/12
ModelDFSL_VMC0$Accum_CO2_VMC0 <- ModelDFSL_VMC0$Accum_CCO2_VMC0 * 44/12

#This model will be called VMC0C because implies a continuous input of C
ModelDFSL_VMC0C <- ModelDFSL_VMC0

#Export the dataframe
write_xlsx(ModelDFSL_VMC0C,"VXC_Models\\ModelDFSL_R_VMC0C.xlsx")

#Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
#Create two equal models by using the above general script
#Create model t=x
ModelDFSLt0_VMC0 <- ModelDFSL_VMC0 #Create model t=x

#Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
ModelDFSLt1_VMC0.1 <- rbind(c(0:0), ModelDFSLt0_VMC0)
ModelDFSLt1_VMC0.2 <- rbind(c(0:0), ModelDFSLt1_VMC0.1)
ModelDFSLt1_VMC0.3 <- rbind(c(0:0), ModelDFSLt1_VMC0.2)
ModelDFSLt1_VMC0.4 <- rbind(c(0:0), ModelDFSLt1_VMC0.3)
ModelDFSLt1_VMC0.5 <- rbind(c(0:0), ModelDFSLt1_VMC0.4)
ModelDFSLt1_VMC0.6 <- rbind(c(0:0), ModelDFSLt1_VMC0.5)
ModelDFSLt1_VMC0.7 <- rbind(c(0:0), ModelDFSLt1_VMC0.6)
ModelDFSLt1_VMC0.8 <- rbind(c(0:0), ModelDFSLt1_VMC0.7)
ModelDFSLt1_VMC0.9 <- rbind(c(0:0), ModelDFSLt1_VMC0.8)
ModelDFSLt1_VMC0.10 <- rbind(c(0:0), ModelDFSLt1_VMC0.9)
ModelDFSLt1_VMC0.11 <- rbind(c(0:0), ModelDFSLt1_VMC0.10)
ModelDFSLt1_VMC0.12 <- rbind(c(0:0), ModelDFSLt1_VMC0.11)
ModelDFSLt1_VMC0.13 <- ModelDFSLt1_VMC0.12[-nrow(ModelDFSLt1_VMC0.12),]
ModelDFSLt1_VMC0.14 <- ModelDFSLt1_VMC0.13[-nrow(ModelDFSLt1_VMC0.13),]
ModelDFSLt1_VMC0.15 <- ModelDFSLt1_VMC0.14[-nrow(ModelDFSLt1_VMC0.14),]
ModelDFSLt1_VMC0.16 <- ModelDFSLt1_VMC0.15[-nrow(ModelDFSLt1_VMC0.15),]
ModelDFSLt1_VMC0.17 <- ModelDFSLt1_VMC0.16[-nrow(ModelDFSLt1_VMC0.16),]
ModelDFSLt1_VMC0.18 <- ModelDFSLt1_VMC0.17[-nrow(ModelDFSLt1_VMC0.17),]
ModelDFSLt1_VMC0.19 <- ModelDFSLt1_VMC0.18[-nrow(ModelDFSLt1_VMC0.18),]
ModelDFSLt1_VMC0.20 <- ModelDFSLt1_VMC0.19[-nrow(ModelDFSLt1_VMC0.19),]
ModelDFSLt1_VMC0.21 <- ModelDFSLt1_VMC0.20[-nrow(ModelDFSLt1_VMC0.20),]
ModelDFSLt1_VMC0.22 <- ModelDFSLt1_VMC0.21[-nrow(ModelDFSLt1_VMC0.21),]
ModelDFSLt1_VMC0.23 <- ModelDFSLt1_VMC0.22[-nrow(ModelDFSLt1_VMC0.22),]
ModelDFSLt1_VMC0.24 <- ModelDFSLt1_VMC0.23[-nrow(ModelDFSLt1_VMC0.23),]

ModelDFSLt1_VMC0 <- ModelDFSLt1_VMC0.24 #Create model t=x+1

#Subtract model (t=x) - (t=x+1)
ModelDFSL1y_VMC0 <- ModelDFSLt0_VMC0 - ModelDFSLt1_VMC0

#Re-do Month Number column because the substraction was also applied to it
ModelDFSL1y_VMC0$MNumber <- seq(from = 1, to = SimulationLength_months)

#This model will be called VMC0P because implies a one-off input of C
ModelDFSL_VMC0P <- ModelDFSL1y_VMC0

#Export the dataframe
write_xlsx(ModelDFSL_VMC0P,"VXP_Models\\ModelDFSL_R_VMC0P.xlsx")

#Plot 3.1: Interactive Yearly CO2 emissions #
MY <- 12
ModelDFSL_VMC0P_YCO2 <- ModelDFSL_VMC0P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VMC0)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMC0P_YCO2) <- c("Year", "Months", "AnnualCO2_VMC_0")

#Plot 3.2: Interactive Yearly CO2 emissions considering a delay
GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
ModelDFSL_VMC0P_YCO2D <- merge(ModelDFSL_VMC0P_YCO2, GWP100delay, by = "Year")
ModelDFSL_VMC0P_YCO2D$AnnualCO2D_VMC_0 <- ModelDFSL_VMC0P_YCO2D$AnnualCO2_VMC_0 * ModelDFSL_VMC0P_YCO2D$GWP100

#Plot 4: Interactive Yearly C emissions #
MY <- 12
ModelDFSL_VMC0P_YC <- ModelDFSL_VMC0P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VMC0)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMC0P_YC) <- c("Year", "Months", "CEmissions_VMC_0")

#Plot 5: Interactive Yearly C tails (remaining C in Soil) #
MY <- 12
ModelDFSL_VMC0P_YCT <- ModelDFSL_VMC0P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VMC0)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMC0P_YCT) <- c("Year", "Months", "CTail_VMC_0")

#Save Dataframes for Plots 3.1, 3.2, 4 and 5
write_xlsx(ModelDFSL_VMC0P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VMC0P.xlsx") #Yearly CO2 emissions (no delay)
write_xlsx(ModelDFSL_VMC0P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VMC0P.xlsx") #Yearly CO2 emissions (delay)
write_xlsx(ModelDFSL_VMC0P_YC,"CEmissions_P\\ModelDFSL_R_CE_VMC0P.xlsx") #Yearly C emissions
write_xlsx(ModelDFSL_VMC0P_YCT,"CTails_P\\ModelDFSL_R_CT_VMC0P.xlsx") #Yearly C emissions


#### 10.2 - VMC1) Manure; 10%clay; Conventional tillage ####
#The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
fT_VMC1=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
fW_VMC1=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                        S.Thick = soil.thick, pClay = clay100*0.1,
                        pE = 1.0, bare = FALSE)$b #Moisture effects per month
xi.frame_VMC1=data.frame(years,rep(fT_VMC1*fW_VMC1,length.out=length(years)))

#To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
Model_VMC1=SoilR::RothCModel(
  t=years, #Simulation Length
  ks=c(k.DPM = 10*CTRM, k.RPM = 0.3*CTRM, k.BIO = 0.66*CTRM, k.HUM = 0.02*CTRM, k.IOM = 0*CTRM), #Decomposition rates for the different pools
  C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
  In=Scalar_LitterCinputs*0, #Amount of litter inputs by time
  FYM = Scalar_ManureCinputs*1, #Amount of Farm Yard Manure by time
  clay=clay100*0.1, #Percent clay in mineral soil
  xi=xi.frame_VMC1) #Loads the model

Ct_VMC1=getC(Model_VMC1) #Calculates stocks for each pool per month

#The results can be plotted with the commands
matplot(years, Ct_VMC1, type="l", lty=1, col=1:5,
        xlab="Time (years)", ylab="C stocks (Mg/ha)")
legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
       lty=1, col=1:5, bty="n")

VEC_Lit_VMC1 <- rep(M_Scalar_LitterCinputs*0, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
VEC_Man_VMC1 <- rep(M_Scalar_ManureCinputs*1, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

VEC_LitDF_VMC1 <- as.data.frame(VEC_Lit_VMC1) #Converting the Litter vector to a data frame
VEC_LitDF_VMC1$MNumber <- seq(from = 1, to = SimulationLength_months)
VEC_ManDF_VMC1 <- as.data.frame(VEC_Man_VMC1) #Converting the Manure vector to a data frame
VEC_ManDF_VMC1$MNumber <- seq(from = 1, to = SimulationLength_months)

sapply(VEC_LitDF_VMC1, class) #Check that class is numeric
sapply(VEC_ManDF_VMC1, class) #Check that class is numeric
LitterCinputs_VMC1=VEC_LitDF_VMC1   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
ManureCinputs_VMC1=VEC_ManDF_VMC1 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
MCinputs_VMC1 <- merge(LitterCinputs_VMC1, ManureCinputs_VMC1, by = "MNumber")
MCinputs_VMC1$MInput_VMC1 <- MCinputs_VMC1$VEC_Lit_VMC1 + MCinputs_VMC1$VEC_Man_VMC1

#Change names of litter and manure columns for more common ones
colnames(MCinputs_VMC1)[which(names(MCinputs_VMC1) == "VEC_Lit_VMC1")] <- "LitterC_VMC1"
colnames(MCinputs_VMC1)[which(names(MCinputs_VMC1) == "VEC_Man_VMC1")] <- "ManureC_VMC1"

#Create a dataframe with the data considering the simulation length
ModelDF_VMC1 <- as.data.frame(Ct_VMC1)
colnames(ModelDF_VMC1) <- c('DPM_VMC1','RPM_VMC1','BIO_VMC1', 'HUM_VMC1', 'IOM_VMC1')
ModelDFS_VMC1 <- ModelDF_VMC1[1:SimulationLength_months, ]

#Create a column with the number of month of analysis
ModelDFS_VMC1$MNumber <- seq(from = 1, to = SimulationLength_months)

#Create a column that sums all pools
ModelDFS_VMC1$AllPools_VMC1 <- ModelDFS_VMC1$DPM_VMC1 + ModelDFS_VMC1$RPM_VMC1 + ModelDFS_VMC1$BIO_VMC1 + ModelDFS_VMC1$HUM_VMC1 + ModelDFS_VMC1$IOM_VMC1

#Create a column that sums all pools except IOM (static)
ModelDFS_VMC1$AllPools_noIOM_VMC1 <- ModelDFS_VMC1$DPM_VMC1 + ModelDFS_VMC1$RPM_VMC1 + ModelDFS_VMC1$BIO_VMC1 + ModelDFS_VMC1$HUM_VMC1

#Create a column that add the monthly input of C (manure and litter separately)
ModelDFSL_VMC1 <- merge(ModelDFS_VMC1, MCinputs_VMC1, by = "MNumber")

ModelDFSL_VMC1$MInput_VMC1 <- ModelDFSL_VMC1$LitterC_VMC1 + ModelDFSL_VMC1$ManureC_VMC1
#ModelDF_SL$MInput[1] <- 0

#Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
ModelDFSL_VMC1$CTails_VMC1 <- ModelDFSL_VMC1$AllPools_noIOM_VMC1 + ModelDFSL_VMC1$MInput_VMC1

#Create Monthly Accumulated input of C
ModelDFSL_VMC1$AccumInput_VMC1 = ModelDFSL_VMC1$AccumInput_VMC1=cumsum(ModelDFSL_VMC1$MInput_VMC1)

#Create Monthly Growths for each carbon pool
ModelDFSL_VMC1$MGrowth_DPM_VMC1 <- ave(ModelDFSL_VMC1$DPM_VMC1, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMC1$MGrowth_RPM_VMC1 <- ave(ModelDFSL_VMC1$RPM_VMC1, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMC1$MGrowth_BIO_VMC1 <- ave(ModelDFSL_VMC1$BIO_VMC1, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMC1$MGrowth_HUM_VMC1 <- ave(ModelDFSL_VMC1$HUM_VMC1, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMC1$MGrowth_IOM_VMC1 <- ave(ModelDFSL_VMC1$IOM_VMC1, FUN = function(x) c(0, diff(x)))

#Create column for Monthly and Accumulated C-CO2 emissions
ModelDFSL_VMC1$M_CCO2_VMC1 <- ModelDFSL_VMC1$MInput_VMC1 - ModelDFSL_VMC1$MGrowth_DPM_VMC1 - ModelDFSL_VMC1$MGrowth_RPM_VMC1 - ModelDFSL_VMC1$MGrowth_BIO_VMC1 - ModelDFSL_VMC1$MGrowth_HUM_VMC1
ModelDFSL_VMC1$Accum_CCO2_VMC1 <- ModelDFSL_VMC1$AccumInput_VMC1 - ModelDFSL_VMC1$AllPools_noIOM_VMC1

#Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
ModelDFSL_VMC1$M_CCO2_VMC1[1] <- 0
ModelDFSL_VMC1$Accum_CCO2_VMC1[1] <- 0

#Balance validation
ModelDFSL_VMC1$Balance_VMC1 <- ModelDFSL_VMC1$AccumInput_VMC1 - ModelDFSL_VMC1$Accum_CCO2_VMC1 - (ModelDFSL_VMC1$DPM_VMC1 + ModelDFSL_VMC1$RPM_VMC1 + ModelDFSL_VMC1$BIO_VMC1 + ModelDFSL_VMC1$HUM_VMC1)

#Convert C-CO2 emissions into CO2 emissions
ModelDFSL_VMC1$M_CO2_VMC1 <- ModelDFSL_VMC1$M_CCO2_VMC1 * 44/12
ModelDFSL_VMC1$Accum_CO2_VMC1 <- ModelDFSL_VMC1$Accum_CCO2_VMC1 * 44/12

#This model will be called VMC1C because implies a continuous input of C
ModelDFSL_VMC1C <- ModelDFSL_VMC1

#Export the dataframe
write_xlsx(ModelDFSL_VMC1C,"VXC_Models\\ModelDFSL_R_VMC1C.xlsx")

#Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
#Create two equal models by using the above general script
#Create model t=x
ModelDFSLt0_VMC1 <- ModelDFSL_VMC1 #Create model t=x

#Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
ModelDFSLt1_VMC1.1 <- rbind(c(0:0), ModelDFSLt0_VMC1)
ModelDFSLt1_VMC1.2 <- rbind(c(0:0), ModelDFSLt1_VMC1.1)
ModelDFSLt1_VMC1.3 <- rbind(c(0:0), ModelDFSLt1_VMC1.2)
ModelDFSLt1_VMC1.4 <- rbind(c(0:0), ModelDFSLt1_VMC1.3)
ModelDFSLt1_VMC1.5 <- rbind(c(0:0), ModelDFSLt1_VMC1.4)
ModelDFSLt1_VMC1.6 <- rbind(c(0:0), ModelDFSLt1_VMC1.5)
ModelDFSLt1_VMC1.7 <- rbind(c(0:0), ModelDFSLt1_VMC1.6)
ModelDFSLt1_VMC1.8 <- rbind(c(0:0), ModelDFSLt1_VMC1.7)
ModelDFSLt1_VMC1.9 <- rbind(c(0:0), ModelDFSLt1_VMC1.8)
ModelDFSLt1_VMC1.10 <- rbind(c(0:0), ModelDFSLt1_VMC1.9)
ModelDFSLt1_VMC1.11 <- rbind(c(0:0), ModelDFSLt1_VMC1.10)
ModelDFSLt1_VMC1.12 <- rbind(c(0:0), ModelDFSLt1_VMC1.11)
ModelDFSLt1_VMC1.13 <- ModelDFSLt1_VMC1.12[-nrow(ModelDFSLt1_VMC1.12),]
ModelDFSLt1_VMC1.14 <- ModelDFSLt1_VMC1.13[-nrow(ModelDFSLt1_VMC1.13),]
ModelDFSLt1_VMC1.15 <- ModelDFSLt1_VMC1.14[-nrow(ModelDFSLt1_VMC1.14),]
ModelDFSLt1_VMC1.16 <- ModelDFSLt1_VMC1.15[-nrow(ModelDFSLt1_VMC1.15),]
ModelDFSLt1_VMC1.17 <- ModelDFSLt1_VMC1.16[-nrow(ModelDFSLt1_VMC1.16),]
ModelDFSLt1_VMC1.18 <- ModelDFSLt1_VMC1.17[-nrow(ModelDFSLt1_VMC1.17),]
ModelDFSLt1_VMC1.19 <- ModelDFSLt1_VMC1.18[-nrow(ModelDFSLt1_VMC1.18),]
ModelDFSLt1_VMC1.20 <- ModelDFSLt1_VMC1.19[-nrow(ModelDFSLt1_VMC1.19),]
ModelDFSLt1_VMC1.21 <- ModelDFSLt1_VMC1.20[-nrow(ModelDFSLt1_VMC1.20),]
ModelDFSLt1_VMC1.22 <- ModelDFSLt1_VMC1.21[-nrow(ModelDFSLt1_VMC1.21),]
ModelDFSLt1_VMC1.23 <- ModelDFSLt1_VMC1.22[-nrow(ModelDFSLt1_VMC1.22),]
ModelDFSLt1_VMC1.24 <- ModelDFSLt1_VMC1.23[-nrow(ModelDFSLt1_VMC1.23),]

ModelDFSLt1_VMC1 <- ModelDFSLt1_VMC1.24 #Create model t=x+1

#Subtract model (t=x) - (t=x+1)
ModelDFSL1y_VMC1 <- ModelDFSLt0_VMC1 - ModelDFSLt1_VMC1

#Re-do Month Number column because the substraction was also applied to it
ModelDFSL1y_VMC1$MNumber <- seq(from = 1, to = SimulationLength_months)

#This model will be called VMC1P because implies a one-off input of C
ModelDFSL_VMC1P <- ModelDFSL1y_VMC1

#Export the dataframe
write_xlsx(ModelDFSL_VMC1P,"VXP_Models\\ModelDFSL_R_VMC1P.xlsx")

#Plot 3: Interactive Yearly CO2 emissions #
MY <- 12
ModelDFSL_VMC1P_YCO2 <- ModelDFSL_VMC1P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VMC1)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMC1P_YCO2) <- c("Year", "Months", "AnnualCO2_VMC_1")

#Plot 3: Interactive Yearly CO2 emissions considering a delay
GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
ModelDFSL_VMC1P_YCO2D <- merge(ModelDFSL_VMC1P_YCO2, GWP100delay, by = "Year")
ModelDFSL_VMC1P_YCO2D$AnnualCO2D_VMC_1 <- ModelDFSL_VMC1P_YCO2D$AnnualCO2_VMC_1 * ModelDFSL_VMC1P_YCO2D$GWP100

#Plot 4: Interactive Yearly C emissions #
MY <- 12
ModelDFSL_VMC1P_YC <- ModelDFSL_VMC1P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VMC1)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMC1P_YC) <- c("Year", "Months", "CEmissions_VMC_1")

#Plot 5: Interactive Yearly C tails (remaining C in Soil) #
MY <- 12
ModelDFSL_VMC1P_YCT <- ModelDFSL_VMC1P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VMC1)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMC1P_YCT) <- c("Year", "Months", "CTail_VMC_1")

#Save Dataframes for Plots 3.1, 3.2, 4 and 5
write_xlsx(ModelDFSL_VMC1P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VMC1P.xlsx") #Yearly CO2 emissions (no delay)
write_xlsx(ModelDFSL_VMC1P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VMC1P.xlsx") #Yearly CO2 emissions (delay)
write_xlsx(ModelDFSL_VMC1P_YC,"CEmissions_P\\ModelDFSL_R_CE_VMC1P.xlsx") #Yearly C emissions
write_xlsx(ModelDFSL_VMC1P_YCT,"CTails_P\\ModelDFSL_R_CT_VMC1P.xlsx") #Yearly C emissions



#### 10.3 - VMC2) Manure; 20%clay; Conventional tillage ####
#The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
fT_VMC2=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
fW_VMC2=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                        S.Thick = soil.thick, pClay = clay100*0.2,
                        pE = 1.0, bare = FALSE)$b #Moisture effects per month
xi.frame_VMC2=data.frame(years,rep(fT_VMC2*fW_VMC2,length.out=length(years)))

#To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
Model_VMC2=SoilR::RothCModel(
  t=years, #Simulation Length
  ks=c(k.DPM = 10*CTRM, k.RPM = 0.3*CTRM, k.BIO = 0.66*CTRM, k.HUM = 0.02*CTRM, k.IOM = 0*CTRM), #Decomposition rates for the different pools
  C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
  In=Scalar_LitterCinputs*0, #Amount of litter inputs by time
  FYM = Scalar_ManureCinputs*1, #Amount of Farm Yard Manure by time
  clay=clay100*0.2, #Percent clay in mineral soil
  xi=xi.frame_VMC2) #Loads the model

Ct_VMC2=getC(Model_VMC2) #Calculates stocks for each pool per month

#The results can be plotted with the commands
matplot(years, Ct_VMC2, type="l", lty=1, col=1:5,
        xlab="Time (years)", ylab="C stocks (Mg/ha)")
legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
       lty=1, col=1:5, bty="n")

VEC_Lit_VMC2 <- rep(M_Scalar_LitterCinputs*0, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
VEC_Man_VMC2 <- rep(M_Scalar_ManureCinputs*1, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

VEC_LitDF_VMC2 <- as.data.frame(VEC_Lit_VMC2) #Converting the Litter vector to a data frame
VEC_LitDF_VMC2$MNumber <- seq(from = 1, to = SimulationLength_months)
VEC_ManDF_VMC2 <- as.data.frame(VEC_Man_VMC2) #Converting the Manure vector to a data frame
VEC_ManDF_VMC2$MNumber <- seq(from = 1, to = SimulationLength_months)

sapply(VEC_LitDF_VMC2, class) #Check that class is numeric
sapply(VEC_ManDF_VMC2, class) #Check that class is numeric
LitterCinputs_VMC2=VEC_LitDF_VMC2   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
ManureCinputs_VMC2=VEC_ManDF_VMC2 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
MCinputs_VMC2 <- merge(LitterCinputs_VMC2, ManureCinputs_VMC2, by = "MNumber")
MCinputs_VMC2$MInput_VMC2 <- MCinputs_VMC2$VEC_Lit_VMC2 + MCinputs_VMC2$VEC_Man_VMC2

#Change names of litter and manure columns for more common ones
colnames(MCinputs_VMC2)[which(names(MCinputs_VMC2) == "VEC_Lit_VMC2")] <- "LitterC_VMC2"
colnames(MCinputs_VMC2)[which(names(MCinputs_VMC2) == "VEC_Man_VMC2")] <- "ManureC_VMC2"

#Create a dataframe with the data considering the simulation length
ModelDF_VMC2 <- as.data.frame(Ct_VMC2)
colnames(ModelDF_VMC2) <- c('DPM_VMC2','RPM_VMC2','BIO_VMC2', 'HUM_VMC2', 'IOM_VMC2')
ModelDFS_VMC2 <- ModelDF_VMC2[1:SimulationLength_months, ]

#Create a column with the number of month of analysis
ModelDFS_VMC2$MNumber <- seq(from = 1, to = SimulationLength_months)

#Create a column that sums all pools
ModelDFS_VMC2$AllPools_VMC2 <- ModelDFS_VMC2$DPM_VMC2 + ModelDFS_VMC2$RPM_VMC2 + ModelDFS_VMC2$BIO_VMC2 + ModelDFS_VMC2$HUM_VMC2 + ModelDFS_VMC2$IOM_VMC2

#Create a column that sums all pools except IOM (static)
ModelDFS_VMC2$AllPools_noIOM_VMC2 <- ModelDFS_VMC2$DPM_VMC2 + ModelDFS_VMC2$RPM_VMC2 + ModelDFS_VMC2$BIO_VMC2 + ModelDFS_VMC2$HUM_VMC2

#Create a column that add the monthly input of C (manure and litter separately)
ModelDFSL_VMC2 <- merge(ModelDFS_VMC2, MCinputs_VMC2, by = "MNumber")

ModelDFSL_VMC2$MInput_VMC2 <- ModelDFSL_VMC2$LitterC_VMC2 + ModelDFSL_VMC2$ManureC_VMC2
#ModelDF_SL$MInput[1] <- 0

#Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
ModelDFSL_VMC2$CTails_VMC2 <- ModelDFSL_VMC2$AllPools_noIOM_VMC2 + ModelDFSL_VMC2$MInput_VMC2

#Create Monthly Accumulated input of C
ModelDFSL_VMC2$AccumInput_VMC2 = ModelDFSL_VMC2$AccumInput_VMC2=cumsum(ModelDFSL_VMC2$MInput_VMC2)

#Create Monthly Growths for each carbon pool
ModelDFSL_VMC2$MGrowth_DPM_VMC2 <- ave(ModelDFSL_VMC2$DPM_VMC2, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMC2$MGrowth_RPM_VMC2 <- ave(ModelDFSL_VMC2$RPM_VMC2, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMC2$MGrowth_BIO_VMC2 <- ave(ModelDFSL_VMC2$BIO_VMC2, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMC2$MGrowth_HUM_VMC2 <- ave(ModelDFSL_VMC2$HUM_VMC2, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMC2$MGrowth_IOM_VMC2 <- ave(ModelDFSL_VMC2$IOM_VMC2, FUN = function(x) c(0, diff(x)))

#Create column for Monthly and Accumulated C-CO2 emissions
ModelDFSL_VMC2$M_CCO2_VMC2 <- ModelDFSL_VMC2$MInput_VMC2 - ModelDFSL_VMC2$MGrowth_DPM_VMC2 - ModelDFSL_VMC2$MGrowth_RPM_VMC2 - ModelDFSL_VMC2$MGrowth_BIO_VMC2 - ModelDFSL_VMC2$MGrowth_HUM_VMC2
ModelDFSL_VMC2$Accum_CCO2_VMC2 <- ModelDFSL_VMC2$AccumInput_VMC2 - ModelDFSL_VMC2$AllPools_noIOM_VMC2

#Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
ModelDFSL_VMC2$M_CCO2_VMC2[1] <- 0
ModelDFSL_VMC2$Accum_CCO2_VMC2[1] <- 0

#Balance validation
ModelDFSL_VMC2$Balance_VMC2 <- ModelDFSL_VMC2$AccumInput_VMC2 - ModelDFSL_VMC2$Accum_CCO2_VMC2 - (ModelDFSL_VMC2$DPM_VMC2 + ModelDFSL_VMC2$RPM_VMC2 + ModelDFSL_VMC2$BIO_VMC2 + ModelDFSL_VMC2$HUM_VMC2)

#Convert C-CO2 emissions into CO2 emissions
ModelDFSL_VMC2$M_CO2_VMC2 <- ModelDFSL_VMC2$M_CCO2_VMC2 * 44/12
ModelDFSL_VMC2$Accum_CO2_VMC2 <- ModelDFSL_VMC2$Accum_CCO2_VMC2 * 44/12

#This model will be called VMC2C because implies a continuous input of C
ModelDFSL_VMC2C <- ModelDFSL_VMC2

#Export the dataframe
write_xlsx(ModelDFSL_VMC2C,"VXC_Models\\ModelDFSL_R_VMC2C.xlsx")

#Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
#Create two equal models by using the above general script
#Create model t=x
ModelDFSLt0_VMC2 <- ModelDFSL_VMC2 #Create model t=x

#Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
ModelDFSLt1_VMC2.1 <- rbind(c(0:0), ModelDFSLt0_VMC2)
ModelDFSLt1_VMC2.2 <- rbind(c(0:0), ModelDFSLt1_VMC2.1)
ModelDFSLt1_VMC2.3 <- rbind(c(0:0), ModelDFSLt1_VMC2.2)
ModelDFSLt1_VMC2.4 <- rbind(c(0:0), ModelDFSLt1_VMC2.3)
ModelDFSLt1_VMC2.5 <- rbind(c(0:0), ModelDFSLt1_VMC2.4)
ModelDFSLt1_VMC2.6 <- rbind(c(0:0), ModelDFSLt1_VMC2.5)
ModelDFSLt1_VMC2.7 <- rbind(c(0:0), ModelDFSLt1_VMC2.6)
ModelDFSLt1_VMC2.8 <- rbind(c(0:0), ModelDFSLt1_VMC2.7)
ModelDFSLt1_VMC2.9 <- rbind(c(0:0), ModelDFSLt1_VMC2.8)
ModelDFSLt1_VMC2.10 <- rbind(c(0:0), ModelDFSLt1_VMC2.9)
ModelDFSLt1_VMC2.11 <- rbind(c(0:0), ModelDFSLt1_VMC2.10)
ModelDFSLt1_VMC2.12 <- rbind(c(0:0), ModelDFSLt1_VMC2.11)
ModelDFSLt1_VMC2.13 <- ModelDFSLt1_VMC2.12[-nrow(ModelDFSLt1_VMC2.12),]
ModelDFSLt1_VMC2.14 <- ModelDFSLt1_VMC2.13[-nrow(ModelDFSLt1_VMC2.13),]
ModelDFSLt1_VMC2.15 <- ModelDFSLt1_VMC2.14[-nrow(ModelDFSLt1_VMC2.14),]
ModelDFSLt1_VMC2.16 <- ModelDFSLt1_VMC2.15[-nrow(ModelDFSLt1_VMC2.15),]
ModelDFSLt1_VMC2.17 <- ModelDFSLt1_VMC2.16[-nrow(ModelDFSLt1_VMC2.16),]
ModelDFSLt1_VMC2.18 <- ModelDFSLt1_VMC2.17[-nrow(ModelDFSLt1_VMC2.17),]
ModelDFSLt1_VMC2.19 <- ModelDFSLt1_VMC2.18[-nrow(ModelDFSLt1_VMC2.18),]
ModelDFSLt1_VMC2.20 <- ModelDFSLt1_VMC2.19[-nrow(ModelDFSLt1_VMC2.19),]
ModelDFSLt1_VMC2.21 <- ModelDFSLt1_VMC2.20[-nrow(ModelDFSLt1_VMC2.20),]
ModelDFSLt1_VMC2.22 <- ModelDFSLt1_VMC2.21[-nrow(ModelDFSLt1_VMC2.21),]
ModelDFSLt1_VMC2.23 <- ModelDFSLt1_VMC2.22[-nrow(ModelDFSLt1_VMC2.22),]
ModelDFSLt1_VMC2.24 <- ModelDFSLt1_VMC2.23[-nrow(ModelDFSLt1_VMC2.23),]

ModelDFSLt1_VMC2 <- ModelDFSLt1_VMC2.24 #Create model t=x+1

#Subtract model (t=x) - (t=x+1)
ModelDFSL1y_VMC2 <- ModelDFSLt0_VMC2 - ModelDFSLt1_VMC2

#Re-do Month Number column because the substraction was also applied to it
ModelDFSL1y_VMC2$MNumber <- seq(from = 1, to = SimulationLength_months)

#This model will be called VMC2P because implies a one-off input of C
ModelDFSL_VMC2P <- ModelDFSL1y_VMC2

#Export the dataframe
write_xlsx(ModelDFSL_VMC2P,"VXP_Models\\ModelDFSL_R_VMC2P.xlsx")

#Plot 3: Interactive Yearly CO2 emissions #
MY <- 12
ModelDFSL_VMC2P_YCO2 <- ModelDFSL_VMC2P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VMC2)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMC2P_YCO2) <- c("Year", "Months", "AnnualCO2_VMC_2")

#Plot 3: Interactive Yearly CO2 emissions considering a delay
GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
ModelDFSL_VMC2P_YCO2D <- merge(ModelDFSL_VMC2P_YCO2, GWP100delay, by = "Year")
ModelDFSL_VMC2P_YCO2D$AnnualCO2D_VMC_2 <- ModelDFSL_VMC2P_YCO2D$AnnualCO2_VMC_2 * ModelDFSL_VMC2P_YCO2D$GWP100

#Plot 4: Interactive Yearly C emissions #
MY <- 12
ModelDFSL_VMC2P_YC <- ModelDFSL_VMC2P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VMC2)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMC2P_YC) <- c("Year", "Months", "CEmissions_VMC_2")

#Plot 5: Interactive Yearly C tails (remaining C in Soil) #
MY <- 12
ModelDFSL_VMC2P_YCT <- ModelDFSL_VMC2P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VMC2)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMC2P_YCT) <- c("Year", "Months", "CTail_VMC_2")

#Save Dataframes for Plots 3.1, 3.2, 4 and 5
write_xlsx(ModelDFSL_VMC2P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VMC2P.xlsx") #Yearly CO2 emissions (no delay)
write_xlsx(ModelDFSL_VMC2P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VMC2P.xlsx") #Yearly CO2 emissions (delay)
write_xlsx(ModelDFSL_VMC2P_YC,"CEmissions_P\\ModelDFSL_R_CE_VMC2P.xlsx") #Yearly C emissions
write_xlsx(ModelDFSL_VMC2P_YCT,"CTails_P\\ModelDFSL_R_CT_VMC2P.xlsx") #Yearly C emissions



#### 10.4 - VMC3) Manure; 30%clay; Conventional tillage ####
#The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
fT_VMC3=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
fW_VMC3=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                        S.Thick = soil.thick, pClay = clay100*0.3,
                        pE = 1.0, bare = FALSE)$b #Moisture effects per month
xi.frame_VMC3=data.frame(years,rep(fT_VMC3*fW_VMC3,length.out=length(years)))

#To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
Model_VMC3=SoilR::RothCModel(
  t=years, #Simulation Length
  ks=c(k.DPM = 10*CTRM, k.RPM = 0.3*CTRM, k.BIO = 0.66*CTRM, k.HUM = 0.02*CTRM, k.IOM = 0*CTRM), #Decomposition rates for the different pools
  C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
  In=Scalar_LitterCinputs*0, #Amount of litter inputs by time
  FYM = Scalar_ManureCinputs*1, #Amount of Farm Yard Manure by time
  clay=clay100*0.3, #Percent clay in mineral soil
  xi=xi.frame_VMC3) #Loads the model

Ct_VMC3=getC(Model_VMC3) #Calculates stocks for each pool per month

#The results can be plotted with the commands
matplot(years, Ct_VMC3, type="l", lty=1, col=1:5,
        xlab="Time (years)", ylab="C stocks (Mg/ha)")
legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
       lty=1, col=1:5, bty="n")

VEC_Lit_VMC3 <- rep(M_Scalar_LitterCinputs*0, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
VEC_Man_VMC3 <- rep(M_Scalar_ManureCinputs*1, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

VEC_LitDF_VMC3 <- as.data.frame(VEC_Lit_VMC3) #Converting the Litter vector to a data frame
VEC_LitDF_VMC3$MNumber <- seq(from = 1, to = SimulationLength_months)
VEC_ManDF_VMC3 <- as.data.frame(VEC_Man_VMC3) #Converting the Manure vector to a data frame
VEC_ManDF_VMC3$MNumber <- seq(from = 1, to = SimulationLength_months)

sapply(VEC_LitDF_VMC3, class) #Check that class is numeric
sapply(VEC_ManDF_VMC3, class) #Check that class is numeric
LitterCinputs_VMC3=VEC_LitDF_VMC3   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
ManureCinputs_VMC3=VEC_ManDF_VMC3 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
MCinputs_VMC3 <- merge(LitterCinputs_VMC3, ManureCinputs_VMC3, by = "MNumber")
MCinputs_VMC3$MInput_VMC3 <- MCinputs_VMC3$VEC_Lit_VMC3 + MCinputs_VMC3$VEC_Man_VMC3

#Change names of litter and manure columns for more common ones
colnames(MCinputs_VMC3)[which(names(MCinputs_VMC3) == "VEC_Lit_VMC3")] <- "LitterC_VMC3"
colnames(MCinputs_VMC3)[which(names(MCinputs_VMC3) == "VEC_Man_VMC3")] <- "ManureC_VMC3"

#Create a dataframe with the data considering the simulation length
ModelDF_VMC3 <- as.data.frame(Ct_VMC3)
colnames(ModelDF_VMC3) <- c('DPM_VMC3','RPM_VMC3','BIO_VMC3', 'HUM_VMC3', 'IOM_VMC3')
ModelDFS_VMC3 <- ModelDF_VMC3[1:SimulationLength_months, ]

#Create a column with the number of month of analysis
ModelDFS_VMC3$MNumber <- seq(from = 1, to = SimulationLength_months)

#Create a column that sums all pools
ModelDFS_VMC3$AllPools_VMC3 <- ModelDFS_VMC3$DPM_VMC3 + ModelDFS_VMC3$RPM_VMC3 + ModelDFS_VMC3$BIO_VMC3 + ModelDFS_VMC3$HUM_VMC3 + ModelDFS_VMC3$IOM_VMC3

#Create a column that sums all pools except IOM (static)
ModelDFS_VMC3$AllPools_noIOM_VMC3 <- ModelDFS_VMC3$DPM_VMC3 + ModelDFS_VMC3$RPM_VMC3 + ModelDFS_VMC3$BIO_VMC3 + ModelDFS_VMC3$HUM_VMC3

#Create a column that add the monthly input of C (manure and litter separately)
ModelDFSL_VMC3 <- merge(ModelDFS_VMC3, MCinputs_VMC3, by = "MNumber")

ModelDFSL_VMC3$MInput_VMC3 <- ModelDFSL_VMC3$LitterC_VMC3 + ModelDFSL_VMC3$ManureC_VMC3
#ModelDF_SL$MInput[1] <- 0

#Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
ModelDFSL_VMC3$CTails_VMC3 <- ModelDFSL_VMC3$AllPools_noIOM_VMC3 + ModelDFSL_VMC3$MInput_VMC3

#Create Monthly Accumulated input of C
ModelDFSL_VMC3$AccumInput_VMC3 = ModelDFSL_VMC3$AccumInput_VMC3=cumsum(ModelDFSL_VMC3$MInput_VMC3)

#Create Monthly Growths for each carbon pool
ModelDFSL_VMC3$MGrowth_DPM_VMC3 <- ave(ModelDFSL_VMC3$DPM_VMC3, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMC3$MGrowth_RPM_VMC3 <- ave(ModelDFSL_VMC3$RPM_VMC3, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMC3$MGrowth_BIO_VMC3 <- ave(ModelDFSL_VMC3$BIO_VMC3, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMC3$MGrowth_HUM_VMC3 <- ave(ModelDFSL_VMC3$HUM_VMC3, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMC3$MGrowth_IOM_VMC3 <- ave(ModelDFSL_VMC3$IOM_VMC3, FUN = function(x) c(0, diff(x)))

#Create column for Monthly and Accumulated C-CO2 emissions
ModelDFSL_VMC3$M_CCO2_VMC3 <- ModelDFSL_VMC3$MInput_VMC3 - ModelDFSL_VMC3$MGrowth_DPM_VMC3 - ModelDFSL_VMC3$MGrowth_RPM_VMC3 - ModelDFSL_VMC3$MGrowth_BIO_VMC3 - ModelDFSL_VMC3$MGrowth_HUM_VMC3
ModelDFSL_VMC3$Accum_CCO2_VMC3 <- ModelDFSL_VMC3$AccumInput_VMC3 - ModelDFSL_VMC3$AllPools_noIOM_VMC3

#Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
ModelDFSL_VMC3$M_CCO2_VMC3[1] <- 0
ModelDFSL_VMC3$Accum_CCO2_VMC3[1] <- 0

#Balance validation
ModelDFSL_VMC3$Balance_VMC3 <- ModelDFSL_VMC3$AccumInput_VMC3 - ModelDFSL_VMC3$Accum_CCO2_VMC3 - (ModelDFSL_VMC3$DPM_VMC3 + ModelDFSL_VMC3$RPM_VMC3 + ModelDFSL_VMC3$BIO_VMC3 + ModelDFSL_VMC3$HUM_VMC3)

#Convert C-CO2 emissions into CO2 emissions
ModelDFSL_VMC3$M_CO2_VMC3 <- ModelDFSL_VMC3$M_CCO2_VMC3 * 44/12
ModelDFSL_VMC3$Accum_CO2_VMC3 <- ModelDFSL_VMC3$Accum_CCO2_VMC3 * 44/12

#This model will be called VMC3C because implies a continuous input of C
ModelDFSL_VMC3C <- ModelDFSL_VMC3

#Export the dataframe
write_xlsx(ModelDFSL_VMC3C,"VXC_Models\\ModelDFSL_R_VMC3C.xlsx")

#Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
#Create two equal models by using the above general script
#Create model t=x
ModelDFSLt0_VMC3 <- ModelDFSL_VMC3 #Create model t=x

#Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
ModelDFSLt1_VMC3.1 <- rbind(c(0:0), ModelDFSLt0_VMC3)
ModelDFSLt1_VMC3.2 <- rbind(c(0:0), ModelDFSLt1_VMC3.1)
ModelDFSLt1_VMC3.3 <- rbind(c(0:0), ModelDFSLt1_VMC3.2)
ModelDFSLt1_VMC3.4 <- rbind(c(0:0), ModelDFSLt1_VMC3.3)
ModelDFSLt1_VMC3.5 <- rbind(c(0:0), ModelDFSLt1_VMC3.4)
ModelDFSLt1_VMC3.6 <- rbind(c(0:0), ModelDFSLt1_VMC3.5)
ModelDFSLt1_VMC3.7 <- rbind(c(0:0), ModelDFSLt1_VMC3.6)
ModelDFSLt1_VMC3.8 <- rbind(c(0:0), ModelDFSLt1_VMC3.7)
ModelDFSLt1_VMC3.9 <- rbind(c(0:0), ModelDFSLt1_VMC3.8)
ModelDFSLt1_VMC3.10 <- rbind(c(0:0), ModelDFSLt1_VMC3.9)
ModelDFSLt1_VMC3.11 <- rbind(c(0:0), ModelDFSLt1_VMC3.10)
ModelDFSLt1_VMC3.12 <- rbind(c(0:0), ModelDFSLt1_VMC3.11)
ModelDFSLt1_VMC3.13 <- ModelDFSLt1_VMC3.12[-nrow(ModelDFSLt1_VMC3.12),]
ModelDFSLt1_VMC3.14 <- ModelDFSLt1_VMC3.13[-nrow(ModelDFSLt1_VMC3.13),]
ModelDFSLt1_VMC3.15 <- ModelDFSLt1_VMC3.14[-nrow(ModelDFSLt1_VMC3.14),]
ModelDFSLt1_VMC3.16 <- ModelDFSLt1_VMC3.15[-nrow(ModelDFSLt1_VMC3.15),]
ModelDFSLt1_VMC3.17 <- ModelDFSLt1_VMC3.16[-nrow(ModelDFSLt1_VMC3.16),]
ModelDFSLt1_VMC3.18 <- ModelDFSLt1_VMC3.17[-nrow(ModelDFSLt1_VMC3.17),]
ModelDFSLt1_VMC3.19 <- ModelDFSLt1_VMC3.18[-nrow(ModelDFSLt1_VMC3.18),]
ModelDFSLt1_VMC3.20 <- ModelDFSLt1_VMC3.19[-nrow(ModelDFSLt1_VMC3.19),]
ModelDFSLt1_VMC3.21 <- ModelDFSLt1_VMC3.20[-nrow(ModelDFSLt1_VMC3.20),]
ModelDFSLt1_VMC3.22 <- ModelDFSLt1_VMC3.21[-nrow(ModelDFSLt1_VMC3.21),]
ModelDFSLt1_VMC3.23 <- ModelDFSLt1_VMC3.22[-nrow(ModelDFSLt1_VMC3.22),]
ModelDFSLt1_VMC3.24 <- ModelDFSLt1_VMC3.23[-nrow(ModelDFSLt1_VMC3.23),]

ModelDFSLt1_VMC3 <- ModelDFSLt1_VMC3.24 #Create model t=x+1

#Subtract model (t=x) - (t=x+1)
ModelDFSL1y_VMC3 <- ModelDFSLt0_VMC3 - ModelDFSLt1_VMC3

#Re-do Month Number column because the substraction was also applied to it
ModelDFSL1y_VMC3$MNumber <- seq(from = 1, to = SimulationLength_months)

#This model will be called VMC3P because implies a one-off input of C
ModelDFSL_VMC3P <- ModelDFSL1y_VMC3

#Export the dataframe
write_xlsx(ModelDFSL_VMC3P,"VXP_Models\\ModelDFSL_R_VMC3P.xlsx")

#Plot 3: Interactive Yearly CO2 emissions #
MY <- 12
ModelDFSL_VMC3P_YCO2 <- ModelDFSL_VMC3P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VMC3)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMC3P_YCO2) <- c("Year", "Months", "AnnualCO2_VMC_3")

#Plot 3: Interactive Yearly CO2 emissions considering a delay
GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
ModelDFSL_VMC3P_YCO2D <- merge(ModelDFSL_VMC3P_YCO2, GWP100delay, by = "Year")
ModelDFSL_VMC3P_YCO2D$AnnualCO2D_VMC_3 <- ModelDFSL_VMC3P_YCO2D$AnnualCO2_VMC_3 * ModelDFSL_VMC3P_YCO2D$GWP100

#Plot 4: Interactive Yearly C emissions #
MY <- 12
ModelDFSL_VMC3P_YC <- ModelDFSL_VMC3P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VMC3)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMC3P_YC) <- c("Year", "Months", "CEmissions_VMC_3")

#Plot 5: Interactive Yearly C tails (remaining C in Soil) #
MY <- 12
ModelDFSL_VMC3P_YCT <- ModelDFSL_VMC3P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VMC3)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMC3P_YCT) <- c("Year", "Months", "CTail_VMC_3")

#Save Dataframes for Plots 3.1, 3.2, 4 and 5
write_xlsx(ModelDFSL_VMC3P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VMC3P.xlsx") #Yearly CO2 emissions (no delay)
write_xlsx(ModelDFSL_VMC3P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VMC3P.xlsx") #Yearly CO2 emissions (delay)
write_xlsx(ModelDFSL_VMC3P_YC,"CEmissions_P\\ModelDFSL_R_CE_VMC3P.xlsx") #Yearly C emissions
write_xlsx(ModelDFSL_VMC3P_YCT,"CTails_P\\ModelDFSL_R_CT_VMC3P.xlsx") #Yearly C emissions



#### 10.5 - VMC4) Manure; 40%clay; Conventional tillage ####
#The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
fT_VMC4=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
fW_VMC4=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                        S.Thick = soil.thick, pClay = clay100*0.4,
                        pE = 1.0, bare = FALSE)$b #Moisture effects per month
xi.frame_VMC4=data.frame(years,rep(fT_VMC4*fW_VMC4,length.out=length(years)))

#To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
Model_VMC4=SoilR::RothCModel(
  t=years, #Simulation Length
  ks=c(k.DPM = 10*CTRM, k.RPM = 0.3*CTRM, k.BIO = 0.66*CTRM, k.HUM = 0.02*CTRM, k.IOM = 0*CTRM), #Decomposition rates for the different pools
  C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
  In=Scalar_LitterCinputs*0, #Amount of litter inputs by time
  FYM = Scalar_ManureCinputs*1, #Amount of Farm Yard Manure by time
  clay=clay100*0.4, #Percent clay in mineral soil
  xi=xi.frame_VMC4) #Loads the model

Ct_VMC4=getC(Model_VMC4) #Calculates stocks for each pool per month

#The results can be plotted with the commands
matplot(years, Ct_VMC4, type="l", lty=1, col=1:5,
        xlab="Time (years)", ylab="C stocks (Mg/ha)")
legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
       lty=1, col=1:5, bty="n")

VEC_Lit_VMC4 <- rep(M_Scalar_LitterCinputs*0, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
VEC_Man_VMC4 <- rep(M_Scalar_ManureCinputs*1, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

VEC_LitDF_VMC4 <- as.data.frame(VEC_Lit_VMC4) #Converting the Litter vector to a data frame
VEC_LitDF_VMC4$MNumber <- seq(from = 1, to = SimulationLength_months)
VEC_ManDF_VMC4 <- as.data.frame(VEC_Man_VMC4) #Converting the Manure vector to a data frame
VEC_ManDF_VMC4$MNumber <- seq(from = 1, to = SimulationLength_months)

sapply(VEC_LitDF_VMC4, class) #Check that class is numeric
sapply(VEC_ManDF_VMC4, class) #Check that class is numeric
LitterCinputs_VMC4=VEC_LitDF_VMC4   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
ManureCinputs_VMC4=VEC_ManDF_VMC4 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
MCinputs_VMC4 <- merge(LitterCinputs_VMC4, ManureCinputs_VMC4, by = "MNumber")
MCinputs_VMC4$MInput_VMC4 <- MCinputs_VMC4$VEC_Lit_VMC4 + MCinputs_VMC4$VEC_Man_VMC4

#Change names of litter and manure columns for more common ones
colnames(MCinputs_VMC4)[which(names(MCinputs_VMC4) == "VEC_Lit_VMC4")] <- "LitterC_VMC4"
colnames(MCinputs_VMC4)[which(names(MCinputs_VMC4) == "VEC_Man_VMC4")] <- "ManureC_VMC4"

#Create a dataframe with the data considering the simulation length
ModelDF_VMC4 <- as.data.frame(Ct_VMC4)
colnames(ModelDF_VMC4) <- c('DPM_VMC4','RPM_VMC4','BIO_VMC4', 'HUM_VMC4', 'IOM_VMC4')
ModelDFS_VMC4 <- ModelDF_VMC4[1:SimulationLength_months, ]

#Create a column with the number of month of analysis
ModelDFS_VMC4$MNumber <- seq(from = 1, to = SimulationLength_months)

#Create a column that sums all pools
ModelDFS_VMC4$AllPools_VMC4 <- ModelDFS_VMC4$DPM_VMC4 + ModelDFS_VMC4$RPM_VMC4 + ModelDFS_VMC4$BIO_VMC4 + ModelDFS_VMC4$HUM_VMC4 + ModelDFS_VMC4$IOM_VMC4

#Create a column that sums all pools except IOM (static)
ModelDFS_VMC4$AllPools_noIOM_VMC4 <- ModelDFS_VMC4$DPM_VMC4 + ModelDFS_VMC4$RPM_VMC4 + ModelDFS_VMC4$BIO_VMC4 + ModelDFS_VMC4$HUM_VMC4

#Create a column that add the monthly input of C (manure and litter separately)
ModelDFSL_VMC4 <- merge(ModelDFS_VMC4, MCinputs_VMC4, by = "MNumber")

ModelDFSL_VMC4$MInput_VMC4 <- ModelDFSL_VMC4$LitterC_VMC4 + ModelDFSL_VMC4$ManureC_VMC4
#ModelDF_SL$MInput[1] <- 0

#Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
ModelDFSL_VMC4$CTails_VMC4 <- ModelDFSL_VMC4$AllPools_noIOM_VMC4 + ModelDFSL_VMC4$MInput_VMC4

#Create Monthly Accumulated input of C
ModelDFSL_VMC4$AccumInput_VMC4 = ModelDFSL_VMC4$AccumInput_VMC4=cumsum(ModelDFSL_VMC4$MInput_VMC4)

#Create Monthly Growths for each carbon pool
ModelDFSL_VMC4$MGrowth_DPM_VMC4 <- ave(ModelDFSL_VMC4$DPM_VMC4, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMC4$MGrowth_RPM_VMC4 <- ave(ModelDFSL_VMC4$RPM_VMC4, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMC4$MGrowth_BIO_VMC4 <- ave(ModelDFSL_VMC4$BIO_VMC4, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMC4$MGrowth_HUM_VMC4 <- ave(ModelDFSL_VMC4$HUM_VMC4, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMC4$MGrowth_IOM_VMC4 <- ave(ModelDFSL_VMC4$IOM_VMC4, FUN = function(x) c(0, diff(x)))

#Create column for Monthly and Accumulated C-CO2 emissions
ModelDFSL_VMC4$M_CCO2_VMC4 <- ModelDFSL_VMC4$MInput_VMC4 - ModelDFSL_VMC4$MGrowth_DPM_VMC4 - ModelDFSL_VMC4$MGrowth_RPM_VMC4 - ModelDFSL_VMC4$MGrowth_BIO_VMC4 - ModelDFSL_VMC4$MGrowth_HUM_VMC4
ModelDFSL_VMC4$Accum_CCO2_VMC4 <- ModelDFSL_VMC4$AccumInput_VMC4 - ModelDFSL_VMC4$AllPools_noIOM_VMC4

#Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
ModelDFSL_VMC4$M_CCO2_VMC4[1] <- 0
ModelDFSL_VMC4$Accum_CCO2_VMC4[1] <- 0

#Balance validation
ModelDFSL_VMC4$Balance_VMC4 <- ModelDFSL_VMC4$AccumInput_VMC4 - ModelDFSL_VMC4$Accum_CCO2_VMC4 - (ModelDFSL_VMC4$DPM_VMC4 + ModelDFSL_VMC4$RPM_VMC4 + ModelDFSL_VMC4$BIO_VMC4 + ModelDFSL_VMC4$HUM_VMC4)

#Convert C-CO2 emissions into CO2 emissions
ModelDFSL_VMC4$M_CO2_VMC4 <- ModelDFSL_VMC4$M_CCO2_VMC4 * 44/12
ModelDFSL_VMC4$Accum_CO2_VMC4 <- ModelDFSL_VMC4$Accum_CCO2_VMC4 * 44/12

#This model will be called VMC4C because implies a continuous input of C
ModelDFSL_VMC4C <- ModelDFSL_VMC4

#Export the dataframe
write_xlsx(ModelDFSL_VMC4C,"VXC_Models\\ModelDFSL_R_VMC4C.xlsx")

#Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
#Create two equal models by using the above general script
#Create model t=x
ModelDFSLt0_VMC4 <- ModelDFSL_VMC4 #Create model t=x

#Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
ModelDFSLt1_VMC4.1 <- rbind(c(0:0), ModelDFSLt0_VMC4)
ModelDFSLt1_VMC4.2 <- rbind(c(0:0), ModelDFSLt1_VMC4.1)
ModelDFSLt1_VMC4.3 <- rbind(c(0:0), ModelDFSLt1_VMC4.2)
ModelDFSLt1_VMC4.4 <- rbind(c(0:0), ModelDFSLt1_VMC4.3)
ModelDFSLt1_VMC4.5 <- rbind(c(0:0), ModelDFSLt1_VMC4.4)
ModelDFSLt1_VMC4.6 <- rbind(c(0:0), ModelDFSLt1_VMC4.5)
ModelDFSLt1_VMC4.7 <- rbind(c(0:0), ModelDFSLt1_VMC4.6)
ModelDFSLt1_VMC4.8 <- rbind(c(0:0), ModelDFSLt1_VMC4.7)
ModelDFSLt1_VMC4.9 <- rbind(c(0:0), ModelDFSLt1_VMC4.8)
ModelDFSLt1_VMC4.10 <- rbind(c(0:0), ModelDFSLt1_VMC4.9)
ModelDFSLt1_VMC4.11 <- rbind(c(0:0), ModelDFSLt1_VMC4.10)
ModelDFSLt1_VMC4.12 <- rbind(c(0:0), ModelDFSLt1_VMC4.11)
ModelDFSLt1_VMC4.13 <- ModelDFSLt1_VMC4.12[-nrow(ModelDFSLt1_VMC4.12),]
ModelDFSLt1_VMC4.14 <- ModelDFSLt1_VMC4.13[-nrow(ModelDFSLt1_VMC4.13),]
ModelDFSLt1_VMC4.15 <- ModelDFSLt1_VMC4.14[-nrow(ModelDFSLt1_VMC4.14),]
ModelDFSLt1_VMC4.16 <- ModelDFSLt1_VMC4.15[-nrow(ModelDFSLt1_VMC4.15),]
ModelDFSLt1_VMC4.17 <- ModelDFSLt1_VMC4.16[-nrow(ModelDFSLt1_VMC4.16),]
ModelDFSLt1_VMC4.18 <- ModelDFSLt1_VMC4.17[-nrow(ModelDFSLt1_VMC4.17),]
ModelDFSLt1_VMC4.19 <- ModelDFSLt1_VMC4.18[-nrow(ModelDFSLt1_VMC4.18),]
ModelDFSLt1_VMC4.20 <- ModelDFSLt1_VMC4.19[-nrow(ModelDFSLt1_VMC4.19),]
ModelDFSLt1_VMC4.21 <- ModelDFSLt1_VMC4.20[-nrow(ModelDFSLt1_VMC4.20),]
ModelDFSLt1_VMC4.22 <- ModelDFSLt1_VMC4.21[-nrow(ModelDFSLt1_VMC4.21),]
ModelDFSLt1_VMC4.23 <- ModelDFSLt1_VMC4.22[-nrow(ModelDFSLt1_VMC4.22),]
ModelDFSLt1_VMC4.24 <- ModelDFSLt1_VMC4.23[-nrow(ModelDFSLt1_VMC4.23),]

ModelDFSLt1_VMC4 <- ModelDFSLt1_VMC4.24 #Create model t=x+1

#Subtract model (t=x) - (t=x+1)
ModelDFSL1y_VMC4 <- ModelDFSLt0_VMC4 - ModelDFSLt1_VMC4

#Re-do Month Number column because the substraction was also applied to it
ModelDFSL1y_VMC4$MNumber <- seq(from = 1, to = SimulationLength_months)

#This model will be called VMC4P because implies a one-off input of C
ModelDFSL_VMC4P <- ModelDFSL1y_VMC4

#Export the dataframe
write_xlsx(ModelDFSL_VMC4P,"VXP_Models\\ModelDFSL_R_VMC4P.xlsx")

#Plot 3: Interactive Yearly CO2 emissions #
MY <- 12
ModelDFSL_VMC4P_YCO2 <- ModelDFSL_VMC4P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VMC4)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMC4P_YCO2) <- c("Year", "Months", "AnnualCO2_VMC_4")

#Plot 3: Interactive Yearly CO2 emissions considering a delay
GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
ModelDFSL_VMC4P_YCO2D <- merge(ModelDFSL_VMC4P_YCO2, GWP100delay, by = "Year")
ModelDFSL_VMC4P_YCO2D$AnnualCO2D_VMC_4 <- ModelDFSL_VMC4P_YCO2D$AnnualCO2_VMC_4 * ModelDFSL_VMC4P_YCO2D$GWP100

#Plot 4: Interactive Yearly C emissions #
MY <- 12
ModelDFSL_VMC4P_YC <- ModelDFSL_VMC4P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VMC4)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMC4P_YC) <- c("Year", "Months", "CEmissions_VMC_4")

#Plot 5: Interactive Yearly C tails (remaining C in Soil) #
MY <- 12
ModelDFSL_VMC4P_YCT <- ModelDFSL_VMC4P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VMC4)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMC4P_YCT) <- c("Year", "Months", "CTail_VMC_4")

#Save Dataframes for Plots 3.1, 3.2, 4 and 5
write_xlsx(ModelDFSL_VMC4P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VMC4P.xlsx") #Yearly CO2 emissions (no delay)
write_xlsx(ModelDFSL_VMC4P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VMC4P.xlsx") #Yearly CO2 emissions (delay)
write_xlsx(ModelDFSL_VMC4P_YC,"CEmissions_P\\ModelDFSL_R_CE_VMC4P.xlsx") #Yearly C emissions
write_xlsx(ModelDFSL_VMC4P_YCT,"CTails_P\\ModelDFSL_R_CT_VMC4P.xlsx") #Yearly C emissions



#### 10.6 - VMC5) Manure; 50%clay; Conventional tillage ####
#The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
fT_VMC5=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
fW_VMC5=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                        S.Thick = soil.thick, pClay = clay100*0.5,
                        pE = 1.0, bare = FALSE)$b #Moisture effects per month
xi.frame_VMC5=data.frame(years,rep(fT_VMC5*fW_VMC5,length.out=length(years)))

#To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
Model_VMC5=SoilR::RothCModel(
  t=years, #Simulation Length
  ks=c(k.DPM = 10*CTRM, k.RPM = 0.3*CTRM, k.BIO = 0.66*CTRM, k.HUM = 0.02*CTRM, k.IOM = 0*CTRM), #Decomposition rates for the different pools
  C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
  In=Scalar_LitterCinputs*0, #Amount of litter inputs by time
  FYM = Scalar_ManureCinputs*1, #Amount of Farm Yard Manure by time
  clay=clay100*0.5, #Percent clay in mineral soil
  xi=xi.frame_VMC5) #Loads the model

Ct_VMC5=getC(Model_VMC5) #Calculates stocks for each pool per month

#The results can be plotted with the commands
matplot(years, Ct_VMC5, type="l", lty=1, col=1:5,
        xlab="Time (years)", ylab="C stocks (Mg/ha)")
legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
       lty=1, col=1:5, bty="n")

VEC_Lit_VMC5 <- rep(M_Scalar_LitterCinputs*0, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
VEC_Man_VMC5 <- rep(M_Scalar_ManureCinputs*1, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

VEC_LitDF_VMC5 <- as.data.frame(VEC_Lit_VMC5) #Converting the Litter vector to a data frame
VEC_LitDF_VMC5$MNumber <- seq(from = 1, to = SimulationLength_months)
VEC_ManDF_VMC5 <- as.data.frame(VEC_Man_VMC5) #Converting the Manure vector to a data frame
VEC_ManDF_VMC5$MNumber <- seq(from = 1, to = SimulationLength_months)

sapply(VEC_LitDF_VMC5, class) #Check that class is numeric
sapply(VEC_ManDF_VMC5, class) #Check that class is numeric
LitterCinputs_VMC5=VEC_LitDF_VMC5   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
ManureCinputs_VMC5=VEC_ManDF_VMC5 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
MCinputs_VMC5 <- merge(LitterCinputs_VMC5, ManureCinputs_VMC5, by = "MNumber")
MCinputs_VMC5$MInput_VMC5 <- MCinputs_VMC5$VEC_Lit_VMC5 + MCinputs_VMC5$VEC_Man_VMC5

#Change names of litter and manure columns for more common ones
colnames(MCinputs_VMC5)[which(names(MCinputs_VMC5) == "VEC_Lit_VMC5")] <- "LitterC_VMC5"
colnames(MCinputs_VMC5)[which(names(MCinputs_VMC5) == "VEC_Man_VMC5")] <- "ManureC_VMC5"

#Create a dataframe with the data considering the simulation length
ModelDF_VMC5 <- as.data.frame(Ct_VMC5)
colnames(ModelDF_VMC5) <- c('DPM_VMC5','RPM_VMC5','BIO_VMC5', 'HUM_VMC5', 'IOM_VMC5')
ModelDFS_VMC5 <- ModelDF_VMC5[1:SimulationLength_months, ]

#Create a column with the number of month of analysis
ModelDFS_VMC5$MNumber <- seq(from = 1, to = SimulationLength_months)

#Create a column that sums all pools
ModelDFS_VMC5$AllPools_VMC5 <- ModelDFS_VMC5$DPM_VMC5 + ModelDFS_VMC5$RPM_VMC5 + ModelDFS_VMC5$BIO_VMC5 + ModelDFS_VMC5$HUM_VMC5 + ModelDFS_VMC5$IOM_VMC5

#Create a column that sums all pools except IOM (static)
ModelDFS_VMC5$AllPools_noIOM_VMC5 <- ModelDFS_VMC5$DPM_VMC5 + ModelDFS_VMC5$RPM_VMC5 + ModelDFS_VMC5$BIO_VMC5 + ModelDFS_VMC5$HUM_VMC5

#Create a column that add the monthly input of C (manure and litter separately)
ModelDFSL_VMC5 <- merge(ModelDFS_VMC5, MCinputs_VMC5, by = "MNumber")

ModelDFSL_VMC5$MInput_VMC5 <- ModelDFSL_VMC5$LitterC_VMC5 + ModelDFSL_VMC5$ManureC_VMC5
#ModelDF_SL$MInput[1] <- 0

#Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
ModelDFSL_VMC5$CTails_VMC5 <- ModelDFSL_VMC5$AllPools_noIOM_VMC5 + ModelDFSL_VMC5$MInput_VMC5

#Create Monthly Accumulated input of C
ModelDFSL_VMC5$AccumInput_VMC5 = ModelDFSL_VMC5$AccumInput_VMC5=cumsum(ModelDFSL_VMC5$MInput_VMC5)

#Create Monthly Growths for each carbon pool
ModelDFSL_VMC5$MGrowth_DPM_VMC5 <- ave(ModelDFSL_VMC5$DPM_VMC5, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMC5$MGrowth_RPM_VMC5 <- ave(ModelDFSL_VMC5$RPM_VMC5, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMC5$MGrowth_BIO_VMC5 <- ave(ModelDFSL_VMC5$BIO_VMC5, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMC5$MGrowth_HUM_VMC5 <- ave(ModelDFSL_VMC5$HUM_VMC5, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMC5$MGrowth_IOM_VMC5 <- ave(ModelDFSL_VMC5$IOM_VMC5, FUN = function(x) c(0, diff(x)))

#Create column for Monthly and Accumulated C-CO2 emissions
ModelDFSL_VMC5$M_CCO2_VMC5 <- ModelDFSL_VMC5$MInput_VMC5 - ModelDFSL_VMC5$MGrowth_DPM_VMC5 - ModelDFSL_VMC5$MGrowth_RPM_VMC5 - ModelDFSL_VMC5$MGrowth_BIO_VMC5 - ModelDFSL_VMC5$MGrowth_HUM_VMC5
ModelDFSL_VMC5$Accum_CCO2_VMC5 <- ModelDFSL_VMC5$AccumInput_VMC5 - ModelDFSL_VMC5$AllPools_noIOM_VMC5

#Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
ModelDFSL_VMC5$M_CCO2_VMC5[1] <- 0
ModelDFSL_VMC5$Accum_CCO2_VMC5[1] <- 0

#Balance validation
ModelDFSL_VMC5$Balance_VMC5 <- ModelDFSL_VMC5$AccumInput_VMC5 - ModelDFSL_VMC5$Accum_CCO2_VMC5 - (ModelDFSL_VMC5$DPM_VMC5 + ModelDFSL_VMC5$RPM_VMC5 + ModelDFSL_VMC5$BIO_VMC5 + ModelDFSL_VMC5$HUM_VMC5)

#Convert C-CO2 emissions into CO2 emissions
ModelDFSL_VMC5$M_CO2_VMC5 <- ModelDFSL_VMC5$M_CCO2_VMC5 * 44/12
ModelDFSL_VMC5$Accum_CO2_VMC5 <- ModelDFSL_VMC5$Accum_CCO2_VMC5 * 44/12

#This model will be called VMC5C because implies a continuous input of C
ModelDFSL_VMC5C <- ModelDFSL_VMC5

#Export the dataframe
write_xlsx(ModelDFSL_VMC5C,"VXC_Models\\ModelDFSL_R_VMC5C.xlsx")

#Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
#Create two equal models by using the above general script
#Create model t=x
ModelDFSLt0_VMC5 <- ModelDFSL_VMC5 #Create model t=x

#Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
ModelDFSLt1_VMC5.1 <- rbind(c(0:0), ModelDFSLt0_VMC5)
ModelDFSLt1_VMC5.2 <- rbind(c(0:0), ModelDFSLt1_VMC5.1)
ModelDFSLt1_VMC5.3 <- rbind(c(0:0), ModelDFSLt1_VMC5.2)
ModelDFSLt1_VMC5.4 <- rbind(c(0:0), ModelDFSLt1_VMC5.3)
ModelDFSLt1_VMC5.5 <- rbind(c(0:0), ModelDFSLt1_VMC5.4)
ModelDFSLt1_VMC5.6 <- rbind(c(0:0), ModelDFSLt1_VMC5.5)
ModelDFSLt1_VMC5.7 <- rbind(c(0:0), ModelDFSLt1_VMC5.6)
ModelDFSLt1_VMC5.8 <- rbind(c(0:0), ModelDFSLt1_VMC5.7)
ModelDFSLt1_VMC5.9 <- rbind(c(0:0), ModelDFSLt1_VMC5.8)
ModelDFSLt1_VMC5.10 <- rbind(c(0:0), ModelDFSLt1_VMC5.9)
ModelDFSLt1_VMC5.11 <- rbind(c(0:0), ModelDFSLt1_VMC5.10)
ModelDFSLt1_VMC5.12 <- rbind(c(0:0), ModelDFSLt1_VMC5.11)
ModelDFSLt1_VMC5.13 <- ModelDFSLt1_VMC5.12[-nrow(ModelDFSLt1_VMC5.12),]
ModelDFSLt1_VMC5.14 <- ModelDFSLt1_VMC5.13[-nrow(ModelDFSLt1_VMC5.13),]
ModelDFSLt1_VMC5.15 <- ModelDFSLt1_VMC5.14[-nrow(ModelDFSLt1_VMC5.14),]
ModelDFSLt1_VMC5.16 <- ModelDFSLt1_VMC5.15[-nrow(ModelDFSLt1_VMC5.15),]
ModelDFSLt1_VMC5.17 <- ModelDFSLt1_VMC5.16[-nrow(ModelDFSLt1_VMC5.16),]
ModelDFSLt1_VMC5.18 <- ModelDFSLt1_VMC5.17[-nrow(ModelDFSLt1_VMC5.17),]
ModelDFSLt1_VMC5.19 <- ModelDFSLt1_VMC5.18[-nrow(ModelDFSLt1_VMC5.18),]
ModelDFSLt1_VMC5.20 <- ModelDFSLt1_VMC5.19[-nrow(ModelDFSLt1_VMC5.19),]
ModelDFSLt1_VMC5.21 <- ModelDFSLt1_VMC5.20[-nrow(ModelDFSLt1_VMC5.20),]
ModelDFSLt1_VMC5.22 <- ModelDFSLt1_VMC5.21[-nrow(ModelDFSLt1_VMC5.21),]
ModelDFSLt1_VMC5.23 <- ModelDFSLt1_VMC5.22[-nrow(ModelDFSLt1_VMC5.22),]
ModelDFSLt1_VMC5.24 <- ModelDFSLt1_VMC5.23[-nrow(ModelDFSLt1_VMC5.23),]

ModelDFSLt1_VMC5 <- ModelDFSLt1_VMC5.24 #Create model t=x+1

#Subtract model (t=x) - (t=x+1)
ModelDFSL1y_VMC5 <- ModelDFSLt0_VMC5 - ModelDFSLt1_VMC5

#Re-do Month Number column because the substraction was also applied to it
ModelDFSL1y_VMC5$MNumber <- seq(from = 1, to = SimulationLength_months)

#This model will be called VMC5P because implies a one-off input of C
ModelDFSL_VMC5P <- ModelDFSL1y_VMC5

#Export the dataframe
write_xlsx(ModelDFSL_VMC5P,"VXP_Models\\ModelDFSL_R_VMC5P.xlsx")


#Plot 3: Interactive Yearly CO2 emissions #
MY <- 12
ModelDFSL_VMC5P_YCO2 <- ModelDFSL_VMC5P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VMC5)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMC5P_YCO2) <- c("Year", "Months", "AnnualCO2_VMC_5")


#Plot 3: Interactive Yearly CO2 emissions considering a delay
GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
ModelDFSL_VMC5P_YCO2D <- merge(ModelDFSL_VMC5P_YCO2, GWP100delay, by = "Year")
ModelDFSL_VMC5P_YCO2D$AnnualCO2D_VMC_5 <- ModelDFSL_VMC5P_YCO2D$AnnualCO2_VMC_5 * ModelDFSL_VMC5P_YCO2D$GWP100

#Plot 4: Interactive Yearly C emissions #
MY <- 12
ModelDFSL_VMC5P_YC <- ModelDFSL_VMC5P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VMC5)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMC5P_YC) <- c("Year", "Months", "CEmissions_VMC_5")


#Plot 5: Interactive Yearly C tails (remaining C in Soil) #
MY <- 12
ModelDFSL_VMC5P_YCT <- ModelDFSL_VMC5P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VMC5)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMC5P_YCT) <- c("Year", "Months", "CTail_VMC_5")

#Save Dataframes for Plots 3.1, 3.2, 4 and 5
write_xlsx(ModelDFSL_VMC5P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VMC5P.xlsx") #Yearly CO2 emissions (no delay)
write_xlsx(ModelDFSL_VMC5P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VMC5P.xlsx") #Yearly CO2 emissions (delay)
write_xlsx(ModelDFSL_VMC5P_YC,"CEmissions_P\\ModelDFSL_R_CE_VMC5P.xlsx") #Yearly C emissions
write_xlsx(ModelDFSL_VMC5P_YCT,"CTails_P\\ModelDFSL_R_CT_VMC5P.xlsx") #Yearly C emissions



#### 10.7 - VMC6) Manure; 60%clay; Conventional tillage ####
#The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
fT_VMC6=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
fW_VMC6=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                        S.Thick = soil.thick, pClay = clay100*0.6,
                        pE = 1.0, bare = FALSE)$b #Moisture effects per month
xi.frame_VMC6=data.frame(years,rep(fT_VMC6*fW_VMC6,length.out=length(years)))

#To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
Model_VMC6=SoilR::RothCModel(
  t=years, #Simulation Length
  ks=c(k.DPM = 10*CTRM, k.RPM = 0.3*CTRM, k.BIO = 0.66*CTRM, k.HUM = 0.02*CTRM, k.IOM = 0*CTRM), #Decomposition rates for the different pools
  C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
  In=Scalar_LitterCinputs*0, #Amount of litter inputs by time
  FYM = Scalar_ManureCinputs*1, #Amount of Farm Yard Manure by time
  clay=clay100*0.6, #Percent clay in mineral soil
  xi=xi.frame_VMC6) #Loads the model

Ct_VMC6=getC(Model_VMC6) #Calculates stocks for each pool per month

#The results can be plotted with the commands
matplot(years, Ct_VMC6, type="l", lty=1, col=1:5,
        xlab="Time (years)", ylab="C stocks (Mg/ha)")
legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
       lty=1, col=1:5, bty="n")

VEC_Lit_VMC6 <- rep(M_Scalar_LitterCinputs*0, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
VEC_Man_VMC6 <- rep(M_Scalar_ManureCinputs*1, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

VEC_LitDF_VMC6 <- as.data.frame(VEC_Lit_VMC6) #Converting the Litter vector to a data frame
VEC_LitDF_VMC6$MNumber <- seq(from = 1, to = SimulationLength_months)
VEC_ManDF_VMC6 <- as.data.frame(VEC_Man_VMC6) #Converting the Manure vector to a data frame
VEC_ManDF_VMC6$MNumber <- seq(from = 1, to = SimulationLength_months)

sapply(VEC_LitDF_VMC6, class) #Check that class is numeric
sapply(VEC_ManDF_VMC6, class) #Check that class is numeric
LitterCinputs_VMC6=VEC_LitDF_VMC6   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
ManureCinputs_VMC6=VEC_ManDF_VMC6 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
MCinputs_VMC6 <- merge(LitterCinputs_VMC6, ManureCinputs_VMC6, by = "MNumber")
MCinputs_VMC6$MInput_VMC6 <- MCinputs_VMC6$VEC_Lit_VMC6 + MCinputs_VMC6$VEC_Man_VMC6

#Change names of litter and manure columns for more common ones
colnames(MCinputs_VMC6)[which(names(MCinputs_VMC6) == "VEC_Lit_VMC6")] <- "LitterC_VMC6"
colnames(MCinputs_VMC6)[which(names(MCinputs_VMC6) == "VEC_Man_VMC6")] <- "ManureC_VMC6"

#Create a dataframe with the data considering the simulation length
ModelDF_VMC6 <- as.data.frame(Ct_VMC6)
colnames(ModelDF_VMC6) <- c('DPM_VMC6','RPM_VMC6','BIO_VMC6', 'HUM_VMC6', 'IOM_VMC6')
ModelDFS_VMC6 <- ModelDF_VMC6[1:SimulationLength_months, ]

#Create a column with the number of month of analysis
ModelDFS_VMC6$MNumber <- seq(from = 1, to = SimulationLength_months)

#Create a column that sums all pools
ModelDFS_VMC6$AllPools_VMC6 <- ModelDFS_VMC6$DPM_VMC6 + ModelDFS_VMC6$RPM_VMC6 + ModelDFS_VMC6$BIO_VMC6 + ModelDFS_VMC6$HUM_VMC6 + ModelDFS_VMC6$IOM_VMC6

#Create a column that sums all pools except IOM (static)
ModelDFS_VMC6$AllPools_noIOM_VMC6 <- ModelDFS_VMC6$DPM_VMC6 + ModelDFS_VMC6$RPM_VMC6 + ModelDFS_VMC6$BIO_VMC6 + ModelDFS_VMC6$HUM_VMC6

#Create a column that add the monthly input of C (manure and litter separately)
ModelDFSL_VMC6 <- merge(ModelDFS_VMC6, MCinputs_VMC6, by = "MNumber")

ModelDFSL_VMC6$MInput_VMC6 <- ModelDFSL_VMC6$LitterC_VMC6 + ModelDFSL_VMC6$ManureC_VMC6
#ModelDF_SL$MInput[1] <- 0

#Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
ModelDFSL_VMC6$CTails_VMC6 <- ModelDFSL_VMC6$AllPools_noIOM_VMC6 + ModelDFSL_VMC6$MInput_VMC6

#Create Monthly Accumulated input of C
ModelDFSL_VMC6$AccumInput_VMC6 = ModelDFSL_VMC6$AccumInput_VMC6=cumsum(ModelDFSL_VMC6$MInput_VMC6)

#Create Monthly Growths for each carbon pool
ModelDFSL_VMC6$MGrowth_DPM_VMC6 <- ave(ModelDFSL_VMC6$DPM_VMC6, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMC6$MGrowth_RPM_VMC6 <- ave(ModelDFSL_VMC6$RPM_VMC6, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMC6$MGrowth_BIO_VMC6 <- ave(ModelDFSL_VMC6$BIO_VMC6, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMC6$MGrowth_HUM_VMC6 <- ave(ModelDFSL_VMC6$HUM_VMC6, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMC6$MGrowth_IOM_VMC6 <- ave(ModelDFSL_VMC6$IOM_VMC6, FUN = function(x) c(0, diff(x)))

#Create column for Monthly and Accumulated C-CO2 emissions
ModelDFSL_VMC6$M_CCO2_VMC6 <- ModelDFSL_VMC6$MInput_VMC6 - ModelDFSL_VMC6$MGrowth_DPM_VMC6 - ModelDFSL_VMC6$MGrowth_RPM_VMC6 - ModelDFSL_VMC6$MGrowth_BIO_VMC6 - ModelDFSL_VMC6$MGrowth_HUM_VMC6
ModelDFSL_VMC6$Accum_CCO2_VMC6 <- ModelDFSL_VMC6$AccumInput_VMC6 - ModelDFSL_VMC6$AllPools_noIOM_VMC6

#Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
ModelDFSL_VMC6$M_CCO2_VMC6[1] <- 0
ModelDFSL_VMC6$Accum_CCO2_VMC6[1] <- 0

#Balance validation
ModelDFSL_VMC6$Balance_VMC6 <- ModelDFSL_VMC6$AccumInput_VMC6 - ModelDFSL_VMC6$Accum_CCO2_VMC6 - (ModelDFSL_VMC6$DPM_VMC6 + ModelDFSL_VMC6$RPM_VMC6 + ModelDFSL_VMC6$BIO_VMC6 + ModelDFSL_VMC6$HUM_VMC6)

#Convert C-CO2 emissions into CO2 emissions
ModelDFSL_VMC6$M_CO2_VMC6 <- ModelDFSL_VMC6$M_CCO2_VMC6 * 44/12
ModelDFSL_VMC6$Accum_CO2_VMC6 <- ModelDFSL_VMC6$Accum_CCO2_VMC6 * 44/12

#This model will be called VMC6C because implies a continuous input of C
ModelDFSL_VMC6C <- ModelDFSL_VMC6

#Export the dataframe
write_xlsx(ModelDFSL_VMC6C,"VXC_Models\\ModelDFSL_R_VMC6C.xlsx")

#Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
#Create two equal models by using the above general script
#Create model t=x
ModelDFSLt0_VMC6 <- ModelDFSL_VMC6 #Create model t=x

#Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
ModelDFSLt1_VMC6.1 <- rbind(c(0:0), ModelDFSLt0_VMC6)
ModelDFSLt1_VMC6.2 <- rbind(c(0:0), ModelDFSLt1_VMC6.1)
ModelDFSLt1_VMC6.3 <- rbind(c(0:0), ModelDFSLt1_VMC6.2)
ModelDFSLt1_VMC6.4 <- rbind(c(0:0), ModelDFSLt1_VMC6.3)
ModelDFSLt1_VMC6.5 <- rbind(c(0:0), ModelDFSLt1_VMC6.4)
ModelDFSLt1_VMC6.6 <- rbind(c(0:0), ModelDFSLt1_VMC6.5)
ModelDFSLt1_VMC6.7 <- rbind(c(0:0), ModelDFSLt1_VMC6.6)
ModelDFSLt1_VMC6.8 <- rbind(c(0:0), ModelDFSLt1_VMC6.7)
ModelDFSLt1_VMC6.9 <- rbind(c(0:0), ModelDFSLt1_VMC6.8)
ModelDFSLt1_VMC6.10 <- rbind(c(0:0), ModelDFSLt1_VMC6.9)
ModelDFSLt1_VMC6.11 <- rbind(c(0:0), ModelDFSLt1_VMC6.10)
ModelDFSLt1_VMC6.12 <- rbind(c(0:0), ModelDFSLt1_VMC6.11)
ModelDFSLt1_VMC6.13 <- ModelDFSLt1_VMC6.12[-nrow(ModelDFSLt1_VMC6.12),]
ModelDFSLt1_VMC6.14 <- ModelDFSLt1_VMC6.13[-nrow(ModelDFSLt1_VMC6.13),]
ModelDFSLt1_VMC6.15 <- ModelDFSLt1_VMC6.14[-nrow(ModelDFSLt1_VMC6.14),]
ModelDFSLt1_VMC6.16 <- ModelDFSLt1_VMC6.15[-nrow(ModelDFSLt1_VMC6.15),]
ModelDFSLt1_VMC6.17 <- ModelDFSLt1_VMC6.16[-nrow(ModelDFSLt1_VMC6.16),]
ModelDFSLt1_VMC6.18 <- ModelDFSLt1_VMC6.17[-nrow(ModelDFSLt1_VMC6.17),]
ModelDFSLt1_VMC6.19 <- ModelDFSLt1_VMC6.18[-nrow(ModelDFSLt1_VMC6.18),]
ModelDFSLt1_VMC6.20 <- ModelDFSLt1_VMC6.19[-nrow(ModelDFSLt1_VMC6.19),]
ModelDFSLt1_VMC6.21 <- ModelDFSLt1_VMC6.20[-nrow(ModelDFSLt1_VMC6.20),]
ModelDFSLt1_VMC6.22 <- ModelDFSLt1_VMC6.21[-nrow(ModelDFSLt1_VMC6.21),]
ModelDFSLt1_VMC6.23 <- ModelDFSLt1_VMC6.22[-nrow(ModelDFSLt1_VMC6.22),]
ModelDFSLt1_VMC6.24 <- ModelDFSLt1_VMC6.23[-nrow(ModelDFSLt1_VMC6.23),]

ModelDFSLt1_VMC6 <- ModelDFSLt1_VMC6.24 #Create model t=x+1

#Subtract model (t=x) - (t=x+1)
ModelDFSL1y_VMC6 <- ModelDFSLt0_VMC6 - ModelDFSLt1_VMC6

#Re-do Month Number column because the substraction was also applied to it
ModelDFSL1y_VMC6$MNumber <- seq(from = 1, to = SimulationLength_months)

#This model will be called VMC6P because implies a one-off input of C
ModelDFSL_VMC6P <- ModelDFSL1y_VMC6

#Export the dataframe
write_xlsx(ModelDFSL_VMC6P,"VXP_Models\\ModelDFSL_R_VMC6P.xlsx")

#Plot 3: Interactive Yearly CO2 emissions #
MY <- 12
ModelDFSL_VMC6P_YCO2 <- ModelDFSL_VMC6P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VMC6)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMC6P_YCO2) <- c("Year", "Months", "AnnualCO2_VMC_6")


#Plot 3: Interactive Yearly CO2 emissions considering a delay
GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
ModelDFSL_VMC6P_YCO2D <- merge(ModelDFSL_VMC6P_YCO2, GWP100delay, by = "Year")
ModelDFSL_VMC6P_YCO2D$AnnualCO2D_VMC_6 <- ModelDFSL_VMC6P_YCO2D$AnnualCO2_VMC_6 * ModelDFSL_VMC6P_YCO2D$GWP100

#Plot 4: Interactive Yearly C emissions #
MY <- 12
ModelDFSL_VMC6P_YC <- ModelDFSL_VMC6P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VMC6)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMC6P_YC) <- c("Year", "Months", "CEmissions_VMC_6")


#Plot 5: Interactive Yearly C tails (remaining C in Soil) #
MY <- 12
ModelDFSL_VMC6P_YCT <- ModelDFSL_VMC6P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VMC6)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMC6P_YCT) <- c("Year", "Months", "CTail_VMC_6")

#Save Dataframes for Plots 3.1, 3.2, 4 and 5
write_xlsx(ModelDFSL_VMC6P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VMC6P.xlsx") #Yearly CO2 emissions (no delay)
write_xlsx(ModelDFSL_VMC6P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VMC6P.xlsx") #Yearly CO2 emissions (delay)
write_xlsx(ModelDFSL_VMC6P_YC,"CEmissions_P\\ModelDFSL_R_CE_VMC6P.xlsx") #Yearly C emissions
write_xlsx(ModelDFSL_VMC6P_YCT,"CTails_P\\ModelDFSL_R_CT_VMC6P.xlsx") #Yearly C emissions



#### 10.8 - VMC7) Manure; 70%clay; Conventional tillage ####
#The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
fT_VMC7=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
fW_VMC7=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                        S.Thick = soil.thick, pClay = clay100*0.7,
                        pE = 1.0, bare = FALSE)$b #Moisture effects per month
xi.frame_VMC7=data.frame(years,rep(fT_VMC7*fW_VMC7,length.out=length(years)))

#To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
Model_VMC7=SoilR::RothCModel(
  t=years, #Simulation Length
  ks=c(k.DPM = 10*CTRM, k.RPM = 0.3*CTRM, k.BIO = 0.66*CTRM, k.HUM = 0.02*CTRM, k.IOM = 0*CTRM), #Decomposition rates for the different pools
  C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
  In=Scalar_LitterCinputs*0, #Amount of litter inputs by time
  FYM = Scalar_ManureCinputs*1, #Amount of Farm Yard Manure by time
  clay=clay100*0.7, #Percent clay in mineral soil
  xi=xi.frame_VMC7) #Loads the model

Ct_VMC7=getC(Model_VMC7) #Calculates stocks for each pool per month

#The results can be plotted with the commands
matplot(years, Ct_VMC7, type="l", lty=1, col=1:5,
        xlab="Time (years)", ylab="C stocks (Mg/ha)")
legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
       lty=1, col=1:5, bty="n")

VEC_Lit_VMC7 <- rep(M_Scalar_LitterCinputs*0, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
VEC_Man_VMC7 <- rep(M_Scalar_ManureCinputs*1, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

VEC_LitDF_VMC7 <- as.data.frame(VEC_Lit_VMC7) #Converting the Litter vector to a data frame
VEC_LitDF_VMC7$MNumber <- seq(from = 1, to = SimulationLength_months)
VEC_ManDF_VMC7 <- as.data.frame(VEC_Man_VMC7) #Converting the Manure vector to a data frame
VEC_ManDF_VMC7$MNumber <- seq(from = 1, to = SimulationLength_months)

sapply(VEC_LitDF_VMC7, class) #Check that class is numeric
sapply(VEC_ManDF_VMC7, class) #Check that class is numeric
LitterCinputs_VMC7=VEC_LitDF_VMC7   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
ManureCinputs_VMC7=VEC_ManDF_VMC7 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
MCinputs_VMC7 <- merge(LitterCinputs_VMC7, ManureCinputs_VMC7, by = "MNumber")
MCinputs_VMC7$MInput_VMC7 <- MCinputs_VMC7$VEC_Lit_VMC7 + MCinputs_VMC7$VEC_Man_VMC7

#Change names of litter and manure columns for more common ones
colnames(MCinputs_VMC7)[which(names(MCinputs_VMC7) == "VEC_Lit_VMC7")] <- "LitterC_VMC7"
colnames(MCinputs_VMC7)[which(names(MCinputs_VMC7) == "VEC_Man_VMC7")] <- "ManureC_VMC7"

#Create a dataframe with the data considering the simulation length
ModelDF_VMC7 <- as.data.frame(Ct_VMC7)
colnames(ModelDF_VMC7) <- c('DPM_VMC7','RPM_VMC7','BIO_VMC7', 'HUM_VMC7', 'IOM_VMC7')
ModelDFS_VMC7 <- ModelDF_VMC7[1:SimulationLength_months, ]

#Create a column with the number of month of analysis
ModelDFS_VMC7$MNumber <- seq(from = 1, to = SimulationLength_months)

#Create a column that sums all pools
ModelDFS_VMC7$AllPools_VMC7 <- ModelDFS_VMC7$DPM_VMC7 + ModelDFS_VMC7$RPM_VMC7 + ModelDFS_VMC7$BIO_VMC7 + ModelDFS_VMC7$HUM_VMC7 + ModelDFS_VMC7$IOM_VMC7

#Create a column that sums all pools except IOM (static)
ModelDFS_VMC7$AllPools_noIOM_VMC7 <- ModelDFS_VMC7$DPM_VMC7 + ModelDFS_VMC7$RPM_VMC7 + ModelDFS_VMC7$BIO_VMC7 + ModelDFS_VMC7$HUM_VMC7

#Create a column that add the monthly input of C (manure and litter separately)
ModelDFSL_VMC7 <- merge(ModelDFS_VMC7, MCinputs_VMC7, by = "MNumber")

ModelDFSL_VMC7$MInput_VMC7 <- ModelDFSL_VMC7$LitterC_VMC7 + ModelDFSL_VMC7$ManureC_VMC7
#ModelDF_SL$MInput[1] <- 0

#Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
ModelDFSL_VMC7$CTails_VMC7 <- ModelDFSL_VMC7$AllPools_noIOM_VMC7 + ModelDFSL_VMC7$MInput_VMC7

#Create Monthly Accumulated input of C
ModelDFSL_VMC7$AccumInput_VMC7 = ModelDFSL_VMC7$AccumInput_VMC7=cumsum(ModelDFSL_VMC7$MInput_VMC7)

#Create Monthly Growths for each carbon pool
ModelDFSL_VMC7$MGrowth_DPM_VMC7 <- ave(ModelDFSL_VMC7$DPM_VMC7, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMC7$MGrowth_RPM_VMC7 <- ave(ModelDFSL_VMC7$RPM_VMC7, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMC7$MGrowth_BIO_VMC7 <- ave(ModelDFSL_VMC7$BIO_VMC7, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMC7$MGrowth_HUM_VMC7 <- ave(ModelDFSL_VMC7$HUM_VMC7, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMC7$MGrowth_IOM_VMC7 <- ave(ModelDFSL_VMC7$IOM_VMC7, FUN = function(x) c(0, diff(x)))

#Create column for Monthly and Accumulated C-CO2 emissions
ModelDFSL_VMC7$M_CCO2_VMC7 <- ModelDFSL_VMC7$MInput_VMC7 - ModelDFSL_VMC7$MGrowth_DPM_VMC7 - ModelDFSL_VMC7$MGrowth_RPM_VMC7 - ModelDFSL_VMC7$MGrowth_BIO_VMC7 - ModelDFSL_VMC7$MGrowth_HUM_VMC7
ModelDFSL_VMC7$Accum_CCO2_VMC7 <- ModelDFSL_VMC7$AccumInput_VMC7 - ModelDFSL_VMC7$AllPools_noIOM_VMC7

#Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
ModelDFSL_VMC7$M_CCO2_VMC7[1] <- 0
ModelDFSL_VMC7$Accum_CCO2_VMC7[1] <- 0

#Balance validation
ModelDFSL_VMC7$Balance_VMC7 <- ModelDFSL_VMC7$AccumInput_VMC7 - ModelDFSL_VMC7$Accum_CCO2_VMC7 - (ModelDFSL_VMC7$DPM_VMC7 + ModelDFSL_VMC7$RPM_VMC7 + ModelDFSL_VMC7$BIO_VMC7 + ModelDFSL_VMC7$HUM_VMC7)

#Convert C-CO2 emissions into CO2 emissions
ModelDFSL_VMC7$M_CO2_VMC7 <- ModelDFSL_VMC7$M_CCO2_VMC7 * 44/12
ModelDFSL_VMC7$Accum_CO2_VMC7 <- ModelDFSL_VMC7$Accum_CCO2_VMC7 * 44/12

#This model will be called VMC7C because implies a continuous input of C
ModelDFSL_VMC7C <- ModelDFSL_VMC7

#Export the dataframe
write_xlsx(ModelDFSL_VMC7C,"VXC_Models\\ModelDFSL_R_VMC7C.xlsx")

#Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
#Create two equal models by using the above general script
#Create model t=x
ModelDFSLt0_VMC7 <- ModelDFSL_VMC7 #Create model t=x

#Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
ModelDFSLt1_VMC7.1 <- rbind(c(0:0), ModelDFSLt0_VMC7)
ModelDFSLt1_VMC7.2 <- rbind(c(0:0), ModelDFSLt1_VMC7.1)
ModelDFSLt1_VMC7.3 <- rbind(c(0:0), ModelDFSLt1_VMC7.2)
ModelDFSLt1_VMC7.4 <- rbind(c(0:0), ModelDFSLt1_VMC7.3)
ModelDFSLt1_VMC7.5 <- rbind(c(0:0), ModelDFSLt1_VMC7.4)
ModelDFSLt1_VMC7.6 <- rbind(c(0:0), ModelDFSLt1_VMC7.5)
ModelDFSLt1_VMC7.7 <- rbind(c(0:0), ModelDFSLt1_VMC7.6)
ModelDFSLt1_VMC7.8 <- rbind(c(0:0), ModelDFSLt1_VMC7.7)
ModelDFSLt1_VMC7.9 <- rbind(c(0:0), ModelDFSLt1_VMC7.8)
ModelDFSLt1_VMC7.10 <- rbind(c(0:0), ModelDFSLt1_VMC7.9)
ModelDFSLt1_VMC7.11 <- rbind(c(0:0), ModelDFSLt1_VMC7.10)
ModelDFSLt1_VMC7.12 <- rbind(c(0:0), ModelDFSLt1_VMC7.11)
ModelDFSLt1_VMC7.13 <- ModelDFSLt1_VMC7.12[-nrow(ModelDFSLt1_VMC7.12),]
ModelDFSLt1_VMC7.14 <- ModelDFSLt1_VMC7.13[-nrow(ModelDFSLt1_VMC7.13),]
ModelDFSLt1_VMC7.15 <- ModelDFSLt1_VMC7.14[-nrow(ModelDFSLt1_VMC7.14),]
ModelDFSLt1_VMC7.16 <- ModelDFSLt1_VMC7.15[-nrow(ModelDFSLt1_VMC7.15),]
ModelDFSLt1_VMC7.17 <- ModelDFSLt1_VMC7.16[-nrow(ModelDFSLt1_VMC7.16),]
ModelDFSLt1_VMC7.18 <- ModelDFSLt1_VMC7.17[-nrow(ModelDFSLt1_VMC7.17),]
ModelDFSLt1_VMC7.19 <- ModelDFSLt1_VMC7.18[-nrow(ModelDFSLt1_VMC7.18),]
ModelDFSLt1_VMC7.20 <- ModelDFSLt1_VMC7.19[-nrow(ModelDFSLt1_VMC7.19),]
ModelDFSLt1_VMC7.21 <- ModelDFSLt1_VMC7.20[-nrow(ModelDFSLt1_VMC7.20),]
ModelDFSLt1_VMC7.22 <- ModelDFSLt1_VMC7.21[-nrow(ModelDFSLt1_VMC7.21),]
ModelDFSLt1_VMC7.23 <- ModelDFSLt1_VMC7.22[-nrow(ModelDFSLt1_VMC7.22),]
ModelDFSLt1_VMC7.24 <- ModelDFSLt1_VMC7.23[-nrow(ModelDFSLt1_VMC7.23),]

ModelDFSLt1_VMC7 <- ModelDFSLt1_VMC7.24 #Create model t=x+1

#Subtract model (t=x) - (t=x+1)
ModelDFSL1y_VMC7 <- ModelDFSLt0_VMC7 - ModelDFSLt1_VMC7

#Re-do Month Number column because the substraction was also applied to it
ModelDFSL1y_VMC7$MNumber <- seq(from = 1, to = SimulationLength_months)

#This model will be called VMC7P because implies a one-off input of C
ModelDFSL_VMC7P <- ModelDFSL1y_VMC7

#Export the dataframe
write_xlsx(ModelDFSL_VMC7P,"VXP_Models\\ModelDFSL_R_VMC7P.xlsx")

#Plot 3: Interactive Yearly CO2 emissions #
MY <- 12
ModelDFSL_VMC7P_YCO2 <- ModelDFSL_VMC7P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VMC7)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMC7P_YCO2) <- c("Year", "Months", "AnnualCO2_VMC_7")


#Plot 3: Interactive Yearly CO2 emissions considering a delay
GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
ModelDFSL_VMC7P_YCO2D <- merge(ModelDFSL_VMC7P_YCO2, GWP100delay, by = "Year")
ModelDFSL_VMC7P_YCO2D$AnnualCO2D_VMC_7 <- ModelDFSL_VMC7P_YCO2D$AnnualCO2_VMC_7 * ModelDFSL_VMC7P_YCO2D$GWP100

#Plot 4: Interactive Yearly C emissions #
MY <- 12
ModelDFSL_VMC7P_YC <- ModelDFSL_VMC7P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VMC7)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMC7P_YC) <- c("Year", "Months", "CEmissions_VMC_7")


#Plot 5: Interactive Yearly C tails (remaining C in Soil) #
MY <- 12
ModelDFSL_VMC7P_YCT <- ModelDFSL_VMC7P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VMC7)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMC7P_YCT) <- c("Year", "Months", "CTail_VMC_7")


#Save Dataframes for Plots 3.1, 3.2, 4 and 5
write_xlsx(ModelDFSL_VMC7P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VMC7P.xlsx") #Yearly CO2 emissions (no delay)
write_xlsx(ModelDFSL_VMC7P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VMC7P.xlsx") #Yearly CO2 emissions (delay)
write_xlsx(ModelDFSL_VMC7P_YC,"CEmissions_P\\ModelDFSL_R_CE_VMC7P.xlsx") #Yearly C emissions
write_xlsx(ModelDFSL_VMC7P_YCT,"CTails_P\\ModelDFSL_R_CT_VMC7P.xlsx") #Yearly C emissions



#### 10.9 - VMC8) Manure; 80%clay; Conventional tillage ####
#The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
fT_VMC8=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
fW_VMC8=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                        S.Thick = soil.thick, pClay = clay100*0.8,
                        pE = 1.0, bare = FALSE)$b #Moisture effects per month
xi.frame_VMC8=data.frame(years,rep(fT_VMC8*fW_VMC8,length.out=length(years)))

#To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
Model_VMC8=SoilR::RothCModel(
  t=years, #Simulation Length
  ks=c(k.DPM = 10*CTRM, k.RPM = 0.3*CTRM, k.BIO = 0.66*CTRM, k.HUM = 0.02*CTRM, k.IOM = 0*CTRM), #Decomposition rates for the different pools
  C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
  In=Scalar_LitterCinputs*0, #Amount of litter inputs by time
  FYM = Scalar_ManureCinputs*1, #Amount of Farm Yard Manure by time
  clay=clay100*0.8, #Percent clay in mineral soil
  xi=xi.frame_VMC8) #Loads the model

Ct_VMC8=getC(Model_VMC8) #Calculates stocks for each pool per month

#The results can be plotted with the commands
matplot(years, Ct_VMC8, type="l", lty=1, col=1:5,
        xlab="Time (years)", ylab="C stocks (Mg/ha)")
legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
       lty=1, col=1:5, bty="n")

VEC_Lit_VMC8 <- rep(M_Scalar_LitterCinputs*0, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
VEC_Man_VMC8 <- rep(M_Scalar_ManureCinputs*1, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

VEC_LitDF_VMC8 <- as.data.frame(VEC_Lit_VMC8) #Converting the Litter vector to a data frame
VEC_LitDF_VMC8$MNumber <- seq(from = 1, to = SimulationLength_months)
VEC_ManDF_VMC8 <- as.data.frame(VEC_Man_VMC8) #Converting the Manure vector to a data frame
VEC_ManDF_VMC8$MNumber <- seq(from = 1, to = SimulationLength_months)

sapply(VEC_LitDF_VMC8, class) #Check that class is numeric
sapply(VEC_ManDF_VMC8, class) #Check that class is numeric
LitterCinputs_VMC8=VEC_LitDF_VMC8   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
ManureCinputs_VMC8=VEC_ManDF_VMC8 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
MCinputs_VMC8 <- merge(LitterCinputs_VMC8, ManureCinputs_VMC8, by = "MNumber")
MCinputs_VMC8$MInput_VMC8 <- MCinputs_VMC8$VEC_Lit_VMC8 + MCinputs_VMC8$VEC_Man_VMC8

#Change names of litter and manure columns for more common ones
colnames(MCinputs_VMC8)[which(names(MCinputs_VMC8) == "VEC_Lit_VMC8")] <- "LitterC_VMC8"
colnames(MCinputs_VMC8)[which(names(MCinputs_VMC8) == "VEC_Man_VMC8")] <- "ManureC_VMC8"

#Create a dataframe with the data considering the simulation length
ModelDF_VMC8 <- as.data.frame(Ct_VMC8)
colnames(ModelDF_VMC8) <- c('DPM_VMC8','RPM_VMC8','BIO_VMC8', 'HUM_VMC8', 'IOM_VMC8')
ModelDFS_VMC8 <- ModelDF_VMC8[1:SimulationLength_months, ]

#Create a column with the number of month of analysis
ModelDFS_VMC8$MNumber <- seq(from = 1, to = SimulationLength_months)

#Create a column that sums all pools
ModelDFS_VMC8$AllPools_VMC8 <- ModelDFS_VMC8$DPM_VMC8 + ModelDFS_VMC8$RPM_VMC8 + ModelDFS_VMC8$BIO_VMC8 + ModelDFS_VMC8$HUM_VMC8 + ModelDFS_VMC8$IOM_VMC8

#Create a column that sums all pools except IOM (static)
ModelDFS_VMC8$AllPools_noIOM_VMC8 <- ModelDFS_VMC8$DPM_VMC8 + ModelDFS_VMC8$RPM_VMC8 + ModelDFS_VMC8$BIO_VMC8 + ModelDFS_VMC8$HUM_VMC8

#Create a column that add the monthly input of C (manure and litter separately)
ModelDFSL_VMC8 <- merge(ModelDFS_VMC8, MCinputs_VMC8, by = "MNumber")

ModelDFSL_VMC8$MInput_VMC8 <- ModelDFSL_VMC8$LitterC_VMC8 + ModelDFSL_VMC8$ManureC_VMC8
#ModelDF_SL$MInput[1] <- 0

#Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
ModelDFSL_VMC8$CTails_VMC8 <- ModelDFSL_VMC8$AllPools_noIOM_VMC8 + ModelDFSL_VMC8$MInput_VMC8

#Create Monthly Accumulated input of C
ModelDFSL_VMC8$AccumInput_VMC8 = ModelDFSL_VMC8$AccumInput_VMC8=cumsum(ModelDFSL_VMC8$MInput_VMC8)

#Create Monthly Growths for each carbon pool
ModelDFSL_VMC8$MGrowth_DPM_VMC8 <- ave(ModelDFSL_VMC8$DPM_VMC8, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMC8$MGrowth_RPM_VMC8 <- ave(ModelDFSL_VMC8$RPM_VMC8, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMC8$MGrowth_BIO_VMC8 <- ave(ModelDFSL_VMC8$BIO_VMC8, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMC8$MGrowth_HUM_VMC8 <- ave(ModelDFSL_VMC8$HUM_VMC8, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMC8$MGrowth_IOM_VMC8 <- ave(ModelDFSL_VMC8$IOM_VMC8, FUN = function(x) c(0, diff(x)))

#Create column for Monthly and Accumulated C-CO2 emissions
ModelDFSL_VMC8$M_CCO2_VMC8 <- ModelDFSL_VMC8$MInput_VMC8 - ModelDFSL_VMC8$MGrowth_DPM_VMC8 - ModelDFSL_VMC8$MGrowth_RPM_VMC8 - ModelDFSL_VMC8$MGrowth_BIO_VMC8 - ModelDFSL_VMC8$MGrowth_HUM_VMC8
ModelDFSL_VMC8$Accum_CCO2_VMC8 <- ModelDFSL_VMC8$AccumInput_VMC8 - ModelDFSL_VMC8$AllPools_noIOM_VMC8

#Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
ModelDFSL_VMC8$M_CCO2_VMC8[1] <- 0
ModelDFSL_VMC8$Accum_CCO2_VMC8[1] <- 0

#Balance validation
ModelDFSL_VMC8$Balance_VMC8 <- ModelDFSL_VMC8$AccumInput_VMC8 - ModelDFSL_VMC8$Accum_CCO2_VMC8 - (ModelDFSL_VMC8$DPM_VMC8 + ModelDFSL_VMC8$RPM_VMC8 + ModelDFSL_VMC8$BIO_VMC8 + ModelDFSL_VMC8$HUM_VMC8)

#Convert C-CO2 emissions into CO2 emissions
ModelDFSL_VMC8$M_CO2_VMC8 <- ModelDFSL_VMC8$M_CCO2_VMC8 * 44/12
ModelDFSL_VMC8$Accum_CO2_VMC8 <- ModelDFSL_VMC8$Accum_CCO2_VMC8 * 44/12

#This model will be called VMC8C because implies a continuous input of C
ModelDFSL_VMC8C <- ModelDFSL_VMC8

#Export the dataframe
write_xlsx(ModelDFSL_VMC8C,"VXC_Models\\ModelDFSL_R_VMC8C.xlsx")

#Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
#Create two equal models by using the above general script
#Create model t=x
ModelDFSLt0_VMC8 <- ModelDFSL_VMC8 #Create model t=x

#Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
ModelDFSLt1_VMC8.1 <- rbind(c(0:0), ModelDFSLt0_VMC8)
ModelDFSLt1_VMC8.2 <- rbind(c(0:0), ModelDFSLt1_VMC8.1)
ModelDFSLt1_VMC8.3 <- rbind(c(0:0), ModelDFSLt1_VMC8.2)
ModelDFSLt1_VMC8.4 <- rbind(c(0:0), ModelDFSLt1_VMC8.3)
ModelDFSLt1_VMC8.5 <- rbind(c(0:0), ModelDFSLt1_VMC8.4)
ModelDFSLt1_VMC8.6 <- rbind(c(0:0), ModelDFSLt1_VMC8.5)
ModelDFSLt1_VMC8.7 <- rbind(c(0:0), ModelDFSLt1_VMC8.6)
ModelDFSLt1_VMC8.8 <- rbind(c(0:0), ModelDFSLt1_VMC8.7)
ModelDFSLt1_VMC8.9 <- rbind(c(0:0), ModelDFSLt1_VMC8.8)
ModelDFSLt1_VMC8.10 <- rbind(c(0:0), ModelDFSLt1_VMC8.9)
ModelDFSLt1_VMC8.11 <- rbind(c(0:0), ModelDFSLt1_VMC8.10)
ModelDFSLt1_VMC8.12 <- rbind(c(0:0), ModelDFSLt1_VMC8.11)
ModelDFSLt1_VMC8.13 <- ModelDFSLt1_VMC8.12[-nrow(ModelDFSLt1_VMC8.12),]
ModelDFSLt1_VMC8.14 <- ModelDFSLt1_VMC8.13[-nrow(ModelDFSLt1_VMC8.13),]
ModelDFSLt1_VMC8.15 <- ModelDFSLt1_VMC8.14[-nrow(ModelDFSLt1_VMC8.14),]
ModelDFSLt1_VMC8.16 <- ModelDFSLt1_VMC8.15[-nrow(ModelDFSLt1_VMC8.15),]
ModelDFSLt1_VMC8.17 <- ModelDFSLt1_VMC8.16[-nrow(ModelDFSLt1_VMC8.16),]
ModelDFSLt1_VMC8.18 <- ModelDFSLt1_VMC8.17[-nrow(ModelDFSLt1_VMC8.17),]
ModelDFSLt1_VMC8.19 <- ModelDFSLt1_VMC8.18[-nrow(ModelDFSLt1_VMC8.18),]
ModelDFSLt1_VMC8.20 <- ModelDFSLt1_VMC8.19[-nrow(ModelDFSLt1_VMC8.19),]
ModelDFSLt1_VMC8.21 <- ModelDFSLt1_VMC8.20[-nrow(ModelDFSLt1_VMC8.20),]
ModelDFSLt1_VMC8.22 <- ModelDFSLt1_VMC8.21[-nrow(ModelDFSLt1_VMC8.21),]
ModelDFSLt1_VMC8.23 <- ModelDFSLt1_VMC8.22[-nrow(ModelDFSLt1_VMC8.22),]
ModelDFSLt1_VMC8.24 <- ModelDFSLt1_VMC8.23[-nrow(ModelDFSLt1_VMC8.23),]

ModelDFSLt1_VMC8 <- ModelDFSLt1_VMC8.24 #Create model t=x+1

#Subtract model (t=x) - (t=x+1)
ModelDFSL1y_VMC8 <- ModelDFSLt0_VMC8 - ModelDFSLt1_VMC8

#Re-do Month Number column because the substraction was also applied to it
ModelDFSL1y_VMC8$MNumber <- seq(from = 1, to = SimulationLength_months)

#This model will be called VMC8P because implies a one-off input of C
ModelDFSL_VMC8P <- ModelDFSL1y_VMC8

#Export the dataframe
write_xlsx(ModelDFSL_VMC8P,"VXP_Models\\ModelDFSL_R_VMC8P.xlsx")


#Plot 3: Interactive Yearly CO2 emissions #
MY <- 12
ModelDFSL_VMC8P_YCO2 <- ModelDFSL_VMC8P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VMC8)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMC8P_YCO2) <- c("Year", "Months", "AnnualCO2_VMC_8")

#Plot 3: Interactive Yearly CO2 emissions considering a delay
GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
ModelDFSL_VMC8P_YCO2D <- merge(ModelDFSL_VMC8P_YCO2, GWP100delay, by = "Year")
ModelDFSL_VMC8P_YCO2D$AnnualCO2D_VMC_8 <- ModelDFSL_VMC8P_YCO2D$AnnualCO2_VMC_8 * ModelDFSL_VMC8P_YCO2D$GWP100


#Plot 4: Interactive Yearly C emissions #
MY <- 12
ModelDFSL_VMC8P_YC <- ModelDFSL_VMC8P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VMC8)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMC8P_YC) <- c("Year", "Months", "CEmissions_VMC_8")

#Plot 5: Interactive Yearly C tails (remaining C in Soil) #
MY <- 12
ModelDFSL_VMC8P_YCT <- ModelDFSL_VMC8P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VMC8)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMC8P_YCT) <- c("Year", "Months", "CTail_VMC_8")

#Save Dataframes for Plots 3.1, 3.2, 4 and 5
write_xlsx(ModelDFSL_VMC8P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VMC8P.xlsx") #Yearly CO2 emissions (no delay)
write_xlsx(ModelDFSL_VMC8P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VMC8P.xlsx") #Yearly CO2 emissions (delay)
write_xlsx(ModelDFSL_VMC8P_YC,"CEmissions_P\\ModelDFSL_R_CE_VMC8P.xlsx") #Yearly C emissions
write_xlsx(ModelDFSL_VMC8P_YCT,"CTails_P\\ModelDFSL_R_CT_VMC8P.xlsx") #Yearly C emissions



#### 10.10 - VMC9) Manure; 90%clay; Conventional tillage ####
#The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
fT_VMC9=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
fW_VMC9=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                        S.Thick = soil.thick, pClay = clay100*0.9,
                        pE = 1.0, bare = FALSE)$b #Moisture effects per month
xi.frame_VMC9=data.frame(years,rep(fT_VMC9*fW_VMC9,length.out=length(years)))

#To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
Model_VMC9=SoilR::RothCModel(
  t=years, #Simulation Length
  ks=c(k.DPM = 10*CTRM, k.RPM = 0.3*CTRM, k.BIO = 0.66*CTRM, k.HUM = 0.02*CTRM, k.IOM = 0*CTRM), #Decomposition rates for the different pools
  C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
  In=Scalar_LitterCinputs*0, #Amount of litter inputs by time
  FYM = Scalar_ManureCinputs*1, #Amount of Farm Yard Manure by time
  clay=clay100*0.9, #Percent clay in mineral soil
  xi=xi.frame_VMC9) #Loads the model

Ct_VMC9=getC(Model_VMC9) #Calculates stocks for each pool per month

#The results can be plotted with the commands
matplot(years, Ct_VMC9, type="l", lty=1, col=1:5,
        xlab="Time (years)", ylab="C stocks (Mg/ha)")
legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
       lty=1, col=1:5, bty="n")

VEC_Lit_VMC9 <- rep(M_Scalar_LitterCinputs*0, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
VEC_Man_VMC9 <- rep(M_Scalar_ManureCinputs*1, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

VEC_LitDF_VMC9 <- as.data.frame(VEC_Lit_VMC9) #Converting the Litter vector to a data frame
VEC_LitDF_VMC9$MNumber <- seq(from = 1, to = SimulationLength_months)
VEC_ManDF_VMC9 <- as.data.frame(VEC_Man_VMC9) #Converting the Manure vector to a data frame
VEC_ManDF_VMC9$MNumber <- seq(from = 1, to = SimulationLength_months)

sapply(VEC_LitDF_VMC9, class) #Check that class is numeric
sapply(VEC_ManDF_VMC9, class) #Check that class is numeric
LitterCinputs_VMC9=VEC_LitDF_VMC9   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
ManureCinputs_VMC9=VEC_ManDF_VMC9 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
MCinputs_VMC9 <- merge(LitterCinputs_VMC9, ManureCinputs_VMC9, by = "MNumber")
MCinputs_VMC9$MInput_VMC9 <- MCinputs_VMC9$VEC_Lit_VMC9 + MCinputs_VMC9$VEC_Man_VMC9

#Change names of litter and manure columns for more common ones
colnames(MCinputs_VMC9)[which(names(MCinputs_VMC9) == "VEC_Lit_VMC9")] <- "LitterC_VMC9"
colnames(MCinputs_VMC9)[which(names(MCinputs_VMC9) == "VEC_Man_VMC9")] <- "ManureC_VMC9"

#Create a dataframe with the data considering the simulation length
ModelDF_VMC9 <- as.data.frame(Ct_VMC9)
colnames(ModelDF_VMC9) <- c('DPM_VMC9','RPM_VMC9','BIO_VMC9', 'HUM_VMC9', 'IOM_VMC9')
ModelDFS_VMC9 <- ModelDF_VMC9[1:SimulationLength_months, ]

#Create a column with the number of month of analysis
ModelDFS_VMC9$MNumber <- seq(from = 1, to = SimulationLength_months)

#Create a column that sums all pools
ModelDFS_VMC9$AllPools_VMC9 <- ModelDFS_VMC9$DPM_VMC9 + ModelDFS_VMC9$RPM_VMC9 + ModelDFS_VMC9$BIO_VMC9 + ModelDFS_VMC9$HUM_VMC9 + ModelDFS_VMC9$IOM_VMC9

#Create a column that sums all pools except IOM (static)
ModelDFS_VMC9$AllPools_noIOM_VMC9 <- ModelDFS_VMC9$DPM_VMC9 + ModelDFS_VMC9$RPM_VMC9 + ModelDFS_VMC9$BIO_VMC9 + ModelDFS_VMC9$HUM_VMC9

#Create a column that add the monthly input of C (manure and litter separately)
ModelDFSL_VMC9 <- merge(ModelDFS_VMC9, MCinputs_VMC9, by = "MNumber")

ModelDFSL_VMC9$MInput_VMC9 <- ModelDFSL_VMC9$LitterC_VMC9 + ModelDFSL_VMC9$ManureC_VMC9
#ModelDF_SL$MInput[1] <- 0

#Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
ModelDFSL_VMC9$CTails_VMC9 <- ModelDFSL_VMC9$AllPools_noIOM_VMC9 + ModelDFSL_VMC9$MInput_VMC9

#Create Monthly Accumulated input of C
ModelDFSL_VMC9$AccumInput_VMC9 = ModelDFSL_VMC9$AccumInput_VMC9=cumsum(ModelDFSL_VMC9$MInput_VMC9)

#Create Monthly Growths for each carbon pool
ModelDFSL_VMC9$MGrowth_DPM_VMC9 <- ave(ModelDFSL_VMC9$DPM_VMC9, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMC9$MGrowth_RPM_VMC9 <- ave(ModelDFSL_VMC9$RPM_VMC9, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMC9$MGrowth_BIO_VMC9 <- ave(ModelDFSL_VMC9$BIO_VMC9, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMC9$MGrowth_HUM_VMC9 <- ave(ModelDFSL_VMC9$HUM_VMC9, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMC9$MGrowth_IOM_VMC9 <- ave(ModelDFSL_VMC9$IOM_VMC9, FUN = function(x) c(0, diff(x)))

#Create column for Monthly and Accumulated C-CO2 emissions
ModelDFSL_VMC9$M_CCO2_VMC9 <- ModelDFSL_VMC9$MInput_VMC9 - ModelDFSL_VMC9$MGrowth_DPM_VMC9 - ModelDFSL_VMC9$MGrowth_RPM_VMC9 - ModelDFSL_VMC9$MGrowth_BIO_VMC9 - ModelDFSL_VMC9$MGrowth_HUM_VMC9
ModelDFSL_VMC9$Accum_CCO2_VMC9 <- ModelDFSL_VMC9$AccumInput_VMC9 - ModelDFSL_VMC9$AllPools_noIOM_VMC9

#Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
ModelDFSL_VMC9$M_CCO2_VMC9[1] <- 0
ModelDFSL_VMC9$Accum_CCO2_VMC9[1] <- 0

#Balance validation
ModelDFSL_VMC9$Balance_VMC9 <- ModelDFSL_VMC9$AccumInput_VMC9 - ModelDFSL_VMC9$Accum_CCO2_VMC9 - (ModelDFSL_VMC9$DPM_VMC9 + ModelDFSL_VMC9$RPM_VMC9 + ModelDFSL_VMC9$BIO_VMC9 + ModelDFSL_VMC9$HUM_VMC9)

#Convert C-CO2 emissions into CO2 emissions
ModelDFSL_VMC9$M_CO2_VMC9 <- ModelDFSL_VMC9$M_CCO2_VMC9 * 44/12
ModelDFSL_VMC9$Accum_CO2_VMC9 <- ModelDFSL_VMC9$Accum_CCO2_VMC9 * 44/12

#This model will be called VMC9C because implies a continuous input of C
ModelDFSL_VMC9C <- ModelDFSL_VMC9

#Export the dataframe
write_xlsx(ModelDFSL_VMC9C,"VXC_Models\\ModelDFSL_R_VMC9C.xlsx")

#Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
#Create two equal models by using the above general script
#Create model t=x
ModelDFSLt0_VMC9 <- ModelDFSL_VMC9 #Create model t=x

#Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
ModelDFSLt1_VMC9.1 <- rbind(c(0:0), ModelDFSLt0_VMC9)
ModelDFSLt1_VMC9.2 <- rbind(c(0:0), ModelDFSLt1_VMC9.1)
ModelDFSLt1_VMC9.3 <- rbind(c(0:0), ModelDFSLt1_VMC9.2)
ModelDFSLt1_VMC9.4 <- rbind(c(0:0), ModelDFSLt1_VMC9.3)
ModelDFSLt1_VMC9.5 <- rbind(c(0:0), ModelDFSLt1_VMC9.4)
ModelDFSLt1_VMC9.6 <- rbind(c(0:0), ModelDFSLt1_VMC9.5)
ModelDFSLt1_VMC9.7 <- rbind(c(0:0), ModelDFSLt1_VMC9.6)
ModelDFSLt1_VMC9.8 <- rbind(c(0:0), ModelDFSLt1_VMC9.7)
ModelDFSLt1_VMC9.9 <- rbind(c(0:0), ModelDFSLt1_VMC9.8)
ModelDFSLt1_VMC9.10 <- rbind(c(0:0), ModelDFSLt1_VMC9.9)
ModelDFSLt1_VMC9.11 <- rbind(c(0:0), ModelDFSLt1_VMC9.10)
ModelDFSLt1_VMC9.12 <- rbind(c(0:0), ModelDFSLt1_VMC9.11)
ModelDFSLt1_VMC9.13 <- ModelDFSLt1_VMC9.12[-nrow(ModelDFSLt1_VMC9.12),]
ModelDFSLt1_VMC9.14 <- ModelDFSLt1_VMC9.13[-nrow(ModelDFSLt1_VMC9.13),]
ModelDFSLt1_VMC9.15 <- ModelDFSLt1_VMC9.14[-nrow(ModelDFSLt1_VMC9.14),]
ModelDFSLt1_VMC9.16 <- ModelDFSLt1_VMC9.15[-nrow(ModelDFSLt1_VMC9.15),]
ModelDFSLt1_VMC9.17 <- ModelDFSLt1_VMC9.16[-nrow(ModelDFSLt1_VMC9.16),]
ModelDFSLt1_VMC9.18 <- ModelDFSLt1_VMC9.17[-nrow(ModelDFSLt1_VMC9.17),]
ModelDFSLt1_VMC9.19 <- ModelDFSLt1_VMC9.18[-nrow(ModelDFSLt1_VMC9.18),]
ModelDFSLt1_VMC9.20 <- ModelDFSLt1_VMC9.19[-nrow(ModelDFSLt1_VMC9.19),]
ModelDFSLt1_VMC9.21 <- ModelDFSLt1_VMC9.20[-nrow(ModelDFSLt1_VMC9.20),]
ModelDFSLt1_VMC9.22 <- ModelDFSLt1_VMC9.21[-nrow(ModelDFSLt1_VMC9.21),]
ModelDFSLt1_VMC9.23 <- ModelDFSLt1_VMC9.22[-nrow(ModelDFSLt1_VMC9.22),]
ModelDFSLt1_VMC9.24 <- ModelDFSLt1_VMC9.23[-nrow(ModelDFSLt1_VMC9.23),]

ModelDFSLt1_VMC9 <- ModelDFSLt1_VMC9.24 #Create model t=x+1

#Subtract model (t=x) - (t=x+1)
ModelDFSL1y_VMC9 <- ModelDFSLt0_VMC9 - ModelDFSLt1_VMC9

#Re-do Month Number column because the substraction was also applied to it
ModelDFSL1y_VMC9$MNumber <- seq(from = 1, to = SimulationLength_months)

#This model will be called VMC9P because implies a one-off input of C
ModelDFSL_VMC9P <- ModelDFSL1y_VMC9

#Export the dataframe
write_xlsx(ModelDFSL_VMC9P,"VXP_Models\\ModelDFSL_R_VMC9P.xlsx")


#Plot 3: Interactive Yearly CO2 emissions #
MY <- 12
ModelDFSL_VMC9P_YCO2 <- ModelDFSL_VMC9P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VMC9)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMC9P_YCO2) <- c("Year", "Months", "AnnualCO2_VMC_9")

#Plot 3: Interactive Yearly CO2 emissions considering a delay
GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
ModelDFSL_VMC9P_YCO2D <- merge(ModelDFSL_VMC9P_YCO2, GWP100delay, by = "Year")
ModelDFSL_VMC9P_YCO2D$AnnualCO2D_VMC_9 <- ModelDFSL_VMC9P_YCO2D$AnnualCO2_VMC_9 * ModelDFSL_VMC9P_YCO2D$GWP100


#Plot 4: Interactive Yearly C emissions #
MY <- 12
ModelDFSL_VMC9P_YC <- ModelDFSL_VMC9P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VMC9)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMC9P_YC) <- c("Year", "Months", "CEmissions_VMC_9")

#Plot 5: Interactive Yearly C tails (remaining C in Soil) #
MY <- 12
ModelDFSL_VMC9P_YCT <- ModelDFSL_VMC9P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VMC9)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMC9P_YCT) <- c("Year", "Months", "CTail_VMC_9")

#Save Dataframes for Plots 3.1, 3.2, 4 and 5
write_xlsx(ModelDFSL_VMC9P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VMC9P.xlsx") #Yearly CO2 emissions (no delay)
write_xlsx(ModelDFSL_VMC9P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VMC9P.xlsx") #Yearly CO2 emissions (delay)
write_xlsx(ModelDFSL_VMC9P_YC,"CEmissions_P\\ModelDFSL_R_CE_VMC9P.xlsx") #Yearly C emissions
write_xlsx(ModelDFSL_VMC9P_YCT,"CTails_P\\ModelDFSL_R_CT_VMC9P.xlsx") #Yearly C emissions



#### 10.11 - VMC10) Manure; 100%clay; Conventional tillage ####
#The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
fT_VMC10=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
fW_VMC10=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                         S.Thick = soil.thick, pClay = clay100,
                         pE = 1.0, bare = FALSE)$b #Moisture effects per month
xi.frame_VMC10=data.frame(years,rep(fT_VMC10*fW_VMC10,length.out=length(years)))

#To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
Model_VMC10=SoilR::RothCModel(
  t=years, #Simulation Length
  ks=c(k.DPM = 10*CTRM, k.RPM = 0.3*CTRM, k.BIO = 0.66*CTRM, k.HUM = 0.02*CTRM, k.IOM = 0*CTRM), #Decomposition rates for the different pools
  C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
  In=Scalar_LitterCinputs*0, #Amount of litter inputs by time
  FYM = Scalar_ManureCinputs*1, #Amount of Farm Yard Manure by time
  clay=clay100, #Percent clay in mineral soil
  xi=xi.frame_VMC10) #Loads the model

Ct_VMC10=getC(Model_VMC10) #Calculates stocks for each pool per month

#The results can be plotted with the commands
matplot(years, Ct_VMC10, type="l", lty=1, col=1:5,
        xlab="Time (years)", ylab="C stocks (Mg/ha)")
legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
       lty=1, col=1:5, bty="n")

VEC_Lit_VMC10 <- rep(M_Scalar_LitterCinputs*0, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
VEC_Man_VMC10 <- rep(M_Scalar_ManureCinputs*1, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

VEC_LitDF_VMC10 <- as.data.frame(VEC_Lit_VMC10) #Converting the Litter vector to a data frame
VEC_LitDF_VMC10$MNumber <- seq(from = 1, to = SimulationLength_months)
VEC_ManDF_VMC10 <- as.data.frame(VEC_Man_VMC10) #Converting the Manure vector to a data frame
VEC_ManDF_VMC10$MNumber <- seq(from = 1, to = SimulationLength_months)

sapply(VEC_LitDF_VMC10, class) #Check that class is numeric
sapply(VEC_ManDF_VMC10, class) #Check that class is numeric
LitterCinputs_VMC10=VEC_LitDF_VMC10   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
ManureCinputs_VMC10=VEC_ManDF_VMC10 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
MCinputs_VMC10 <- merge(LitterCinputs_VMC10, ManureCinputs_VMC10, by = "MNumber")
MCinputs_VMC10$MInput_VMC10 <- MCinputs_VMC10$VEC_Lit_VMC10 + MCinputs_VMC10$VEC_Man_VMC10

#Change names of litter and manure columns for more common ones
colnames(MCinputs_VMC10)[which(names(MCinputs_VMC10) == "VEC_Lit_VMC10")] <- "LitterC_VMC10"
colnames(MCinputs_VMC10)[which(names(MCinputs_VMC10) == "VEC_Man_VMC10")] <- "ManureC_VMC10"

#Create a dataframe with the data considering the simulation length
ModelDF_VMC10 <- as.data.frame(Ct_VMC10)
colnames(ModelDF_VMC10) <- c('DPM_VMC10','RPM_VMC10','BIO_VMC10', 'HUM_VMC10', 'IOM_VMC10')
ModelDFS_VMC10 <- ModelDF_VMC10[1:SimulationLength_months, ]

#Create a column with the number of month of analysis
ModelDFS_VMC10$MNumber <- seq(from = 1, to = SimulationLength_months)

#Create a column that sums all pools
ModelDFS_VMC10$AllPools_VMC10 <- ModelDFS_VMC10$DPM_VMC10 + ModelDFS_VMC10$RPM_VMC10 + ModelDFS_VMC10$BIO_VMC10 + ModelDFS_VMC10$HUM_VMC10 + ModelDFS_VMC10$IOM_VMC10

#Create a column that sums all pools except IOM (static)
ModelDFS_VMC10$AllPools_noIOM_VMC10 <- ModelDFS_VMC10$DPM_VMC10 + ModelDFS_VMC10$RPM_VMC10 + ModelDFS_VMC10$BIO_VMC10 + ModelDFS_VMC10$HUM_VMC10

#Create a column that add the monthly input of C (manure and litter separately)
ModelDFSL_VMC10 <- merge(ModelDFS_VMC10, MCinputs_VMC10, by = "MNumber")

ModelDFSL_VMC10$MInput_VMC10 <- ModelDFSL_VMC10$LitterC_VMC10 + ModelDFSL_VMC10$ManureC_VMC10
#ModelDF_SL$MInput[1] <- 0

#Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
ModelDFSL_VMC10$CTails_VMC10 <- ModelDFSL_VMC10$AllPools_noIOM_VMC10 + ModelDFSL_VMC10$MInput_VMC10

#Create Monthly Accumulated input of C
ModelDFSL_VMC10$AccumInput_VMC10 = ModelDFSL_VMC10$AccumInput_VMC10=cumsum(ModelDFSL_VMC10$MInput_VMC10)

#Create Monthly Growths for each carbon pool
ModelDFSL_VMC10$MGrowth_DPM_VMC10 <- ave(ModelDFSL_VMC10$DPM_VMC10, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMC10$MGrowth_RPM_VMC10 <- ave(ModelDFSL_VMC10$RPM_VMC10, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMC10$MGrowth_BIO_VMC10 <- ave(ModelDFSL_VMC10$BIO_VMC10, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMC10$MGrowth_HUM_VMC10 <- ave(ModelDFSL_VMC10$HUM_VMC10, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMC10$MGrowth_IOM_VMC10 <- ave(ModelDFSL_VMC10$IOM_VMC10, FUN = function(x) c(0, diff(x)))

#Create column for Monthly and Accumulated C-CO2 emissions
ModelDFSL_VMC10$M_CCO2_VMC10 <- ModelDFSL_VMC10$MInput_VMC10 - ModelDFSL_VMC10$MGrowth_DPM_VMC10 - ModelDFSL_VMC10$MGrowth_RPM_VMC10 - ModelDFSL_VMC10$MGrowth_BIO_VMC10 - ModelDFSL_VMC10$MGrowth_HUM_VMC10
ModelDFSL_VMC10$Accum_CCO2_VMC10 <- ModelDFSL_VMC10$AccumInput_VMC10 - ModelDFSL_VMC10$AllPools_noIOM_VMC10

#Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
ModelDFSL_VMC10$M_CCO2_VMC10[1] <- 0
ModelDFSL_VMC10$Accum_CCO2_VMC10[1] <- 0

#Balance validation
ModelDFSL_VMC10$Balance_VMC10 <- ModelDFSL_VMC10$AccumInput_VMC10 - ModelDFSL_VMC10$Accum_CCO2_VMC10 - (ModelDFSL_VMC10$DPM_VMC10 + ModelDFSL_VMC10$RPM_VMC10 + ModelDFSL_VMC10$BIO_VMC10 + ModelDFSL_VMC10$HUM_VMC10)

#Convert C-CO2 emissions into CO2 emissions
ModelDFSL_VMC10$M_CO2_VMC10 <- ModelDFSL_VMC10$M_CCO2_VMC10 * 44/12
ModelDFSL_VMC10$Accum_CO2_VMC10 <- ModelDFSL_VMC10$Accum_CCO2_VMC10 * 44/12

#This model will be called VMC10C because implies a continuous input of C
ModelDFSL_VMC10C <- ModelDFSL_VMC10

#Export the dataframe
write_xlsx(ModelDFSL_VMC10C,"VXC_Models\\ModelDFSL_R_VMC10C.xlsx")

#Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
#Create two equal models by using the above general script
#Create model t=x
ModelDFSLt0_VMC10 <- ModelDFSL_VMC10 #Create model t=x

#Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
ModelDFSLt1_VMC10.1 <- rbind(c(0:0), ModelDFSLt0_VMC10)
ModelDFSLt1_VMC10.2 <- rbind(c(0:0), ModelDFSLt1_VMC10.1)
ModelDFSLt1_VMC10.3 <- rbind(c(0:0), ModelDFSLt1_VMC10.2)
ModelDFSLt1_VMC10.4 <- rbind(c(0:0), ModelDFSLt1_VMC10.3)
ModelDFSLt1_VMC10.5 <- rbind(c(0:0), ModelDFSLt1_VMC10.4)
ModelDFSLt1_VMC10.6 <- rbind(c(0:0), ModelDFSLt1_VMC10.5)
ModelDFSLt1_VMC10.7 <- rbind(c(0:0), ModelDFSLt1_VMC10.6)
ModelDFSLt1_VMC10.8 <- rbind(c(0:0), ModelDFSLt1_VMC10.7)
ModelDFSLt1_VMC10.9 <- rbind(c(0:0), ModelDFSLt1_VMC10.8)
ModelDFSLt1_VMC10.10 <- rbind(c(0:0), ModelDFSLt1_VMC10.9)
ModelDFSLt1_VMC10.11 <- rbind(c(0:0), ModelDFSLt1_VMC10.10)
ModelDFSLt1_VMC10.12 <- rbind(c(0:0), ModelDFSLt1_VMC10.11)
ModelDFSLt1_VMC10.13 <- ModelDFSLt1_VMC10.12[-nrow(ModelDFSLt1_VMC10.12),]
ModelDFSLt1_VMC10.14 <- ModelDFSLt1_VMC10.13[-nrow(ModelDFSLt1_VMC10.13),]
ModelDFSLt1_VMC10.15 <- ModelDFSLt1_VMC10.14[-nrow(ModelDFSLt1_VMC10.14),]
ModelDFSLt1_VMC10.16 <- ModelDFSLt1_VMC10.15[-nrow(ModelDFSLt1_VMC10.15),]
ModelDFSLt1_VMC10.17 <- ModelDFSLt1_VMC10.16[-nrow(ModelDFSLt1_VMC10.16),]
ModelDFSLt1_VMC10.18 <- ModelDFSLt1_VMC10.17[-nrow(ModelDFSLt1_VMC10.17),]
ModelDFSLt1_VMC10.19 <- ModelDFSLt1_VMC10.18[-nrow(ModelDFSLt1_VMC10.18),]
ModelDFSLt1_VMC10.20 <- ModelDFSLt1_VMC10.19[-nrow(ModelDFSLt1_VMC10.19),]
ModelDFSLt1_VMC10.21 <- ModelDFSLt1_VMC10.20[-nrow(ModelDFSLt1_VMC10.20),]
ModelDFSLt1_VMC10.22 <- ModelDFSLt1_VMC10.21[-nrow(ModelDFSLt1_VMC10.21),]
ModelDFSLt1_VMC10.23 <- ModelDFSLt1_VMC10.22[-nrow(ModelDFSLt1_VMC10.22),]
ModelDFSLt1_VMC10.24 <- ModelDFSLt1_VMC10.23[-nrow(ModelDFSLt1_VMC10.23),]

ModelDFSLt1_VMC10 <- ModelDFSLt1_VMC10.24 #Create model t=x+1

#Subtract model (t=x) - (t=x+1)
ModelDFSL1y_VMC10 <- ModelDFSLt0_VMC10 - ModelDFSLt1_VMC10

#Re-do Month Number column because the substraction was also applied to it
ModelDFSL1y_VMC10$MNumber <- seq(from = 1, to = SimulationLength_months)

#This model will be called VMC10P because implies a one-off input of C
ModelDFSL_VMC10P <- ModelDFSL1y_VMC10

#Export the dataframe
write_xlsx(ModelDFSL_VMC10P,"VXP_Models\\ModelDFSL_R_VMC10P.xlsx")


#Plot 3: Interactive Yearly CO2 emissions #
MY <- 12
ModelDFSL_VMC10P_YCO2 <- ModelDFSL_VMC10P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VMC10)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMC10P_YCO2) <- c("Year", "Months", "AnnualCO2_VMC10")

#Plot 3: Interactive Yearly CO2 emissions considering a delay
GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
ModelDFSL_VMC10P_YCO2D <- merge(ModelDFSL_VMC10P_YCO2, GWP100delay, by = "Year")
ModelDFSL_VMC10P_YCO2D$AnnualCO2D_VMC10 <- ModelDFSL_VMC10P_YCO2D$AnnualCO2_VMC10 * ModelDFSL_VMC10P_YCO2D$GWP100

#Plot 4: Interactive Yearly C emissions #
MY <- 12
ModelDFSL_VMC10P_YC <- ModelDFSL_VMC10P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VMC10)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMC10P_YC) <- c("Year", "Months", "CEmissions_VMC10")

#Plot 5: Interactive Yearly C tails (remaining C in Soil) #
MY <- 12
ModelDFSL_VMC10P_YCT <- ModelDFSL_VMC10P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VMC10)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMC10P_YCT) <- c("Year", "Months", "CTail_VMC10")

#Save Dataframes for Plots 3.1, 3.2, 4 and 5
write_xlsx(ModelDFSL_VMC10P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VMC10P.xlsx") #Yearly CO2 emissions (no delay)
write_xlsx(ModelDFSL_VMC10P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VMC10P.xlsx") #Yearly CO2 emissions (delay)
write_xlsx(ModelDFSL_VMC10P_YC,"CEmissions_P\\ModelDFSL_R_CE_VMC10P.xlsx") #Yearly C emissions
write_xlsx(ModelDFSL_VMC10P_YCT,"CTails_P\\ModelDFSL_R_CT_VMC10P.xlsx") #Yearly C emissions

#### - ####
#### 11) Model Combinations - Manure; Reduced Tillage, 0-100% (+10%) Clay ####
#### 11.1 - VMR0) Manure; 0%clay; Reduced Tillage ####
#The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
fT_VMR0=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
fW_VMR0=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                        S.Thick = soil.thick, pClay = clay0,
                        pE = 1.0, bare = FALSE)$b #Moisture effects per month
xi.frame_VMR0=data.frame(years,rep(fT_VMR0*fW_VMR0,length.out=length(years)))

#To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
Model_VMR0=SoilR::RothCModel(
  t=years, #Simulation Length
  ks=c(k.DPM = 10*RTRM, k.RPM = 0.3*RTRM, k.BIO = 0.66*RTRM, k.HUM = 0.02*RTRM, k.IOM = 0*RTRM), #Decomposition rates for the different pools
  C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
  In=Scalar_LitterCinputs*0, #Amount of litter inputs by time
  FYM = Scalar_ManureCinputs*1, #Amount of Farm Yard Manure by time
  clay=clay0, #Percent clay in mineral soil
  xi=xi.frame_VMR0) #Loads the model

Ct_VMR0=getC(Model_VMR0) #Calculates stocks for each pool per month

VEC_Lit_VMR0 <- rep(M_Scalar_LitterCinputs*0, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
VEC_Man_VMR0 <- rep(M_Scalar_ManureCinputs*1, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

VEC_LitDF_VMR0 <- as.data.frame(VEC_Lit_VMR0) #Converting the Litter vector to a data frame
VEC_LitDF_VMR0$MNumber <- seq(from = 1, to = SimulationLength_months)
VEC_ManDF_VMR0 <- as.data.frame(VEC_Man_VMR0) #Converting the Manure vector to a data frame
VEC_ManDF_VMR0$MNumber <- seq(from = 1, to = SimulationLength_months)

sapply(VEC_LitDF_VMR0, class) #Check that class is numeric
sapply(VEC_ManDF_VMR0, class) #Check that class is numeric
LitterCinputs_VMR0=VEC_LitDF_VMR0   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
ManureCinputs_VMR0=VEC_ManDF_VMR0 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
MCinputs_VMR0 <- merge(LitterCinputs_VMR0, ManureCinputs_VMR0, by = "MNumber")
MCinputs_VMR0$MInput_VMR0 <- MCinputs_VMR0$VEC_Lit_VMR0 + MCinputs_VMR0$VEC_Man_VMR0

#Change names of litter and manure columns for more common ones
colnames(MCinputs_VMR0)[which(names(MCinputs_VMR0) == "VEC_Lit_VMR0")] <- "LitterC_VMR0"
colnames(MCinputs_VMR0)[which(names(MCinputs_VMR0) == "VEC_Man_VMR0")] <- "ManureC_VMR0"

#Create a dataframe with the data considering the simulation length
ModelDF_VMR0 <- as.data.frame(Ct_VMR0)
colnames(ModelDF_VMR0) <- c('DPM_VMR0','RPM_VMR0','BIO_VMR0', 'HUM_VMR0', 'IOM_VMR0')
ModelDFS_VMR0 <- ModelDF_VMR0[1:SimulationLength_months, ]

#Create a column with the number of month of analysis
ModelDFS_VMR0$MNumber <- seq(from = 1, to = SimulationLength_months)

#Create a column that sums all pools
ModelDFS_VMR0$AllPools_VMR0 <- ModelDFS_VMR0$DPM_VMR0 + ModelDFS_VMR0$RPM_VMR0 + ModelDFS_VMR0$BIO_VMR0 + ModelDFS_VMR0$HUM_VMR0 + ModelDFS_VMR0$IOM_VMR0

#Create a column that sums all pools except IOM (static)
ModelDFS_VMR0$AllPools_noIOM_VMR0 <- ModelDFS_VMR0$DPM_VMR0 + ModelDFS_VMR0$RPM_VMR0 + ModelDFS_VMR0$BIO_VMR0 + ModelDFS_VMR0$HUM_VMR0

#Create a column that add the monthly input of C (manure and litter separately)
ModelDFSL_VMR0 <- merge(ModelDFS_VMR0, MCinputs_VMR0, by = "MNumber")

ModelDFSL_VMR0$MInput_VMR0 <- ModelDFSL_VMR0$LitterC_VMR0 + ModelDFSL_VMR0$ManureC_VMR0
#ModelDF_SL$MInput[1] <- 0

#Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
ModelDFSL_VMR0$CTails_VMR0 <- ModelDFSL_VMR0$AllPools_noIOM_VMR0 + ModelDFSL_VMR0$MInput_VMR0

#Create Monthly Accumulated input of C
ModelDFSL_VMR0$AccumInput_VMR0 = ModelDFSL_VMR0$AccumInput_VMR0=cumsum(ModelDFSL_VMR0$MInput_VMR0)

#Create Monthly Growths for each carbon pool
ModelDFSL_VMR0$MGrowth_DPM_VMR0 <- ave(ModelDFSL_VMR0$DPM_VMR0, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMR0$MGrowth_RPM_VMR0 <- ave(ModelDFSL_VMR0$RPM_VMR0, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMR0$MGrowth_BIO_VMR0 <- ave(ModelDFSL_VMR0$BIO_VMR0, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMR0$MGrowth_HUM_VMR0 <- ave(ModelDFSL_VMR0$HUM_VMR0, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMR0$MGrowth_IOM_VMR0 <- ave(ModelDFSL_VMR0$IOM_VMR0, FUN = function(x) c(0, diff(x)))

#Create column for Monthly and Accumulated C-CO2 emissions
ModelDFSL_VMR0$M_CCO2_VMR0 <- ModelDFSL_VMR0$MInput_VMR0 - ModelDFSL_VMR0$MGrowth_DPM_VMR0 - ModelDFSL_VMR0$MGrowth_RPM_VMR0 - ModelDFSL_VMR0$MGrowth_BIO_VMR0 - ModelDFSL_VMR0$MGrowth_HUM_VMR0
ModelDFSL_VMR0$Accum_CCO2_VMR0 <- ModelDFSL_VMR0$AccumInput_VMR0 - ModelDFSL_VMR0$AllPools_noIOM_VMR0

#Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
ModelDFSL_VMR0$M_CCO2_VMR0[1] <- 0
ModelDFSL_VMR0$Accum_CCO2_VMR0[1] <- 0

#Balance validation
ModelDFSL_VMR0$Balance_VMR0 <- ModelDFSL_VMR0$AccumInput_VMR0 - ModelDFSL_VMR0$Accum_CCO2_VMR0 - (ModelDFSL_VMR0$DPM_VMR0 + ModelDFSL_VMR0$RPM_VMR0 + ModelDFSL_VMR0$BIO_VMR0 + ModelDFSL_VMR0$HUM_VMR0)

#Convert C-CO2 emissions into CO2 emissions
ModelDFSL_VMR0$M_CO2_VMR0 <- ModelDFSL_VMR0$M_CCO2_VMR0 * 44/12
ModelDFSL_VMR0$Accum_CO2_VMR0 <- ModelDFSL_VMR0$Accum_CCO2_VMR0 * 44/12

#This model will be called VMR0C because implies a continuous input of C
ModelDFSL_VMR0C <- ModelDFSL_VMR0

#Export the dataframe
write_xlsx(ModelDFSL_VMR0C,"VXC_Models\\ModelDFSL_R_VMR0C.xlsx")

#Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
#Create two equal models by using the above general script
#Create model t=x
ModelDFSLt0_VMR0 <- ModelDFSL_VMR0 #Create model t=x

#Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
ModelDFSLt1_VMR0.1 <- rbind(c(0:0), ModelDFSLt0_VMR0)
ModelDFSLt1_VMR0.2 <- rbind(c(0:0), ModelDFSLt1_VMR0.1)
ModelDFSLt1_VMR0.3 <- rbind(c(0:0), ModelDFSLt1_VMR0.2)
ModelDFSLt1_VMR0.4 <- rbind(c(0:0), ModelDFSLt1_VMR0.3)
ModelDFSLt1_VMR0.5 <- rbind(c(0:0), ModelDFSLt1_VMR0.4)
ModelDFSLt1_VMR0.6 <- rbind(c(0:0), ModelDFSLt1_VMR0.5)
ModelDFSLt1_VMR0.7 <- rbind(c(0:0), ModelDFSLt1_VMR0.6)
ModelDFSLt1_VMR0.8 <- rbind(c(0:0), ModelDFSLt1_VMR0.7)
ModelDFSLt1_VMR0.9 <- rbind(c(0:0), ModelDFSLt1_VMR0.8)
ModelDFSLt1_VMR0.10 <- rbind(c(0:0), ModelDFSLt1_VMR0.9)
ModelDFSLt1_VMR0.11 <- rbind(c(0:0), ModelDFSLt1_VMR0.10)
ModelDFSLt1_VMR0.12 <- rbind(c(0:0), ModelDFSLt1_VMR0.11)
ModelDFSLt1_VMR0.13 <- ModelDFSLt1_VMR0.12[-nrow(ModelDFSLt1_VMR0.12),]
ModelDFSLt1_VMR0.14 <- ModelDFSLt1_VMR0.13[-nrow(ModelDFSLt1_VMR0.13),]
ModelDFSLt1_VMR0.15 <- ModelDFSLt1_VMR0.14[-nrow(ModelDFSLt1_VMR0.14),]
ModelDFSLt1_VMR0.16 <- ModelDFSLt1_VMR0.15[-nrow(ModelDFSLt1_VMR0.15),]
ModelDFSLt1_VMR0.17 <- ModelDFSLt1_VMR0.16[-nrow(ModelDFSLt1_VMR0.16),]
ModelDFSLt1_VMR0.18 <- ModelDFSLt1_VMR0.17[-nrow(ModelDFSLt1_VMR0.17),]
ModelDFSLt1_VMR0.19 <- ModelDFSLt1_VMR0.18[-nrow(ModelDFSLt1_VMR0.18),]
ModelDFSLt1_VMR0.20 <- ModelDFSLt1_VMR0.19[-nrow(ModelDFSLt1_VMR0.19),]
ModelDFSLt1_VMR0.21 <- ModelDFSLt1_VMR0.20[-nrow(ModelDFSLt1_VMR0.20),]
ModelDFSLt1_VMR0.22 <- ModelDFSLt1_VMR0.21[-nrow(ModelDFSLt1_VMR0.21),]
ModelDFSLt1_VMR0.23 <- ModelDFSLt1_VMR0.22[-nrow(ModelDFSLt1_VMR0.22),]
ModelDFSLt1_VMR0.24 <- ModelDFSLt1_VMR0.23[-nrow(ModelDFSLt1_VMR0.23),]

ModelDFSLt1_VMR0 <- ModelDFSLt1_VMR0.24 #Create model t=x+1

#Subtract model (t=x) - (t=x+1)
ModelDFSL1y_VMR0 <- ModelDFSLt0_VMR0 - ModelDFSLt1_VMR0

#Re-do Month Number column because the substraction was also applied to it
ModelDFSL1y_VMR0$MNumber <- seq(from = 1, to = SimulationLength_months)

#This model will be called VMR0P because implies a one-off input of C
ModelDFSL_VMR0P <- ModelDFSL1y_VMR0

#Export the dataframe
write_xlsx(ModelDFSL_VMR0P,"VXP_Models\\ModelDFSL_R_VMR0P.xlsx")

#Plot 3.1: Interactive Yearly CO2 emissions #
MY <- 12
ModelDFSL_VMR0P_YCO2 <- ModelDFSL_VMR0P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VMR0)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMR0P_YCO2) <- c("Year", "Months", "AnnualCO2_VMR_0")

#Plot 3.2: Interactive Yearly CO2 emissions considering a delay
GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
ModelDFSL_VMR0P_YCO2D <- merge(ModelDFSL_VMR0P_YCO2, GWP100delay, by = "Year")
ModelDFSL_VMR0P_YCO2D$AnnualCO2D_VMR_0 <- ModelDFSL_VMR0P_YCO2D$AnnualCO2_VMR_0 * ModelDFSL_VMR0P_YCO2D$GWP100

#Plot 4: Interactive Yearly C emissions #
MY <- 12
ModelDFSL_VMR0P_YC <- ModelDFSL_VMR0P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VMR0)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMR0P_YC) <- c("Year", "Months", "CEmissions_VMR_0")

#Plot 5: Interactive Yearly C tails (remaining C in Soil) #
MY <- 12
ModelDFSL_VMR0P_YCT <- ModelDFSL_VMR0P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VMR0)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMR0P_YCT) <- c("Year", "Months", "CTail_VMR_0")

#Save Dataframes for Plots 3.1, 3.2, 4 and 5
write_xlsx(ModelDFSL_VMR0P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VMR0P.xlsx") #Yearly CO2 emissions (no delay)
write_xlsx(ModelDFSL_VMR0P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VMR0P.xlsx") #Yearly CO2 emissions (delay)
write_xlsx(ModelDFSL_VMR0P_YC,"CEmissions_P\\ModelDFSL_R_CE_VMR0P.xlsx") #Yearly C emissions
write_xlsx(ModelDFSL_VMR0P_YCT,"CTails_P\\ModelDFSL_R_CT_VMR0P.xlsx") #Yearly C emissions


#### 11.2 - VMR1) Manure; 10%clay; Reduced Tillage ####
#The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
fT_VMR1=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
fW_VMR1=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                        S.Thick = soil.thick, pClay = clay100*0.1,
                        pE = 1.0, bare = FALSE)$b #Moisture effects per month
xi.frame_VMR1=data.frame(years,rep(fT_VMR1*fW_VMR1,length.out=length(years)))

#To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
Model_VMR1=SoilR::RothCModel(
  t=years, #Simulation Length
  ks=c(k.DPM = 10*RTRM, k.RPM = 0.3*RTRM, k.BIO = 0.66*RTRM, k.HUM = 0.02*RTRM, k.IOM = 0*RTRM), #Decomposition rates for the different pools
  C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
  In=Scalar_LitterCinputs*0, #Amount of litter inputs by time
  FYM = Scalar_ManureCinputs*1, #Amount of Farm Yard Manure by time
  clay=clay100*0.1, #Percent clay in mineral soil
  xi=xi.frame_VMR1) #Loads the model

Ct_VMR1=getC(Model_VMR1) #Calculates stocks for each pool per month

#The results can be plotted with the commands
matplot(years, Ct_VMR1, type="l", lty=1, col=1:5,
        xlab="Time (years)", ylab="C stocks (Mg/ha)")
legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
       lty=1, col=1:5, bty="n")

VEC_Lit_VMR1 <- rep(M_Scalar_LitterCinputs*0, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
VEC_Man_VMR1 <- rep(M_Scalar_ManureCinputs*1, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

VEC_LitDF_VMR1 <- as.data.frame(VEC_Lit_VMR1) #Converting the Litter vector to a data frame
VEC_LitDF_VMR1$MNumber <- seq(from = 1, to = SimulationLength_months)
VEC_ManDF_VMR1 <- as.data.frame(VEC_Man_VMR1) #Converting the Manure vector to a data frame
VEC_ManDF_VMR1$MNumber <- seq(from = 1, to = SimulationLength_months)

sapply(VEC_LitDF_VMR1, class) #Check that class is numeric
sapply(VEC_ManDF_VMR1, class) #Check that class is numeric
LitterCinputs_VMR1=VEC_LitDF_VMR1   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
ManureCinputs_VMR1=VEC_ManDF_VMR1 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
MCinputs_VMR1 <- merge(LitterCinputs_VMR1, ManureCinputs_VMR1, by = "MNumber")
MCinputs_VMR1$MInput_VMR1 <- MCinputs_VMR1$VEC_Lit_VMR1 + MCinputs_VMR1$VEC_Man_VMR1

#Change names of litter and manure columns for more common ones
colnames(MCinputs_VMR1)[which(names(MCinputs_VMR1) == "VEC_Lit_VMR1")] <- "LitterC_VMR1"
colnames(MCinputs_VMR1)[which(names(MCinputs_VMR1) == "VEC_Man_VMR1")] <- "ManureC_VMR1"

#Create a dataframe with the data considering the simulation length
ModelDF_VMR1 <- as.data.frame(Ct_VMR1)
colnames(ModelDF_VMR1) <- c('DPM_VMR1','RPM_VMR1','BIO_VMR1', 'HUM_VMR1', 'IOM_VMR1')
ModelDFS_VMR1 <- ModelDF_VMR1[1:SimulationLength_months, ]

#Create a column with the number of month of analysis
ModelDFS_VMR1$MNumber <- seq(from = 1, to = SimulationLength_months)

#Create a column that sums all pools
ModelDFS_VMR1$AllPools_VMR1 <- ModelDFS_VMR1$DPM_VMR1 + ModelDFS_VMR1$RPM_VMR1 + ModelDFS_VMR1$BIO_VMR1 + ModelDFS_VMR1$HUM_VMR1 + ModelDFS_VMR1$IOM_VMR1

#Create a column that sums all pools except IOM (static)
ModelDFS_VMR1$AllPools_noIOM_VMR1 <- ModelDFS_VMR1$DPM_VMR1 + ModelDFS_VMR1$RPM_VMR1 + ModelDFS_VMR1$BIO_VMR1 + ModelDFS_VMR1$HUM_VMR1

#Create a column that add the monthly input of C (manure and litter separately)
ModelDFSL_VMR1 <- merge(ModelDFS_VMR1, MCinputs_VMR1, by = "MNumber")

ModelDFSL_VMR1$MInput_VMR1 <- ModelDFSL_VMR1$LitterC_VMR1 + ModelDFSL_VMR1$ManureC_VMR1
#ModelDF_SL$MInput[1] <- 0

#Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
ModelDFSL_VMR1$CTails_VMR1 <- ModelDFSL_VMR1$AllPools_noIOM_VMR1 + ModelDFSL_VMR1$MInput_VMR1

#Create Monthly Accumulated input of C
ModelDFSL_VMR1$AccumInput_VMR1 = ModelDFSL_VMR1$AccumInput_VMR1=cumsum(ModelDFSL_VMR1$MInput_VMR1)

#Create Monthly Growths for each carbon pool
ModelDFSL_VMR1$MGrowth_DPM_VMR1 <- ave(ModelDFSL_VMR1$DPM_VMR1, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMR1$MGrowth_RPM_VMR1 <- ave(ModelDFSL_VMR1$RPM_VMR1, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMR1$MGrowth_BIO_VMR1 <- ave(ModelDFSL_VMR1$BIO_VMR1, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMR1$MGrowth_HUM_VMR1 <- ave(ModelDFSL_VMR1$HUM_VMR1, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMR1$MGrowth_IOM_VMR1 <- ave(ModelDFSL_VMR1$IOM_VMR1, FUN = function(x) c(0, diff(x)))

#Create column for Monthly and Accumulated C-CO2 emissions
ModelDFSL_VMR1$M_CCO2_VMR1 <- ModelDFSL_VMR1$MInput_VMR1 - ModelDFSL_VMR1$MGrowth_DPM_VMR1 - ModelDFSL_VMR1$MGrowth_RPM_VMR1 - ModelDFSL_VMR1$MGrowth_BIO_VMR1 - ModelDFSL_VMR1$MGrowth_HUM_VMR1
ModelDFSL_VMR1$Accum_CCO2_VMR1 <- ModelDFSL_VMR1$AccumInput_VMR1 - ModelDFSL_VMR1$AllPools_noIOM_VMR1

#Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
ModelDFSL_VMR1$M_CCO2_VMR1[1] <- 0
ModelDFSL_VMR1$Accum_CCO2_VMR1[1] <- 0

#Balance validation
ModelDFSL_VMR1$Balance_VMR1 <- ModelDFSL_VMR1$AccumInput_VMR1 - ModelDFSL_VMR1$Accum_CCO2_VMR1 - (ModelDFSL_VMR1$DPM_VMR1 + ModelDFSL_VMR1$RPM_VMR1 + ModelDFSL_VMR1$BIO_VMR1 + ModelDFSL_VMR1$HUM_VMR1)

#Convert C-CO2 emissions into CO2 emissions
ModelDFSL_VMR1$M_CO2_VMR1 <- ModelDFSL_VMR1$M_CCO2_VMR1 * 44/12
ModelDFSL_VMR1$Accum_CO2_VMR1 <- ModelDFSL_VMR1$Accum_CCO2_VMR1 * 44/12

#This model will be called VMR1C because implies a continuous input of C
ModelDFSL_VMR1C <- ModelDFSL_VMR1

#Export the dataframe
write_xlsx(ModelDFSL_VMR1C,"VXC_Models\\ModelDFSL_R_VMR1C.xlsx")

#Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
#Create two equal models by using the above general script
#Create model t=x
ModelDFSLt0_VMR1 <- ModelDFSL_VMR1 #Create model t=x

#Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
ModelDFSLt1_VMR1.1 <- rbind(c(0:0), ModelDFSLt0_VMR1)
ModelDFSLt1_VMR1.2 <- rbind(c(0:0), ModelDFSLt1_VMR1.1)
ModelDFSLt1_VMR1.3 <- rbind(c(0:0), ModelDFSLt1_VMR1.2)
ModelDFSLt1_VMR1.4 <- rbind(c(0:0), ModelDFSLt1_VMR1.3)
ModelDFSLt1_VMR1.5 <- rbind(c(0:0), ModelDFSLt1_VMR1.4)
ModelDFSLt1_VMR1.6 <- rbind(c(0:0), ModelDFSLt1_VMR1.5)
ModelDFSLt1_VMR1.7 <- rbind(c(0:0), ModelDFSLt1_VMR1.6)
ModelDFSLt1_VMR1.8 <- rbind(c(0:0), ModelDFSLt1_VMR1.7)
ModelDFSLt1_VMR1.9 <- rbind(c(0:0), ModelDFSLt1_VMR1.8)
ModelDFSLt1_VMR1.10 <- rbind(c(0:0), ModelDFSLt1_VMR1.9)
ModelDFSLt1_VMR1.11 <- rbind(c(0:0), ModelDFSLt1_VMR1.10)
ModelDFSLt1_VMR1.12 <- rbind(c(0:0), ModelDFSLt1_VMR1.11)
ModelDFSLt1_VMR1.13 <- ModelDFSLt1_VMR1.12[-nrow(ModelDFSLt1_VMR1.12),]
ModelDFSLt1_VMR1.14 <- ModelDFSLt1_VMR1.13[-nrow(ModelDFSLt1_VMR1.13),]
ModelDFSLt1_VMR1.15 <- ModelDFSLt1_VMR1.14[-nrow(ModelDFSLt1_VMR1.14),]
ModelDFSLt1_VMR1.16 <- ModelDFSLt1_VMR1.15[-nrow(ModelDFSLt1_VMR1.15),]
ModelDFSLt1_VMR1.17 <- ModelDFSLt1_VMR1.16[-nrow(ModelDFSLt1_VMR1.16),]
ModelDFSLt1_VMR1.18 <- ModelDFSLt1_VMR1.17[-nrow(ModelDFSLt1_VMR1.17),]
ModelDFSLt1_VMR1.19 <- ModelDFSLt1_VMR1.18[-nrow(ModelDFSLt1_VMR1.18),]
ModelDFSLt1_VMR1.20 <- ModelDFSLt1_VMR1.19[-nrow(ModelDFSLt1_VMR1.19),]
ModelDFSLt1_VMR1.21 <- ModelDFSLt1_VMR1.20[-nrow(ModelDFSLt1_VMR1.20),]
ModelDFSLt1_VMR1.22 <- ModelDFSLt1_VMR1.21[-nrow(ModelDFSLt1_VMR1.21),]
ModelDFSLt1_VMR1.23 <- ModelDFSLt1_VMR1.22[-nrow(ModelDFSLt1_VMR1.22),]
ModelDFSLt1_VMR1.24 <- ModelDFSLt1_VMR1.23[-nrow(ModelDFSLt1_VMR1.23),]

ModelDFSLt1_VMR1 <- ModelDFSLt1_VMR1.24 #Create model t=x+1

#Subtract model (t=x) - (t=x+1)
ModelDFSL1y_VMR1 <- ModelDFSLt0_VMR1 - ModelDFSLt1_VMR1

#Re-do Month Number column because the substraction was also applied to it
ModelDFSL1y_VMR1$MNumber <- seq(from = 1, to = SimulationLength_months)

#This model will be called VMR1P because implies a one-off input of C
ModelDFSL_VMR1P <- ModelDFSL1y_VMR1

#Export the dataframe
write_xlsx(ModelDFSL_VMR1P,"VXP_Models\\ModelDFSL_R_VMR1P.xlsx")

#Plot 3: Interactive Yearly CO2 emissions #
MY <- 12
ModelDFSL_VMR1P_YCO2 <- ModelDFSL_VMR1P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VMR1)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMR1P_YCO2) <- c("Year", "Months", "AnnualCO2_VMR_1")

#Plot 3: Interactive Yearly CO2 emissions considering a delay
GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
ModelDFSL_VMR1P_YCO2D <- merge(ModelDFSL_VMR1P_YCO2, GWP100delay, by = "Year")
ModelDFSL_VMR1P_YCO2D$AnnualCO2D_VMR_1 <- ModelDFSL_VMR1P_YCO2D$AnnualCO2_VMR_1 * ModelDFSL_VMR1P_YCO2D$GWP100

#Plot 4: Interactive Yearly C emissions #
MY <- 12
ModelDFSL_VMR1P_YC <- ModelDFSL_VMR1P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VMR1)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMR1P_YC) <- c("Year", "Months", "CEmissions_VMR_1")

#Plot 5: Interactive Yearly C tails (remaining C in Soil) #
MY <- 12
ModelDFSL_VMR1P_YCT <- ModelDFSL_VMR1P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VMR1)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMR1P_YCT) <- c("Year", "Months", "CTail_VMR_1")

#Save Dataframes for Plots 3.1, 3.2, 4 and 5
write_xlsx(ModelDFSL_VMR1P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VMR1P.xlsx") #Yearly CO2 emissions (no delay)
write_xlsx(ModelDFSL_VMR1P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VMR1P.xlsx") #Yearly CO2 emissions (delay)
write_xlsx(ModelDFSL_VMR1P_YC,"CEmissions_P\\ModelDFSL_R_CE_VMR1P.xlsx") #Yearly C emissions
write_xlsx(ModelDFSL_VMR1P_YCT,"CTails_P\\ModelDFSL_R_CT_VMR1P.xlsx") #Yearly C emissions



#### 11.3 - VMR2) Manure; 20%clay; Reduced Tillage ####
#The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
fT_VMR2=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
fW_VMR2=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                        S.Thick = soil.thick, pClay = clay100*0.2,
                        pE = 1.0, bare = FALSE)$b #Moisture effects per month
xi.frame_VMR2=data.frame(years,rep(fT_VMR2*fW_VMR2,length.out=length(years)))

#To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
Model_VMR2=SoilR::RothCModel(
  t=years, #Simulation Length
  ks=c(k.DPM = 10*RTRM, k.RPM = 0.3*RTRM, k.BIO = 0.66*RTRM, k.HUM = 0.02*RTRM, k.IOM = 0*RTRM), #Decomposition rates for the different pools
  C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
  In=Scalar_LitterCinputs*0, #Amount of litter inputs by time
  FYM = Scalar_ManureCinputs*1, #Amount of Farm Yard Manure by time
  clay=clay100*0.2, #Percent clay in mineral soil
  xi=xi.frame_VMR2) #Loads the model

Ct_VMR2=getC(Model_VMR2) #Calculates stocks for each pool per month

#The results can be plotted with the commands
matplot(years, Ct_VMR2, type="l", lty=1, col=1:5,
        xlab="Time (years)", ylab="C stocks (Mg/ha)")
legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
       lty=1, col=1:5, bty="n")

VEC_Lit_VMR2 <- rep(M_Scalar_LitterCinputs*0, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
VEC_Man_VMR2 <- rep(M_Scalar_ManureCinputs*1, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

VEC_LitDF_VMR2 <- as.data.frame(VEC_Lit_VMR2) #Converting the Litter vector to a data frame
VEC_LitDF_VMR2$MNumber <- seq(from = 1, to = SimulationLength_months)
VEC_ManDF_VMR2 <- as.data.frame(VEC_Man_VMR2) #Converting the Manure vector to a data frame
VEC_ManDF_VMR2$MNumber <- seq(from = 1, to = SimulationLength_months)

sapply(VEC_LitDF_VMR2, class) #Check that class is numeric
sapply(VEC_ManDF_VMR2, class) #Check that class is numeric
LitterCinputs_VMR2=VEC_LitDF_VMR2   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
ManureCinputs_VMR2=VEC_ManDF_VMR2 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
MCinputs_VMR2 <- merge(LitterCinputs_VMR2, ManureCinputs_VMR2, by = "MNumber")
MCinputs_VMR2$MInput_VMR2 <- MCinputs_VMR2$VEC_Lit_VMR2 + MCinputs_VMR2$VEC_Man_VMR2

#Change names of litter and manure columns for more common ones
colnames(MCinputs_VMR2)[which(names(MCinputs_VMR2) == "VEC_Lit_VMR2")] <- "LitterC_VMR2"
colnames(MCinputs_VMR2)[which(names(MCinputs_VMR2) == "VEC_Man_VMR2")] <- "ManureC_VMR2"

#Create a dataframe with the data considering the simulation length
ModelDF_VMR2 <- as.data.frame(Ct_VMR2)
colnames(ModelDF_VMR2) <- c('DPM_VMR2','RPM_VMR2','BIO_VMR2', 'HUM_VMR2', 'IOM_VMR2')
ModelDFS_VMR2 <- ModelDF_VMR2[1:SimulationLength_months, ]

#Create a column with the number of month of analysis
ModelDFS_VMR2$MNumber <- seq(from = 1, to = SimulationLength_months)

#Create a column that sums all pools
ModelDFS_VMR2$AllPools_VMR2 <- ModelDFS_VMR2$DPM_VMR2 + ModelDFS_VMR2$RPM_VMR2 + ModelDFS_VMR2$BIO_VMR2 + ModelDFS_VMR2$HUM_VMR2 + ModelDFS_VMR2$IOM_VMR2

#Create a column that sums all pools except IOM (static)
ModelDFS_VMR2$AllPools_noIOM_VMR2 <- ModelDFS_VMR2$DPM_VMR2 + ModelDFS_VMR2$RPM_VMR2 + ModelDFS_VMR2$BIO_VMR2 + ModelDFS_VMR2$HUM_VMR2

#Create a column that add the monthly input of C (manure and litter separately)
ModelDFSL_VMR2 <- merge(ModelDFS_VMR2, MCinputs_VMR2, by = "MNumber")

ModelDFSL_VMR2$MInput_VMR2 <- ModelDFSL_VMR2$LitterC_VMR2 + ModelDFSL_VMR2$ManureC_VMR2
#ModelDF_SL$MInput[1] <- 0

#Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
ModelDFSL_VMR2$CTails_VMR2 <- ModelDFSL_VMR2$AllPools_noIOM_VMR2 + ModelDFSL_VMR2$MInput_VMR2

#Create Monthly Accumulated input of C
ModelDFSL_VMR2$AccumInput_VMR2 = ModelDFSL_VMR2$AccumInput_VMR2=cumsum(ModelDFSL_VMR2$MInput_VMR2)

#Create Monthly Growths for each carbon pool
ModelDFSL_VMR2$MGrowth_DPM_VMR2 <- ave(ModelDFSL_VMR2$DPM_VMR2, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMR2$MGrowth_RPM_VMR2 <- ave(ModelDFSL_VMR2$RPM_VMR2, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMR2$MGrowth_BIO_VMR2 <- ave(ModelDFSL_VMR2$BIO_VMR2, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMR2$MGrowth_HUM_VMR2 <- ave(ModelDFSL_VMR2$HUM_VMR2, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMR2$MGrowth_IOM_VMR2 <- ave(ModelDFSL_VMR2$IOM_VMR2, FUN = function(x) c(0, diff(x)))

#Create column for Monthly and Accumulated C-CO2 emissions
ModelDFSL_VMR2$M_CCO2_VMR2 <- ModelDFSL_VMR2$MInput_VMR2 - ModelDFSL_VMR2$MGrowth_DPM_VMR2 - ModelDFSL_VMR2$MGrowth_RPM_VMR2 - ModelDFSL_VMR2$MGrowth_BIO_VMR2 - ModelDFSL_VMR2$MGrowth_HUM_VMR2
ModelDFSL_VMR2$Accum_CCO2_VMR2 <- ModelDFSL_VMR2$AccumInput_VMR2 - ModelDFSL_VMR2$AllPools_noIOM_VMR2

#Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
ModelDFSL_VMR2$M_CCO2_VMR2[1] <- 0
ModelDFSL_VMR2$Accum_CCO2_VMR2[1] <- 0

#Balance validation
ModelDFSL_VMR2$Balance_VMR2 <- ModelDFSL_VMR2$AccumInput_VMR2 - ModelDFSL_VMR2$Accum_CCO2_VMR2 - (ModelDFSL_VMR2$DPM_VMR2 + ModelDFSL_VMR2$RPM_VMR2 + ModelDFSL_VMR2$BIO_VMR2 + ModelDFSL_VMR2$HUM_VMR2)

#Convert C-CO2 emissions into CO2 emissions
ModelDFSL_VMR2$M_CO2_VMR2 <- ModelDFSL_VMR2$M_CCO2_VMR2 * 44/12
ModelDFSL_VMR2$Accum_CO2_VMR2 <- ModelDFSL_VMR2$Accum_CCO2_VMR2 * 44/12

#This model will be called VMR2C because implies a continuous input of C
ModelDFSL_VMR2C <- ModelDFSL_VMR2

#Export the dataframe
write_xlsx(ModelDFSL_VMR2C,"VXC_Models\\ModelDFSL_R_VMR2C.xlsx")

#Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
#Create two equal models by using the above general script
#Create model t=x
ModelDFSLt0_VMR2 <- ModelDFSL_VMR2 #Create model t=x

#Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
ModelDFSLt1_VMR2.1 <- rbind(c(0:0), ModelDFSLt0_VMR2)
ModelDFSLt1_VMR2.2 <- rbind(c(0:0), ModelDFSLt1_VMR2.1)
ModelDFSLt1_VMR2.3 <- rbind(c(0:0), ModelDFSLt1_VMR2.2)
ModelDFSLt1_VMR2.4 <- rbind(c(0:0), ModelDFSLt1_VMR2.3)
ModelDFSLt1_VMR2.5 <- rbind(c(0:0), ModelDFSLt1_VMR2.4)
ModelDFSLt1_VMR2.6 <- rbind(c(0:0), ModelDFSLt1_VMR2.5)
ModelDFSLt1_VMR2.7 <- rbind(c(0:0), ModelDFSLt1_VMR2.6)
ModelDFSLt1_VMR2.8 <- rbind(c(0:0), ModelDFSLt1_VMR2.7)
ModelDFSLt1_VMR2.9 <- rbind(c(0:0), ModelDFSLt1_VMR2.8)
ModelDFSLt1_VMR2.10 <- rbind(c(0:0), ModelDFSLt1_VMR2.9)
ModelDFSLt1_VMR2.11 <- rbind(c(0:0), ModelDFSLt1_VMR2.10)
ModelDFSLt1_VMR2.12 <- rbind(c(0:0), ModelDFSLt1_VMR2.11)
ModelDFSLt1_VMR2.13 <- ModelDFSLt1_VMR2.12[-nrow(ModelDFSLt1_VMR2.12),]
ModelDFSLt1_VMR2.14 <- ModelDFSLt1_VMR2.13[-nrow(ModelDFSLt1_VMR2.13),]
ModelDFSLt1_VMR2.15 <- ModelDFSLt1_VMR2.14[-nrow(ModelDFSLt1_VMR2.14),]
ModelDFSLt1_VMR2.16 <- ModelDFSLt1_VMR2.15[-nrow(ModelDFSLt1_VMR2.15),]
ModelDFSLt1_VMR2.17 <- ModelDFSLt1_VMR2.16[-nrow(ModelDFSLt1_VMR2.16),]
ModelDFSLt1_VMR2.18 <- ModelDFSLt1_VMR2.17[-nrow(ModelDFSLt1_VMR2.17),]
ModelDFSLt1_VMR2.19 <- ModelDFSLt1_VMR2.18[-nrow(ModelDFSLt1_VMR2.18),]
ModelDFSLt1_VMR2.20 <- ModelDFSLt1_VMR2.19[-nrow(ModelDFSLt1_VMR2.19),]
ModelDFSLt1_VMR2.21 <- ModelDFSLt1_VMR2.20[-nrow(ModelDFSLt1_VMR2.20),]
ModelDFSLt1_VMR2.22 <- ModelDFSLt1_VMR2.21[-nrow(ModelDFSLt1_VMR2.21),]
ModelDFSLt1_VMR2.23 <- ModelDFSLt1_VMR2.22[-nrow(ModelDFSLt1_VMR2.22),]
ModelDFSLt1_VMR2.24 <- ModelDFSLt1_VMR2.23[-nrow(ModelDFSLt1_VMR2.23),]

ModelDFSLt1_VMR2 <- ModelDFSLt1_VMR2.24 #Create model t=x+1

#Subtract model (t=x) - (t=x+1)
ModelDFSL1y_VMR2 <- ModelDFSLt0_VMR2 - ModelDFSLt1_VMR2

#Re-do Month Number column because the substraction was also applied to it
ModelDFSL1y_VMR2$MNumber <- seq(from = 1, to = SimulationLength_months)

#This model will be called VMR2P because implies a one-off input of C
ModelDFSL_VMR2P <- ModelDFSL1y_VMR2

#Export the dataframe
write_xlsx(ModelDFSL_VMR2P,"VXP_Models\\ModelDFSL_R_VMR2P.xlsx")

#Plot 3: Interactive Yearly CO2 emissions #
MY <- 12
ModelDFSL_VMR2P_YCO2 <- ModelDFSL_VMR2P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VMR2)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMR2P_YCO2) <- c("Year", "Months", "AnnualCO2_VMR_2")

#Plot 3: Interactive Yearly CO2 emissions considering a delay
GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
ModelDFSL_VMR2P_YCO2D <- merge(ModelDFSL_VMR2P_YCO2, GWP100delay, by = "Year")
ModelDFSL_VMR2P_YCO2D$AnnualCO2D_VMR_2 <- ModelDFSL_VMR2P_YCO2D$AnnualCO2_VMR_2 * ModelDFSL_VMR2P_YCO2D$GWP100

#Plot 4: Interactive Yearly C emissions #
MY <- 12
ModelDFSL_VMR2P_YC <- ModelDFSL_VMR2P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VMR2)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMR2P_YC) <- c("Year", "Months", "CEmissions_VMR_2")

#Plot 5: Interactive Yearly C tails (remaining C in Soil) #
MY <- 12
ModelDFSL_VMR2P_YCT <- ModelDFSL_VMR2P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VMR2)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMR2P_YCT) <- c("Year", "Months", "CTail_VMR_2")

#Save Dataframes for Plots 3.1, 3.2, 4 and 5
write_xlsx(ModelDFSL_VMR2P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VMR2P.xlsx") #Yearly CO2 emissions (no delay)
write_xlsx(ModelDFSL_VMR2P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VMR2P.xlsx") #Yearly CO2 emissions (delay)
write_xlsx(ModelDFSL_VMR2P_YC,"CEmissions_P\\ModelDFSL_R_CE_VMR2P.xlsx") #Yearly C emissions
write_xlsx(ModelDFSL_VMR2P_YCT,"CTails_P\\ModelDFSL_R_CT_VMR2P.xlsx") #Yearly C emissions



#### 11.4 - VMR3) Manure; 30%clay; Reduced Tillage ####
#The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
fT_VMR3=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
fW_VMR3=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                        S.Thick = soil.thick, pClay = clay100*0.3,
                        pE = 1.0, bare = FALSE)$b #Moisture effects per month
xi.frame_VMR3=data.frame(years,rep(fT_VMR3*fW_VMR3,length.out=length(years)))

#To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
Model_VMR3=SoilR::RothCModel(
  t=years, #Simulation Length
  ks=c(k.DPM = 10*RTRM, k.RPM = 0.3*RTRM, k.BIO = 0.66*RTRM, k.HUM = 0.02*RTRM, k.IOM = 0*RTRM), #Decomposition rates for the different pools
  C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
  In=Scalar_LitterCinputs*0, #Amount of litter inputs by time
  FYM = Scalar_ManureCinputs*1, #Amount of Farm Yard Manure by time
  clay=clay100*0.3, #Percent clay in mineral soil
  xi=xi.frame_VMR3) #Loads the model

Ct_VMR3=getC(Model_VMR3) #Calculates stocks for each pool per month

#The results can be plotted with the commands
matplot(years, Ct_VMR3, type="l", lty=1, col=1:5,
        xlab="Time (years)", ylab="C stocks (Mg/ha)")
legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
       lty=1, col=1:5, bty="n")

VEC_Lit_VMR3 <- rep(M_Scalar_LitterCinputs*0, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
VEC_Man_VMR3 <- rep(M_Scalar_ManureCinputs*1, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

VEC_LitDF_VMR3 <- as.data.frame(VEC_Lit_VMR3) #Converting the Litter vector to a data frame
VEC_LitDF_VMR3$MNumber <- seq(from = 1, to = SimulationLength_months)
VEC_ManDF_VMR3 <- as.data.frame(VEC_Man_VMR3) #Converting the Manure vector to a data frame
VEC_ManDF_VMR3$MNumber <- seq(from = 1, to = SimulationLength_months)

sapply(VEC_LitDF_VMR3, class) #Check that class is numeric
sapply(VEC_ManDF_VMR3, class) #Check that class is numeric
LitterCinputs_VMR3=VEC_LitDF_VMR3   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
ManureCinputs_VMR3=VEC_ManDF_VMR3 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
MCinputs_VMR3 <- merge(LitterCinputs_VMR3, ManureCinputs_VMR3, by = "MNumber")
MCinputs_VMR3$MInput_VMR3 <- MCinputs_VMR3$VEC_Lit_VMR3 + MCinputs_VMR3$VEC_Man_VMR3

#Change names of litter and manure columns for more common ones
colnames(MCinputs_VMR3)[which(names(MCinputs_VMR3) == "VEC_Lit_VMR3")] <- "LitterC_VMR3"
colnames(MCinputs_VMR3)[which(names(MCinputs_VMR3) == "VEC_Man_VMR3")] <- "ManureC_VMR3"

#Create a dataframe with the data considering the simulation length
ModelDF_VMR3 <- as.data.frame(Ct_VMR3)
colnames(ModelDF_VMR3) <- c('DPM_VMR3','RPM_VMR3','BIO_VMR3', 'HUM_VMR3', 'IOM_VMR3')
ModelDFS_VMR3 <- ModelDF_VMR3[1:SimulationLength_months, ]

#Create a column with the number of month of analysis
ModelDFS_VMR3$MNumber <- seq(from = 1, to = SimulationLength_months)

#Create a column that sums all pools
ModelDFS_VMR3$AllPools_VMR3 <- ModelDFS_VMR3$DPM_VMR3 + ModelDFS_VMR3$RPM_VMR3 + ModelDFS_VMR3$BIO_VMR3 + ModelDFS_VMR3$HUM_VMR3 + ModelDFS_VMR3$IOM_VMR3

#Create a column that sums all pools except IOM (static)
ModelDFS_VMR3$AllPools_noIOM_VMR3 <- ModelDFS_VMR3$DPM_VMR3 + ModelDFS_VMR3$RPM_VMR3 + ModelDFS_VMR3$BIO_VMR3 + ModelDFS_VMR3$HUM_VMR3

#Create a column that add the monthly input of C (manure and litter separately)
ModelDFSL_VMR3 <- merge(ModelDFS_VMR3, MCinputs_VMR3, by = "MNumber")

ModelDFSL_VMR3$MInput_VMR3 <- ModelDFSL_VMR3$LitterC_VMR3 + ModelDFSL_VMR3$ManureC_VMR3
#ModelDF_SL$MInput[1] <- 0

#Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
ModelDFSL_VMR3$CTails_VMR3 <- ModelDFSL_VMR3$AllPools_noIOM_VMR3 + ModelDFSL_VMR3$MInput_VMR3

#Create Monthly Accumulated input of C
ModelDFSL_VMR3$AccumInput_VMR3 = ModelDFSL_VMR3$AccumInput_VMR3=cumsum(ModelDFSL_VMR3$MInput_VMR3)

#Create Monthly Growths for each carbon pool
ModelDFSL_VMR3$MGrowth_DPM_VMR3 <- ave(ModelDFSL_VMR3$DPM_VMR3, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMR3$MGrowth_RPM_VMR3 <- ave(ModelDFSL_VMR3$RPM_VMR3, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMR3$MGrowth_BIO_VMR3 <- ave(ModelDFSL_VMR3$BIO_VMR3, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMR3$MGrowth_HUM_VMR3 <- ave(ModelDFSL_VMR3$HUM_VMR3, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMR3$MGrowth_IOM_VMR3 <- ave(ModelDFSL_VMR3$IOM_VMR3, FUN = function(x) c(0, diff(x)))

#Create column for Monthly and Accumulated C-CO2 emissions
ModelDFSL_VMR3$M_CCO2_VMR3 <- ModelDFSL_VMR3$MInput_VMR3 - ModelDFSL_VMR3$MGrowth_DPM_VMR3 - ModelDFSL_VMR3$MGrowth_RPM_VMR3 - ModelDFSL_VMR3$MGrowth_BIO_VMR3 - ModelDFSL_VMR3$MGrowth_HUM_VMR3
ModelDFSL_VMR3$Accum_CCO2_VMR3 <- ModelDFSL_VMR3$AccumInput_VMR3 - ModelDFSL_VMR3$AllPools_noIOM_VMR3

#Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
ModelDFSL_VMR3$M_CCO2_VMR3[1] <- 0
ModelDFSL_VMR3$Accum_CCO2_VMR3[1] <- 0

#Balance validation
ModelDFSL_VMR3$Balance_VMR3 <- ModelDFSL_VMR3$AccumInput_VMR3 - ModelDFSL_VMR3$Accum_CCO2_VMR3 - (ModelDFSL_VMR3$DPM_VMR3 + ModelDFSL_VMR3$RPM_VMR3 + ModelDFSL_VMR3$BIO_VMR3 + ModelDFSL_VMR3$HUM_VMR3)

#Convert C-CO2 emissions into CO2 emissions
ModelDFSL_VMR3$M_CO2_VMR3 <- ModelDFSL_VMR3$M_CCO2_VMR3 * 44/12
ModelDFSL_VMR3$Accum_CO2_VMR3 <- ModelDFSL_VMR3$Accum_CCO2_VMR3 * 44/12

#This model will be called VMR3C because implies a continuous input of C
ModelDFSL_VMR3C <- ModelDFSL_VMR3

#Export the dataframe
write_xlsx(ModelDFSL_VMR3C,"VXC_Models\\ModelDFSL_R_VMR3C.xlsx")

#Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
#Create two equal models by using the above general script
#Create model t=x
ModelDFSLt0_VMR3 <- ModelDFSL_VMR3 #Create model t=x

#Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
ModelDFSLt1_VMR3.1 <- rbind(c(0:0), ModelDFSLt0_VMR3)
ModelDFSLt1_VMR3.2 <- rbind(c(0:0), ModelDFSLt1_VMR3.1)
ModelDFSLt1_VMR3.3 <- rbind(c(0:0), ModelDFSLt1_VMR3.2)
ModelDFSLt1_VMR3.4 <- rbind(c(0:0), ModelDFSLt1_VMR3.3)
ModelDFSLt1_VMR3.5 <- rbind(c(0:0), ModelDFSLt1_VMR3.4)
ModelDFSLt1_VMR3.6 <- rbind(c(0:0), ModelDFSLt1_VMR3.5)
ModelDFSLt1_VMR3.7 <- rbind(c(0:0), ModelDFSLt1_VMR3.6)
ModelDFSLt1_VMR3.8 <- rbind(c(0:0), ModelDFSLt1_VMR3.7)
ModelDFSLt1_VMR3.9 <- rbind(c(0:0), ModelDFSLt1_VMR3.8)
ModelDFSLt1_VMR3.10 <- rbind(c(0:0), ModelDFSLt1_VMR3.9)
ModelDFSLt1_VMR3.11 <- rbind(c(0:0), ModelDFSLt1_VMR3.10)
ModelDFSLt1_VMR3.12 <- rbind(c(0:0), ModelDFSLt1_VMR3.11)
ModelDFSLt1_VMR3.13 <- ModelDFSLt1_VMR3.12[-nrow(ModelDFSLt1_VMR3.12),]
ModelDFSLt1_VMR3.14 <- ModelDFSLt1_VMR3.13[-nrow(ModelDFSLt1_VMR3.13),]
ModelDFSLt1_VMR3.15 <- ModelDFSLt1_VMR3.14[-nrow(ModelDFSLt1_VMR3.14),]
ModelDFSLt1_VMR3.16 <- ModelDFSLt1_VMR3.15[-nrow(ModelDFSLt1_VMR3.15),]
ModelDFSLt1_VMR3.17 <- ModelDFSLt1_VMR3.16[-nrow(ModelDFSLt1_VMR3.16),]
ModelDFSLt1_VMR3.18 <- ModelDFSLt1_VMR3.17[-nrow(ModelDFSLt1_VMR3.17),]
ModelDFSLt1_VMR3.19 <- ModelDFSLt1_VMR3.18[-nrow(ModelDFSLt1_VMR3.18),]
ModelDFSLt1_VMR3.20 <- ModelDFSLt1_VMR3.19[-nrow(ModelDFSLt1_VMR3.19),]
ModelDFSLt1_VMR3.21 <- ModelDFSLt1_VMR3.20[-nrow(ModelDFSLt1_VMR3.20),]
ModelDFSLt1_VMR3.22 <- ModelDFSLt1_VMR3.21[-nrow(ModelDFSLt1_VMR3.21),]
ModelDFSLt1_VMR3.23 <- ModelDFSLt1_VMR3.22[-nrow(ModelDFSLt1_VMR3.22),]
ModelDFSLt1_VMR3.24 <- ModelDFSLt1_VMR3.23[-nrow(ModelDFSLt1_VMR3.23),]

ModelDFSLt1_VMR3 <- ModelDFSLt1_VMR3.24 #Create model t=x+1

#Subtract model (t=x) - (t=x+1)
ModelDFSL1y_VMR3 <- ModelDFSLt0_VMR3 - ModelDFSLt1_VMR3

#Re-do Month Number column because the substraction was also applied to it
ModelDFSL1y_VMR3$MNumber <- seq(from = 1, to = SimulationLength_months)

#This model will be called VMR3P because implies a one-off input of C
ModelDFSL_VMR3P <- ModelDFSL1y_VMR3

#Export the dataframe
write_xlsx(ModelDFSL_VMR3P,"VXP_Models\\ModelDFSL_R_VMR3P.xlsx")

#Plot 3: Interactive Yearly CO2 emissions #
MY <- 12
ModelDFSL_VMR3P_YCO2 <- ModelDFSL_VMR3P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VMR3)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMR3P_YCO2) <- c("Year", "Months", "AnnualCO2_VMR_3")

#Plot 3: Interactive Yearly CO2 emissions considering a delay
GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
ModelDFSL_VMR3P_YCO2D <- merge(ModelDFSL_VMR3P_YCO2, GWP100delay, by = "Year")
ModelDFSL_VMR3P_YCO2D$AnnualCO2D_VMR_3 <- ModelDFSL_VMR3P_YCO2D$AnnualCO2_VMR_3 * ModelDFSL_VMR3P_YCO2D$GWP100

#Plot 4: Interactive Yearly C emissions #
MY <- 12
ModelDFSL_VMR3P_YC <- ModelDFSL_VMR3P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VMR3)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMR3P_YC) <- c("Year", "Months", "CEmissions_VMR_3")

#Plot 5: Interactive Yearly C tails (remaining C in Soil) #
MY <- 12
ModelDFSL_VMR3P_YCT <- ModelDFSL_VMR3P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VMR3)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMR3P_YCT) <- c("Year", "Months", "CTail_VMR_3")

#Save Dataframes for Plots 3.1, 3.2, 4 and 5
write_xlsx(ModelDFSL_VMR3P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VMR3P.xlsx") #Yearly CO2 emissions (no delay)
write_xlsx(ModelDFSL_VMR3P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VMR3P.xlsx") #Yearly CO2 emissions (delay)
write_xlsx(ModelDFSL_VMR3P_YC,"CEmissions_P\\ModelDFSL_R_CE_VMR3P.xlsx") #Yearly C emissions
write_xlsx(ModelDFSL_VMR3P_YCT,"CTails_P\\ModelDFSL_R_CT_VMR3P.xlsx") #Yearly C emissions



#### 11.5 - VMR4) Manure; 40%clay; Reduced Tillage ####
#The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
fT_VMR4=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
fW_VMR4=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                        S.Thick = soil.thick, pClay = clay100*0.4,
                        pE = 1.0, bare = FALSE)$b #Moisture effects per month
xi.frame_VMR4=data.frame(years,rep(fT_VMR4*fW_VMR4,length.out=length(years)))

#To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
Model_VMR4=SoilR::RothCModel(
  t=years, #Simulation Length
  ks=c(k.DPM = 10*RTRM, k.RPM = 0.3*RTRM, k.BIO = 0.66*RTRM, k.HUM = 0.02*RTRM, k.IOM = 0*RTRM), #Decomposition rates for the different pools
  C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
  In=Scalar_LitterCinputs*0, #Amount of litter inputs by time
  FYM = Scalar_ManureCinputs*1, #Amount of Farm Yard Manure by time
  clay=clay100*0.4, #Percent clay in mineral soil
  xi=xi.frame_VMR4) #Loads the model

Ct_VMR4=getC(Model_VMR4) #Calculates stocks for each pool per month

#The results can be plotted with the commands
matplot(years, Ct_VMR4, type="l", lty=1, col=1:5,
        xlab="Time (years)", ylab="C stocks (Mg/ha)")
legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
       lty=1, col=1:5, bty="n")

VEC_Lit_VMR4 <- rep(M_Scalar_LitterCinputs*0, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
VEC_Man_VMR4 <- rep(M_Scalar_ManureCinputs*1, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

VEC_LitDF_VMR4 <- as.data.frame(VEC_Lit_VMR4) #Converting the Litter vector to a data frame
VEC_LitDF_VMR4$MNumber <- seq(from = 1, to = SimulationLength_months)
VEC_ManDF_VMR4 <- as.data.frame(VEC_Man_VMR4) #Converting the Manure vector to a data frame
VEC_ManDF_VMR4$MNumber <- seq(from = 1, to = SimulationLength_months)

sapply(VEC_LitDF_VMR4, class) #Check that class is numeric
sapply(VEC_ManDF_VMR4, class) #Check that class is numeric
LitterCinputs_VMR4=VEC_LitDF_VMR4   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
ManureCinputs_VMR4=VEC_ManDF_VMR4 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
MCinputs_VMR4 <- merge(LitterCinputs_VMR4, ManureCinputs_VMR4, by = "MNumber")
MCinputs_VMR4$MInput_VMR4 <- MCinputs_VMR4$VEC_Lit_VMR4 + MCinputs_VMR4$VEC_Man_VMR4

#Change names of litter and manure columns for more common ones
colnames(MCinputs_VMR4)[which(names(MCinputs_VMR4) == "VEC_Lit_VMR4")] <- "LitterC_VMR4"
colnames(MCinputs_VMR4)[which(names(MCinputs_VMR4) == "VEC_Man_VMR4")] <- "ManureC_VMR4"

#Create a dataframe with the data considering the simulation length
ModelDF_VMR4 <- as.data.frame(Ct_VMR4)
colnames(ModelDF_VMR4) <- c('DPM_VMR4','RPM_VMR4','BIO_VMR4', 'HUM_VMR4', 'IOM_VMR4')
ModelDFS_VMR4 <- ModelDF_VMR4[1:SimulationLength_months, ]

#Create a column with the number of month of analysis
ModelDFS_VMR4$MNumber <- seq(from = 1, to = SimulationLength_months)

#Create a column that sums all pools
ModelDFS_VMR4$AllPools_VMR4 <- ModelDFS_VMR4$DPM_VMR4 + ModelDFS_VMR4$RPM_VMR4 + ModelDFS_VMR4$BIO_VMR4 + ModelDFS_VMR4$HUM_VMR4 + ModelDFS_VMR4$IOM_VMR4

#Create a column that sums all pools except IOM (static)
ModelDFS_VMR4$AllPools_noIOM_VMR4 <- ModelDFS_VMR4$DPM_VMR4 + ModelDFS_VMR4$RPM_VMR4 + ModelDFS_VMR4$BIO_VMR4 + ModelDFS_VMR4$HUM_VMR4

#Create a column that add the monthly input of C (manure and litter separately)
ModelDFSL_VMR4 <- merge(ModelDFS_VMR4, MCinputs_VMR4, by = "MNumber")

ModelDFSL_VMR4$MInput_VMR4 <- ModelDFSL_VMR4$LitterC_VMR4 + ModelDFSL_VMR4$ManureC_VMR4
#ModelDF_SL$MInput[1] <- 0

#Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
ModelDFSL_VMR4$CTails_VMR4 <- ModelDFSL_VMR4$AllPools_noIOM_VMR4 + ModelDFSL_VMR4$MInput_VMR4

#Create Monthly Accumulated input of C
ModelDFSL_VMR4$AccumInput_VMR4 = ModelDFSL_VMR4$AccumInput_VMR4=cumsum(ModelDFSL_VMR4$MInput_VMR4)

#Create Monthly Growths for each carbon pool
ModelDFSL_VMR4$MGrowth_DPM_VMR4 <- ave(ModelDFSL_VMR4$DPM_VMR4, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMR4$MGrowth_RPM_VMR4 <- ave(ModelDFSL_VMR4$RPM_VMR4, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMR4$MGrowth_BIO_VMR4 <- ave(ModelDFSL_VMR4$BIO_VMR4, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMR4$MGrowth_HUM_VMR4 <- ave(ModelDFSL_VMR4$HUM_VMR4, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMR4$MGrowth_IOM_VMR4 <- ave(ModelDFSL_VMR4$IOM_VMR4, FUN = function(x) c(0, diff(x)))

#Create column for Monthly and Accumulated C-CO2 emissions
ModelDFSL_VMR4$M_CCO2_VMR4 <- ModelDFSL_VMR4$MInput_VMR4 - ModelDFSL_VMR4$MGrowth_DPM_VMR4 - ModelDFSL_VMR4$MGrowth_RPM_VMR4 - ModelDFSL_VMR4$MGrowth_BIO_VMR4 - ModelDFSL_VMR4$MGrowth_HUM_VMR4
ModelDFSL_VMR4$Accum_CCO2_VMR4 <- ModelDFSL_VMR4$AccumInput_VMR4 - ModelDFSL_VMR4$AllPools_noIOM_VMR4

#Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
ModelDFSL_VMR4$M_CCO2_VMR4[1] <- 0
ModelDFSL_VMR4$Accum_CCO2_VMR4[1] <- 0

#Balance validation
ModelDFSL_VMR4$Balance_VMR4 <- ModelDFSL_VMR4$AccumInput_VMR4 - ModelDFSL_VMR4$Accum_CCO2_VMR4 - (ModelDFSL_VMR4$DPM_VMR4 + ModelDFSL_VMR4$RPM_VMR4 + ModelDFSL_VMR4$BIO_VMR4 + ModelDFSL_VMR4$HUM_VMR4)

#Convert C-CO2 emissions into CO2 emissions
ModelDFSL_VMR4$M_CO2_VMR4 <- ModelDFSL_VMR4$M_CCO2_VMR4 * 44/12
ModelDFSL_VMR4$Accum_CO2_VMR4 <- ModelDFSL_VMR4$Accum_CCO2_VMR4 * 44/12

#This model will be called VMR4C because implies a continuous input of C
ModelDFSL_VMR4C <- ModelDFSL_VMR4

#Export the dataframe
write_xlsx(ModelDFSL_VMR4C,"VXC_Models\\ModelDFSL_R_VMR4C.xlsx")

#Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
#Create two equal models by using the above general script
#Create model t=x
ModelDFSLt0_VMR4 <- ModelDFSL_VMR4 #Create model t=x

#Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
ModelDFSLt1_VMR4.1 <- rbind(c(0:0), ModelDFSLt0_VMR4)
ModelDFSLt1_VMR4.2 <- rbind(c(0:0), ModelDFSLt1_VMR4.1)
ModelDFSLt1_VMR4.3 <- rbind(c(0:0), ModelDFSLt1_VMR4.2)
ModelDFSLt1_VMR4.4 <- rbind(c(0:0), ModelDFSLt1_VMR4.3)
ModelDFSLt1_VMR4.5 <- rbind(c(0:0), ModelDFSLt1_VMR4.4)
ModelDFSLt1_VMR4.6 <- rbind(c(0:0), ModelDFSLt1_VMR4.5)
ModelDFSLt1_VMR4.7 <- rbind(c(0:0), ModelDFSLt1_VMR4.6)
ModelDFSLt1_VMR4.8 <- rbind(c(0:0), ModelDFSLt1_VMR4.7)
ModelDFSLt1_VMR4.9 <- rbind(c(0:0), ModelDFSLt1_VMR4.8)
ModelDFSLt1_VMR4.10 <- rbind(c(0:0), ModelDFSLt1_VMR4.9)
ModelDFSLt1_VMR4.11 <- rbind(c(0:0), ModelDFSLt1_VMR4.10)
ModelDFSLt1_VMR4.12 <- rbind(c(0:0), ModelDFSLt1_VMR4.11)
ModelDFSLt1_VMR4.13 <- ModelDFSLt1_VMR4.12[-nrow(ModelDFSLt1_VMR4.12),]
ModelDFSLt1_VMR4.14 <- ModelDFSLt1_VMR4.13[-nrow(ModelDFSLt1_VMR4.13),]
ModelDFSLt1_VMR4.15 <- ModelDFSLt1_VMR4.14[-nrow(ModelDFSLt1_VMR4.14),]
ModelDFSLt1_VMR4.16 <- ModelDFSLt1_VMR4.15[-nrow(ModelDFSLt1_VMR4.15),]
ModelDFSLt1_VMR4.17 <- ModelDFSLt1_VMR4.16[-nrow(ModelDFSLt1_VMR4.16),]
ModelDFSLt1_VMR4.18 <- ModelDFSLt1_VMR4.17[-nrow(ModelDFSLt1_VMR4.17),]
ModelDFSLt1_VMR4.19 <- ModelDFSLt1_VMR4.18[-nrow(ModelDFSLt1_VMR4.18),]
ModelDFSLt1_VMR4.20 <- ModelDFSLt1_VMR4.19[-nrow(ModelDFSLt1_VMR4.19),]
ModelDFSLt1_VMR4.21 <- ModelDFSLt1_VMR4.20[-nrow(ModelDFSLt1_VMR4.20),]
ModelDFSLt1_VMR4.22 <- ModelDFSLt1_VMR4.21[-nrow(ModelDFSLt1_VMR4.21),]
ModelDFSLt1_VMR4.23 <- ModelDFSLt1_VMR4.22[-nrow(ModelDFSLt1_VMR4.22),]
ModelDFSLt1_VMR4.24 <- ModelDFSLt1_VMR4.23[-nrow(ModelDFSLt1_VMR4.23),]

ModelDFSLt1_VMR4 <- ModelDFSLt1_VMR4.24 #Create model t=x+1

#Subtract model (t=x) - (t=x+1)
ModelDFSL1y_VMR4 <- ModelDFSLt0_VMR4 - ModelDFSLt1_VMR4

#Re-do Month Number column because the substraction was also applied to it
ModelDFSL1y_VMR4$MNumber <- seq(from = 1, to = SimulationLength_months)

#This model will be called VMR4P because implies a one-off input of C
ModelDFSL_VMR4P <- ModelDFSL1y_VMR4

#Export the dataframe
write_xlsx(ModelDFSL_VMR4P,"VXP_Models\\ModelDFSL_R_VMR4P.xlsx")

#Plot 3: Interactive Yearly CO2 emissions #
MY <- 12
ModelDFSL_VMR4P_YCO2 <- ModelDFSL_VMR4P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VMR4)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMR4P_YCO2) <- c("Year", "Months", "AnnualCO2_VMR_4")

#Plot 3: Interactive Yearly CO2 emissions considering a delay
GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
ModelDFSL_VMR4P_YCO2D <- merge(ModelDFSL_VMR4P_YCO2, GWP100delay, by = "Year")
ModelDFSL_VMR4P_YCO2D$AnnualCO2D_VMR_4 <- ModelDFSL_VMR4P_YCO2D$AnnualCO2_VMR_4 * ModelDFSL_VMR4P_YCO2D$GWP100

#Plot 4: Interactive Yearly C emissions #
MY <- 12
ModelDFSL_VMR4P_YC <- ModelDFSL_VMR4P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VMR4)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMR4P_YC) <- c("Year", "Months", "CEmissions_VMR_4")

#Plot 5: Interactive Yearly C tails (remaining C in Soil) #
MY <- 12
ModelDFSL_VMR4P_YCT <- ModelDFSL_VMR4P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VMR4)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMR4P_YCT) <- c("Year", "Months", "CTail_VMR_4")

#Save Dataframes for Plots 3.1, 3.2, 4 and 5
write_xlsx(ModelDFSL_VMR4P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VMR4P.xlsx") #Yearly CO2 emissions (no delay)
write_xlsx(ModelDFSL_VMR4P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VMR4P.xlsx") #Yearly CO2 emissions (delay)
write_xlsx(ModelDFSL_VMR4P_YC,"CEmissions_P\\ModelDFSL_R_CE_VMR4P.xlsx") #Yearly C emissions
write_xlsx(ModelDFSL_VMR4P_YCT,"CTails_P\\ModelDFSL_R_CT_VMR4P.xlsx") #Yearly C emissions



#### 11.6 - VMR5) Manure; 50%clay; Reduced Tillage ####
#The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
fT_VMR5=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
fW_VMR5=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                        S.Thick = soil.thick, pClay = clay100*0.5,
                        pE = 1.0, bare = FALSE)$b #Moisture effects per month
xi.frame_VMR5=data.frame(years,rep(fT_VMR5*fW_VMR5,length.out=length(years)))

#To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
Model_VMR5=SoilR::RothCModel(
  t=years, #Simulation Length
  ks=c(k.DPM = 10*RTRM, k.RPM = 0.3*RTRM, k.BIO = 0.66*RTRM, k.HUM = 0.02*RTRM, k.IOM = 0*RTRM), #Decomposition rates for the different pools
  C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
  In=Scalar_LitterCinputs*0, #Amount of litter inputs by time
  FYM = Scalar_ManureCinputs*1, #Amount of Farm Yard Manure by time
  clay=clay100*0.5, #Percent clay in mineral soil
  xi=xi.frame_VMR5) #Loads the model

Ct_VMR5=getC(Model_VMR5) #Calculates stocks for each pool per month

#The results can be plotted with the commands
matplot(years, Ct_VMR5, type="l", lty=1, col=1:5,
        xlab="Time (years)", ylab="C stocks (Mg/ha)")
legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
       lty=1, col=1:5, bty="n")

VEC_Lit_VMR5 <- rep(M_Scalar_LitterCinputs*0, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
VEC_Man_VMR5 <- rep(M_Scalar_ManureCinputs*1, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

VEC_LitDF_VMR5 <- as.data.frame(VEC_Lit_VMR5) #Converting the Litter vector to a data frame
VEC_LitDF_VMR5$MNumber <- seq(from = 1, to = SimulationLength_months)
VEC_ManDF_VMR5 <- as.data.frame(VEC_Man_VMR5) #Converting the Manure vector to a data frame
VEC_ManDF_VMR5$MNumber <- seq(from = 1, to = SimulationLength_months)

sapply(VEC_LitDF_VMR5, class) #Check that class is numeric
sapply(VEC_ManDF_VMR5, class) #Check that class is numeric
LitterCinputs_VMR5=VEC_LitDF_VMR5   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
ManureCinputs_VMR5=VEC_ManDF_VMR5 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
MCinputs_VMR5 <- merge(LitterCinputs_VMR5, ManureCinputs_VMR5, by = "MNumber")
MCinputs_VMR5$MInput_VMR5 <- MCinputs_VMR5$VEC_Lit_VMR5 + MCinputs_VMR5$VEC_Man_VMR5

#Change names of litter and manure columns for more common ones
colnames(MCinputs_VMR5)[which(names(MCinputs_VMR5) == "VEC_Lit_VMR5")] <- "LitterC_VMR5"
colnames(MCinputs_VMR5)[which(names(MCinputs_VMR5) == "VEC_Man_VMR5")] <- "ManureC_VMR5"

#Create a dataframe with the data considering the simulation length
ModelDF_VMR5 <- as.data.frame(Ct_VMR5)
colnames(ModelDF_VMR5) <- c('DPM_VMR5','RPM_VMR5','BIO_VMR5', 'HUM_VMR5', 'IOM_VMR5')
ModelDFS_VMR5 <- ModelDF_VMR5[1:SimulationLength_months, ]

#Create a column with the number of month of analysis
ModelDFS_VMR5$MNumber <- seq(from = 1, to = SimulationLength_months)

#Create a column that sums all pools
ModelDFS_VMR5$AllPools_VMR5 <- ModelDFS_VMR5$DPM_VMR5 + ModelDFS_VMR5$RPM_VMR5 + ModelDFS_VMR5$BIO_VMR5 + ModelDFS_VMR5$HUM_VMR5 + ModelDFS_VMR5$IOM_VMR5

#Create a column that sums all pools except IOM (static)
ModelDFS_VMR5$AllPools_noIOM_VMR5 <- ModelDFS_VMR5$DPM_VMR5 + ModelDFS_VMR5$RPM_VMR5 + ModelDFS_VMR5$BIO_VMR5 + ModelDFS_VMR5$HUM_VMR5

#Create a column that add the monthly input of C (manure and litter separately)
ModelDFSL_VMR5 <- merge(ModelDFS_VMR5, MCinputs_VMR5, by = "MNumber")

ModelDFSL_VMR5$MInput_VMR5 <- ModelDFSL_VMR5$LitterC_VMR5 + ModelDFSL_VMR5$ManureC_VMR5
#ModelDF_SL$MInput[1] <- 0

#Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
ModelDFSL_VMR5$CTails_VMR5 <- ModelDFSL_VMR5$AllPools_noIOM_VMR5 + ModelDFSL_VMR5$MInput_VMR5

#Create Monthly Accumulated input of C
ModelDFSL_VMR5$AccumInput_VMR5 = ModelDFSL_VMR5$AccumInput_VMR5=cumsum(ModelDFSL_VMR5$MInput_VMR5)

#Create Monthly Growths for each carbon pool
ModelDFSL_VMR5$MGrowth_DPM_VMR5 <- ave(ModelDFSL_VMR5$DPM_VMR5, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMR5$MGrowth_RPM_VMR5 <- ave(ModelDFSL_VMR5$RPM_VMR5, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMR5$MGrowth_BIO_VMR5 <- ave(ModelDFSL_VMR5$BIO_VMR5, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMR5$MGrowth_HUM_VMR5 <- ave(ModelDFSL_VMR5$HUM_VMR5, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMR5$MGrowth_IOM_VMR5 <- ave(ModelDFSL_VMR5$IOM_VMR5, FUN = function(x) c(0, diff(x)))

#Create column for Monthly and Accumulated C-CO2 emissions
ModelDFSL_VMR5$M_CCO2_VMR5 <- ModelDFSL_VMR5$MInput_VMR5 - ModelDFSL_VMR5$MGrowth_DPM_VMR5 - ModelDFSL_VMR5$MGrowth_RPM_VMR5 - ModelDFSL_VMR5$MGrowth_BIO_VMR5 - ModelDFSL_VMR5$MGrowth_HUM_VMR5
ModelDFSL_VMR5$Accum_CCO2_VMR5 <- ModelDFSL_VMR5$AccumInput_VMR5 - ModelDFSL_VMR5$AllPools_noIOM_VMR5

#Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
ModelDFSL_VMR5$M_CCO2_VMR5[1] <- 0
ModelDFSL_VMR5$Accum_CCO2_VMR5[1] <- 0

#Balance validation
ModelDFSL_VMR5$Balance_VMR5 <- ModelDFSL_VMR5$AccumInput_VMR5 - ModelDFSL_VMR5$Accum_CCO2_VMR5 - (ModelDFSL_VMR5$DPM_VMR5 + ModelDFSL_VMR5$RPM_VMR5 + ModelDFSL_VMR5$BIO_VMR5 + ModelDFSL_VMR5$HUM_VMR5)

#Convert C-CO2 emissions into CO2 emissions
ModelDFSL_VMR5$M_CO2_VMR5 <- ModelDFSL_VMR5$M_CCO2_VMR5 * 44/12
ModelDFSL_VMR5$Accum_CO2_VMR5 <- ModelDFSL_VMR5$Accum_CCO2_VMR5 * 44/12

#This model will be called VMR5C because implies a continuous input of C
ModelDFSL_VMR5C <- ModelDFSL_VMR5

#Export the dataframe
write_xlsx(ModelDFSL_VMR5C,"VXC_Models\\ModelDFSL_R_VMR5C.xlsx")

#Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
#Create two equal models by using the above general script
#Create model t=x
ModelDFSLt0_VMR5 <- ModelDFSL_VMR5 #Create model t=x

#Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
ModelDFSLt1_VMR5.1 <- rbind(c(0:0), ModelDFSLt0_VMR5)
ModelDFSLt1_VMR5.2 <- rbind(c(0:0), ModelDFSLt1_VMR5.1)
ModelDFSLt1_VMR5.3 <- rbind(c(0:0), ModelDFSLt1_VMR5.2)
ModelDFSLt1_VMR5.4 <- rbind(c(0:0), ModelDFSLt1_VMR5.3)
ModelDFSLt1_VMR5.5 <- rbind(c(0:0), ModelDFSLt1_VMR5.4)
ModelDFSLt1_VMR5.6 <- rbind(c(0:0), ModelDFSLt1_VMR5.5)
ModelDFSLt1_VMR5.7 <- rbind(c(0:0), ModelDFSLt1_VMR5.6)
ModelDFSLt1_VMR5.8 <- rbind(c(0:0), ModelDFSLt1_VMR5.7)
ModelDFSLt1_VMR5.9 <- rbind(c(0:0), ModelDFSLt1_VMR5.8)
ModelDFSLt1_VMR5.10 <- rbind(c(0:0), ModelDFSLt1_VMR5.9)
ModelDFSLt1_VMR5.11 <- rbind(c(0:0), ModelDFSLt1_VMR5.10)
ModelDFSLt1_VMR5.12 <- rbind(c(0:0), ModelDFSLt1_VMR5.11)
ModelDFSLt1_VMR5.13 <- ModelDFSLt1_VMR5.12[-nrow(ModelDFSLt1_VMR5.12),]
ModelDFSLt1_VMR5.14 <- ModelDFSLt1_VMR5.13[-nrow(ModelDFSLt1_VMR5.13),]
ModelDFSLt1_VMR5.15 <- ModelDFSLt1_VMR5.14[-nrow(ModelDFSLt1_VMR5.14),]
ModelDFSLt1_VMR5.16 <- ModelDFSLt1_VMR5.15[-nrow(ModelDFSLt1_VMR5.15),]
ModelDFSLt1_VMR5.17 <- ModelDFSLt1_VMR5.16[-nrow(ModelDFSLt1_VMR5.16),]
ModelDFSLt1_VMR5.18 <- ModelDFSLt1_VMR5.17[-nrow(ModelDFSLt1_VMR5.17),]
ModelDFSLt1_VMR5.19 <- ModelDFSLt1_VMR5.18[-nrow(ModelDFSLt1_VMR5.18),]
ModelDFSLt1_VMR5.20 <- ModelDFSLt1_VMR5.19[-nrow(ModelDFSLt1_VMR5.19),]
ModelDFSLt1_VMR5.21 <- ModelDFSLt1_VMR5.20[-nrow(ModelDFSLt1_VMR5.20),]
ModelDFSLt1_VMR5.22 <- ModelDFSLt1_VMR5.21[-nrow(ModelDFSLt1_VMR5.21),]
ModelDFSLt1_VMR5.23 <- ModelDFSLt1_VMR5.22[-nrow(ModelDFSLt1_VMR5.22),]
ModelDFSLt1_VMR5.24 <- ModelDFSLt1_VMR5.23[-nrow(ModelDFSLt1_VMR5.23),]

ModelDFSLt1_VMR5 <- ModelDFSLt1_VMR5.24 #Create model t=x+1

#Subtract model (t=x) - (t=x+1)
ModelDFSL1y_VMR5 <- ModelDFSLt0_VMR5 - ModelDFSLt1_VMR5

#Re-do Month Number column because the substraction was also applied to it
ModelDFSL1y_VMR5$MNumber <- seq(from = 1, to = SimulationLength_months)

#This model will be called VMR5P because implies a one-off input of C
ModelDFSL_VMR5P <- ModelDFSL1y_VMR5

#Export the dataframe
write_xlsx(ModelDFSL_VMR5P,"VXP_Models\\ModelDFSL_R_VMR5P.xlsx")


#Plot 3: Interactive Yearly CO2 emissions #
MY <- 12
ModelDFSL_VMR5P_YCO2 <- ModelDFSL_VMR5P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VMR5)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMR5P_YCO2) <- c("Year", "Months", "AnnualCO2_VMR_5")


#Plot 3: Interactive Yearly CO2 emissions considering a delay
GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
ModelDFSL_VMR5P_YCO2D <- merge(ModelDFSL_VMR5P_YCO2, GWP100delay, by = "Year")
ModelDFSL_VMR5P_YCO2D$AnnualCO2D_VMR_5 <- ModelDFSL_VMR5P_YCO2D$AnnualCO2_VMR_5 * ModelDFSL_VMR5P_YCO2D$GWP100

#Plot 4: Interactive Yearly C emissions #
MY <- 12
ModelDFSL_VMR5P_YC <- ModelDFSL_VMR5P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VMR5)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMR5P_YC) <- c("Year", "Months", "CEmissions_VMR_5")


#Plot 5: Interactive Yearly C tails (remaining C in Soil) #
MY <- 12
ModelDFSL_VMR5P_YCT <- ModelDFSL_VMR5P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VMR5)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMR5P_YCT) <- c("Year", "Months", "CTail_VMR_5")

#Save Dataframes for Plots 3.1, 3.2, 4 and 5
write_xlsx(ModelDFSL_VMR5P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VMR5P.xlsx") #Yearly CO2 emissions (no delay)
write_xlsx(ModelDFSL_VMR5P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VMR5P.xlsx") #Yearly CO2 emissions (delay)
write_xlsx(ModelDFSL_VMR5P_YC,"CEmissions_P\\ModelDFSL_R_CE_VMR5P.xlsx") #Yearly C emissions
write_xlsx(ModelDFSL_VMR5P_YCT,"CTails_P\\ModelDFSL_R_CT_VMR5P.xlsx") #Yearly C emissions



#### 11.7 - VMR6) Manure; 60%clay; Reduced Tillage ####
#The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
fT_VMR6=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
fW_VMR6=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                        S.Thick = soil.thick, pClay = clay100*0.6,
                        pE = 1.0, bare = FALSE)$b #Moisture effects per month
xi.frame_VMR6=data.frame(years,rep(fT_VMR6*fW_VMR6,length.out=length(years)))

#To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
Model_VMR6=SoilR::RothCModel(
  t=years, #Simulation Length
  ks=c(k.DPM = 10*RTRM, k.RPM = 0.3*RTRM, k.BIO = 0.66*RTRM, k.HUM = 0.02*RTRM, k.IOM = 0*RTRM), #Decomposition rates for the different pools
  C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
  In=Scalar_LitterCinputs*0, #Amount of litter inputs by time
  FYM = Scalar_ManureCinputs*1, #Amount of Farm Yard Manure by time
  clay=clay100*0.6, #Percent clay in mineral soil
  xi=xi.frame_VMR6) #Loads the model

Ct_VMR6=getC(Model_VMR6) #Calculates stocks for each pool per month

#The results can be plotted with the commands
matplot(years, Ct_VMR6, type="l", lty=1, col=1:5,
        xlab="Time (years)", ylab="C stocks (Mg/ha)")
legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
       lty=1, col=1:5, bty="n")

VEC_Lit_VMR6 <- rep(M_Scalar_LitterCinputs*0, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
VEC_Man_VMR6 <- rep(M_Scalar_ManureCinputs*1, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

VEC_LitDF_VMR6 <- as.data.frame(VEC_Lit_VMR6) #Converting the Litter vector to a data frame
VEC_LitDF_VMR6$MNumber <- seq(from = 1, to = SimulationLength_months)
VEC_ManDF_VMR6 <- as.data.frame(VEC_Man_VMR6) #Converting the Manure vector to a data frame
VEC_ManDF_VMR6$MNumber <- seq(from = 1, to = SimulationLength_months)

sapply(VEC_LitDF_VMR6, class) #Check that class is numeric
sapply(VEC_ManDF_VMR6, class) #Check that class is numeric
LitterCinputs_VMR6=VEC_LitDF_VMR6   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
ManureCinputs_VMR6=VEC_ManDF_VMR6 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
MCinputs_VMR6 <- merge(LitterCinputs_VMR6, ManureCinputs_VMR6, by = "MNumber")
MCinputs_VMR6$MInput_VMR6 <- MCinputs_VMR6$VEC_Lit_VMR6 + MCinputs_VMR6$VEC_Man_VMR6

#Change names of litter and manure columns for more common ones
colnames(MCinputs_VMR6)[which(names(MCinputs_VMR6) == "VEC_Lit_VMR6")] <- "LitterC_VMR6"
colnames(MCinputs_VMR6)[which(names(MCinputs_VMR6) == "VEC_Man_VMR6")] <- "ManureC_VMR6"

#Create a dataframe with the data considering the simulation length
ModelDF_VMR6 <- as.data.frame(Ct_VMR6)
colnames(ModelDF_VMR6) <- c('DPM_VMR6','RPM_VMR6','BIO_VMR6', 'HUM_VMR6', 'IOM_VMR6')
ModelDFS_VMR6 <- ModelDF_VMR6[1:SimulationLength_months, ]

#Create a column with the number of month of analysis
ModelDFS_VMR6$MNumber <- seq(from = 1, to = SimulationLength_months)

#Create a column that sums all pools
ModelDFS_VMR6$AllPools_VMR6 <- ModelDFS_VMR6$DPM_VMR6 + ModelDFS_VMR6$RPM_VMR6 + ModelDFS_VMR6$BIO_VMR6 + ModelDFS_VMR6$HUM_VMR6 + ModelDFS_VMR6$IOM_VMR6

#Create a column that sums all pools except IOM (static)
ModelDFS_VMR6$AllPools_noIOM_VMR6 <- ModelDFS_VMR6$DPM_VMR6 + ModelDFS_VMR6$RPM_VMR6 + ModelDFS_VMR6$BIO_VMR6 + ModelDFS_VMR6$HUM_VMR6

#Create a column that add the monthly input of C (manure and litter separately)
ModelDFSL_VMR6 <- merge(ModelDFS_VMR6, MCinputs_VMR6, by = "MNumber")

ModelDFSL_VMR6$MInput_VMR6 <- ModelDFSL_VMR6$LitterC_VMR6 + ModelDFSL_VMR6$ManureC_VMR6
#ModelDF_SL$MInput[1] <- 0

#Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
ModelDFSL_VMR6$CTails_VMR6 <- ModelDFSL_VMR6$AllPools_noIOM_VMR6 + ModelDFSL_VMR6$MInput_VMR6

#Create Monthly Accumulated input of C
ModelDFSL_VMR6$AccumInput_VMR6 = ModelDFSL_VMR6$AccumInput_VMR6=cumsum(ModelDFSL_VMR6$MInput_VMR6)

#Create Monthly Growths for each carbon pool
ModelDFSL_VMR6$MGrowth_DPM_VMR6 <- ave(ModelDFSL_VMR6$DPM_VMR6, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMR6$MGrowth_RPM_VMR6 <- ave(ModelDFSL_VMR6$RPM_VMR6, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMR6$MGrowth_BIO_VMR6 <- ave(ModelDFSL_VMR6$BIO_VMR6, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMR6$MGrowth_HUM_VMR6 <- ave(ModelDFSL_VMR6$HUM_VMR6, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMR6$MGrowth_IOM_VMR6 <- ave(ModelDFSL_VMR6$IOM_VMR6, FUN = function(x) c(0, diff(x)))

#Create column for Monthly and Accumulated C-CO2 emissions
ModelDFSL_VMR6$M_CCO2_VMR6 <- ModelDFSL_VMR6$MInput_VMR6 - ModelDFSL_VMR6$MGrowth_DPM_VMR6 - ModelDFSL_VMR6$MGrowth_RPM_VMR6 - ModelDFSL_VMR6$MGrowth_BIO_VMR6 - ModelDFSL_VMR6$MGrowth_HUM_VMR6
ModelDFSL_VMR6$Accum_CCO2_VMR6 <- ModelDFSL_VMR6$AccumInput_VMR6 - ModelDFSL_VMR6$AllPools_noIOM_VMR6

#Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
ModelDFSL_VMR6$M_CCO2_VMR6[1] <- 0
ModelDFSL_VMR6$Accum_CCO2_VMR6[1] <- 0

#Balance validation
ModelDFSL_VMR6$Balance_VMR6 <- ModelDFSL_VMR6$AccumInput_VMR6 - ModelDFSL_VMR6$Accum_CCO2_VMR6 - (ModelDFSL_VMR6$DPM_VMR6 + ModelDFSL_VMR6$RPM_VMR6 + ModelDFSL_VMR6$BIO_VMR6 + ModelDFSL_VMR6$HUM_VMR6)

#Convert C-CO2 emissions into CO2 emissions
ModelDFSL_VMR6$M_CO2_VMR6 <- ModelDFSL_VMR6$M_CCO2_VMR6 * 44/12
ModelDFSL_VMR6$Accum_CO2_VMR6 <- ModelDFSL_VMR6$Accum_CCO2_VMR6 * 44/12

#This model will be called VMR6C because implies a continuous input of C
ModelDFSL_VMR6C <- ModelDFSL_VMR6

#Export the dataframe
write_xlsx(ModelDFSL_VMR6C,"VXC_Models\\ModelDFSL_R_VMR6C.xlsx")

#Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
#Create two equal models by using the above general script
#Create model t=x
ModelDFSLt0_VMR6 <- ModelDFSL_VMR6 #Create model t=x

#Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
ModelDFSLt1_VMR6.1 <- rbind(c(0:0), ModelDFSLt0_VMR6)
ModelDFSLt1_VMR6.2 <- rbind(c(0:0), ModelDFSLt1_VMR6.1)
ModelDFSLt1_VMR6.3 <- rbind(c(0:0), ModelDFSLt1_VMR6.2)
ModelDFSLt1_VMR6.4 <- rbind(c(0:0), ModelDFSLt1_VMR6.3)
ModelDFSLt1_VMR6.5 <- rbind(c(0:0), ModelDFSLt1_VMR6.4)
ModelDFSLt1_VMR6.6 <- rbind(c(0:0), ModelDFSLt1_VMR6.5)
ModelDFSLt1_VMR6.7 <- rbind(c(0:0), ModelDFSLt1_VMR6.6)
ModelDFSLt1_VMR6.8 <- rbind(c(0:0), ModelDFSLt1_VMR6.7)
ModelDFSLt1_VMR6.9 <- rbind(c(0:0), ModelDFSLt1_VMR6.8)
ModelDFSLt1_VMR6.10 <- rbind(c(0:0), ModelDFSLt1_VMR6.9)
ModelDFSLt1_VMR6.11 <- rbind(c(0:0), ModelDFSLt1_VMR6.10)
ModelDFSLt1_VMR6.12 <- rbind(c(0:0), ModelDFSLt1_VMR6.11)
ModelDFSLt1_VMR6.13 <- ModelDFSLt1_VMR6.12[-nrow(ModelDFSLt1_VMR6.12),]
ModelDFSLt1_VMR6.14 <- ModelDFSLt1_VMR6.13[-nrow(ModelDFSLt1_VMR6.13),]
ModelDFSLt1_VMR6.15 <- ModelDFSLt1_VMR6.14[-nrow(ModelDFSLt1_VMR6.14),]
ModelDFSLt1_VMR6.16 <- ModelDFSLt1_VMR6.15[-nrow(ModelDFSLt1_VMR6.15),]
ModelDFSLt1_VMR6.17 <- ModelDFSLt1_VMR6.16[-nrow(ModelDFSLt1_VMR6.16),]
ModelDFSLt1_VMR6.18 <- ModelDFSLt1_VMR6.17[-nrow(ModelDFSLt1_VMR6.17),]
ModelDFSLt1_VMR6.19 <- ModelDFSLt1_VMR6.18[-nrow(ModelDFSLt1_VMR6.18),]
ModelDFSLt1_VMR6.20 <- ModelDFSLt1_VMR6.19[-nrow(ModelDFSLt1_VMR6.19),]
ModelDFSLt1_VMR6.21 <- ModelDFSLt1_VMR6.20[-nrow(ModelDFSLt1_VMR6.20),]
ModelDFSLt1_VMR6.22 <- ModelDFSLt1_VMR6.21[-nrow(ModelDFSLt1_VMR6.21),]
ModelDFSLt1_VMR6.23 <- ModelDFSLt1_VMR6.22[-nrow(ModelDFSLt1_VMR6.22),]
ModelDFSLt1_VMR6.24 <- ModelDFSLt1_VMR6.23[-nrow(ModelDFSLt1_VMR6.23),]

ModelDFSLt1_VMR6 <- ModelDFSLt1_VMR6.24 #Create model t=x+1

#Subtract model (t=x) - (t=x+1)
ModelDFSL1y_VMR6 <- ModelDFSLt0_VMR6 - ModelDFSLt1_VMR6

#Re-do Month Number column because the substraction was also applied to it
ModelDFSL1y_VMR6$MNumber <- seq(from = 1, to = SimulationLength_months)

#This model will be called VMR6P because implies a one-off input of C
ModelDFSL_VMR6P <- ModelDFSL1y_VMR6

#Export the dataframe
write_xlsx(ModelDFSL_VMR6P,"VXP_Models\\ModelDFSL_R_VMR6P.xlsx")

#Plot 3: Interactive Yearly CO2 emissions #
MY <- 12
ModelDFSL_VMR6P_YCO2 <- ModelDFSL_VMR6P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VMR6)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMR6P_YCO2) <- c("Year", "Months", "AnnualCO2_VMR_6")


#Plot 3: Interactive Yearly CO2 emissions considering a delay
GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
ModelDFSL_VMR6P_YCO2D <- merge(ModelDFSL_VMR6P_YCO2, GWP100delay, by = "Year")
ModelDFSL_VMR6P_YCO2D$AnnualCO2D_VMR_6 <- ModelDFSL_VMR6P_YCO2D$AnnualCO2_VMR_6 * ModelDFSL_VMR6P_YCO2D$GWP100

#Plot 4: Interactive Yearly C emissions #
MY <- 12
ModelDFSL_VMR6P_YC <- ModelDFSL_VMR6P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VMR6)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMR6P_YC) <- c("Year", "Months", "CEmissions_VMR_6")


#Plot 5: Interactive Yearly C tails (remaining C in Soil) #
MY <- 12
ModelDFSL_VMR6P_YCT <- ModelDFSL_VMR6P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VMR6)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMR6P_YCT) <- c("Year", "Months", "CTail_VMR_6")

#Save Dataframes for Plots 3.1, 3.2, 4 and 5
write_xlsx(ModelDFSL_VMR6P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VMR6P.xlsx") #Yearly CO2 emissions (no delay)
write_xlsx(ModelDFSL_VMR6P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VMR6P.xlsx") #Yearly CO2 emissions (delay)
write_xlsx(ModelDFSL_VMR6P_YC,"CEmissions_P\\ModelDFSL_R_CE_VMR6P.xlsx") #Yearly C emissions
write_xlsx(ModelDFSL_VMR6P_YCT,"CTails_P\\ModelDFSL_R_CT_VMR6P.xlsx") #Yearly C emissions



#### 11.8 - VMR7) Manure; 70%clay; Reduced Tillage ####
#The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
fT_VMR7=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
fW_VMR7=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                        S.Thick = soil.thick, pClay = clay100*0.7,
                        pE = 1.0, bare = FALSE)$b #Moisture effects per month
xi.frame_VMR7=data.frame(years,rep(fT_VMR7*fW_VMR7,length.out=length(years)))

#To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
Model_VMR7=SoilR::RothCModel(
  t=years, #Simulation Length
  ks=c(k.DPM = 10*RTRM, k.RPM = 0.3*RTRM, k.BIO = 0.66*RTRM, k.HUM = 0.02*RTRM, k.IOM = 0*RTRM), #Decomposition rates for the different pools
  C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
  In=Scalar_LitterCinputs*0, #Amount of litter inputs by time
  FYM = Scalar_ManureCinputs*1, #Amount of Farm Yard Manure by time
  clay=clay100*0.7, #Percent clay in mineral soil
  xi=xi.frame_VMR7) #Loads the model

Ct_VMR7=getC(Model_VMR7) #Calculates stocks for each pool per month

#The results can be plotted with the commands
matplot(years, Ct_VMR7, type="l", lty=1, col=1:5,
        xlab="Time (years)", ylab="C stocks (Mg/ha)")
legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
       lty=1, col=1:5, bty="n")

VEC_Lit_VMR7 <- rep(M_Scalar_LitterCinputs*0, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
VEC_Man_VMR7 <- rep(M_Scalar_ManureCinputs*1, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

VEC_LitDF_VMR7 <- as.data.frame(VEC_Lit_VMR7) #Converting the Litter vector to a data frame
VEC_LitDF_VMR7$MNumber <- seq(from = 1, to = SimulationLength_months)
VEC_ManDF_VMR7 <- as.data.frame(VEC_Man_VMR7) #Converting the Manure vector to a data frame
VEC_ManDF_VMR7$MNumber <- seq(from = 1, to = SimulationLength_months)

sapply(VEC_LitDF_VMR7, class) #Check that class is numeric
sapply(VEC_ManDF_VMR7, class) #Check that class is numeric
LitterCinputs_VMR7=VEC_LitDF_VMR7   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
ManureCinputs_VMR7=VEC_ManDF_VMR7 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
MCinputs_VMR7 <- merge(LitterCinputs_VMR7, ManureCinputs_VMR7, by = "MNumber")
MCinputs_VMR7$MInput_VMR7 <- MCinputs_VMR7$VEC_Lit_VMR7 + MCinputs_VMR7$VEC_Man_VMR7

#Change names of litter and manure columns for more common ones
colnames(MCinputs_VMR7)[which(names(MCinputs_VMR7) == "VEC_Lit_VMR7")] <- "LitterC_VMR7"
colnames(MCinputs_VMR7)[which(names(MCinputs_VMR7) == "VEC_Man_VMR7")] <- "ManureC_VMR7"

#Create a dataframe with the data considering the simulation length
ModelDF_VMR7 <- as.data.frame(Ct_VMR7)
colnames(ModelDF_VMR7) <- c('DPM_VMR7','RPM_VMR7','BIO_VMR7', 'HUM_VMR7', 'IOM_VMR7')
ModelDFS_VMR7 <- ModelDF_VMR7[1:SimulationLength_months, ]

#Create a column with the number of month of analysis
ModelDFS_VMR7$MNumber <- seq(from = 1, to = SimulationLength_months)

#Create a column that sums all pools
ModelDFS_VMR7$AllPools_VMR7 <- ModelDFS_VMR7$DPM_VMR7 + ModelDFS_VMR7$RPM_VMR7 + ModelDFS_VMR7$BIO_VMR7 + ModelDFS_VMR7$HUM_VMR7 + ModelDFS_VMR7$IOM_VMR7

#Create a column that sums all pools except IOM (static)
ModelDFS_VMR7$AllPools_noIOM_VMR7 <- ModelDFS_VMR7$DPM_VMR7 + ModelDFS_VMR7$RPM_VMR7 + ModelDFS_VMR7$BIO_VMR7 + ModelDFS_VMR7$HUM_VMR7

#Create a column that add the monthly input of C (manure and litter separately)
ModelDFSL_VMR7 <- merge(ModelDFS_VMR7, MCinputs_VMR7, by = "MNumber")

ModelDFSL_VMR7$MInput_VMR7 <- ModelDFSL_VMR7$LitterC_VMR7 + ModelDFSL_VMR7$ManureC_VMR7
#ModelDF_SL$MInput[1] <- 0

#Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
ModelDFSL_VMR7$CTails_VMR7 <- ModelDFSL_VMR7$AllPools_noIOM_VMR7 + ModelDFSL_VMR7$MInput_VMR7

#Create Monthly Accumulated input of C
ModelDFSL_VMR7$AccumInput_VMR7 = ModelDFSL_VMR7$AccumInput_VMR7=cumsum(ModelDFSL_VMR7$MInput_VMR7)

#Create Monthly Growths for each carbon pool
ModelDFSL_VMR7$MGrowth_DPM_VMR7 <- ave(ModelDFSL_VMR7$DPM_VMR7, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMR7$MGrowth_RPM_VMR7 <- ave(ModelDFSL_VMR7$RPM_VMR7, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMR7$MGrowth_BIO_VMR7 <- ave(ModelDFSL_VMR7$BIO_VMR7, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMR7$MGrowth_HUM_VMR7 <- ave(ModelDFSL_VMR7$HUM_VMR7, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMR7$MGrowth_IOM_VMR7 <- ave(ModelDFSL_VMR7$IOM_VMR7, FUN = function(x) c(0, diff(x)))

#Create column for Monthly and Accumulated C-CO2 emissions
ModelDFSL_VMR7$M_CCO2_VMR7 <- ModelDFSL_VMR7$MInput_VMR7 - ModelDFSL_VMR7$MGrowth_DPM_VMR7 - ModelDFSL_VMR7$MGrowth_RPM_VMR7 - ModelDFSL_VMR7$MGrowth_BIO_VMR7 - ModelDFSL_VMR7$MGrowth_HUM_VMR7
ModelDFSL_VMR7$Accum_CCO2_VMR7 <- ModelDFSL_VMR7$AccumInput_VMR7 - ModelDFSL_VMR7$AllPools_noIOM_VMR7

#Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
ModelDFSL_VMR7$M_CCO2_VMR7[1] <- 0
ModelDFSL_VMR7$Accum_CCO2_VMR7[1] <- 0

#Balance validation
ModelDFSL_VMR7$Balance_VMR7 <- ModelDFSL_VMR7$AccumInput_VMR7 - ModelDFSL_VMR7$Accum_CCO2_VMR7 - (ModelDFSL_VMR7$DPM_VMR7 + ModelDFSL_VMR7$RPM_VMR7 + ModelDFSL_VMR7$BIO_VMR7 + ModelDFSL_VMR7$HUM_VMR7)

#Convert C-CO2 emissions into CO2 emissions
ModelDFSL_VMR7$M_CO2_VMR7 <- ModelDFSL_VMR7$M_CCO2_VMR7 * 44/12
ModelDFSL_VMR7$Accum_CO2_VMR7 <- ModelDFSL_VMR7$Accum_CCO2_VMR7 * 44/12

#This model will be called VMR7C because implies a continuous input of C
ModelDFSL_VMR7C <- ModelDFSL_VMR7

#Export the dataframe
write_xlsx(ModelDFSL_VMR7C,"VXC_Models\\ModelDFSL_R_VMR7C.xlsx")

#Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
#Create two equal models by using the above general script
#Create model t=x
ModelDFSLt0_VMR7 <- ModelDFSL_VMR7 #Create model t=x

#Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
ModelDFSLt1_VMR7.1 <- rbind(c(0:0), ModelDFSLt0_VMR7)
ModelDFSLt1_VMR7.2 <- rbind(c(0:0), ModelDFSLt1_VMR7.1)
ModelDFSLt1_VMR7.3 <- rbind(c(0:0), ModelDFSLt1_VMR7.2)
ModelDFSLt1_VMR7.4 <- rbind(c(0:0), ModelDFSLt1_VMR7.3)
ModelDFSLt1_VMR7.5 <- rbind(c(0:0), ModelDFSLt1_VMR7.4)
ModelDFSLt1_VMR7.6 <- rbind(c(0:0), ModelDFSLt1_VMR7.5)
ModelDFSLt1_VMR7.7 <- rbind(c(0:0), ModelDFSLt1_VMR7.6)
ModelDFSLt1_VMR7.8 <- rbind(c(0:0), ModelDFSLt1_VMR7.7)
ModelDFSLt1_VMR7.9 <- rbind(c(0:0), ModelDFSLt1_VMR7.8)
ModelDFSLt1_VMR7.10 <- rbind(c(0:0), ModelDFSLt1_VMR7.9)
ModelDFSLt1_VMR7.11 <- rbind(c(0:0), ModelDFSLt1_VMR7.10)
ModelDFSLt1_VMR7.12 <- rbind(c(0:0), ModelDFSLt1_VMR7.11)
ModelDFSLt1_VMR7.13 <- ModelDFSLt1_VMR7.12[-nrow(ModelDFSLt1_VMR7.12),]
ModelDFSLt1_VMR7.14 <- ModelDFSLt1_VMR7.13[-nrow(ModelDFSLt1_VMR7.13),]
ModelDFSLt1_VMR7.15 <- ModelDFSLt1_VMR7.14[-nrow(ModelDFSLt1_VMR7.14),]
ModelDFSLt1_VMR7.16 <- ModelDFSLt1_VMR7.15[-nrow(ModelDFSLt1_VMR7.15),]
ModelDFSLt1_VMR7.17 <- ModelDFSLt1_VMR7.16[-nrow(ModelDFSLt1_VMR7.16),]
ModelDFSLt1_VMR7.18 <- ModelDFSLt1_VMR7.17[-nrow(ModelDFSLt1_VMR7.17),]
ModelDFSLt1_VMR7.19 <- ModelDFSLt1_VMR7.18[-nrow(ModelDFSLt1_VMR7.18),]
ModelDFSLt1_VMR7.20 <- ModelDFSLt1_VMR7.19[-nrow(ModelDFSLt1_VMR7.19),]
ModelDFSLt1_VMR7.21 <- ModelDFSLt1_VMR7.20[-nrow(ModelDFSLt1_VMR7.20),]
ModelDFSLt1_VMR7.22 <- ModelDFSLt1_VMR7.21[-nrow(ModelDFSLt1_VMR7.21),]
ModelDFSLt1_VMR7.23 <- ModelDFSLt1_VMR7.22[-nrow(ModelDFSLt1_VMR7.22),]
ModelDFSLt1_VMR7.24 <- ModelDFSLt1_VMR7.23[-nrow(ModelDFSLt1_VMR7.23),]

ModelDFSLt1_VMR7 <- ModelDFSLt1_VMR7.24 #Create model t=x+1

#Subtract model (t=x) - (t=x+1)
ModelDFSL1y_VMR7 <- ModelDFSLt0_VMR7 - ModelDFSLt1_VMR7

#Re-do Month Number column because the substraction was also applied to it
ModelDFSL1y_VMR7$MNumber <- seq(from = 1, to = SimulationLength_months)

#This model will be called VMR7P because implies a one-off input of C
ModelDFSL_VMR7P <- ModelDFSL1y_VMR7

#Export the dataframe
write_xlsx(ModelDFSL_VMR7P,"VXP_Models\\ModelDFSL_R_VMR7P.xlsx")

#Plot 3: Interactive Yearly CO2 emissions #
MY <- 12
ModelDFSL_VMR7P_YCO2 <- ModelDFSL_VMR7P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VMR7)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMR7P_YCO2) <- c("Year", "Months", "AnnualCO2_VMR_7")


#Plot 3: Interactive Yearly CO2 emissions considering a delay
GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
ModelDFSL_VMR7P_YCO2D <- merge(ModelDFSL_VMR7P_YCO2, GWP100delay, by = "Year")
ModelDFSL_VMR7P_YCO2D$AnnualCO2D_VMR_7 <- ModelDFSL_VMR7P_YCO2D$AnnualCO2_VMR_7 * ModelDFSL_VMR7P_YCO2D$GWP100

#Plot 4: Interactive Yearly C emissions #
MY <- 12
ModelDFSL_VMR7P_YC <- ModelDFSL_VMR7P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VMR7)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMR7P_YC) <- c("Year", "Months", "CEmissions_VMR_7")


#Plot 5: Interactive Yearly C tails (remaining C in Soil) #
MY <- 12
ModelDFSL_VMR7P_YCT <- ModelDFSL_VMR7P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VMR7)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMR7P_YCT) <- c("Year", "Months", "CTail_VMR_7")


#Save Dataframes for Plots 3.1, 3.2, 4 and 5
write_xlsx(ModelDFSL_VMR7P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VMR7P.xlsx") #Yearly CO2 emissions (no delay)
write_xlsx(ModelDFSL_VMR7P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VMR7P.xlsx") #Yearly CO2 emissions (delay)
write_xlsx(ModelDFSL_VMR7P_YC,"CEmissions_P\\ModelDFSL_R_CE_VMR7P.xlsx") #Yearly C emissions
write_xlsx(ModelDFSL_VMR7P_YCT,"CTails_P\\ModelDFSL_R_CT_VMR7P.xlsx") #Yearly C emissions



#### 11.9 - VMR8) Manure; 80%clay; Reduced Tillage ####
#The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
fT_VMR8=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
fW_VMR8=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                        S.Thick = soil.thick, pClay = clay100*0.8,
                        pE = 1.0, bare = FALSE)$b #Moisture effects per month
xi.frame_VMR8=data.frame(years,rep(fT_VMR8*fW_VMR8,length.out=length(years)))

#To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
Model_VMR8=SoilR::RothCModel(
  t=years, #Simulation Length
  ks=c(k.DPM = 10*RTRM, k.RPM = 0.3*RTRM, k.BIO = 0.66*RTRM, k.HUM = 0.02*RTRM, k.IOM = 0*RTRM), #Decomposition rates for the different pools
  C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
  In=Scalar_LitterCinputs*0, #Amount of litter inputs by time
  FYM = Scalar_ManureCinputs*1, #Amount of Farm Yard Manure by time
  clay=clay100*0.8, #Percent clay in mineral soil
  xi=xi.frame_VMR8) #Loads the model

Ct_VMR8=getC(Model_VMR8) #Calculates stocks for each pool per month

#The results can be plotted with the commands
matplot(years, Ct_VMR8, type="l", lty=1, col=1:5,
        xlab="Time (years)", ylab="C stocks (Mg/ha)")
legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
       lty=1, col=1:5, bty="n")

VEC_Lit_VMR8 <- rep(M_Scalar_LitterCinputs*0, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
VEC_Man_VMR8 <- rep(M_Scalar_ManureCinputs*1, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

VEC_LitDF_VMR8 <- as.data.frame(VEC_Lit_VMR8) #Converting the Litter vector to a data frame
VEC_LitDF_VMR8$MNumber <- seq(from = 1, to = SimulationLength_months)
VEC_ManDF_VMR8 <- as.data.frame(VEC_Man_VMR8) #Converting the Manure vector to a data frame
VEC_ManDF_VMR8$MNumber <- seq(from = 1, to = SimulationLength_months)

sapply(VEC_LitDF_VMR8, class) #Check that class is numeric
sapply(VEC_ManDF_VMR8, class) #Check that class is numeric
LitterCinputs_VMR8=VEC_LitDF_VMR8   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
ManureCinputs_VMR8=VEC_ManDF_VMR8 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
MCinputs_VMR8 <- merge(LitterCinputs_VMR8, ManureCinputs_VMR8, by = "MNumber")
MCinputs_VMR8$MInput_VMR8 <- MCinputs_VMR8$VEC_Lit_VMR8 + MCinputs_VMR8$VEC_Man_VMR8

#Change names of litter and manure columns for more common ones
colnames(MCinputs_VMR8)[which(names(MCinputs_VMR8) == "VEC_Lit_VMR8")] <- "LitterC_VMR8"
colnames(MCinputs_VMR8)[which(names(MCinputs_VMR8) == "VEC_Man_VMR8")] <- "ManureC_VMR8"

#Create a dataframe with the data considering the simulation length
ModelDF_VMR8 <- as.data.frame(Ct_VMR8)
colnames(ModelDF_VMR8) <- c('DPM_VMR8','RPM_VMR8','BIO_VMR8', 'HUM_VMR8', 'IOM_VMR8')
ModelDFS_VMR8 <- ModelDF_VMR8[1:SimulationLength_months, ]

#Create a column with the number of month of analysis
ModelDFS_VMR8$MNumber <- seq(from = 1, to = SimulationLength_months)

#Create a column that sums all pools
ModelDFS_VMR8$AllPools_VMR8 <- ModelDFS_VMR8$DPM_VMR8 + ModelDFS_VMR8$RPM_VMR8 + ModelDFS_VMR8$BIO_VMR8 + ModelDFS_VMR8$HUM_VMR8 + ModelDFS_VMR8$IOM_VMR8

#Create a column that sums all pools except IOM (static)
ModelDFS_VMR8$AllPools_noIOM_VMR8 <- ModelDFS_VMR8$DPM_VMR8 + ModelDFS_VMR8$RPM_VMR8 + ModelDFS_VMR8$BIO_VMR8 + ModelDFS_VMR8$HUM_VMR8

#Create a column that add the monthly input of C (manure and litter separately)
ModelDFSL_VMR8 <- merge(ModelDFS_VMR8, MCinputs_VMR8, by = "MNumber")

ModelDFSL_VMR8$MInput_VMR8 <- ModelDFSL_VMR8$LitterC_VMR8 + ModelDFSL_VMR8$ManureC_VMR8
#ModelDF_SL$MInput[1] <- 0

#Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
ModelDFSL_VMR8$CTails_VMR8 <- ModelDFSL_VMR8$AllPools_noIOM_VMR8 + ModelDFSL_VMR8$MInput_VMR8

#Create Monthly Accumulated input of C
ModelDFSL_VMR8$AccumInput_VMR8 = ModelDFSL_VMR8$AccumInput_VMR8=cumsum(ModelDFSL_VMR8$MInput_VMR8)

#Create Monthly Growths for each carbon pool
ModelDFSL_VMR8$MGrowth_DPM_VMR8 <- ave(ModelDFSL_VMR8$DPM_VMR8, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMR8$MGrowth_RPM_VMR8 <- ave(ModelDFSL_VMR8$RPM_VMR8, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMR8$MGrowth_BIO_VMR8 <- ave(ModelDFSL_VMR8$BIO_VMR8, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMR8$MGrowth_HUM_VMR8 <- ave(ModelDFSL_VMR8$HUM_VMR8, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMR8$MGrowth_IOM_VMR8 <- ave(ModelDFSL_VMR8$IOM_VMR8, FUN = function(x) c(0, diff(x)))

#Create column for Monthly and Accumulated C-CO2 emissions
ModelDFSL_VMR8$M_CCO2_VMR8 <- ModelDFSL_VMR8$MInput_VMR8 - ModelDFSL_VMR8$MGrowth_DPM_VMR8 - ModelDFSL_VMR8$MGrowth_RPM_VMR8 - ModelDFSL_VMR8$MGrowth_BIO_VMR8 - ModelDFSL_VMR8$MGrowth_HUM_VMR8
ModelDFSL_VMR8$Accum_CCO2_VMR8 <- ModelDFSL_VMR8$AccumInput_VMR8 - ModelDFSL_VMR8$AllPools_noIOM_VMR8

#Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
ModelDFSL_VMR8$M_CCO2_VMR8[1] <- 0
ModelDFSL_VMR8$Accum_CCO2_VMR8[1] <- 0

#Balance validation
ModelDFSL_VMR8$Balance_VMR8 <- ModelDFSL_VMR8$AccumInput_VMR8 - ModelDFSL_VMR8$Accum_CCO2_VMR8 - (ModelDFSL_VMR8$DPM_VMR8 + ModelDFSL_VMR8$RPM_VMR8 + ModelDFSL_VMR8$BIO_VMR8 + ModelDFSL_VMR8$HUM_VMR8)

#Convert C-CO2 emissions into CO2 emissions
ModelDFSL_VMR8$M_CO2_VMR8 <- ModelDFSL_VMR8$M_CCO2_VMR8 * 44/12
ModelDFSL_VMR8$Accum_CO2_VMR8 <- ModelDFSL_VMR8$Accum_CCO2_VMR8 * 44/12

#This model will be called VMR8C because implies a continuous input of C
ModelDFSL_VMR8C <- ModelDFSL_VMR8

#Export the dataframe
write_xlsx(ModelDFSL_VMR8C,"VXC_Models\\ModelDFSL_R_VMR8C.xlsx")

#Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
#Create two equal models by using the above general script
#Create model t=x
ModelDFSLt0_VMR8 <- ModelDFSL_VMR8 #Create model t=x

#Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
ModelDFSLt1_VMR8.1 <- rbind(c(0:0), ModelDFSLt0_VMR8)
ModelDFSLt1_VMR8.2 <- rbind(c(0:0), ModelDFSLt1_VMR8.1)
ModelDFSLt1_VMR8.3 <- rbind(c(0:0), ModelDFSLt1_VMR8.2)
ModelDFSLt1_VMR8.4 <- rbind(c(0:0), ModelDFSLt1_VMR8.3)
ModelDFSLt1_VMR8.5 <- rbind(c(0:0), ModelDFSLt1_VMR8.4)
ModelDFSLt1_VMR8.6 <- rbind(c(0:0), ModelDFSLt1_VMR8.5)
ModelDFSLt1_VMR8.7 <- rbind(c(0:0), ModelDFSLt1_VMR8.6)
ModelDFSLt1_VMR8.8 <- rbind(c(0:0), ModelDFSLt1_VMR8.7)
ModelDFSLt1_VMR8.9 <- rbind(c(0:0), ModelDFSLt1_VMR8.8)
ModelDFSLt1_VMR8.10 <- rbind(c(0:0), ModelDFSLt1_VMR8.9)
ModelDFSLt1_VMR8.11 <- rbind(c(0:0), ModelDFSLt1_VMR8.10)
ModelDFSLt1_VMR8.12 <- rbind(c(0:0), ModelDFSLt1_VMR8.11)
ModelDFSLt1_VMR8.13 <- ModelDFSLt1_VMR8.12[-nrow(ModelDFSLt1_VMR8.12),]
ModelDFSLt1_VMR8.14 <- ModelDFSLt1_VMR8.13[-nrow(ModelDFSLt1_VMR8.13),]
ModelDFSLt1_VMR8.15 <- ModelDFSLt1_VMR8.14[-nrow(ModelDFSLt1_VMR8.14),]
ModelDFSLt1_VMR8.16 <- ModelDFSLt1_VMR8.15[-nrow(ModelDFSLt1_VMR8.15),]
ModelDFSLt1_VMR8.17 <- ModelDFSLt1_VMR8.16[-nrow(ModelDFSLt1_VMR8.16),]
ModelDFSLt1_VMR8.18 <- ModelDFSLt1_VMR8.17[-nrow(ModelDFSLt1_VMR8.17),]
ModelDFSLt1_VMR8.19 <- ModelDFSLt1_VMR8.18[-nrow(ModelDFSLt1_VMR8.18),]
ModelDFSLt1_VMR8.20 <- ModelDFSLt1_VMR8.19[-nrow(ModelDFSLt1_VMR8.19),]
ModelDFSLt1_VMR8.21 <- ModelDFSLt1_VMR8.20[-nrow(ModelDFSLt1_VMR8.20),]
ModelDFSLt1_VMR8.22 <- ModelDFSLt1_VMR8.21[-nrow(ModelDFSLt1_VMR8.21),]
ModelDFSLt1_VMR8.23 <- ModelDFSLt1_VMR8.22[-nrow(ModelDFSLt1_VMR8.22),]
ModelDFSLt1_VMR8.24 <- ModelDFSLt1_VMR8.23[-nrow(ModelDFSLt1_VMR8.23),]

ModelDFSLt1_VMR8 <- ModelDFSLt1_VMR8.24 #Create model t=x+1

#Subtract model (t=x) - (t=x+1)
ModelDFSL1y_VMR8 <- ModelDFSLt0_VMR8 - ModelDFSLt1_VMR8

#Re-do Month Number column because the substraction was also applied to it
ModelDFSL1y_VMR8$MNumber <- seq(from = 1, to = SimulationLength_months)

#This model will be called VMR8P because implies a one-off input of C
ModelDFSL_VMR8P <- ModelDFSL1y_VMR8

#Export the dataframe
write_xlsx(ModelDFSL_VMR8P,"VXP_Models\\ModelDFSL_R_VMR8P.xlsx")


#Plot 3: Interactive Yearly CO2 emissions #
MY <- 12
ModelDFSL_VMR8P_YCO2 <- ModelDFSL_VMR8P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VMR8)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMR8P_YCO2) <- c("Year", "Months", "AnnualCO2_VMR_8")

#Plot 3: Interactive Yearly CO2 emissions considering a delay
GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
ModelDFSL_VMR8P_YCO2D <- merge(ModelDFSL_VMR8P_YCO2, GWP100delay, by = "Year")
ModelDFSL_VMR8P_YCO2D$AnnualCO2D_VMR_8 <- ModelDFSL_VMR8P_YCO2D$AnnualCO2_VMR_8 * ModelDFSL_VMR8P_YCO2D$GWP100


#Plot 4: Interactive Yearly C emissions #
MY <- 12
ModelDFSL_VMR8P_YC <- ModelDFSL_VMR8P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VMR8)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMR8P_YC) <- c("Year", "Months", "CEmissions_VMR_8")

#Plot 5: Interactive Yearly C tails (remaining C in Soil) #
MY <- 12
ModelDFSL_VMR8P_YCT <- ModelDFSL_VMR8P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VMR8)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMR8P_YCT) <- c("Year", "Months", "CTail_VMR_8")

#Save Dataframes for Plots 3.1, 3.2, 4 and 5
write_xlsx(ModelDFSL_VMR8P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VMR8P.xlsx") #Yearly CO2 emissions (no delay)
write_xlsx(ModelDFSL_VMR8P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VMR8P.xlsx") #Yearly CO2 emissions (delay)
write_xlsx(ModelDFSL_VMR8P_YC,"CEmissions_P\\ModelDFSL_R_CE_VMR8P.xlsx") #Yearly C emissions
write_xlsx(ModelDFSL_VMR8P_YCT,"CTails_P\\ModelDFSL_R_CT_VMR8P.xlsx") #Yearly C emissions



#### 11.10 - VMR9) Manure; 90%clay; Reduced Tillage ####
#The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
fT_VMR9=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
fW_VMR9=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                        S.Thick = soil.thick, pClay = clay100*0.9,
                        pE = 1.0, bare = FALSE)$b #Moisture effects per month
xi.frame_VMR9=data.frame(years,rep(fT_VMR9*fW_VMR9,length.out=length(years)))

#To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
Model_VMR9=SoilR::RothCModel(
  t=years, #Simulation Length
  ks=c(k.DPM = 10*RTRM, k.RPM = 0.3*RTRM, k.BIO = 0.66*RTRM, k.HUM = 0.02*RTRM, k.IOM = 0*RTRM), #Decomposition rates for the different pools
  C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
  In=Scalar_LitterCinputs*0, #Amount of litter inputs by time
  FYM = Scalar_ManureCinputs*1, #Amount of Farm Yard Manure by time
  clay=clay100*0.9, #Percent clay in mineral soil
  xi=xi.frame_VMR9) #Loads the model

Ct_VMR9=getC(Model_VMR9) #Calculates stocks for each pool per month

#The results can be plotted with the commands
matplot(years, Ct_VMR9, type="l", lty=1, col=1:5,
        xlab="Time (years)", ylab="C stocks (Mg/ha)")
legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
       lty=1, col=1:5, bty="n")

VEC_Lit_VMR9 <- rep(M_Scalar_LitterCinputs*0, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
VEC_Man_VMR9 <- rep(M_Scalar_ManureCinputs*1, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

VEC_LitDF_VMR9 <- as.data.frame(VEC_Lit_VMR9) #Converting the Litter vector to a data frame
VEC_LitDF_VMR9$MNumber <- seq(from = 1, to = SimulationLength_months)
VEC_ManDF_VMR9 <- as.data.frame(VEC_Man_VMR9) #Converting the Manure vector to a data frame
VEC_ManDF_VMR9$MNumber <- seq(from = 1, to = SimulationLength_months)

sapply(VEC_LitDF_VMR9, class) #Check that class is numeric
sapply(VEC_ManDF_VMR9, class) #Check that class is numeric
LitterCinputs_VMR9=VEC_LitDF_VMR9   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
ManureCinputs_VMR9=VEC_ManDF_VMR9 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
MCinputs_VMR9 <- merge(LitterCinputs_VMR9, ManureCinputs_VMR9, by = "MNumber")
MCinputs_VMR9$MInput_VMR9 <- MCinputs_VMR9$VEC_Lit_VMR9 + MCinputs_VMR9$VEC_Man_VMR9

#Change names of litter and manure columns for more common ones
colnames(MCinputs_VMR9)[which(names(MCinputs_VMR9) == "VEC_Lit_VMR9")] <- "LitterC_VMR9"
colnames(MCinputs_VMR9)[which(names(MCinputs_VMR9) == "VEC_Man_VMR9")] <- "ManureC_VMR9"

#Create a dataframe with the data considering the simulation length
ModelDF_VMR9 <- as.data.frame(Ct_VMR9)
colnames(ModelDF_VMR9) <- c('DPM_VMR9','RPM_VMR9','BIO_VMR9', 'HUM_VMR9', 'IOM_VMR9')
ModelDFS_VMR9 <- ModelDF_VMR9[1:SimulationLength_months, ]

#Create a column with the number of month of analysis
ModelDFS_VMR9$MNumber <- seq(from = 1, to = SimulationLength_months)

#Create a column that sums all pools
ModelDFS_VMR9$AllPools_VMR9 <- ModelDFS_VMR9$DPM_VMR9 + ModelDFS_VMR9$RPM_VMR9 + ModelDFS_VMR9$BIO_VMR9 + ModelDFS_VMR9$HUM_VMR9 + ModelDFS_VMR9$IOM_VMR9

#Create a column that sums all pools except IOM (static)
ModelDFS_VMR9$AllPools_noIOM_VMR9 <- ModelDFS_VMR9$DPM_VMR9 + ModelDFS_VMR9$RPM_VMR9 + ModelDFS_VMR9$BIO_VMR9 + ModelDFS_VMR9$HUM_VMR9

#Create a column that add the monthly input of C (manure and litter separately)
ModelDFSL_VMR9 <- merge(ModelDFS_VMR9, MCinputs_VMR9, by = "MNumber")

ModelDFSL_VMR9$MInput_VMR9 <- ModelDFSL_VMR9$LitterC_VMR9 + ModelDFSL_VMR9$ManureC_VMR9
#ModelDF_SL$MInput[1] <- 0

#Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
ModelDFSL_VMR9$CTails_VMR9 <- ModelDFSL_VMR9$AllPools_noIOM_VMR9 + ModelDFSL_VMR9$MInput_VMR9

#Create Monthly Accumulated input of C
ModelDFSL_VMR9$AccumInput_VMR9 = ModelDFSL_VMR9$AccumInput_VMR9=cumsum(ModelDFSL_VMR9$MInput_VMR9)

#Create Monthly Growths for each carbon pool
ModelDFSL_VMR9$MGrowth_DPM_VMR9 <- ave(ModelDFSL_VMR9$DPM_VMR9, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMR9$MGrowth_RPM_VMR9 <- ave(ModelDFSL_VMR9$RPM_VMR9, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMR9$MGrowth_BIO_VMR9 <- ave(ModelDFSL_VMR9$BIO_VMR9, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMR9$MGrowth_HUM_VMR9 <- ave(ModelDFSL_VMR9$HUM_VMR9, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMR9$MGrowth_IOM_VMR9 <- ave(ModelDFSL_VMR9$IOM_VMR9, FUN = function(x) c(0, diff(x)))

#Create column for Monthly and Accumulated C-CO2 emissions
ModelDFSL_VMR9$M_CCO2_VMR9 <- ModelDFSL_VMR9$MInput_VMR9 - ModelDFSL_VMR9$MGrowth_DPM_VMR9 - ModelDFSL_VMR9$MGrowth_RPM_VMR9 - ModelDFSL_VMR9$MGrowth_BIO_VMR9 - ModelDFSL_VMR9$MGrowth_HUM_VMR9
ModelDFSL_VMR9$Accum_CCO2_VMR9 <- ModelDFSL_VMR9$AccumInput_VMR9 - ModelDFSL_VMR9$AllPools_noIOM_VMR9

#Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
ModelDFSL_VMR9$M_CCO2_VMR9[1] <- 0
ModelDFSL_VMR9$Accum_CCO2_VMR9[1] <- 0

#Balance validation
ModelDFSL_VMR9$Balance_VMR9 <- ModelDFSL_VMR9$AccumInput_VMR9 - ModelDFSL_VMR9$Accum_CCO2_VMR9 - (ModelDFSL_VMR9$DPM_VMR9 + ModelDFSL_VMR9$RPM_VMR9 + ModelDFSL_VMR9$BIO_VMR9 + ModelDFSL_VMR9$HUM_VMR9)

#Convert C-CO2 emissions into CO2 emissions
ModelDFSL_VMR9$M_CO2_VMR9 <- ModelDFSL_VMR9$M_CCO2_VMR9 * 44/12
ModelDFSL_VMR9$Accum_CO2_VMR9 <- ModelDFSL_VMR9$Accum_CCO2_VMR9 * 44/12

#This model will be called VMR9C because implies a continuous input of C
ModelDFSL_VMR9C <- ModelDFSL_VMR9

#Export the dataframe
write_xlsx(ModelDFSL_VMR9C,"VXC_Models\\ModelDFSL_R_VMR9C.xlsx")

#Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
#Create two equal models by using the above general script
#Create model t=x
ModelDFSLt0_VMR9 <- ModelDFSL_VMR9 #Create model t=x

#Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
ModelDFSLt1_VMR9.1 <- rbind(c(0:0), ModelDFSLt0_VMR9)
ModelDFSLt1_VMR9.2 <- rbind(c(0:0), ModelDFSLt1_VMR9.1)
ModelDFSLt1_VMR9.3 <- rbind(c(0:0), ModelDFSLt1_VMR9.2)
ModelDFSLt1_VMR9.4 <- rbind(c(0:0), ModelDFSLt1_VMR9.3)
ModelDFSLt1_VMR9.5 <- rbind(c(0:0), ModelDFSLt1_VMR9.4)
ModelDFSLt1_VMR9.6 <- rbind(c(0:0), ModelDFSLt1_VMR9.5)
ModelDFSLt1_VMR9.7 <- rbind(c(0:0), ModelDFSLt1_VMR9.6)
ModelDFSLt1_VMR9.8 <- rbind(c(0:0), ModelDFSLt1_VMR9.7)
ModelDFSLt1_VMR9.9 <- rbind(c(0:0), ModelDFSLt1_VMR9.8)
ModelDFSLt1_VMR9.10 <- rbind(c(0:0), ModelDFSLt1_VMR9.9)
ModelDFSLt1_VMR9.11 <- rbind(c(0:0), ModelDFSLt1_VMR9.10)
ModelDFSLt1_VMR9.12 <- rbind(c(0:0), ModelDFSLt1_VMR9.11)
ModelDFSLt1_VMR9.13 <- ModelDFSLt1_VMR9.12[-nrow(ModelDFSLt1_VMR9.12),]
ModelDFSLt1_VMR9.14 <- ModelDFSLt1_VMR9.13[-nrow(ModelDFSLt1_VMR9.13),]
ModelDFSLt1_VMR9.15 <- ModelDFSLt1_VMR9.14[-nrow(ModelDFSLt1_VMR9.14),]
ModelDFSLt1_VMR9.16 <- ModelDFSLt1_VMR9.15[-nrow(ModelDFSLt1_VMR9.15),]
ModelDFSLt1_VMR9.17 <- ModelDFSLt1_VMR9.16[-nrow(ModelDFSLt1_VMR9.16),]
ModelDFSLt1_VMR9.18 <- ModelDFSLt1_VMR9.17[-nrow(ModelDFSLt1_VMR9.17),]
ModelDFSLt1_VMR9.19 <- ModelDFSLt1_VMR9.18[-nrow(ModelDFSLt1_VMR9.18),]
ModelDFSLt1_VMR9.20 <- ModelDFSLt1_VMR9.19[-nrow(ModelDFSLt1_VMR9.19),]
ModelDFSLt1_VMR9.21 <- ModelDFSLt1_VMR9.20[-nrow(ModelDFSLt1_VMR9.20),]
ModelDFSLt1_VMR9.22 <- ModelDFSLt1_VMR9.21[-nrow(ModelDFSLt1_VMR9.21),]
ModelDFSLt1_VMR9.23 <- ModelDFSLt1_VMR9.22[-nrow(ModelDFSLt1_VMR9.22),]
ModelDFSLt1_VMR9.24 <- ModelDFSLt1_VMR9.23[-nrow(ModelDFSLt1_VMR9.23),]

ModelDFSLt1_VMR9 <- ModelDFSLt1_VMR9.24 #Create model t=x+1

#Subtract model (t=x) - (t=x+1)
ModelDFSL1y_VMR9 <- ModelDFSLt0_VMR9 - ModelDFSLt1_VMR9

#Re-do Month Number column because the substraction was also applied to it
ModelDFSL1y_VMR9$MNumber <- seq(from = 1, to = SimulationLength_months)

#This model will be called VMR9P because implies a one-off input of C
ModelDFSL_VMR9P <- ModelDFSL1y_VMR9

#Export the dataframe
write_xlsx(ModelDFSL_VMR9P,"VXP_Models\\ModelDFSL_R_VMR9P.xlsx")


#Plot 3: Interactive Yearly CO2 emissions #
MY <- 12
ModelDFSL_VMR9P_YCO2 <- ModelDFSL_VMR9P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VMR9)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMR9P_YCO2) <- c("Year", "Months", "AnnualCO2_VMR_9")

#Plot 3: Interactive Yearly CO2 emissions considering a delay
GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
ModelDFSL_VMR9P_YCO2D <- merge(ModelDFSL_VMR9P_YCO2, GWP100delay, by = "Year")
ModelDFSL_VMR9P_YCO2D$AnnualCO2D_VMR_9 <- ModelDFSL_VMR9P_YCO2D$AnnualCO2_VMR_9 * ModelDFSL_VMR9P_YCO2D$GWP100


#Plot 4: Interactive Yearly C emissions #
MY <- 12
ModelDFSL_VMR9P_YC <- ModelDFSL_VMR9P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VMR9)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMR9P_YC) <- c("Year", "Months", "CEmissions_VMR_9")

#Plot 5: Interactive Yearly C tails (remaining C in Soil) #
MY <- 12
ModelDFSL_VMR9P_YCT <- ModelDFSL_VMR9P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VMR9)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMR9P_YCT) <- c("Year", "Months", "CTail_VMR_9")

#Save Dataframes for Plots 3.1, 3.2, 4 and 5
write_xlsx(ModelDFSL_VMR9P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VMR9P.xlsx") #Yearly CO2 emissions (no delay)
write_xlsx(ModelDFSL_VMR9P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VMR9P.xlsx") #Yearly CO2 emissions (delay)
write_xlsx(ModelDFSL_VMR9P_YC,"CEmissions_P\\ModelDFSL_R_CE_VMR9P.xlsx") #Yearly C emissions
write_xlsx(ModelDFSL_VMR9P_YCT,"CTails_P\\ModelDFSL_R_CT_VMR9P.xlsx") #Yearly C emissions



#### 11.11 - VMR10) Manure; 100%clay; Reduced Tillage ####
#The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
fT_VMR10=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
fW_VMR10=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                         S.Thick = soil.thick, pClay = clay100,
                         pE = 1.0, bare = FALSE)$b #Moisture effects per month
xi.frame_VMR10=data.frame(years,rep(fT_VMR10*fW_VMR10,length.out=length(years)))

#To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
Model_VMR10=SoilR::RothCModel(
  t=years, #Simulation Length
  ks=c(k.DPM = 10*RTRM, k.RPM = 0.3*RTRM, k.BIO = 0.66*RTRM, k.HUM = 0.02*RTRM, k.IOM = 0*RTRM), #Decomposition rates for the different pools
  C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
  In=Scalar_LitterCinputs*0, #Amount of litter inputs by time
  FYM = Scalar_ManureCinputs*1, #Amount of Farm Yard Manure by time
  clay=clay100, #Percent clay in mineral soil
  xi=xi.frame_VMR10) #Loads the model

Ct_VMR10=getC(Model_VMR10) #Calculates stocks for each pool per month

#The results can be plotted with the commands
matplot(years, Ct_VMR10, type="l", lty=1, col=1:5,
        xlab="Time (years)", ylab="C stocks (Mg/ha)")
legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
       lty=1, col=1:5, bty="n")

VEC_Lit_VMR10 <- rep(M_Scalar_LitterCinputs*0, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
VEC_Man_VMR10 <- rep(M_Scalar_ManureCinputs*1, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

VEC_LitDF_VMR10 <- as.data.frame(VEC_Lit_VMR10) #Converting the Litter vector to a data frame
VEC_LitDF_VMR10$MNumber <- seq(from = 1, to = SimulationLength_months)
VEC_ManDF_VMR10 <- as.data.frame(VEC_Man_VMR10) #Converting the Manure vector to a data frame
VEC_ManDF_VMR10$MNumber <- seq(from = 1, to = SimulationLength_months)

sapply(VEC_LitDF_VMR10, class) #Check that class is numeric
sapply(VEC_ManDF_VMR10, class) #Check that class is numeric
LitterCinputs_VMR10=VEC_LitDF_VMR10   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
ManureCinputs_VMR10=VEC_ManDF_VMR10 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
MCinputs_VMR10 <- merge(LitterCinputs_VMR10, ManureCinputs_VMR10, by = "MNumber")
MCinputs_VMR10$MInput_VMR10 <- MCinputs_VMR10$VEC_Lit_VMR10 + MCinputs_VMR10$VEC_Man_VMR10

#Change names of litter and manure columns for more common ones
colnames(MCinputs_VMR10)[which(names(MCinputs_VMR10) == "VEC_Lit_VMR10")] <- "LitterC_VMR10"
colnames(MCinputs_VMR10)[which(names(MCinputs_VMR10) == "VEC_Man_VMR10")] <- "ManureC_VMR10"

#Create a dataframe with the data considering the simulation length
ModelDF_VMR10 <- as.data.frame(Ct_VMR10)
colnames(ModelDF_VMR10) <- c('DPM_VMR10','RPM_VMR10','BIO_VMR10', 'HUM_VMR10', 'IOM_VMR10')
ModelDFS_VMR10 <- ModelDF_VMR10[1:SimulationLength_months, ]

#Create a column with the number of month of analysis
ModelDFS_VMR10$MNumber <- seq(from = 1, to = SimulationLength_months)

#Create a column that sums all pools
ModelDFS_VMR10$AllPools_VMR10 <- ModelDFS_VMR10$DPM_VMR10 + ModelDFS_VMR10$RPM_VMR10 + ModelDFS_VMR10$BIO_VMR10 + ModelDFS_VMR10$HUM_VMR10 + ModelDFS_VMR10$IOM_VMR10

#Create a column that sums all pools except IOM (static)
ModelDFS_VMR10$AllPools_noIOM_VMR10 <- ModelDFS_VMR10$DPM_VMR10 + ModelDFS_VMR10$RPM_VMR10 + ModelDFS_VMR10$BIO_VMR10 + ModelDFS_VMR10$HUM_VMR10

#Create a column that add the monthly input of C (manure and litter separately)
ModelDFSL_VMR10 <- merge(ModelDFS_VMR10, MCinputs_VMR10, by = "MNumber")

ModelDFSL_VMR10$MInput_VMR10 <- ModelDFSL_VMR10$LitterC_VMR10 + ModelDFSL_VMR10$ManureC_VMR10
#ModelDF_SL$MInput[1] <- 0

#Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
ModelDFSL_VMR10$CTails_VMR10 <- ModelDFSL_VMR10$AllPools_noIOM_VMR10 + ModelDFSL_VMR10$MInput_VMR10

#Create Monthly Accumulated input of C
ModelDFSL_VMR10$AccumInput_VMR10 = ModelDFSL_VMR10$AccumInput_VMR10=cumsum(ModelDFSL_VMR10$MInput_VMR10)

#Create Monthly Growths for each carbon pool
ModelDFSL_VMR10$MGrowth_DPM_VMR10 <- ave(ModelDFSL_VMR10$DPM_VMR10, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMR10$MGrowth_RPM_VMR10 <- ave(ModelDFSL_VMR10$RPM_VMR10, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMR10$MGrowth_BIO_VMR10 <- ave(ModelDFSL_VMR10$BIO_VMR10, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMR10$MGrowth_HUM_VMR10 <- ave(ModelDFSL_VMR10$HUM_VMR10, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMR10$MGrowth_IOM_VMR10 <- ave(ModelDFSL_VMR10$IOM_VMR10, FUN = function(x) c(0, diff(x)))

#Create column for Monthly and Accumulated C-CO2 emissions
ModelDFSL_VMR10$M_CCO2_VMR10 <- ModelDFSL_VMR10$MInput_VMR10 - ModelDFSL_VMR10$MGrowth_DPM_VMR10 - ModelDFSL_VMR10$MGrowth_RPM_VMR10 - ModelDFSL_VMR10$MGrowth_BIO_VMR10 - ModelDFSL_VMR10$MGrowth_HUM_VMR10
ModelDFSL_VMR10$Accum_CCO2_VMR10 <- ModelDFSL_VMR10$AccumInput_VMR10 - ModelDFSL_VMR10$AllPools_noIOM_VMR10

#Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
ModelDFSL_VMR10$M_CCO2_VMR10[1] <- 0
ModelDFSL_VMR10$Accum_CCO2_VMR10[1] <- 0

#Balance validation
ModelDFSL_VMR10$Balance_VMR10 <- ModelDFSL_VMR10$AccumInput_VMR10 - ModelDFSL_VMR10$Accum_CCO2_VMR10 - (ModelDFSL_VMR10$DPM_VMR10 + ModelDFSL_VMR10$RPM_VMR10 + ModelDFSL_VMR10$BIO_VMR10 + ModelDFSL_VMR10$HUM_VMR10)

#Convert C-CO2 emissions into CO2 emissions
ModelDFSL_VMR10$M_CO2_VMR10 <- ModelDFSL_VMR10$M_CCO2_VMR10 * 44/12
ModelDFSL_VMR10$Accum_CO2_VMR10 <- ModelDFSL_VMR10$Accum_CCO2_VMR10 * 44/12

#This model will be called VMR10C because implies a continuous input of C
ModelDFSL_VMR10C <- ModelDFSL_VMR10

#Export the dataframe
write_xlsx(ModelDFSL_VMR10C,"VXC_Models\\ModelDFSL_R_VMR10C.xlsx")

#Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
#Create two equal models by using the above general script
#Create model t=x
ModelDFSLt0_VMR10 <- ModelDFSL_VMR10 #Create model t=x

#Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
ModelDFSLt1_VMR10.1 <- rbind(c(0:0), ModelDFSLt0_VMR10)
ModelDFSLt1_VMR10.2 <- rbind(c(0:0), ModelDFSLt1_VMR10.1)
ModelDFSLt1_VMR10.3 <- rbind(c(0:0), ModelDFSLt1_VMR10.2)
ModelDFSLt1_VMR10.4 <- rbind(c(0:0), ModelDFSLt1_VMR10.3)
ModelDFSLt1_VMR10.5 <- rbind(c(0:0), ModelDFSLt1_VMR10.4)
ModelDFSLt1_VMR10.6 <- rbind(c(0:0), ModelDFSLt1_VMR10.5)
ModelDFSLt1_VMR10.7 <- rbind(c(0:0), ModelDFSLt1_VMR10.6)
ModelDFSLt1_VMR10.8 <- rbind(c(0:0), ModelDFSLt1_VMR10.7)
ModelDFSLt1_VMR10.9 <- rbind(c(0:0), ModelDFSLt1_VMR10.8)
ModelDFSLt1_VMR10.10 <- rbind(c(0:0), ModelDFSLt1_VMR10.9)
ModelDFSLt1_VMR10.11 <- rbind(c(0:0), ModelDFSLt1_VMR10.10)
ModelDFSLt1_VMR10.12 <- rbind(c(0:0), ModelDFSLt1_VMR10.11)
ModelDFSLt1_VMR10.13 <- ModelDFSLt1_VMR10.12[-nrow(ModelDFSLt1_VMR10.12),]
ModelDFSLt1_VMR10.14 <- ModelDFSLt1_VMR10.13[-nrow(ModelDFSLt1_VMR10.13),]
ModelDFSLt1_VMR10.15 <- ModelDFSLt1_VMR10.14[-nrow(ModelDFSLt1_VMR10.14),]
ModelDFSLt1_VMR10.16 <- ModelDFSLt1_VMR10.15[-nrow(ModelDFSLt1_VMR10.15),]
ModelDFSLt1_VMR10.17 <- ModelDFSLt1_VMR10.16[-nrow(ModelDFSLt1_VMR10.16),]
ModelDFSLt1_VMR10.18 <- ModelDFSLt1_VMR10.17[-nrow(ModelDFSLt1_VMR10.17),]
ModelDFSLt1_VMR10.19 <- ModelDFSLt1_VMR10.18[-nrow(ModelDFSLt1_VMR10.18),]
ModelDFSLt1_VMR10.20 <- ModelDFSLt1_VMR10.19[-nrow(ModelDFSLt1_VMR10.19),]
ModelDFSLt1_VMR10.21 <- ModelDFSLt1_VMR10.20[-nrow(ModelDFSLt1_VMR10.20),]
ModelDFSLt1_VMR10.22 <- ModelDFSLt1_VMR10.21[-nrow(ModelDFSLt1_VMR10.21),]
ModelDFSLt1_VMR10.23 <- ModelDFSLt1_VMR10.22[-nrow(ModelDFSLt1_VMR10.22),]
ModelDFSLt1_VMR10.24 <- ModelDFSLt1_VMR10.23[-nrow(ModelDFSLt1_VMR10.23),]

ModelDFSLt1_VMR10 <- ModelDFSLt1_VMR10.24 #Create model t=x+1

#Subtract model (t=x) - (t=x+1)
ModelDFSL1y_VMR10 <- ModelDFSLt0_VMR10 - ModelDFSLt1_VMR10

#Re-do Month Number column because the substraction was also applied to it
ModelDFSL1y_VMR10$MNumber <- seq(from = 1, to = SimulationLength_months)

#This model will be called VMR10P because implies a one-off input of C
ModelDFSL_VMR10P <- ModelDFSL1y_VMR10

#Export the dataframe
write_xlsx(ModelDFSL_VMR10P,"VXP_Models\\ModelDFSL_R_VMR10P.xlsx")


#Plot 3: Interactive Yearly CO2 emissions #
MY <- 12
ModelDFSL_VMR10P_YCO2 <- ModelDFSL_VMR10P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VMR10)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMR10P_YCO2) <- c("Year", "Months", "AnnualCO2_VMR10")

#Plot 3: Interactive Yearly CO2 emissions considering a delay
GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
ModelDFSL_VMR10P_YCO2D <- merge(ModelDFSL_VMR10P_YCO2, GWP100delay, by = "Year")
ModelDFSL_VMR10P_YCO2D$AnnualCO2D_VMR10 <- ModelDFSL_VMR10P_YCO2D$AnnualCO2_VMR10 * ModelDFSL_VMR10P_YCO2D$GWP100

#Plot 4: Interactive Yearly C emissions #
MY <- 12
ModelDFSL_VMR10P_YC <- ModelDFSL_VMR10P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VMR10)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMR10P_YC) <- c("Year", "Months", "CEmissions_VMR10")

#Plot 5: Interactive Yearly C tails (remaining C in Soil) #
MY <- 12
ModelDFSL_VMR10P_YCT <- ModelDFSL_VMR10P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VMR10)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMR10P_YCT) <- c("Year", "Months", "CTail_VMR10")

#Save Dataframes for Plots 3.1, 3.2, 4 and 5
write_xlsx(ModelDFSL_VMR10P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VMR10P.xlsx") #Yearly CO2 emissions (no delay)
write_xlsx(ModelDFSL_VMR10P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VMR10P.xlsx") #Yearly CO2 emissions (delay)
write_xlsx(ModelDFSL_VMR10P_YC,"CEmissions_P\\ModelDFSL_R_CE_VMR10P.xlsx") #Yearly C emissions
write_xlsx(ModelDFSL_VMR10P_YCT,"CTails_P\\ModelDFSL_R_CT_VMR10P.xlsx") #Yearly C emissions

#### - ####
#### 12) Model Combinations - Manure; No Tillage, 0-100% (+10%) Clay ####
#### 12.1 - VMN0) Manure; 0%clay; No Tillage ####
#The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
fT_VMN0=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
fW_VMN0=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                        S.Thick = soil.thick, pClay = clay0,
                        pE = 1.0, bare = FALSE)$b #Moisture effects per month
xi.frame_VMN0=data.frame(years,rep(fT_VMN0*fW_VMN0,length.out=length(years)))

#To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
Model_VMN0=SoilR::RothCModel(
  t=years, #Simulation Length
  ks=c(k.DPM = 10*NTRM, k.RPM = 0.3*NTRM, k.BIO = 0.66*NTRM, k.HUM = 0.02*NTRM, k.IOM = 0*NTRM), #Decomposition rates for the different pools
  C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
  In=Scalar_LitterCinputs*0, #Amount of litter inputs by time
  FYM = Scalar_ManureCinputs*1, #Amount of Farm Yard Manure by time
  clay=clay0, #Percent clay in mineral soil
  xi=xi.frame_VMN0) #Loads the model

Ct_VMN0=getC(Model_VMN0) #Calculates stocks for each pool per month

VEC_Lit_VMN0 <- rep(M_Scalar_LitterCinputs*0, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
VEC_Man_VMN0 <- rep(M_Scalar_ManureCinputs*1, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

VEC_LitDF_VMN0 <- as.data.frame(VEC_Lit_VMN0) #Converting the Litter vector to a data frame
VEC_LitDF_VMN0$MNumber <- seq(from = 1, to = SimulationLength_months)
VEC_ManDF_VMN0 <- as.data.frame(VEC_Man_VMN0) #Converting the Manure vector to a data frame
VEC_ManDF_VMN0$MNumber <- seq(from = 1, to = SimulationLength_months)

sapply(VEC_LitDF_VMN0, class) #Check that class is numeric
sapply(VEC_ManDF_VMN0, class) #Check that class is numeric
LitterCinputs_VMN0=VEC_LitDF_VMN0   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
ManureCinputs_VMN0=VEC_ManDF_VMN0 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
MCinputs_VMN0 <- merge(LitterCinputs_VMN0, ManureCinputs_VMN0, by = "MNumber")
MCinputs_VMN0$MInput_VMN0 <- MCinputs_VMN0$VEC_Lit_VMN0 + MCinputs_VMN0$VEC_Man_VMN0

#Change names of litter and manure columns for more common ones
colnames(MCinputs_VMN0)[which(names(MCinputs_VMN0) == "VEC_Lit_VMN0")] <- "LitterC_VMN0"
colnames(MCinputs_VMN0)[which(names(MCinputs_VMN0) == "VEC_Man_VMN0")] <- "ManureC_VMN0"

#Create a dataframe with the data considering the simulation length
ModelDF_VMN0 <- as.data.frame(Ct_VMN0)
colnames(ModelDF_VMN0) <- c('DPM_VMN0','RPM_VMN0','BIO_VMN0', 'HUM_VMN0', 'IOM_VMN0')
ModelDFS_VMN0 <- ModelDF_VMN0[1:SimulationLength_months, ]

#Create a column with the number of month of analysis
ModelDFS_VMN0$MNumber <- seq(from = 1, to = SimulationLength_months)

#Create a column that sums all pools
ModelDFS_VMN0$AllPools_VMN0 <- ModelDFS_VMN0$DPM_VMN0 + ModelDFS_VMN0$RPM_VMN0 + ModelDFS_VMN0$BIO_VMN0 + ModelDFS_VMN0$HUM_VMN0 + ModelDFS_VMN0$IOM_VMN0

#Create a column that sums all pools except IOM (static)
ModelDFS_VMN0$AllPools_noIOM_VMN0 <- ModelDFS_VMN0$DPM_VMN0 + ModelDFS_VMN0$RPM_VMN0 + ModelDFS_VMN0$BIO_VMN0 + ModelDFS_VMN0$HUM_VMN0

#Create a column that add the monthly input of C (manure and litter separately)
ModelDFSL_VMN0 <- merge(ModelDFS_VMN0, MCinputs_VMN0, by = "MNumber")

ModelDFSL_VMN0$MInput_VMN0 <- ModelDFSL_VMN0$LitterC_VMN0 + ModelDFSL_VMN0$ManureC_VMN0
#ModelDF_SL$MInput[1] <- 0

#Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
ModelDFSL_VMN0$CTails_VMN0 <- ModelDFSL_VMN0$AllPools_noIOM_VMN0 + ModelDFSL_VMN0$MInput_VMN0

#Create Monthly Accumulated input of C
ModelDFSL_VMN0$AccumInput_VMN0 = ModelDFSL_VMN0$AccumInput_VMN0=cumsum(ModelDFSL_VMN0$MInput_VMN0)

#Create Monthly Growths for each carbon pool
ModelDFSL_VMN0$MGrowth_DPM_VMN0 <- ave(ModelDFSL_VMN0$DPM_VMN0, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMN0$MGrowth_RPM_VMN0 <- ave(ModelDFSL_VMN0$RPM_VMN0, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMN0$MGrowth_BIO_VMN0 <- ave(ModelDFSL_VMN0$BIO_VMN0, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMN0$MGrowth_HUM_VMN0 <- ave(ModelDFSL_VMN0$HUM_VMN0, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMN0$MGrowth_IOM_VMN0 <- ave(ModelDFSL_VMN0$IOM_VMN0, FUN = function(x) c(0, diff(x)))

#Create column for Monthly and Accumulated C-CO2 emissions
ModelDFSL_VMN0$M_CCO2_VMN0 <- ModelDFSL_VMN0$MInput_VMN0 - ModelDFSL_VMN0$MGrowth_DPM_VMN0 - ModelDFSL_VMN0$MGrowth_RPM_VMN0 - ModelDFSL_VMN0$MGrowth_BIO_VMN0 - ModelDFSL_VMN0$MGrowth_HUM_VMN0
ModelDFSL_VMN0$Accum_CCO2_VMN0 <- ModelDFSL_VMN0$AccumInput_VMN0 - ModelDFSL_VMN0$AllPools_noIOM_VMN0

#Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
ModelDFSL_VMN0$M_CCO2_VMN0[1] <- 0
ModelDFSL_VMN0$Accum_CCO2_VMN0[1] <- 0

#Balance validation
ModelDFSL_VMN0$Balance_VMN0 <- ModelDFSL_VMN0$AccumInput_VMN0 - ModelDFSL_VMN0$Accum_CCO2_VMN0 - (ModelDFSL_VMN0$DPM_VMN0 + ModelDFSL_VMN0$RPM_VMN0 + ModelDFSL_VMN0$BIO_VMN0 + ModelDFSL_VMN0$HUM_VMN0)

#Convert C-CO2 emissions into CO2 emissions
ModelDFSL_VMN0$M_CO2_VMN0 <- ModelDFSL_VMN0$M_CCO2_VMN0 * 44/12
ModelDFSL_VMN0$Accum_CO2_VMN0 <- ModelDFSL_VMN0$Accum_CCO2_VMN0 * 44/12

#This model will be called VMN0C because implies a continuous input of C
ModelDFSL_VMN0C <- ModelDFSL_VMN0

#Export the dataframe
write_xlsx(ModelDFSL_VMN0C,"VXC_Models\\ModelDFSL_R_VMN0C.xlsx")

#Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
#Create two equal models by using the above general script
#Create model t=x
ModelDFSLt0_VMN0 <- ModelDFSL_VMN0 #Create model t=x

#Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
ModelDFSLt1_VMN0.1 <- rbind(c(0:0), ModelDFSLt0_VMN0)
ModelDFSLt1_VMN0.2 <- rbind(c(0:0), ModelDFSLt1_VMN0.1)
ModelDFSLt1_VMN0.3 <- rbind(c(0:0), ModelDFSLt1_VMN0.2)
ModelDFSLt1_VMN0.4 <- rbind(c(0:0), ModelDFSLt1_VMN0.3)
ModelDFSLt1_VMN0.5 <- rbind(c(0:0), ModelDFSLt1_VMN0.4)
ModelDFSLt1_VMN0.6 <- rbind(c(0:0), ModelDFSLt1_VMN0.5)
ModelDFSLt1_VMN0.7 <- rbind(c(0:0), ModelDFSLt1_VMN0.6)
ModelDFSLt1_VMN0.8 <- rbind(c(0:0), ModelDFSLt1_VMN0.7)
ModelDFSLt1_VMN0.9 <- rbind(c(0:0), ModelDFSLt1_VMN0.8)
ModelDFSLt1_VMN0.10 <- rbind(c(0:0), ModelDFSLt1_VMN0.9)
ModelDFSLt1_VMN0.11 <- rbind(c(0:0), ModelDFSLt1_VMN0.10)
ModelDFSLt1_VMN0.12 <- rbind(c(0:0), ModelDFSLt1_VMN0.11)
ModelDFSLt1_VMN0.13 <- ModelDFSLt1_VMN0.12[-nrow(ModelDFSLt1_VMN0.12),]
ModelDFSLt1_VMN0.14 <- ModelDFSLt1_VMN0.13[-nrow(ModelDFSLt1_VMN0.13),]
ModelDFSLt1_VMN0.15 <- ModelDFSLt1_VMN0.14[-nrow(ModelDFSLt1_VMN0.14),]
ModelDFSLt1_VMN0.16 <- ModelDFSLt1_VMN0.15[-nrow(ModelDFSLt1_VMN0.15),]
ModelDFSLt1_VMN0.17 <- ModelDFSLt1_VMN0.16[-nrow(ModelDFSLt1_VMN0.16),]
ModelDFSLt1_VMN0.18 <- ModelDFSLt1_VMN0.17[-nrow(ModelDFSLt1_VMN0.17),]
ModelDFSLt1_VMN0.19 <- ModelDFSLt1_VMN0.18[-nrow(ModelDFSLt1_VMN0.18),]
ModelDFSLt1_VMN0.20 <- ModelDFSLt1_VMN0.19[-nrow(ModelDFSLt1_VMN0.19),]
ModelDFSLt1_VMN0.21 <- ModelDFSLt1_VMN0.20[-nrow(ModelDFSLt1_VMN0.20),]
ModelDFSLt1_VMN0.22 <- ModelDFSLt1_VMN0.21[-nrow(ModelDFSLt1_VMN0.21),]
ModelDFSLt1_VMN0.23 <- ModelDFSLt1_VMN0.22[-nrow(ModelDFSLt1_VMN0.22),]
ModelDFSLt1_VMN0.24 <- ModelDFSLt1_VMN0.23[-nrow(ModelDFSLt1_VMN0.23),]

ModelDFSLt1_VMN0 <- ModelDFSLt1_VMN0.24 #Create model t=x+1

#Subtract model (t=x) - (t=x+1)
ModelDFSL1y_VMN0 <- ModelDFSLt0_VMN0 - ModelDFSLt1_VMN0

#Re-do Month Number column because the substraction was also applied to it
ModelDFSL1y_VMN0$MNumber <- seq(from = 1, to = SimulationLength_months)

#This model will be called VMN0P because implies a one-off input of C
ModelDFSL_VMN0P <- ModelDFSL1y_VMN0

#Export the dataframe
write_xlsx(ModelDFSL_VMN0P,"VXP_Models\\ModelDFSL_R_VMN0P.xlsx")

#Plot 3.1: Interactive Yearly CO2 emissions #
MY <- 12
ModelDFSL_VMN0P_YCO2 <- ModelDFSL_VMN0P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VMN0)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMN0P_YCO2) <- c("Year", "Months", "AnnualCO2_VMN_0")

#Plot 3.2: Interactive Yearly CO2 emissions considering a delay
GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
ModelDFSL_VMN0P_YCO2D <- merge(ModelDFSL_VMN0P_YCO2, GWP100delay, by = "Year")
ModelDFSL_VMN0P_YCO2D$AnnualCO2D_VMN_0 <- ModelDFSL_VMN0P_YCO2D$AnnualCO2_VMN_0 * ModelDFSL_VMN0P_YCO2D$GWP100

#Plot 4: Interactive Yearly C emissions #
MY <- 12
ModelDFSL_VMN0P_YC <- ModelDFSL_VMN0P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VMN0)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMN0P_YC) <- c("Year", "Months", "CEmissions_VMN_0")

#Plot 5: Interactive Yearly C tails (remaining C in Soil) #
MY <- 12
ModelDFSL_VMN0P_YCT <- ModelDFSL_VMN0P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VMN0)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMN0P_YCT) <- c("Year", "Months", "CTail_VMN_0")

#Save Dataframes for Plots 3.1, 3.2, 4 and 5
write_xlsx(ModelDFSL_VMN0P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VMN0P.xlsx") #Yearly CO2 emissions (no delay)
write_xlsx(ModelDFSL_VMN0P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VMN0P.xlsx") #Yearly CO2 emissions (delay)
write_xlsx(ModelDFSL_VMN0P_YC,"CEmissions_P\\ModelDFSL_R_CE_VMN0P.xlsx") #Yearly C emissions
write_xlsx(ModelDFSL_VMN0P_YCT,"CTails_P\\ModelDFSL_R_CT_VMN0P.xlsx") #Yearly C emissions


#### 12.2 - VMN1) Manure; 10%clay; No Tillage ####
#The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
fT_VMN1=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
fW_VMN1=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                        S.Thick = soil.thick, pClay = clay100*0.1,
                        pE = 1.0, bare = FALSE)$b #Moisture effects per month
xi.frame_VMN1=data.frame(years,rep(fT_VMN1*fW_VMN1,length.out=length(years)))

#To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
Model_VMN1=SoilR::RothCModel(
  t=years, #Simulation Length
  ks=c(k.DPM = 10*NTRM, k.RPM = 0.3*NTRM, k.BIO = 0.66*NTRM, k.HUM = 0.02*NTRM, k.IOM = 0*NTRM), #Decomposition rates for the different pools
  C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
  In=Scalar_LitterCinputs*0, #Amount of litter inputs by time
  FYM = Scalar_ManureCinputs*1, #Amount of Farm Yard Manure by time
  clay=clay100*0.1, #Percent clay in mineral soil
  xi=xi.frame_VMN1) #Loads the model

Ct_VMN1=getC(Model_VMN1) #Calculates stocks for each pool per month

#The results can be plotted with the commands
matplot(years, Ct_VMN1, type="l", lty=1, col=1:5,
        xlab="Time (years)", ylab="C stocks (Mg/ha)")
legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
       lty=1, col=1:5, bty="n")

VEC_Lit_VMN1 <- rep(M_Scalar_LitterCinputs*0, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
VEC_Man_VMN1 <- rep(M_Scalar_ManureCinputs*1, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

VEC_LitDF_VMN1 <- as.data.frame(VEC_Lit_VMN1) #Converting the Litter vector to a data frame
VEC_LitDF_VMN1$MNumber <- seq(from = 1, to = SimulationLength_months)
VEC_ManDF_VMN1 <- as.data.frame(VEC_Man_VMN1) #Converting the Manure vector to a data frame
VEC_ManDF_VMN1$MNumber <- seq(from = 1, to = SimulationLength_months)

sapply(VEC_LitDF_VMN1, class) #Check that class is numeric
sapply(VEC_ManDF_VMN1, class) #Check that class is numeric
LitterCinputs_VMN1=VEC_LitDF_VMN1   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
ManureCinputs_VMN1=VEC_ManDF_VMN1 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
MCinputs_VMN1 <- merge(LitterCinputs_VMN1, ManureCinputs_VMN1, by = "MNumber")
MCinputs_VMN1$MInput_VMN1 <- MCinputs_VMN1$VEC_Lit_VMN1 + MCinputs_VMN1$VEC_Man_VMN1

#Change names of litter and manure columns for more common ones
colnames(MCinputs_VMN1)[which(names(MCinputs_VMN1) == "VEC_Lit_VMN1")] <- "LitterC_VMN1"
colnames(MCinputs_VMN1)[which(names(MCinputs_VMN1) == "VEC_Man_VMN1")] <- "ManureC_VMN1"

#Create a dataframe with the data considering the simulation length
ModelDF_VMN1 <- as.data.frame(Ct_VMN1)
colnames(ModelDF_VMN1) <- c('DPM_VMN1','RPM_VMN1','BIO_VMN1', 'HUM_VMN1', 'IOM_VMN1')
ModelDFS_VMN1 <- ModelDF_VMN1[1:SimulationLength_months, ]

#Create a column with the number of month of analysis
ModelDFS_VMN1$MNumber <- seq(from = 1, to = SimulationLength_months)

#Create a column that sums all pools
ModelDFS_VMN1$AllPools_VMN1 <- ModelDFS_VMN1$DPM_VMN1 + ModelDFS_VMN1$RPM_VMN1 + ModelDFS_VMN1$BIO_VMN1 + ModelDFS_VMN1$HUM_VMN1 + ModelDFS_VMN1$IOM_VMN1

#Create a column that sums all pools except IOM (static)
ModelDFS_VMN1$AllPools_noIOM_VMN1 <- ModelDFS_VMN1$DPM_VMN1 + ModelDFS_VMN1$RPM_VMN1 + ModelDFS_VMN1$BIO_VMN1 + ModelDFS_VMN1$HUM_VMN1

#Create a column that add the monthly input of C (manure and litter separately)
ModelDFSL_VMN1 <- merge(ModelDFS_VMN1, MCinputs_VMN1, by = "MNumber")

ModelDFSL_VMN1$MInput_VMN1 <- ModelDFSL_VMN1$LitterC_VMN1 + ModelDFSL_VMN1$ManureC_VMN1
#ModelDF_SL$MInput[1] <- 0

#Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
ModelDFSL_VMN1$CTails_VMN1 <- ModelDFSL_VMN1$AllPools_noIOM_VMN1 + ModelDFSL_VMN1$MInput_VMN1

#Create Monthly Accumulated input of C
ModelDFSL_VMN1$AccumInput_VMN1 = ModelDFSL_VMN1$AccumInput_VMN1=cumsum(ModelDFSL_VMN1$MInput_VMN1)

#Create Monthly Growths for each carbon pool
ModelDFSL_VMN1$MGrowth_DPM_VMN1 <- ave(ModelDFSL_VMN1$DPM_VMN1, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMN1$MGrowth_RPM_VMN1 <- ave(ModelDFSL_VMN1$RPM_VMN1, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMN1$MGrowth_BIO_VMN1 <- ave(ModelDFSL_VMN1$BIO_VMN1, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMN1$MGrowth_HUM_VMN1 <- ave(ModelDFSL_VMN1$HUM_VMN1, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMN1$MGrowth_IOM_VMN1 <- ave(ModelDFSL_VMN1$IOM_VMN1, FUN = function(x) c(0, diff(x)))

#Create column for Monthly and Accumulated C-CO2 emissions
ModelDFSL_VMN1$M_CCO2_VMN1 <- ModelDFSL_VMN1$MInput_VMN1 - ModelDFSL_VMN1$MGrowth_DPM_VMN1 - ModelDFSL_VMN1$MGrowth_RPM_VMN1 - ModelDFSL_VMN1$MGrowth_BIO_VMN1 - ModelDFSL_VMN1$MGrowth_HUM_VMN1
ModelDFSL_VMN1$Accum_CCO2_VMN1 <- ModelDFSL_VMN1$AccumInput_VMN1 - ModelDFSL_VMN1$AllPools_noIOM_VMN1

#Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
ModelDFSL_VMN1$M_CCO2_VMN1[1] <- 0
ModelDFSL_VMN1$Accum_CCO2_VMN1[1] <- 0

#Balance validation
ModelDFSL_VMN1$Balance_VMN1 <- ModelDFSL_VMN1$AccumInput_VMN1 - ModelDFSL_VMN1$Accum_CCO2_VMN1 - (ModelDFSL_VMN1$DPM_VMN1 + ModelDFSL_VMN1$RPM_VMN1 + ModelDFSL_VMN1$BIO_VMN1 + ModelDFSL_VMN1$HUM_VMN1)

#Convert C-CO2 emissions into CO2 emissions
ModelDFSL_VMN1$M_CO2_VMN1 <- ModelDFSL_VMN1$M_CCO2_VMN1 * 44/12
ModelDFSL_VMN1$Accum_CO2_VMN1 <- ModelDFSL_VMN1$Accum_CCO2_VMN1 * 44/12

#This model will be called VMN1C because implies a continuous input of C
ModelDFSL_VMN1C <- ModelDFSL_VMN1

#Export the dataframe
write_xlsx(ModelDFSL_VMN1C,"VXC_Models\\ModelDFSL_R_VMN1C.xlsx")

#Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
#Create two equal models by using the above general script
#Create model t=x
ModelDFSLt0_VMN1 <- ModelDFSL_VMN1 #Create model t=x

#Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
ModelDFSLt1_VMN1.1 <- rbind(c(0:0), ModelDFSLt0_VMN1)
ModelDFSLt1_VMN1.2 <- rbind(c(0:0), ModelDFSLt1_VMN1.1)
ModelDFSLt1_VMN1.3 <- rbind(c(0:0), ModelDFSLt1_VMN1.2)
ModelDFSLt1_VMN1.4 <- rbind(c(0:0), ModelDFSLt1_VMN1.3)
ModelDFSLt1_VMN1.5 <- rbind(c(0:0), ModelDFSLt1_VMN1.4)
ModelDFSLt1_VMN1.6 <- rbind(c(0:0), ModelDFSLt1_VMN1.5)
ModelDFSLt1_VMN1.7 <- rbind(c(0:0), ModelDFSLt1_VMN1.6)
ModelDFSLt1_VMN1.8 <- rbind(c(0:0), ModelDFSLt1_VMN1.7)
ModelDFSLt1_VMN1.9 <- rbind(c(0:0), ModelDFSLt1_VMN1.8)
ModelDFSLt1_VMN1.10 <- rbind(c(0:0), ModelDFSLt1_VMN1.9)
ModelDFSLt1_VMN1.11 <- rbind(c(0:0), ModelDFSLt1_VMN1.10)
ModelDFSLt1_VMN1.12 <- rbind(c(0:0), ModelDFSLt1_VMN1.11)
ModelDFSLt1_VMN1.13 <- ModelDFSLt1_VMN1.12[-nrow(ModelDFSLt1_VMN1.12),]
ModelDFSLt1_VMN1.14 <- ModelDFSLt1_VMN1.13[-nrow(ModelDFSLt1_VMN1.13),]
ModelDFSLt1_VMN1.15 <- ModelDFSLt1_VMN1.14[-nrow(ModelDFSLt1_VMN1.14),]
ModelDFSLt1_VMN1.16 <- ModelDFSLt1_VMN1.15[-nrow(ModelDFSLt1_VMN1.15),]
ModelDFSLt1_VMN1.17 <- ModelDFSLt1_VMN1.16[-nrow(ModelDFSLt1_VMN1.16),]
ModelDFSLt1_VMN1.18 <- ModelDFSLt1_VMN1.17[-nrow(ModelDFSLt1_VMN1.17),]
ModelDFSLt1_VMN1.19 <- ModelDFSLt1_VMN1.18[-nrow(ModelDFSLt1_VMN1.18),]
ModelDFSLt1_VMN1.20 <- ModelDFSLt1_VMN1.19[-nrow(ModelDFSLt1_VMN1.19),]
ModelDFSLt1_VMN1.21 <- ModelDFSLt1_VMN1.20[-nrow(ModelDFSLt1_VMN1.20),]
ModelDFSLt1_VMN1.22 <- ModelDFSLt1_VMN1.21[-nrow(ModelDFSLt1_VMN1.21),]
ModelDFSLt1_VMN1.23 <- ModelDFSLt1_VMN1.22[-nrow(ModelDFSLt1_VMN1.22),]
ModelDFSLt1_VMN1.24 <- ModelDFSLt1_VMN1.23[-nrow(ModelDFSLt1_VMN1.23),]

ModelDFSLt1_VMN1 <- ModelDFSLt1_VMN1.24 #Create model t=x+1

#Subtract model (t=x) - (t=x+1)
ModelDFSL1y_VMN1 <- ModelDFSLt0_VMN1 - ModelDFSLt1_VMN1

#Re-do Month Number column because the substraction was also applied to it
ModelDFSL1y_VMN1$MNumber <- seq(from = 1, to = SimulationLength_months)

#This model will be called VMN1P because implies a one-off input of C
ModelDFSL_VMN1P <- ModelDFSL1y_VMN1

#Export the dataframe
write_xlsx(ModelDFSL_VMN1P,"VXP_Models\\ModelDFSL_R_VMN1P.xlsx")

#Plot 3: Interactive Yearly CO2 emissions #
MY <- 12
ModelDFSL_VMN1P_YCO2 <- ModelDFSL_VMN1P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VMN1)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMN1P_YCO2) <- c("Year", "Months", "AnnualCO2_VMN_1")

#Plot 3: Interactive Yearly CO2 emissions considering a delay
GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
ModelDFSL_VMN1P_YCO2D <- merge(ModelDFSL_VMN1P_YCO2, GWP100delay, by = "Year")
ModelDFSL_VMN1P_YCO2D$AnnualCO2D_VMN_1 <- ModelDFSL_VMN1P_YCO2D$AnnualCO2_VMN_1 * ModelDFSL_VMN1P_YCO2D$GWP100

#Plot 4: Interactive Yearly C emissions #
MY <- 12
ModelDFSL_VMN1P_YC <- ModelDFSL_VMN1P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VMN1)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMN1P_YC) <- c("Year", "Months", "CEmissions_VMN_1")

#Plot 5: Interactive Yearly C tails (remaining C in Soil) #
MY <- 12
ModelDFSL_VMN1P_YCT <- ModelDFSL_VMN1P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VMN1)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMN1P_YCT) <- c("Year", "Months", "CTail_VMN_1")

#Save Dataframes for Plots 3.1, 3.2, 4 and 5
write_xlsx(ModelDFSL_VMN1P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VMN1P.xlsx") #Yearly CO2 emissions (no delay)
write_xlsx(ModelDFSL_VMN1P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VMN1P.xlsx") #Yearly CO2 emissions (delay)
write_xlsx(ModelDFSL_VMN1P_YC,"CEmissions_P\\ModelDFSL_R_CE_VMN1P.xlsx") #Yearly C emissions
write_xlsx(ModelDFSL_VMN1P_YCT,"CTails_P\\ModelDFSL_R_CT_VMN1P.xlsx") #Yearly C emissions



#### 12.3 - VMN2) Manure; 20%clay; No Tillage ####
#The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
fT_VMN2=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
fW_VMN2=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                        S.Thick = soil.thick, pClay = clay100*0.2,
                        pE = 1.0, bare = FALSE)$b #Moisture effects per month
xi.frame_VMN2=data.frame(years,rep(fT_VMN2*fW_VMN2,length.out=length(years)))

#To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
Model_VMN2=SoilR::RothCModel(
  t=years, #Simulation Length
  ks=c(k.DPM = 10*NTRM, k.RPM = 0.3*NTRM, k.BIO = 0.66*NTRM, k.HUM = 0.02*NTRM, k.IOM = 0*NTRM), #Decomposition rates for the different pools
  C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
  In=Scalar_LitterCinputs*0, #Amount of litter inputs by time
  FYM = Scalar_ManureCinputs*1, #Amount of Farm Yard Manure by time
  clay=clay100*0.2, #Percent clay in mineral soil
  xi=xi.frame_VMN2) #Loads the model

Ct_VMN2=getC(Model_VMN2) #Calculates stocks for each pool per month

#The results can be plotted with the commands
matplot(years, Ct_VMN2, type="l", lty=1, col=1:5,
        xlab="Time (years)", ylab="C stocks (Mg/ha)")
legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
       lty=1, col=1:5, bty="n")

VEC_Lit_VMN2 <- rep(M_Scalar_LitterCinputs*0, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
VEC_Man_VMN2 <- rep(M_Scalar_ManureCinputs*1, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

VEC_LitDF_VMN2 <- as.data.frame(VEC_Lit_VMN2) #Converting the Litter vector to a data frame
VEC_LitDF_VMN2$MNumber <- seq(from = 1, to = SimulationLength_months)
VEC_ManDF_VMN2 <- as.data.frame(VEC_Man_VMN2) #Converting the Manure vector to a data frame
VEC_ManDF_VMN2$MNumber <- seq(from = 1, to = SimulationLength_months)

sapply(VEC_LitDF_VMN2, class) #Check that class is numeric
sapply(VEC_ManDF_VMN2, class) #Check that class is numeric
LitterCinputs_VMN2=VEC_LitDF_VMN2   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
ManureCinputs_VMN2=VEC_ManDF_VMN2 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
MCinputs_VMN2 <- merge(LitterCinputs_VMN2, ManureCinputs_VMN2, by = "MNumber")
MCinputs_VMN2$MInput_VMN2 <- MCinputs_VMN2$VEC_Lit_VMN2 + MCinputs_VMN2$VEC_Man_VMN2

#Change names of litter and manure columns for more common ones
colnames(MCinputs_VMN2)[which(names(MCinputs_VMN2) == "VEC_Lit_VMN2")] <- "LitterC_VMN2"
colnames(MCinputs_VMN2)[which(names(MCinputs_VMN2) == "VEC_Man_VMN2")] <- "ManureC_VMN2"

#Create a dataframe with the data considering the simulation length
ModelDF_VMN2 <- as.data.frame(Ct_VMN2)
colnames(ModelDF_VMN2) <- c('DPM_VMN2','RPM_VMN2','BIO_VMN2', 'HUM_VMN2', 'IOM_VMN2')
ModelDFS_VMN2 <- ModelDF_VMN2[1:SimulationLength_months, ]

#Create a column with the number of month of analysis
ModelDFS_VMN2$MNumber <- seq(from = 1, to = SimulationLength_months)

#Create a column that sums all pools
ModelDFS_VMN2$AllPools_VMN2 <- ModelDFS_VMN2$DPM_VMN2 + ModelDFS_VMN2$RPM_VMN2 + ModelDFS_VMN2$BIO_VMN2 + ModelDFS_VMN2$HUM_VMN2 + ModelDFS_VMN2$IOM_VMN2

#Create a column that sums all pools except IOM (static)
ModelDFS_VMN2$AllPools_noIOM_VMN2 <- ModelDFS_VMN2$DPM_VMN2 + ModelDFS_VMN2$RPM_VMN2 + ModelDFS_VMN2$BIO_VMN2 + ModelDFS_VMN2$HUM_VMN2

#Create a column that add the monthly input of C (manure and litter separately)
ModelDFSL_VMN2 <- merge(ModelDFS_VMN2, MCinputs_VMN2, by = "MNumber")

ModelDFSL_VMN2$MInput_VMN2 <- ModelDFSL_VMN2$LitterC_VMN2 + ModelDFSL_VMN2$ManureC_VMN2
#ModelDF_SL$MInput[1] <- 0

#Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
ModelDFSL_VMN2$CTails_VMN2 <- ModelDFSL_VMN2$AllPools_noIOM_VMN2 + ModelDFSL_VMN2$MInput_VMN2

#Create Monthly Accumulated input of C
ModelDFSL_VMN2$AccumInput_VMN2 = ModelDFSL_VMN2$AccumInput_VMN2=cumsum(ModelDFSL_VMN2$MInput_VMN2)

#Create Monthly Growths for each carbon pool
ModelDFSL_VMN2$MGrowth_DPM_VMN2 <- ave(ModelDFSL_VMN2$DPM_VMN2, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMN2$MGrowth_RPM_VMN2 <- ave(ModelDFSL_VMN2$RPM_VMN2, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMN2$MGrowth_BIO_VMN2 <- ave(ModelDFSL_VMN2$BIO_VMN2, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMN2$MGrowth_HUM_VMN2 <- ave(ModelDFSL_VMN2$HUM_VMN2, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMN2$MGrowth_IOM_VMN2 <- ave(ModelDFSL_VMN2$IOM_VMN2, FUN = function(x) c(0, diff(x)))

#Create column for Monthly and Accumulated C-CO2 emissions
ModelDFSL_VMN2$M_CCO2_VMN2 <- ModelDFSL_VMN2$MInput_VMN2 - ModelDFSL_VMN2$MGrowth_DPM_VMN2 - ModelDFSL_VMN2$MGrowth_RPM_VMN2 - ModelDFSL_VMN2$MGrowth_BIO_VMN2 - ModelDFSL_VMN2$MGrowth_HUM_VMN2
ModelDFSL_VMN2$Accum_CCO2_VMN2 <- ModelDFSL_VMN2$AccumInput_VMN2 - ModelDFSL_VMN2$AllPools_noIOM_VMN2

#Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
ModelDFSL_VMN2$M_CCO2_VMN2[1] <- 0
ModelDFSL_VMN2$Accum_CCO2_VMN2[1] <- 0

#Balance validation
ModelDFSL_VMN2$Balance_VMN2 <- ModelDFSL_VMN2$AccumInput_VMN2 - ModelDFSL_VMN2$Accum_CCO2_VMN2 - (ModelDFSL_VMN2$DPM_VMN2 + ModelDFSL_VMN2$RPM_VMN2 + ModelDFSL_VMN2$BIO_VMN2 + ModelDFSL_VMN2$HUM_VMN2)

#Convert C-CO2 emissions into CO2 emissions
ModelDFSL_VMN2$M_CO2_VMN2 <- ModelDFSL_VMN2$M_CCO2_VMN2 * 44/12
ModelDFSL_VMN2$Accum_CO2_VMN2 <- ModelDFSL_VMN2$Accum_CCO2_VMN2 * 44/12

#This model will be called VMN2C because implies a continuous input of C
ModelDFSL_VMN2C <- ModelDFSL_VMN2

#Export the dataframe
write_xlsx(ModelDFSL_VMN2C,"VXC_Models\\ModelDFSL_R_VMN2C.xlsx")

#Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
#Create two equal models by using the above general script
#Create model t=x
ModelDFSLt0_VMN2 <- ModelDFSL_VMN2 #Create model t=x

#Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
ModelDFSLt1_VMN2.1 <- rbind(c(0:0), ModelDFSLt0_VMN2)
ModelDFSLt1_VMN2.2 <- rbind(c(0:0), ModelDFSLt1_VMN2.1)
ModelDFSLt1_VMN2.3 <- rbind(c(0:0), ModelDFSLt1_VMN2.2)
ModelDFSLt1_VMN2.4 <- rbind(c(0:0), ModelDFSLt1_VMN2.3)
ModelDFSLt1_VMN2.5 <- rbind(c(0:0), ModelDFSLt1_VMN2.4)
ModelDFSLt1_VMN2.6 <- rbind(c(0:0), ModelDFSLt1_VMN2.5)
ModelDFSLt1_VMN2.7 <- rbind(c(0:0), ModelDFSLt1_VMN2.6)
ModelDFSLt1_VMN2.8 <- rbind(c(0:0), ModelDFSLt1_VMN2.7)
ModelDFSLt1_VMN2.9 <- rbind(c(0:0), ModelDFSLt1_VMN2.8)
ModelDFSLt1_VMN2.10 <- rbind(c(0:0), ModelDFSLt1_VMN2.9)
ModelDFSLt1_VMN2.11 <- rbind(c(0:0), ModelDFSLt1_VMN2.10)
ModelDFSLt1_VMN2.12 <- rbind(c(0:0), ModelDFSLt1_VMN2.11)
ModelDFSLt1_VMN2.13 <- ModelDFSLt1_VMN2.12[-nrow(ModelDFSLt1_VMN2.12),]
ModelDFSLt1_VMN2.14 <- ModelDFSLt1_VMN2.13[-nrow(ModelDFSLt1_VMN2.13),]
ModelDFSLt1_VMN2.15 <- ModelDFSLt1_VMN2.14[-nrow(ModelDFSLt1_VMN2.14),]
ModelDFSLt1_VMN2.16 <- ModelDFSLt1_VMN2.15[-nrow(ModelDFSLt1_VMN2.15),]
ModelDFSLt1_VMN2.17 <- ModelDFSLt1_VMN2.16[-nrow(ModelDFSLt1_VMN2.16),]
ModelDFSLt1_VMN2.18 <- ModelDFSLt1_VMN2.17[-nrow(ModelDFSLt1_VMN2.17),]
ModelDFSLt1_VMN2.19 <- ModelDFSLt1_VMN2.18[-nrow(ModelDFSLt1_VMN2.18),]
ModelDFSLt1_VMN2.20 <- ModelDFSLt1_VMN2.19[-nrow(ModelDFSLt1_VMN2.19),]
ModelDFSLt1_VMN2.21 <- ModelDFSLt1_VMN2.20[-nrow(ModelDFSLt1_VMN2.20),]
ModelDFSLt1_VMN2.22 <- ModelDFSLt1_VMN2.21[-nrow(ModelDFSLt1_VMN2.21),]
ModelDFSLt1_VMN2.23 <- ModelDFSLt1_VMN2.22[-nrow(ModelDFSLt1_VMN2.22),]
ModelDFSLt1_VMN2.24 <- ModelDFSLt1_VMN2.23[-nrow(ModelDFSLt1_VMN2.23),]

ModelDFSLt1_VMN2 <- ModelDFSLt1_VMN2.24 #Create model t=x+1

#Subtract model (t=x) - (t=x+1)
ModelDFSL1y_VMN2 <- ModelDFSLt0_VMN2 - ModelDFSLt1_VMN2

#Re-do Month Number column because the substraction was also applied to it
ModelDFSL1y_VMN2$MNumber <- seq(from = 1, to = SimulationLength_months)

#This model will be called VMN2P because implies a one-off input of C
ModelDFSL_VMN2P <- ModelDFSL1y_VMN2

#Export the dataframe
write_xlsx(ModelDFSL_VMN2P,"VXP_Models\\ModelDFSL_R_VMN2P.xlsx")

#Plot 3: Interactive Yearly CO2 emissions #
MY <- 12
ModelDFSL_VMN2P_YCO2 <- ModelDFSL_VMN2P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VMN2)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMN2P_YCO2) <- c("Year", "Months", "AnnualCO2_VMN_2")

#Plot 3: Interactive Yearly CO2 emissions considering a delay
GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
ModelDFSL_VMN2P_YCO2D <- merge(ModelDFSL_VMN2P_YCO2, GWP100delay, by = "Year")
ModelDFSL_VMN2P_YCO2D$AnnualCO2D_VMN_2 <- ModelDFSL_VMN2P_YCO2D$AnnualCO2_VMN_2 * ModelDFSL_VMN2P_YCO2D$GWP100

#Plot 4: Interactive Yearly C emissions #
MY <- 12
ModelDFSL_VMN2P_YC <- ModelDFSL_VMN2P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VMN2)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMN2P_YC) <- c("Year", "Months", "CEmissions_VMN_2")

#Plot 5: Interactive Yearly C tails (remaining C in Soil) #
MY <- 12
ModelDFSL_VMN2P_YCT <- ModelDFSL_VMN2P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VMN2)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMN2P_YCT) <- c("Year", "Months", "CTail_VMN_2")

#Save Dataframes for Plots 3.1, 3.2, 4 and 5
write_xlsx(ModelDFSL_VMN2P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VMN2P.xlsx") #Yearly CO2 emissions (no delay)
write_xlsx(ModelDFSL_VMN2P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VMN2P.xlsx") #Yearly CO2 emissions (delay)
write_xlsx(ModelDFSL_VMN2P_YC,"CEmissions_P\\ModelDFSL_R_CE_VMN2P.xlsx") #Yearly C emissions
write_xlsx(ModelDFSL_VMN2P_YCT,"CTails_P\\ModelDFSL_R_CT_VMN2P.xlsx") #Yearly C emissions



#### 12.4 - VMN3) Manure; 30%clay; No Tillage ####
#The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
fT_VMN3=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
fW_VMN3=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                        S.Thick = soil.thick, pClay = clay100*0.3,
                        pE = 1.0, bare = FALSE)$b #Moisture effects per month
xi.frame_VMN3=data.frame(years,rep(fT_VMN3*fW_VMN3,length.out=length(years)))

#To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
Model_VMN3=SoilR::RothCModel(
  t=years, #Simulation Length
  ks=c(k.DPM = 10*NTRM, k.RPM = 0.3*NTRM, k.BIO = 0.66*NTRM, k.HUM = 0.02*NTRM, k.IOM = 0*NTRM), #Decomposition rates for the different pools
  C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
  In=Scalar_LitterCinputs*0, #Amount of litter inputs by time
  FYM = Scalar_ManureCinputs*1, #Amount of Farm Yard Manure by time
  clay=clay100*0.3, #Percent clay in mineral soil
  xi=xi.frame_VMN3) #Loads the model

Ct_VMN3=getC(Model_VMN3) #Calculates stocks for each pool per month

#The results can be plotted with the commands
matplot(years, Ct_VMN3, type="l", lty=1, col=1:5,
        xlab="Time (years)", ylab="C stocks (Mg/ha)")
legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
       lty=1, col=1:5, bty="n")

VEC_Lit_VMN3 <- rep(M_Scalar_LitterCinputs*0, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
VEC_Man_VMN3 <- rep(M_Scalar_ManureCinputs*1, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

VEC_LitDF_VMN3 <- as.data.frame(VEC_Lit_VMN3) #Converting the Litter vector to a data frame
VEC_LitDF_VMN3$MNumber <- seq(from = 1, to = SimulationLength_months)
VEC_ManDF_VMN3 <- as.data.frame(VEC_Man_VMN3) #Converting the Manure vector to a data frame
VEC_ManDF_VMN3$MNumber <- seq(from = 1, to = SimulationLength_months)

sapply(VEC_LitDF_VMN3, class) #Check that class is numeric
sapply(VEC_ManDF_VMN3, class) #Check that class is numeric
LitterCinputs_VMN3=VEC_LitDF_VMN3   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
ManureCinputs_VMN3=VEC_ManDF_VMN3 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
MCinputs_VMN3 <- merge(LitterCinputs_VMN3, ManureCinputs_VMN3, by = "MNumber")
MCinputs_VMN3$MInput_VMN3 <- MCinputs_VMN3$VEC_Lit_VMN3 + MCinputs_VMN3$VEC_Man_VMN3

#Change names of litter and manure columns for more common ones
colnames(MCinputs_VMN3)[which(names(MCinputs_VMN3) == "VEC_Lit_VMN3")] <- "LitterC_VMN3"
colnames(MCinputs_VMN3)[which(names(MCinputs_VMN3) == "VEC_Man_VMN3")] <- "ManureC_VMN3"

#Create a dataframe with the data considering the simulation length
ModelDF_VMN3 <- as.data.frame(Ct_VMN3)
colnames(ModelDF_VMN3) <- c('DPM_VMN3','RPM_VMN3','BIO_VMN3', 'HUM_VMN3', 'IOM_VMN3')
ModelDFS_VMN3 <- ModelDF_VMN3[1:SimulationLength_months, ]

#Create a column with the number of month of analysis
ModelDFS_VMN3$MNumber <- seq(from = 1, to = SimulationLength_months)

#Create a column that sums all pools
ModelDFS_VMN3$AllPools_VMN3 <- ModelDFS_VMN3$DPM_VMN3 + ModelDFS_VMN3$RPM_VMN3 + ModelDFS_VMN3$BIO_VMN3 + ModelDFS_VMN3$HUM_VMN3 + ModelDFS_VMN3$IOM_VMN3

#Create a column that sums all pools except IOM (static)
ModelDFS_VMN3$AllPools_noIOM_VMN3 <- ModelDFS_VMN3$DPM_VMN3 + ModelDFS_VMN3$RPM_VMN3 + ModelDFS_VMN3$BIO_VMN3 + ModelDFS_VMN3$HUM_VMN3

#Create a column that add the monthly input of C (manure and litter separately)
ModelDFSL_VMN3 <- merge(ModelDFS_VMN3, MCinputs_VMN3, by = "MNumber")

ModelDFSL_VMN3$MInput_VMN3 <- ModelDFSL_VMN3$LitterC_VMN3 + ModelDFSL_VMN3$ManureC_VMN3
#ModelDF_SL$MInput[1] <- 0

#Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
ModelDFSL_VMN3$CTails_VMN3 <- ModelDFSL_VMN3$AllPools_noIOM_VMN3 + ModelDFSL_VMN3$MInput_VMN3

#Create Monthly Accumulated input of C
ModelDFSL_VMN3$AccumInput_VMN3 = ModelDFSL_VMN3$AccumInput_VMN3=cumsum(ModelDFSL_VMN3$MInput_VMN3)

#Create Monthly Growths for each carbon pool
ModelDFSL_VMN3$MGrowth_DPM_VMN3 <- ave(ModelDFSL_VMN3$DPM_VMN3, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMN3$MGrowth_RPM_VMN3 <- ave(ModelDFSL_VMN3$RPM_VMN3, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMN3$MGrowth_BIO_VMN3 <- ave(ModelDFSL_VMN3$BIO_VMN3, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMN3$MGrowth_HUM_VMN3 <- ave(ModelDFSL_VMN3$HUM_VMN3, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMN3$MGrowth_IOM_VMN3 <- ave(ModelDFSL_VMN3$IOM_VMN3, FUN = function(x) c(0, diff(x)))

#Create column for Monthly and Accumulated C-CO2 emissions
ModelDFSL_VMN3$M_CCO2_VMN3 <- ModelDFSL_VMN3$MInput_VMN3 - ModelDFSL_VMN3$MGrowth_DPM_VMN3 - ModelDFSL_VMN3$MGrowth_RPM_VMN3 - ModelDFSL_VMN3$MGrowth_BIO_VMN3 - ModelDFSL_VMN3$MGrowth_HUM_VMN3
ModelDFSL_VMN3$Accum_CCO2_VMN3 <- ModelDFSL_VMN3$AccumInput_VMN3 - ModelDFSL_VMN3$AllPools_noIOM_VMN3

#Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
ModelDFSL_VMN3$M_CCO2_VMN3[1] <- 0
ModelDFSL_VMN3$Accum_CCO2_VMN3[1] <- 0

#Balance validation
ModelDFSL_VMN3$Balance_VMN3 <- ModelDFSL_VMN3$AccumInput_VMN3 - ModelDFSL_VMN3$Accum_CCO2_VMN3 - (ModelDFSL_VMN3$DPM_VMN3 + ModelDFSL_VMN3$RPM_VMN3 + ModelDFSL_VMN3$BIO_VMN3 + ModelDFSL_VMN3$HUM_VMN3)

#Convert C-CO2 emissions into CO2 emissions
ModelDFSL_VMN3$M_CO2_VMN3 <- ModelDFSL_VMN3$M_CCO2_VMN3 * 44/12
ModelDFSL_VMN3$Accum_CO2_VMN3 <- ModelDFSL_VMN3$Accum_CCO2_VMN3 * 44/12

#This model will be called VMN3C because implies a continuous input of C
ModelDFSL_VMN3C <- ModelDFSL_VMN3

#Export the dataframe
write_xlsx(ModelDFSL_VMN3C,"VXC_Models\\ModelDFSL_R_VMN3C.xlsx")

#Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
#Create two equal models by using the above general script
#Create model t=x
ModelDFSLt0_VMN3 <- ModelDFSL_VMN3 #Create model t=x

#Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
ModelDFSLt1_VMN3.1 <- rbind(c(0:0), ModelDFSLt0_VMN3)
ModelDFSLt1_VMN3.2 <- rbind(c(0:0), ModelDFSLt1_VMN3.1)
ModelDFSLt1_VMN3.3 <- rbind(c(0:0), ModelDFSLt1_VMN3.2)
ModelDFSLt1_VMN3.4 <- rbind(c(0:0), ModelDFSLt1_VMN3.3)
ModelDFSLt1_VMN3.5 <- rbind(c(0:0), ModelDFSLt1_VMN3.4)
ModelDFSLt1_VMN3.6 <- rbind(c(0:0), ModelDFSLt1_VMN3.5)
ModelDFSLt1_VMN3.7 <- rbind(c(0:0), ModelDFSLt1_VMN3.6)
ModelDFSLt1_VMN3.8 <- rbind(c(0:0), ModelDFSLt1_VMN3.7)
ModelDFSLt1_VMN3.9 <- rbind(c(0:0), ModelDFSLt1_VMN3.8)
ModelDFSLt1_VMN3.10 <- rbind(c(0:0), ModelDFSLt1_VMN3.9)
ModelDFSLt1_VMN3.11 <- rbind(c(0:0), ModelDFSLt1_VMN3.10)
ModelDFSLt1_VMN3.12 <- rbind(c(0:0), ModelDFSLt1_VMN3.11)
ModelDFSLt1_VMN3.13 <- ModelDFSLt1_VMN3.12[-nrow(ModelDFSLt1_VMN3.12),]
ModelDFSLt1_VMN3.14 <- ModelDFSLt1_VMN3.13[-nrow(ModelDFSLt1_VMN3.13),]
ModelDFSLt1_VMN3.15 <- ModelDFSLt1_VMN3.14[-nrow(ModelDFSLt1_VMN3.14),]
ModelDFSLt1_VMN3.16 <- ModelDFSLt1_VMN3.15[-nrow(ModelDFSLt1_VMN3.15),]
ModelDFSLt1_VMN3.17 <- ModelDFSLt1_VMN3.16[-nrow(ModelDFSLt1_VMN3.16),]
ModelDFSLt1_VMN3.18 <- ModelDFSLt1_VMN3.17[-nrow(ModelDFSLt1_VMN3.17),]
ModelDFSLt1_VMN3.19 <- ModelDFSLt1_VMN3.18[-nrow(ModelDFSLt1_VMN3.18),]
ModelDFSLt1_VMN3.20 <- ModelDFSLt1_VMN3.19[-nrow(ModelDFSLt1_VMN3.19),]
ModelDFSLt1_VMN3.21 <- ModelDFSLt1_VMN3.20[-nrow(ModelDFSLt1_VMN3.20),]
ModelDFSLt1_VMN3.22 <- ModelDFSLt1_VMN3.21[-nrow(ModelDFSLt1_VMN3.21),]
ModelDFSLt1_VMN3.23 <- ModelDFSLt1_VMN3.22[-nrow(ModelDFSLt1_VMN3.22),]
ModelDFSLt1_VMN3.24 <- ModelDFSLt1_VMN3.23[-nrow(ModelDFSLt1_VMN3.23),]

ModelDFSLt1_VMN3 <- ModelDFSLt1_VMN3.24 #Create model t=x+1

#Subtract model (t=x) - (t=x+1)
ModelDFSL1y_VMN3 <- ModelDFSLt0_VMN3 - ModelDFSLt1_VMN3

#Re-do Month Number column because the substraction was also applied to it
ModelDFSL1y_VMN3$MNumber <- seq(from = 1, to = SimulationLength_months)

#This model will be called VMN3P because implies a one-off input of C
ModelDFSL_VMN3P <- ModelDFSL1y_VMN3

#Export the dataframe
write_xlsx(ModelDFSL_VMN3P,"VXP_Models\\ModelDFSL_R_VMN3P.xlsx")

#Plot 3: Interactive Yearly CO2 emissions #
MY <- 12
ModelDFSL_VMN3P_YCO2 <- ModelDFSL_VMN3P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VMN3)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMN3P_YCO2) <- c("Year", "Months", "AnnualCO2_VMN_3")

#Plot 3: Interactive Yearly CO2 emissions considering a delay
GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
ModelDFSL_VMN3P_YCO2D <- merge(ModelDFSL_VMN3P_YCO2, GWP100delay, by = "Year")
ModelDFSL_VMN3P_YCO2D$AnnualCO2D_VMN_3 <- ModelDFSL_VMN3P_YCO2D$AnnualCO2_VMN_3 * ModelDFSL_VMN3P_YCO2D$GWP100

#Plot 4: Interactive Yearly C emissions #
MY <- 12
ModelDFSL_VMN3P_YC <- ModelDFSL_VMN3P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VMN3)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMN3P_YC) <- c("Year", "Months", "CEmissions_VMN_3")

#Plot 5: Interactive Yearly C tails (remaining C in Soil) #
MY <- 12
ModelDFSL_VMN3P_YCT <- ModelDFSL_VMN3P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VMN3)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMN3P_YCT) <- c("Year", "Months", "CTail_VMN_3")

#Save Dataframes for Plots 3.1, 3.2, 4 and 5
write_xlsx(ModelDFSL_VMN3P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VMN3P.xlsx") #Yearly CO2 emissions (no delay)
write_xlsx(ModelDFSL_VMN3P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VMN3P.xlsx") #Yearly CO2 emissions (delay)
write_xlsx(ModelDFSL_VMN3P_YC,"CEmissions_P\\ModelDFSL_R_CE_VMN3P.xlsx") #Yearly C emissions
write_xlsx(ModelDFSL_VMN3P_YCT,"CTails_P\\ModelDFSL_R_CT_VMN3P.xlsx") #Yearly C emissions



#### 12.5 - VMN4) Manure; 40%clay; No Tillage ####
#The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
fT_VMN4=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
fW_VMN4=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                        S.Thick = soil.thick, pClay = clay100*0.4,
                        pE = 1.0, bare = FALSE)$b #Moisture effects per month
xi.frame_VMN4=data.frame(years,rep(fT_VMN4*fW_VMN4,length.out=length(years)))

#To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
Model_VMN4=SoilR::RothCModel(
  t=years, #Simulation Length
  ks=c(k.DPM = 10*NTRM, k.RPM = 0.3*NTRM, k.BIO = 0.66*NTRM, k.HUM = 0.02*NTRM, k.IOM = 0*NTRM), #Decomposition rates for the different pools
  C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
  In=Scalar_LitterCinputs*0, #Amount of litter inputs by time
  FYM = Scalar_ManureCinputs*1, #Amount of Farm Yard Manure by time
  clay=clay100*0.4, #Percent clay in mineral soil
  xi=xi.frame_VMN4) #Loads the model

Ct_VMN4=getC(Model_VMN4) #Calculates stocks for each pool per month

#The results can be plotted with the commands
matplot(years, Ct_VMN4, type="l", lty=1, col=1:5,
        xlab="Time (years)", ylab="C stocks (Mg/ha)")
legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
       lty=1, col=1:5, bty="n")

VEC_Lit_VMN4 <- rep(M_Scalar_LitterCinputs*0, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
VEC_Man_VMN4 <- rep(M_Scalar_ManureCinputs*1, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

VEC_LitDF_VMN4 <- as.data.frame(VEC_Lit_VMN4) #Converting the Litter vector to a data frame
VEC_LitDF_VMN4$MNumber <- seq(from = 1, to = SimulationLength_months)
VEC_ManDF_VMN4 <- as.data.frame(VEC_Man_VMN4) #Converting the Manure vector to a data frame
VEC_ManDF_VMN4$MNumber <- seq(from = 1, to = SimulationLength_months)

sapply(VEC_LitDF_VMN4, class) #Check that class is numeric
sapply(VEC_ManDF_VMN4, class) #Check that class is numeric
LitterCinputs_VMN4=VEC_LitDF_VMN4   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
ManureCinputs_VMN4=VEC_ManDF_VMN4 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
MCinputs_VMN4 <- merge(LitterCinputs_VMN4, ManureCinputs_VMN4, by = "MNumber")
MCinputs_VMN4$MInput_VMN4 <- MCinputs_VMN4$VEC_Lit_VMN4 + MCinputs_VMN4$VEC_Man_VMN4

#Change names of litter and manure columns for more common ones
colnames(MCinputs_VMN4)[which(names(MCinputs_VMN4) == "VEC_Lit_VMN4")] <- "LitterC_VMN4"
colnames(MCinputs_VMN4)[which(names(MCinputs_VMN4) == "VEC_Man_VMN4")] <- "ManureC_VMN4"

#Create a dataframe with the data considering the simulation length
ModelDF_VMN4 <- as.data.frame(Ct_VMN4)
colnames(ModelDF_VMN4) <- c('DPM_VMN4','RPM_VMN4','BIO_VMN4', 'HUM_VMN4', 'IOM_VMN4')
ModelDFS_VMN4 <- ModelDF_VMN4[1:SimulationLength_months, ]

#Create a column with the number of month of analysis
ModelDFS_VMN4$MNumber <- seq(from = 1, to = SimulationLength_months)

#Create a column that sums all pools
ModelDFS_VMN4$AllPools_VMN4 <- ModelDFS_VMN4$DPM_VMN4 + ModelDFS_VMN4$RPM_VMN4 + ModelDFS_VMN4$BIO_VMN4 + ModelDFS_VMN4$HUM_VMN4 + ModelDFS_VMN4$IOM_VMN4

#Create a column that sums all pools except IOM (static)
ModelDFS_VMN4$AllPools_noIOM_VMN4 <- ModelDFS_VMN4$DPM_VMN4 + ModelDFS_VMN4$RPM_VMN4 + ModelDFS_VMN4$BIO_VMN4 + ModelDFS_VMN4$HUM_VMN4

#Create a column that add the monthly input of C (manure and litter separately)
ModelDFSL_VMN4 <- merge(ModelDFS_VMN4, MCinputs_VMN4, by = "MNumber")

ModelDFSL_VMN4$MInput_VMN4 <- ModelDFSL_VMN4$LitterC_VMN4 + ModelDFSL_VMN4$ManureC_VMN4
#ModelDF_SL$MInput[1] <- 0

#Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
ModelDFSL_VMN4$CTails_VMN4 <- ModelDFSL_VMN4$AllPools_noIOM_VMN4 + ModelDFSL_VMN4$MInput_VMN4

#Create Monthly Accumulated input of C
ModelDFSL_VMN4$AccumInput_VMN4 = ModelDFSL_VMN4$AccumInput_VMN4=cumsum(ModelDFSL_VMN4$MInput_VMN4)

#Create Monthly Growths for each carbon pool
ModelDFSL_VMN4$MGrowth_DPM_VMN4 <- ave(ModelDFSL_VMN4$DPM_VMN4, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMN4$MGrowth_RPM_VMN4 <- ave(ModelDFSL_VMN4$RPM_VMN4, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMN4$MGrowth_BIO_VMN4 <- ave(ModelDFSL_VMN4$BIO_VMN4, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMN4$MGrowth_HUM_VMN4 <- ave(ModelDFSL_VMN4$HUM_VMN4, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMN4$MGrowth_IOM_VMN4 <- ave(ModelDFSL_VMN4$IOM_VMN4, FUN = function(x) c(0, diff(x)))

#Create column for Monthly and Accumulated C-CO2 emissions
ModelDFSL_VMN4$M_CCO2_VMN4 <- ModelDFSL_VMN4$MInput_VMN4 - ModelDFSL_VMN4$MGrowth_DPM_VMN4 - ModelDFSL_VMN4$MGrowth_RPM_VMN4 - ModelDFSL_VMN4$MGrowth_BIO_VMN4 - ModelDFSL_VMN4$MGrowth_HUM_VMN4
ModelDFSL_VMN4$Accum_CCO2_VMN4 <- ModelDFSL_VMN4$AccumInput_VMN4 - ModelDFSL_VMN4$AllPools_noIOM_VMN4

#Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
ModelDFSL_VMN4$M_CCO2_VMN4[1] <- 0
ModelDFSL_VMN4$Accum_CCO2_VMN4[1] <- 0

#Balance validation
ModelDFSL_VMN4$Balance_VMN4 <- ModelDFSL_VMN4$AccumInput_VMN4 - ModelDFSL_VMN4$Accum_CCO2_VMN4 - (ModelDFSL_VMN4$DPM_VMN4 + ModelDFSL_VMN4$RPM_VMN4 + ModelDFSL_VMN4$BIO_VMN4 + ModelDFSL_VMN4$HUM_VMN4)

#Convert C-CO2 emissions into CO2 emissions
ModelDFSL_VMN4$M_CO2_VMN4 <- ModelDFSL_VMN4$M_CCO2_VMN4 * 44/12
ModelDFSL_VMN4$Accum_CO2_VMN4 <- ModelDFSL_VMN4$Accum_CCO2_VMN4 * 44/12

#This model will be called VMN4C because implies a continuous input of C
ModelDFSL_VMN4C <- ModelDFSL_VMN4

#Export the dataframe
write_xlsx(ModelDFSL_VMN4C,"VXC_Models\\ModelDFSL_R_VMN4C.xlsx")

#Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
#Create two equal models by using the above general script
#Create model t=x
ModelDFSLt0_VMN4 <- ModelDFSL_VMN4 #Create model t=x

#Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
ModelDFSLt1_VMN4.1 <- rbind(c(0:0), ModelDFSLt0_VMN4)
ModelDFSLt1_VMN4.2 <- rbind(c(0:0), ModelDFSLt1_VMN4.1)
ModelDFSLt1_VMN4.3 <- rbind(c(0:0), ModelDFSLt1_VMN4.2)
ModelDFSLt1_VMN4.4 <- rbind(c(0:0), ModelDFSLt1_VMN4.3)
ModelDFSLt1_VMN4.5 <- rbind(c(0:0), ModelDFSLt1_VMN4.4)
ModelDFSLt1_VMN4.6 <- rbind(c(0:0), ModelDFSLt1_VMN4.5)
ModelDFSLt1_VMN4.7 <- rbind(c(0:0), ModelDFSLt1_VMN4.6)
ModelDFSLt1_VMN4.8 <- rbind(c(0:0), ModelDFSLt1_VMN4.7)
ModelDFSLt1_VMN4.9 <- rbind(c(0:0), ModelDFSLt1_VMN4.8)
ModelDFSLt1_VMN4.10 <- rbind(c(0:0), ModelDFSLt1_VMN4.9)
ModelDFSLt1_VMN4.11 <- rbind(c(0:0), ModelDFSLt1_VMN4.10)
ModelDFSLt1_VMN4.12 <- rbind(c(0:0), ModelDFSLt1_VMN4.11)
ModelDFSLt1_VMN4.13 <- ModelDFSLt1_VMN4.12[-nrow(ModelDFSLt1_VMN4.12),]
ModelDFSLt1_VMN4.14 <- ModelDFSLt1_VMN4.13[-nrow(ModelDFSLt1_VMN4.13),]
ModelDFSLt1_VMN4.15 <- ModelDFSLt1_VMN4.14[-nrow(ModelDFSLt1_VMN4.14),]
ModelDFSLt1_VMN4.16 <- ModelDFSLt1_VMN4.15[-nrow(ModelDFSLt1_VMN4.15),]
ModelDFSLt1_VMN4.17 <- ModelDFSLt1_VMN4.16[-nrow(ModelDFSLt1_VMN4.16),]
ModelDFSLt1_VMN4.18 <- ModelDFSLt1_VMN4.17[-nrow(ModelDFSLt1_VMN4.17),]
ModelDFSLt1_VMN4.19 <- ModelDFSLt1_VMN4.18[-nrow(ModelDFSLt1_VMN4.18),]
ModelDFSLt1_VMN4.20 <- ModelDFSLt1_VMN4.19[-nrow(ModelDFSLt1_VMN4.19),]
ModelDFSLt1_VMN4.21 <- ModelDFSLt1_VMN4.20[-nrow(ModelDFSLt1_VMN4.20),]
ModelDFSLt1_VMN4.22 <- ModelDFSLt1_VMN4.21[-nrow(ModelDFSLt1_VMN4.21),]
ModelDFSLt1_VMN4.23 <- ModelDFSLt1_VMN4.22[-nrow(ModelDFSLt1_VMN4.22),]
ModelDFSLt1_VMN4.24 <- ModelDFSLt1_VMN4.23[-nrow(ModelDFSLt1_VMN4.23),]

ModelDFSLt1_VMN4 <- ModelDFSLt1_VMN4.24 #Create model t=x+1

#Subtract model (t=x) - (t=x+1)
ModelDFSL1y_VMN4 <- ModelDFSLt0_VMN4 - ModelDFSLt1_VMN4

#Re-do Month Number column because the substraction was also applied to it
ModelDFSL1y_VMN4$MNumber <- seq(from = 1, to = SimulationLength_months)

#This model will be called VMN4P because implies a one-off input of C
ModelDFSL_VMN4P <- ModelDFSL1y_VMN4

#Export the dataframe
write_xlsx(ModelDFSL_VMN4P,"VXP_Models\\ModelDFSL_R_VMN4P.xlsx")

#Plot 3: Interactive Yearly CO2 emissions #
MY <- 12
ModelDFSL_VMN4P_YCO2 <- ModelDFSL_VMN4P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VMN4)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMN4P_YCO2) <- c("Year", "Months", "AnnualCO2_VMN_4")

#Plot 3: Interactive Yearly CO2 emissions considering a delay
GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
ModelDFSL_VMN4P_YCO2D <- merge(ModelDFSL_VMN4P_YCO2, GWP100delay, by = "Year")
ModelDFSL_VMN4P_YCO2D$AnnualCO2D_VMN_4 <- ModelDFSL_VMN4P_YCO2D$AnnualCO2_VMN_4 * ModelDFSL_VMN4P_YCO2D$GWP100

#Plot 4: Interactive Yearly C emissions #
MY <- 12
ModelDFSL_VMN4P_YC <- ModelDFSL_VMN4P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VMN4)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMN4P_YC) <- c("Year", "Months", "CEmissions_VMN_4")

#Plot 5: Interactive Yearly C tails (remaining C in Soil) #
MY <- 12
ModelDFSL_VMN4P_YCT <- ModelDFSL_VMN4P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VMN4)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMN4P_YCT) <- c("Year", "Months", "CTail_VMN_4")

#Save Dataframes for Plots 3.1, 3.2, 4 and 5
write_xlsx(ModelDFSL_VMN4P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VMN4P.xlsx") #Yearly CO2 emissions (no delay)
write_xlsx(ModelDFSL_VMN4P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VMN4P.xlsx") #Yearly CO2 emissions (delay)
write_xlsx(ModelDFSL_VMN4P_YC,"CEmissions_P\\ModelDFSL_R_CE_VMN4P.xlsx") #Yearly C emissions
write_xlsx(ModelDFSL_VMN4P_YCT,"CTails_P\\ModelDFSL_R_CT_VMN4P.xlsx") #Yearly C emissions



#### 12.6 - VMN5) Manure; 50%clay; No Tillage ####
#The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
fT_VMN5=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
fW_VMN5=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                        S.Thick = soil.thick, pClay = clay100*0.5,
                        pE = 1.0, bare = FALSE)$b #Moisture effects per month
xi.frame_VMN5=data.frame(years,rep(fT_VMN5*fW_VMN5,length.out=length(years)))

#To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
Model_VMN5=SoilR::RothCModel(
  t=years, #Simulation Length
  ks=c(k.DPM = 10*NTRM, k.RPM = 0.3*NTRM, k.BIO = 0.66*NTRM, k.HUM = 0.02*NTRM, k.IOM = 0*NTRM), #Decomposition rates for the different pools
  C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
  In=Scalar_LitterCinputs*0, #Amount of litter inputs by time
  FYM = Scalar_ManureCinputs*1, #Amount of Farm Yard Manure by time
  clay=clay100*0.5, #Percent clay in mineral soil
  xi=xi.frame_VMN5) #Loads the model

Ct_VMN5=getC(Model_VMN5) #Calculates stocks for each pool per month

#The results can be plotted with the commands
matplot(years, Ct_VMN5, type="l", lty=1, col=1:5,
        xlab="Time (years)", ylab="C stocks (Mg/ha)")
legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
       lty=1, col=1:5, bty="n")

VEC_Lit_VMN5 <- rep(M_Scalar_LitterCinputs*0, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
VEC_Man_VMN5 <- rep(M_Scalar_ManureCinputs*1, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

VEC_LitDF_VMN5 <- as.data.frame(VEC_Lit_VMN5) #Converting the Litter vector to a data frame
VEC_LitDF_VMN5$MNumber <- seq(from = 1, to = SimulationLength_months)
VEC_ManDF_VMN5 <- as.data.frame(VEC_Man_VMN5) #Converting the Manure vector to a data frame
VEC_ManDF_VMN5$MNumber <- seq(from = 1, to = SimulationLength_months)

sapply(VEC_LitDF_VMN5, class) #Check that class is numeric
sapply(VEC_ManDF_VMN5, class) #Check that class is numeric
LitterCinputs_VMN5=VEC_LitDF_VMN5   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
ManureCinputs_VMN5=VEC_ManDF_VMN5 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
MCinputs_VMN5 <- merge(LitterCinputs_VMN5, ManureCinputs_VMN5, by = "MNumber")
MCinputs_VMN5$MInput_VMN5 <- MCinputs_VMN5$VEC_Lit_VMN5 + MCinputs_VMN5$VEC_Man_VMN5

#Change names of litter and manure columns for more common ones
colnames(MCinputs_VMN5)[which(names(MCinputs_VMN5) == "VEC_Lit_VMN5")] <- "LitterC_VMN5"
colnames(MCinputs_VMN5)[which(names(MCinputs_VMN5) == "VEC_Man_VMN5")] <- "ManureC_VMN5"

#Create a dataframe with the data considering the simulation length
ModelDF_VMN5 <- as.data.frame(Ct_VMN5)
colnames(ModelDF_VMN5) <- c('DPM_VMN5','RPM_VMN5','BIO_VMN5', 'HUM_VMN5', 'IOM_VMN5')
ModelDFS_VMN5 <- ModelDF_VMN5[1:SimulationLength_months, ]

#Create a column with the number of month of analysis
ModelDFS_VMN5$MNumber <- seq(from = 1, to = SimulationLength_months)

#Create a column that sums all pools
ModelDFS_VMN5$AllPools_VMN5 <- ModelDFS_VMN5$DPM_VMN5 + ModelDFS_VMN5$RPM_VMN5 + ModelDFS_VMN5$BIO_VMN5 + ModelDFS_VMN5$HUM_VMN5 + ModelDFS_VMN5$IOM_VMN5

#Create a column that sums all pools except IOM (static)
ModelDFS_VMN5$AllPools_noIOM_VMN5 <- ModelDFS_VMN5$DPM_VMN5 + ModelDFS_VMN5$RPM_VMN5 + ModelDFS_VMN5$BIO_VMN5 + ModelDFS_VMN5$HUM_VMN5

#Create a column that add the monthly input of C (manure and litter separately)
ModelDFSL_VMN5 <- merge(ModelDFS_VMN5, MCinputs_VMN5, by = "MNumber")

ModelDFSL_VMN5$MInput_VMN5 <- ModelDFSL_VMN5$LitterC_VMN5 + ModelDFSL_VMN5$ManureC_VMN5
#ModelDF_SL$MInput[1] <- 0

#Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
ModelDFSL_VMN5$CTails_VMN5 <- ModelDFSL_VMN5$AllPools_noIOM_VMN5 + ModelDFSL_VMN5$MInput_VMN5

#Create Monthly Accumulated input of C
ModelDFSL_VMN5$AccumInput_VMN5 = ModelDFSL_VMN5$AccumInput_VMN5=cumsum(ModelDFSL_VMN5$MInput_VMN5)

#Create Monthly Growths for each carbon pool
ModelDFSL_VMN5$MGrowth_DPM_VMN5 <- ave(ModelDFSL_VMN5$DPM_VMN5, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMN5$MGrowth_RPM_VMN5 <- ave(ModelDFSL_VMN5$RPM_VMN5, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMN5$MGrowth_BIO_VMN5 <- ave(ModelDFSL_VMN5$BIO_VMN5, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMN5$MGrowth_HUM_VMN5 <- ave(ModelDFSL_VMN5$HUM_VMN5, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMN5$MGrowth_IOM_VMN5 <- ave(ModelDFSL_VMN5$IOM_VMN5, FUN = function(x) c(0, diff(x)))

#Create column for Monthly and Accumulated C-CO2 emissions
ModelDFSL_VMN5$M_CCO2_VMN5 <- ModelDFSL_VMN5$MInput_VMN5 - ModelDFSL_VMN5$MGrowth_DPM_VMN5 - ModelDFSL_VMN5$MGrowth_RPM_VMN5 - ModelDFSL_VMN5$MGrowth_BIO_VMN5 - ModelDFSL_VMN5$MGrowth_HUM_VMN5
ModelDFSL_VMN5$Accum_CCO2_VMN5 <- ModelDFSL_VMN5$AccumInput_VMN5 - ModelDFSL_VMN5$AllPools_noIOM_VMN5

#Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
ModelDFSL_VMN5$M_CCO2_VMN5[1] <- 0
ModelDFSL_VMN5$Accum_CCO2_VMN5[1] <- 0

#Balance validation
ModelDFSL_VMN5$Balance_VMN5 <- ModelDFSL_VMN5$AccumInput_VMN5 - ModelDFSL_VMN5$Accum_CCO2_VMN5 - (ModelDFSL_VMN5$DPM_VMN5 + ModelDFSL_VMN5$RPM_VMN5 + ModelDFSL_VMN5$BIO_VMN5 + ModelDFSL_VMN5$HUM_VMN5)

#Convert C-CO2 emissions into CO2 emissions
ModelDFSL_VMN5$M_CO2_VMN5 <- ModelDFSL_VMN5$M_CCO2_VMN5 * 44/12
ModelDFSL_VMN5$Accum_CO2_VMN5 <- ModelDFSL_VMN5$Accum_CCO2_VMN5 * 44/12

#This model will be called VMN5C because implies a continuous input of C
ModelDFSL_VMN5C <- ModelDFSL_VMN5

#Export the dataframe
write_xlsx(ModelDFSL_VMN5C,"VXC_Models\\ModelDFSL_R_VMN5C.xlsx")

#Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
#Create two equal models by using the above general script
#Create model t=x
ModelDFSLt0_VMN5 <- ModelDFSL_VMN5 #Create model t=x

#Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
ModelDFSLt1_VMN5.1 <- rbind(c(0:0), ModelDFSLt0_VMN5)
ModelDFSLt1_VMN5.2 <- rbind(c(0:0), ModelDFSLt1_VMN5.1)
ModelDFSLt1_VMN5.3 <- rbind(c(0:0), ModelDFSLt1_VMN5.2)
ModelDFSLt1_VMN5.4 <- rbind(c(0:0), ModelDFSLt1_VMN5.3)
ModelDFSLt1_VMN5.5 <- rbind(c(0:0), ModelDFSLt1_VMN5.4)
ModelDFSLt1_VMN5.6 <- rbind(c(0:0), ModelDFSLt1_VMN5.5)
ModelDFSLt1_VMN5.7 <- rbind(c(0:0), ModelDFSLt1_VMN5.6)
ModelDFSLt1_VMN5.8 <- rbind(c(0:0), ModelDFSLt1_VMN5.7)
ModelDFSLt1_VMN5.9 <- rbind(c(0:0), ModelDFSLt1_VMN5.8)
ModelDFSLt1_VMN5.10 <- rbind(c(0:0), ModelDFSLt1_VMN5.9)
ModelDFSLt1_VMN5.11 <- rbind(c(0:0), ModelDFSLt1_VMN5.10)
ModelDFSLt1_VMN5.12 <- rbind(c(0:0), ModelDFSLt1_VMN5.11)
ModelDFSLt1_VMN5.13 <- ModelDFSLt1_VMN5.12[-nrow(ModelDFSLt1_VMN5.12),]
ModelDFSLt1_VMN5.14 <- ModelDFSLt1_VMN5.13[-nrow(ModelDFSLt1_VMN5.13),]
ModelDFSLt1_VMN5.15 <- ModelDFSLt1_VMN5.14[-nrow(ModelDFSLt1_VMN5.14),]
ModelDFSLt1_VMN5.16 <- ModelDFSLt1_VMN5.15[-nrow(ModelDFSLt1_VMN5.15),]
ModelDFSLt1_VMN5.17 <- ModelDFSLt1_VMN5.16[-nrow(ModelDFSLt1_VMN5.16),]
ModelDFSLt1_VMN5.18 <- ModelDFSLt1_VMN5.17[-nrow(ModelDFSLt1_VMN5.17),]
ModelDFSLt1_VMN5.19 <- ModelDFSLt1_VMN5.18[-nrow(ModelDFSLt1_VMN5.18),]
ModelDFSLt1_VMN5.20 <- ModelDFSLt1_VMN5.19[-nrow(ModelDFSLt1_VMN5.19),]
ModelDFSLt1_VMN5.21 <- ModelDFSLt1_VMN5.20[-nrow(ModelDFSLt1_VMN5.20),]
ModelDFSLt1_VMN5.22 <- ModelDFSLt1_VMN5.21[-nrow(ModelDFSLt1_VMN5.21),]
ModelDFSLt1_VMN5.23 <- ModelDFSLt1_VMN5.22[-nrow(ModelDFSLt1_VMN5.22),]
ModelDFSLt1_VMN5.24 <- ModelDFSLt1_VMN5.23[-nrow(ModelDFSLt1_VMN5.23),]

ModelDFSLt1_VMN5 <- ModelDFSLt1_VMN5.24 #Create model t=x+1

#Subtract model (t=x) - (t=x+1)
ModelDFSL1y_VMN5 <- ModelDFSLt0_VMN5 - ModelDFSLt1_VMN5

#Re-do Month Number column because the substraction was also applied to it
ModelDFSL1y_VMN5$MNumber <- seq(from = 1, to = SimulationLength_months)

#This model will be called VMN5P because implies a one-off input of C
ModelDFSL_VMN5P <- ModelDFSL1y_VMN5

#Export the dataframe
write_xlsx(ModelDFSL_VMN5P,"VXP_Models\\ModelDFSL_R_VMN5P.xlsx")


#Plot 3: Interactive Yearly CO2 emissions #
MY <- 12
ModelDFSL_VMN5P_YCO2 <- ModelDFSL_VMN5P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VMN5)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMN5P_YCO2) <- c("Year", "Months", "AnnualCO2_VMN_5")


#Plot 3: Interactive Yearly CO2 emissions considering a delay
GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
ModelDFSL_VMN5P_YCO2D <- merge(ModelDFSL_VMN5P_YCO2, GWP100delay, by = "Year")
ModelDFSL_VMN5P_YCO2D$AnnualCO2D_VMN_5 <- ModelDFSL_VMN5P_YCO2D$AnnualCO2_VMN_5 * ModelDFSL_VMN5P_YCO2D$GWP100

#Plot 4: Interactive Yearly C emissions #
MY <- 12
ModelDFSL_VMN5P_YC <- ModelDFSL_VMN5P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VMN5)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMN5P_YC) <- c("Year", "Months", "CEmissions_VMN_5")


#Plot 5: Interactive Yearly C tails (remaining C in Soil) #
MY <- 12
ModelDFSL_VMN5P_YCT <- ModelDFSL_VMN5P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VMN5)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMN5P_YCT) <- c("Year", "Months", "CTail_VMN_5")

#Save Dataframes for Plots 3.1, 3.2, 4 and 5
write_xlsx(ModelDFSL_VMN5P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VMN5P.xlsx") #Yearly CO2 emissions (no delay)
write_xlsx(ModelDFSL_VMN5P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VMN5P.xlsx") #Yearly CO2 emissions (delay)
write_xlsx(ModelDFSL_VMN5P_YC,"CEmissions_P\\ModelDFSL_R_CE_VMN5P.xlsx") #Yearly C emissions
write_xlsx(ModelDFSL_VMN5P_YCT,"CTails_P\\ModelDFSL_R_CT_VMN5P.xlsx") #Yearly C emissions



#### 12.7 - VMN6) Manure; 60%clay; No Tillage ####
#The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
fT_VMN6=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
fW_VMN6=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                        S.Thick = soil.thick, pClay = clay100*0.6,
                        pE = 1.0, bare = FALSE)$b #Moisture effects per month
xi.frame_VMN6=data.frame(years,rep(fT_VMN6*fW_VMN6,length.out=length(years)))

#To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
Model_VMN6=SoilR::RothCModel(
  t=years, #Simulation Length
  ks=c(k.DPM = 10*NTRM, k.RPM = 0.3*NTRM, k.BIO = 0.66*NTRM, k.HUM = 0.02*NTRM, k.IOM = 0*NTRM), #Decomposition rates for the different pools
  C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
  In=Scalar_LitterCinputs*0, #Amount of litter inputs by time
  FYM = Scalar_ManureCinputs*1, #Amount of Farm Yard Manure by time
  clay=clay100*0.6, #Percent clay in mineral soil
  xi=xi.frame_VMN6) #Loads the model

Ct_VMN6=getC(Model_VMN6) #Calculates stocks for each pool per month

#The results can be plotted with the commands
matplot(years, Ct_VMN6, type="l", lty=1, col=1:5,
        xlab="Time (years)", ylab="C stocks (Mg/ha)")
legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
       lty=1, col=1:5, bty="n")

VEC_Lit_VMN6 <- rep(M_Scalar_LitterCinputs*0, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
VEC_Man_VMN6 <- rep(M_Scalar_ManureCinputs*1, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

VEC_LitDF_VMN6 <- as.data.frame(VEC_Lit_VMN6) #Converting the Litter vector to a data frame
VEC_LitDF_VMN6$MNumber <- seq(from = 1, to = SimulationLength_months)
VEC_ManDF_VMN6 <- as.data.frame(VEC_Man_VMN6) #Converting the Manure vector to a data frame
VEC_ManDF_VMN6$MNumber <- seq(from = 1, to = SimulationLength_months)

sapply(VEC_LitDF_VMN6, class) #Check that class is numeric
sapply(VEC_ManDF_VMN6, class) #Check that class is numeric
LitterCinputs_VMN6=VEC_LitDF_VMN6   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
ManureCinputs_VMN6=VEC_ManDF_VMN6 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
MCinputs_VMN6 <- merge(LitterCinputs_VMN6, ManureCinputs_VMN6, by = "MNumber")
MCinputs_VMN6$MInput_VMN6 <- MCinputs_VMN6$VEC_Lit_VMN6 + MCinputs_VMN6$VEC_Man_VMN6

#Change names of litter and manure columns for more common ones
colnames(MCinputs_VMN6)[which(names(MCinputs_VMN6) == "VEC_Lit_VMN6")] <- "LitterC_VMN6"
colnames(MCinputs_VMN6)[which(names(MCinputs_VMN6) == "VEC_Man_VMN6")] <- "ManureC_VMN6"

#Create a dataframe with the data considering the simulation length
ModelDF_VMN6 <- as.data.frame(Ct_VMN6)
colnames(ModelDF_VMN6) <- c('DPM_VMN6','RPM_VMN6','BIO_VMN6', 'HUM_VMN6', 'IOM_VMN6')
ModelDFS_VMN6 <- ModelDF_VMN6[1:SimulationLength_months, ]

#Create a column with the number of month of analysis
ModelDFS_VMN6$MNumber <- seq(from = 1, to = SimulationLength_months)

#Create a column that sums all pools
ModelDFS_VMN6$AllPools_VMN6 <- ModelDFS_VMN6$DPM_VMN6 + ModelDFS_VMN6$RPM_VMN6 + ModelDFS_VMN6$BIO_VMN6 + ModelDFS_VMN6$HUM_VMN6 + ModelDFS_VMN6$IOM_VMN6

#Create a column that sums all pools except IOM (static)
ModelDFS_VMN6$AllPools_noIOM_VMN6 <- ModelDFS_VMN6$DPM_VMN6 + ModelDFS_VMN6$RPM_VMN6 + ModelDFS_VMN6$BIO_VMN6 + ModelDFS_VMN6$HUM_VMN6

#Create a column that add the monthly input of C (manure and litter separately)
ModelDFSL_VMN6 <- merge(ModelDFS_VMN6, MCinputs_VMN6, by = "MNumber")

ModelDFSL_VMN6$MInput_VMN6 <- ModelDFSL_VMN6$LitterC_VMN6 + ModelDFSL_VMN6$ManureC_VMN6
#ModelDF_SL$MInput[1] <- 0

#Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
ModelDFSL_VMN6$CTails_VMN6 <- ModelDFSL_VMN6$AllPools_noIOM_VMN6 + ModelDFSL_VMN6$MInput_VMN6

#Create Monthly Accumulated input of C
ModelDFSL_VMN6$AccumInput_VMN6 = ModelDFSL_VMN6$AccumInput_VMN6=cumsum(ModelDFSL_VMN6$MInput_VMN6)

#Create Monthly Growths for each carbon pool
ModelDFSL_VMN6$MGrowth_DPM_VMN6 <- ave(ModelDFSL_VMN6$DPM_VMN6, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMN6$MGrowth_RPM_VMN6 <- ave(ModelDFSL_VMN6$RPM_VMN6, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMN6$MGrowth_BIO_VMN6 <- ave(ModelDFSL_VMN6$BIO_VMN6, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMN6$MGrowth_HUM_VMN6 <- ave(ModelDFSL_VMN6$HUM_VMN6, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMN6$MGrowth_IOM_VMN6 <- ave(ModelDFSL_VMN6$IOM_VMN6, FUN = function(x) c(0, diff(x)))

#Create column for Monthly and Accumulated C-CO2 emissions
ModelDFSL_VMN6$M_CCO2_VMN6 <- ModelDFSL_VMN6$MInput_VMN6 - ModelDFSL_VMN6$MGrowth_DPM_VMN6 - ModelDFSL_VMN6$MGrowth_RPM_VMN6 - ModelDFSL_VMN6$MGrowth_BIO_VMN6 - ModelDFSL_VMN6$MGrowth_HUM_VMN6
ModelDFSL_VMN6$Accum_CCO2_VMN6 <- ModelDFSL_VMN6$AccumInput_VMN6 - ModelDFSL_VMN6$AllPools_noIOM_VMN6

#Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
ModelDFSL_VMN6$M_CCO2_VMN6[1] <- 0
ModelDFSL_VMN6$Accum_CCO2_VMN6[1] <- 0

#Balance validation
ModelDFSL_VMN6$Balance_VMN6 <- ModelDFSL_VMN6$AccumInput_VMN6 - ModelDFSL_VMN6$Accum_CCO2_VMN6 - (ModelDFSL_VMN6$DPM_VMN6 + ModelDFSL_VMN6$RPM_VMN6 + ModelDFSL_VMN6$BIO_VMN6 + ModelDFSL_VMN6$HUM_VMN6)

#Convert C-CO2 emissions into CO2 emissions
ModelDFSL_VMN6$M_CO2_VMN6 <- ModelDFSL_VMN6$M_CCO2_VMN6 * 44/12
ModelDFSL_VMN6$Accum_CO2_VMN6 <- ModelDFSL_VMN6$Accum_CCO2_VMN6 * 44/12

#This model will be called VMN6C because implies a continuous input of C
ModelDFSL_VMN6C <- ModelDFSL_VMN6

#Export the dataframe
write_xlsx(ModelDFSL_VMN6C,"VXC_Models\\ModelDFSL_R_VMN6C.xlsx")

#Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
#Create two equal models by using the above general script
#Create model t=x
ModelDFSLt0_VMN6 <- ModelDFSL_VMN6 #Create model t=x

#Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
ModelDFSLt1_VMN6.1 <- rbind(c(0:0), ModelDFSLt0_VMN6)
ModelDFSLt1_VMN6.2 <- rbind(c(0:0), ModelDFSLt1_VMN6.1)
ModelDFSLt1_VMN6.3 <- rbind(c(0:0), ModelDFSLt1_VMN6.2)
ModelDFSLt1_VMN6.4 <- rbind(c(0:0), ModelDFSLt1_VMN6.3)
ModelDFSLt1_VMN6.5 <- rbind(c(0:0), ModelDFSLt1_VMN6.4)
ModelDFSLt1_VMN6.6 <- rbind(c(0:0), ModelDFSLt1_VMN6.5)
ModelDFSLt1_VMN6.7 <- rbind(c(0:0), ModelDFSLt1_VMN6.6)
ModelDFSLt1_VMN6.8 <- rbind(c(0:0), ModelDFSLt1_VMN6.7)
ModelDFSLt1_VMN6.9 <- rbind(c(0:0), ModelDFSLt1_VMN6.8)
ModelDFSLt1_VMN6.10 <- rbind(c(0:0), ModelDFSLt1_VMN6.9)
ModelDFSLt1_VMN6.11 <- rbind(c(0:0), ModelDFSLt1_VMN6.10)
ModelDFSLt1_VMN6.12 <- rbind(c(0:0), ModelDFSLt1_VMN6.11)
ModelDFSLt1_VMN6.13 <- ModelDFSLt1_VMN6.12[-nrow(ModelDFSLt1_VMN6.12),]
ModelDFSLt1_VMN6.14 <- ModelDFSLt1_VMN6.13[-nrow(ModelDFSLt1_VMN6.13),]
ModelDFSLt1_VMN6.15 <- ModelDFSLt1_VMN6.14[-nrow(ModelDFSLt1_VMN6.14),]
ModelDFSLt1_VMN6.16 <- ModelDFSLt1_VMN6.15[-nrow(ModelDFSLt1_VMN6.15),]
ModelDFSLt1_VMN6.17 <- ModelDFSLt1_VMN6.16[-nrow(ModelDFSLt1_VMN6.16),]
ModelDFSLt1_VMN6.18 <- ModelDFSLt1_VMN6.17[-nrow(ModelDFSLt1_VMN6.17),]
ModelDFSLt1_VMN6.19 <- ModelDFSLt1_VMN6.18[-nrow(ModelDFSLt1_VMN6.18),]
ModelDFSLt1_VMN6.20 <- ModelDFSLt1_VMN6.19[-nrow(ModelDFSLt1_VMN6.19),]
ModelDFSLt1_VMN6.21 <- ModelDFSLt1_VMN6.20[-nrow(ModelDFSLt1_VMN6.20),]
ModelDFSLt1_VMN6.22 <- ModelDFSLt1_VMN6.21[-nrow(ModelDFSLt1_VMN6.21),]
ModelDFSLt1_VMN6.23 <- ModelDFSLt1_VMN6.22[-nrow(ModelDFSLt1_VMN6.22),]
ModelDFSLt1_VMN6.24 <- ModelDFSLt1_VMN6.23[-nrow(ModelDFSLt1_VMN6.23),]

ModelDFSLt1_VMN6 <- ModelDFSLt1_VMN6.24 #Create model t=x+1

#Subtract model (t=x) - (t=x+1)
ModelDFSL1y_VMN6 <- ModelDFSLt0_VMN6 - ModelDFSLt1_VMN6

#Re-do Month Number column because the substraction was also applied to it
ModelDFSL1y_VMN6$MNumber <- seq(from = 1, to = SimulationLength_months)

#This model will be called VMN6P because implies a one-off input of C
ModelDFSL_VMN6P <- ModelDFSL1y_VMN6

#Export the dataframe
write_xlsx(ModelDFSL_VMN6P,"VXP_Models\\ModelDFSL_R_VMN6P.xlsx")

#Plot 3: Interactive Yearly CO2 emissions #
MY <- 12
ModelDFSL_VMN6P_YCO2 <- ModelDFSL_VMN6P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VMN6)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMN6P_YCO2) <- c("Year", "Months", "AnnualCO2_VMN_6")


#Plot 3: Interactive Yearly CO2 emissions considering a delay
GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
ModelDFSL_VMN6P_YCO2D <- merge(ModelDFSL_VMN6P_YCO2, GWP100delay, by = "Year")
ModelDFSL_VMN6P_YCO2D$AnnualCO2D_VMN_6 <- ModelDFSL_VMN6P_YCO2D$AnnualCO2_VMN_6 * ModelDFSL_VMN6P_YCO2D$GWP100

#Plot 4: Interactive Yearly C emissions #
MY <- 12
ModelDFSL_VMN6P_YC <- ModelDFSL_VMN6P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VMN6)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMN6P_YC) <- c("Year", "Months", "CEmissions_VMN_6")


#Plot 5: Interactive Yearly C tails (remaining C in Soil) #
MY <- 12
ModelDFSL_VMN6P_YCT <- ModelDFSL_VMN6P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VMN6)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMN6P_YCT) <- c("Year", "Months", "CTail_VMN_6")

#Save Dataframes for Plots 3.1, 3.2, 4 and 5
write_xlsx(ModelDFSL_VMN6P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VMN6P.xlsx") #Yearly CO2 emissions (no delay)
write_xlsx(ModelDFSL_VMN6P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VMN6P.xlsx") #Yearly CO2 emissions (delay)
write_xlsx(ModelDFSL_VMN6P_YC,"CEmissions_P\\ModelDFSL_R_CE_VMN6P.xlsx") #Yearly C emissions
write_xlsx(ModelDFSL_VMN6P_YCT,"CTails_P\\ModelDFSL_R_CT_VMN6P.xlsx") #Yearly C emissions



#### 12.8 - VMN7) Manure; 70%clay; No Tillage ####
#The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
fT_VMN7=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
fW_VMN7=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                        S.Thick = soil.thick, pClay = clay100*0.7,
                        pE = 1.0, bare = FALSE)$b #Moisture effects per month
xi.frame_VMN7=data.frame(years,rep(fT_VMN7*fW_VMN7,length.out=length(years)))

#To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
Model_VMN7=SoilR::RothCModel(
  t=years, #Simulation Length
  ks=c(k.DPM = 10*NTRM, k.RPM = 0.3*NTRM, k.BIO = 0.66*NTRM, k.HUM = 0.02*NTRM, k.IOM = 0*NTRM), #Decomposition rates for the different pools
  C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
  In=Scalar_LitterCinputs*0, #Amount of litter inputs by time
  FYM = Scalar_ManureCinputs*1, #Amount of Farm Yard Manure by time
  clay=clay100*0.7, #Percent clay in mineral soil
  xi=xi.frame_VMN7) #Loads the model

Ct_VMN7=getC(Model_VMN7) #Calculates stocks for each pool per month

#The results can be plotted with the commands
matplot(years, Ct_VMN7, type="l", lty=1, col=1:5,
        xlab="Time (years)", ylab="C stocks (Mg/ha)")
legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
       lty=1, col=1:5, bty="n")

VEC_Lit_VMN7 <- rep(M_Scalar_LitterCinputs*0, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
VEC_Man_VMN7 <- rep(M_Scalar_ManureCinputs*1, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

VEC_LitDF_VMN7 <- as.data.frame(VEC_Lit_VMN7) #Converting the Litter vector to a data frame
VEC_LitDF_VMN7$MNumber <- seq(from = 1, to = SimulationLength_months)
VEC_ManDF_VMN7 <- as.data.frame(VEC_Man_VMN7) #Converting the Manure vector to a data frame
VEC_ManDF_VMN7$MNumber <- seq(from = 1, to = SimulationLength_months)

sapply(VEC_LitDF_VMN7, class) #Check that class is numeric
sapply(VEC_ManDF_VMN7, class) #Check that class is numeric
LitterCinputs_VMN7=VEC_LitDF_VMN7   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
ManureCinputs_VMN7=VEC_ManDF_VMN7 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
MCinputs_VMN7 <- merge(LitterCinputs_VMN7, ManureCinputs_VMN7, by = "MNumber")
MCinputs_VMN7$MInput_VMN7 <- MCinputs_VMN7$VEC_Lit_VMN7 + MCinputs_VMN7$VEC_Man_VMN7

#Change names of litter and manure columns for more common ones
colnames(MCinputs_VMN7)[which(names(MCinputs_VMN7) == "VEC_Lit_VMN7")] <- "LitterC_VMN7"
colnames(MCinputs_VMN7)[which(names(MCinputs_VMN7) == "VEC_Man_VMN7")] <- "ManureC_VMN7"

#Create a dataframe with the data considering the simulation length
ModelDF_VMN7 <- as.data.frame(Ct_VMN7)
colnames(ModelDF_VMN7) <- c('DPM_VMN7','RPM_VMN7','BIO_VMN7', 'HUM_VMN7', 'IOM_VMN7')
ModelDFS_VMN7 <- ModelDF_VMN7[1:SimulationLength_months, ]

#Create a column with the number of month of analysis
ModelDFS_VMN7$MNumber <- seq(from = 1, to = SimulationLength_months)

#Create a column that sums all pools
ModelDFS_VMN7$AllPools_VMN7 <- ModelDFS_VMN7$DPM_VMN7 + ModelDFS_VMN7$RPM_VMN7 + ModelDFS_VMN7$BIO_VMN7 + ModelDFS_VMN7$HUM_VMN7 + ModelDFS_VMN7$IOM_VMN7

#Create a column that sums all pools except IOM (static)
ModelDFS_VMN7$AllPools_noIOM_VMN7 <- ModelDFS_VMN7$DPM_VMN7 + ModelDFS_VMN7$RPM_VMN7 + ModelDFS_VMN7$BIO_VMN7 + ModelDFS_VMN7$HUM_VMN7

#Create a column that add the monthly input of C (manure and litter separately)
ModelDFSL_VMN7 <- merge(ModelDFS_VMN7, MCinputs_VMN7, by = "MNumber")

ModelDFSL_VMN7$MInput_VMN7 <- ModelDFSL_VMN7$LitterC_VMN7 + ModelDFSL_VMN7$ManureC_VMN7
#ModelDF_SL$MInput[1] <- 0

#Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
ModelDFSL_VMN7$CTails_VMN7 <- ModelDFSL_VMN7$AllPools_noIOM_VMN7 + ModelDFSL_VMN7$MInput_VMN7

#Create Monthly Accumulated input of C
ModelDFSL_VMN7$AccumInput_VMN7 = ModelDFSL_VMN7$AccumInput_VMN7=cumsum(ModelDFSL_VMN7$MInput_VMN7)

#Create Monthly Growths for each carbon pool
ModelDFSL_VMN7$MGrowth_DPM_VMN7 <- ave(ModelDFSL_VMN7$DPM_VMN7, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMN7$MGrowth_RPM_VMN7 <- ave(ModelDFSL_VMN7$RPM_VMN7, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMN7$MGrowth_BIO_VMN7 <- ave(ModelDFSL_VMN7$BIO_VMN7, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMN7$MGrowth_HUM_VMN7 <- ave(ModelDFSL_VMN7$HUM_VMN7, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMN7$MGrowth_IOM_VMN7 <- ave(ModelDFSL_VMN7$IOM_VMN7, FUN = function(x) c(0, diff(x)))

#Create column for Monthly and Accumulated C-CO2 emissions
ModelDFSL_VMN7$M_CCO2_VMN7 <- ModelDFSL_VMN7$MInput_VMN7 - ModelDFSL_VMN7$MGrowth_DPM_VMN7 - ModelDFSL_VMN7$MGrowth_RPM_VMN7 - ModelDFSL_VMN7$MGrowth_BIO_VMN7 - ModelDFSL_VMN7$MGrowth_HUM_VMN7
ModelDFSL_VMN7$Accum_CCO2_VMN7 <- ModelDFSL_VMN7$AccumInput_VMN7 - ModelDFSL_VMN7$AllPools_noIOM_VMN7

#Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
ModelDFSL_VMN7$M_CCO2_VMN7[1] <- 0
ModelDFSL_VMN7$Accum_CCO2_VMN7[1] <- 0

#Balance validation
ModelDFSL_VMN7$Balance_VMN7 <- ModelDFSL_VMN7$AccumInput_VMN7 - ModelDFSL_VMN7$Accum_CCO2_VMN7 - (ModelDFSL_VMN7$DPM_VMN7 + ModelDFSL_VMN7$RPM_VMN7 + ModelDFSL_VMN7$BIO_VMN7 + ModelDFSL_VMN7$HUM_VMN7)

#Convert C-CO2 emissions into CO2 emissions
ModelDFSL_VMN7$M_CO2_VMN7 <- ModelDFSL_VMN7$M_CCO2_VMN7 * 44/12
ModelDFSL_VMN7$Accum_CO2_VMN7 <- ModelDFSL_VMN7$Accum_CCO2_VMN7 * 44/12

#This model will be called VMN7C because implies a continuous input of C
ModelDFSL_VMN7C <- ModelDFSL_VMN7

#Export the dataframe
write_xlsx(ModelDFSL_VMN7C,"VXC_Models\\ModelDFSL_R_VMN7C.xlsx")

#Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
#Create two equal models by using the above general script
#Create model t=x
ModelDFSLt0_VMN7 <- ModelDFSL_VMN7 #Create model t=x

#Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
ModelDFSLt1_VMN7.1 <- rbind(c(0:0), ModelDFSLt0_VMN7)
ModelDFSLt1_VMN7.2 <- rbind(c(0:0), ModelDFSLt1_VMN7.1)
ModelDFSLt1_VMN7.3 <- rbind(c(0:0), ModelDFSLt1_VMN7.2)
ModelDFSLt1_VMN7.4 <- rbind(c(0:0), ModelDFSLt1_VMN7.3)
ModelDFSLt1_VMN7.5 <- rbind(c(0:0), ModelDFSLt1_VMN7.4)
ModelDFSLt1_VMN7.6 <- rbind(c(0:0), ModelDFSLt1_VMN7.5)
ModelDFSLt1_VMN7.7 <- rbind(c(0:0), ModelDFSLt1_VMN7.6)
ModelDFSLt1_VMN7.8 <- rbind(c(0:0), ModelDFSLt1_VMN7.7)
ModelDFSLt1_VMN7.9 <- rbind(c(0:0), ModelDFSLt1_VMN7.8)
ModelDFSLt1_VMN7.10 <- rbind(c(0:0), ModelDFSLt1_VMN7.9)
ModelDFSLt1_VMN7.11 <- rbind(c(0:0), ModelDFSLt1_VMN7.10)
ModelDFSLt1_VMN7.12 <- rbind(c(0:0), ModelDFSLt1_VMN7.11)
ModelDFSLt1_VMN7.13 <- ModelDFSLt1_VMN7.12[-nrow(ModelDFSLt1_VMN7.12),]
ModelDFSLt1_VMN7.14 <- ModelDFSLt1_VMN7.13[-nrow(ModelDFSLt1_VMN7.13),]
ModelDFSLt1_VMN7.15 <- ModelDFSLt1_VMN7.14[-nrow(ModelDFSLt1_VMN7.14),]
ModelDFSLt1_VMN7.16 <- ModelDFSLt1_VMN7.15[-nrow(ModelDFSLt1_VMN7.15),]
ModelDFSLt1_VMN7.17 <- ModelDFSLt1_VMN7.16[-nrow(ModelDFSLt1_VMN7.16),]
ModelDFSLt1_VMN7.18 <- ModelDFSLt1_VMN7.17[-nrow(ModelDFSLt1_VMN7.17),]
ModelDFSLt1_VMN7.19 <- ModelDFSLt1_VMN7.18[-nrow(ModelDFSLt1_VMN7.18),]
ModelDFSLt1_VMN7.20 <- ModelDFSLt1_VMN7.19[-nrow(ModelDFSLt1_VMN7.19),]
ModelDFSLt1_VMN7.21 <- ModelDFSLt1_VMN7.20[-nrow(ModelDFSLt1_VMN7.20),]
ModelDFSLt1_VMN7.22 <- ModelDFSLt1_VMN7.21[-nrow(ModelDFSLt1_VMN7.21),]
ModelDFSLt1_VMN7.23 <- ModelDFSLt1_VMN7.22[-nrow(ModelDFSLt1_VMN7.22),]
ModelDFSLt1_VMN7.24 <- ModelDFSLt1_VMN7.23[-nrow(ModelDFSLt1_VMN7.23),]

ModelDFSLt1_VMN7 <- ModelDFSLt1_VMN7.24 #Create model t=x+1

#Subtract model (t=x) - (t=x+1)
ModelDFSL1y_VMN7 <- ModelDFSLt0_VMN7 - ModelDFSLt1_VMN7

#Re-do Month Number column because the substraction was also applied to it
ModelDFSL1y_VMN7$MNumber <- seq(from = 1, to = SimulationLength_months)

#This model will be called VMN7P because implies a one-off input of C
ModelDFSL_VMN7P <- ModelDFSL1y_VMN7

#Export the dataframe
write_xlsx(ModelDFSL_VMN7P,"VXP_Models\\ModelDFSL_R_VMN7P.xlsx")

#Plot 3: Interactive Yearly CO2 emissions #
MY <- 12
ModelDFSL_VMN7P_YCO2 <- ModelDFSL_VMN7P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VMN7)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMN7P_YCO2) <- c("Year", "Months", "AnnualCO2_VMN_7")


#Plot 3: Interactive Yearly CO2 emissions considering a delay
GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
ModelDFSL_VMN7P_YCO2D <- merge(ModelDFSL_VMN7P_YCO2, GWP100delay, by = "Year")
ModelDFSL_VMN7P_YCO2D$AnnualCO2D_VMN_7 <- ModelDFSL_VMN7P_YCO2D$AnnualCO2_VMN_7 * ModelDFSL_VMN7P_YCO2D$GWP100

#Plot 4: Interactive Yearly C emissions #
MY <- 12
ModelDFSL_VMN7P_YC <- ModelDFSL_VMN7P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VMN7)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMN7P_YC) <- c("Year", "Months", "CEmissions_VMN_7")


#Plot 5: Interactive Yearly C tails (remaining C in Soil) #
MY <- 12
ModelDFSL_VMN7P_YCT <- ModelDFSL_VMN7P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VMN7)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMN7P_YCT) <- c("Year", "Months", "CTail_VMN_7")


#Save Dataframes for Plots 3.1, 3.2, 4 and 5
write_xlsx(ModelDFSL_VMN7P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VMN7P.xlsx") #Yearly CO2 emissions (no delay)
write_xlsx(ModelDFSL_VMN7P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VMN7P.xlsx") #Yearly CO2 emissions (delay)
write_xlsx(ModelDFSL_VMN7P_YC,"CEmissions_P\\ModelDFSL_R_CE_VMN7P.xlsx") #Yearly C emissions
write_xlsx(ModelDFSL_VMN7P_YCT,"CTails_P\\ModelDFSL_R_CT_VMN7P.xlsx") #Yearly C emissions



#### 12.9 - VMN8) Manure; 80%clay; No Tillage ####
#The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
fT_VMN8=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
fW_VMN8=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                        S.Thick = soil.thick, pClay = clay100*0.8,
                        pE = 1.0, bare = FALSE)$b #Moisture effects per month
xi.frame_VMN8=data.frame(years,rep(fT_VMN8*fW_VMN8,length.out=length(years)))

#To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
Model_VMN8=SoilR::RothCModel(
  t=years, #Simulation Length
  ks=c(k.DPM = 10*NTRM, k.RPM = 0.3*NTRM, k.BIO = 0.66*NTRM, k.HUM = 0.02*NTRM, k.IOM = 0*NTRM), #Decomposition rates for the different pools
  C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
  In=Scalar_LitterCinputs*0, #Amount of litter inputs by time
  FYM = Scalar_ManureCinputs*1, #Amount of Farm Yard Manure by time
  clay=clay100*0.8, #Percent clay in mineral soil
  xi=xi.frame_VMN8) #Loads the model

Ct_VMN8=getC(Model_VMN8) #Calculates stocks for each pool per month

#The results can be plotted with the commands
matplot(years, Ct_VMN8, type="l", lty=1, col=1:5,
        xlab="Time (years)", ylab="C stocks (Mg/ha)")
legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
       lty=1, col=1:5, bty="n")

VEC_Lit_VMN8 <- rep(M_Scalar_LitterCinputs*0, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
VEC_Man_VMN8 <- rep(M_Scalar_ManureCinputs*1, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

VEC_LitDF_VMN8 <- as.data.frame(VEC_Lit_VMN8) #Converting the Litter vector to a data frame
VEC_LitDF_VMN8$MNumber <- seq(from = 1, to = SimulationLength_months)
VEC_ManDF_VMN8 <- as.data.frame(VEC_Man_VMN8) #Converting the Manure vector to a data frame
VEC_ManDF_VMN8$MNumber <- seq(from = 1, to = SimulationLength_months)

sapply(VEC_LitDF_VMN8, class) #Check that class is numeric
sapply(VEC_ManDF_VMN8, class) #Check that class is numeric
LitterCinputs_VMN8=VEC_LitDF_VMN8   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
ManureCinputs_VMN8=VEC_ManDF_VMN8 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
MCinputs_VMN8 <- merge(LitterCinputs_VMN8, ManureCinputs_VMN8, by = "MNumber")
MCinputs_VMN8$MInput_VMN8 <- MCinputs_VMN8$VEC_Lit_VMN8 + MCinputs_VMN8$VEC_Man_VMN8

#Change names of litter and manure columns for more common ones
colnames(MCinputs_VMN8)[which(names(MCinputs_VMN8) == "VEC_Lit_VMN8")] <- "LitterC_VMN8"
colnames(MCinputs_VMN8)[which(names(MCinputs_VMN8) == "VEC_Man_VMN8")] <- "ManureC_VMN8"

#Create a dataframe with the data considering the simulation length
ModelDF_VMN8 <- as.data.frame(Ct_VMN8)
colnames(ModelDF_VMN8) <- c('DPM_VMN8','RPM_VMN8','BIO_VMN8', 'HUM_VMN8', 'IOM_VMN8')
ModelDFS_VMN8 <- ModelDF_VMN8[1:SimulationLength_months, ]

#Create a column with the number of month of analysis
ModelDFS_VMN8$MNumber <- seq(from = 1, to = SimulationLength_months)

#Create a column that sums all pools
ModelDFS_VMN8$AllPools_VMN8 <- ModelDFS_VMN8$DPM_VMN8 + ModelDFS_VMN8$RPM_VMN8 + ModelDFS_VMN8$BIO_VMN8 + ModelDFS_VMN8$HUM_VMN8 + ModelDFS_VMN8$IOM_VMN8

#Create a column that sums all pools except IOM (static)
ModelDFS_VMN8$AllPools_noIOM_VMN8 <- ModelDFS_VMN8$DPM_VMN8 + ModelDFS_VMN8$RPM_VMN8 + ModelDFS_VMN8$BIO_VMN8 + ModelDFS_VMN8$HUM_VMN8

#Create a column that add the monthly input of C (manure and litter separately)
ModelDFSL_VMN8 <- merge(ModelDFS_VMN8, MCinputs_VMN8, by = "MNumber")

ModelDFSL_VMN8$MInput_VMN8 <- ModelDFSL_VMN8$LitterC_VMN8 + ModelDFSL_VMN8$ManureC_VMN8
#ModelDF_SL$MInput[1] <- 0

#Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
ModelDFSL_VMN8$CTails_VMN8 <- ModelDFSL_VMN8$AllPools_noIOM_VMN8 + ModelDFSL_VMN8$MInput_VMN8

#Create Monthly Accumulated input of C
ModelDFSL_VMN8$AccumInput_VMN8 = ModelDFSL_VMN8$AccumInput_VMN8=cumsum(ModelDFSL_VMN8$MInput_VMN8)

#Create Monthly Growths for each carbon pool
ModelDFSL_VMN8$MGrowth_DPM_VMN8 <- ave(ModelDFSL_VMN8$DPM_VMN8, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMN8$MGrowth_RPM_VMN8 <- ave(ModelDFSL_VMN8$RPM_VMN8, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMN8$MGrowth_BIO_VMN8 <- ave(ModelDFSL_VMN8$BIO_VMN8, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMN8$MGrowth_HUM_VMN8 <- ave(ModelDFSL_VMN8$HUM_VMN8, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMN8$MGrowth_IOM_VMN8 <- ave(ModelDFSL_VMN8$IOM_VMN8, FUN = function(x) c(0, diff(x)))

#Create column for Monthly and Accumulated C-CO2 emissions
ModelDFSL_VMN8$M_CCO2_VMN8 <- ModelDFSL_VMN8$MInput_VMN8 - ModelDFSL_VMN8$MGrowth_DPM_VMN8 - ModelDFSL_VMN8$MGrowth_RPM_VMN8 - ModelDFSL_VMN8$MGrowth_BIO_VMN8 - ModelDFSL_VMN8$MGrowth_HUM_VMN8
ModelDFSL_VMN8$Accum_CCO2_VMN8 <- ModelDFSL_VMN8$AccumInput_VMN8 - ModelDFSL_VMN8$AllPools_noIOM_VMN8

#Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
ModelDFSL_VMN8$M_CCO2_VMN8[1] <- 0
ModelDFSL_VMN8$Accum_CCO2_VMN8[1] <- 0

#Balance validation
ModelDFSL_VMN8$Balance_VMN8 <- ModelDFSL_VMN8$AccumInput_VMN8 - ModelDFSL_VMN8$Accum_CCO2_VMN8 - (ModelDFSL_VMN8$DPM_VMN8 + ModelDFSL_VMN8$RPM_VMN8 + ModelDFSL_VMN8$BIO_VMN8 + ModelDFSL_VMN8$HUM_VMN8)

#Convert C-CO2 emissions into CO2 emissions
ModelDFSL_VMN8$M_CO2_VMN8 <- ModelDFSL_VMN8$M_CCO2_VMN8 * 44/12
ModelDFSL_VMN8$Accum_CO2_VMN8 <- ModelDFSL_VMN8$Accum_CCO2_VMN8 * 44/12

#This model will be called VMN8C because implies a continuous input of C
ModelDFSL_VMN8C <- ModelDFSL_VMN8

#Export the dataframe
write_xlsx(ModelDFSL_VMN8C,"VXC_Models\\ModelDFSL_R_VMN8C.xlsx")

#Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
#Create two equal models by using the above general script
#Create model t=x
ModelDFSLt0_VMN8 <- ModelDFSL_VMN8 #Create model t=x

#Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
ModelDFSLt1_VMN8.1 <- rbind(c(0:0), ModelDFSLt0_VMN8)
ModelDFSLt1_VMN8.2 <- rbind(c(0:0), ModelDFSLt1_VMN8.1)
ModelDFSLt1_VMN8.3 <- rbind(c(0:0), ModelDFSLt1_VMN8.2)
ModelDFSLt1_VMN8.4 <- rbind(c(0:0), ModelDFSLt1_VMN8.3)
ModelDFSLt1_VMN8.5 <- rbind(c(0:0), ModelDFSLt1_VMN8.4)
ModelDFSLt1_VMN8.6 <- rbind(c(0:0), ModelDFSLt1_VMN8.5)
ModelDFSLt1_VMN8.7 <- rbind(c(0:0), ModelDFSLt1_VMN8.6)
ModelDFSLt1_VMN8.8 <- rbind(c(0:0), ModelDFSLt1_VMN8.7)
ModelDFSLt1_VMN8.9 <- rbind(c(0:0), ModelDFSLt1_VMN8.8)
ModelDFSLt1_VMN8.10 <- rbind(c(0:0), ModelDFSLt1_VMN8.9)
ModelDFSLt1_VMN8.11 <- rbind(c(0:0), ModelDFSLt1_VMN8.10)
ModelDFSLt1_VMN8.12 <- rbind(c(0:0), ModelDFSLt1_VMN8.11)
ModelDFSLt1_VMN8.13 <- ModelDFSLt1_VMN8.12[-nrow(ModelDFSLt1_VMN8.12),]
ModelDFSLt1_VMN8.14 <- ModelDFSLt1_VMN8.13[-nrow(ModelDFSLt1_VMN8.13),]
ModelDFSLt1_VMN8.15 <- ModelDFSLt1_VMN8.14[-nrow(ModelDFSLt1_VMN8.14),]
ModelDFSLt1_VMN8.16 <- ModelDFSLt1_VMN8.15[-nrow(ModelDFSLt1_VMN8.15),]
ModelDFSLt1_VMN8.17 <- ModelDFSLt1_VMN8.16[-nrow(ModelDFSLt1_VMN8.16),]
ModelDFSLt1_VMN8.18 <- ModelDFSLt1_VMN8.17[-nrow(ModelDFSLt1_VMN8.17),]
ModelDFSLt1_VMN8.19 <- ModelDFSLt1_VMN8.18[-nrow(ModelDFSLt1_VMN8.18),]
ModelDFSLt1_VMN8.20 <- ModelDFSLt1_VMN8.19[-nrow(ModelDFSLt1_VMN8.19),]
ModelDFSLt1_VMN8.21 <- ModelDFSLt1_VMN8.20[-nrow(ModelDFSLt1_VMN8.20),]
ModelDFSLt1_VMN8.22 <- ModelDFSLt1_VMN8.21[-nrow(ModelDFSLt1_VMN8.21),]
ModelDFSLt1_VMN8.23 <- ModelDFSLt1_VMN8.22[-nrow(ModelDFSLt1_VMN8.22),]
ModelDFSLt1_VMN8.24 <- ModelDFSLt1_VMN8.23[-nrow(ModelDFSLt1_VMN8.23),]

ModelDFSLt1_VMN8 <- ModelDFSLt1_VMN8.24 #Create model t=x+1

#Subtract model (t=x) - (t=x+1)
ModelDFSL1y_VMN8 <- ModelDFSLt0_VMN8 - ModelDFSLt1_VMN8

#Re-do Month Number column because the substraction was also applied to it
ModelDFSL1y_VMN8$MNumber <- seq(from = 1, to = SimulationLength_months)

#This model will be called VMN8P because implies a one-off input of C
ModelDFSL_VMN8P <- ModelDFSL1y_VMN8

#Export the dataframe
write_xlsx(ModelDFSL_VMN8P,"VXP_Models\\ModelDFSL_R_VMN8P.xlsx")


#Plot 3: Interactive Yearly CO2 emissions #
MY <- 12
ModelDFSL_VMN8P_YCO2 <- ModelDFSL_VMN8P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VMN8)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMN8P_YCO2) <- c("Year", "Months", "AnnualCO2_VMN_8")

#Plot 3: Interactive Yearly CO2 emissions considering a delay
GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
ModelDFSL_VMN8P_YCO2D <- merge(ModelDFSL_VMN8P_YCO2, GWP100delay, by = "Year")
ModelDFSL_VMN8P_YCO2D$AnnualCO2D_VMN_8 <- ModelDFSL_VMN8P_YCO2D$AnnualCO2_VMN_8 * ModelDFSL_VMN8P_YCO2D$GWP100


#Plot 4: Interactive Yearly C emissions #
MY <- 12
ModelDFSL_VMN8P_YC <- ModelDFSL_VMN8P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VMN8)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMN8P_YC) <- c("Year", "Months", "CEmissions_VMN_8")

#Plot 5: Interactive Yearly C tails (remaining C in Soil) #
MY <- 12
ModelDFSL_VMN8P_YCT <- ModelDFSL_VMN8P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VMN8)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMN8P_YCT) <- c("Year", "Months", "CTail_VMN_8")

#Save Dataframes for Plots 3.1, 3.2, 4 and 5
write_xlsx(ModelDFSL_VMN8P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VMN8P.xlsx") #Yearly CO2 emissions (no delay)
write_xlsx(ModelDFSL_VMN8P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VMN8P.xlsx") #Yearly CO2 emissions (delay)
write_xlsx(ModelDFSL_VMN8P_YC,"CEmissions_P\\ModelDFSL_R_CE_VMN8P.xlsx") #Yearly C emissions
write_xlsx(ModelDFSL_VMN8P_YCT,"CTails_P\\ModelDFSL_R_CT_VMN8P.xlsx") #Yearly C emissions



#### 12.10 - VMN9) Manure; 90%clay; No Tillage ####
#The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
fT_VMN9=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
fW_VMN9=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                        S.Thick = soil.thick, pClay = clay100*0.9,
                        pE = 1.0, bare = FALSE)$b #Moisture effects per month
xi.frame_VMN9=data.frame(years,rep(fT_VMN9*fW_VMN9,length.out=length(years)))

#To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
Model_VMN9=SoilR::RothCModel(
  t=years, #Simulation Length
  ks=c(k.DPM = 10*NTRM, k.RPM = 0.3*NTRM, k.BIO = 0.66*NTRM, k.HUM = 0.02*NTRM, k.IOM = 0*NTRM), #Decomposition rates for the different pools
  C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
  In=Scalar_LitterCinputs*0, #Amount of litter inputs by time
  FYM = Scalar_ManureCinputs*1, #Amount of Farm Yard Manure by time
  clay=clay100*0.9, #Percent clay in mineral soil
  xi=xi.frame_VMN9) #Loads the model

Ct_VMN9=getC(Model_VMN9) #Calculates stocks for each pool per month

#The results can be plotted with the commands
matplot(years, Ct_VMN9, type="l", lty=1, col=1:5,
        xlab="Time (years)", ylab="C stocks (Mg/ha)")
legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
       lty=1, col=1:5, bty="n")

VEC_Lit_VMN9 <- rep(M_Scalar_LitterCinputs*0, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
VEC_Man_VMN9 <- rep(M_Scalar_ManureCinputs*1, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

VEC_LitDF_VMN9 <- as.data.frame(VEC_Lit_VMN9) #Converting the Litter vector to a data frame
VEC_LitDF_VMN9$MNumber <- seq(from = 1, to = SimulationLength_months)
VEC_ManDF_VMN9 <- as.data.frame(VEC_Man_VMN9) #Converting the Manure vector to a data frame
VEC_ManDF_VMN9$MNumber <- seq(from = 1, to = SimulationLength_months)

sapply(VEC_LitDF_VMN9, class) #Check that class is numeric
sapply(VEC_ManDF_VMN9, class) #Check that class is numeric
LitterCinputs_VMN9=VEC_LitDF_VMN9   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
ManureCinputs_VMN9=VEC_ManDF_VMN9 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
MCinputs_VMN9 <- merge(LitterCinputs_VMN9, ManureCinputs_VMN9, by = "MNumber")
MCinputs_VMN9$MInput_VMN9 <- MCinputs_VMN9$VEC_Lit_VMN9 + MCinputs_VMN9$VEC_Man_VMN9

#Change names of litter and manure columns for more common ones
colnames(MCinputs_VMN9)[which(names(MCinputs_VMN9) == "VEC_Lit_VMN9")] <- "LitterC_VMN9"
colnames(MCinputs_VMN9)[which(names(MCinputs_VMN9) == "VEC_Man_VMN9")] <- "ManureC_VMN9"

#Create a dataframe with the data considering the simulation length
ModelDF_VMN9 <- as.data.frame(Ct_VMN9)
colnames(ModelDF_VMN9) <- c('DPM_VMN9','RPM_VMN9','BIO_VMN9', 'HUM_VMN9', 'IOM_VMN9')
ModelDFS_VMN9 <- ModelDF_VMN9[1:SimulationLength_months, ]

#Create a column with the number of month of analysis
ModelDFS_VMN9$MNumber <- seq(from = 1, to = SimulationLength_months)

#Create a column that sums all pools
ModelDFS_VMN9$AllPools_VMN9 <- ModelDFS_VMN9$DPM_VMN9 + ModelDFS_VMN9$RPM_VMN9 + ModelDFS_VMN9$BIO_VMN9 + ModelDFS_VMN9$HUM_VMN9 + ModelDFS_VMN9$IOM_VMN9

#Create a column that sums all pools except IOM (static)
ModelDFS_VMN9$AllPools_noIOM_VMN9 <- ModelDFS_VMN9$DPM_VMN9 + ModelDFS_VMN9$RPM_VMN9 + ModelDFS_VMN9$BIO_VMN9 + ModelDFS_VMN9$HUM_VMN9

#Create a column that add the monthly input of C (manure and litter separately)
ModelDFSL_VMN9 <- merge(ModelDFS_VMN9, MCinputs_VMN9, by = "MNumber")

ModelDFSL_VMN9$MInput_VMN9 <- ModelDFSL_VMN9$LitterC_VMN9 + ModelDFSL_VMN9$ManureC_VMN9
#ModelDF_SL$MInput[1] <- 0

#Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
ModelDFSL_VMN9$CTails_VMN9 <- ModelDFSL_VMN9$AllPools_noIOM_VMN9 + ModelDFSL_VMN9$MInput_VMN9

#Create Monthly Accumulated input of C
ModelDFSL_VMN9$AccumInput_VMN9 = ModelDFSL_VMN9$AccumInput_VMN9=cumsum(ModelDFSL_VMN9$MInput_VMN9)

#Create Monthly Growths for each carbon pool
ModelDFSL_VMN9$MGrowth_DPM_VMN9 <- ave(ModelDFSL_VMN9$DPM_VMN9, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMN9$MGrowth_RPM_VMN9 <- ave(ModelDFSL_VMN9$RPM_VMN9, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMN9$MGrowth_BIO_VMN9 <- ave(ModelDFSL_VMN9$BIO_VMN9, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMN9$MGrowth_HUM_VMN9 <- ave(ModelDFSL_VMN9$HUM_VMN9, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMN9$MGrowth_IOM_VMN9 <- ave(ModelDFSL_VMN9$IOM_VMN9, FUN = function(x) c(0, diff(x)))

#Create column for Monthly and Accumulated C-CO2 emissions
ModelDFSL_VMN9$M_CCO2_VMN9 <- ModelDFSL_VMN9$MInput_VMN9 - ModelDFSL_VMN9$MGrowth_DPM_VMN9 - ModelDFSL_VMN9$MGrowth_RPM_VMN9 - ModelDFSL_VMN9$MGrowth_BIO_VMN9 - ModelDFSL_VMN9$MGrowth_HUM_VMN9
ModelDFSL_VMN9$Accum_CCO2_VMN9 <- ModelDFSL_VMN9$AccumInput_VMN9 - ModelDFSL_VMN9$AllPools_noIOM_VMN9

#Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
ModelDFSL_VMN9$M_CCO2_VMN9[1] <- 0
ModelDFSL_VMN9$Accum_CCO2_VMN9[1] <- 0

#Balance validation
ModelDFSL_VMN9$Balance_VMN9 <- ModelDFSL_VMN9$AccumInput_VMN9 - ModelDFSL_VMN9$Accum_CCO2_VMN9 - (ModelDFSL_VMN9$DPM_VMN9 + ModelDFSL_VMN9$RPM_VMN9 + ModelDFSL_VMN9$BIO_VMN9 + ModelDFSL_VMN9$HUM_VMN9)

#Convert C-CO2 emissions into CO2 emissions
ModelDFSL_VMN9$M_CO2_VMN9 <- ModelDFSL_VMN9$M_CCO2_VMN9 * 44/12
ModelDFSL_VMN9$Accum_CO2_VMN9 <- ModelDFSL_VMN9$Accum_CCO2_VMN9 * 44/12

#This model will be called VMN9C because implies a continuous input of C
ModelDFSL_VMN9C <- ModelDFSL_VMN9

#Export the dataframe
write_xlsx(ModelDFSL_VMN9C,"VXC_Models\\ModelDFSL_R_VMN9C.xlsx")

#Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
#Create two equal models by using the above general script
#Create model t=x
ModelDFSLt0_VMN9 <- ModelDFSL_VMN9 #Create model t=x

#Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
ModelDFSLt1_VMN9.1 <- rbind(c(0:0), ModelDFSLt0_VMN9)
ModelDFSLt1_VMN9.2 <- rbind(c(0:0), ModelDFSLt1_VMN9.1)
ModelDFSLt1_VMN9.3 <- rbind(c(0:0), ModelDFSLt1_VMN9.2)
ModelDFSLt1_VMN9.4 <- rbind(c(0:0), ModelDFSLt1_VMN9.3)
ModelDFSLt1_VMN9.5 <- rbind(c(0:0), ModelDFSLt1_VMN9.4)
ModelDFSLt1_VMN9.6 <- rbind(c(0:0), ModelDFSLt1_VMN9.5)
ModelDFSLt1_VMN9.7 <- rbind(c(0:0), ModelDFSLt1_VMN9.6)
ModelDFSLt1_VMN9.8 <- rbind(c(0:0), ModelDFSLt1_VMN9.7)
ModelDFSLt1_VMN9.9 <- rbind(c(0:0), ModelDFSLt1_VMN9.8)
ModelDFSLt1_VMN9.10 <- rbind(c(0:0), ModelDFSLt1_VMN9.9)
ModelDFSLt1_VMN9.11 <- rbind(c(0:0), ModelDFSLt1_VMN9.10)
ModelDFSLt1_VMN9.12 <- rbind(c(0:0), ModelDFSLt1_VMN9.11)
ModelDFSLt1_VMN9.13 <- ModelDFSLt1_VMN9.12[-nrow(ModelDFSLt1_VMN9.12),]
ModelDFSLt1_VMN9.14 <- ModelDFSLt1_VMN9.13[-nrow(ModelDFSLt1_VMN9.13),]
ModelDFSLt1_VMN9.15 <- ModelDFSLt1_VMN9.14[-nrow(ModelDFSLt1_VMN9.14),]
ModelDFSLt1_VMN9.16 <- ModelDFSLt1_VMN9.15[-nrow(ModelDFSLt1_VMN9.15),]
ModelDFSLt1_VMN9.17 <- ModelDFSLt1_VMN9.16[-nrow(ModelDFSLt1_VMN9.16),]
ModelDFSLt1_VMN9.18 <- ModelDFSLt1_VMN9.17[-nrow(ModelDFSLt1_VMN9.17),]
ModelDFSLt1_VMN9.19 <- ModelDFSLt1_VMN9.18[-nrow(ModelDFSLt1_VMN9.18),]
ModelDFSLt1_VMN9.20 <- ModelDFSLt1_VMN9.19[-nrow(ModelDFSLt1_VMN9.19),]
ModelDFSLt1_VMN9.21 <- ModelDFSLt1_VMN9.20[-nrow(ModelDFSLt1_VMN9.20),]
ModelDFSLt1_VMN9.22 <- ModelDFSLt1_VMN9.21[-nrow(ModelDFSLt1_VMN9.21),]
ModelDFSLt1_VMN9.23 <- ModelDFSLt1_VMN9.22[-nrow(ModelDFSLt1_VMN9.22),]
ModelDFSLt1_VMN9.24 <- ModelDFSLt1_VMN9.23[-nrow(ModelDFSLt1_VMN9.23),]

ModelDFSLt1_VMN9 <- ModelDFSLt1_VMN9.24 #Create model t=x+1

#Subtract model (t=x) - (t=x+1)
ModelDFSL1y_VMN9 <- ModelDFSLt0_VMN9 - ModelDFSLt1_VMN9

#Re-do Month Number column because the substraction was also applied to it
ModelDFSL1y_VMN9$MNumber <- seq(from = 1, to = SimulationLength_months)

#This model will be called VMN9P because implies a one-off input of C
ModelDFSL_VMN9P <- ModelDFSL1y_VMN9

#Export the dataframe
write_xlsx(ModelDFSL_VMN9P,"VXP_Models\\ModelDFSL_R_VMN9P.xlsx")


#Plot 3: Interactive Yearly CO2 emissions #
MY <- 12
ModelDFSL_VMN9P_YCO2 <- ModelDFSL_VMN9P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VMN9)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMN9P_YCO2) <- c("Year", "Months", "AnnualCO2_VMN_9")

#Plot 3: Interactive Yearly CO2 emissions considering a delay
GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
ModelDFSL_VMN9P_YCO2D <- merge(ModelDFSL_VMN9P_YCO2, GWP100delay, by = "Year")
ModelDFSL_VMN9P_YCO2D$AnnualCO2D_VMN_9 <- ModelDFSL_VMN9P_YCO2D$AnnualCO2_VMN_9 * ModelDFSL_VMN9P_YCO2D$GWP100


#Plot 4: Interactive Yearly C emissions #
MY <- 12
ModelDFSL_VMN9P_YC <- ModelDFSL_VMN9P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VMN9)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMN9P_YC) <- c("Year", "Months", "CEmissions_VMN_9")

#Plot 5: Interactive Yearly C tails (remaining C in Soil) #
MY <- 12
ModelDFSL_VMN9P_YCT <- ModelDFSL_VMN9P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VMN9)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMN9P_YCT) <- c("Year", "Months", "CTail_VMN_9")

#Save Dataframes for Plots 3.1, 3.2, 4 and 5
write_xlsx(ModelDFSL_VMN9P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VMN9P.xlsx") #Yearly CO2 emissions (no delay)
write_xlsx(ModelDFSL_VMN9P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VMN9P.xlsx") #Yearly CO2 emissions (delay)
write_xlsx(ModelDFSL_VMN9P_YC,"CEmissions_P\\ModelDFSL_R_CE_VMN9P.xlsx") #Yearly C emissions
write_xlsx(ModelDFSL_VMN9P_YCT,"CTails_P\\ModelDFSL_R_CT_VMN9P.xlsx") #Yearly C emissions



#### 12.11 - VMN10) Manure; 100%clay; No Tillage ####
#The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
fT_VMN10=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
fW_VMN10=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                         S.Thick = soil.thick, pClay = clay100,
                         pE = 1.0, bare = FALSE)$b #Moisture effects per month
xi.frame_VMN10=data.frame(years,rep(fT_VMN10*fW_VMN10,length.out=length(years)))

#To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
Model_VMN10=SoilR::RothCModel(
  t=years, #Simulation Length
  ks=c(k.DPM = 10*NTRM, k.RPM = 0.3*NTRM, k.BIO = 0.66*NTRM, k.HUM = 0.02*NTRM, k.IOM = 0*NTRM), #Decomposition rates for the different pools
  C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
  In=Scalar_LitterCinputs*0, #Amount of litter inputs by time
  FYM = Scalar_ManureCinputs*1, #Amount of Farm Yard Manure by time
  clay=clay100, #Percent clay in mineral soil
  xi=xi.frame_VMN10) #Loads the model

Ct_VMN10=getC(Model_VMN10) #Calculates stocks for each pool per month

#The results can be plotted with the commands
matplot(years, Ct_VMN10, type="l", lty=1, col=1:5,
        xlab="Time (years)", ylab="C stocks (Mg/ha)")
legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
       lty=1, col=1:5, bty="n")

VEC_Lit_VMN10 <- rep(M_Scalar_LitterCinputs*0, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
VEC_Man_VMN10 <- rep(M_Scalar_ManureCinputs*1, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

VEC_LitDF_VMN10 <- as.data.frame(VEC_Lit_VMN10) #Converting the Litter vector to a data frame
VEC_LitDF_VMN10$MNumber <- seq(from = 1, to = SimulationLength_months)
VEC_ManDF_VMN10 <- as.data.frame(VEC_Man_VMN10) #Converting the Manure vector to a data frame
VEC_ManDF_VMN10$MNumber <- seq(from = 1, to = SimulationLength_months)

sapply(VEC_LitDF_VMN10, class) #Check that class is numeric
sapply(VEC_ManDF_VMN10, class) #Check that class is numeric
LitterCinputs_VMN10=VEC_LitDF_VMN10   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
ManureCinputs_VMN10=VEC_ManDF_VMN10 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
MCinputs_VMN10 <- merge(LitterCinputs_VMN10, ManureCinputs_VMN10, by = "MNumber")
MCinputs_VMN10$MInput_VMN10 <- MCinputs_VMN10$VEC_Lit_VMN10 + MCinputs_VMN10$VEC_Man_VMN10

#Change names of litter and manure columns for more common ones
colnames(MCinputs_VMN10)[which(names(MCinputs_VMN10) == "VEC_Lit_VMN10")] <- "LitterC_VMN10"
colnames(MCinputs_VMN10)[which(names(MCinputs_VMN10) == "VEC_Man_VMN10")] <- "ManureC_VMN10"

#Create a dataframe with the data considering the simulation length
ModelDF_VMN10 <- as.data.frame(Ct_VMN10)
colnames(ModelDF_VMN10) <- c('DPM_VMN10','RPM_VMN10','BIO_VMN10', 'HUM_VMN10', 'IOM_VMN10')
ModelDFS_VMN10 <- ModelDF_VMN10[1:SimulationLength_months, ]

#Create a column with the number of month of analysis
ModelDFS_VMN10$MNumber <- seq(from = 1, to = SimulationLength_months)

#Create a column that sums all pools
ModelDFS_VMN10$AllPools_VMN10 <- ModelDFS_VMN10$DPM_VMN10 + ModelDFS_VMN10$RPM_VMN10 + ModelDFS_VMN10$BIO_VMN10 + ModelDFS_VMN10$HUM_VMN10 + ModelDFS_VMN10$IOM_VMN10

#Create a column that sums all pools except IOM (static)
ModelDFS_VMN10$AllPools_noIOM_VMN10 <- ModelDFS_VMN10$DPM_VMN10 + ModelDFS_VMN10$RPM_VMN10 + ModelDFS_VMN10$BIO_VMN10 + ModelDFS_VMN10$HUM_VMN10

#Create a column that add the monthly input of C (manure and litter separately)
ModelDFSL_VMN10 <- merge(ModelDFS_VMN10, MCinputs_VMN10, by = "MNumber")

ModelDFSL_VMN10$MInput_VMN10 <- ModelDFSL_VMN10$LitterC_VMN10 + ModelDFSL_VMN10$ManureC_VMN10
#ModelDF_SL$MInput[1] <- 0

#Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
ModelDFSL_VMN10$CTails_VMN10 <- ModelDFSL_VMN10$AllPools_noIOM_VMN10 + ModelDFSL_VMN10$MInput_VMN10

#Create Monthly Accumulated input of C
ModelDFSL_VMN10$AccumInput_VMN10 = ModelDFSL_VMN10$AccumInput_VMN10=cumsum(ModelDFSL_VMN10$MInput_VMN10)

#Create Monthly Growths for each carbon pool
ModelDFSL_VMN10$MGrowth_DPM_VMN10 <- ave(ModelDFSL_VMN10$DPM_VMN10, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMN10$MGrowth_RPM_VMN10 <- ave(ModelDFSL_VMN10$RPM_VMN10, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMN10$MGrowth_BIO_VMN10 <- ave(ModelDFSL_VMN10$BIO_VMN10, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMN10$MGrowth_HUM_VMN10 <- ave(ModelDFSL_VMN10$HUM_VMN10, FUN = function(x) c(0, diff(x)))
ModelDFSL_VMN10$MGrowth_IOM_VMN10 <- ave(ModelDFSL_VMN10$IOM_VMN10, FUN = function(x) c(0, diff(x)))

#Create column for Monthly and Accumulated C-CO2 emissions
ModelDFSL_VMN10$M_CCO2_VMN10 <- ModelDFSL_VMN10$MInput_VMN10 - ModelDFSL_VMN10$MGrowth_DPM_VMN10 - ModelDFSL_VMN10$MGrowth_RPM_VMN10 - ModelDFSL_VMN10$MGrowth_BIO_VMN10 - ModelDFSL_VMN10$MGrowth_HUM_VMN10
ModelDFSL_VMN10$Accum_CCO2_VMN10 <- ModelDFSL_VMN10$AccumInput_VMN10 - ModelDFSL_VMN10$AllPools_noIOM_VMN10

#Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
ModelDFSL_VMN10$M_CCO2_VMN10[1] <- 0
ModelDFSL_VMN10$Accum_CCO2_VMN10[1] <- 0

#Balance validation
ModelDFSL_VMN10$Balance_VMN10 <- ModelDFSL_VMN10$AccumInput_VMN10 - ModelDFSL_VMN10$Accum_CCO2_VMN10 - (ModelDFSL_VMN10$DPM_VMN10 + ModelDFSL_VMN10$RPM_VMN10 + ModelDFSL_VMN10$BIO_VMN10 + ModelDFSL_VMN10$HUM_VMN10)

#Convert C-CO2 emissions into CO2 emissions
ModelDFSL_VMN10$M_CO2_VMN10 <- ModelDFSL_VMN10$M_CCO2_VMN10 * 44/12
ModelDFSL_VMN10$Accum_CO2_VMN10 <- ModelDFSL_VMN10$Accum_CCO2_VMN10 * 44/12

#This model will be called VMN10C because implies a continuous input of C
ModelDFSL_VMN10C <- ModelDFSL_VMN10

#Export the dataframe
write_xlsx(ModelDFSL_VMN10C,"VXC_Models\\ModelDFSL_R_VMN10C.xlsx")

#Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
#Create two equal models by using the above general script
#Create model t=x
ModelDFSLt0_VMN10 <- ModelDFSL_VMN10 #Create model t=x

#Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
ModelDFSLt1_VMN10.1 <- rbind(c(0:0), ModelDFSLt0_VMN10)
ModelDFSLt1_VMN10.2 <- rbind(c(0:0), ModelDFSLt1_VMN10.1)
ModelDFSLt1_VMN10.3 <- rbind(c(0:0), ModelDFSLt1_VMN10.2)
ModelDFSLt1_VMN10.4 <- rbind(c(0:0), ModelDFSLt1_VMN10.3)
ModelDFSLt1_VMN10.5 <- rbind(c(0:0), ModelDFSLt1_VMN10.4)
ModelDFSLt1_VMN10.6 <- rbind(c(0:0), ModelDFSLt1_VMN10.5)
ModelDFSLt1_VMN10.7 <- rbind(c(0:0), ModelDFSLt1_VMN10.6)
ModelDFSLt1_VMN10.8 <- rbind(c(0:0), ModelDFSLt1_VMN10.7)
ModelDFSLt1_VMN10.9 <- rbind(c(0:0), ModelDFSLt1_VMN10.8)
ModelDFSLt1_VMN10.10 <- rbind(c(0:0), ModelDFSLt1_VMN10.9)
ModelDFSLt1_VMN10.11 <- rbind(c(0:0), ModelDFSLt1_VMN10.10)
ModelDFSLt1_VMN10.12 <- rbind(c(0:0), ModelDFSLt1_VMN10.11)
ModelDFSLt1_VMN10.13 <- ModelDFSLt1_VMN10.12[-nrow(ModelDFSLt1_VMN10.12),]
ModelDFSLt1_VMN10.14 <- ModelDFSLt1_VMN10.13[-nrow(ModelDFSLt1_VMN10.13),]
ModelDFSLt1_VMN10.15 <- ModelDFSLt1_VMN10.14[-nrow(ModelDFSLt1_VMN10.14),]
ModelDFSLt1_VMN10.16 <- ModelDFSLt1_VMN10.15[-nrow(ModelDFSLt1_VMN10.15),]
ModelDFSLt1_VMN10.17 <- ModelDFSLt1_VMN10.16[-nrow(ModelDFSLt1_VMN10.16),]
ModelDFSLt1_VMN10.18 <- ModelDFSLt1_VMN10.17[-nrow(ModelDFSLt1_VMN10.17),]
ModelDFSLt1_VMN10.19 <- ModelDFSLt1_VMN10.18[-nrow(ModelDFSLt1_VMN10.18),]
ModelDFSLt1_VMN10.20 <- ModelDFSLt1_VMN10.19[-nrow(ModelDFSLt1_VMN10.19),]
ModelDFSLt1_VMN10.21 <- ModelDFSLt1_VMN10.20[-nrow(ModelDFSLt1_VMN10.20),]
ModelDFSLt1_VMN10.22 <- ModelDFSLt1_VMN10.21[-nrow(ModelDFSLt1_VMN10.21),]
ModelDFSLt1_VMN10.23 <- ModelDFSLt1_VMN10.22[-nrow(ModelDFSLt1_VMN10.22),]
ModelDFSLt1_VMN10.24 <- ModelDFSLt1_VMN10.23[-nrow(ModelDFSLt1_VMN10.23),]

ModelDFSLt1_VMN10 <- ModelDFSLt1_VMN10.24 #Create model t=x+1

#Subtract model (t=x) - (t=x+1)
ModelDFSL1y_VMN10 <- ModelDFSLt0_VMN10 - ModelDFSLt1_VMN10

#Re-do Month Number column because the substraction was also applied to it
ModelDFSL1y_VMN10$MNumber <- seq(from = 1, to = SimulationLength_months)

#This model will be called VMN10P because implies a one-off input of C
ModelDFSL_VMN10P <- ModelDFSL1y_VMN10

#Export the dataframe
write_xlsx(ModelDFSL_VMN10P,"VXP_Models\\ModelDFSL_R_VMN10P.xlsx")


#Plot 3: Interactive Yearly CO2 emissions #
MY <- 12
ModelDFSL_VMN10P_YCO2 <- ModelDFSL_VMN10P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VMN10)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMN10P_YCO2) <- c("Year", "Months", "AnnualCO2_VMN10")

#Plot 3: Interactive Yearly CO2 emissions considering a delay
GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
ModelDFSL_VMN10P_YCO2D <- merge(ModelDFSL_VMN10P_YCO2, GWP100delay, by = "Year")
ModelDFSL_VMN10P_YCO2D$AnnualCO2D_VMN10 <- ModelDFSL_VMN10P_YCO2D$AnnualCO2_VMN10 * ModelDFSL_VMN10P_YCO2D$GWP100

#Plot 4: Interactive Yearly C emissions #
MY <- 12
ModelDFSL_VMN10P_YC <- ModelDFSL_VMN10P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VMN10)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMN10P_YC) <- c("Year", "Months", "CEmissions_VMN10")

#Plot 5: Interactive Yearly C tails (remaining C in Soil) #
MY <- 12
ModelDFSL_VMN10P_YCT <- ModelDFSL_VMN10P %>%
  group_by(grp = as.integer(gl(n(), MY, n()))) %>%
  summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VMN10)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
colnames(ModelDFSL_VMN10P_YCT) <- c("Year", "Months", "CTail_VMN10")

#Save Dataframes for Plots 3.1, 3.2, 4 and 5
write_xlsx(ModelDFSL_VMN10P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VMN10P.xlsx") #Yearly CO2 emissions (no delay)
write_xlsx(ModelDFSL_VMN10P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VMN10P.xlsx") #Yearly CO2 emissions (delay)
write_xlsx(ModelDFSL_VMN10P_YC,"CEmissions_P\\ModelDFSL_R_CE_VMN10P.xlsx") #Yearly C emissions
write_xlsx(ModelDFSL_VMN10P_YCT,"CTails_P\\ModelDFSL_R_CT_VMN10P.xlsx") #Yearly C emissions

  }
  else if(Scope == "VLC"){
    #### 7) Model Combinations - Litter; Conventional Tillage, 0-100% (+10%) Clay ####
    #### 7.1 - VLC0) Litter; 0%clay; Conventional tillage ####
    #The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
    fT_VLC0=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
    fW_VLC0=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                            S.Thick = soil.thick, pClay = clay0,
                            pE = 1.0, bare = FALSE)$b #Moisture effects per month
    xi.frame_VLC0=data.frame(years,rep(fT_VLC0*fW_VLC0,length.out=length(years)))

    #To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
    Model_VLC0=SoilR::RothCModel(
      t=years, #Simulation Length
      ks=c(k.DPM = 10*CTRM, k.RPM = 0.3*CTRM, k.BIO = 0.66*CTRM, k.HUM = 0.02*CTRM, k.IOM = 0*CTRM), #Decomposition rates for the different pools
      C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
      In=Scalar_LitterCinputs*1, #Amount of litter inputs by time
      FYM = Scalar_ManureCinputs*0, #Amount of Farm Yard Manure by time
      clay=clay0, #Percent clay in mineral soil
      xi=xi.frame_VLC0) #Loads the model

    Ct_VLC0=getC(Model_VLC0) #Calculates stocks for each pool per month

    VEC_Lit_VLC0 <- rep(M_Scalar_LitterCinputs*1, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
    VEC_Man_VLC0 <- rep(M_Scalar_ManureCinputs*0, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

    VEC_LitDF_VLC0 <- as.data.frame(VEC_Lit_VLC0) #Converting the Litter vector to a data frame
    VEC_LitDF_VLC0$MNumber <- seq(from = 1, to = SimulationLength_months)
    VEC_ManDF_VLC0 <- as.data.frame(VEC_Man_VLC0) #Converting the Manure vector to a data frame
    VEC_ManDF_VLC0$MNumber <- seq(from = 1, to = SimulationLength_months)

    sapply(VEC_LitDF_VLC0, class) #Check that class is numeric
    sapply(VEC_ManDF_VLC0, class) #Check that class is numeric
    LitterCinputs_VLC0=VEC_LitDF_VLC0   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    ManureCinputs_VLC0=VEC_ManDF_VLC0 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    MCinputs_VLC0 <- merge(LitterCinputs_VLC0, ManureCinputs_VLC0, by = "MNumber")
    MCinputs_VLC0$MInput_VLC0 <- MCinputs_VLC0$VEC_Lit_VLC0 + MCinputs_VLC0$VEC_Man_VLC0

    #Change names of litter and manure columns for more common ones
    colnames(MCinputs_VLC0)[which(names(MCinputs_VLC0) == "VEC_Lit_VLC0")] <- "LitterC_VLC0"
    colnames(MCinputs_VLC0)[which(names(MCinputs_VLC0) == "VEC_Man_VLC0")] <- "ManureC_VLC0"

    #Create a dataframe with the data considering the simulation length
    ModelDF_VLC0 <- as.data.frame(Ct_VLC0)
    colnames(ModelDF_VLC0) <- c('DPM_VLC0','RPM_VLC0','BIO_VLC0', 'HUM_VLC0', 'IOM_VLC0')
    ModelDFS_VLC0 <- ModelDF_VLC0[1:SimulationLength_months, ]

    #Create a column with the number of month of analysis
    ModelDFS_VLC0$MNumber <- seq(from = 1, to = SimulationLength_months)

    #Create a column that sums all pools
    ModelDFS_VLC0$AllPools_VLC0 <- ModelDFS_VLC0$DPM_VLC0 + ModelDFS_VLC0$RPM_VLC0 + ModelDFS_VLC0$BIO_VLC0 + ModelDFS_VLC0$HUM_VLC0 + ModelDFS_VLC0$IOM_VLC0

    #Create a column that sums all pools except IOM (static)
    ModelDFS_VLC0$AllPools_noIOM_VLC0 <- ModelDFS_VLC0$DPM_VLC0 + ModelDFS_VLC0$RPM_VLC0 + ModelDFS_VLC0$BIO_VLC0 + ModelDFS_VLC0$HUM_VLC0

    #Create a column that add the monthly input of C (manure and litter separately)
    ModelDFSL_VLC0 <- merge(ModelDFS_VLC0, MCinputs_VLC0, by = "MNumber")

    ModelDFSL_VLC0$MInput_VLC0 <- ModelDFSL_VLC0$LitterC_VLC0 + ModelDFSL_VLC0$ManureC_VLC0
    #ModelDF_SL$MInput[1] <- 0

    #Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
    ModelDFSL_VLC0$CTails_VLC0 <- ModelDFSL_VLC0$AllPools_noIOM_VLC0 + ModelDFSL_VLC0$MInput_VLC0

    #Create Monthly Accumulated input of C
    ModelDFSL_VLC0$AccumInput_VLC0 = ModelDFSL_VLC0$AccumInput_VLC0=cumsum(ModelDFSL_VLC0$MInput_VLC0)

    #Create Monthly Growths for each carbon pool
    ModelDFSL_VLC0$MGrowth_DPM_VLC0 <- ave(ModelDFSL_VLC0$DPM_VLC0, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLC0$MGrowth_RPM_VLC0 <- ave(ModelDFSL_VLC0$RPM_VLC0, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLC0$MGrowth_BIO_VLC0 <- ave(ModelDFSL_VLC0$BIO_VLC0, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLC0$MGrowth_HUM_VLC0 <- ave(ModelDFSL_VLC0$HUM_VLC0, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLC0$MGrowth_IOM_VLC0 <- ave(ModelDFSL_VLC0$IOM_VLC0, FUN = function(x) c(0, diff(x)))

    #Create column for Monthly and Accumulated C-CO2 emissions
    ModelDFSL_VLC0$M_CCO2_VLC0 <- ModelDFSL_VLC0$MInput_VLC0 - ModelDFSL_VLC0$MGrowth_DPM_VLC0 - ModelDFSL_VLC0$MGrowth_RPM_VLC0 - ModelDFSL_VLC0$MGrowth_BIO_VLC0 - ModelDFSL_VLC0$MGrowth_HUM_VLC0
    ModelDFSL_VLC0$Accum_CCO2_VLC0 <- ModelDFSL_VLC0$AccumInput_VLC0 - ModelDFSL_VLC0$AllPools_noIOM_VLC0

    #Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
    ModelDFSL_VLC0$M_CCO2_VLC0[1] <- 0
    ModelDFSL_VLC0$Accum_CCO2_VLC0[1] <- 0

    #Balance validation
    ModelDFSL_VLC0$Balance_VLC0 <- ModelDFSL_VLC0$AccumInput_VLC0 - ModelDFSL_VLC0$Accum_CCO2_VLC0 - (ModelDFSL_VLC0$DPM_VLC0 + ModelDFSL_VLC0$RPM_VLC0 + ModelDFSL_VLC0$BIO_VLC0 + ModelDFSL_VLC0$HUM_VLC0)

    #Convert C-CO2 emissions into CO2 emissions
    ModelDFSL_VLC0$M_CO2_VLC0 <- ModelDFSL_VLC0$M_CCO2_VLC0 * 44/12
    ModelDFSL_VLC0$Accum_CO2_VLC0 <- ModelDFSL_VLC0$Accum_CCO2_VLC0 * 44/12

    #This model will be called VLC0C because implies a continuous input of C
    ModelDFSL_VLC0C <- ModelDFSL_VLC0

    #Export the dataframe
    write_xlsx(ModelDFSL_VLC0C,"VXC_Models\\ModelDFSL_R_VLC0C.xlsx")

    #Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
    #Create two equal models by using the above general script
    #Create model t=x
    ModelDFSLt0_VLC0 <- ModelDFSL_VLC0 #Create model t=x

    #Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
    ModelDFSLt1_VLC0.1 <- rbind(c(0:0), ModelDFSLt0_VLC0)
    ModelDFSLt1_VLC0.2 <- rbind(c(0:0), ModelDFSLt1_VLC0.1)
    ModelDFSLt1_VLC0.3 <- rbind(c(0:0), ModelDFSLt1_VLC0.2)
    ModelDFSLt1_VLC0.4 <- rbind(c(0:0), ModelDFSLt1_VLC0.3)
    ModelDFSLt1_VLC0.5 <- rbind(c(0:0), ModelDFSLt1_VLC0.4)
    ModelDFSLt1_VLC0.6 <- rbind(c(0:0), ModelDFSLt1_VLC0.5)
    ModelDFSLt1_VLC0.7 <- rbind(c(0:0), ModelDFSLt1_VLC0.6)
    ModelDFSLt1_VLC0.8 <- rbind(c(0:0), ModelDFSLt1_VLC0.7)
    ModelDFSLt1_VLC0.9 <- rbind(c(0:0), ModelDFSLt1_VLC0.8)
    ModelDFSLt1_VLC0.10 <- rbind(c(0:0), ModelDFSLt1_VLC0.9)
    ModelDFSLt1_VLC0.11 <- rbind(c(0:0), ModelDFSLt1_VLC0.10)
    ModelDFSLt1_VLC0.12 <- rbind(c(0:0), ModelDFSLt1_VLC0.11)
    ModelDFSLt1_VLC0.13 <- ModelDFSLt1_VLC0.12[-nrow(ModelDFSLt1_VLC0.12),]
    ModelDFSLt1_VLC0.14 <- ModelDFSLt1_VLC0.13[-nrow(ModelDFSLt1_VLC0.13),]
    ModelDFSLt1_VLC0.15 <- ModelDFSLt1_VLC0.14[-nrow(ModelDFSLt1_VLC0.14),]
    ModelDFSLt1_VLC0.16 <- ModelDFSLt1_VLC0.15[-nrow(ModelDFSLt1_VLC0.15),]
    ModelDFSLt1_VLC0.17 <- ModelDFSLt1_VLC0.16[-nrow(ModelDFSLt1_VLC0.16),]
    ModelDFSLt1_VLC0.18 <- ModelDFSLt1_VLC0.17[-nrow(ModelDFSLt1_VLC0.17),]
    ModelDFSLt1_VLC0.19 <- ModelDFSLt1_VLC0.18[-nrow(ModelDFSLt1_VLC0.18),]
    ModelDFSLt1_VLC0.20 <- ModelDFSLt1_VLC0.19[-nrow(ModelDFSLt1_VLC0.19),]
    ModelDFSLt1_VLC0.21 <- ModelDFSLt1_VLC0.20[-nrow(ModelDFSLt1_VLC0.20),]
    ModelDFSLt1_VLC0.22 <- ModelDFSLt1_VLC0.21[-nrow(ModelDFSLt1_VLC0.21),]
    ModelDFSLt1_VLC0.23 <- ModelDFSLt1_VLC0.22[-nrow(ModelDFSLt1_VLC0.22),]
    ModelDFSLt1_VLC0.24 <- ModelDFSLt1_VLC0.23[-nrow(ModelDFSLt1_VLC0.23),]

    ModelDFSLt1_VLC0 <- ModelDFSLt1_VLC0.24 #Create model t=x+1

    #Subtract model (t=x) - (t=x+1)
    ModelDFSL1y_VLC0 <- ModelDFSLt0_VLC0 - ModelDFSLt1_VLC0

    #Re-do Month Number column because the substraction was also applied to it
    ModelDFSL1y_VLC0$MNumber <- seq(from = 1, to = SimulationLength_months)

    #This model will be called VLC0P because implies a one-off input of C
    ModelDFSL_VLC0P <- ModelDFSL1y_VLC0

    #Export the dataframe
    write_xlsx(ModelDFSL_VLC0P,"VXP_Models\\ModelDFSL_R_VLC0P.xlsx")

    #Plot 3.1: Interactive Yearly CO2 emissions #
    MY <- 12
    ModelDFSL_VLC0P_YCO2 <- ModelDFSL_VLC0P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VLC0)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLC0P_YCO2) <- c("Year", "Months", "AnnualCO2_VLC_0")

    #Plot 3.2: Interactive Yearly CO2 emissions considering a delay
    GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
    ModelDFSL_VLC0P_YCO2D <- merge(ModelDFSL_VLC0P_YCO2, GWP100delay, by = "Year")
    ModelDFSL_VLC0P_YCO2D$AnnualCO2D_VLC_0 <- ModelDFSL_VLC0P_YCO2D$AnnualCO2_VLC_0 * ModelDFSL_VLC0P_YCO2D$GWP100

    #Plot 4: Interactive Yearly C emissions #
    MY <- 12
    ModelDFSL_VLC0P_YC <- ModelDFSL_VLC0P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VLC0)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLC0P_YC) <- c("Year", "Months", "CEmissions_VLC_0")

    #Plot 5: Interactive Yearly C tails (remaining C in Soil) #
    MY <- 12
    ModelDFSL_VLC0P_YCT <- ModelDFSL_VLC0P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VLC0)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLC0P_YCT) <- c("Year", "Months", "CTail_VLC_0")

    #Save Dataframes for Plots 3.1, 3.2, 4 and 5
    write_xlsx(ModelDFSL_VLC0P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VLC0P.xlsx") #Yearly CO2 emissions (no delay)
    write_xlsx(ModelDFSL_VLC0P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VLC0P.xlsx") #Yearly CO2 emissions (delay)
    write_xlsx(ModelDFSL_VLC0P_YC,"CEmissions_P\\ModelDFSL_R_CE_VLC0P.xlsx") #Yearly C emissions
    write_xlsx(ModelDFSL_VLC0P_YCT,"CTails_P\\ModelDFSL_R_CT_VLC0P.xlsx") #Yearly C emissions


    #### 7.2 - VLC1) Litter; 10%clay; Conventional tillage ####
    #The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
    fT_VLC1=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
    fW_VLC1=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                            S.Thick = soil.thick, pClay = clay100*0.1,
                            pE = 1.0, bare = FALSE)$b #Moisture effects per month
    xi.frame_VLC1=data.frame(years,rep(fT_VLC1*fW_VLC1,length.out=length(years)))

    #To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
    Model_VLC1=SoilR::RothCModel(
      t=years, #Simulation Length
      ks=c(k.DPM = 10*CTRM, k.RPM = 0.3*CTRM, k.BIO = 0.66*CTRM, k.HUM = 0.02*CTRM, k.IOM = 0*CTRM), #Decomposition rates for the different pools
      C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
      In=Scalar_LitterCinputs*1, #Amount of litter inputs by time
      FYM = Scalar_ManureCinputs*0, #Amount of Farm Yard Manure by time
      clay=clay100*0.1, #Percent clay in mineral soil
      xi=xi.frame_VLC1) #Loads the model

    Ct_VLC1=getC(Model_VLC1) #Calculates stocks for each pool per month

    #The results can be plotted with the commands
    matplot(years, Ct_VLC1, type="l", lty=1, col=1:5,
            xlab="Time (years)", ylab="C stocks (Mg/ha)")
    legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
           lty=1, col=1:5, bty="n")

    VEC_Lit_VLC1 <- rep(M_Scalar_LitterCinputs*1, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
    VEC_Man_VLC1 <- rep(M_Scalar_ManureCinputs*0, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

    VEC_LitDF_VLC1 <- as.data.frame(VEC_Lit_VLC1) #Converting the Litter vector to a data frame
    VEC_LitDF_VLC1$MNumber <- seq(from = 1, to = SimulationLength_months)
    VEC_ManDF_VLC1 <- as.data.frame(VEC_Man_VLC1) #Converting the Manure vector to a data frame
    VEC_ManDF_VLC1$MNumber <- seq(from = 1, to = SimulationLength_months)

    sapply(VEC_LitDF_VLC1, class) #Check that class is numeric
    sapply(VEC_ManDF_VLC1, class) #Check that class is numeric
    LitterCinputs_VLC1=VEC_LitDF_VLC1   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    ManureCinputs_VLC1=VEC_ManDF_VLC1 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    MCinputs_VLC1 <- merge(LitterCinputs_VLC1, ManureCinputs_VLC1, by = "MNumber")
    MCinputs_VLC1$MInput_VLC1 <- MCinputs_VLC1$VEC_Lit_VLC1 + MCinputs_VLC1$VEC_Man_VLC1

    #Change names of litter and manure columns for more common ones
    colnames(MCinputs_VLC1)[which(names(MCinputs_VLC1) == "VEC_Lit_VLC1")] <- "LitterC_VLC1"
    colnames(MCinputs_VLC1)[which(names(MCinputs_VLC1) == "VEC_Man_VLC1")] <- "ManureC_VLC1"

    #Create a dataframe with the data considering the simulation length
    ModelDF_VLC1 <- as.data.frame(Ct_VLC1)
    colnames(ModelDF_VLC1) <- c('DPM_VLC1','RPM_VLC1','BIO_VLC1', 'HUM_VLC1', 'IOM_VLC1')
    ModelDFS_VLC1 <- ModelDF_VLC1[1:SimulationLength_months, ]

    #Create a column with the number of month of analysis
    ModelDFS_VLC1$MNumber <- seq(from = 1, to = SimulationLength_months)

    #Create a column that sums all pools
    ModelDFS_VLC1$AllPools_VLC1 <- ModelDFS_VLC1$DPM_VLC1 + ModelDFS_VLC1$RPM_VLC1 + ModelDFS_VLC1$BIO_VLC1 + ModelDFS_VLC1$HUM_VLC1 + ModelDFS_VLC1$IOM_VLC1

    #Create a column that sums all pools except IOM (static)
    ModelDFS_VLC1$AllPools_noIOM_VLC1 <- ModelDFS_VLC1$DPM_VLC1 + ModelDFS_VLC1$RPM_VLC1 + ModelDFS_VLC1$BIO_VLC1 + ModelDFS_VLC1$HUM_VLC1

    #Create a column that add the monthly input of C (manure and litter separately)
    ModelDFSL_VLC1 <- merge(ModelDFS_VLC1, MCinputs_VLC1, by = "MNumber")

    ModelDFSL_VLC1$MInput_VLC1 <- ModelDFSL_VLC1$LitterC_VLC1 + ModelDFSL_VLC1$ManureC_VLC1
    #ModelDF_SL$MInput[1] <- 0

    #Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
    ModelDFSL_VLC1$CTails_VLC1 <- ModelDFSL_VLC1$AllPools_noIOM_VLC1 + ModelDFSL_VLC1$MInput_VLC1

    #Create Monthly Accumulated input of C
    ModelDFSL_VLC1$AccumInput_VLC1 = ModelDFSL_VLC1$AccumInput_VLC1=cumsum(ModelDFSL_VLC1$MInput_VLC1)

    #Create Monthly Growths for each carbon pool
    ModelDFSL_VLC1$MGrowth_DPM_VLC1 <- ave(ModelDFSL_VLC1$DPM_VLC1, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLC1$MGrowth_RPM_VLC1 <- ave(ModelDFSL_VLC1$RPM_VLC1, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLC1$MGrowth_BIO_VLC1 <- ave(ModelDFSL_VLC1$BIO_VLC1, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLC1$MGrowth_HUM_VLC1 <- ave(ModelDFSL_VLC1$HUM_VLC1, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLC1$MGrowth_IOM_VLC1 <- ave(ModelDFSL_VLC1$IOM_VLC1, FUN = function(x) c(0, diff(x)))

    #Create column for Monthly and Accumulated C-CO2 emissions
    ModelDFSL_VLC1$M_CCO2_VLC1 <- ModelDFSL_VLC1$MInput_VLC1 - ModelDFSL_VLC1$MGrowth_DPM_VLC1 - ModelDFSL_VLC1$MGrowth_RPM_VLC1 - ModelDFSL_VLC1$MGrowth_BIO_VLC1 - ModelDFSL_VLC1$MGrowth_HUM_VLC1
    ModelDFSL_VLC1$Accum_CCO2_VLC1 <- ModelDFSL_VLC1$AccumInput_VLC1 - ModelDFSL_VLC1$AllPools_noIOM_VLC1

    #Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
    ModelDFSL_VLC1$M_CCO2_VLC1[1] <- 0
    ModelDFSL_VLC1$Accum_CCO2_VLC1[1] <- 0

    #Balance validation
    ModelDFSL_VLC1$Balance_VLC1 <- ModelDFSL_VLC1$AccumInput_VLC1 - ModelDFSL_VLC1$Accum_CCO2_VLC1 - (ModelDFSL_VLC1$DPM_VLC1 + ModelDFSL_VLC1$RPM_VLC1 + ModelDFSL_VLC1$BIO_VLC1 + ModelDFSL_VLC1$HUM_VLC1)

    #Convert C-CO2 emissions into CO2 emissions
    ModelDFSL_VLC1$M_CO2_VLC1 <- ModelDFSL_VLC1$M_CCO2_VLC1 * 44/12
    ModelDFSL_VLC1$Accum_CO2_VLC1 <- ModelDFSL_VLC1$Accum_CCO2_VLC1 * 44/12

    #This model will be called VLC1C because implies a continuous input of C
    ModelDFSL_VLC1C <- ModelDFSL_VLC1

    #Export the dataframe
    write_xlsx(ModelDFSL_VLC1C,"VXC_Models\\ModelDFSL_R_VLC1C.xlsx")

    #Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
    #Create two equal models by using the above general script
    #Create model t=x
    ModelDFSLt0_VLC1 <- ModelDFSL_VLC1 #Create model t=x

    #Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
    ModelDFSLt1_VLC1.1 <- rbind(c(0:0), ModelDFSLt0_VLC1)
    ModelDFSLt1_VLC1.2 <- rbind(c(0:0), ModelDFSLt1_VLC1.1)
    ModelDFSLt1_VLC1.3 <- rbind(c(0:0), ModelDFSLt1_VLC1.2)
    ModelDFSLt1_VLC1.4 <- rbind(c(0:0), ModelDFSLt1_VLC1.3)
    ModelDFSLt1_VLC1.5 <- rbind(c(0:0), ModelDFSLt1_VLC1.4)
    ModelDFSLt1_VLC1.6 <- rbind(c(0:0), ModelDFSLt1_VLC1.5)
    ModelDFSLt1_VLC1.7 <- rbind(c(0:0), ModelDFSLt1_VLC1.6)
    ModelDFSLt1_VLC1.8 <- rbind(c(0:0), ModelDFSLt1_VLC1.7)
    ModelDFSLt1_VLC1.9 <- rbind(c(0:0), ModelDFSLt1_VLC1.8)
    ModelDFSLt1_VLC1.10 <- rbind(c(0:0), ModelDFSLt1_VLC1.9)
    ModelDFSLt1_VLC1.11 <- rbind(c(0:0), ModelDFSLt1_VLC1.10)
    ModelDFSLt1_VLC1.12 <- rbind(c(0:0), ModelDFSLt1_VLC1.11)
    ModelDFSLt1_VLC1.13 <- ModelDFSLt1_VLC1.12[-nrow(ModelDFSLt1_VLC1.12),]
    ModelDFSLt1_VLC1.14 <- ModelDFSLt1_VLC1.13[-nrow(ModelDFSLt1_VLC1.13),]
    ModelDFSLt1_VLC1.15 <- ModelDFSLt1_VLC1.14[-nrow(ModelDFSLt1_VLC1.14),]
    ModelDFSLt1_VLC1.16 <- ModelDFSLt1_VLC1.15[-nrow(ModelDFSLt1_VLC1.15),]
    ModelDFSLt1_VLC1.17 <- ModelDFSLt1_VLC1.16[-nrow(ModelDFSLt1_VLC1.16),]
    ModelDFSLt1_VLC1.18 <- ModelDFSLt1_VLC1.17[-nrow(ModelDFSLt1_VLC1.17),]
    ModelDFSLt1_VLC1.19 <- ModelDFSLt1_VLC1.18[-nrow(ModelDFSLt1_VLC1.18),]
    ModelDFSLt1_VLC1.20 <- ModelDFSLt1_VLC1.19[-nrow(ModelDFSLt1_VLC1.19),]
    ModelDFSLt1_VLC1.21 <- ModelDFSLt1_VLC1.20[-nrow(ModelDFSLt1_VLC1.20),]
    ModelDFSLt1_VLC1.22 <- ModelDFSLt1_VLC1.21[-nrow(ModelDFSLt1_VLC1.21),]
    ModelDFSLt1_VLC1.23 <- ModelDFSLt1_VLC1.22[-nrow(ModelDFSLt1_VLC1.22),]
    ModelDFSLt1_VLC1.24 <- ModelDFSLt1_VLC1.23[-nrow(ModelDFSLt1_VLC1.23),]

    ModelDFSLt1_VLC1 <- ModelDFSLt1_VLC1.24 #Create model t=x+1

    #Subtract model (t=x) - (t=x+1)
    ModelDFSL1y_VLC1 <- ModelDFSLt0_VLC1 - ModelDFSLt1_VLC1

    #Re-do Month Number column because the substraction was also applied to it
    ModelDFSL1y_VLC1$MNumber <- seq(from = 1, to = SimulationLength_months)

    #This model will be called VLC1P because implies a one-off input of C
    ModelDFSL_VLC1P <- ModelDFSL1y_VLC1

    #Export the dataframe
    write_xlsx(ModelDFSL_VLC1P,"VXP_Models\\ModelDFSL_R_VLC1P.xlsx")

    #Plot 3: Interactive Yearly CO2 emissions #
    MY <- 12
    ModelDFSL_VLC1P_YCO2 <- ModelDFSL_VLC1P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VLC1)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLC1P_YCO2) <- c("Year", "Months", "AnnualCO2_VLC_1")

    #Plot 3: Interactive Yearly CO2 emissions considering a delay
    GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
    ModelDFSL_VLC1P_YCO2D <- merge(ModelDFSL_VLC1P_YCO2, GWP100delay, by = "Year")
    ModelDFSL_VLC1P_YCO2D$AnnualCO2D_VLC_1 <- ModelDFSL_VLC1P_YCO2D$AnnualCO2_VLC_1 * ModelDFSL_VLC1P_YCO2D$GWP100

    #Plot 4: Interactive Yearly C emissions #
    MY <- 12
    ModelDFSL_VLC1P_YC <- ModelDFSL_VLC1P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VLC1)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLC1P_YC) <- c("Year", "Months", "CEmissions_VLC_1")

    #Plot 5: Interactive Yearly C tails (remaining C in Soil) #
    MY <- 12
    ModelDFSL_VLC1P_YCT <- ModelDFSL_VLC1P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VLC1)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLC1P_YCT) <- c("Year", "Months", "CTail_VLC_1")

    #Save Dataframes for Plots 3.1, 3.2, 4 and 5
    write_xlsx(ModelDFSL_VLC1P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VLC1P.xlsx") #Yearly CO2 emissions (no delay)
    write_xlsx(ModelDFSL_VLC1P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VLC1P.xlsx") #Yearly CO2 emissions (delay)
    write_xlsx(ModelDFSL_VLC1P_YC,"CEmissions_P\\ModelDFSL_R_CE_VLC1P.xlsx") #Yearly C emissions
    write_xlsx(ModelDFSL_VLC1P_YCT,"CTails_P\\ModelDFSL_R_CT_VLC1P.xlsx") #Yearly C emissions



    #### 7.3 - VLC2) Litter; 20%clay; Conventional tillage ####
    #The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
    fT_VLC2=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
    fW_VLC2=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                            S.Thick = soil.thick, pClay = clay100*0.2,
                            pE = 1.0, bare = FALSE)$b #Moisture effects per month
    xi.frame_VLC2=data.frame(years,rep(fT_VLC2*fW_VLC2,length.out=length(years)))

    #To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
    Model_VLC2=SoilR::RothCModel(
      t=years, #Simulation Length
      ks=c(k.DPM = 10*CTRM, k.RPM = 0.3*CTRM, k.BIO = 0.66*CTRM, k.HUM = 0.02*CTRM, k.IOM = 0*CTRM), #Decomposition rates for the different pools
      C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
      In=Scalar_LitterCinputs*1, #Amount of litter inputs by time
      FYM = Scalar_ManureCinputs*0, #Amount of Farm Yard Manure by time
      clay=clay100*0.2, #Percent clay in mineral soil
      xi=xi.frame_VLC2) #Loads the model

    Ct_VLC2=getC(Model_VLC2) #Calculates stocks for each pool per month

    #The results can be plotted with the commands
    matplot(years, Ct_VLC2, type="l", lty=1, col=1:5,
            xlab="Time (years)", ylab="C stocks (Mg/ha)")
    legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
           lty=1, col=1:5, bty="n")

    VEC_Lit_VLC2 <- rep(M_Scalar_LitterCinputs*1, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
    VEC_Man_VLC2 <- rep(M_Scalar_ManureCinputs*0, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

    VEC_LitDF_VLC2 <- as.data.frame(VEC_Lit_VLC2) #Converting the Litter vector to a data frame
    VEC_LitDF_VLC2$MNumber <- seq(from = 1, to = SimulationLength_months)
    VEC_ManDF_VLC2 <- as.data.frame(VEC_Man_VLC2) #Converting the Manure vector to a data frame
    VEC_ManDF_VLC2$MNumber <- seq(from = 1, to = SimulationLength_months)

    sapply(VEC_LitDF_VLC2, class) #Check that class is numeric
    sapply(VEC_ManDF_VLC2, class) #Check that class is numeric
    LitterCinputs_VLC2=VEC_LitDF_VLC2   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    ManureCinputs_VLC2=VEC_ManDF_VLC2 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    MCinputs_VLC2 <- merge(LitterCinputs_VLC2, ManureCinputs_VLC2, by = "MNumber")
    MCinputs_VLC2$MInput_VLC2 <- MCinputs_VLC2$VEC_Lit_VLC2 + MCinputs_VLC2$VEC_Man_VLC2

    #Change names of litter and manure columns for more common ones
    colnames(MCinputs_VLC2)[which(names(MCinputs_VLC2) == "VEC_Lit_VLC2")] <- "LitterC_VLC2"
    colnames(MCinputs_VLC2)[which(names(MCinputs_VLC2) == "VEC_Man_VLC2")] <- "ManureC_VLC2"

    #Create a dataframe with the data considering the simulation length
    ModelDF_VLC2 <- as.data.frame(Ct_VLC2)
    colnames(ModelDF_VLC2) <- c('DPM_VLC2','RPM_VLC2','BIO_VLC2', 'HUM_VLC2', 'IOM_VLC2')
    ModelDFS_VLC2 <- ModelDF_VLC2[1:SimulationLength_months, ]

    #Create a column with the number of month of analysis
    ModelDFS_VLC2$MNumber <- seq(from = 1, to = SimulationLength_months)

    #Create a column that sums all pools
    ModelDFS_VLC2$AllPools_VLC2 <- ModelDFS_VLC2$DPM_VLC2 + ModelDFS_VLC2$RPM_VLC2 + ModelDFS_VLC2$BIO_VLC2 + ModelDFS_VLC2$HUM_VLC2 + ModelDFS_VLC2$IOM_VLC2

    #Create a column that sums all pools except IOM (static)
    ModelDFS_VLC2$AllPools_noIOM_VLC2 <- ModelDFS_VLC2$DPM_VLC2 + ModelDFS_VLC2$RPM_VLC2 + ModelDFS_VLC2$BIO_VLC2 + ModelDFS_VLC2$HUM_VLC2

    #Create a column that add the monthly input of C (manure and litter separately)
    ModelDFSL_VLC2 <- merge(ModelDFS_VLC2, MCinputs_VLC2, by = "MNumber")

    ModelDFSL_VLC2$MInput_VLC2 <- ModelDFSL_VLC2$LitterC_VLC2 + ModelDFSL_VLC2$ManureC_VLC2
    #ModelDF_SL$MInput[1] <- 0

    #Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
    ModelDFSL_VLC2$CTails_VLC2 <- ModelDFSL_VLC2$AllPools_noIOM_VLC2 + ModelDFSL_VLC2$MInput_VLC2

    #Create Monthly Accumulated input of C
    ModelDFSL_VLC2$AccumInput_VLC2 = ModelDFSL_VLC2$AccumInput_VLC2=cumsum(ModelDFSL_VLC2$MInput_VLC2)

    #Create Monthly Growths for each carbon pool
    ModelDFSL_VLC2$MGrowth_DPM_VLC2 <- ave(ModelDFSL_VLC2$DPM_VLC2, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLC2$MGrowth_RPM_VLC2 <- ave(ModelDFSL_VLC2$RPM_VLC2, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLC2$MGrowth_BIO_VLC2 <- ave(ModelDFSL_VLC2$BIO_VLC2, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLC2$MGrowth_HUM_VLC2 <- ave(ModelDFSL_VLC2$HUM_VLC2, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLC2$MGrowth_IOM_VLC2 <- ave(ModelDFSL_VLC2$IOM_VLC2, FUN = function(x) c(0, diff(x)))

    #Create column for Monthly and Accumulated C-CO2 emissions
    ModelDFSL_VLC2$M_CCO2_VLC2 <- ModelDFSL_VLC2$MInput_VLC2 - ModelDFSL_VLC2$MGrowth_DPM_VLC2 - ModelDFSL_VLC2$MGrowth_RPM_VLC2 - ModelDFSL_VLC2$MGrowth_BIO_VLC2 - ModelDFSL_VLC2$MGrowth_HUM_VLC2
    ModelDFSL_VLC2$Accum_CCO2_VLC2 <- ModelDFSL_VLC2$AccumInput_VLC2 - ModelDFSL_VLC2$AllPools_noIOM_VLC2

    #Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
    ModelDFSL_VLC2$M_CCO2_VLC2[1] <- 0
    ModelDFSL_VLC2$Accum_CCO2_VLC2[1] <- 0

    #Balance validation
    ModelDFSL_VLC2$Balance_VLC2 <- ModelDFSL_VLC2$AccumInput_VLC2 - ModelDFSL_VLC2$Accum_CCO2_VLC2 - (ModelDFSL_VLC2$DPM_VLC2 + ModelDFSL_VLC2$RPM_VLC2 + ModelDFSL_VLC2$BIO_VLC2 + ModelDFSL_VLC2$HUM_VLC2)

    #Convert C-CO2 emissions into CO2 emissions
    ModelDFSL_VLC2$M_CO2_VLC2 <- ModelDFSL_VLC2$M_CCO2_VLC2 * 44/12
    ModelDFSL_VLC2$Accum_CO2_VLC2 <- ModelDFSL_VLC2$Accum_CCO2_VLC2 * 44/12

    #This model will be called VLC2C because implies a continuous input of C
    ModelDFSL_VLC2C <- ModelDFSL_VLC2

    #Export the dataframe
    write_xlsx(ModelDFSL_VLC2C,"VXC_Models\\ModelDFSL_R_VLC2C.xlsx")

    #Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
    #Create two equal models by using the above general script
    #Create model t=x
    ModelDFSLt0_VLC2 <- ModelDFSL_VLC2 #Create model t=x

    #Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
    ModelDFSLt1_VLC2.1 <- rbind(c(0:0), ModelDFSLt0_VLC2)
    ModelDFSLt1_VLC2.2 <- rbind(c(0:0), ModelDFSLt1_VLC2.1)
    ModelDFSLt1_VLC2.3 <- rbind(c(0:0), ModelDFSLt1_VLC2.2)
    ModelDFSLt1_VLC2.4 <- rbind(c(0:0), ModelDFSLt1_VLC2.3)
    ModelDFSLt1_VLC2.5 <- rbind(c(0:0), ModelDFSLt1_VLC2.4)
    ModelDFSLt1_VLC2.6 <- rbind(c(0:0), ModelDFSLt1_VLC2.5)
    ModelDFSLt1_VLC2.7 <- rbind(c(0:0), ModelDFSLt1_VLC2.6)
    ModelDFSLt1_VLC2.8 <- rbind(c(0:0), ModelDFSLt1_VLC2.7)
    ModelDFSLt1_VLC2.9 <- rbind(c(0:0), ModelDFSLt1_VLC2.8)
    ModelDFSLt1_VLC2.10 <- rbind(c(0:0), ModelDFSLt1_VLC2.9)
    ModelDFSLt1_VLC2.11 <- rbind(c(0:0), ModelDFSLt1_VLC2.10)
    ModelDFSLt1_VLC2.12 <- rbind(c(0:0), ModelDFSLt1_VLC2.11)
    ModelDFSLt1_VLC2.13 <- ModelDFSLt1_VLC2.12[-nrow(ModelDFSLt1_VLC2.12),]
    ModelDFSLt1_VLC2.14 <- ModelDFSLt1_VLC2.13[-nrow(ModelDFSLt1_VLC2.13),]
    ModelDFSLt1_VLC2.15 <- ModelDFSLt1_VLC2.14[-nrow(ModelDFSLt1_VLC2.14),]
    ModelDFSLt1_VLC2.16 <- ModelDFSLt1_VLC2.15[-nrow(ModelDFSLt1_VLC2.15),]
    ModelDFSLt1_VLC2.17 <- ModelDFSLt1_VLC2.16[-nrow(ModelDFSLt1_VLC2.16),]
    ModelDFSLt1_VLC2.18 <- ModelDFSLt1_VLC2.17[-nrow(ModelDFSLt1_VLC2.17),]
    ModelDFSLt1_VLC2.19 <- ModelDFSLt1_VLC2.18[-nrow(ModelDFSLt1_VLC2.18),]
    ModelDFSLt1_VLC2.20 <- ModelDFSLt1_VLC2.19[-nrow(ModelDFSLt1_VLC2.19),]
    ModelDFSLt1_VLC2.21 <- ModelDFSLt1_VLC2.20[-nrow(ModelDFSLt1_VLC2.20),]
    ModelDFSLt1_VLC2.22 <- ModelDFSLt1_VLC2.21[-nrow(ModelDFSLt1_VLC2.21),]
    ModelDFSLt1_VLC2.23 <- ModelDFSLt1_VLC2.22[-nrow(ModelDFSLt1_VLC2.22),]
    ModelDFSLt1_VLC2.24 <- ModelDFSLt1_VLC2.23[-nrow(ModelDFSLt1_VLC2.23),]

    ModelDFSLt1_VLC2 <- ModelDFSLt1_VLC2.24 #Create model t=x+1

    #Subtract model (t=x) - (t=x+1)
    ModelDFSL1y_VLC2 <- ModelDFSLt0_VLC2 - ModelDFSLt1_VLC2

    #Re-do Month Number column because the substraction was also applied to it
    ModelDFSL1y_VLC2$MNumber <- seq(from = 1, to = SimulationLength_months)

    #This model will be called VLC2P because implies a one-off input of C
    ModelDFSL_VLC2P <- ModelDFSL1y_VLC2

    #Export the dataframe
    write_xlsx(ModelDFSL_VLC2P,"VXP_Models\\ModelDFSL_R_VLC2P.xlsx")

    #Plot 3: Interactive Yearly CO2 emissions #
    MY <- 12
    ModelDFSL_VLC2P_YCO2 <- ModelDFSL_VLC2P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VLC2)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLC2P_YCO2) <- c("Year", "Months", "AnnualCO2_VLC_2")

    #Plot 3: Interactive Yearly CO2 emissions considering a delay
    GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
    ModelDFSL_VLC2P_YCO2D <- merge(ModelDFSL_VLC2P_YCO2, GWP100delay, by = "Year")
    ModelDFSL_VLC2P_YCO2D$AnnualCO2D_VLC_2 <- ModelDFSL_VLC2P_YCO2D$AnnualCO2_VLC_2 * ModelDFSL_VLC2P_YCO2D$GWP100

    #Plot 4: Interactive Yearly C emissions #
    MY <- 12
    ModelDFSL_VLC2P_YC <- ModelDFSL_VLC2P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VLC2)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLC2P_YC) <- c("Year", "Months", "CEmissions_VLC_2")

    #Plot 5: Interactive Yearly C tails (remaining C in Soil) #
    MY <- 12
    ModelDFSL_VLC2P_YCT <- ModelDFSL_VLC2P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VLC2)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLC2P_YCT) <- c("Year", "Months", "CTail_VLC_2")

    #Save Dataframes for Plots 3.1, 3.2, 4 and 5
    write_xlsx(ModelDFSL_VLC2P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VLC2P.xlsx") #Yearly CO2 emissions (no delay)
    write_xlsx(ModelDFSL_VLC2P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VLC2P.xlsx") #Yearly CO2 emissions (delay)
    write_xlsx(ModelDFSL_VLC2P_YC,"CEmissions_P\\ModelDFSL_R_CE_VLC2P.xlsx") #Yearly C emissions
    write_xlsx(ModelDFSL_VLC2P_YCT,"CTails_P\\ModelDFSL_R_CT_VLC2P.xlsx") #Yearly C emissions



    #### 7.4 - VLC3) Litter; 30%clay; Conventional tillage ####
    #The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
    fT_VLC3=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
    fW_VLC3=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                            S.Thick = soil.thick, pClay = clay100*0.3,
                            pE = 1.0, bare = FALSE)$b #Moisture effects per month
    xi.frame_VLC3=data.frame(years,rep(fT_VLC3*fW_VLC3,length.out=length(years)))

    #To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
    Model_VLC3=SoilR::RothCModel(
      t=years, #Simulation Length
      ks=c(k.DPM = 10*CTRM, k.RPM = 0.3*CTRM, k.BIO = 0.66*CTRM, k.HUM = 0.02*CTRM, k.IOM = 0*CTRM), #Decomposition rates for the different pools
      C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
      In=Scalar_LitterCinputs*1, #Amount of litter inputs by time
      FYM = Scalar_ManureCinputs*0, #Amount of Farm Yard Manure by time
      clay=clay100*0.3, #Percent clay in mineral soil
      xi=xi.frame_VLC3) #Loads the model

    Ct_VLC3=getC(Model_VLC3) #Calculates stocks for each pool per month

    #The results can be plotted with the commands
    matplot(years, Ct_VLC3, type="l", lty=1, col=1:5,
            xlab="Time (years)", ylab="C stocks (Mg/ha)")
    legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
           lty=1, col=1:5, bty="n")

    VEC_Lit_VLC3 <- rep(M_Scalar_LitterCinputs*1, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
    VEC_Man_VLC3 <- rep(M_Scalar_ManureCinputs*0, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

    VEC_LitDF_VLC3 <- as.data.frame(VEC_Lit_VLC3) #Converting the Litter vector to a data frame
    VEC_LitDF_VLC3$MNumber <- seq(from = 1, to = SimulationLength_months)
    VEC_ManDF_VLC3 <- as.data.frame(VEC_Man_VLC3) #Converting the Manure vector to a data frame
    VEC_ManDF_VLC3$MNumber <- seq(from = 1, to = SimulationLength_months)

    sapply(VEC_LitDF_VLC3, class) #Check that class is numeric
    sapply(VEC_ManDF_VLC3, class) #Check that class is numeric
    LitterCinputs_VLC3=VEC_LitDF_VLC3   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    ManureCinputs_VLC3=VEC_ManDF_VLC3 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    MCinputs_VLC3 <- merge(LitterCinputs_VLC3, ManureCinputs_VLC3, by = "MNumber")
    MCinputs_VLC3$MInput_VLC3 <- MCinputs_VLC3$VEC_Lit_VLC3 + MCinputs_VLC3$VEC_Man_VLC3

    #Change names of litter and manure columns for more common ones
    colnames(MCinputs_VLC3)[which(names(MCinputs_VLC3) == "VEC_Lit_VLC3")] <- "LitterC_VLC3"
    colnames(MCinputs_VLC3)[which(names(MCinputs_VLC3) == "VEC_Man_VLC3")] <- "ManureC_VLC3"

    #Create a dataframe with the data considering the simulation length
    ModelDF_VLC3 <- as.data.frame(Ct_VLC3)
    colnames(ModelDF_VLC3) <- c('DPM_VLC3','RPM_VLC3','BIO_VLC3', 'HUM_VLC3', 'IOM_VLC3')
    ModelDFS_VLC3 <- ModelDF_VLC3[1:SimulationLength_months, ]

    #Create a column with the number of month of analysis
    ModelDFS_VLC3$MNumber <- seq(from = 1, to = SimulationLength_months)

    #Create a column that sums all pools
    ModelDFS_VLC3$AllPools_VLC3 <- ModelDFS_VLC3$DPM_VLC3 + ModelDFS_VLC3$RPM_VLC3 + ModelDFS_VLC3$BIO_VLC3 + ModelDFS_VLC3$HUM_VLC3 + ModelDFS_VLC3$IOM_VLC3

    #Create a column that sums all pools except IOM (static)
    ModelDFS_VLC3$AllPools_noIOM_VLC3 <- ModelDFS_VLC3$DPM_VLC3 + ModelDFS_VLC3$RPM_VLC3 + ModelDFS_VLC3$BIO_VLC3 + ModelDFS_VLC3$HUM_VLC3

    #Create a column that add the monthly input of C (manure and litter separately)
    ModelDFSL_VLC3 <- merge(ModelDFS_VLC3, MCinputs_VLC3, by = "MNumber")

    ModelDFSL_VLC3$MInput_VLC3 <- ModelDFSL_VLC3$LitterC_VLC3 + ModelDFSL_VLC3$ManureC_VLC3
    #ModelDF_SL$MInput[1] <- 0

    #Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
    ModelDFSL_VLC3$CTails_VLC3 <- ModelDFSL_VLC3$AllPools_noIOM_VLC3 + ModelDFSL_VLC3$MInput_VLC3

    #Create Monthly Accumulated input of C
    ModelDFSL_VLC3$AccumInput_VLC3 = ModelDFSL_VLC3$AccumInput_VLC3=cumsum(ModelDFSL_VLC3$MInput_VLC3)

    #Create Monthly Growths for each carbon pool
    ModelDFSL_VLC3$MGrowth_DPM_VLC3 <- ave(ModelDFSL_VLC3$DPM_VLC3, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLC3$MGrowth_RPM_VLC3 <- ave(ModelDFSL_VLC3$RPM_VLC3, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLC3$MGrowth_BIO_VLC3 <- ave(ModelDFSL_VLC3$BIO_VLC3, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLC3$MGrowth_HUM_VLC3 <- ave(ModelDFSL_VLC3$HUM_VLC3, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLC3$MGrowth_IOM_VLC3 <- ave(ModelDFSL_VLC3$IOM_VLC3, FUN = function(x) c(0, diff(x)))

    #Create column for Monthly and Accumulated C-CO2 emissions
    ModelDFSL_VLC3$M_CCO2_VLC3 <- ModelDFSL_VLC3$MInput_VLC3 - ModelDFSL_VLC3$MGrowth_DPM_VLC3 - ModelDFSL_VLC3$MGrowth_RPM_VLC3 - ModelDFSL_VLC3$MGrowth_BIO_VLC3 - ModelDFSL_VLC3$MGrowth_HUM_VLC3
    ModelDFSL_VLC3$Accum_CCO2_VLC3 <- ModelDFSL_VLC3$AccumInput_VLC3 - ModelDFSL_VLC3$AllPools_noIOM_VLC3

    #Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
    ModelDFSL_VLC3$M_CCO2_VLC3[1] <- 0
    ModelDFSL_VLC3$Accum_CCO2_VLC3[1] <- 0

    #Balance validation
    ModelDFSL_VLC3$Balance_VLC3 <- ModelDFSL_VLC3$AccumInput_VLC3 - ModelDFSL_VLC3$Accum_CCO2_VLC3 - (ModelDFSL_VLC3$DPM_VLC3 + ModelDFSL_VLC3$RPM_VLC3 + ModelDFSL_VLC3$BIO_VLC3 + ModelDFSL_VLC3$HUM_VLC3)

    #Convert C-CO2 emissions into CO2 emissions
    ModelDFSL_VLC3$M_CO2_VLC3 <- ModelDFSL_VLC3$M_CCO2_VLC3 * 44/12
    ModelDFSL_VLC3$Accum_CO2_VLC3 <- ModelDFSL_VLC3$Accum_CCO2_VLC3 * 44/12

    #This model will be called VLC3C because implies a continuous input of C
    ModelDFSL_VLC3C <- ModelDFSL_VLC3

    #Export the dataframe
    write_xlsx(ModelDFSL_VLC3C,"VXC_Models\\ModelDFSL_R_VLC3C.xlsx")

    #Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
    #Create two equal models by using the above general script
    #Create model t=x
    ModelDFSLt0_VLC3 <- ModelDFSL_VLC3 #Create model t=x

    #Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
    ModelDFSLt1_VLC3.1 <- rbind(c(0:0), ModelDFSLt0_VLC3)
    ModelDFSLt1_VLC3.2 <- rbind(c(0:0), ModelDFSLt1_VLC3.1)
    ModelDFSLt1_VLC3.3 <- rbind(c(0:0), ModelDFSLt1_VLC3.2)
    ModelDFSLt1_VLC3.4 <- rbind(c(0:0), ModelDFSLt1_VLC3.3)
    ModelDFSLt1_VLC3.5 <- rbind(c(0:0), ModelDFSLt1_VLC3.4)
    ModelDFSLt1_VLC3.6 <- rbind(c(0:0), ModelDFSLt1_VLC3.5)
    ModelDFSLt1_VLC3.7 <- rbind(c(0:0), ModelDFSLt1_VLC3.6)
    ModelDFSLt1_VLC3.8 <- rbind(c(0:0), ModelDFSLt1_VLC3.7)
    ModelDFSLt1_VLC3.9 <- rbind(c(0:0), ModelDFSLt1_VLC3.8)
    ModelDFSLt1_VLC3.10 <- rbind(c(0:0), ModelDFSLt1_VLC3.9)
    ModelDFSLt1_VLC3.11 <- rbind(c(0:0), ModelDFSLt1_VLC3.10)
    ModelDFSLt1_VLC3.12 <- rbind(c(0:0), ModelDFSLt1_VLC3.11)
    ModelDFSLt1_VLC3.13 <- ModelDFSLt1_VLC3.12[-nrow(ModelDFSLt1_VLC3.12),]
    ModelDFSLt1_VLC3.14 <- ModelDFSLt1_VLC3.13[-nrow(ModelDFSLt1_VLC3.13),]
    ModelDFSLt1_VLC3.15 <- ModelDFSLt1_VLC3.14[-nrow(ModelDFSLt1_VLC3.14),]
    ModelDFSLt1_VLC3.16 <- ModelDFSLt1_VLC3.15[-nrow(ModelDFSLt1_VLC3.15),]
    ModelDFSLt1_VLC3.17 <- ModelDFSLt1_VLC3.16[-nrow(ModelDFSLt1_VLC3.16),]
    ModelDFSLt1_VLC3.18 <- ModelDFSLt1_VLC3.17[-nrow(ModelDFSLt1_VLC3.17),]
    ModelDFSLt1_VLC3.19 <- ModelDFSLt1_VLC3.18[-nrow(ModelDFSLt1_VLC3.18),]
    ModelDFSLt1_VLC3.20 <- ModelDFSLt1_VLC3.19[-nrow(ModelDFSLt1_VLC3.19),]
    ModelDFSLt1_VLC3.21 <- ModelDFSLt1_VLC3.20[-nrow(ModelDFSLt1_VLC3.20),]
    ModelDFSLt1_VLC3.22 <- ModelDFSLt1_VLC3.21[-nrow(ModelDFSLt1_VLC3.21),]
    ModelDFSLt1_VLC3.23 <- ModelDFSLt1_VLC3.22[-nrow(ModelDFSLt1_VLC3.22),]
    ModelDFSLt1_VLC3.24 <- ModelDFSLt1_VLC3.23[-nrow(ModelDFSLt1_VLC3.23),]

    ModelDFSLt1_VLC3 <- ModelDFSLt1_VLC3.24 #Create model t=x+1

    #Subtract model (t=x) - (t=x+1)
    ModelDFSL1y_VLC3 <- ModelDFSLt0_VLC3 - ModelDFSLt1_VLC3

    #Re-do Month Number column because the substraction was also applied to it
    ModelDFSL1y_VLC3$MNumber <- seq(from = 1, to = SimulationLength_months)

    #This model will be called VLC3P because implies a one-off input of C
    ModelDFSL_VLC3P <- ModelDFSL1y_VLC3

    #Export the dataframe
    write_xlsx(ModelDFSL_VLC3P,"VXP_Models\\ModelDFSL_R_VLC3P.xlsx")

    #Plot 3: Interactive Yearly CO2 emissions #
    MY <- 12
    ModelDFSL_VLC3P_YCO2 <- ModelDFSL_VLC3P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VLC3)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLC3P_YCO2) <- c("Year", "Months", "AnnualCO2_VLC_3")

    #Plot 3: Interactive Yearly CO2 emissions considering a delay
    GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
    ModelDFSL_VLC3P_YCO2D <- merge(ModelDFSL_VLC3P_YCO2, GWP100delay, by = "Year")
    ModelDFSL_VLC3P_YCO2D$AnnualCO2D_VLC_3 <- ModelDFSL_VLC3P_YCO2D$AnnualCO2_VLC_3 * ModelDFSL_VLC3P_YCO2D$GWP100

    #Plot 4: Interactive Yearly C emissions #
    MY <- 12
    ModelDFSL_VLC3P_YC <- ModelDFSL_VLC3P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VLC3)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLC3P_YC) <- c("Year", "Months", "CEmissions_VLC_3")

    #Plot 5: Interactive Yearly C tails (remaining C in Soil) #
    MY <- 12
    ModelDFSL_VLC3P_YCT <- ModelDFSL_VLC3P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VLC3)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLC3P_YCT) <- c("Year", "Months", "CTail_VLC_3")

    #Save Dataframes for Plots 3.1, 3.2, 4 and 5
    write_xlsx(ModelDFSL_VLC3P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VLC3P.xlsx") #Yearly CO2 emissions (no delay)
    write_xlsx(ModelDFSL_VLC3P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VLC3P.xlsx") #Yearly CO2 emissions (delay)
    write_xlsx(ModelDFSL_VLC3P_YC,"CEmissions_P\\ModelDFSL_R_CE_VLC3P.xlsx") #Yearly C emissions
    write_xlsx(ModelDFSL_VLC3P_YCT,"CTails_P\\ModelDFSL_R_CT_VLC3P.xlsx") #Yearly C emissions



    #### 7.5 - VLC4) Litter; 40%clay; Conventional tillage ####
    #The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
    fT_VLC4=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
    fW_VLC4=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                            S.Thick = soil.thick, pClay = clay100*0.4,
                            pE = 1.0, bare = FALSE)$b #Moisture effects per month
    xi.frame_VLC4=data.frame(years,rep(fT_VLC4*fW_VLC4,length.out=length(years)))

    #To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
    Model_VLC4=SoilR::RothCModel(
      t=years, #Simulation Length
      ks=c(k.DPM = 10*CTRM, k.RPM = 0.3*CTRM, k.BIO = 0.66*CTRM, k.HUM = 0.02*CTRM, k.IOM = 0*CTRM), #Decomposition rates for the different pools
      C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
      In=Scalar_LitterCinputs*1, #Amount of litter inputs by time
      FYM = Scalar_ManureCinputs*0, #Amount of Farm Yard Manure by time
      clay=clay100*0.4, #Percent clay in mineral soil
      xi=xi.frame_VLC4) #Loads the model

    Ct_VLC4=getC(Model_VLC4) #Calculates stocks for each pool per month

    #The results can be plotted with the commands
    matplot(years, Ct_VLC4, type="l", lty=1, col=1:5,
            xlab="Time (years)", ylab="C stocks (Mg/ha)")
    legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
           lty=1, col=1:5, bty="n")

    VEC_Lit_VLC4 <- rep(M_Scalar_LitterCinputs*1, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
    VEC_Man_VLC4 <- rep(M_Scalar_ManureCinputs*0, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

    VEC_LitDF_VLC4 <- as.data.frame(VEC_Lit_VLC4) #Converting the Litter vector to a data frame
    VEC_LitDF_VLC4$MNumber <- seq(from = 1, to = SimulationLength_months)
    VEC_ManDF_VLC4 <- as.data.frame(VEC_Man_VLC4) #Converting the Manure vector to a data frame
    VEC_ManDF_VLC4$MNumber <- seq(from = 1, to = SimulationLength_months)

    sapply(VEC_LitDF_VLC4, class) #Check that class is numeric
    sapply(VEC_ManDF_VLC4, class) #Check that class is numeric
    LitterCinputs_VLC4=VEC_LitDF_VLC4   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    ManureCinputs_VLC4=VEC_ManDF_VLC4 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    MCinputs_VLC4 <- merge(LitterCinputs_VLC4, ManureCinputs_VLC4, by = "MNumber")
    MCinputs_VLC4$MInput_VLC4 <- MCinputs_VLC4$VEC_Lit_VLC4 + MCinputs_VLC4$VEC_Man_VLC4

    #Change names of litter and manure columns for more common ones
    colnames(MCinputs_VLC4)[which(names(MCinputs_VLC4) == "VEC_Lit_VLC4")] <- "LitterC_VLC4"
    colnames(MCinputs_VLC4)[which(names(MCinputs_VLC4) == "VEC_Man_VLC4")] <- "ManureC_VLC4"

    #Create a dataframe with the data considering the simulation length
    ModelDF_VLC4 <- as.data.frame(Ct_VLC4)
    colnames(ModelDF_VLC4) <- c('DPM_VLC4','RPM_VLC4','BIO_VLC4', 'HUM_VLC4', 'IOM_VLC4')
    ModelDFS_VLC4 <- ModelDF_VLC4[1:SimulationLength_months, ]

    #Create a column with the number of month of analysis
    ModelDFS_VLC4$MNumber <- seq(from = 1, to = SimulationLength_months)

    #Create a column that sums all pools
    ModelDFS_VLC4$AllPools_VLC4 <- ModelDFS_VLC4$DPM_VLC4 + ModelDFS_VLC4$RPM_VLC4 + ModelDFS_VLC4$BIO_VLC4 + ModelDFS_VLC4$HUM_VLC4 + ModelDFS_VLC4$IOM_VLC4

    #Create a column that sums all pools except IOM (static)
    ModelDFS_VLC4$AllPools_noIOM_VLC4 <- ModelDFS_VLC4$DPM_VLC4 + ModelDFS_VLC4$RPM_VLC4 + ModelDFS_VLC4$BIO_VLC4 + ModelDFS_VLC4$HUM_VLC4

    #Create a column that add the monthly input of C (manure and litter separately)
    ModelDFSL_VLC4 <- merge(ModelDFS_VLC4, MCinputs_VLC4, by = "MNumber")

    ModelDFSL_VLC4$MInput_VLC4 <- ModelDFSL_VLC4$LitterC_VLC4 + ModelDFSL_VLC4$ManureC_VLC4
    #ModelDF_SL$MInput[1] <- 0

    #Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
    ModelDFSL_VLC4$CTails_VLC4 <- ModelDFSL_VLC4$AllPools_noIOM_VLC4 + ModelDFSL_VLC4$MInput_VLC4

    #Create Monthly Accumulated input of C
    ModelDFSL_VLC4$AccumInput_VLC4 = ModelDFSL_VLC4$AccumInput_VLC4=cumsum(ModelDFSL_VLC4$MInput_VLC4)

    #Create Monthly Growths for each carbon pool
    ModelDFSL_VLC4$MGrowth_DPM_VLC4 <- ave(ModelDFSL_VLC4$DPM_VLC4, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLC4$MGrowth_RPM_VLC4 <- ave(ModelDFSL_VLC4$RPM_VLC4, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLC4$MGrowth_BIO_VLC4 <- ave(ModelDFSL_VLC4$BIO_VLC4, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLC4$MGrowth_HUM_VLC4 <- ave(ModelDFSL_VLC4$HUM_VLC4, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLC4$MGrowth_IOM_VLC4 <- ave(ModelDFSL_VLC4$IOM_VLC4, FUN = function(x) c(0, diff(x)))

    #Create column for Monthly and Accumulated C-CO2 emissions
    ModelDFSL_VLC4$M_CCO2_VLC4 <- ModelDFSL_VLC4$MInput_VLC4 - ModelDFSL_VLC4$MGrowth_DPM_VLC4 - ModelDFSL_VLC4$MGrowth_RPM_VLC4 - ModelDFSL_VLC4$MGrowth_BIO_VLC4 - ModelDFSL_VLC4$MGrowth_HUM_VLC4
    ModelDFSL_VLC4$Accum_CCO2_VLC4 <- ModelDFSL_VLC4$AccumInput_VLC4 - ModelDFSL_VLC4$AllPools_noIOM_VLC4

    #Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
    ModelDFSL_VLC4$M_CCO2_VLC4[1] <- 0
    ModelDFSL_VLC4$Accum_CCO2_VLC4[1] <- 0

    #Balance validation
    ModelDFSL_VLC4$Balance_VLC4 <- ModelDFSL_VLC4$AccumInput_VLC4 - ModelDFSL_VLC4$Accum_CCO2_VLC4 - (ModelDFSL_VLC4$DPM_VLC4 + ModelDFSL_VLC4$RPM_VLC4 + ModelDFSL_VLC4$BIO_VLC4 + ModelDFSL_VLC4$HUM_VLC4)

    #Convert C-CO2 emissions into CO2 emissions
    ModelDFSL_VLC4$M_CO2_VLC4 <- ModelDFSL_VLC4$M_CCO2_VLC4 * 44/12
    ModelDFSL_VLC4$Accum_CO2_VLC4 <- ModelDFSL_VLC4$Accum_CCO2_VLC4 * 44/12

    #This model will be called VLC4C because implies a continuous input of C
    ModelDFSL_VLC4C <- ModelDFSL_VLC4

    #Export the dataframe
    write_xlsx(ModelDFSL_VLC4C,"VXC_Models\\ModelDFSL_R_VLC4C.xlsx")

    #Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
    #Create two equal models by using the above general script
    #Create model t=x
    ModelDFSLt0_VLC4 <- ModelDFSL_VLC4 #Create model t=x

    #Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
    ModelDFSLt1_VLC4.1 <- rbind(c(0:0), ModelDFSLt0_VLC4)
    ModelDFSLt1_VLC4.2 <- rbind(c(0:0), ModelDFSLt1_VLC4.1)
    ModelDFSLt1_VLC4.3 <- rbind(c(0:0), ModelDFSLt1_VLC4.2)
    ModelDFSLt1_VLC4.4 <- rbind(c(0:0), ModelDFSLt1_VLC4.3)
    ModelDFSLt1_VLC4.5 <- rbind(c(0:0), ModelDFSLt1_VLC4.4)
    ModelDFSLt1_VLC4.6 <- rbind(c(0:0), ModelDFSLt1_VLC4.5)
    ModelDFSLt1_VLC4.7 <- rbind(c(0:0), ModelDFSLt1_VLC4.6)
    ModelDFSLt1_VLC4.8 <- rbind(c(0:0), ModelDFSLt1_VLC4.7)
    ModelDFSLt1_VLC4.9 <- rbind(c(0:0), ModelDFSLt1_VLC4.8)
    ModelDFSLt1_VLC4.10 <- rbind(c(0:0), ModelDFSLt1_VLC4.9)
    ModelDFSLt1_VLC4.11 <- rbind(c(0:0), ModelDFSLt1_VLC4.10)
    ModelDFSLt1_VLC4.12 <- rbind(c(0:0), ModelDFSLt1_VLC4.11)
    ModelDFSLt1_VLC4.13 <- ModelDFSLt1_VLC4.12[-nrow(ModelDFSLt1_VLC4.12),]
    ModelDFSLt1_VLC4.14 <- ModelDFSLt1_VLC4.13[-nrow(ModelDFSLt1_VLC4.13),]
    ModelDFSLt1_VLC4.15 <- ModelDFSLt1_VLC4.14[-nrow(ModelDFSLt1_VLC4.14),]
    ModelDFSLt1_VLC4.16 <- ModelDFSLt1_VLC4.15[-nrow(ModelDFSLt1_VLC4.15),]
    ModelDFSLt1_VLC4.17 <- ModelDFSLt1_VLC4.16[-nrow(ModelDFSLt1_VLC4.16),]
    ModelDFSLt1_VLC4.18 <- ModelDFSLt1_VLC4.17[-nrow(ModelDFSLt1_VLC4.17),]
    ModelDFSLt1_VLC4.19 <- ModelDFSLt1_VLC4.18[-nrow(ModelDFSLt1_VLC4.18),]
    ModelDFSLt1_VLC4.20 <- ModelDFSLt1_VLC4.19[-nrow(ModelDFSLt1_VLC4.19),]
    ModelDFSLt1_VLC4.21 <- ModelDFSLt1_VLC4.20[-nrow(ModelDFSLt1_VLC4.20),]
    ModelDFSLt1_VLC4.22 <- ModelDFSLt1_VLC4.21[-nrow(ModelDFSLt1_VLC4.21),]
    ModelDFSLt1_VLC4.23 <- ModelDFSLt1_VLC4.22[-nrow(ModelDFSLt1_VLC4.22),]
    ModelDFSLt1_VLC4.24 <- ModelDFSLt1_VLC4.23[-nrow(ModelDFSLt1_VLC4.23),]

    ModelDFSLt1_VLC4 <- ModelDFSLt1_VLC4.24 #Create model t=x+1

    #Subtract model (t=x) - (t=x+1)
    ModelDFSL1y_VLC4 <- ModelDFSLt0_VLC4 - ModelDFSLt1_VLC4

    #Re-do Month Number column because the substraction was also applied to it
    ModelDFSL1y_VLC4$MNumber <- seq(from = 1, to = SimulationLength_months)

    #This model will be called VLC4P because implies a one-off input of C
    ModelDFSL_VLC4P <- ModelDFSL1y_VLC4

    #Export the dataframe
    write_xlsx(ModelDFSL_VLC4P,"VXP_Models\\ModelDFSL_R_VLC4P.xlsx")

    #Plot 3: Interactive Yearly CO2 emissions #
    MY <- 12
    ModelDFSL_VLC4P_YCO2 <- ModelDFSL_VLC4P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VLC4)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLC4P_YCO2) <- c("Year", "Months", "AnnualCO2_VLC_4")

    #Plot 3: Interactive Yearly CO2 emissions considering a delay
    GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
    ModelDFSL_VLC4P_YCO2D <- merge(ModelDFSL_VLC4P_YCO2, GWP100delay, by = "Year")
    ModelDFSL_VLC4P_YCO2D$AnnualCO2D_VLC_4 <- ModelDFSL_VLC4P_YCO2D$AnnualCO2_VLC_4 * ModelDFSL_VLC4P_YCO2D$GWP100

    #Plot 4: Interactive Yearly C emissions #
    MY <- 12
    ModelDFSL_VLC4P_YC <- ModelDFSL_VLC4P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VLC4)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLC4P_YC) <- c("Year", "Months", "CEmissions_VLC_4")

    #Plot 5: Interactive Yearly C tails (remaining C in Soil) #
    MY <- 12
    ModelDFSL_VLC4P_YCT <- ModelDFSL_VLC4P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VLC4)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLC4P_YCT) <- c("Year", "Months", "CTail_VLC_4")

    #Save Dataframes for Plots 3.1, 3.2, 4 and 5
    write_xlsx(ModelDFSL_VLC4P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VLC4P.xlsx") #Yearly CO2 emissions (no delay)
    write_xlsx(ModelDFSL_VLC4P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VLC4P.xlsx") #Yearly CO2 emissions (delay)
    write_xlsx(ModelDFSL_VLC4P_YC,"CEmissions_P\\ModelDFSL_R_CE_VLC4P.xlsx") #Yearly C emissions
    write_xlsx(ModelDFSL_VLC4P_YCT,"CTails_P\\ModelDFSL_R_CT_VLC4P.xlsx") #Yearly C emissions



    #### 7.6 - VLC5) Litter; 50%clay; Conventional tillage ####
    #The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
    fT_VLC5=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
    fW_VLC5=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                            S.Thick = soil.thick, pClay = clay100*0.5,
                            pE = 1.0, bare = FALSE)$b #Moisture effects per month
    xi.frame_VLC5=data.frame(years,rep(fT_VLC5*fW_VLC5,length.out=length(years)))

    #To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
    Model_VLC5=SoilR::RothCModel(
      t=years, #Simulation Length
      ks=c(k.DPM = 10*CTRM, k.RPM = 0.3*CTRM, k.BIO = 0.66*CTRM, k.HUM = 0.02*CTRM, k.IOM = 0*CTRM), #Decomposition rates for the different pools
      C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
      In=Scalar_LitterCinputs*1, #Amount of litter inputs by time
      FYM = Scalar_ManureCinputs*0, #Amount of Farm Yard Manure by time
      clay=clay100*0.5, #Percent clay in mineral soil
      xi=xi.frame_VLC5) #Loads the model

    Ct_VLC5=getC(Model_VLC5) #Calculates stocks for each pool per month

    #The results can be plotted with the commands
    matplot(years, Ct_VLC5, type="l", lty=1, col=1:5,
            xlab="Time (years)", ylab="C stocks (Mg/ha)")
    legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
           lty=1, col=1:5, bty="n")

    VEC_Lit_VLC5 <- rep(M_Scalar_LitterCinputs*1, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
    VEC_Man_VLC5 <- rep(M_Scalar_ManureCinputs*0, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

    VEC_LitDF_VLC5 <- as.data.frame(VEC_Lit_VLC5) #Converting the Litter vector to a data frame
    VEC_LitDF_VLC5$MNumber <- seq(from = 1, to = SimulationLength_months)
    VEC_ManDF_VLC5 <- as.data.frame(VEC_Man_VLC5) #Converting the Manure vector to a data frame
    VEC_ManDF_VLC5$MNumber <- seq(from = 1, to = SimulationLength_months)

    sapply(VEC_LitDF_VLC5, class) #Check that class is numeric
    sapply(VEC_ManDF_VLC5, class) #Check that class is numeric
    LitterCinputs_VLC5=VEC_LitDF_VLC5   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    ManureCinputs_VLC5=VEC_ManDF_VLC5 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    MCinputs_VLC5 <- merge(LitterCinputs_VLC5, ManureCinputs_VLC5, by = "MNumber")
    MCinputs_VLC5$MInput_VLC5 <- MCinputs_VLC5$VEC_Lit_VLC5 + MCinputs_VLC5$VEC_Man_VLC5

    #Change names of litter and manure columns for more common ones
    colnames(MCinputs_VLC5)[which(names(MCinputs_VLC5) == "VEC_Lit_VLC5")] <- "LitterC_VLC5"
    colnames(MCinputs_VLC5)[which(names(MCinputs_VLC5) == "VEC_Man_VLC5")] <- "ManureC_VLC5"

    #Create a dataframe with the data considering the simulation length
    ModelDF_VLC5 <- as.data.frame(Ct_VLC5)
    colnames(ModelDF_VLC5) <- c('DPM_VLC5','RPM_VLC5','BIO_VLC5', 'HUM_VLC5', 'IOM_VLC5')
    ModelDFS_VLC5 <- ModelDF_VLC5[1:SimulationLength_months, ]

    #Create a column with the number of month of analysis
    ModelDFS_VLC5$MNumber <- seq(from = 1, to = SimulationLength_months)

    #Create a column that sums all pools
    ModelDFS_VLC5$AllPools_VLC5 <- ModelDFS_VLC5$DPM_VLC5 + ModelDFS_VLC5$RPM_VLC5 + ModelDFS_VLC5$BIO_VLC5 + ModelDFS_VLC5$HUM_VLC5 + ModelDFS_VLC5$IOM_VLC5

    #Create a column that sums all pools except IOM (static)
    ModelDFS_VLC5$AllPools_noIOM_VLC5 <- ModelDFS_VLC5$DPM_VLC5 + ModelDFS_VLC5$RPM_VLC5 + ModelDFS_VLC5$BIO_VLC5 + ModelDFS_VLC5$HUM_VLC5

    #Create a column that add the monthly input of C (manure and litter separately)
    ModelDFSL_VLC5 <- merge(ModelDFS_VLC5, MCinputs_VLC5, by = "MNumber")

    ModelDFSL_VLC5$MInput_VLC5 <- ModelDFSL_VLC5$LitterC_VLC5 + ModelDFSL_VLC5$ManureC_VLC5
    #ModelDF_SL$MInput[1] <- 0

    #Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
    ModelDFSL_VLC5$CTails_VLC5 <- ModelDFSL_VLC5$AllPools_noIOM_VLC5 + ModelDFSL_VLC5$MInput_VLC5

    #Create Monthly Accumulated input of C
    ModelDFSL_VLC5$AccumInput_VLC5 = ModelDFSL_VLC5$AccumInput_VLC5=cumsum(ModelDFSL_VLC5$MInput_VLC5)

    #Create Monthly Growths for each carbon pool
    ModelDFSL_VLC5$MGrowth_DPM_VLC5 <- ave(ModelDFSL_VLC5$DPM_VLC5, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLC5$MGrowth_RPM_VLC5 <- ave(ModelDFSL_VLC5$RPM_VLC5, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLC5$MGrowth_BIO_VLC5 <- ave(ModelDFSL_VLC5$BIO_VLC5, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLC5$MGrowth_HUM_VLC5 <- ave(ModelDFSL_VLC5$HUM_VLC5, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLC5$MGrowth_IOM_VLC5 <- ave(ModelDFSL_VLC5$IOM_VLC5, FUN = function(x) c(0, diff(x)))

    #Create column for Monthly and Accumulated C-CO2 emissions
    ModelDFSL_VLC5$M_CCO2_VLC5 <- ModelDFSL_VLC5$MInput_VLC5 - ModelDFSL_VLC5$MGrowth_DPM_VLC5 - ModelDFSL_VLC5$MGrowth_RPM_VLC5 - ModelDFSL_VLC5$MGrowth_BIO_VLC5 - ModelDFSL_VLC5$MGrowth_HUM_VLC5
    ModelDFSL_VLC5$Accum_CCO2_VLC5 <- ModelDFSL_VLC5$AccumInput_VLC5 - ModelDFSL_VLC5$AllPools_noIOM_VLC5

    #Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
    ModelDFSL_VLC5$M_CCO2_VLC5[1] <- 0
    ModelDFSL_VLC5$Accum_CCO2_VLC5[1] <- 0

    #Balance validation
    ModelDFSL_VLC5$Balance_VLC5 <- ModelDFSL_VLC5$AccumInput_VLC5 - ModelDFSL_VLC5$Accum_CCO2_VLC5 - (ModelDFSL_VLC5$DPM_VLC5 + ModelDFSL_VLC5$RPM_VLC5 + ModelDFSL_VLC5$BIO_VLC5 + ModelDFSL_VLC5$HUM_VLC5)

    #Convert C-CO2 emissions into CO2 emissions
    ModelDFSL_VLC5$M_CO2_VLC5 <- ModelDFSL_VLC5$M_CCO2_VLC5 * 44/12
    ModelDFSL_VLC5$Accum_CO2_VLC5 <- ModelDFSL_VLC5$Accum_CCO2_VLC5 * 44/12

    #This model will be called VLC5C because implies a continuous input of C
    ModelDFSL_VLC5C <- ModelDFSL_VLC5

    #Export the dataframe
    write_xlsx(ModelDFSL_VLC5C,"VXC_Models\\ModelDFSL_R_VLC5C.xlsx")

    #Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
    #Create two equal models by using the above general script
    #Create model t=x
    ModelDFSLt0_VLC5 <- ModelDFSL_VLC5 #Create model t=x

    #Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
    ModelDFSLt1_VLC5.1 <- rbind(c(0:0), ModelDFSLt0_VLC5)
    ModelDFSLt1_VLC5.2 <- rbind(c(0:0), ModelDFSLt1_VLC5.1)
    ModelDFSLt1_VLC5.3 <- rbind(c(0:0), ModelDFSLt1_VLC5.2)
    ModelDFSLt1_VLC5.4 <- rbind(c(0:0), ModelDFSLt1_VLC5.3)
    ModelDFSLt1_VLC5.5 <- rbind(c(0:0), ModelDFSLt1_VLC5.4)
    ModelDFSLt1_VLC5.6 <- rbind(c(0:0), ModelDFSLt1_VLC5.5)
    ModelDFSLt1_VLC5.7 <- rbind(c(0:0), ModelDFSLt1_VLC5.6)
    ModelDFSLt1_VLC5.8 <- rbind(c(0:0), ModelDFSLt1_VLC5.7)
    ModelDFSLt1_VLC5.9 <- rbind(c(0:0), ModelDFSLt1_VLC5.8)
    ModelDFSLt1_VLC5.10 <- rbind(c(0:0), ModelDFSLt1_VLC5.9)
    ModelDFSLt1_VLC5.11 <- rbind(c(0:0), ModelDFSLt1_VLC5.10)
    ModelDFSLt1_VLC5.12 <- rbind(c(0:0), ModelDFSLt1_VLC5.11)
    ModelDFSLt1_VLC5.13 <- ModelDFSLt1_VLC5.12[-nrow(ModelDFSLt1_VLC5.12),]
    ModelDFSLt1_VLC5.14 <- ModelDFSLt1_VLC5.13[-nrow(ModelDFSLt1_VLC5.13),]
    ModelDFSLt1_VLC5.15 <- ModelDFSLt1_VLC5.14[-nrow(ModelDFSLt1_VLC5.14),]
    ModelDFSLt1_VLC5.16 <- ModelDFSLt1_VLC5.15[-nrow(ModelDFSLt1_VLC5.15),]
    ModelDFSLt1_VLC5.17 <- ModelDFSLt1_VLC5.16[-nrow(ModelDFSLt1_VLC5.16),]
    ModelDFSLt1_VLC5.18 <- ModelDFSLt1_VLC5.17[-nrow(ModelDFSLt1_VLC5.17),]
    ModelDFSLt1_VLC5.19 <- ModelDFSLt1_VLC5.18[-nrow(ModelDFSLt1_VLC5.18),]
    ModelDFSLt1_VLC5.20 <- ModelDFSLt1_VLC5.19[-nrow(ModelDFSLt1_VLC5.19),]
    ModelDFSLt1_VLC5.21 <- ModelDFSLt1_VLC5.20[-nrow(ModelDFSLt1_VLC5.20),]
    ModelDFSLt1_VLC5.22 <- ModelDFSLt1_VLC5.21[-nrow(ModelDFSLt1_VLC5.21),]
    ModelDFSLt1_VLC5.23 <- ModelDFSLt1_VLC5.22[-nrow(ModelDFSLt1_VLC5.22),]
    ModelDFSLt1_VLC5.24 <- ModelDFSLt1_VLC5.23[-nrow(ModelDFSLt1_VLC5.23),]

    ModelDFSLt1_VLC5 <- ModelDFSLt1_VLC5.24 #Create model t=x+1

    #Subtract model (t=x) - (t=x+1)
    ModelDFSL1y_VLC5 <- ModelDFSLt0_VLC5 - ModelDFSLt1_VLC5

    #Re-do Month Number column because the substraction was also applied to it
    ModelDFSL1y_VLC5$MNumber <- seq(from = 1, to = SimulationLength_months)

    #This model will be called VLC5P because implies a one-off input of C
    ModelDFSL_VLC5P <- ModelDFSL1y_VLC5

    #Export the dataframe
    write_xlsx(ModelDFSL_VLC5P,"VXP_Models\\ModelDFSL_R_VLC5P.xlsx")


    #Plot 3: Interactive Yearly CO2 emissions #
    MY <- 12
    ModelDFSL_VLC5P_YCO2 <- ModelDFSL_VLC5P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VLC5)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLC5P_YCO2) <- c("Year", "Months", "AnnualCO2_VLC_5")


    #Plot 3: Interactive Yearly CO2 emissions considering a delay
    GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
    ModelDFSL_VLC5P_YCO2D <- merge(ModelDFSL_VLC5P_YCO2, GWP100delay, by = "Year")
    ModelDFSL_VLC5P_YCO2D$AnnualCO2D_VLC_5 <- ModelDFSL_VLC5P_YCO2D$AnnualCO2_VLC_5 * ModelDFSL_VLC5P_YCO2D$GWP100

    #Plot 4: Interactive Yearly C emissions #
    MY <- 12
    ModelDFSL_VLC5P_YC <- ModelDFSL_VLC5P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VLC5)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLC5P_YC) <- c("Year", "Months", "CEmissions_VLC_5")


    #Plot 5: Interactive Yearly C tails (remaining C in Soil) #
    MY <- 12
    ModelDFSL_VLC5P_YCT <- ModelDFSL_VLC5P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VLC5)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLC5P_YCT) <- c("Year", "Months", "CTail_VLC_5")

    #Save Dataframes for Plots 3.1, 3.2, 4 and 5
    write_xlsx(ModelDFSL_VLC5P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VLC5P.xlsx") #Yearly CO2 emissions (no delay)
    write_xlsx(ModelDFSL_VLC5P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VLC5P.xlsx") #Yearly CO2 emissions (delay)
    write_xlsx(ModelDFSL_VLC5P_YC,"CEmissions_P\\ModelDFSL_R_CE_VLC5P.xlsx") #Yearly C emissions
    write_xlsx(ModelDFSL_VLC5P_YCT,"CTails_P\\ModelDFSL_R_CT_VLC5P.xlsx") #Yearly C emissions



    #### 7.7 - VLC6) Litter; 60%clay; Conventional tillage ####
    #The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
    fT_VLC6=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
    fW_VLC6=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                            S.Thick = soil.thick, pClay = clay100*0.6,
                            pE = 1.0, bare = FALSE)$b #Moisture effects per month
    xi.frame_VLC6=data.frame(years,rep(fT_VLC6*fW_VLC6,length.out=length(years)))

    #To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
    Model_VLC6=SoilR::RothCModel(
      t=years, #Simulation Length
      ks=c(k.DPM = 10*CTRM, k.RPM = 0.3*CTRM, k.BIO = 0.66*CTRM, k.HUM = 0.02*CTRM, k.IOM = 0*CTRM), #Decomposition rates for the different pools
      C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
      In=Scalar_LitterCinputs*1, #Amount of litter inputs by time
      FYM = Scalar_ManureCinputs*0, #Amount of Farm Yard Manure by time
      clay=clay100*0.6, #Percent clay in mineral soil
      xi=xi.frame_VLC6) #Loads the model

    Ct_VLC6=getC(Model_VLC6) #Calculates stocks for each pool per month

    #The results can be plotted with the commands
    matplot(years, Ct_VLC6, type="l", lty=1, col=1:5,
            xlab="Time (years)", ylab="C stocks (Mg/ha)")
    legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
           lty=1, col=1:5, bty="n")

    VEC_Lit_VLC6 <- rep(M_Scalar_LitterCinputs*1, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
    VEC_Man_VLC6 <- rep(M_Scalar_ManureCinputs*0, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

    VEC_LitDF_VLC6 <- as.data.frame(VEC_Lit_VLC6) #Converting the Litter vector to a data frame
    VEC_LitDF_VLC6$MNumber <- seq(from = 1, to = SimulationLength_months)
    VEC_ManDF_VLC6 <- as.data.frame(VEC_Man_VLC6) #Converting the Manure vector to a data frame
    VEC_ManDF_VLC6$MNumber <- seq(from = 1, to = SimulationLength_months)

    sapply(VEC_LitDF_VLC6, class) #Check that class is numeric
    sapply(VEC_ManDF_VLC6, class) #Check that class is numeric
    LitterCinputs_VLC6=VEC_LitDF_VLC6   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    ManureCinputs_VLC6=VEC_ManDF_VLC6 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    MCinputs_VLC6 <- merge(LitterCinputs_VLC6, ManureCinputs_VLC6, by = "MNumber")
    MCinputs_VLC6$MInput_VLC6 <- MCinputs_VLC6$VEC_Lit_VLC6 + MCinputs_VLC6$VEC_Man_VLC6

    #Change names of litter and manure columns for more common ones
    colnames(MCinputs_VLC6)[which(names(MCinputs_VLC6) == "VEC_Lit_VLC6")] <- "LitterC_VLC6"
    colnames(MCinputs_VLC6)[which(names(MCinputs_VLC6) == "VEC_Man_VLC6")] <- "ManureC_VLC6"

    #Create a dataframe with the data considering the simulation length
    ModelDF_VLC6 <- as.data.frame(Ct_VLC6)
    colnames(ModelDF_VLC6) <- c('DPM_VLC6','RPM_VLC6','BIO_VLC6', 'HUM_VLC6', 'IOM_VLC6')
    ModelDFS_VLC6 <- ModelDF_VLC6[1:SimulationLength_months, ]

    #Create a column with the number of month of analysis
    ModelDFS_VLC6$MNumber <- seq(from = 1, to = SimulationLength_months)

    #Create a column that sums all pools
    ModelDFS_VLC6$AllPools_VLC6 <- ModelDFS_VLC6$DPM_VLC6 + ModelDFS_VLC6$RPM_VLC6 + ModelDFS_VLC6$BIO_VLC6 + ModelDFS_VLC6$HUM_VLC6 + ModelDFS_VLC6$IOM_VLC6

    #Create a column that sums all pools except IOM (static)
    ModelDFS_VLC6$AllPools_noIOM_VLC6 <- ModelDFS_VLC6$DPM_VLC6 + ModelDFS_VLC6$RPM_VLC6 + ModelDFS_VLC6$BIO_VLC6 + ModelDFS_VLC6$HUM_VLC6

    #Create a column that add the monthly input of C (manure and litter separately)
    ModelDFSL_VLC6 <- merge(ModelDFS_VLC6, MCinputs_VLC6, by = "MNumber")

    ModelDFSL_VLC6$MInput_VLC6 <- ModelDFSL_VLC6$LitterC_VLC6 + ModelDFSL_VLC6$ManureC_VLC6
    #ModelDF_SL$MInput[1] <- 0

    #Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
    ModelDFSL_VLC6$CTails_VLC6 <- ModelDFSL_VLC6$AllPools_noIOM_VLC6 + ModelDFSL_VLC6$MInput_VLC6

    #Create Monthly Accumulated input of C
    ModelDFSL_VLC6$AccumInput_VLC6 = ModelDFSL_VLC6$AccumInput_VLC6=cumsum(ModelDFSL_VLC6$MInput_VLC6)

    #Create Monthly Growths for each carbon pool
    ModelDFSL_VLC6$MGrowth_DPM_VLC6 <- ave(ModelDFSL_VLC6$DPM_VLC6, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLC6$MGrowth_RPM_VLC6 <- ave(ModelDFSL_VLC6$RPM_VLC6, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLC6$MGrowth_BIO_VLC6 <- ave(ModelDFSL_VLC6$BIO_VLC6, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLC6$MGrowth_HUM_VLC6 <- ave(ModelDFSL_VLC6$HUM_VLC6, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLC6$MGrowth_IOM_VLC6 <- ave(ModelDFSL_VLC6$IOM_VLC6, FUN = function(x) c(0, diff(x)))

    #Create column for Monthly and Accumulated C-CO2 emissions
    ModelDFSL_VLC6$M_CCO2_VLC6 <- ModelDFSL_VLC6$MInput_VLC6 - ModelDFSL_VLC6$MGrowth_DPM_VLC6 - ModelDFSL_VLC6$MGrowth_RPM_VLC6 - ModelDFSL_VLC6$MGrowth_BIO_VLC6 - ModelDFSL_VLC6$MGrowth_HUM_VLC6
    ModelDFSL_VLC6$Accum_CCO2_VLC6 <- ModelDFSL_VLC6$AccumInput_VLC6 - ModelDFSL_VLC6$AllPools_noIOM_VLC6

    #Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
    ModelDFSL_VLC6$M_CCO2_VLC6[1] <- 0
    ModelDFSL_VLC6$Accum_CCO2_VLC6[1] <- 0

    #Balance validation
    ModelDFSL_VLC6$Balance_VLC6 <- ModelDFSL_VLC6$AccumInput_VLC6 - ModelDFSL_VLC6$Accum_CCO2_VLC6 - (ModelDFSL_VLC6$DPM_VLC6 + ModelDFSL_VLC6$RPM_VLC6 + ModelDFSL_VLC6$BIO_VLC6 + ModelDFSL_VLC6$HUM_VLC6)

    #Convert C-CO2 emissions into CO2 emissions
    ModelDFSL_VLC6$M_CO2_VLC6 <- ModelDFSL_VLC6$M_CCO2_VLC6 * 44/12
    ModelDFSL_VLC6$Accum_CO2_VLC6 <- ModelDFSL_VLC6$Accum_CCO2_VLC6 * 44/12

    #This model will be called VLC6C because implies a continuous input of C
    ModelDFSL_VLC6C <- ModelDFSL_VLC6

    #Export the dataframe
    write_xlsx(ModelDFSL_VLC6C,"VXC_Models\\ModelDFSL_R_VLC6C.xlsx")

    #Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
    #Create two equal models by using the above general script
    #Create model t=x
    ModelDFSLt0_VLC6 <- ModelDFSL_VLC6 #Create model t=x

    #Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
    ModelDFSLt1_VLC6.1 <- rbind(c(0:0), ModelDFSLt0_VLC6)
    ModelDFSLt1_VLC6.2 <- rbind(c(0:0), ModelDFSLt1_VLC6.1)
    ModelDFSLt1_VLC6.3 <- rbind(c(0:0), ModelDFSLt1_VLC6.2)
    ModelDFSLt1_VLC6.4 <- rbind(c(0:0), ModelDFSLt1_VLC6.3)
    ModelDFSLt1_VLC6.5 <- rbind(c(0:0), ModelDFSLt1_VLC6.4)
    ModelDFSLt1_VLC6.6 <- rbind(c(0:0), ModelDFSLt1_VLC6.5)
    ModelDFSLt1_VLC6.7 <- rbind(c(0:0), ModelDFSLt1_VLC6.6)
    ModelDFSLt1_VLC6.8 <- rbind(c(0:0), ModelDFSLt1_VLC6.7)
    ModelDFSLt1_VLC6.9 <- rbind(c(0:0), ModelDFSLt1_VLC6.8)
    ModelDFSLt1_VLC6.10 <- rbind(c(0:0), ModelDFSLt1_VLC6.9)
    ModelDFSLt1_VLC6.11 <- rbind(c(0:0), ModelDFSLt1_VLC6.10)
    ModelDFSLt1_VLC6.12 <- rbind(c(0:0), ModelDFSLt1_VLC6.11)
    ModelDFSLt1_VLC6.13 <- ModelDFSLt1_VLC6.12[-nrow(ModelDFSLt1_VLC6.12),]
    ModelDFSLt1_VLC6.14 <- ModelDFSLt1_VLC6.13[-nrow(ModelDFSLt1_VLC6.13),]
    ModelDFSLt1_VLC6.15 <- ModelDFSLt1_VLC6.14[-nrow(ModelDFSLt1_VLC6.14),]
    ModelDFSLt1_VLC6.16 <- ModelDFSLt1_VLC6.15[-nrow(ModelDFSLt1_VLC6.15),]
    ModelDFSLt1_VLC6.17 <- ModelDFSLt1_VLC6.16[-nrow(ModelDFSLt1_VLC6.16),]
    ModelDFSLt1_VLC6.18 <- ModelDFSLt1_VLC6.17[-nrow(ModelDFSLt1_VLC6.17),]
    ModelDFSLt1_VLC6.19 <- ModelDFSLt1_VLC6.18[-nrow(ModelDFSLt1_VLC6.18),]
    ModelDFSLt1_VLC6.20 <- ModelDFSLt1_VLC6.19[-nrow(ModelDFSLt1_VLC6.19),]
    ModelDFSLt1_VLC6.21 <- ModelDFSLt1_VLC6.20[-nrow(ModelDFSLt1_VLC6.20),]
    ModelDFSLt1_VLC6.22 <- ModelDFSLt1_VLC6.21[-nrow(ModelDFSLt1_VLC6.21),]
    ModelDFSLt1_VLC6.23 <- ModelDFSLt1_VLC6.22[-nrow(ModelDFSLt1_VLC6.22),]
    ModelDFSLt1_VLC6.24 <- ModelDFSLt1_VLC6.23[-nrow(ModelDFSLt1_VLC6.23),]

    ModelDFSLt1_VLC6 <- ModelDFSLt1_VLC6.24 #Create model t=x+1

    #Subtract model (t=x) - (t=x+1)
    ModelDFSL1y_VLC6 <- ModelDFSLt0_VLC6 - ModelDFSLt1_VLC6

    #Re-do Month Number column because the substraction was also applied to it
    ModelDFSL1y_VLC6$MNumber <- seq(from = 1, to = SimulationLength_months)

    #This model will be called VLC6P because implies a one-off input of C
    ModelDFSL_VLC6P <- ModelDFSL1y_VLC6

    #Export the dataframe
    write_xlsx(ModelDFSL_VLC6P,"VXP_Models\\ModelDFSL_R_VLC6P.xlsx")

    #Plot 3: Interactive Yearly CO2 emissions #
    MY <- 12
    ModelDFSL_VLC6P_YCO2 <- ModelDFSL_VLC6P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VLC6)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLC6P_YCO2) <- c("Year", "Months", "AnnualCO2_VLC_6")


    #Plot 3: Interactive Yearly CO2 emissions considering a delay
    GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
    ModelDFSL_VLC6P_YCO2D <- merge(ModelDFSL_VLC6P_YCO2, GWP100delay, by = "Year")
    ModelDFSL_VLC6P_YCO2D$AnnualCO2D_VLC_6 <- ModelDFSL_VLC6P_YCO2D$AnnualCO2_VLC_6 * ModelDFSL_VLC6P_YCO2D$GWP100

    #Plot 4: Interactive Yearly C emissions #
    MY <- 12
    ModelDFSL_VLC6P_YC <- ModelDFSL_VLC6P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VLC6)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLC6P_YC) <- c("Year", "Months", "CEmissions_VLC_6")


    #Plot 5: Interactive Yearly C tails (remaining C in Soil) #
    MY <- 12
    ModelDFSL_VLC6P_YCT <- ModelDFSL_VLC6P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VLC6)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLC6P_YCT) <- c("Year", "Months", "CTail_VLC_6")

    #Save Dataframes for Plots 3.1, 3.2, 4 and 5
    write_xlsx(ModelDFSL_VLC6P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VLC6P.xlsx") #Yearly CO2 emissions (no delay)
    write_xlsx(ModelDFSL_VLC6P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VLC6P.xlsx") #Yearly CO2 emissions (delay)
    write_xlsx(ModelDFSL_VLC6P_YC,"CEmissions_P\\ModelDFSL_R_CE_VLC6P.xlsx") #Yearly C emissions
    write_xlsx(ModelDFSL_VLC6P_YCT,"CTails_P\\ModelDFSL_R_CT_VLC6P.xlsx") #Yearly C emissions



    #### 7.8 - VLC7) Litter; 70%clay; Conventional tillage ####
    #The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
    fT_VLC7=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
    fW_VLC7=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                            S.Thick = soil.thick, pClay = clay100*0.7,
                            pE = 1.0, bare = FALSE)$b #Moisture effects per month
    xi.frame_VLC7=data.frame(years,rep(fT_VLC7*fW_VLC7,length.out=length(years)))

    #To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
    Model_VLC7=SoilR::RothCModel(
      t=years, #Simulation Length
      ks=c(k.DPM = 10*CTRM, k.RPM = 0.3*CTRM, k.BIO = 0.66*CTRM, k.HUM = 0.02*CTRM, k.IOM = 0*CTRM), #Decomposition rates for the different pools
      C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
      In=Scalar_LitterCinputs*1, #Amount of litter inputs by time
      FYM = Scalar_ManureCinputs*0, #Amount of Farm Yard Manure by time
      clay=clay100*0.7, #Percent clay in mineral soil
      xi=xi.frame_VLC7) #Loads the model

    Ct_VLC7=getC(Model_VLC7) #Calculates stocks for each pool per month

    #The results can be plotted with the commands
    matplot(years, Ct_VLC7, type="l", lty=1, col=1:5,
            xlab="Time (years)", ylab="C stocks (Mg/ha)")
    legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
           lty=1, col=1:5, bty="n")

    VEC_Lit_VLC7 <- rep(M_Scalar_LitterCinputs*1, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
    VEC_Man_VLC7 <- rep(M_Scalar_ManureCinputs*0, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

    VEC_LitDF_VLC7 <- as.data.frame(VEC_Lit_VLC7) #Converting the Litter vector to a data frame
    VEC_LitDF_VLC7$MNumber <- seq(from = 1, to = SimulationLength_months)
    VEC_ManDF_VLC7 <- as.data.frame(VEC_Man_VLC7) #Converting the Manure vector to a data frame
    VEC_ManDF_VLC7$MNumber <- seq(from = 1, to = SimulationLength_months)

    sapply(VEC_LitDF_VLC7, class) #Check that class is numeric
    sapply(VEC_ManDF_VLC7, class) #Check that class is numeric
    LitterCinputs_VLC7=VEC_LitDF_VLC7   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    ManureCinputs_VLC7=VEC_ManDF_VLC7 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    MCinputs_VLC7 <- merge(LitterCinputs_VLC7, ManureCinputs_VLC7, by = "MNumber")
    MCinputs_VLC7$MInput_VLC7 <- MCinputs_VLC7$VEC_Lit_VLC7 + MCinputs_VLC7$VEC_Man_VLC7

    #Change names of litter and manure columns for more common ones
    colnames(MCinputs_VLC7)[which(names(MCinputs_VLC7) == "VEC_Lit_VLC7")] <- "LitterC_VLC7"
    colnames(MCinputs_VLC7)[which(names(MCinputs_VLC7) == "VEC_Man_VLC7")] <- "ManureC_VLC7"

    #Create a dataframe with the data considering the simulation length
    ModelDF_VLC7 <- as.data.frame(Ct_VLC7)
    colnames(ModelDF_VLC7) <- c('DPM_VLC7','RPM_VLC7','BIO_VLC7', 'HUM_VLC7', 'IOM_VLC7')
    ModelDFS_VLC7 <- ModelDF_VLC7[1:SimulationLength_months, ]

    #Create a column with the number of month of analysis
    ModelDFS_VLC7$MNumber <- seq(from = 1, to = SimulationLength_months)

    #Create a column that sums all pools
    ModelDFS_VLC7$AllPools_VLC7 <- ModelDFS_VLC7$DPM_VLC7 + ModelDFS_VLC7$RPM_VLC7 + ModelDFS_VLC7$BIO_VLC7 + ModelDFS_VLC7$HUM_VLC7 + ModelDFS_VLC7$IOM_VLC7

    #Create a column that sums all pools except IOM (static)
    ModelDFS_VLC7$AllPools_noIOM_VLC7 <- ModelDFS_VLC7$DPM_VLC7 + ModelDFS_VLC7$RPM_VLC7 + ModelDFS_VLC7$BIO_VLC7 + ModelDFS_VLC7$HUM_VLC7

    #Create a column that add the monthly input of C (manure and litter separately)
    ModelDFSL_VLC7 <- merge(ModelDFS_VLC7, MCinputs_VLC7, by = "MNumber")

    ModelDFSL_VLC7$MInput_VLC7 <- ModelDFSL_VLC7$LitterC_VLC7 + ModelDFSL_VLC7$ManureC_VLC7
    #ModelDF_SL$MInput[1] <- 0

    #Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
    ModelDFSL_VLC7$CTails_VLC7 <- ModelDFSL_VLC7$AllPools_noIOM_VLC7 + ModelDFSL_VLC7$MInput_VLC7

    #Create Monthly Accumulated input of C
    ModelDFSL_VLC7$AccumInput_VLC7 = ModelDFSL_VLC7$AccumInput_VLC7=cumsum(ModelDFSL_VLC7$MInput_VLC7)

    #Create Monthly Growths for each carbon pool
    ModelDFSL_VLC7$MGrowth_DPM_VLC7 <- ave(ModelDFSL_VLC7$DPM_VLC7, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLC7$MGrowth_RPM_VLC7 <- ave(ModelDFSL_VLC7$RPM_VLC7, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLC7$MGrowth_BIO_VLC7 <- ave(ModelDFSL_VLC7$BIO_VLC7, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLC7$MGrowth_HUM_VLC7 <- ave(ModelDFSL_VLC7$HUM_VLC7, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLC7$MGrowth_IOM_VLC7 <- ave(ModelDFSL_VLC7$IOM_VLC7, FUN = function(x) c(0, diff(x)))

    #Create column for Monthly and Accumulated C-CO2 emissions
    ModelDFSL_VLC7$M_CCO2_VLC7 <- ModelDFSL_VLC7$MInput_VLC7 - ModelDFSL_VLC7$MGrowth_DPM_VLC7 - ModelDFSL_VLC7$MGrowth_RPM_VLC7 - ModelDFSL_VLC7$MGrowth_BIO_VLC7 - ModelDFSL_VLC7$MGrowth_HUM_VLC7
    ModelDFSL_VLC7$Accum_CCO2_VLC7 <- ModelDFSL_VLC7$AccumInput_VLC7 - ModelDFSL_VLC7$AllPools_noIOM_VLC7

    #Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
    ModelDFSL_VLC7$M_CCO2_VLC7[1] <- 0
    ModelDFSL_VLC7$Accum_CCO2_VLC7[1] <- 0

    #Balance validation
    ModelDFSL_VLC7$Balance_VLC7 <- ModelDFSL_VLC7$AccumInput_VLC7 - ModelDFSL_VLC7$Accum_CCO2_VLC7 - (ModelDFSL_VLC7$DPM_VLC7 + ModelDFSL_VLC7$RPM_VLC7 + ModelDFSL_VLC7$BIO_VLC7 + ModelDFSL_VLC7$HUM_VLC7)

    #Convert C-CO2 emissions into CO2 emissions
    ModelDFSL_VLC7$M_CO2_VLC7 <- ModelDFSL_VLC7$M_CCO2_VLC7 * 44/12
    ModelDFSL_VLC7$Accum_CO2_VLC7 <- ModelDFSL_VLC7$Accum_CCO2_VLC7 * 44/12

    #This model will be called VLC7C because implies a continuous input of C
    ModelDFSL_VLC7C <- ModelDFSL_VLC7

    #Export the dataframe
    write_xlsx(ModelDFSL_VLC7C,"VXC_Models\\ModelDFSL_R_VLC7C.xlsx")

    #Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
    #Create two equal models by using the above general script
    #Create model t=x
    ModelDFSLt0_VLC7 <- ModelDFSL_VLC7 #Create model t=x

    #Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
    ModelDFSLt1_VLC7.1 <- rbind(c(0:0), ModelDFSLt0_VLC7)
    ModelDFSLt1_VLC7.2 <- rbind(c(0:0), ModelDFSLt1_VLC7.1)
    ModelDFSLt1_VLC7.3 <- rbind(c(0:0), ModelDFSLt1_VLC7.2)
    ModelDFSLt1_VLC7.4 <- rbind(c(0:0), ModelDFSLt1_VLC7.3)
    ModelDFSLt1_VLC7.5 <- rbind(c(0:0), ModelDFSLt1_VLC7.4)
    ModelDFSLt1_VLC7.6 <- rbind(c(0:0), ModelDFSLt1_VLC7.5)
    ModelDFSLt1_VLC7.7 <- rbind(c(0:0), ModelDFSLt1_VLC7.6)
    ModelDFSLt1_VLC7.8 <- rbind(c(0:0), ModelDFSLt1_VLC7.7)
    ModelDFSLt1_VLC7.9 <- rbind(c(0:0), ModelDFSLt1_VLC7.8)
    ModelDFSLt1_VLC7.10 <- rbind(c(0:0), ModelDFSLt1_VLC7.9)
    ModelDFSLt1_VLC7.11 <- rbind(c(0:0), ModelDFSLt1_VLC7.10)
    ModelDFSLt1_VLC7.12 <- rbind(c(0:0), ModelDFSLt1_VLC7.11)
    ModelDFSLt1_VLC7.13 <- ModelDFSLt1_VLC7.12[-nrow(ModelDFSLt1_VLC7.12),]
    ModelDFSLt1_VLC7.14 <- ModelDFSLt1_VLC7.13[-nrow(ModelDFSLt1_VLC7.13),]
    ModelDFSLt1_VLC7.15 <- ModelDFSLt1_VLC7.14[-nrow(ModelDFSLt1_VLC7.14),]
    ModelDFSLt1_VLC7.16 <- ModelDFSLt1_VLC7.15[-nrow(ModelDFSLt1_VLC7.15),]
    ModelDFSLt1_VLC7.17 <- ModelDFSLt1_VLC7.16[-nrow(ModelDFSLt1_VLC7.16),]
    ModelDFSLt1_VLC7.18 <- ModelDFSLt1_VLC7.17[-nrow(ModelDFSLt1_VLC7.17),]
    ModelDFSLt1_VLC7.19 <- ModelDFSLt1_VLC7.18[-nrow(ModelDFSLt1_VLC7.18),]
    ModelDFSLt1_VLC7.20 <- ModelDFSLt1_VLC7.19[-nrow(ModelDFSLt1_VLC7.19),]
    ModelDFSLt1_VLC7.21 <- ModelDFSLt1_VLC7.20[-nrow(ModelDFSLt1_VLC7.20),]
    ModelDFSLt1_VLC7.22 <- ModelDFSLt1_VLC7.21[-nrow(ModelDFSLt1_VLC7.21),]
    ModelDFSLt1_VLC7.23 <- ModelDFSLt1_VLC7.22[-nrow(ModelDFSLt1_VLC7.22),]
    ModelDFSLt1_VLC7.24 <- ModelDFSLt1_VLC7.23[-nrow(ModelDFSLt1_VLC7.23),]

    ModelDFSLt1_VLC7 <- ModelDFSLt1_VLC7.24 #Create model t=x+1

    #Subtract model (t=x) - (t=x+1)
    ModelDFSL1y_VLC7 <- ModelDFSLt0_VLC7 - ModelDFSLt1_VLC7

    #Re-do Month Number column because the substraction was also applied to it
    ModelDFSL1y_VLC7$MNumber <- seq(from = 1, to = SimulationLength_months)

    #This model will be called VLC7P because implies a one-off input of C
    ModelDFSL_VLC7P <- ModelDFSL1y_VLC7

    #Export the dataframe
    write_xlsx(ModelDFSL_VLC7P,"VXP_Models\\ModelDFSL_R_VLC7P.xlsx")

    #Plot 3: Interactive Yearly CO2 emissions #
    MY <- 12
    ModelDFSL_VLC7P_YCO2 <- ModelDFSL_VLC7P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VLC7)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLC7P_YCO2) <- c("Year", "Months", "AnnualCO2_VLC_7")


    #Plot 3: Interactive Yearly CO2 emissions considering a delay
    GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
    ModelDFSL_VLC7P_YCO2D <- merge(ModelDFSL_VLC7P_YCO2, GWP100delay, by = "Year")
    ModelDFSL_VLC7P_YCO2D$AnnualCO2D_VLC_7 <- ModelDFSL_VLC7P_YCO2D$AnnualCO2_VLC_7 * ModelDFSL_VLC7P_YCO2D$GWP100

    #Plot 4: Interactive Yearly C emissions #
    MY <- 12
    ModelDFSL_VLC7P_YC <- ModelDFSL_VLC7P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VLC7)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLC7P_YC) <- c("Year", "Months", "CEmissions_VLC_7")


    #Plot 5: Interactive Yearly C tails (remaining C in Soil) #
    MY <- 12
    ModelDFSL_VLC7P_YCT <- ModelDFSL_VLC7P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VLC7)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLC7P_YCT) <- c("Year", "Months", "CTail_VLC_7")


    #Save Dataframes for Plots 3.1, 3.2, 4 and 5
    write_xlsx(ModelDFSL_VLC7P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VLC7P.xlsx") #Yearly CO2 emissions (no delay)
    write_xlsx(ModelDFSL_VLC7P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VLC7P.xlsx") #Yearly CO2 emissions (delay)
    write_xlsx(ModelDFSL_VLC7P_YC,"CEmissions_P\\ModelDFSL_R_CE_VLC7P.xlsx") #Yearly C emissions
    write_xlsx(ModelDFSL_VLC7P_YCT,"CTails_P\\ModelDFSL_R_CT_VLC7P.xlsx") #Yearly C emissions



    #### 7.9 - VLC8) Litter; 80%clay; Conventional tillage ####
    #The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
    fT_VLC8=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
    fW_VLC8=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                            S.Thick = soil.thick, pClay = clay100*0.8,
                            pE = 1.0, bare = FALSE)$b #Moisture effects per month
    xi.frame_VLC8=data.frame(years,rep(fT_VLC8*fW_VLC8,length.out=length(years)))

    #To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
    Model_VLC8=SoilR::RothCModel(
      t=years, #Simulation Length
      ks=c(k.DPM = 10*CTRM, k.RPM = 0.3*CTRM, k.BIO = 0.66*CTRM, k.HUM = 0.02*CTRM, k.IOM = 0*CTRM), #Decomposition rates for the different pools
      C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
      In=Scalar_LitterCinputs*1, #Amount of litter inputs by time
      FYM = Scalar_ManureCinputs*0, #Amount of Farm Yard Manure by time
      clay=clay100*0.8, #Percent clay in mineral soil
      xi=xi.frame_VLC8) #Loads the model

    Ct_VLC8=getC(Model_VLC8) #Calculates stocks for each pool per month

    #The results can be plotted with the commands
    matplot(years, Ct_VLC8, type="l", lty=1, col=1:5,
            xlab="Time (years)", ylab="C stocks (Mg/ha)")
    legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
           lty=1, col=1:5, bty="n")

    VEC_Lit_VLC8 <- rep(M_Scalar_LitterCinputs*1, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
    VEC_Man_VLC8 <- rep(M_Scalar_ManureCinputs*0, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

    VEC_LitDF_VLC8 <- as.data.frame(VEC_Lit_VLC8) #Converting the Litter vector to a data frame
    VEC_LitDF_VLC8$MNumber <- seq(from = 1, to = SimulationLength_months)
    VEC_ManDF_VLC8 <- as.data.frame(VEC_Man_VLC8) #Converting the Manure vector to a data frame
    VEC_ManDF_VLC8$MNumber <- seq(from = 1, to = SimulationLength_months)

    sapply(VEC_LitDF_VLC8, class) #Check that class is numeric
    sapply(VEC_ManDF_VLC8, class) #Check that class is numeric
    LitterCinputs_VLC8=VEC_LitDF_VLC8   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    ManureCinputs_VLC8=VEC_ManDF_VLC8 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    MCinputs_VLC8 <- merge(LitterCinputs_VLC8, ManureCinputs_VLC8, by = "MNumber")
    MCinputs_VLC8$MInput_VLC8 <- MCinputs_VLC8$VEC_Lit_VLC8 + MCinputs_VLC8$VEC_Man_VLC8

    #Change names of litter and manure columns for more common ones
    colnames(MCinputs_VLC8)[which(names(MCinputs_VLC8) == "VEC_Lit_VLC8")] <- "LitterC_VLC8"
    colnames(MCinputs_VLC8)[which(names(MCinputs_VLC8) == "VEC_Man_VLC8")] <- "ManureC_VLC8"

    #Create a dataframe with the data considering the simulation length
    ModelDF_VLC8 <- as.data.frame(Ct_VLC8)
    colnames(ModelDF_VLC8) <- c('DPM_VLC8','RPM_VLC8','BIO_VLC8', 'HUM_VLC8', 'IOM_VLC8')
    ModelDFS_VLC8 <- ModelDF_VLC8[1:SimulationLength_months, ]

    #Create a column with the number of month of analysis
    ModelDFS_VLC8$MNumber <- seq(from = 1, to = SimulationLength_months)

    #Create a column that sums all pools
    ModelDFS_VLC8$AllPools_VLC8 <- ModelDFS_VLC8$DPM_VLC8 + ModelDFS_VLC8$RPM_VLC8 + ModelDFS_VLC8$BIO_VLC8 + ModelDFS_VLC8$HUM_VLC8 + ModelDFS_VLC8$IOM_VLC8

    #Create a column that sums all pools except IOM (static)
    ModelDFS_VLC8$AllPools_noIOM_VLC8 <- ModelDFS_VLC8$DPM_VLC8 + ModelDFS_VLC8$RPM_VLC8 + ModelDFS_VLC8$BIO_VLC8 + ModelDFS_VLC8$HUM_VLC8

    #Create a column that add the monthly input of C (manure and litter separately)
    ModelDFSL_VLC8 <- merge(ModelDFS_VLC8, MCinputs_VLC8, by = "MNumber")

    ModelDFSL_VLC8$MInput_VLC8 <- ModelDFSL_VLC8$LitterC_VLC8 + ModelDFSL_VLC8$ManureC_VLC8
    #ModelDF_SL$MInput[1] <- 0

    #Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
    ModelDFSL_VLC8$CTails_VLC8 <- ModelDFSL_VLC8$AllPools_noIOM_VLC8 + ModelDFSL_VLC8$MInput_VLC8

    #Create Monthly Accumulated input of C
    ModelDFSL_VLC8$AccumInput_VLC8 = ModelDFSL_VLC8$AccumInput_VLC8=cumsum(ModelDFSL_VLC8$MInput_VLC8)

    #Create Monthly Growths for each carbon pool
    ModelDFSL_VLC8$MGrowth_DPM_VLC8 <- ave(ModelDFSL_VLC8$DPM_VLC8, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLC8$MGrowth_RPM_VLC8 <- ave(ModelDFSL_VLC8$RPM_VLC8, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLC8$MGrowth_BIO_VLC8 <- ave(ModelDFSL_VLC8$BIO_VLC8, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLC8$MGrowth_HUM_VLC8 <- ave(ModelDFSL_VLC8$HUM_VLC8, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLC8$MGrowth_IOM_VLC8 <- ave(ModelDFSL_VLC8$IOM_VLC8, FUN = function(x) c(0, diff(x)))

    #Create column for Monthly and Accumulated C-CO2 emissions
    ModelDFSL_VLC8$M_CCO2_VLC8 <- ModelDFSL_VLC8$MInput_VLC8 - ModelDFSL_VLC8$MGrowth_DPM_VLC8 - ModelDFSL_VLC8$MGrowth_RPM_VLC8 - ModelDFSL_VLC8$MGrowth_BIO_VLC8 - ModelDFSL_VLC8$MGrowth_HUM_VLC8
    ModelDFSL_VLC8$Accum_CCO2_VLC8 <- ModelDFSL_VLC8$AccumInput_VLC8 - ModelDFSL_VLC8$AllPools_noIOM_VLC8

    #Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
    ModelDFSL_VLC8$M_CCO2_VLC8[1] <- 0
    ModelDFSL_VLC8$Accum_CCO2_VLC8[1] <- 0

    #Balance validation
    ModelDFSL_VLC8$Balance_VLC8 <- ModelDFSL_VLC8$AccumInput_VLC8 - ModelDFSL_VLC8$Accum_CCO2_VLC8 - (ModelDFSL_VLC8$DPM_VLC8 + ModelDFSL_VLC8$RPM_VLC8 + ModelDFSL_VLC8$BIO_VLC8 + ModelDFSL_VLC8$HUM_VLC8)

    #Convert C-CO2 emissions into CO2 emissions
    ModelDFSL_VLC8$M_CO2_VLC8 <- ModelDFSL_VLC8$M_CCO2_VLC8 * 44/12
    ModelDFSL_VLC8$Accum_CO2_VLC8 <- ModelDFSL_VLC8$Accum_CCO2_VLC8 * 44/12

    #This model will be called VLC8C because implies a continuous input of C
    ModelDFSL_VLC8C <- ModelDFSL_VLC8

    #Export the dataframe
    write_xlsx(ModelDFSL_VLC8C,"VXC_Models\\ModelDFSL_R_VLC8C.xlsx")

    #Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
    #Create two equal models by using the above general script
    #Create model t=x
    ModelDFSLt0_VLC8 <- ModelDFSL_VLC8 #Create model t=x

    #Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
    ModelDFSLt1_VLC8.1 <- rbind(c(0:0), ModelDFSLt0_VLC8)
    ModelDFSLt1_VLC8.2 <- rbind(c(0:0), ModelDFSLt1_VLC8.1)
    ModelDFSLt1_VLC8.3 <- rbind(c(0:0), ModelDFSLt1_VLC8.2)
    ModelDFSLt1_VLC8.4 <- rbind(c(0:0), ModelDFSLt1_VLC8.3)
    ModelDFSLt1_VLC8.5 <- rbind(c(0:0), ModelDFSLt1_VLC8.4)
    ModelDFSLt1_VLC8.6 <- rbind(c(0:0), ModelDFSLt1_VLC8.5)
    ModelDFSLt1_VLC8.7 <- rbind(c(0:0), ModelDFSLt1_VLC8.6)
    ModelDFSLt1_VLC8.8 <- rbind(c(0:0), ModelDFSLt1_VLC8.7)
    ModelDFSLt1_VLC8.9 <- rbind(c(0:0), ModelDFSLt1_VLC8.8)
    ModelDFSLt1_VLC8.10 <- rbind(c(0:0), ModelDFSLt1_VLC8.9)
    ModelDFSLt1_VLC8.11 <- rbind(c(0:0), ModelDFSLt1_VLC8.10)
    ModelDFSLt1_VLC8.12 <- rbind(c(0:0), ModelDFSLt1_VLC8.11)
    ModelDFSLt1_VLC8.13 <- ModelDFSLt1_VLC8.12[-nrow(ModelDFSLt1_VLC8.12),]
    ModelDFSLt1_VLC8.14 <- ModelDFSLt1_VLC8.13[-nrow(ModelDFSLt1_VLC8.13),]
    ModelDFSLt1_VLC8.15 <- ModelDFSLt1_VLC8.14[-nrow(ModelDFSLt1_VLC8.14),]
    ModelDFSLt1_VLC8.16 <- ModelDFSLt1_VLC8.15[-nrow(ModelDFSLt1_VLC8.15),]
    ModelDFSLt1_VLC8.17 <- ModelDFSLt1_VLC8.16[-nrow(ModelDFSLt1_VLC8.16),]
    ModelDFSLt1_VLC8.18 <- ModelDFSLt1_VLC8.17[-nrow(ModelDFSLt1_VLC8.17),]
    ModelDFSLt1_VLC8.19 <- ModelDFSLt1_VLC8.18[-nrow(ModelDFSLt1_VLC8.18),]
    ModelDFSLt1_VLC8.20 <- ModelDFSLt1_VLC8.19[-nrow(ModelDFSLt1_VLC8.19),]
    ModelDFSLt1_VLC8.21 <- ModelDFSLt1_VLC8.20[-nrow(ModelDFSLt1_VLC8.20),]
    ModelDFSLt1_VLC8.22 <- ModelDFSLt1_VLC8.21[-nrow(ModelDFSLt1_VLC8.21),]
    ModelDFSLt1_VLC8.23 <- ModelDFSLt1_VLC8.22[-nrow(ModelDFSLt1_VLC8.22),]
    ModelDFSLt1_VLC8.24 <- ModelDFSLt1_VLC8.23[-nrow(ModelDFSLt1_VLC8.23),]

    ModelDFSLt1_VLC8 <- ModelDFSLt1_VLC8.24 #Create model t=x+1

    #Subtract model (t=x) - (t=x+1)
    ModelDFSL1y_VLC8 <- ModelDFSLt0_VLC8 - ModelDFSLt1_VLC8

    #Re-do Month Number column because the substraction was also applied to it
    ModelDFSL1y_VLC8$MNumber <- seq(from = 1, to = SimulationLength_months)

    #This model will be called VLC8P because implies a one-off input of C
    ModelDFSL_VLC8P <- ModelDFSL1y_VLC8

    #Export the dataframe
    write_xlsx(ModelDFSL_VLC8P,"VXP_Models\\ModelDFSL_R_VLC8P.xlsx")


    #Plot 3: Interactive Yearly CO2 emissions #
    MY <- 12
    ModelDFSL_VLC8P_YCO2 <- ModelDFSL_VLC8P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VLC8)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLC8P_YCO2) <- c("Year", "Months", "AnnualCO2_VLC_8")

    #Plot 3: Interactive Yearly CO2 emissions considering a delay
    GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
    ModelDFSL_VLC8P_YCO2D <- merge(ModelDFSL_VLC8P_YCO2, GWP100delay, by = "Year")
    ModelDFSL_VLC8P_YCO2D$AnnualCO2D_VLC_8 <- ModelDFSL_VLC8P_YCO2D$AnnualCO2_VLC_8 * ModelDFSL_VLC8P_YCO2D$GWP100


    #Plot 4: Interactive Yearly C emissions #
    MY <- 12
    ModelDFSL_VLC8P_YC <- ModelDFSL_VLC8P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VLC8)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLC8P_YC) <- c("Year", "Months", "CEmissions_VLC_8")

    #Plot 5: Interactive Yearly C tails (remaining C in Soil) #
    MY <- 12
    ModelDFSL_VLC8P_YCT <- ModelDFSL_VLC8P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VLC8)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLC8P_YCT) <- c("Year", "Months", "CTail_VLC_8")

    #Save Dataframes for Plots 3.1, 3.2, 4 and 5
    write_xlsx(ModelDFSL_VLC8P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VLC8P.xlsx") #Yearly CO2 emissions (no delay)
    write_xlsx(ModelDFSL_VLC8P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VLC8P.xlsx") #Yearly CO2 emissions (delay)
    write_xlsx(ModelDFSL_VLC8P_YC,"CEmissions_P\\ModelDFSL_R_CE_VLC8P.xlsx") #Yearly C emissions
    write_xlsx(ModelDFSL_VLC8P_YCT,"CTails_P\\ModelDFSL_R_CT_VLC8P.xlsx") #Yearly C emissions



    #### 7.10 - VLC9) Litter; 90%clay; Conventional tillage ####
    #The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
    fT_VLC9=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
    fW_VLC9=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                            S.Thick = soil.thick, pClay = clay100*0.9,
                            pE = 1.0, bare = FALSE)$b #Moisture effects per month
    xi.frame_VLC9=data.frame(years,rep(fT_VLC9*fW_VLC9,length.out=length(years)))

    #To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
    Model_VLC9=SoilR::RothCModel(
      t=years, #Simulation Length
      ks=c(k.DPM = 10*CTRM, k.RPM = 0.3*CTRM, k.BIO = 0.66*CTRM, k.HUM = 0.02*CTRM, k.IOM = 0*CTRM), #Decomposition rates for the different pools
      C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
      In=Scalar_LitterCinputs*1, #Amount of litter inputs by time
      FYM = Scalar_ManureCinputs*0, #Amount of Farm Yard Manure by time
      clay=clay100*0.9, #Percent clay in mineral soil
      xi=xi.frame_VLC9) #Loads the model

    Ct_VLC9=getC(Model_VLC9) #Calculates stocks for each pool per month

    #The results can be plotted with the commands
    matplot(years, Ct_VLC9, type="l", lty=1, col=1:5,
            xlab="Time (years)", ylab="C stocks (Mg/ha)")
    legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
           lty=1, col=1:5, bty="n")

    VEC_Lit_VLC9 <- rep(M_Scalar_LitterCinputs*1, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
    VEC_Man_VLC9 <- rep(M_Scalar_ManureCinputs*0, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

    VEC_LitDF_VLC9 <- as.data.frame(VEC_Lit_VLC9) #Converting the Litter vector to a data frame
    VEC_LitDF_VLC9$MNumber <- seq(from = 1, to = SimulationLength_months)
    VEC_ManDF_VLC9 <- as.data.frame(VEC_Man_VLC9) #Converting the Manure vector to a data frame
    VEC_ManDF_VLC9$MNumber <- seq(from = 1, to = SimulationLength_months)

    sapply(VEC_LitDF_VLC9, class) #Check that class is numeric
    sapply(VEC_ManDF_VLC9, class) #Check that class is numeric
    LitterCinputs_VLC9=VEC_LitDF_VLC9   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    ManureCinputs_VLC9=VEC_ManDF_VLC9 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    MCinputs_VLC9 <- merge(LitterCinputs_VLC9, ManureCinputs_VLC9, by = "MNumber")
    MCinputs_VLC9$MInput_VLC9 <- MCinputs_VLC9$VEC_Lit_VLC9 + MCinputs_VLC9$VEC_Man_VLC9

    #Change names of litter and manure columns for more common ones
    colnames(MCinputs_VLC9)[which(names(MCinputs_VLC9) == "VEC_Lit_VLC9")] <- "LitterC_VLC9"
    colnames(MCinputs_VLC9)[which(names(MCinputs_VLC9) == "VEC_Man_VLC9")] <- "ManureC_VLC9"

    #Create a dataframe with the data considering the simulation length
    ModelDF_VLC9 <- as.data.frame(Ct_VLC9)
    colnames(ModelDF_VLC9) <- c('DPM_VLC9','RPM_VLC9','BIO_VLC9', 'HUM_VLC9', 'IOM_VLC9')
    ModelDFS_VLC9 <- ModelDF_VLC9[1:SimulationLength_months, ]

    #Create a column with the number of month of analysis
    ModelDFS_VLC9$MNumber <- seq(from = 1, to = SimulationLength_months)

    #Create a column that sums all pools
    ModelDFS_VLC9$AllPools_VLC9 <- ModelDFS_VLC9$DPM_VLC9 + ModelDFS_VLC9$RPM_VLC9 + ModelDFS_VLC9$BIO_VLC9 + ModelDFS_VLC9$HUM_VLC9 + ModelDFS_VLC9$IOM_VLC9

    #Create a column that sums all pools except IOM (static)
    ModelDFS_VLC9$AllPools_noIOM_VLC9 <- ModelDFS_VLC9$DPM_VLC9 + ModelDFS_VLC9$RPM_VLC9 + ModelDFS_VLC9$BIO_VLC9 + ModelDFS_VLC9$HUM_VLC9

    #Create a column that add the monthly input of C (manure and litter separately)
    ModelDFSL_VLC9 <- merge(ModelDFS_VLC9, MCinputs_VLC9, by = "MNumber")

    ModelDFSL_VLC9$MInput_VLC9 <- ModelDFSL_VLC9$LitterC_VLC9 + ModelDFSL_VLC9$ManureC_VLC9
    #ModelDF_SL$MInput[1] <- 0

    #Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
    ModelDFSL_VLC9$CTails_VLC9 <- ModelDFSL_VLC9$AllPools_noIOM_VLC9 + ModelDFSL_VLC9$MInput_VLC9

    #Create Monthly Accumulated input of C
    ModelDFSL_VLC9$AccumInput_VLC9 = ModelDFSL_VLC9$AccumInput_VLC9=cumsum(ModelDFSL_VLC9$MInput_VLC9)

    #Create Monthly Growths for each carbon pool
    ModelDFSL_VLC9$MGrowth_DPM_VLC9 <- ave(ModelDFSL_VLC9$DPM_VLC9, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLC9$MGrowth_RPM_VLC9 <- ave(ModelDFSL_VLC9$RPM_VLC9, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLC9$MGrowth_BIO_VLC9 <- ave(ModelDFSL_VLC9$BIO_VLC9, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLC9$MGrowth_HUM_VLC9 <- ave(ModelDFSL_VLC9$HUM_VLC9, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLC9$MGrowth_IOM_VLC9 <- ave(ModelDFSL_VLC9$IOM_VLC9, FUN = function(x) c(0, diff(x)))

    #Create column for Monthly and Accumulated C-CO2 emissions
    ModelDFSL_VLC9$M_CCO2_VLC9 <- ModelDFSL_VLC9$MInput_VLC9 - ModelDFSL_VLC9$MGrowth_DPM_VLC9 - ModelDFSL_VLC9$MGrowth_RPM_VLC9 - ModelDFSL_VLC9$MGrowth_BIO_VLC9 - ModelDFSL_VLC9$MGrowth_HUM_VLC9
    ModelDFSL_VLC9$Accum_CCO2_VLC9 <- ModelDFSL_VLC9$AccumInput_VLC9 - ModelDFSL_VLC9$AllPools_noIOM_VLC9

    #Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
    ModelDFSL_VLC9$M_CCO2_VLC9[1] <- 0
    ModelDFSL_VLC9$Accum_CCO2_VLC9[1] <- 0

    #Balance validation
    ModelDFSL_VLC9$Balance_VLC9 <- ModelDFSL_VLC9$AccumInput_VLC9 - ModelDFSL_VLC9$Accum_CCO2_VLC9 - (ModelDFSL_VLC9$DPM_VLC9 + ModelDFSL_VLC9$RPM_VLC9 + ModelDFSL_VLC9$BIO_VLC9 + ModelDFSL_VLC9$HUM_VLC9)

    #Convert C-CO2 emissions into CO2 emissions
    ModelDFSL_VLC9$M_CO2_VLC9 <- ModelDFSL_VLC9$M_CCO2_VLC9 * 44/12
    ModelDFSL_VLC9$Accum_CO2_VLC9 <- ModelDFSL_VLC9$Accum_CCO2_VLC9 * 44/12

    #This model will be called VLC9C because implies a continuous input of C
    ModelDFSL_VLC9C <- ModelDFSL_VLC9

    #Export the dataframe
    write_xlsx(ModelDFSL_VLC9C,"VXC_Models\\ModelDFSL_R_VLC9C.xlsx")

    #Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
    #Create two equal models by using the above general script
    #Create model t=x
    ModelDFSLt0_VLC9 <- ModelDFSL_VLC9 #Create model t=x

    #Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
    ModelDFSLt1_VLC9.1 <- rbind(c(0:0), ModelDFSLt0_VLC9)
    ModelDFSLt1_VLC9.2 <- rbind(c(0:0), ModelDFSLt1_VLC9.1)
    ModelDFSLt1_VLC9.3 <- rbind(c(0:0), ModelDFSLt1_VLC9.2)
    ModelDFSLt1_VLC9.4 <- rbind(c(0:0), ModelDFSLt1_VLC9.3)
    ModelDFSLt1_VLC9.5 <- rbind(c(0:0), ModelDFSLt1_VLC9.4)
    ModelDFSLt1_VLC9.6 <- rbind(c(0:0), ModelDFSLt1_VLC9.5)
    ModelDFSLt1_VLC9.7 <- rbind(c(0:0), ModelDFSLt1_VLC9.6)
    ModelDFSLt1_VLC9.8 <- rbind(c(0:0), ModelDFSLt1_VLC9.7)
    ModelDFSLt1_VLC9.9 <- rbind(c(0:0), ModelDFSLt1_VLC9.8)
    ModelDFSLt1_VLC9.10 <- rbind(c(0:0), ModelDFSLt1_VLC9.9)
    ModelDFSLt1_VLC9.11 <- rbind(c(0:0), ModelDFSLt1_VLC9.10)
    ModelDFSLt1_VLC9.12 <- rbind(c(0:0), ModelDFSLt1_VLC9.11)
    ModelDFSLt1_VLC9.13 <- ModelDFSLt1_VLC9.12[-nrow(ModelDFSLt1_VLC9.12),]
    ModelDFSLt1_VLC9.14 <- ModelDFSLt1_VLC9.13[-nrow(ModelDFSLt1_VLC9.13),]
    ModelDFSLt1_VLC9.15 <- ModelDFSLt1_VLC9.14[-nrow(ModelDFSLt1_VLC9.14),]
    ModelDFSLt1_VLC9.16 <- ModelDFSLt1_VLC9.15[-nrow(ModelDFSLt1_VLC9.15),]
    ModelDFSLt1_VLC9.17 <- ModelDFSLt1_VLC9.16[-nrow(ModelDFSLt1_VLC9.16),]
    ModelDFSLt1_VLC9.18 <- ModelDFSLt1_VLC9.17[-nrow(ModelDFSLt1_VLC9.17),]
    ModelDFSLt1_VLC9.19 <- ModelDFSLt1_VLC9.18[-nrow(ModelDFSLt1_VLC9.18),]
    ModelDFSLt1_VLC9.20 <- ModelDFSLt1_VLC9.19[-nrow(ModelDFSLt1_VLC9.19),]
    ModelDFSLt1_VLC9.21 <- ModelDFSLt1_VLC9.20[-nrow(ModelDFSLt1_VLC9.20),]
    ModelDFSLt1_VLC9.22 <- ModelDFSLt1_VLC9.21[-nrow(ModelDFSLt1_VLC9.21),]
    ModelDFSLt1_VLC9.23 <- ModelDFSLt1_VLC9.22[-nrow(ModelDFSLt1_VLC9.22),]
    ModelDFSLt1_VLC9.24 <- ModelDFSLt1_VLC9.23[-nrow(ModelDFSLt1_VLC9.23),]

    ModelDFSLt1_VLC9 <- ModelDFSLt1_VLC9.24 #Create model t=x+1

    #Subtract model (t=x) - (t=x+1)
    ModelDFSL1y_VLC9 <- ModelDFSLt0_VLC9 - ModelDFSLt1_VLC9

    #Re-do Month Number column because the substraction was also applied to it
    ModelDFSL1y_VLC9$MNumber <- seq(from = 1, to = SimulationLength_months)

    #This model will be called VLC9P because implies a one-off input of C
    ModelDFSL_VLC9P <- ModelDFSL1y_VLC9

    #Export the dataframe
    write_xlsx(ModelDFSL_VLC9P,"VXP_Models\\ModelDFSL_R_VLC9P.xlsx")


    #Plot 3: Interactive Yearly CO2 emissions #
    MY <- 12
    ModelDFSL_VLC9P_YCO2 <- ModelDFSL_VLC9P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VLC9)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLC9P_YCO2) <- c("Year", "Months", "AnnualCO2_VLC_9")

    #Plot 3: Interactive Yearly CO2 emissions considering a delay
    GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
    ModelDFSL_VLC9P_YCO2D <- merge(ModelDFSL_VLC9P_YCO2, GWP100delay, by = "Year")
    ModelDFSL_VLC9P_YCO2D$AnnualCO2D_VLC_9 <- ModelDFSL_VLC9P_YCO2D$AnnualCO2_VLC_9 * ModelDFSL_VLC9P_YCO2D$GWP100


    #Plot 4: Interactive Yearly C emissions #
    MY <- 12
    ModelDFSL_VLC9P_YC <- ModelDFSL_VLC9P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VLC9)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLC9P_YC) <- c("Year", "Months", "CEmissions_VLC_9")

    #Plot 5: Interactive Yearly C tails (remaining C in Soil) #
    MY <- 12
    ModelDFSL_VLC9P_YCT <- ModelDFSL_VLC9P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VLC9)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLC9P_YCT) <- c("Year", "Months", "CTail_VLC_9")

    #Save Dataframes for Plots 3.1, 3.2, 4 and 5
    write_xlsx(ModelDFSL_VLC9P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VLC9P.xlsx") #Yearly CO2 emissions (no delay)
    write_xlsx(ModelDFSL_VLC9P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VLC9P.xlsx") #Yearly CO2 emissions (delay)
    write_xlsx(ModelDFSL_VLC9P_YC,"CEmissions_P\\ModelDFSL_R_CE_VLC9P.xlsx") #Yearly C emissions
    write_xlsx(ModelDFSL_VLC9P_YCT,"CTails_P\\ModelDFSL_R_CT_VLC9P.xlsx") #Yearly C emissions



    #### 7.11 - VLC10) Litter; 100%clay; Conventional tillage ####
    #The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
    fT_VLC10=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
    fW_VLC10=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                             S.Thick = soil.thick, pClay = clay100,
                             pE = 1.0, bare = FALSE)$b #Moisture effects per month
    xi.frame_VLC10=data.frame(years,rep(fT_VLC10*fW_VLC10,length.out=length(years)))

    #To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
    Model_VLC10=SoilR::RothCModel(
      t=years, #Simulation Length
      ks=c(k.DPM = 10*CTRM, k.RPM = 0.3*CTRM, k.BIO = 0.66*CTRM, k.HUM = 0.02*CTRM, k.IOM = 0*CTRM), #Decomposition rates for the different pools
      C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
      In=Scalar_LitterCinputs*1, #Amount of litter inputs by time
      FYM = Scalar_ManureCinputs*0, #Amount of Farm Yard Manure by time
      clay=clay100, #Percent clay in mineral soil
      xi=xi.frame_VLC10) #Loads the model

    Ct_VLC10=getC(Model_VLC10) #Calculates stocks for each pool per month

    #The results can be plotted with the commands
    matplot(years, Ct_VLC10, type="l", lty=1, col=1:5,
            xlab="Time (years)", ylab="C stocks (Mg/ha)")
    legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
           lty=1, col=1:5, bty="n")

    VEC_Lit_VLC10 <- rep(M_Scalar_LitterCinputs*1, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
    VEC_Man_VLC10 <- rep(M_Scalar_ManureCinputs*0, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

    VEC_LitDF_VLC10 <- as.data.frame(VEC_Lit_VLC10) #Converting the Litter vector to a data frame
    VEC_LitDF_VLC10$MNumber <- seq(from = 1, to = SimulationLength_months)
    VEC_ManDF_VLC10 <- as.data.frame(VEC_Man_VLC10) #Converting the Manure vector to a data frame
    VEC_ManDF_VLC10$MNumber <- seq(from = 1, to = SimulationLength_months)

    sapply(VEC_LitDF_VLC10, class) #Check that class is numeric
    sapply(VEC_ManDF_VLC10, class) #Check that class is numeric
    LitterCinputs_VLC10=VEC_LitDF_VLC10   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    ManureCinputs_VLC10=VEC_ManDF_VLC10 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    MCinputs_VLC10 <- merge(LitterCinputs_VLC10, ManureCinputs_VLC10, by = "MNumber")
    MCinputs_VLC10$MInput_VLC10 <- MCinputs_VLC10$VEC_Lit_VLC10 + MCinputs_VLC10$VEC_Man_VLC10

    #Change names of litter and manure columns for more common ones
    colnames(MCinputs_VLC10)[which(names(MCinputs_VLC10) == "VEC_Lit_VLC10")] <- "LitterC_VLC10"
    colnames(MCinputs_VLC10)[which(names(MCinputs_VLC10) == "VEC_Man_VLC10")] <- "ManureC_VLC10"

    #Create a dataframe with the data considering the simulation length
    ModelDF_VLC10 <- as.data.frame(Ct_VLC10)
    colnames(ModelDF_VLC10) <- c('DPM_VLC10','RPM_VLC10','BIO_VLC10', 'HUM_VLC10', 'IOM_VLC10')
    ModelDFS_VLC10 <- ModelDF_VLC10[1:SimulationLength_months, ]

    #Create a column with the number of month of analysis
    ModelDFS_VLC10$MNumber <- seq(from = 1, to = SimulationLength_months)

    #Create a column that sums all pools
    ModelDFS_VLC10$AllPools_VLC10 <- ModelDFS_VLC10$DPM_VLC10 + ModelDFS_VLC10$RPM_VLC10 + ModelDFS_VLC10$BIO_VLC10 + ModelDFS_VLC10$HUM_VLC10 + ModelDFS_VLC10$IOM_VLC10

    #Create a column that sums all pools except IOM (static)
    ModelDFS_VLC10$AllPools_noIOM_VLC10 <- ModelDFS_VLC10$DPM_VLC10 + ModelDFS_VLC10$RPM_VLC10 + ModelDFS_VLC10$BIO_VLC10 + ModelDFS_VLC10$HUM_VLC10

    #Create a column that add the monthly input of C (manure and litter separately)
    ModelDFSL_VLC10 <- merge(ModelDFS_VLC10, MCinputs_VLC10, by = "MNumber")

    ModelDFSL_VLC10$MInput_VLC10 <- ModelDFSL_VLC10$LitterC_VLC10 + ModelDFSL_VLC10$ManureC_VLC10
    #ModelDF_SL$MInput[1] <- 0

    #Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
    ModelDFSL_VLC10$CTails_VLC10 <- ModelDFSL_VLC10$AllPools_noIOM_VLC10 + ModelDFSL_VLC10$MInput_VLC10

    #Create Monthly Accumulated input of C
    ModelDFSL_VLC10$AccumInput_VLC10 = ModelDFSL_VLC10$AccumInput_VLC10=cumsum(ModelDFSL_VLC10$MInput_VLC10)

    #Create Monthly Growths for each carbon pool
    ModelDFSL_VLC10$MGrowth_DPM_VLC10 <- ave(ModelDFSL_VLC10$DPM_VLC10, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLC10$MGrowth_RPM_VLC10 <- ave(ModelDFSL_VLC10$RPM_VLC10, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLC10$MGrowth_BIO_VLC10 <- ave(ModelDFSL_VLC10$BIO_VLC10, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLC10$MGrowth_HUM_VLC10 <- ave(ModelDFSL_VLC10$HUM_VLC10, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLC10$MGrowth_IOM_VLC10 <- ave(ModelDFSL_VLC10$IOM_VLC10, FUN = function(x) c(0, diff(x)))

    #Create column for Monthly and Accumulated C-CO2 emissions
    ModelDFSL_VLC10$M_CCO2_VLC10 <- ModelDFSL_VLC10$MInput_VLC10 - ModelDFSL_VLC10$MGrowth_DPM_VLC10 - ModelDFSL_VLC10$MGrowth_RPM_VLC10 - ModelDFSL_VLC10$MGrowth_BIO_VLC10 - ModelDFSL_VLC10$MGrowth_HUM_VLC10
    ModelDFSL_VLC10$Accum_CCO2_VLC10 <- ModelDFSL_VLC10$AccumInput_VLC10 - ModelDFSL_VLC10$AllPools_noIOM_VLC10

    #Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
    ModelDFSL_VLC10$M_CCO2_VLC10[1] <- 0
    ModelDFSL_VLC10$Accum_CCO2_VLC10[1] <- 0

    #Balance validation
    ModelDFSL_VLC10$Balance_VLC10 <- ModelDFSL_VLC10$AccumInput_VLC10 - ModelDFSL_VLC10$Accum_CCO2_VLC10 - (ModelDFSL_VLC10$DPM_VLC10 + ModelDFSL_VLC10$RPM_VLC10 + ModelDFSL_VLC10$BIO_VLC10 + ModelDFSL_VLC10$HUM_VLC10)

    #Convert C-CO2 emissions into CO2 emissions
    ModelDFSL_VLC10$M_CO2_VLC10 <- ModelDFSL_VLC10$M_CCO2_VLC10 * 44/12
    ModelDFSL_VLC10$Accum_CO2_VLC10 <- ModelDFSL_VLC10$Accum_CCO2_VLC10 * 44/12

    #This model will be called VLC10C because implies a continuous input of C
    ModelDFSL_VLC10C <- ModelDFSL_VLC10

    #Export the dataframe
    write_xlsx(ModelDFSL_VLC10C,"VXC_Models\\ModelDFSL_R_VLC10C.xlsx")

    #Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
    #Create two equal models by using the above general script
    #Create model t=x
    ModelDFSLt0_VLC10 <- ModelDFSL_VLC10 #Create model t=x

    #Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
    ModelDFSLt1_VLC10.1 <- rbind(c(0:0), ModelDFSLt0_VLC10)
    ModelDFSLt1_VLC10.2 <- rbind(c(0:0), ModelDFSLt1_VLC10.1)
    ModelDFSLt1_VLC10.3 <- rbind(c(0:0), ModelDFSLt1_VLC10.2)
    ModelDFSLt1_VLC10.4 <- rbind(c(0:0), ModelDFSLt1_VLC10.3)
    ModelDFSLt1_VLC10.5 <- rbind(c(0:0), ModelDFSLt1_VLC10.4)
    ModelDFSLt1_VLC10.6 <- rbind(c(0:0), ModelDFSLt1_VLC10.5)
    ModelDFSLt1_VLC10.7 <- rbind(c(0:0), ModelDFSLt1_VLC10.6)
    ModelDFSLt1_VLC10.8 <- rbind(c(0:0), ModelDFSLt1_VLC10.7)
    ModelDFSLt1_VLC10.9 <- rbind(c(0:0), ModelDFSLt1_VLC10.8)
    ModelDFSLt1_VLC10.10 <- rbind(c(0:0), ModelDFSLt1_VLC10.9)
    ModelDFSLt1_VLC10.11 <- rbind(c(0:0), ModelDFSLt1_VLC10.10)
    ModelDFSLt1_VLC10.12 <- rbind(c(0:0), ModelDFSLt1_VLC10.11)
    ModelDFSLt1_VLC10.13 <- ModelDFSLt1_VLC10.12[-nrow(ModelDFSLt1_VLC10.12),]
    ModelDFSLt1_VLC10.14 <- ModelDFSLt1_VLC10.13[-nrow(ModelDFSLt1_VLC10.13),]
    ModelDFSLt1_VLC10.15 <- ModelDFSLt1_VLC10.14[-nrow(ModelDFSLt1_VLC10.14),]
    ModelDFSLt1_VLC10.16 <- ModelDFSLt1_VLC10.15[-nrow(ModelDFSLt1_VLC10.15),]
    ModelDFSLt1_VLC10.17 <- ModelDFSLt1_VLC10.16[-nrow(ModelDFSLt1_VLC10.16),]
    ModelDFSLt1_VLC10.18 <- ModelDFSLt1_VLC10.17[-nrow(ModelDFSLt1_VLC10.17),]
    ModelDFSLt1_VLC10.19 <- ModelDFSLt1_VLC10.18[-nrow(ModelDFSLt1_VLC10.18),]
    ModelDFSLt1_VLC10.20 <- ModelDFSLt1_VLC10.19[-nrow(ModelDFSLt1_VLC10.19),]
    ModelDFSLt1_VLC10.21 <- ModelDFSLt1_VLC10.20[-nrow(ModelDFSLt1_VLC10.20),]
    ModelDFSLt1_VLC10.22 <- ModelDFSLt1_VLC10.21[-nrow(ModelDFSLt1_VLC10.21),]
    ModelDFSLt1_VLC10.23 <- ModelDFSLt1_VLC10.22[-nrow(ModelDFSLt1_VLC10.22),]
    ModelDFSLt1_VLC10.24 <- ModelDFSLt1_VLC10.23[-nrow(ModelDFSLt1_VLC10.23),]

    ModelDFSLt1_VLC10 <- ModelDFSLt1_VLC10.24 #Create model t=x+1

    #Subtract model (t=x) - (t=x+1)
    ModelDFSL1y_VLC10 <- ModelDFSLt0_VLC10 - ModelDFSLt1_VLC10

    #Re-do Month Number column because the substraction was also applied to it
    ModelDFSL1y_VLC10$MNumber <- seq(from = 1, to = SimulationLength_months)

    #This model will be called VLC10P because implies a one-off input of C
    ModelDFSL_VLC10P <- ModelDFSL1y_VLC10

    #Export the dataframe
    write_xlsx(ModelDFSL_VLC10P,"VXP_Models\\ModelDFSL_R_VLC10P.xlsx")


    #Plot 3: Interactive Yearly CO2 emissions #
    MY <- 12
    ModelDFSL_VLC10P_YCO2 <- ModelDFSL_VLC10P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VLC10)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLC10P_YCO2) <- c("Year", "Months", "AnnualCO2_VLC10")

    #Plot 3: Interactive Yearly CO2 emissions considering a delay
    GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
    ModelDFSL_VLC10P_YCO2D <- merge(ModelDFSL_VLC10P_YCO2, GWP100delay, by = "Year")
    ModelDFSL_VLC10P_YCO2D$AnnualCO2D_VLC10 <- ModelDFSL_VLC10P_YCO2D$AnnualCO2_VLC10 * ModelDFSL_VLC10P_YCO2D$GWP100

    #Plot 4: Interactive Yearly C emissions #
    MY <- 12
    ModelDFSL_VLC10P_YC <- ModelDFSL_VLC10P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VLC10)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLC10P_YC) <- c("Year", "Months", "CEmissions_VLC10")

    #Plot 5: Interactive Yearly C tails (remaining C in Soil) #
    MY <- 12
    ModelDFSL_VLC10P_YCT <- ModelDFSL_VLC10P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VLC10)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLC10P_YCT) <- c("Year", "Months", "CTail_VLC10")

    #Save Dataframes for Plots 3.1, 3.2, 4 and 5
    write_xlsx(ModelDFSL_VLC10P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VLC10P.xlsx") #Yearly CO2 emissions (no delay)
    write_xlsx(ModelDFSL_VLC10P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VLC10P.xlsx") #Yearly CO2 emissions (delay)
    write_xlsx(ModelDFSL_VLC10P_YC,"CEmissions_P\\ModelDFSL_R_CE_VLC10P.xlsx") #Yearly C emissions
    write_xlsx(ModelDFSL_VLC10P_YCT,"CTails_P\\ModelDFSL_R_CT_VLC10P.xlsx") #Yearly C emissions

  }
  else if(Scope == "VLR"){
#### 8) Model Combinations - Litter; Reduced Tillage, 0-100% (+10%) Clay ####
#### 8.1 - VLR0) Litter; 0%clay; Reduced Tillage ####
    #The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
    fT_VLR0=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
    fW_VLR0=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                            S.Thick = soil.thick, pClay = clay0,
                            pE = 1.0, bare = FALSE)$b #Moisture effects per month
    xi.frame_VLR0=data.frame(years,rep(fT_VLR0*fW_VLR0,length.out=length(years)))

    #To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
    Model_VLR0=SoilR::RothCModel(
      t=years, #Simulation Length
      ks=c(k.DPM = 10*RTRM, k.RPM = 0.3*RTRM, k.BIO = 0.66*RTRM, k.HUM = 0.02*RTRM, k.IOM = 0*RTRM), #Decomposition rates for the different pools
      C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
      In=Scalar_LitterCinputs*1, #Amount of litter inputs by time
      FYM = Scalar_ManureCinputs*0, #Amount of Farm Yard Manure by time
      clay=clay0, #Percent clay in mineral soil
      xi=xi.frame_VLR0) #Loads the model

    Ct_VLR0=getC(Model_VLR0) #Calculates stocks for each pool per month

    VEC_Lit_VLR0 <- rep(M_Scalar_LitterCinputs*1, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
    VEC_Man_VLR0 <- rep(M_Scalar_ManureCinputs*0, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

    VEC_LitDF_VLR0 <- as.data.frame(VEC_Lit_VLR0) #Converting the Litter vector to a data frame
    VEC_LitDF_VLR0$MNumber <- seq(from = 1, to = SimulationLength_months)
    VEC_ManDF_VLR0 <- as.data.frame(VEC_Man_VLR0) #Converting the Manure vector to a data frame
    VEC_ManDF_VLR0$MNumber <- seq(from = 1, to = SimulationLength_months)

    sapply(VEC_LitDF_VLR0, class) #Check that class is numeric
    sapply(VEC_ManDF_VLR0, class) #Check that class is numeric
    LitterCinputs_VLR0=VEC_LitDF_VLR0   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    ManureCinputs_VLR0=VEC_ManDF_VLR0 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    MCinputs_VLR0 <- merge(LitterCinputs_VLR0, ManureCinputs_VLR0, by = "MNumber")
    MCinputs_VLR0$MInput_VLR0 <- MCinputs_VLR0$VEC_Lit_VLR0 + MCinputs_VLR0$VEC_Man_VLR0

    #Change names of litter and manure columns for more common ones
    colnames(MCinputs_VLR0)[which(names(MCinputs_VLR0) == "VEC_Lit_VLR0")] <- "LitterC_VLR0"
    colnames(MCinputs_VLR0)[which(names(MCinputs_VLR0) == "VEC_Man_VLR0")] <- "ManureC_VLR0"

    #Create a dataframe with the data considering the simulation length
    ModelDF_VLR0 <- as.data.frame(Ct_VLR0)
    colnames(ModelDF_VLR0) <- c('DPM_VLR0','RPM_VLR0','BIO_VLR0', 'HUM_VLR0', 'IOM_VLR0')
    ModelDFS_VLR0 <- ModelDF_VLR0[1:SimulationLength_months, ]

    #Create a column with the number of month of analysis
    ModelDFS_VLR0$MNumber <- seq(from = 1, to = SimulationLength_months)

    #Create a column that sums all pools
    ModelDFS_VLR0$AllPools_VLR0 <- ModelDFS_VLR0$DPM_VLR0 + ModelDFS_VLR0$RPM_VLR0 + ModelDFS_VLR0$BIO_VLR0 + ModelDFS_VLR0$HUM_VLR0 + ModelDFS_VLR0$IOM_VLR0

    #Create a column that sums all pools except IOM (static)
    ModelDFS_VLR0$AllPools_noIOM_VLR0 <- ModelDFS_VLR0$DPM_VLR0 + ModelDFS_VLR0$RPM_VLR0 + ModelDFS_VLR0$BIO_VLR0 + ModelDFS_VLR0$HUM_VLR0

    #Create a column that add the monthly input of C (manure and litter separately)
    ModelDFSL_VLR0 <- merge(ModelDFS_VLR0, MCinputs_VLR0, by = "MNumber")

    ModelDFSL_VLR0$MInput_VLR0 <- ModelDFSL_VLR0$LitterC_VLR0 + ModelDFSL_VLR0$ManureC_VLR0
    #ModelDF_SL$MInput[1] <- 0

    #Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
    ModelDFSL_VLR0$CTails_VLR0 <- ModelDFSL_VLR0$AllPools_noIOM_VLR0 + ModelDFSL_VLR0$MInput_VLR0

    #Create Monthly Accumulated input of C
    ModelDFSL_VLR0$AccumInput_VLR0 = ModelDFSL_VLR0$AccumInput_VLR0=cumsum(ModelDFSL_VLR0$MInput_VLR0)

    #Create Monthly Growths for each carbon pool
    ModelDFSL_VLR0$MGrowth_DPM_VLR0 <- ave(ModelDFSL_VLR0$DPM_VLR0, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLR0$MGrowth_RPM_VLR0 <- ave(ModelDFSL_VLR0$RPM_VLR0, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLR0$MGrowth_BIO_VLR0 <- ave(ModelDFSL_VLR0$BIO_VLR0, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLR0$MGrowth_HUM_VLR0 <- ave(ModelDFSL_VLR0$HUM_VLR0, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLR0$MGrowth_IOM_VLR0 <- ave(ModelDFSL_VLR0$IOM_VLR0, FUN = function(x) c(0, diff(x)))

    #Create column for Monthly and Accumulated C-CO2 emissions
    ModelDFSL_VLR0$M_CCO2_VLR0 <- ModelDFSL_VLR0$MInput_VLR0 - ModelDFSL_VLR0$MGrowth_DPM_VLR0 - ModelDFSL_VLR0$MGrowth_RPM_VLR0 - ModelDFSL_VLR0$MGrowth_BIO_VLR0 - ModelDFSL_VLR0$MGrowth_HUM_VLR0
    ModelDFSL_VLR0$Accum_CCO2_VLR0 <- ModelDFSL_VLR0$AccumInput_VLR0 - ModelDFSL_VLR0$AllPools_noIOM_VLR0

    #Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
    ModelDFSL_VLR0$M_CCO2_VLR0[1] <- 0
    ModelDFSL_VLR0$Accum_CCO2_VLR0[1] <- 0

    #Balance validation
    ModelDFSL_VLR0$Balance_VLR0 <- ModelDFSL_VLR0$AccumInput_VLR0 - ModelDFSL_VLR0$Accum_CCO2_VLR0 - (ModelDFSL_VLR0$DPM_VLR0 + ModelDFSL_VLR0$RPM_VLR0 + ModelDFSL_VLR0$BIO_VLR0 + ModelDFSL_VLR0$HUM_VLR0)

    #Convert C-CO2 emissions into CO2 emissions
    ModelDFSL_VLR0$M_CO2_VLR0 <- ModelDFSL_VLR0$M_CCO2_VLR0 * 44/12
    ModelDFSL_VLR0$Accum_CO2_VLR0 <- ModelDFSL_VLR0$Accum_CCO2_VLR0 * 44/12

    #This model will be called VLR0C because implies a continuous input of C
    ModelDFSL_VLR0C <- ModelDFSL_VLR0

    #Export the dataframe
    write_xlsx(ModelDFSL_VLR0C,"VXC_Models\\ModelDFSL_R_VLR0C.xlsx")

    #Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
    #Create two equal models by using the above general script
    #Create model t=x
    ModelDFSLt0_VLR0 <- ModelDFSL_VLR0 #Create model t=x

    #Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
    ModelDFSLt1_VLR0.1 <- rbind(c(0:0), ModelDFSLt0_VLR0)
    ModelDFSLt1_VLR0.2 <- rbind(c(0:0), ModelDFSLt1_VLR0.1)
    ModelDFSLt1_VLR0.3 <- rbind(c(0:0), ModelDFSLt1_VLR0.2)
    ModelDFSLt1_VLR0.4 <- rbind(c(0:0), ModelDFSLt1_VLR0.3)
    ModelDFSLt1_VLR0.5 <- rbind(c(0:0), ModelDFSLt1_VLR0.4)
    ModelDFSLt1_VLR0.6 <- rbind(c(0:0), ModelDFSLt1_VLR0.5)
    ModelDFSLt1_VLR0.7 <- rbind(c(0:0), ModelDFSLt1_VLR0.6)
    ModelDFSLt1_VLR0.8 <- rbind(c(0:0), ModelDFSLt1_VLR0.7)
    ModelDFSLt1_VLR0.9 <- rbind(c(0:0), ModelDFSLt1_VLR0.8)
    ModelDFSLt1_VLR0.10 <- rbind(c(0:0), ModelDFSLt1_VLR0.9)
    ModelDFSLt1_VLR0.11 <- rbind(c(0:0), ModelDFSLt1_VLR0.10)
    ModelDFSLt1_VLR0.12 <- rbind(c(0:0), ModelDFSLt1_VLR0.11)
    ModelDFSLt1_VLR0.13 <- ModelDFSLt1_VLR0.12[-nrow(ModelDFSLt1_VLR0.12),]
    ModelDFSLt1_VLR0.14 <- ModelDFSLt1_VLR0.13[-nrow(ModelDFSLt1_VLR0.13),]
    ModelDFSLt1_VLR0.15 <- ModelDFSLt1_VLR0.14[-nrow(ModelDFSLt1_VLR0.14),]
    ModelDFSLt1_VLR0.16 <- ModelDFSLt1_VLR0.15[-nrow(ModelDFSLt1_VLR0.15),]
    ModelDFSLt1_VLR0.17 <- ModelDFSLt1_VLR0.16[-nrow(ModelDFSLt1_VLR0.16),]
    ModelDFSLt1_VLR0.18 <- ModelDFSLt1_VLR0.17[-nrow(ModelDFSLt1_VLR0.17),]
    ModelDFSLt1_VLR0.19 <- ModelDFSLt1_VLR0.18[-nrow(ModelDFSLt1_VLR0.18),]
    ModelDFSLt1_VLR0.20 <- ModelDFSLt1_VLR0.19[-nrow(ModelDFSLt1_VLR0.19),]
    ModelDFSLt1_VLR0.21 <- ModelDFSLt1_VLR0.20[-nrow(ModelDFSLt1_VLR0.20),]
    ModelDFSLt1_VLR0.22 <- ModelDFSLt1_VLR0.21[-nrow(ModelDFSLt1_VLR0.21),]
    ModelDFSLt1_VLR0.23 <- ModelDFSLt1_VLR0.22[-nrow(ModelDFSLt1_VLR0.22),]
    ModelDFSLt1_VLR0.24 <- ModelDFSLt1_VLR0.23[-nrow(ModelDFSLt1_VLR0.23),]

    ModelDFSLt1_VLR0 <- ModelDFSLt1_VLR0.24 #Create model t=x+1

    #Subtract model (t=x) - (t=x+1)
    ModelDFSL1y_VLR0 <- ModelDFSLt0_VLR0 - ModelDFSLt1_VLR0

    #Re-do Month Number column because the substraction was also applied to it
    ModelDFSL1y_VLR0$MNumber <- seq(from = 1, to = SimulationLength_months)

    #This model will be called VLR0P because implies a one-off input of C
    ModelDFSL_VLR0P <- ModelDFSL1y_VLR0

    #Export the dataframe
    write_xlsx(ModelDFSL_VLR0P,"VXP_Models\\ModelDFSL_R_VLR0P.xlsx")

    #Plot 3.1: Interactive Yearly CO2 emissions #
    MY <- 12
    ModelDFSL_VLR0P_YCO2 <- ModelDFSL_VLR0P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VLR0)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLR0P_YCO2) <- c("Year", "Months", "AnnualCO2_VLR_0")

    #Plot 3.2: Interactive Yearly CO2 emissions considering a delay
    GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
    ModelDFSL_VLR0P_YCO2D <- merge(ModelDFSL_VLR0P_YCO2, GWP100delay, by = "Year")
    ModelDFSL_VLR0P_YCO2D$AnnualCO2D_VLR_0 <- ModelDFSL_VLR0P_YCO2D$AnnualCO2_VLR_0 * ModelDFSL_VLR0P_YCO2D$GWP100

    #Plot 4: Interactive Yearly C emissions #
    MY <- 12
    ModelDFSL_VLR0P_YC <- ModelDFSL_VLR0P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VLR0)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLR0P_YC) <- c("Year", "Months", "CEmissions_VLR_0")

    #Plot 5: Interactive Yearly C tails (remaining C in Soil) #
    MY <- 12
    ModelDFSL_VLR0P_YCT <- ModelDFSL_VLR0P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VLR0)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLR0P_YCT) <- c("Year", "Months", "CTail_VLR_0")

    #Save Dataframes for Plots 3.1, 3.2, 4 and 5
    write_xlsx(ModelDFSL_VLR0P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VLR0P.xlsx") #Yearly CO2 emissions (no delay)
    write_xlsx(ModelDFSL_VLR0P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VLR0P.xlsx") #Yearly CO2 emissions (delay)
    write_xlsx(ModelDFSL_VLR0P_YC,"CEmissions_P\\ModelDFSL_R_CE_VLR0P.xlsx") #Yearly C emissions
    write_xlsx(ModelDFSL_VLR0P_YCT,"CTails_P\\ModelDFSL_R_CT_VLR0P.xlsx") #Yearly C emissions


#### 8.2 - VLR1) Litter; 10%clay; Reduced Tillage ####
    #The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
    fT_VLR1=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
    fW_VLR1=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                            S.Thick = soil.thick, pClay = clay100*0.1,
                            pE = 1.0, bare = FALSE)$b #Moisture effects per month
    xi.frame_VLR1=data.frame(years,rep(fT_VLR1*fW_VLR1,length.out=length(years)))

    #To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
    Model_VLR1=SoilR::RothCModel(
      t=years, #Simulation Length
      ks=c(k.DPM = 10*RTRM, k.RPM = 0.3*RTRM, k.BIO = 0.66*RTRM, k.HUM = 0.02*RTRM, k.IOM = 0*RTRM), #Decomposition rates for the different pools
      C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
      In=Scalar_LitterCinputs*1, #Amount of litter inputs by time
      FYM = Scalar_ManureCinputs*0, #Amount of Farm Yard Manure by time
      clay=clay100*0.1, #Percent clay in mineral soil
      xi=xi.frame_VLR1) #Loads the model

    Ct_VLR1=getC(Model_VLR1) #Calculates stocks for each pool per month

    #The results can be plotted with the commands
    matplot(years, Ct_VLR1, type="l", lty=1, col=1:5,
            xlab="Time (years)", ylab="C stocks (Mg/ha)")
    legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
           lty=1, col=1:5, bty="n")

    VEC_Lit_VLR1 <- rep(M_Scalar_LitterCinputs*1, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
    VEC_Man_VLR1 <- rep(M_Scalar_ManureCinputs*0, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

    VEC_LitDF_VLR1 <- as.data.frame(VEC_Lit_VLR1) #Converting the Litter vector to a data frame
    VEC_LitDF_VLR1$MNumber <- seq(from = 1, to = SimulationLength_months)
    VEC_ManDF_VLR1 <- as.data.frame(VEC_Man_VLR1) #Converting the Manure vector to a data frame
    VEC_ManDF_VLR1$MNumber <- seq(from = 1, to = SimulationLength_months)

    sapply(VEC_LitDF_VLR1, class) #Check that class is numeric
    sapply(VEC_ManDF_VLR1, class) #Check that class is numeric
    LitterCinputs_VLR1=VEC_LitDF_VLR1   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    ManureCinputs_VLR1=VEC_ManDF_VLR1 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    MCinputs_VLR1 <- merge(LitterCinputs_VLR1, ManureCinputs_VLR1, by = "MNumber")
    MCinputs_VLR1$MInput_VLR1 <- MCinputs_VLR1$VEC_Lit_VLR1 + MCinputs_VLR1$VEC_Man_VLR1

    #Change names of litter and manure columns for more common ones
    colnames(MCinputs_VLR1)[which(names(MCinputs_VLR1) == "VEC_Lit_VLR1")] <- "LitterC_VLR1"
    colnames(MCinputs_VLR1)[which(names(MCinputs_VLR1) == "VEC_Man_VLR1")] <- "ManureC_VLR1"

    #Create a dataframe with the data considering the simulation length
    ModelDF_VLR1 <- as.data.frame(Ct_VLR1)
    colnames(ModelDF_VLR1) <- c('DPM_VLR1','RPM_VLR1','BIO_VLR1', 'HUM_VLR1', 'IOM_VLR1')
    ModelDFS_VLR1 <- ModelDF_VLR1[1:SimulationLength_months, ]

    #Create a column with the number of month of analysis
    ModelDFS_VLR1$MNumber <- seq(from = 1, to = SimulationLength_months)

    #Create a column that sums all pools
    ModelDFS_VLR1$AllPools_VLR1 <- ModelDFS_VLR1$DPM_VLR1 + ModelDFS_VLR1$RPM_VLR1 + ModelDFS_VLR1$BIO_VLR1 + ModelDFS_VLR1$HUM_VLR1 + ModelDFS_VLR1$IOM_VLR1

    #Create a column that sums all pools except IOM (static)
    ModelDFS_VLR1$AllPools_noIOM_VLR1 <- ModelDFS_VLR1$DPM_VLR1 + ModelDFS_VLR1$RPM_VLR1 + ModelDFS_VLR1$BIO_VLR1 + ModelDFS_VLR1$HUM_VLR1

    #Create a column that add the monthly input of C (manure and litter separately)
    ModelDFSL_VLR1 <- merge(ModelDFS_VLR1, MCinputs_VLR1, by = "MNumber")

    ModelDFSL_VLR1$MInput_VLR1 <- ModelDFSL_VLR1$LitterC_VLR1 + ModelDFSL_VLR1$ManureC_VLR1
    #ModelDF_SL$MInput[1] <- 0

    #Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
    ModelDFSL_VLR1$CTails_VLR1 <- ModelDFSL_VLR1$AllPools_noIOM_VLR1 + ModelDFSL_VLR1$MInput_VLR1

    #Create Monthly Accumulated input of C
    ModelDFSL_VLR1$AccumInput_VLR1 = ModelDFSL_VLR1$AccumInput_VLR1=cumsum(ModelDFSL_VLR1$MInput_VLR1)

    #Create Monthly Growths for each carbon pool
    ModelDFSL_VLR1$MGrowth_DPM_VLR1 <- ave(ModelDFSL_VLR1$DPM_VLR1, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLR1$MGrowth_RPM_VLR1 <- ave(ModelDFSL_VLR1$RPM_VLR1, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLR1$MGrowth_BIO_VLR1 <- ave(ModelDFSL_VLR1$BIO_VLR1, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLR1$MGrowth_HUM_VLR1 <- ave(ModelDFSL_VLR1$HUM_VLR1, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLR1$MGrowth_IOM_VLR1 <- ave(ModelDFSL_VLR1$IOM_VLR1, FUN = function(x) c(0, diff(x)))

    #Create column for Monthly and Accumulated C-CO2 emissions
    ModelDFSL_VLR1$M_CCO2_VLR1 <- ModelDFSL_VLR1$MInput_VLR1 - ModelDFSL_VLR1$MGrowth_DPM_VLR1 - ModelDFSL_VLR1$MGrowth_RPM_VLR1 - ModelDFSL_VLR1$MGrowth_BIO_VLR1 - ModelDFSL_VLR1$MGrowth_HUM_VLR1
    ModelDFSL_VLR1$Accum_CCO2_VLR1 <- ModelDFSL_VLR1$AccumInput_VLR1 - ModelDFSL_VLR1$AllPools_noIOM_VLR1

    #Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
    ModelDFSL_VLR1$M_CCO2_VLR1[1] <- 0
    ModelDFSL_VLR1$Accum_CCO2_VLR1[1] <- 0

    #Balance validation
    ModelDFSL_VLR1$Balance_VLR1 <- ModelDFSL_VLR1$AccumInput_VLR1 - ModelDFSL_VLR1$Accum_CCO2_VLR1 - (ModelDFSL_VLR1$DPM_VLR1 + ModelDFSL_VLR1$RPM_VLR1 + ModelDFSL_VLR1$BIO_VLR1 + ModelDFSL_VLR1$HUM_VLR1)

    #Convert C-CO2 emissions into CO2 emissions
    ModelDFSL_VLR1$M_CO2_VLR1 <- ModelDFSL_VLR1$M_CCO2_VLR1 * 44/12
    ModelDFSL_VLR1$Accum_CO2_VLR1 <- ModelDFSL_VLR1$Accum_CCO2_VLR1 * 44/12

    #This model will be called VLR1C because implies a continuous input of C
    ModelDFSL_VLR1C <- ModelDFSL_VLR1

    #Export the dataframe
    write_xlsx(ModelDFSL_VLR1C,"VXC_Models\\ModelDFSL_R_VLR1C.xlsx")

    #Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
    #Create two equal models by using the above general script
    #Create model t=x
    ModelDFSLt0_VLR1 <- ModelDFSL_VLR1 #Create model t=x

    #Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
    ModelDFSLt1_VLR1.1 <- rbind(c(0:0), ModelDFSLt0_VLR1)
    ModelDFSLt1_VLR1.2 <- rbind(c(0:0), ModelDFSLt1_VLR1.1)
    ModelDFSLt1_VLR1.3 <- rbind(c(0:0), ModelDFSLt1_VLR1.2)
    ModelDFSLt1_VLR1.4 <- rbind(c(0:0), ModelDFSLt1_VLR1.3)
    ModelDFSLt1_VLR1.5 <- rbind(c(0:0), ModelDFSLt1_VLR1.4)
    ModelDFSLt1_VLR1.6 <- rbind(c(0:0), ModelDFSLt1_VLR1.5)
    ModelDFSLt1_VLR1.7 <- rbind(c(0:0), ModelDFSLt1_VLR1.6)
    ModelDFSLt1_VLR1.8 <- rbind(c(0:0), ModelDFSLt1_VLR1.7)
    ModelDFSLt1_VLR1.9 <- rbind(c(0:0), ModelDFSLt1_VLR1.8)
    ModelDFSLt1_VLR1.10 <- rbind(c(0:0), ModelDFSLt1_VLR1.9)
    ModelDFSLt1_VLR1.11 <- rbind(c(0:0), ModelDFSLt1_VLR1.10)
    ModelDFSLt1_VLR1.12 <- rbind(c(0:0), ModelDFSLt1_VLR1.11)
    ModelDFSLt1_VLR1.13 <- ModelDFSLt1_VLR1.12[-nrow(ModelDFSLt1_VLR1.12),]
    ModelDFSLt1_VLR1.14 <- ModelDFSLt1_VLR1.13[-nrow(ModelDFSLt1_VLR1.13),]
    ModelDFSLt1_VLR1.15 <- ModelDFSLt1_VLR1.14[-nrow(ModelDFSLt1_VLR1.14),]
    ModelDFSLt1_VLR1.16 <- ModelDFSLt1_VLR1.15[-nrow(ModelDFSLt1_VLR1.15),]
    ModelDFSLt1_VLR1.17 <- ModelDFSLt1_VLR1.16[-nrow(ModelDFSLt1_VLR1.16),]
    ModelDFSLt1_VLR1.18 <- ModelDFSLt1_VLR1.17[-nrow(ModelDFSLt1_VLR1.17),]
    ModelDFSLt1_VLR1.19 <- ModelDFSLt1_VLR1.18[-nrow(ModelDFSLt1_VLR1.18),]
    ModelDFSLt1_VLR1.20 <- ModelDFSLt1_VLR1.19[-nrow(ModelDFSLt1_VLR1.19),]
    ModelDFSLt1_VLR1.21 <- ModelDFSLt1_VLR1.20[-nrow(ModelDFSLt1_VLR1.20),]
    ModelDFSLt1_VLR1.22 <- ModelDFSLt1_VLR1.21[-nrow(ModelDFSLt1_VLR1.21),]
    ModelDFSLt1_VLR1.23 <- ModelDFSLt1_VLR1.22[-nrow(ModelDFSLt1_VLR1.22),]
    ModelDFSLt1_VLR1.24 <- ModelDFSLt1_VLR1.23[-nrow(ModelDFSLt1_VLR1.23),]

    ModelDFSLt1_VLR1 <- ModelDFSLt1_VLR1.24 #Create model t=x+1

    #Subtract model (t=x) - (t=x+1)
    ModelDFSL1y_VLR1 <- ModelDFSLt0_VLR1 - ModelDFSLt1_VLR1

    #Re-do Month Number column because the substraction was also applied to it
    ModelDFSL1y_VLR1$MNumber <- seq(from = 1, to = SimulationLength_months)

    #This model will be called VLR1P because implies a one-off input of C
    ModelDFSL_VLR1P <- ModelDFSL1y_VLR1

    #Export the dataframe
    write_xlsx(ModelDFSL_VLR1P,"VXP_Models\\ModelDFSL_R_VLR1P.xlsx")

    #Plot 3: Interactive Yearly CO2 emissions #
    MY <- 12
    ModelDFSL_VLR1P_YCO2 <- ModelDFSL_VLR1P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VLR1)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLR1P_YCO2) <- c("Year", "Months", "AnnualCO2_VLR_1")

    #Plot 3: Interactive Yearly CO2 emissions considering a delay
    GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
    ModelDFSL_VLR1P_YCO2D <- merge(ModelDFSL_VLR1P_YCO2, GWP100delay, by = "Year")
    ModelDFSL_VLR1P_YCO2D$AnnualCO2D_VLR_1 <- ModelDFSL_VLR1P_YCO2D$AnnualCO2_VLR_1 * ModelDFSL_VLR1P_YCO2D$GWP100

    #Plot 4: Interactive Yearly C emissions #
    MY <- 12
    ModelDFSL_VLR1P_YC <- ModelDFSL_VLR1P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VLR1)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLR1P_YC) <- c("Year", "Months", "CEmissions_VLR_1")

    #Plot 5: Interactive Yearly C tails (remaining C in Soil) #
    MY <- 12
    ModelDFSL_VLR1P_YCT <- ModelDFSL_VLR1P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VLR1)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLR1P_YCT) <- c("Year", "Months", "CTail_VLR_1")

    #Save Dataframes for Plots 3.1, 3.2, 4 and 5
    write_xlsx(ModelDFSL_VLR1P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VLR1P.xlsx") #Yearly CO2 emissions (no delay)
    write_xlsx(ModelDFSL_VLR1P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VLR1P.xlsx") #Yearly CO2 emissions (delay)
    write_xlsx(ModelDFSL_VLR1P_YC,"CEmissions_P\\ModelDFSL_R_CE_VLR1P.xlsx") #Yearly C emissions
    write_xlsx(ModelDFSL_VLR1P_YCT,"CTails_P\\ModelDFSL_R_CT_VLR1P.xlsx") #Yearly C emissions



#### 8.3 - VLR2) Litter; 20%clay; Reduced Tillage ####
    #The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
    fT_VLR2=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
    fW_VLR2=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                            S.Thick = soil.thick, pClay = clay100*0.2,
                            pE = 1.0, bare = FALSE)$b #Moisture effects per month
    xi.frame_VLR2=data.frame(years,rep(fT_VLR2*fW_VLR2,length.out=length(years)))

    #To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
    Model_VLR2=SoilR::RothCModel(
      t=years, #Simulation Length
      ks=c(k.DPM = 10*RTRM, k.RPM = 0.3*RTRM, k.BIO = 0.66*RTRM, k.HUM = 0.02*RTRM, k.IOM = 0*RTRM), #Decomposition rates for the different pools
      C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
      In=Scalar_LitterCinputs*1, #Amount of litter inputs by time
      FYM = Scalar_ManureCinputs*0, #Amount of Farm Yard Manure by time
      clay=clay100*0.2, #Percent clay in mineral soil
      xi=xi.frame_VLR2) #Loads the model

    Ct_VLR2=getC(Model_VLR2) #Calculates stocks for each pool per month

    #The results can be plotted with the commands
    matplot(years, Ct_VLR2, type="l", lty=1, col=1:5,
            xlab="Time (years)", ylab="C stocks (Mg/ha)")
    legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
           lty=1, col=1:5, bty="n")

    VEC_Lit_VLR2 <- rep(M_Scalar_LitterCinputs*1, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
    VEC_Man_VLR2 <- rep(M_Scalar_ManureCinputs*0, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

    VEC_LitDF_VLR2 <- as.data.frame(VEC_Lit_VLR2) #Converting the Litter vector to a data frame
    VEC_LitDF_VLR2$MNumber <- seq(from = 1, to = SimulationLength_months)
    VEC_ManDF_VLR2 <- as.data.frame(VEC_Man_VLR2) #Converting the Manure vector to a data frame
    VEC_ManDF_VLR2$MNumber <- seq(from = 1, to = SimulationLength_months)

    sapply(VEC_LitDF_VLR2, class) #Check that class is numeric
    sapply(VEC_ManDF_VLR2, class) #Check that class is numeric
    LitterCinputs_VLR2=VEC_LitDF_VLR2   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    ManureCinputs_VLR2=VEC_ManDF_VLR2 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    MCinputs_VLR2 <- merge(LitterCinputs_VLR2, ManureCinputs_VLR2, by = "MNumber")
    MCinputs_VLR2$MInput_VLR2 <- MCinputs_VLR2$VEC_Lit_VLR2 + MCinputs_VLR2$VEC_Man_VLR2

    #Change names of litter and manure columns for more common ones
    colnames(MCinputs_VLR2)[which(names(MCinputs_VLR2) == "VEC_Lit_VLR2")] <- "LitterC_VLR2"
    colnames(MCinputs_VLR2)[which(names(MCinputs_VLR2) == "VEC_Man_VLR2")] <- "ManureC_VLR2"

    #Create a dataframe with the data considering the simulation length
    ModelDF_VLR2 <- as.data.frame(Ct_VLR2)
    colnames(ModelDF_VLR2) <- c('DPM_VLR2','RPM_VLR2','BIO_VLR2', 'HUM_VLR2', 'IOM_VLR2')
    ModelDFS_VLR2 <- ModelDF_VLR2[1:SimulationLength_months, ]

    #Create a column with the number of month of analysis
    ModelDFS_VLR2$MNumber <- seq(from = 1, to = SimulationLength_months)

    #Create a column that sums all pools
    ModelDFS_VLR2$AllPools_VLR2 <- ModelDFS_VLR2$DPM_VLR2 + ModelDFS_VLR2$RPM_VLR2 + ModelDFS_VLR2$BIO_VLR2 + ModelDFS_VLR2$HUM_VLR2 + ModelDFS_VLR2$IOM_VLR2

    #Create a column that sums all pools except IOM (static)
    ModelDFS_VLR2$AllPools_noIOM_VLR2 <- ModelDFS_VLR2$DPM_VLR2 + ModelDFS_VLR2$RPM_VLR2 + ModelDFS_VLR2$BIO_VLR2 + ModelDFS_VLR2$HUM_VLR2

    #Create a column that add the monthly input of C (manure and litter separately)
    ModelDFSL_VLR2 <- merge(ModelDFS_VLR2, MCinputs_VLR2, by = "MNumber")

    ModelDFSL_VLR2$MInput_VLR2 <- ModelDFSL_VLR2$LitterC_VLR2 + ModelDFSL_VLR2$ManureC_VLR2
    #ModelDF_SL$MInput[1] <- 0

    #Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
    ModelDFSL_VLR2$CTails_VLR2 <- ModelDFSL_VLR2$AllPools_noIOM_VLR2 + ModelDFSL_VLR2$MInput_VLR2

    #Create Monthly Accumulated input of C
    ModelDFSL_VLR2$AccumInput_VLR2 = ModelDFSL_VLR2$AccumInput_VLR2=cumsum(ModelDFSL_VLR2$MInput_VLR2)

    #Create Monthly Growths for each carbon pool
    ModelDFSL_VLR2$MGrowth_DPM_VLR2 <- ave(ModelDFSL_VLR2$DPM_VLR2, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLR2$MGrowth_RPM_VLR2 <- ave(ModelDFSL_VLR2$RPM_VLR2, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLR2$MGrowth_BIO_VLR2 <- ave(ModelDFSL_VLR2$BIO_VLR2, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLR2$MGrowth_HUM_VLR2 <- ave(ModelDFSL_VLR2$HUM_VLR2, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLR2$MGrowth_IOM_VLR2 <- ave(ModelDFSL_VLR2$IOM_VLR2, FUN = function(x) c(0, diff(x)))

    #Create column for Monthly and Accumulated C-CO2 emissions
    ModelDFSL_VLR2$M_CCO2_VLR2 <- ModelDFSL_VLR2$MInput_VLR2 - ModelDFSL_VLR2$MGrowth_DPM_VLR2 - ModelDFSL_VLR2$MGrowth_RPM_VLR2 - ModelDFSL_VLR2$MGrowth_BIO_VLR2 - ModelDFSL_VLR2$MGrowth_HUM_VLR2
    ModelDFSL_VLR2$Accum_CCO2_VLR2 <- ModelDFSL_VLR2$AccumInput_VLR2 - ModelDFSL_VLR2$AllPools_noIOM_VLR2

    #Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
    ModelDFSL_VLR2$M_CCO2_VLR2[1] <- 0
    ModelDFSL_VLR2$Accum_CCO2_VLR2[1] <- 0

    #Balance validation
    ModelDFSL_VLR2$Balance_VLR2 <- ModelDFSL_VLR2$AccumInput_VLR2 - ModelDFSL_VLR2$Accum_CCO2_VLR2 - (ModelDFSL_VLR2$DPM_VLR2 + ModelDFSL_VLR2$RPM_VLR2 + ModelDFSL_VLR2$BIO_VLR2 + ModelDFSL_VLR2$HUM_VLR2)

    #Convert C-CO2 emissions into CO2 emissions
    ModelDFSL_VLR2$M_CO2_VLR2 <- ModelDFSL_VLR2$M_CCO2_VLR2 * 44/12
    ModelDFSL_VLR2$Accum_CO2_VLR2 <- ModelDFSL_VLR2$Accum_CCO2_VLR2 * 44/12

    #This model will be called VLR2C because implies a continuous input of C
    ModelDFSL_VLR2C <- ModelDFSL_VLR2

    #Export the dataframe
    write_xlsx(ModelDFSL_VLR2C,"VXC_Models\\ModelDFSL_R_VLR2C.xlsx")

    #Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
    #Create two equal models by using the above general script
    #Create model t=x
    ModelDFSLt0_VLR2 <- ModelDFSL_VLR2 #Create model t=x

    #Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
    ModelDFSLt1_VLR2.1 <- rbind(c(0:0), ModelDFSLt0_VLR2)
    ModelDFSLt1_VLR2.2 <- rbind(c(0:0), ModelDFSLt1_VLR2.1)
    ModelDFSLt1_VLR2.3 <- rbind(c(0:0), ModelDFSLt1_VLR2.2)
    ModelDFSLt1_VLR2.4 <- rbind(c(0:0), ModelDFSLt1_VLR2.3)
    ModelDFSLt1_VLR2.5 <- rbind(c(0:0), ModelDFSLt1_VLR2.4)
    ModelDFSLt1_VLR2.6 <- rbind(c(0:0), ModelDFSLt1_VLR2.5)
    ModelDFSLt1_VLR2.7 <- rbind(c(0:0), ModelDFSLt1_VLR2.6)
    ModelDFSLt1_VLR2.8 <- rbind(c(0:0), ModelDFSLt1_VLR2.7)
    ModelDFSLt1_VLR2.9 <- rbind(c(0:0), ModelDFSLt1_VLR2.8)
    ModelDFSLt1_VLR2.10 <- rbind(c(0:0), ModelDFSLt1_VLR2.9)
    ModelDFSLt1_VLR2.11 <- rbind(c(0:0), ModelDFSLt1_VLR2.10)
    ModelDFSLt1_VLR2.12 <- rbind(c(0:0), ModelDFSLt1_VLR2.11)
    ModelDFSLt1_VLR2.13 <- ModelDFSLt1_VLR2.12[-nrow(ModelDFSLt1_VLR2.12),]
    ModelDFSLt1_VLR2.14 <- ModelDFSLt1_VLR2.13[-nrow(ModelDFSLt1_VLR2.13),]
    ModelDFSLt1_VLR2.15 <- ModelDFSLt1_VLR2.14[-nrow(ModelDFSLt1_VLR2.14),]
    ModelDFSLt1_VLR2.16 <- ModelDFSLt1_VLR2.15[-nrow(ModelDFSLt1_VLR2.15),]
    ModelDFSLt1_VLR2.17 <- ModelDFSLt1_VLR2.16[-nrow(ModelDFSLt1_VLR2.16),]
    ModelDFSLt1_VLR2.18 <- ModelDFSLt1_VLR2.17[-nrow(ModelDFSLt1_VLR2.17),]
    ModelDFSLt1_VLR2.19 <- ModelDFSLt1_VLR2.18[-nrow(ModelDFSLt1_VLR2.18),]
    ModelDFSLt1_VLR2.20 <- ModelDFSLt1_VLR2.19[-nrow(ModelDFSLt1_VLR2.19),]
    ModelDFSLt1_VLR2.21 <- ModelDFSLt1_VLR2.20[-nrow(ModelDFSLt1_VLR2.20),]
    ModelDFSLt1_VLR2.22 <- ModelDFSLt1_VLR2.21[-nrow(ModelDFSLt1_VLR2.21),]
    ModelDFSLt1_VLR2.23 <- ModelDFSLt1_VLR2.22[-nrow(ModelDFSLt1_VLR2.22),]
    ModelDFSLt1_VLR2.24 <- ModelDFSLt1_VLR2.23[-nrow(ModelDFSLt1_VLR2.23),]

    ModelDFSLt1_VLR2 <- ModelDFSLt1_VLR2.24 #Create model t=x+1

    #Subtract model (t=x) - (t=x+1)
    ModelDFSL1y_VLR2 <- ModelDFSLt0_VLR2 - ModelDFSLt1_VLR2

    #Re-do Month Number column because the substraction was also applied to it
    ModelDFSL1y_VLR2$MNumber <- seq(from = 1, to = SimulationLength_months)

    #This model will be called VLR2P because implies a one-off input of C
    ModelDFSL_VLR2P <- ModelDFSL1y_VLR2

    #Export the dataframe
    write_xlsx(ModelDFSL_VLR2P,"VXP_Models\\ModelDFSL_R_VLR2P.xlsx")

    #Plot 3: Interactive Yearly CO2 emissions #
    MY <- 12
    ModelDFSL_VLR2P_YCO2 <- ModelDFSL_VLR2P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VLR2)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLR2P_YCO2) <- c("Year", "Months", "AnnualCO2_VLR_2")

    #Plot 3: Interactive Yearly CO2 emissions considering a delay
    GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
    ModelDFSL_VLR2P_YCO2D <- merge(ModelDFSL_VLR2P_YCO2, GWP100delay, by = "Year")
    ModelDFSL_VLR2P_YCO2D$AnnualCO2D_VLR_2 <- ModelDFSL_VLR2P_YCO2D$AnnualCO2_VLR_2 * ModelDFSL_VLR2P_YCO2D$GWP100

    #Plot 4: Interactive Yearly C emissions #
    MY <- 12
    ModelDFSL_VLR2P_YC <- ModelDFSL_VLR2P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VLR2)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLR2P_YC) <- c("Year", "Months", "CEmissions_VLR_2")

    #Plot 5: Interactive Yearly C tails (remaining C in Soil) #
    MY <- 12
    ModelDFSL_VLR2P_YCT <- ModelDFSL_VLR2P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VLR2)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLR2P_YCT) <- c("Year", "Months", "CTail_VLR_2")

    #Save Dataframes for Plots 3.1, 3.2, 4 and 5
    write_xlsx(ModelDFSL_VLR2P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VLR2P.xlsx") #Yearly CO2 emissions (no delay)
    write_xlsx(ModelDFSL_VLR2P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VLR2P.xlsx") #Yearly CO2 emissions (delay)
    write_xlsx(ModelDFSL_VLR2P_YC,"CEmissions_P\\ModelDFSL_R_CE_VLR2P.xlsx") #Yearly C emissions
    write_xlsx(ModelDFSL_VLR2P_YCT,"CTails_P\\ModelDFSL_R_CT_VLR2P.xlsx") #Yearly C emissions



#### 8.4 - VLR3) Litter; 30%clay; Reduced Tillage ####
    #The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
    fT_VLR3=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
    fW_VLR3=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                            S.Thick = soil.thick, pClay = clay100*0.3,
                            pE = 1.0, bare = FALSE)$b #Moisture effects per month
    xi.frame_VLR3=data.frame(years,rep(fT_VLR3*fW_VLR3,length.out=length(years)))

    #To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
    Model_VLR3=SoilR::RothCModel(
      t=years, #Simulation Length
      ks=c(k.DPM = 10*RTRM, k.RPM = 0.3*RTRM, k.BIO = 0.66*RTRM, k.HUM = 0.02*RTRM, k.IOM = 0*RTRM), #Decomposition rates for the different pools
      C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
      In=Scalar_LitterCinputs*1, #Amount of litter inputs by time
      FYM = Scalar_ManureCinputs*0, #Amount of Farm Yard Manure by time
      clay=clay100*0.3, #Percent clay in mineral soil
      xi=xi.frame_VLR3) #Loads the model

    Ct_VLR3=getC(Model_VLR3) #Calculates stocks for each pool per month

    #The results can be plotted with the commands
    matplot(years, Ct_VLR3, type="l", lty=1, col=1:5,
            xlab="Time (years)", ylab="C stocks (Mg/ha)")
    legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
           lty=1, col=1:5, bty="n")

    VEC_Lit_VLR3 <- rep(M_Scalar_LitterCinputs*1, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
    VEC_Man_VLR3 <- rep(M_Scalar_ManureCinputs*0, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

    VEC_LitDF_VLR3 <- as.data.frame(VEC_Lit_VLR3) #Converting the Litter vector to a data frame
    VEC_LitDF_VLR3$MNumber <- seq(from = 1, to = SimulationLength_months)
    VEC_ManDF_VLR3 <- as.data.frame(VEC_Man_VLR3) #Converting the Manure vector to a data frame
    VEC_ManDF_VLR3$MNumber <- seq(from = 1, to = SimulationLength_months)

    sapply(VEC_LitDF_VLR3, class) #Check that class is numeric
    sapply(VEC_ManDF_VLR3, class) #Check that class is numeric
    LitterCinputs_VLR3=VEC_LitDF_VLR3   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    ManureCinputs_VLR3=VEC_ManDF_VLR3 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    MCinputs_VLR3 <- merge(LitterCinputs_VLR3, ManureCinputs_VLR3, by = "MNumber")
    MCinputs_VLR3$MInput_VLR3 <- MCinputs_VLR3$VEC_Lit_VLR3 + MCinputs_VLR3$VEC_Man_VLR3

    #Change names of litter and manure columns for more common ones
    colnames(MCinputs_VLR3)[which(names(MCinputs_VLR3) == "VEC_Lit_VLR3")] <- "LitterC_VLR3"
    colnames(MCinputs_VLR3)[which(names(MCinputs_VLR3) == "VEC_Man_VLR3")] <- "ManureC_VLR3"

    #Create a dataframe with the data considering the simulation length
    ModelDF_VLR3 <- as.data.frame(Ct_VLR3)
    colnames(ModelDF_VLR3) <- c('DPM_VLR3','RPM_VLR3','BIO_VLR3', 'HUM_VLR3', 'IOM_VLR3')
    ModelDFS_VLR3 <- ModelDF_VLR3[1:SimulationLength_months, ]

    #Create a column with the number of month of analysis
    ModelDFS_VLR3$MNumber <- seq(from = 1, to = SimulationLength_months)

    #Create a column that sums all pools
    ModelDFS_VLR3$AllPools_VLR3 <- ModelDFS_VLR3$DPM_VLR3 + ModelDFS_VLR3$RPM_VLR3 + ModelDFS_VLR3$BIO_VLR3 + ModelDFS_VLR3$HUM_VLR3 + ModelDFS_VLR3$IOM_VLR3

    #Create a column that sums all pools except IOM (static)
    ModelDFS_VLR3$AllPools_noIOM_VLR3 <- ModelDFS_VLR3$DPM_VLR3 + ModelDFS_VLR3$RPM_VLR3 + ModelDFS_VLR3$BIO_VLR3 + ModelDFS_VLR3$HUM_VLR3

    #Create a column that add the monthly input of C (manure and litter separately)
    ModelDFSL_VLR3 <- merge(ModelDFS_VLR3, MCinputs_VLR3, by = "MNumber")

    ModelDFSL_VLR3$MInput_VLR3 <- ModelDFSL_VLR3$LitterC_VLR3 + ModelDFSL_VLR3$ManureC_VLR3
    #ModelDF_SL$MInput[1] <- 0

    #Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
    ModelDFSL_VLR3$CTails_VLR3 <- ModelDFSL_VLR3$AllPools_noIOM_VLR3 + ModelDFSL_VLR3$MInput_VLR3

    #Create Monthly Accumulated input of C
    ModelDFSL_VLR3$AccumInput_VLR3 = ModelDFSL_VLR3$AccumInput_VLR3=cumsum(ModelDFSL_VLR3$MInput_VLR3)

    #Create Monthly Growths for each carbon pool
    ModelDFSL_VLR3$MGrowth_DPM_VLR3 <- ave(ModelDFSL_VLR3$DPM_VLR3, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLR3$MGrowth_RPM_VLR3 <- ave(ModelDFSL_VLR3$RPM_VLR3, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLR3$MGrowth_BIO_VLR3 <- ave(ModelDFSL_VLR3$BIO_VLR3, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLR3$MGrowth_HUM_VLR3 <- ave(ModelDFSL_VLR3$HUM_VLR3, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLR3$MGrowth_IOM_VLR3 <- ave(ModelDFSL_VLR3$IOM_VLR3, FUN = function(x) c(0, diff(x)))

    #Create column for Monthly and Accumulated C-CO2 emissions
    ModelDFSL_VLR3$M_CCO2_VLR3 <- ModelDFSL_VLR3$MInput_VLR3 - ModelDFSL_VLR3$MGrowth_DPM_VLR3 - ModelDFSL_VLR3$MGrowth_RPM_VLR3 - ModelDFSL_VLR3$MGrowth_BIO_VLR3 - ModelDFSL_VLR3$MGrowth_HUM_VLR3
    ModelDFSL_VLR3$Accum_CCO2_VLR3 <- ModelDFSL_VLR3$AccumInput_VLR3 - ModelDFSL_VLR3$AllPools_noIOM_VLR3

    #Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
    ModelDFSL_VLR3$M_CCO2_VLR3[1] <- 0
    ModelDFSL_VLR3$Accum_CCO2_VLR3[1] <- 0

    #Balance validation
    ModelDFSL_VLR3$Balance_VLR3 <- ModelDFSL_VLR3$AccumInput_VLR3 - ModelDFSL_VLR3$Accum_CCO2_VLR3 - (ModelDFSL_VLR3$DPM_VLR3 + ModelDFSL_VLR3$RPM_VLR3 + ModelDFSL_VLR3$BIO_VLR3 + ModelDFSL_VLR3$HUM_VLR3)

    #Convert C-CO2 emissions into CO2 emissions
    ModelDFSL_VLR3$M_CO2_VLR3 <- ModelDFSL_VLR3$M_CCO2_VLR3 * 44/12
    ModelDFSL_VLR3$Accum_CO2_VLR3 <- ModelDFSL_VLR3$Accum_CCO2_VLR3 * 44/12

    #This model will be called VLR3C because implies a continuous input of C
    ModelDFSL_VLR3C <- ModelDFSL_VLR3

    #Export the dataframe
    write_xlsx(ModelDFSL_VLR3C,"VXC_Models\\ModelDFSL_R_VLR3C.xlsx")

    #Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
    #Create two equal models by using the above general script
    #Create model t=x
    ModelDFSLt0_VLR3 <- ModelDFSL_VLR3 #Create model t=x

    #Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
    ModelDFSLt1_VLR3.1 <- rbind(c(0:0), ModelDFSLt0_VLR3)
    ModelDFSLt1_VLR3.2 <- rbind(c(0:0), ModelDFSLt1_VLR3.1)
    ModelDFSLt1_VLR3.3 <- rbind(c(0:0), ModelDFSLt1_VLR3.2)
    ModelDFSLt1_VLR3.4 <- rbind(c(0:0), ModelDFSLt1_VLR3.3)
    ModelDFSLt1_VLR3.5 <- rbind(c(0:0), ModelDFSLt1_VLR3.4)
    ModelDFSLt1_VLR3.6 <- rbind(c(0:0), ModelDFSLt1_VLR3.5)
    ModelDFSLt1_VLR3.7 <- rbind(c(0:0), ModelDFSLt1_VLR3.6)
    ModelDFSLt1_VLR3.8 <- rbind(c(0:0), ModelDFSLt1_VLR3.7)
    ModelDFSLt1_VLR3.9 <- rbind(c(0:0), ModelDFSLt1_VLR3.8)
    ModelDFSLt1_VLR3.10 <- rbind(c(0:0), ModelDFSLt1_VLR3.9)
    ModelDFSLt1_VLR3.11 <- rbind(c(0:0), ModelDFSLt1_VLR3.10)
    ModelDFSLt1_VLR3.12 <- rbind(c(0:0), ModelDFSLt1_VLR3.11)
    ModelDFSLt1_VLR3.13 <- ModelDFSLt1_VLR3.12[-nrow(ModelDFSLt1_VLR3.12),]
    ModelDFSLt1_VLR3.14 <- ModelDFSLt1_VLR3.13[-nrow(ModelDFSLt1_VLR3.13),]
    ModelDFSLt1_VLR3.15 <- ModelDFSLt1_VLR3.14[-nrow(ModelDFSLt1_VLR3.14),]
    ModelDFSLt1_VLR3.16 <- ModelDFSLt1_VLR3.15[-nrow(ModelDFSLt1_VLR3.15),]
    ModelDFSLt1_VLR3.17 <- ModelDFSLt1_VLR3.16[-nrow(ModelDFSLt1_VLR3.16),]
    ModelDFSLt1_VLR3.18 <- ModelDFSLt1_VLR3.17[-nrow(ModelDFSLt1_VLR3.17),]
    ModelDFSLt1_VLR3.19 <- ModelDFSLt1_VLR3.18[-nrow(ModelDFSLt1_VLR3.18),]
    ModelDFSLt1_VLR3.20 <- ModelDFSLt1_VLR3.19[-nrow(ModelDFSLt1_VLR3.19),]
    ModelDFSLt1_VLR3.21 <- ModelDFSLt1_VLR3.20[-nrow(ModelDFSLt1_VLR3.20),]
    ModelDFSLt1_VLR3.22 <- ModelDFSLt1_VLR3.21[-nrow(ModelDFSLt1_VLR3.21),]
    ModelDFSLt1_VLR3.23 <- ModelDFSLt1_VLR3.22[-nrow(ModelDFSLt1_VLR3.22),]
    ModelDFSLt1_VLR3.24 <- ModelDFSLt1_VLR3.23[-nrow(ModelDFSLt1_VLR3.23),]

    ModelDFSLt1_VLR3 <- ModelDFSLt1_VLR3.24 #Create model t=x+1

    #Subtract model (t=x) - (t=x+1)
    ModelDFSL1y_VLR3 <- ModelDFSLt0_VLR3 - ModelDFSLt1_VLR3

    #Re-do Month Number column because the substraction was also applied to it
    ModelDFSL1y_VLR3$MNumber <- seq(from = 1, to = SimulationLength_months)

    #This model will be called VLR3P because implies a one-off input of C
    ModelDFSL_VLR3P <- ModelDFSL1y_VLR3

    #Export the dataframe
    write_xlsx(ModelDFSL_VLR3P,"VXP_Models\\ModelDFSL_R_VLR3P.xlsx")

    #Plot 3: Interactive Yearly CO2 emissions #
    MY <- 12
    ModelDFSL_VLR3P_YCO2 <- ModelDFSL_VLR3P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VLR3)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLR3P_YCO2) <- c("Year", "Months", "AnnualCO2_VLR_3")

    #Plot 3: Interactive Yearly CO2 emissions considering a delay
    GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
    ModelDFSL_VLR3P_YCO2D <- merge(ModelDFSL_VLR3P_YCO2, GWP100delay, by = "Year")
    ModelDFSL_VLR3P_YCO2D$AnnualCO2D_VLR_3 <- ModelDFSL_VLR3P_YCO2D$AnnualCO2_VLR_3 * ModelDFSL_VLR3P_YCO2D$GWP100

    #Plot 4: Interactive Yearly C emissions #
    MY <- 12
    ModelDFSL_VLR3P_YC <- ModelDFSL_VLR3P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VLR3)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLR3P_YC) <- c("Year", "Months", "CEmissions_VLR_3")

    #Plot 5: Interactive Yearly C tails (remaining C in Soil) #
    MY <- 12
    ModelDFSL_VLR3P_YCT <- ModelDFSL_VLR3P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VLR3)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLR3P_YCT) <- c("Year", "Months", "CTail_VLR_3")

    #Save Dataframes for Plots 3.1, 3.2, 4 and 5
    write_xlsx(ModelDFSL_VLR3P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VLR3P.xlsx") #Yearly CO2 emissions (no delay)
    write_xlsx(ModelDFSL_VLR3P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VLR3P.xlsx") #Yearly CO2 emissions (delay)
    write_xlsx(ModelDFSL_VLR3P_YC,"CEmissions_P\\ModelDFSL_R_CE_VLR3P.xlsx") #Yearly C emissions
    write_xlsx(ModelDFSL_VLR3P_YCT,"CTails_P\\ModelDFSL_R_CT_VLR3P.xlsx") #Yearly C emissions



#### 8.5 - VLR4) Litter; 40%clay; Reduced Tillage ####
    #The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
    fT_VLR4=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
    fW_VLR4=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                            S.Thick = soil.thick, pClay = clay100*0.4,
                            pE = 1.0, bare = FALSE)$b #Moisture effects per month
    xi.frame_VLR4=data.frame(years,rep(fT_VLR4*fW_VLR4,length.out=length(years)))

    #To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
    Model_VLR4=SoilR::RothCModel(
      t=years, #Simulation Length
      ks=c(k.DPM = 10*RTRM, k.RPM = 0.3*RTRM, k.BIO = 0.66*RTRM, k.HUM = 0.02*RTRM, k.IOM = 0*RTRM), #Decomposition rates for the different pools
      C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
      In=Scalar_LitterCinputs*1, #Amount of litter inputs by time
      FYM = Scalar_ManureCinputs*0, #Amount of Farm Yard Manure by time
      clay=clay100*0.4, #Percent clay in mineral soil
      xi=xi.frame_VLR4) #Loads the model

    Ct_VLR4=getC(Model_VLR4) #Calculates stocks for each pool per month

    #The results can be plotted with the commands
    matplot(years, Ct_VLR4, type="l", lty=1, col=1:5,
            xlab="Time (years)", ylab="C stocks (Mg/ha)")
    legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
           lty=1, col=1:5, bty="n")

    VEC_Lit_VLR4 <- rep(M_Scalar_LitterCinputs*1, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
    VEC_Man_VLR4 <- rep(M_Scalar_ManureCinputs*0, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

    VEC_LitDF_VLR4 <- as.data.frame(VEC_Lit_VLR4) #Converting the Litter vector to a data frame
    VEC_LitDF_VLR4$MNumber <- seq(from = 1, to = SimulationLength_months)
    VEC_ManDF_VLR4 <- as.data.frame(VEC_Man_VLR4) #Converting the Manure vector to a data frame
    VEC_ManDF_VLR4$MNumber <- seq(from = 1, to = SimulationLength_months)

    sapply(VEC_LitDF_VLR4, class) #Check that class is numeric
    sapply(VEC_ManDF_VLR4, class) #Check that class is numeric
    LitterCinputs_VLR4=VEC_LitDF_VLR4   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    ManureCinputs_VLR4=VEC_ManDF_VLR4 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    MCinputs_VLR4 <- merge(LitterCinputs_VLR4, ManureCinputs_VLR4, by = "MNumber")
    MCinputs_VLR4$MInput_VLR4 <- MCinputs_VLR4$VEC_Lit_VLR4 + MCinputs_VLR4$VEC_Man_VLR4

    #Change names of litter and manure columns for more common ones
    colnames(MCinputs_VLR4)[which(names(MCinputs_VLR4) == "VEC_Lit_VLR4")] <- "LitterC_VLR4"
    colnames(MCinputs_VLR4)[which(names(MCinputs_VLR4) == "VEC_Man_VLR4")] <- "ManureC_VLR4"

    #Create a dataframe with the data considering the simulation length
    ModelDF_VLR4 <- as.data.frame(Ct_VLR4)
    colnames(ModelDF_VLR4) <- c('DPM_VLR4','RPM_VLR4','BIO_VLR4', 'HUM_VLR4', 'IOM_VLR4')
    ModelDFS_VLR4 <- ModelDF_VLR4[1:SimulationLength_months, ]

    #Create a column with the number of month of analysis
    ModelDFS_VLR4$MNumber <- seq(from = 1, to = SimulationLength_months)

    #Create a column that sums all pools
    ModelDFS_VLR4$AllPools_VLR4 <- ModelDFS_VLR4$DPM_VLR4 + ModelDFS_VLR4$RPM_VLR4 + ModelDFS_VLR4$BIO_VLR4 + ModelDFS_VLR4$HUM_VLR4 + ModelDFS_VLR4$IOM_VLR4

    #Create a column that sums all pools except IOM (static)
    ModelDFS_VLR4$AllPools_noIOM_VLR4 <- ModelDFS_VLR4$DPM_VLR4 + ModelDFS_VLR4$RPM_VLR4 + ModelDFS_VLR4$BIO_VLR4 + ModelDFS_VLR4$HUM_VLR4

    #Create a column that add the monthly input of C (manure and litter separately)
    ModelDFSL_VLR4 <- merge(ModelDFS_VLR4, MCinputs_VLR4, by = "MNumber")

    ModelDFSL_VLR4$MInput_VLR4 <- ModelDFSL_VLR4$LitterC_VLR4 + ModelDFSL_VLR4$ManureC_VLR4
    #ModelDF_SL$MInput[1] <- 0

    #Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
    ModelDFSL_VLR4$CTails_VLR4 <- ModelDFSL_VLR4$AllPools_noIOM_VLR4 + ModelDFSL_VLR4$MInput_VLR4

    #Create Monthly Accumulated input of C
    ModelDFSL_VLR4$AccumInput_VLR4 = ModelDFSL_VLR4$AccumInput_VLR4=cumsum(ModelDFSL_VLR4$MInput_VLR4)

    #Create Monthly Growths for each carbon pool
    ModelDFSL_VLR4$MGrowth_DPM_VLR4 <- ave(ModelDFSL_VLR4$DPM_VLR4, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLR4$MGrowth_RPM_VLR4 <- ave(ModelDFSL_VLR4$RPM_VLR4, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLR4$MGrowth_BIO_VLR4 <- ave(ModelDFSL_VLR4$BIO_VLR4, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLR4$MGrowth_HUM_VLR4 <- ave(ModelDFSL_VLR4$HUM_VLR4, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLR4$MGrowth_IOM_VLR4 <- ave(ModelDFSL_VLR4$IOM_VLR4, FUN = function(x) c(0, diff(x)))

    #Create column for Monthly and Accumulated C-CO2 emissions
    ModelDFSL_VLR4$M_CCO2_VLR4 <- ModelDFSL_VLR4$MInput_VLR4 - ModelDFSL_VLR4$MGrowth_DPM_VLR4 - ModelDFSL_VLR4$MGrowth_RPM_VLR4 - ModelDFSL_VLR4$MGrowth_BIO_VLR4 - ModelDFSL_VLR4$MGrowth_HUM_VLR4
    ModelDFSL_VLR4$Accum_CCO2_VLR4 <- ModelDFSL_VLR4$AccumInput_VLR4 - ModelDFSL_VLR4$AllPools_noIOM_VLR4

    #Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
    ModelDFSL_VLR4$M_CCO2_VLR4[1] <- 0
    ModelDFSL_VLR4$Accum_CCO2_VLR4[1] <- 0

    #Balance validation
    ModelDFSL_VLR4$Balance_VLR4 <- ModelDFSL_VLR4$AccumInput_VLR4 - ModelDFSL_VLR4$Accum_CCO2_VLR4 - (ModelDFSL_VLR4$DPM_VLR4 + ModelDFSL_VLR4$RPM_VLR4 + ModelDFSL_VLR4$BIO_VLR4 + ModelDFSL_VLR4$HUM_VLR4)

    #Convert C-CO2 emissions into CO2 emissions
    ModelDFSL_VLR4$M_CO2_VLR4 <- ModelDFSL_VLR4$M_CCO2_VLR4 * 44/12
    ModelDFSL_VLR4$Accum_CO2_VLR4 <- ModelDFSL_VLR4$Accum_CCO2_VLR4 * 44/12

    #This model will be called VLR4C because implies a continuous input of C
    ModelDFSL_VLR4C <- ModelDFSL_VLR4

    #Export the dataframe
    write_xlsx(ModelDFSL_VLR4C,"VXC_Models\\ModelDFSL_R_VLR4C.xlsx")

    #Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
    #Create two equal models by using the above general script
    #Create model t=x
    ModelDFSLt0_VLR4 <- ModelDFSL_VLR4 #Create model t=x

    #Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
    ModelDFSLt1_VLR4.1 <- rbind(c(0:0), ModelDFSLt0_VLR4)
    ModelDFSLt1_VLR4.2 <- rbind(c(0:0), ModelDFSLt1_VLR4.1)
    ModelDFSLt1_VLR4.3 <- rbind(c(0:0), ModelDFSLt1_VLR4.2)
    ModelDFSLt1_VLR4.4 <- rbind(c(0:0), ModelDFSLt1_VLR4.3)
    ModelDFSLt1_VLR4.5 <- rbind(c(0:0), ModelDFSLt1_VLR4.4)
    ModelDFSLt1_VLR4.6 <- rbind(c(0:0), ModelDFSLt1_VLR4.5)
    ModelDFSLt1_VLR4.7 <- rbind(c(0:0), ModelDFSLt1_VLR4.6)
    ModelDFSLt1_VLR4.8 <- rbind(c(0:0), ModelDFSLt1_VLR4.7)
    ModelDFSLt1_VLR4.9 <- rbind(c(0:0), ModelDFSLt1_VLR4.8)
    ModelDFSLt1_VLR4.10 <- rbind(c(0:0), ModelDFSLt1_VLR4.9)
    ModelDFSLt1_VLR4.11 <- rbind(c(0:0), ModelDFSLt1_VLR4.10)
    ModelDFSLt1_VLR4.12 <- rbind(c(0:0), ModelDFSLt1_VLR4.11)
    ModelDFSLt1_VLR4.13 <- ModelDFSLt1_VLR4.12[-nrow(ModelDFSLt1_VLR4.12),]
    ModelDFSLt1_VLR4.14 <- ModelDFSLt1_VLR4.13[-nrow(ModelDFSLt1_VLR4.13),]
    ModelDFSLt1_VLR4.15 <- ModelDFSLt1_VLR4.14[-nrow(ModelDFSLt1_VLR4.14),]
    ModelDFSLt1_VLR4.16 <- ModelDFSLt1_VLR4.15[-nrow(ModelDFSLt1_VLR4.15),]
    ModelDFSLt1_VLR4.17 <- ModelDFSLt1_VLR4.16[-nrow(ModelDFSLt1_VLR4.16),]
    ModelDFSLt1_VLR4.18 <- ModelDFSLt1_VLR4.17[-nrow(ModelDFSLt1_VLR4.17),]
    ModelDFSLt1_VLR4.19 <- ModelDFSLt1_VLR4.18[-nrow(ModelDFSLt1_VLR4.18),]
    ModelDFSLt1_VLR4.20 <- ModelDFSLt1_VLR4.19[-nrow(ModelDFSLt1_VLR4.19),]
    ModelDFSLt1_VLR4.21 <- ModelDFSLt1_VLR4.20[-nrow(ModelDFSLt1_VLR4.20),]
    ModelDFSLt1_VLR4.22 <- ModelDFSLt1_VLR4.21[-nrow(ModelDFSLt1_VLR4.21),]
    ModelDFSLt1_VLR4.23 <- ModelDFSLt1_VLR4.22[-nrow(ModelDFSLt1_VLR4.22),]
    ModelDFSLt1_VLR4.24 <- ModelDFSLt1_VLR4.23[-nrow(ModelDFSLt1_VLR4.23),]

    ModelDFSLt1_VLR4 <- ModelDFSLt1_VLR4.24 #Create model t=x+1

    #Subtract model (t=x) - (t=x+1)
    ModelDFSL1y_VLR4 <- ModelDFSLt0_VLR4 - ModelDFSLt1_VLR4

    #Re-do Month Number column because the substraction was also applied to it
    ModelDFSL1y_VLR4$MNumber <- seq(from = 1, to = SimulationLength_months)

    #This model will be called VLR4P because implies a one-off input of C
    ModelDFSL_VLR4P <- ModelDFSL1y_VLR4

    #Export the dataframe
    write_xlsx(ModelDFSL_VLR4P,"VXP_Models\\ModelDFSL_R_VLR4P.xlsx")

    #Plot 3: Interactive Yearly CO2 emissions #
    MY <- 12
    ModelDFSL_VLR4P_YCO2 <- ModelDFSL_VLR4P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VLR4)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLR4P_YCO2) <- c("Year", "Months", "AnnualCO2_VLR_4")

    #Plot 3: Interactive Yearly CO2 emissions considering a delay
    GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
    ModelDFSL_VLR4P_YCO2D <- merge(ModelDFSL_VLR4P_YCO2, GWP100delay, by = "Year")
    ModelDFSL_VLR4P_YCO2D$AnnualCO2D_VLR_4 <- ModelDFSL_VLR4P_YCO2D$AnnualCO2_VLR_4 * ModelDFSL_VLR4P_YCO2D$GWP100

    #Plot 4: Interactive Yearly C emissions #
    MY <- 12
    ModelDFSL_VLR4P_YC <- ModelDFSL_VLR4P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VLR4)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLR4P_YC) <- c("Year", "Months", "CEmissions_VLR_4")

    #Plot 5: Interactive Yearly C tails (remaining C in Soil) #
    MY <- 12
    ModelDFSL_VLR4P_YCT <- ModelDFSL_VLR4P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VLR4)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLR4P_YCT) <- c("Year", "Months", "CTail_VLR_4")

    #Save Dataframes for Plots 3.1, 3.2, 4 and 5
    write_xlsx(ModelDFSL_VLR4P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VLR4P.xlsx") #Yearly CO2 emissions (no delay)
    write_xlsx(ModelDFSL_VLR4P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VLR4P.xlsx") #Yearly CO2 emissions (delay)
    write_xlsx(ModelDFSL_VLR4P_YC,"CEmissions_P\\ModelDFSL_R_CE_VLR4P.xlsx") #Yearly C emissions
    write_xlsx(ModelDFSL_VLR4P_YCT,"CTails_P\\ModelDFSL_R_CT_VLR4P.xlsx") #Yearly C emissions



#### 8.6 - VLR5) Litter; 50%clay; Reduced Tillage ####
    #The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
    fT_VLR5=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
    fW_VLR5=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                            S.Thick = soil.thick, pClay = clay100*0.5,
                            pE = 1.0, bare = FALSE)$b #Moisture effects per month
    xi.frame_VLR5=data.frame(years,rep(fT_VLR5*fW_VLR5,length.out=length(years)))

    #To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
    Model_VLR5=SoilR::RothCModel(
      t=years, #Simulation Length
      ks=c(k.DPM = 10*RTRM, k.RPM = 0.3*RTRM, k.BIO = 0.66*RTRM, k.HUM = 0.02*RTRM, k.IOM = 0*RTRM), #Decomposition rates for the different pools
      C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
      In=Scalar_LitterCinputs*1, #Amount of litter inputs by time
      FYM = Scalar_ManureCinputs*0, #Amount of Farm Yard Manure by time
      clay=clay100*0.5, #Percent clay in mineral soil
      xi=xi.frame_VLR5) #Loads the model

    Ct_VLR5=getC(Model_VLR5) #Calculates stocks for each pool per month

    #The results can be plotted with the commands
    matplot(years, Ct_VLR5, type="l", lty=1, col=1:5,
            xlab="Time (years)", ylab="C stocks (Mg/ha)")
    legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
           lty=1, col=1:5, bty="n")

    VEC_Lit_VLR5 <- rep(M_Scalar_LitterCinputs*1, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
    VEC_Man_VLR5 <- rep(M_Scalar_ManureCinputs*0, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

    VEC_LitDF_VLR5 <- as.data.frame(VEC_Lit_VLR5) #Converting the Litter vector to a data frame
    VEC_LitDF_VLR5$MNumber <- seq(from = 1, to = SimulationLength_months)
    VEC_ManDF_VLR5 <- as.data.frame(VEC_Man_VLR5) #Converting the Manure vector to a data frame
    VEC_ManDF_VLR5$MNumber <- seq(from = 1, to = SimulationLength_months)

    sapply(VEC_LitDF_VLR5, class) #Check that class is numeric
    sapply(VEC_ManDF_VLR5, class) #Check that class is numeric
    LitterCinputs_VLR5=VEC_LitDF_VLR5   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    ManureCinputs_VLR5=VEC_ManDF_VLR5 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    MCinputs_VLR5 <- merge(LitterCinputs_VLR5, ManureCinputs_VLR5, by = "MNumber")
    MCinputs_VLR5$MInput_VLR5 <- MCinputs_VLR5$VEC_Lit_VLR5 + MCinputs_VLR5$VEC_Man_VLR5

    #Change names of litter and manure columns for more common ones
    colnames(MCinputs_VLR5)[which(names(MCinputs_VLR5) == "VEC_Lit_VLR5")] <- "LitterC_VLR5"
    colnames(MCinputs_VLR5)[which(names(MCinputs_VLR5) == "VEC_Man_VLR5")] <- "ManureC_VLR5"

    #Create a dataframe with the data considering the simulation length
    ModelDF_VLR5 <- as.data.frame(Ct_VLR5)
    colnames(ModelDF_VLR5) <- c('DPM_VLR5','RPM_VLR5','BIO_VLR5', 'HUM_VLR5', 'IOM_VLR5')
    ModelDFS_VLR5 <- ModelDF_VLR5[1:SimulationLength_months, ]

    #Create a column with the number of month of analysis
    ModelDFS_VLR5$MNumber <- seq(from = 1, to = SimulationLength_months)

    #Create a column that sums all pools
    ModelDFS_VLR5$AllPools_VLR5 <- ModelDFS_VLR5$DPM_VLR5 + ModelDFS_VLR5$RPM_VLR5 + ModelDFS_VLR5$BIO_VLR5 + ModelDFS_VLR5$HUM_VLR5 + ModelDFS_VLR5$IOM_VLR5

    #Create a column that sums all pools except IOM (static)
    ModelDFS_VLR5$AllPools_noIOM_VLR5 <- ModelDFS_VLR5$DPM_VLR5 + ModelDFS_VLR5$RPM_VLR5 + ModelDFS_VLR5$BIO_VLR5 + ModelDFS_VLR5$HUM_VLR5

    #Create a column that add the monthly input of C (manure and litter separately)
    ModelDFSL_VLR5 <- merge(ModelDFS_VLR5, MCinputs_VLR5, by = "MNumber")

    ModelDFSL_VLR5$MInput_VLR5 <- ModelDFSL_VLR5$LitterC_VLR5 + ModelDFSL_VLR5$ManureC_VLR5
    #ModelDF_SL$MInput[1] <- 0

    #Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
    ModelDFSL_VLR5$CTails_VLR5 <- ModelDFSL_VLR5$AllPools_noIOM_VLR5 + ModelDFSL_VLR5$MInput_VLR5

    #Create Monthly Accumulated input of C
    ModelDFSL_VLR5$AccumInput_VLR5 = ModelDFSL_VLR5$AccumInput_VLR5=cumsum(ModelDFSL_VLR5$MInput_VLR5)

    #Create Monthly Growths for each carbon pool
    ModelDFSL_VLR5$MGrowth_DPM_VLR5 <- ave(ModelDFSL_VLR5$DPM_VLR5, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLR5$MGrowth_RPM_VLR5 <- ave(ModelDFSL_VLR5$RPM_VLR5, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLR5$MGrowth_BIO_VLR5 <- ave(ModelDFSL_VLR5$BIO_VLR5, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLR5$MGrowth_HUM_VLR5 <- ave(ModelDFSL_VLR5$HUM_VLR5, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLR5$MGrowth_IOM_VLR5 <- ave(ModelDFSL_VLR5$IOM_VLR5, FUN = function(x) c(0, diff(x)))

    #Create column for Monthly and Accumulated C-CO2 emissions
    ModelDFSL_VLR5$M_CCO2_VLR5 <- ModelDFSL_VLR5$MInput_VLR5 - ModelDFSL_VLR5$MGrowth_DPM_VLR5 - ModelDFSL_VLR5$MGrowth_RPM_VLR5 - ModelDFSL_VLR5$MGrowth_BIO_VLR5 - ModelDFSL_VLR5$MGrowth_HUM_VLR5
    ModelDFSL_VLR5$Accum_CCO2_VLR5 <- ModelDFSL_VLR5$AccumInput_VLR5 - ModelDFSL_VLR5$AllPools_noIOM_VLR5

    #Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
    ModelDFSL_VLR5$M_CCO2_VLR5[1] <- 0
    ModelDFSL_VLR5$Accum_CCO2_VLR5[1] <- 0

    #Balance validation
    ModelDFSL_VLR5$Balance_VLR5 <- ModelDFSL_VLR5$AccumInput_VLR5 - ModelDFSL_VLR5$Accum_CCO2_VLR5 - (ModelDFSL_VLR5$DPM_VLR5 + ModelDFSL_VLR5$RPM_VLR5 + ModelDFSL_VLR5$BIO_VLR5 + ModelDFSL_VLR5$HUM_VLR5)

    #Convert C-CO2 emissions into CO2 emissions
    ModelDFSL_VLR5$M_CO2_VLR5 <- ModelDFSL_VLR5$M_CCO2_VLR5 * 44/12
    ModelDFSL_VLR5$Accum_CO2_VLR5 <- ModelDFSL_VLR5$Accum_CCO2_VLR5 * 44/12

    #This model will be called VLR5C because implies a continuous input of C
    ModelDFSL_VLR5C <- ModelDFSL_VLR5

    #Export the dataframe
    write_xlsx(ModelDFSL_VLR5C,"VXC_Models\\ModelDFSL_R_VLR5C.xlsx")

    #Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
    #Create two equal models by using the above general script
    #Create model t=x
    ModelDFSLt0_VLR5 <- ModelDFSL_VLR5 #Create model t=x

    #Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
    ModelDFSLt1_VLR5.1 <- rbind(c(0:0), ModelDFSLt0_VLR5)
    ModelDFSLt1_VLR5.2 <- rbind(c(0:0), ModelDFSLt1_VLR5.1)
    ModelDFSLt1_VLR5.3 <- rbind(c(0:0), ModelDFSLt1_VLR5.2)
    ModelDFSLt1_VLR5.4 <- rbind(c(0:0), ModelDFSLt1_VLR5.3)
    ModelDFSLt1_VLR5.5 <- rbind(c(0:0), ModelDFSLt1_VLR5.4)
    ModelDFSLt1_VLR5.6 <- rbind(c(0:0), ModelDFSLt1_VLR5.5)
    ModelDFSLt1_VLR5.7 <- rbind(c(0:0), ModelDFSLt1_VLR5.6)
    ModelDFSLt1_VLR5.8 <- rbind(c(0:0), ModelDFSLt1_VLR5.7)
    ModelDFSLt1_VLR5.9 <- rbind(c(0:0), ModelDFSLt1_VLR5.8)
    ModelDFSLt1_VLR5.10 <- rbind(c(0:0), ModelDFSLt1_VLR5.9)
    ModelDFSLt1_VLR5.11 <- rbind(c(0:0), ModelDFSLt1_VLR5.10)
    ModelDFSLt1_VLR5.12 <- rbind(c(0:0), ModelDFSLt1_VLR5.11)
    ModelDFSLt1_VLR5.13 <- ModelDFSLt1_VLR5.12[-nrow(ModelDFSLt1_VLR5.12),]
    ModelDFSLt1_VLR5.14 <- ModelDFSLt1_VLR5.13[-nrow(ModelDFSLt1_VLR5.13),]
    ModelDFSLt1_VLR5.15 <- ModelDFSLt1_VLR5.14[-nrow(ModelDFSLt1_VLR5.14),]
    ModelDFSLt1_VLR5.16 <- ModelDFSLt1_VLR5.15[-nrow(ModelDFSLt1_VLR5.15),]
    ModelDFSLt1_VLR5.17 <- ModelDFSLt1_VLR5.16[-nrow(ModelDFSLt1_VLR5.16),]
    ModelDFSLt1_VLR5.18 <- ModelDFSLt1_VLR5.17[-nrow(ModelDFSLt1_VLR5.17),]
    ModelDFSLt1_VLR5.19 <- ModelDFSLt1_VLR5.18[-nrow(ModelDFSLt1_VLR5.18),]
    ModelDFSLt1_VLR5.20 <- ModelDFSLt1_VLR5.19[-nrow(ModelDFSLt1_VLR5.19),]
    ModelDFSLt1_VLR5.21 <- ModelDFSLt1_VLR5.20[-nrow(ModelDFSLt1_VLR5.20),]
    ModelDFSLt1_VLR5.22 <- ModelDFSLt1_VLR5.21[-nrow(ModelDFSLt1_VLR5.21),]
    ModelDFSLt1_VLR5.23 <- ModelDFSLt1_VLR5.22[-nrow(ModelDFSLt1_VLR5.22),]
    ModelDFSLt1_VLR5.24 <- ModelDFSLt1_VLR5.23[-nrow(ModelDFSLt1_VLR5.23),]

    ModelDFSLt1_VLR5 <- ModelDFSLt1_VLR5.24 #Create model t=x+1

    #Subtract model (t=x) - (t=x+1)
    ModelDFSL1y_VLR5 <- ModelDFSLt0_VLR5 - ModelDFSLt1_VLR5

    #Re-do Month Number column because the substraction was also applied to it
    ModelDFSL1y_VLR5$MNumber <- seq(from = 1, to = SimulationLength_months)

    #This model will be called VLR5P because implies a one-off input of C
    ModelDFSL_VLR5P <- ModelDFSL1y_VLR5

    #Export the dataframe
    write_xlsx(ModelDFSL_VLR5P,"VXP_Models\\ModelDFSL_R_VLR5P.xlsx")


    #Plot 3: Interactive Yearly CO2 emissions #
    MY <- 12
    ModelDFSL_VLR5P_YCO2 <- ModelDFSL_VLR5P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VLR5)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLR5P_YCO2) <- c("Year", "Months", "AnnualCO2_VLR_5")


    #Plot 3: Interactive Yearly CO2 emissions considering a delay
    GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
    ModelDFSL_VLR5P_YCO2D <- merge(ModelDFSL_VLR5P_YCO2, GWP100delay, by = "Year")
    ModelDFSL_VLR5P_YCO2D$AnnualCO2D_VLR_5 <- ModelDFSL_VLR5P_YCO2D$AnnualCO2_VLR_5 * ModelDFSL_VLR5P_YCO2D$GWP100

    #Plot 4: Interactive Yearly C emissions #
    MY <- 12
    ModelDFSL_VLR5P_YC <- ModelDFSL_VLR5P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VLR5)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLR5P_YC) <- c("Year", "Months", "CEmissions_VLR_5")


    #Plot 5: Interactive Yearly C tails (remaining C in Soil) #
    MY <- 12
    ModelDFSL_VLR5P_YCT <- ModelDFSL_VLR5P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VLR5)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLR5P_YCT) <- c("Year", "Months", "CTail_VLR_5")

    #Save Dataframes for Plots 3.1, 3.2, 4 and 5
    write_xlsx(ModelDFSL_VLR5P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VLR5P.xlsx") #Yearly CO2 emissions (no delay)
    write_xlsx(ModelDFSL_VLR5P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VLR5P.xlsx") #Yearly CO2 emissions (delay)
    write_xlsx(ModelDFSL_VLR5P_YC,"CEmissions_P\\ModelDFSL_R_CE_VLR5P.xlsx") #Yearly C emissions
    write_xlsx(ModelDFSL_VLR5P_YCT,"CTails_P\\ModelDFSL_R_CT_VLR5P.xlsx") #Yearly C emissions



#### 8.7 - VLR6) Litter; 60%clay; Reduced Tillage ####
    #The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
    fT_VLR6=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
    fW_VLR6=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                            S.Thick = soil.thick, pClay = clay100*0.6,
                            pE = 1.0, bare = FALSE)$b #Moisture effects per month
    xi.frame_VLR6=data.frame(years,rep(fT_VLR6*fW_VLR6,length.out=length(years)))

    #To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
    Model_VLR6=SoilR::RothCModel(
      t=years, #Simulation Length
      ks=c(k.DPM = 10*RTRM, k.RPM = 0.3*RTRM, k.BIO = 0.66*RTRM, k.HUM = 0.02*RTRM, k.IOM = 0*RTRM), #Decomposition rates for the different pools
      C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
      In=Scalar_LitterCinputs*1, #Amount of litter inputs by time
      FYM = Scalar_ManureCinputs*0, #Amount of Farm Yard Manure by time
      clay=clay100*0.6, #Percent clay in mineral soil
      xi=xi.frame_VLR6) #Loads the model

    Ct_VLR6=getC(Model_VLR6) #Calculates stocks for each pool per month

    #The results can be plotted with the commands
    matplot(years, Ct_VLR6, type="l", lty=1, col=1:5,
            xlab="Time (years)", ylab="C stocks (Mg/ha)")
    legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
           lty=1, col=1:5, bty="n")

    VEC_Lit_VLR6 <- rep(M_Scalar_LitterCinputs*1, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
    VEC_Man_VLR6 <- rep(M_Scalar_ManureCinputs*0, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

    VEC_LitDF_VLR6 <- as.data.frame(VEC_Lit_VLR6) #Converting the Litter vector to a data frame
    VEC_LitDF_VLR6$MNumber <- seq(from = 1, to = SimulationLength_months)
    VEC_ManDF_VLR6 <- as.data.frame(VEC_Man_VLR6) #Converting the Manure vector to a data frame
    VEC_ManDF_VLR6$MNumber <- seq(from = 1, to = SimulationLength_months)

    sapply(VEC_LitDF_VLR6, class) #Check that class is numeric
    sapply(VEC_ManDF_VLR6, class) #Check that class is numeric
    LitterCinputs_VLR6=VEC_LitDF_VLR6   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    ManureCinputs_VLR6=VEC_ManDF_VLR6 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    MCinputs_VLR6 <- merge(LitterCinputs_VLR6, ManureCinputs_VLR6, by = "MNumber")
    MCinputs_VLR6$MInput_VLR6 <- MCinputs_VLR6$VEC_Lit_VLR6 + MCinputs_VLR6$VEC_Man_VLR6

    #Change names of litter and manure columns for more common ones
    colnames(MCinputs_VLR6)[which(names(MCinputs_VLR6) == "VEC_Lit_VLR6")] <- "LitterC_VLR6"
    colnames(MCinputs_VLR6)[which(names(MCinputs_VLR6) == "VEC_Man_VLR6")] <- "ManureC_VLR6"

    #Create a dataframe with the data considering the simulation length
    ModelDF_VLR6 <- as.data.frame(Ct_VLR6)
    colnames(ModelDF_VLR6) <- c('DPM_VLR6','RPM_VLR6','BIO_VLR6', 'HUM_VLR6', 'IOM_VLR6')
    ModelDFS_VLR6 <- ModelDF_VLR6[1:SimulationLength_months, ]

    #Create a column with the number of month of analysis
    ModelDFS_VLR6$MNumber <- seq(from = 1, to = SimulationLength_months)

    #Create a column that sums all pools
    ModelDFS_VLR6$AllPools_VLR6 <- ModelDFS_VLR6$DPM_VLR6 + ModelDFS_VLR6$RPM_VLR6 + ModelDFS_VLR6$BIO_VLR6 + ModelDFS_VLR6$HUM_VLR6 + ModelDFS_VLR6$IOM_VLR6

    #Create a column that sums all pools except IOM (static)
    ModelDFS_VLR6$AllPools_noIOM_VLR6 <- ModelDFS_VLR6$DPM_VLR6 + ModelDFS_VLR6$RPM_VLR6 + ModelDFS_VLR6$BIO_VLR6 + ModelDFS_VLR6$HUM_VLR6

    #Create a column that add the monthly input of C (manure and litter separately)
    ModelDFSL_VLR6 <- merge(ModelDFS_VLR6, MCinputs_VLR6, by = "MNumber")

    ModelDFSL_VLR6$MInput_VLR6 <- ModelDFSL_VLR6$LitterC_VLR6 + ModelDFSL_VLR6$ManureC_VLR6
    #ModelDF_SL$MInput[1] <- 0

    #Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
    ModelDFSL_VLR6$CTails_VLR6 <- ModelDFSL_VLR6$AllPools_noIOM_VLR6 + ModelDFSL_VLR6$MInput_VLR6

    #Create Monthly Accumulated input of C
    ModelDFSL_VLR6$AccumInput_VLR6 = ModelDFSL_VLR6$AccumInput_VLR6=cumsum(ModelDFSL_VLR6$MInput_VLR6)

    #Create Monthly Growths for each carbon pool
    ModelDFSL_VLR6$MGrowth_DPM_VLR6 <- ave(ModelDFSL_VLR6$DPM_VLR6, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLR6$MGrowth_RPM_VLR6 <- ave(ModelDFSL_VLR6$RPM_VLR6, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLR6$MGrowth_BIO_VLR6 <- ave(ModelDFSL_VLR6$BIO_VLR6, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLR6$MGrowth_HUM_VLR6 <- ave(ModelDFSL_VLR6$HUM_VLR6, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLR6$MGrowth_IOM_VLR6 <- ave(ModelDFSL_VLR6$IOM_VLR6, FUN = function(x) c(0, diff(x)))

    #Create column for Monthly and Accumulated C-CO2 emissions
    ModelDFSL_VLR6$M_CCO2_VLR6 <- ModelDFSL_VLR6$MInput_VLR6 - ModelDFSL_VLR6$MGrowth_DPM_VLR6 - ModelDFSL_VLR6$MGrowth_RPM_VLR6 - ModelDFSL_VLR6$MGrowth_BIO_VLR6 - ModelDFSL_VLR6$MGrowth_HUM_VLR6
    ModelDFSL_VLR6$Accum_CCO2_VLR6 <- ModelDFSL_VLR6$AccumInput_VLR6 - ModelDFSL_VLR6$AllPools_noIOM_VLR6

    #Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
    ModelDFSL_VLR6$M_CCO2_VLR6[1] <- 0
    ModelDFSL_VLR6$Accum_CCO2_VLR6[1] <- 0

    #Balance validation
    ModelDFSL_VLR6$Balance_VLR6 <- ModelDFSL_VLR6$AccumInput_VLR6 - ModelDFSL_VLR6$Accum_CCO2_VLR6 - (ModelDFSL_VLR6$DPM_VLR6 + ModelDFSL_VLR6$RPM_VLR6 + ModelDFSL_VLR6$BIO_VLR6 + ModelDFSL_VLR6$HUM_VLR6)

    #Convert C-CO2 emissions into CO2 emissions
    ModelDFSL_VLR6$M_CO2_VLR6 <- ModelDFSL_VLR6$M_CCO2_VLR6 * 44/12
    ModelDFSL_VLR6$Accum_CO2_VLR6 <- ModelDFSL_VLR6$Accum_CCO2_VLR6 * 44/12

    #This model will be called VLR6C because implies a continuous input of C
    ModelDFSL_VLR6C <- ModelDFSL_VLR6

    #Export the dataframe
    write_xlsx(ModelDFSL_VLR6C,"VXC_Models\\ModelDFSL_R_VLR6C.xlsx")

    #Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
    #Create two equal models by using the above general script
    #Create model t=x
    ModelDFSLt0_VLR6 <- ModelDFSL_VLR6 #Create model t=x

    #Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
    ModelDFSLt1_VLR6.1 <- rbind(c(0:0), ModelDFSLt0_VLR6)
    ModelDFSLt1_VLR6.2 <- rbind(c(0:0), ModelDFSLt1_VLR6.1)
    ModelDFSLt1_VLR6.3 <- rbind(c(0:0), ModelDFSLt1_VLR6.2)
    ModelDFSLt1_VLR6.4 <- rbind(c(0:0), ModelDFSLt1_VLR6.3)
    ModelDFSLt1_VLR6.5 <- rbind(c(0:0), ModelDFSLt1_VLR6.4)
    ModelDFSLt1_VLR6.6 <- rbind(c(0:0), ModelDFSLt1_VLR6.5)
    ModelDFSLt1_VLR6.7 <- rbind(c(0:0), ModelDFSLt1_VLR6.6)
    ModelDFSLt1_VLR6.8 <- rbind(c(0:0), ModelDFSLt1_VLR6.7)
    ModelDFSLt1_VLR6.9 <- rbind(c(0:0), ModelDFSLt1_VLR6.8)
    ModelDFSLt1_VLR6.10 <- rbind(c(0:0), ModelDFSLt1_VLR6.9)
    ModelDFSLt1_VLR6.11 <- rbind(c(0:0), ModelDFSLt1_VLR6.10)
    ModelDFSLt1_VLR6.12 <- rbind(c(0:0), ModelDFSLt1_VLR6.11)
    ModelDFSLt1_VLR6.13 <- ModelDFSLt1_VLR6.12[-nrow(ModelDFSLt1_VLR6.12),]
    ModelDFSLt1_VLR6.14 <- ModelDFSLt1_VLR6.13[-nrow(ModelDFSLt1_VLR6.13),]
    ModelDFSLt1_VLR6.15 <- ModelDFSLt1_VLR6.14[-nrow(ModelDFSLt1_VLR6.14),]
    ModelDFSLt1_VLR6.16 <- ModelDFSLt1_VLR6.15[-nrow(ModelDFSLt1_VLR6.15),]
    ModelDFSLt1_VLR6.17 <- ModelDFSLt1_VLR6.16[-nrow(ModelDFSLt1_VLR6.16),]
    ModelDFSLt1_VLR6.18 <- ModelDFSLt1_VLR6.17[-nrow(ModelDFSLt1_VLR6.17),]
    ModelDFSLt1_VLR6.19 <- ModelDFSLt1_VLR6.18[-nrow(ModelDFSLt1_VLR6.18),]
    ModelDFSLt1_VLR6.20 <- ModelDFSLt1_VLR6.19[-nrow(ModelDFSLt1_VLR6.19),]
    ModelDFSLt1_VLR6.21 <- ModelDFSLt1_VLR6.20[-nrow(ModelDFSLt1_VLR6.20),]
    ModelDFSLt1_VLR6.22 <- ModelDFSLt1_VLR6.21[-nrow(ModelDFSLt1_VLR6.21),]
    ModelDFSLt1_VLR6.23 <- ModelDFSLt1_VLR6.22[-nrow(ModelDFSLt1_VLR6.22),]
    ModelDFSLt1_VLR6.24 <- ModelDFSLt1_VLR6.23[-nrow(ModelDFSLt1_VLR6.23),]

    ModelDFSLt1_VLR6 <- ModelDFSLt1_VLR6.24 #Create model t=x+1

    #Subtract model (t=x) - (t=x+1)
    ModelDFSL1y_VLR6 <- ModelDFSLt0_VLR6 - ModelDFSLt1_VLR6

    #Re-do Month Number column because the substraction was also applied to it
    ModelDFSL1y_VLR6$MNumber <- seq(from = 1, to = SimulationLength_months)

    #This model will be called VLR6P because implies a one-off input of C
    ModelDFSL_VLR6P <- ModelDFSL1y_VLR6

    #Export the dataframe
    write_xlsx(ModelDFSL_VLR6P,"VXP_Models\\ModelDFSL_R_VLR6P.xlsx")

    #Plot 3: Interactive Yearly CO2 emissions #
    MY <- 12
    ModelDFSL_VLR6P_YCO2 <- ModelDFSL_VLR6P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VLR6)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLR6P_YCO2) <- c("Year", "Months", "AnnualCO2_VLR_6")


    #Plot 3: Interactive Yearly CO2 emissions considering a delay
    GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
    ModelDFSL_VLR6P_YCO2D <- merge(ModelDFSL_VLR6P_YCO2, GWP100delay, by = "Year")
    ModelDFSL_VLR6P_YCO2D$AnnualCO2D_VLR_6 <- ModelDFSL_VLR6P_YCO2D$AnnualCO2_VLR_6 * ModelDFSL_VLR6P_YCO2D$GWP100

    #Plot 4: Interactive Yearly C emissions #
    MY <- 12
    ModelDFSL_VLR6P_YC <- ModelDFSL_VLR6P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VLR6)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLR6P_YC) <- c("Year", "Months", "CEmissions_VLR_6")


    #Plot 5: Interactive Yearly C tails (remaining C in Soil) #
    MY <- 12
    ModelDFSL_VLR6P_YCT <- ModelDFSL_VLR6P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VLR6)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLR6P_YCT) <- c("Year", "Months", "CTail_VLR_6")

    #Save Dataframes for Plots 3.1, 3.2, 4 and 5
    write_xlsx(ModelDFSL_VLR6P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VLR6P.xlsx") #Yearly CO2 emissions (no delay)
    write_xlsx(ModelDFSL_VLR6P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VLR6P.xlsx") #Yearly CO2 emissions (delay)
    write_xlsx(ModelDFSL_VLR6P_YC,"CEmissions_P\\ModelDFSL_R_CE_VLR6P.xlsx") #Yearly C emissions
    write_xlsx(ModelDFSL_VLR6P_YCT,"CTails_P\\ModelDFSL_R_CT_VLR6P.xlsx") #Yearly C emissions



#### 8.8 - VLR7) Litter; 70%clay; Reduced Tillage ####
    #The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
    fT_VLR7=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
    fW_VLR7=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                            S.Thick = soil.thick, pClay = clay100*0.7,
                            pE = 1.0, bare = FALSE)$b #Moisture effects per month
    xi.frame_VLR7=data.frame(years,rep(fT_VLR7*fW_VLR7,length.out=length(years)))

    #To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
    Model_VLR7=SoilR::RothCModel(
      t=years, #Simulation Length
      ks=c(k.DPM = 10*RTRM, k.RPM = 0.3*RTRM, k.BIO = 0.66*RTRM, k.HUM = 0.02*RTRM, k.IOM = 0*RTRM), #Decomposition rates for the different pools
      C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
      In=Scalar_LitterCinputs*1, #Amount of litter inputs by time
      FYM = Scalar_ManureCinputs*0, #Amount of Farm Yard Manure by time
      clay=clay100*0.7, #Percent clay in mineral soil
      xi=xi.frame_VLR7) #Loads the model

    Ct_VLR7=getC(Model_VLR7) #Calculates stocks for each pool per month

    #The results can be plotted with the commands
    matplot(years, Ct_VLR7, type="l", lty=1, col=1:5,
            xlab="Time (years)", ylab="C stocks (Mg/ha)")
    legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
           lty=1, col=1:5, bty="n")

    VEC_Lit_VLR7 <- rep(M_Scalar_LitterCinputs*1, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
    VEC_Man_VLR7 <- rep(M_Scalar_ManureCinputs*0, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

    VEC_LitDF_VLR7 <- as.data.frame(VEC_Lit_VLR7) #Converting the Litter vector to a data frame
    VEC_LitDF_VLR7$MNumber <- seq(from = 1, to = SimulationLength_months)
    VEC_ManDF_VLR7 <- as.data.frame(VEC_Man_VLR7) #Converting the Manure vector to a data frame
    VEC_ManDF_VLR7$MNumber <- seq(from = 1, to = SimulationLength_months)

    sapply(VEC_LitDF_VLR7, class) #Check that class is numeric
    sapply(VEC_ManDF_VLR7, class) #Check that class is numeric
    LitterCinputs_VLR7=VEC_LitDF_VLR7   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    ManureCinputs_VLR7=VEC_ManDF_VLR7 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    MCinputs_VLR7 <- merge(LitterCinputs_VLR7, ManureCinputs_VLR7, by = "MNumber")
    MCinputs_VLR7$MInput_VLR7 <- MCinputs_VLR7$VEC_Lit_VLR7 + MCinputs_VLR7$VEC_Man_VLR7

    #Change names of litter and manure columns for more common ones
    colnames(MCinputs_VLR7)[which(names(MCinputs_VLR7) == "VEC_Lit_VLR7")] <- "LitterC_VLR7"
    colnames(MCinputs_VLR7)[which(names(MCinputs_VLR7) == "VEC_Man_VLR7")] <- "ManureC_VLR7"

    #Create a dataframe with the data considering the simulation length
    ModelDF_VLR7 <- as.data.frame(Ct_VLR7)
    colnames(ModelDF_VLR7) <- c('DPM_VLR7','RPM_VLR7','BIO_VLR7', 'HUM_VLR7', 'IOM_VLR7')
    ModelDFS_VLR7 <- ModelDF_VLR7[1:SimulationLength_months, ]

    #Create a column with the number of month of analysis
    ModelDFS_VLR7$MNumber <- seq(from = 1, to = SimulationLength_months)

    #Create a column that sums all pools
    ModelDFS_VLR7$AllPools_VLR7 <- ModelDFS_VLR7$DPM_VLR7 + ModelDFS_VLR7$RPM_VLR7 + ModelDFS_VLR7$BIO_VLR7 + ModelDFS_VLR7$HUM_VLR7 + ModelDFS_VLR7$IOM_VLR7

    #Create a column that sums all pools except IOM (static)
    ModelDFS_VLR7$AllPools_noIOM_VLR7 <- ModelDFS_VLR7$DPM_VLR7 + ModelDFS_VLR7$RPM_VLR7 + ModelDFS_VLR7$BIO_VLR7 + ModelDFS_VLR7$HUM_VLR7

    #Create a column that add the monthly input of C (manure and litter separately)
    ModelDFSL_VLR7 <- merge(ModelDFS_VLR7, MCinputs_VLR7, by = "MNumber")

    ModelDFSL_VLR7$MInput_VLR7 <- ModelDFSL_VLR7$LitterC_VLR7 + ModelDFSL_VLR7$ManureC_VLR7
    #ModelDF_SL$MInput[1] <- 0

    #Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
    ModelDFSL_VLR7$CTails_VLR7 <- ModelDFSL_VLR7$AllPools_noIOM_VLR7 + ModelDFSL_VLR7$MInput_VLR7

    #Create Monthly Accumulated input of C
    ModelDFSL_VLR7$AccumInput_VLR7 = ModelDFSL_VLR7$AccumInput_VLR7=cumsum(ModelDFSL_VLR7$MInput_VLR7)

    #Create Monthly Growths for each carbon pool
    ModelDFSL_VLR7$MGrowth_DPM_VLR7 <- ave(ModelDFSL_VLR7$DPM_VLR7, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLR7$MGrowth_RPM_VLR7 <- ave(ModelDFSL_VLR7$RPM_VLR7, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLR7$MGrowth_BIO_VLR7 <- ave(ModelDFSL_VLR7$BIO_VLR7, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLR7$MGrowth_HUM_VLR7 <- ave(ModelDFSL_VLR7$HUM_VLR7, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLR7$MGrowth_IOM_VLR7 <- ave(ModelDFSL_VLR7$IOM_VLR7, FUN = function(x) c(0, diff(x)))

    #Create column for Monthly and Accumulated C-CO2 emissions
    ModelDFSL_VLR7$M_CCO2_VLR7 <- ModelDFSL_VLR7$MInput_VLR7 - ModelDFSL_VLR7$MGrowth_DPM_VLR7 - ModelDFSL_VLR7$MGrowth_RPM_VLR7 - ModelDFSL_VLR7$MGrowth_BIO_VLR7 - ModelDFSL_VLR7$MGrowth_HUM_VLR7
    ModelDFSL_VLR7$Accum_CCO2_VLR7 <- ModelDFSL_VLR7$AccumInput_VLR7 - ModelDFSL_VLR7$AllPools_noIOM_VLR7

    #Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
    ModelDFSL_VLR7$M_CCO2_VLR7[1] <- 0
    ModelDFSL_VLR7$Accum_CCO2_VLR7[1] <- 0

    #Balance validation
    ModelDFSL_VLR7$Balance_VLR7 <- ModelDFSL_VLR7$AccumInput_VLR7 - ModelDFSL_VLR7$Accum_CCO2_VLR7 - (ModelDFSL_VLR7$DPM_VLR7 + ModelDFSL_VLR7$RPM_VLR7 + ModelDFSL_VLR7$BIO_VLR7 + ModelDFSL_VLR7$HUM_VLR7)

    #Convert C-CO2 emissions into CO2 emissions
    ModelDFSL_VLR7$M_CO2_VLR7 <- ModelDFSL_VLR7$M_CCO2_VLR7 * 44/12
    ModelDFSL_VLR7$Accum_CO2_VLR7 <- ModelDFSL_VLR7$Accum_CCO2_VLR7 * 44/12

    #This model will be called VLR7C because implies a continuous input of C
    ModelDFSL_VLR7C <- ModelDFSL_VLR7

    #Export the dataframe
    write_xlsx(ModelDFSL_VLR7C,"VXC_Models\\ModelDFSL_R_VLR7C.xlsx")

    #Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
    #Create two equal models by using the above general script
    #Create model t=x
    ModelDFSLt0_VLR7 <- ModelDFSL_VLR7 #Create model t=x

    #Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
    ModelDFSLt1_VLR7.1 <- rbind(c(0:0), ModelDFSLt0_VLR7)
    ModelDFSLt1_VLR7.2 <- rbind(c(0:0), ModelDFSLt1_VLR7.1)
    ModelDFSLt1_VLR7.3 <- rbind(c(0:0), ModelDFSLt1_VLR7.2)
    ModelDFSLt1_VLR7.4 <- rbind(c(0:0), ModelDFSLt1_VLR7.3)
    ModelDFSLt1_VLR7.5 <- rbind(c(0:0), ModelDFSLt1_VLR7.4)
    ModelDFSLt1_VLR7.6 <- rbind(c(0:0), ModelDFSLt1_VLR7.5)
    ModelDFSLt1_VLR7.7 <- rbind(c(0:0), ModelDFSLt1_VLR7.6)
    ModelDFSLt1_VLR7.8 <- rbind(c(0:0), ModelDFSLt1_VLR7.7)
    ModelDFSLt1_VLR7.9 <- rbind(c(0:0), ModelDFSLt1_VLR7.8)
    ModelDFSLt1_VLR7.10 <- rbind(c(0:0), ModelDFSLt1_VLR7.9)
    ModelDFSLt1_VLR7.11 <- rbind(c(0:0), ModelDFSLt1_VLR7.10)
    ModelDFSLt1_VLR7.12 <- rbind(c(0:0), ModelDFSLt1_VLR7.11)
    ModelDFSLt1_VLR7.13 <- ModelDFSLt1_VLR7.12[-nrow(ModelDFSLt1_VLR7.12),]
    ModelDFSLt1_VLR7.14 <- ModelDFSLt1_VLR7.13[-nrow(ModelDFSLt1_VLR7.13),]
    ModelDFSLt1_VLR7.15 <- ModelDFSLt1_VLR7.14[-nrow(ModelDFSLt1_VLR7.14),]
    ModelDFSLt1_VLR7.16 <- ModelDFSLt1_VLR7.15[-nrow(ModelDFSLt1_VLR7.15),]
    ModelDFSLt1_VLR7.17 <- ModelDFSLt1_VLR7.16[-nrow(ModelDFSLt1_VLR7.16),]
    ModelDFSLt1_VLR7.18 <- ModelDFSLt1_VLR7.17[-nrow(ModelDFSLt1_VLR7.17),]
    ModelDFSLt1_VLR7.19 <- ModelDFSLt1_VLR7.18[-nrow(ModelDFSLt1_VLR7.18),]
    ModelDFSLt1_VLR7.20 <- ModelDFSLt1_VLR7.19[-nrow(ModelDFSLt1_VLR7.19),]
    ModelDFSLt1_VLR7.21 <- ModelDFSLt1_VLR7.20[-nrow(ModelDFSLt1_VLR7.20),]
    ModelDFSLt1_VLR7.22 <- ModelDFSLt1_VLR7.21[-nrow(ModelDFSLt1_VLR7.21),]
    ModelDFSLt1_VLR7.23 <- ModelDFSLt1_VLR7.22[-nrow(ModelDFSLt1_VLR7.22),]
    ModelDFSLt1_VLR7.24 <- ModelDFSLt1_VLR7.23[-nrow(ModelDFSLt1_VLR7.23),]

    ModelDFSLt1_VLR7 <- ModelDFSLt1_VLR7.24 #Create model t=x+1

    #Subtract model (t=x) - (t=x+1)
    ModelDFSL1y_VLR7 <- ModelDFSLt0_VLR7 - ModelDFSLt1_VLR7

    #Re-do Month Number column because the substraction was also applied to it
    ModelDFSL1y_VLR7$MNumber <- seq(from = 1, to = SimulationLength_months)

    #This model will be called VLR7P because implies a one-off input of C
    ModelDFSL_VLR7P <- ModelDFSL1y_VLR7

    #Export the dataframe
    write_xlsx(ModelDFSL_VLR7P,"VXP_Models\\ModelDFSL_R_VLR7P.xlsx")

    #Plot 3: Interactive Yearly CO2 emissions #
    MY <- 12
    ModelDFSL_VLR7P_YCO2 <- ModelDFSL_VLR7P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VLR7)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLR7P_YCO2) <- c("Year", "Months", "AnnualCO2_VLR_7")


    #Plot 3: Interactive Yearly CO2 emissions considering a delay
    GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
    ModelDFSL_VLR7P_YCO2D <- merge(ModelDFSL_VLR7P_YCO2, GWP100delay, by = "Year")
    ModelDFSL_VLR7P_YCO2D$AnnualCO2D_VLR_7 <- ModelDFSL_VLR7P_YCO2D$AnnualCO2_VLR_7 * ModelDFSL_VLR7P_YCO2D$GWP100

    #Plot 4: Interactive Yearly C emissions #
    MY <- 12
    ModelDFSL_VLR7P_YC <- ModelDFSL_VLR7P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VLR7)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLR7P_YC) <- c("Year", "Months", "CEmissions_VLR_7")


    #Plot 5: Interactive Yearly C tails (remaining C in Soil) #
    MY <- 12
    ModelDFSL_VLR7P_YCT <- ModelDFSL_VLR7P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VLR7)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLR7P_YCT) <- c("Year", "Months", "CTail_VLR_7")


    #Save Dataframes for Plots 3.1, 3.2, 4 and 5
    write_xlsx(ModelDFSL_VLR7P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VLR7P.xlsx") #Yearly CO2 emissions (no delay)
    write_xlsx(ModelDFSL_VLR7P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VLR7P.xlsx") #Yearly CO2 emissions (delay)
    write_xlsx(ModelDFSL_VLR7P_YC,"CEmissions_P\\ModelDFSL_R_CE_VLR7P.xlsx") #Yearly C emissions
    write_xlsx(ModelDFSL_VLR7P_YCT,"CTails_P\\ModelDFSL_R_CT_VLR7P.xlsx") #Yearly C emissions



#### 8.9 - VLR8) Litter; 80%clay; Reduced Tillage ####
    #The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
    fT_VLR8=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
    fW_VLR8=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                            S.Thick = soil.thick, pClay = clay100*0.8,
                            pE = 1.0, bare = FALSE)$b #Moisture effects per month
    xi.frame_VLR8=data.frame(years,rep(fT_VLR8*fW_VLR8,length.out=length(years)))

    #To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
    Model_VLR8=SoilR::RothCModel(
      t=years, #Simulation Length
      ks=c(k.DPM = 10*RTRM, k.RPM = 0.3*RTRM, k.BIO = 0.66*RTRM, k.HUM = 0.02*RTRM, k.IOM = 0*RTRM), #Decomposition rates for the different pools
      C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
      In=Scalar_LitterCinputs*1, #Amount of litter inputs by time
      FYM = Scalar_ManureCinputs*0, #Amount of Farm Yard Manure by time
      clay=clay100*0.8, #Percent clay in mineral soil
      xi=xi.frame_VLR8) #Loads the model

    Ct_VLR8=getC(Model_VLR8) #Calculates stocks for each pool per month

    #The results can be plotted with the commands
    matplot(years, Ct_VLR8, type="l", lty=1, col=1:5,
            xlab="Time (years)", ylab="C stocks (Mg/ha)")
    legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
           lty=1, col=1:5, bty="n")

    VEC_Lit_VLR8 <- rep(M_Scalar_LitterCinputs*1, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
    VEC_Man_VLR8 <- rep(M_Scalar_ManureCinputs*0, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

    VEC_LitDF_VLR8 <- as.data.frame(VEC_Lit_VLR8) #Converting the Litter vector to a data frame
    VEC_LitDF_VLR8$MNumber <- seq(from = 1, to = SimulationLength_months)
    VEC_ManDF_VLR8 <- as.data.frame(VEC_Man_VLR8) #Converting the Manure vector to a data frame
    VEC_ManDF_VLR8$MNumber <- seq(from = 1, to = SimulationLength_months)

    sapply(VEC_LitDF_VLR8, class) #Check that class is numeric
    sapply(VEC_ManDF_VLR8, class) #Check that class is numeric
    LitterCinputs_VLR8=VEC_LitDF_VLR8   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    ManureCinputs_VLR8=VEC_ManDF_VLR8 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    MCinputs_VLR8 <- merge(LitterCinputs_VLR8, ManureCinputs_VLR8, by = "MNumber")
    MCinputs_VLR8$MInput_VLR8 <- MCinputs_VLR8$VEC_Lit_VLR8 + MCinputs_VLR8$VEC_Man_VLR8

    #Change names of litter and manure columns for more common ones
    colnames(MCinputs_VLR8)[which(names(MCinputs_VLR8) == "VEC_Lit_VLR8")] <- "LitterC_VLR8"
    colnames(MCinputs_VLR8)[which(names(MCinputs_VLR8) == "VEC_Man_VLR8")] <- "ManureC_VLR8"

    #Create a dataframe with the data considering the simulation length
    ModelDF_VLR8 <- as.data.frame(Ct_VLR8)
    colnames(ModelDF_VLR8) <- c('DPM_VLR8','RPM_VLR8','BIO_VLR8', 'HUM_VLR8', 'IOM_VLR8')
    ModelDFS_VLR8 <- ModelDF_VLR8[1:SimulationLength_months, ]

    #Create a column with the number of month of analysis
    ModelDFS_VLR8$MNumber <- seq(from = 1, to = SimulationLength_months)

    #Create a column that sums all pools
    ModelDFS_VLR8$AllPools_VLR8 <- ModelDFS_VLR8$DPM_VLR8 + ModelDFS_VLR8$RPM_VLR8 + ModelDFS_VLR8$BIO_VLR8 + ModelDFS_VLR8$HUM_VLR8 + ModelDFS_VLR8$IOM_VLR8

    #Create a column that sums all pools except IOM (static)
    ModelDFS_VLR8$AllPools_noIOM_VLR8 <- ModelDFS_VLR8$DPM_VLR8 + ModelDFS_VLR8$RPM_VLR8 + ModelDFS_VLR8$BIO_VLR8 + ModelDFS_VLR8$HUM_VLR8

    #Create a column that add the monthly input of C (manure and litter separately)
    ModelDFSL_VLR8 <- merge(ModelDFS_VLR8, MCinputs_VLR8, by = "MNumber")

    ModelDFSL_VLR8$MInput_VLR8 <- ModelDFSL_VLR8$LitterC_VLR8 + ModelDFSL_VLR8$ManureC_VLR8
    #ModelDF_SL$MInput[1] <- 0

    #Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
    ModelDFSL_VLR8$CTails_VLR8 <- ModelDFSL_VLR8$AllPools_noIOM_VLR8 + ModelDFSL_VLR8$MInput_VLR8

    #Create Monthly Accumulated input of C
    ModelDFSL_VLR8$AccumInput_VLR8 = ModelDFSL_VLR8$AccumInput_VLR8=cumsum(ModelDFSL_VLR8$MInput_VLR8)

    #Create Monthly Growths for each carbon pool
    ModelDFSL_VLR8$MGrowth_DPM_VLR8 <- ave(ModelDFSL_VLR8$DPM_VLR8, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLR8$MGrowth_RPM_VLR8 <- ave(ModelDFSL_VLR8$RPM_VLR8, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLR8$MGrowth_BIO_VLR8 <- ave(ModelDFSL_VLR8$BIO_VLR8, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLR8$MGrowth_HUM_VLR8 <- ave(ModelDFSL_VLR8$HUM_VLR8, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLR8$MGrowth_IOM_VLR8 <- ave(ModelDFSL_VLR8$IOM_VLR8, FUN = function(x) c(0, diff(x)))

    #Create column for Monthly and Accumulated C-CO2 emissions
    ModelDFSL_VLR8$M_CCO2_VLR8 <- ModelDFSL_VLR8$MInput_VLR8 - ModelDFSL_VLR8$MGrowth_DPM_VLR8 - ModelDFSL_VLR8$MGrowth_RPM_VLR8 - ModelDFSL_VLR8$MGrowth_BIO_VLR8 - ModelDFSL_VLR8$MGrowth_HUM_VLR8
    ModelDFSL_VLR8$Accum_CCO2_VLR8 <- ModelDFSL_VLR8$AccumInput_VLR8 - ModelDFSL_VLR8$AllPools_noIOM_VLR8

    #Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
    ModelDFSL_VLR8$M_CCO2_VLR8[1] <- 0
    ModelDFSL_VLR8$Accum_CCO2_VLR8[1] <- 0

    #Balance validation
    ModelDFSL_VLR8$Balance_VLR8 <- ModelDFSL_VLR8$AccumInput_VLR8 - ModelDFSL_VLR8$Accum_CCO2_VLR8 - (ModelDFSL_VLR8$DPM_VLR8 + ModelDFSL_VLR8$RPM_VLR8 + ModelDFSL_VLR8$BIO_VLR8 + ModelDFSL_VLR8$HUM_VLR8)

    #Convert C-CO2 emissions into CO2 emissions
    ModelDFSL_VLR8$M_CO2_VLR8 <- ModelDFSL_VLR8$M_CCO2_VLR8 * 44/12
    ModelDFSL_VLR8$Accum_CO2_VLR8 <- ModelDFSL_VLR8$Accum_CCO2_VLR8 * 44/12

    #This model will be called VLR8C because implies a continuous input of C
    ModelDFSL_VLR8C <- ModelDFSL_VLR8

    #Export the dataframe
    write_xlsx(ModelDFSL_VLR8C,"VXC_Models\\ModelDFSL_R_VLR8C.xlsx")

    #Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
    #Create two equal models by using the above general script
    #Create model t=x
    ModelDFSLt0_VLR8 <- ModelDFSL_VLR8 #Create model t=x

    #Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
    ModelDFSLt1_VLR8.1 <- rbind(c(0:0), ModelDFSLt0_VLR8)
    ModelDFSLt1_VLR8.2 <- rbind(c(0:0), ModelDFSLt1_VLR8.1)
    ModelDFSLt1_VLR8.3 <- rbind(c(0:0), ModelDFSLt1_VLR8.2)
    ModelDFSLt1_VLR8.4 <- rbind(c(0:0), ModelDFSLt1_VLR8.3)
    ModelDFSLt1_VLR8.5 <- rbind(c(0:0), ModelDFSLt1_VLR8.4)
    ModelDFSLt1_VLR8.6 <- rbind(c(0:0), ModelDFSLt1_VLR8.5)
    ModelDFSLt1_VLR8.7 <- rbind(c(0:0), ModelDFSLt1_VLR8.6)
    ModelDFSLt1_VLR8.8 <- rbind(c(0:0), ModelDFSLt1_VLR8.7)
    ModelDFSLt1_VLR8.9 <- rbind(c(0:0), ModelDFSLt1_VLR8.8)
    ModelDFSLt1_VLR8.10 <- rbind(c(0:0), ModelDFSLt1_VLR8.9)
    ModelDFSLt1_VLR8.11 <- rbind(c(0:0), ModelDFSLt1_VLR8.10)
    ModelDFSLt1_VLR8.12 <- rbind(c(0:0), ModelDFSLt1_VLR8.11)
    ModelDFSLt1_VLR8.13 <- ModelDFSLt1_VLR8.12[-nrow(ModelDFSLt1_VLR8.12),]
    ModelDFSLt1_VLR8.14 <- ModelDFSLt1_VLR8.13[-nrow(ModelDFSLt1_VLR8.13),]
    ModelDFSLt1_VLR8.15 <- ModelDFSLt1_VLR8.14[-nrow(ModelDFSLt1_VLR8.14),]
    ModelDFSLt1_VLR8.16 <- ModelDFSLt1_VLR8.15[-nrow(ModelDFSLt1_VLR8.15),]
    ModelDFSLt1_VLR8.17 <- ModelDFSLt1_VLR8.16[-nrow(ModelDFSLt1_VLR8.16),]
    ModelDFSLt1_VLR8.18 <- ModelDFSLt1_VLR8.17[-nrow(ModelDFSLt1_VLR8.17),]
    ModelDFSLt1_VLR8.19 <- ModelDFSLt1_VLR8.18[-nrow(ModelDFSLt1_VLR8.18),]
    ModelDFSLt1_VLR8.20 <- ModelDFSLt1_VLR8.19[-nrow(ModelDFSLt1_VLR8.19),]
    ModelDFSLt1_VLR8.21 <- ModelDFSLt1_VLR8.20[-nrow(ModelDFSLt1_VLR8.20),]
    ModelDFSLt1_VLR8.22 <- ModelDFSLt1_VLR8.21[-nrow(ModelDFSLt1_VLR8.21),]
    ModelDFSLt1_VLR8.23 <- ModelDFSLt1_VLR8.22[-nrow(ModelDFSLt1_VLR8.22),]
    ModelDFSLt1_VLR8.24 <- ModelDFSLt1_VLR8.23[-nrow(ModelDFSLt1_VLR8.23),]

    ModelDFSLt1_VLR8 <- ModelDFSLt1_VLR8.24 #Create model t=x+1

    #Subtract model (t=x) - (t=x+1)
    ModelDFSL1y_VLR8 <- ModelDFSLt0_VLR8 - ModelDFSLt1_VLR8

    #Re-do Month Number column because the substraction was also applied to it
    ModelDFSL1y_VLR8$MNumber <- seq(from = 1, to = SimulationLength_months)

    #This model will be called VLR8P because implies a one-off input of C
    ModelDFSL_VLR8P <- ModelDFSL1y_VLR8

    #Export the dataframe
    write_xlsx(ModelDFSL_VLR8P,"VXP_Models\\ModelDFSL_R_VLR8P.xlsx")


    #Plot 3: Interactive Yearly CO2 emissions #
    MY <- 12
    ModelDFSL_VLR8P_YCO2 <- ModelDFSL_VLR8P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VLR8)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLR8P_YCO2) <- c("Year", "Months", "AnnualCO2_VLR_8")

    #Plot 3: Interactive Yearly CO2 emissions considering a delay
    GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
    ModelDFSL_VLR8P_YCO2D <- merge(ModelDFSL_VLR8P_YCO2, GWP100delay, by = "Year")
    ModelDFSL_VLR8P_YCO2D$AnnualCO2D_VLR_8 <- ModelDFSL_VLR8P_YCO2D$AnnualCO2_VLR_8 * ModelDFSL_VLR8P_YCO2D$GWP100


    #Plot 4: Interactive Yearly C emissions #
    MY <- 12
    ModelDFSL_VLR8P_YC <- ModelDFSL_VLR8P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VLR8)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLR8P_YC) <- c("Year", "Months", "CEmissions_VLR_8")

    #Plot 5: Interactive Yearly C tails (remaining C in Soil) #
    MY <- 12
    ModelDFSL_VLR8P_YCT <- ModelDFSL_VLR8P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VLR8)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLR8P_YCT) <- c("Year", "Months", "CTail_VLR_8")

    #Save Dataframes for Plots 3.1, 3.2, 4 and 5
    write_xlsx(ModelDFSL_VLR8P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VLR8P.xlsx") #Yearly CO2 emissions (no delay)
    write_xlsx(ModelDFSL_VLR8P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VLR8P.xlsx") #Yearly CO2 emissions (delay)
    write_xlsx(ModelDFSL_VLR8P_YC,"CEmissions_P\\ModelDFSL_R_CE_VLR8P.xlsx") #Yearly C emissions
    write_xlsx(ModelDFSL_VLR8P_YCT,"CTails_P\\ModelDFSL_R_CT_VLR8P.xlsx") #Yearly C emissions



#### 8.10 - VLR9) Litter; 90%clay; Reduced Tillage ####
    #The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
    fT_VLR9=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
    fW_VLR9=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                            S.Thick = soil.thick, pClay = clay100*0.9,
                            pE = 1.0, bare = FALSE)$b #Moisture effects per month
    xi.frame_VLR9=data.frame(years,rep(fT_VLR9*fW_VLR9,length.out=length(years)))

    #To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
    Model_VLR9=SoilR::RothCModel(
      t=years, #Simulation Length
      ks=c(k.DPM = 10*RTRM, k.RPM = 0.3*RTRM, k.BIO = 0.66*RTRM, k.HUM = 0.02*RTRM, k.IOM = 0*RTRM), #Decomposition rates for the different pools
      C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
      In=Scalar_LitterCinputs*1, #Amount of litter inputs by time
      FYM = Scalar_ManureCinputs*0, #Amount of Farm Yard Manure by time
      clay=clay100*0.9, #Percent clay in mineral soil
      xi=xi.frame_VLR9) #Loads the model

    Ct_VLR9=getC(Model_VLR9) #Calculates stocks for each pool per month

    #The results can be plotted with the commands
    matplot(years, Ct_VLR9, type="l", lty=1, col=1:5,
            xlab="Time (years)", ylab="C stocks (Mg/ha)")
    legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
           lty=1, col=1:5, bty="n")

    VEC_Lit_VLR9 <- rep(M_Scalar_LitterCinputs*1, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
    VEC_Man_VLR9 <- rep(M_Scalar_ManureCinputs*0, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

    VEC_LitDF_VLR9 <- as.data.frame(VEC_Lit_VLR9) #Converting the Litter vector to a data frame
    VEC_LitDF_VLR9$MNumber <- seq(from = 1, to = SimulationLength_months)
    VEC_ManDF_VLR9 <- as.data.frame(VEC_Man_VLR9) #Converting the Manure vector to a data frame
    VEC_ManDF_VLR9$MNumber <- seq(from = 1, to = SimulationLength_months)

    sapply(VEC_LitDF_VLR9, class) #Check that class is numeric
    sapply(VEC_ManDF_VLR9, class) #Check that class is numeric
    LitterCinputs_VLR9=VEC_LitDF_VLR9   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    ManureCinputs_VLR9=VEC_ManDF_VLR9 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    MCinputs_VLR9 <- merge(LitterCinputs_VLR9, ManureCinputs_VLR9, by = "MNumber")
    MCinputs_VLR9$MInput_VLR9 <- MCinputs_VLR9$VEC_Lit_VLR9 + MCinputs_VLR9$VEC_Man_VLR9

    #Change names of litter and manure columns for more common ones
    colnames(MCinputs_VLR9)[which(names(MCinputs_VLR9) == "VEC_Lit_VLR9")] <- "LitterC_VLR9"
    colnames(MCinputs_VLR9)[which(names(MCinputs_VLR9) == "VEC_Man_VLR9")] <- "ManureC_VLR9"

    #Create a dataframe with the data considering the simulation length
    ModelDF_VLR9 <- as.data.frame(Ct_VLR9)
    colnames(ModelDF_VLR9) <- c('DPM_VLR9','RPM_VLR9','BIO_VLR9', 'HUM_VLR9', 'IOM_VLR9')
    ModelDFS_VLR9 <- ModelDF_VLR9[1:SimulationLength_months, ]

    #Create a column with the number of month of analysis
    ModelDFS_VLR9$MNumber <- seq(from = 1, to = SimulationLength_months)

    #Create a column that sums all pools
    ModelDFS_VLR9$AllPools_VLR9 <- ModelDFS_VLR9$DPM_VLR9 + ModelDFS_VLR9$RPM_VLR9 + ModelDFS_VLR9$BIO_VLR9 + ModelDFS_VLR9$HUM_VLR9 + ModelDFS_VLR9$IOM_VLR9

    #Create a column that sums all pools except IOM (static)
    ModelDFS_VLR9$AllPools_noIOM_VLR9 <- ModelDFS_VLR9$DPM_VLR9 + ModelDFS_VLR9$RPM_VLR9 + ModelDFS_VLR9$BIO_VLR9 + ModelDFS_VLR9$HUM_VLR9

    #Create a column that add the monthly input of C (manure and litter separately)
    ModelDFSL_VLR9 <- merge(ModelDFS_VLR9, MCinputs_VLR9, by = "MNumber")

    ModelDFSL_VLR9$MInput_VLR9 <- ModelDFSL_VLR9$LitterC_VLR9 + ModelDFSL_VLR9$ManureC_VLR9
    #ModelDF_SL$MInput[1] <- 0

    #Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
    ModelDFSL_VLR9$CTails_VLR9 <- ModelDFSL_VLR9$AllPools_noIOM_VLR9 + ModelDFSL_VLR9$MInput_VLR9

    #Create Monthly Accumulated input of C
    ModelDFSL_VLR9$AccumInput_VLR9 = ModelDFSL_VLR9$AccumInput_VLR9=cumsum(ModelDFSL_VLR9$MInput_VLR9)

    #Create Monthly Growths for each carbon pool
    ModelDFSL_VLR9$MGrowth_DPM_VLR9 <- ave(ModelDFSL_VLR9$DPM_VLR9, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLR9$MGrowth_RPM_VLR9 <- ave(ModelDFSL_VLR9$RPM_VLR9, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLR9$MGrowth_BIO_VLR9 <- ave(ModelDFSL_VLR9$BIO_VLR9, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLR9$MGrowth_HUM_VLR9 <- ave(ModelDFSL_VLR9$HUM_VLR9, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLR9$MGrowth_IOM_VLR9 <- ave(ModelDFSL_VLR9$IOM_VLR9, FUN = function(x) c(0, diff(x)))

    #Create column for Monthly and Accumulated C-CO2 emissions
    ModelDFSL_VLR9$M_CCO2_VLR9 <- ModelDFSL_VLR9$MInput_VLR9 - ModelDFSL_VLR9$MGrowth_DPM_VLR9 - ModelDFSL_VLR9$MGrowth_RPM_VLR9 - ModelDFSL_VLR9$MGrowth_BIO_VLR9 - ModelDFSL_VLR9$MGrowth_HUM_VLR9
    ModelDFSL_VLR9$Accum_CCO2_VLR9 <- ModelDFSL_VLR9$AccumInput_VLR9 - ModelDFSL_VLR9$AllPools_noIOM_VLR9

    #Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
    ModelDFSL_VLR9$M_CCO2_VLR9[1] <- 0
    ModelDFSL_VLR9$Accum_CCO2_VLR9[1] <- 0

    #Balance validation
    ModelDFSL_VLR9$Balance_VLR9 <- ModelDFSL_VLR9$AccumInput_VLR9 - ModelDFSL_VLR9$Accum_CCO2_VLR9 - (ModelDFSL_VLR9$DPM_VLR9 + ModelDFSL_VLR9$RPM_VLR9 + ModelDFSL_VLR9$BIO_VLR9 + ModelDFSL_VLR9$HUM_VLR9)

    #Convert C-CO2 emissions into CO2 emissions
    ModelDFSL_VLR9$M_CO2_VLR9 <- ModelDFSL_VLR9$M_CCO2_VLR9 * 44/12
    ModelDFSL_VLR9$Accum_CO2_VLR9 <- ModelDFSL_VLR9$Accum_CCO2_VLR9 * 44/12

    #This model will be called VLR9C because implies a continuous input of C
    ModelDFSL_VLR9C <- ModelDFSL_VLR9

    #Export the dataframe
    write_xlsx(ModelDFSL_VLR9C,"VXC_Models\\ModelDFSL_R_VLR9C.xlsx")

    #Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
    #Create two equal models by using the above general script
    #Create model t=x
    ModelDFSLt0_VLR9 <- ModelDFSL_VLR9 #Create model t=x

    #Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
    ModelDFSLt1_VLR9.1 <- rbind(c(0:0), ModelDFSLt0_VLR9)
    ModelDFSLt1_VLR9.2 <- rbind(c(0:0), ModelDFSLt1_VLR9.1)
    ModelDFSLt1_VLR9.3 <- rbind(c(0:0), ModelDFSLt1_VLR9.2)
    ModelDFSLt1_VLR9.4 <- rbind(c(0:0), ModelDFSLt1_VLR9.3)
    ModelDFSLt1_VLR9.5 <- rbind(c(0:0), ModelDFSLt1_VLR9.4)
    ModelDFSLt1_VLR9.6 <- rbind(c(0:0), ModelDFSLt1_VLR9.5)
    ModelDFSLt1_VLR9.7 <- rbind(c(0:0), ModelDFSLt1_VLR9.6)
    ModelDFSLt1_VLR9.8 <- rbind(c(0:0), ModelDFSLt1_VLR9.7)
    ModelDFSLt1_VLR9.9 <- rbind(c(0:0), ModelDFSLt1_VLR9.8)
    ModelDFSLt1_VLR9.10 <- rbind(c(0:0), ModelDFSLt1_VLR9.9)
    ModelDFSLt1_VLR9.11 <- rbind(c(0:0), ModelDFSLt1_VLR9.10)
    ModelDFSLt1_VLR9.12 <- rbind(c(0:0), ModelDFSLt1_VLR9.11)
    ModelDFSLt1_VLR9.13 <- ModelDFSLt1_VLR9.12[-nrow(ModelDFSLt1_VLR9.12),]
    ModelDFSLt1_VLR9.14 <- ModelDFSLt1_VLR9.13[-nrow(ModelDFSLt1_VLR9.13),]
    ModelDFSLt1_VLR9.15 <- ModelDFSLt1_VLR9.14[-nrow(ModelDFSLt1_VLR9.14),]
    ModelDFSLt1_VLR9.16 <- ModelDFSLt1_VLR9.15[-nrow(ModelDFSLt1_VLR9.15),]
    ModelDFSLt1_VLR9.17 <- ModelDFSLt1_VLR9.16[-nrow(ModelDFSLt1_VLR9.16),]
    ModelDFSLt1_VLR9.18 <- ModelDFSLt1_VLR9.17[-nrow(ModelDFSLt1_VLR9.17),]
    ModelDFSLt1_VLR9.19 <- ModelDFSLt1_VLR9.18[-nrow(ModelDFSLt1_VLR9.18),]
    ModelDFSLt1_VLR9.20 <- ModelDFSLt1_VLR9.19[-nrow(ModelDFSLt1_VLR9.19),]
    ModelDFSLt1_VLR9.21 <- ModelDFSLt1_VLR9.20[-nrow(ModelDFSLt1_VLR9.20),]
    ModelDFSLt1_VLR9.22 <- ModelDFSLt1_VLR9.21[-nrow(ModelDFSLt1_VLR9.21),]
    ModelDFSLt1_VLR9.23 <- ModelDFSLt1_VLR9.22[-nrow(ModelDFSLt1_VLR9.22),]
    ModelDFSLt1_VLR9.24 <- ModelDFSLt1_VLR9.23[-nrow(ModelDFSLt1_VLR9.23),]

    ModelDFSLt1_VLR9 <- ModelDFSLt1_VLR9.24 #Create model t=x+1

    #Subtract model (t=x) - (t=x+1)
    ModelDFSL1y_VLR9 <- ModelDFSLt0_VLR9 - ModelDFSLt1_VLR9

    #Re-do Month Number column because the substraction was also applied to it
    ModelDFSL1y_VLR9$MNumber <- seq(from = 1, to = SimulationLength_months)

    #This model will be called VLR9P because implies a one-off input of C
    ModelDFSL_VLR9P <- ModelDFSL1y_VLR9

    #Export the dataframe
    write_xlsx(ModelDFSL_VLR9P,"VXP_Models\\ModelDFSL_R_VLR9P.xlsx")


    #Plot 3: Interactive Yearly CO2 emissions #
    MY <- 12
    ModelDFSL_VLR9P_YCO2 <- ModelDFSL_VLR9P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VLR9)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLR9P_YCO2) <- c("Year", "Months", "AnnualCO2_VLR_9")

    #Plot 3: Interactive Yearly CO2 emissions considering a delay
    GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
    ModelDFSL_VLR9P_YCO2D <- merge(ModelDFSL_VLR9P_YCO2, GWP100delay, by = "Year")
    ModelDFSL_VLR9P_YCO2D$AnnualCO2D_VLR_9 <- ModelDFSL_VLR9P_YCO2D$AnnualCO2_VLR_9 * ModelDFSL_VLR9P_YCO2D$GWP100


    #Plot 4: Interactive Yearly C emissions #
    MY <- 12
    ModelDFSL_VLR9P_YC <- ModelDFSL_VLR9P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VLR9)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLR9P_YC) <- c("Year", "Months", "CEmissions_VLR_9")

    #Plot 5: Interactive Yearly C tails (remaining C in Soil) #
    MY <- 12
    ModelDFSL_VLR9P_YCT <- ModelDFSL_VLR9P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VLR9)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLR9P_YCT) <- c("Year", "Months", "CTail_VLR_9")

    #Save Dataframes for Plots 3.1, 3.2, 4 and 5
    write_xlsx(ModelDFSL_VLR9P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VLR9P.xlsx") #Yearly CO2 emissions (no delay)
    write_xlsx(ModelDFSL_VLR9P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VLR9P.xlsx") #Yearly CO2 emissions (delay)
    write_xlsx(ModelDFSL_VLR9P_YC,"CEmissions_P\\ModelDFSL_R_CE_VLR9P.xlsx") #Yearly C emissions
    write_xlsx(ModelDFSL_VLR9P_YCT,"CTails_P\\ModelDFSL_R_CT_VLR9P.xlsx") #Yearly C emissions



#### 8.11 - VLR10) Litter; 100%clay; Reduced Tillage ####
    #The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
    fT_VLR10=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
    fW_VLR10=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                             S.Thick = soil.thick, pClay = clay100,
                             pE = 1.0, bare = FALSE)$b #Moisture effects per month
    xi.frame_VLR10=data.frame(years,rep(fT_VLR10*fW_VLR10,length.out=length(years)))

    #To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
    Model_VLR10=SoilR::RothCModel(
      t=years, #Simulation Length
      ks=c(k.DPM = 10*RTRM, k.RPM = 0.3*RTRM, k.BIO = 0.66*RTRM, k.HUM = 0.02*RTRM, k.IOM = 0*RTRM), #Decomposition rates for the different pools
      C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
      In=Scalar_LitterCinputs*1, #Amount of litter inputs by time
      FYM = Scalar_ManureCinputs*0, #Amount of Farm Yard Manure by time
      clay=clay100, #Percent clay in mineral soil
      xi=xi.frame_VLR10) #Loads the model

    Ct_VLR10=getC(Model_VLR10) #Calculates stocks for each pool per month

    #The results can be plotted with the commands
    matplot(years, Ct_VLR10, type="l", lty=1, col=1:5,
            xlab="Time (years)", ylab="C stocks (Mg/ha)")
    legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
           lty=1, col=1:5, bty="n")

    VEC_Lit_VLR10 <- rep(M_Scalar_LitterCinputs*1, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
    VEC_Man_VLR10 <- rep(M_Scalar_ManureCinputs*0, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

    VEC_LitDF_VLR10 <- as.data.frame(VEC_Lit_VLR10) #Converting the Litter vector to a data frame
    VEC_LitDF_VLR10$MNumber <- seq(from = 1, to = SimulationLength_months)
    VEC_ManDF_VLR10 <- as.data.frame(VEC_Man_VLR10) #Converting the Manure vector to a data frame
    VEC_ManDF_VLR10$MNumber <- seq(from = 1, to = SimulationLength_months)

    sapply(VEC_LitDF_VLR10, class) #Check that class is numeric
    sapply(VEC_ManDF_VLR10, class) #Check that class is numeric
    LitterCinputs_VLR10=VEC_LitDF_VLR10   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    ManureCinputs_VLR10=VEC_ManDF_VLR10 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    MCinputs_VLR10 <- merge(LitterCinputs_VLR10, ManureCinputs_VLR10, by = "MNumber")
    MCinputs_VLR10$MInput_VLR10 <- MCinputs_VLR10$VEC_Lit_VLR10 + MCinputs_VLR10$VEC_Man_VLR10

    #Change names of litter and manure columns for more common ones
    colnames(MCinputs_VLR10)[which(names(MCinputs_VLR10) == "VEC_Lit_VLR10")] <- "LitterC_VLR10"
    colnames(MCinputs_VLR10)[which(names(MCinputs_VLR10) == "VEC_Man_VLR10")] <- "ManureC_VLR10"

    #Create a dataframe with the data considering the simulation length
    ModelDF_VLR10 <- as.data.frame(Ct_VLR10)
    colnames(ModelDF_VLR10) <- c('DPM_VLR10','RPM_VLR10','BIO_VLR10', 'HUM_VLR10', 'IOM_VLR10')
    ModelDFS_VLR10 <- ModelDF_VLR10[1:SimulationLength_months, ]

    #Create a column with the number of month of analysis
    ModelDFS_VLR10$MNumber <- seq(from = 1, to = SimulationLength_months)

    #Create a column that sums all pools
    ModelDFS_VLR10$AllPools_VLR10 <- ModelDFS_VLR10$DPM_VLR10 + ModelDFS_VLR10$RPM_VLR10 + ModelDFS_VLR10$BIO_VLR10 + ModelDFS_VLR10$HUM_VLR10 + ModelDFS_VLR10$IOM_VLR10

    #Create a column that sums all pools except IOM (static)
    ModelDFS_VLR10$AllPools_noIOM_VLR10 <- ModelDFS_VLR10$DPM_VLR10 + ModelDFS_VLR10$RPM_VLR10 + ModelDFS_VLR10$BIO_VLR10 + ModelDFS_VLR10$HUM_VLR10

    #Create a column that add the monthly input of C (manure and litter separately)
    ModelDFSL_VLR10 <- merge(ModelDFS_VLR10, MCinputs_VLR10, by = "MNumber")

    ModelDFSL_VLR10$MInput_VLR10 <- ModelDFSL_VLR10$LitterC_VLR10 + ModelDFSL_VLR10$ManureC_VLR10
    #ModelDF_SL$MInput[1] <- 0

    #Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
    ModelDFSL_VLR10$CTails_VLR10 <- ModelDFSL_VLR10$AllPools_noIOM_VLR10 + ModelDFSL_VLR10$MInput_VLR10

    #Create Monthly Accumulated input of C
    ModelDFSL_VLR10$AccumInput_VLR10 = ModelDFSL_VLR10$AccumInput_VLR10=cumsum(ModelDFSL_VLR10$MInput_VLR10)

    #Create Monthly Growths for each carbon pool
    ModelDFSL_VLR10$MGrowth_DPM_VLR10 <- ave(ModelDFSL_VLR10$DPM_VLR10, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLR10$MGrowth_RPM_VLR10 <- ave(ModelDFSL_VLR10$RPM_VLR10, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLR10$MGrowth_BIO_VLR10 <- ave(ModelDFSL_VLR10$BIO_VLR10, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLR10$MGrowth_HUM_VLR10 <- ave(ModelDFSL_VLR10$HUM_VLR10, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLR10$MGrowth_IOM_VLR10 <- ave(ModelDFSL_VLR10$IOM_VLR10, FUN = function(x) c(0, diff(x)))

    #Create column for Monthly and Accumulated C-CO2 emissions
    ModelDFSL_VLR10$M_CCO2_VLR10 <- ModelDFSL_VLR10$MInput_VLR10 - ModelDFSL_VLR10$MGrowth_DPM_VLR10 - ModelDFSL_VLR10$MGrowth_RPM_VLR10 - ModelDFSL_VLR10$MGrowth_BIO_VLR10 - ModelDFSL_VLR10$MGrowth_HUM_VLR10
    ModelDFSL_VLR10$Accum_CCO2_VLR10 <- ModelDFSL_VLR10$AccumInput_VLR10 - ModelDFSL_VLR10$AllPools_noIOM_VLR10

    #Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
    ModelDFSL_VLR10$M_CCO2_VLR10[1] <- 0
    ModelDFSL_VLR10$Accum_CCO2_VLR10[1] <- 0

    #Balance validation
    ModelDFSL_VLR10$Balance_VLR10 <- ModelDFSL_VLR10$AccumInput_VLR10 - ModelDFSL_VLR10$Accum_CCO2_VLR10 - (ModelDFSL_VLR10$DPM_VLR10 + ModelDFSL_VLR10$RPM_VLR10 + ModelDFSL_VLR10$BIO_VLR10 + ModelDFSL_VLR10$HUM_VLR10)

    #Convert C-CO2 emissions into CO2 emissions
    ModelDFSL_VLR10$M_CO2_VLR10 <- ModelDFSL_VLR10$M_CCO2_VLR10 * 44/12
    ModelDFSL_VLR10$Accum_CO2_VLR10 <- ModelDFSL_VLR10$Accum_CCO2_VLR10 * 44/12

    #This model will be called VLR10C because implies a continuous input of C
    ModelDFSL_VLR10C <- ModelDFSL_VLR10

    #Export the dataframe
    write_xlsx(ModelDFSL_VLR10C,"VXC_Models\\ModelDFSL_R_VLR10C.xlsx")

    #Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
    #Create two equal models by using the above general script
    #Create model t=x
    ModelDFSLt0_VLR10 <- ModelDFSL_VLR10 #Create model t=x

    #Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
    ModelDFSLt1_VLR10.1 <- rbind(c(0:0), ModelDFSLt0_VLR10)
    ModelDFSLt1_VLR10.2 <- rbind(c(0:0), ModelDFSLt1_VLR10.1)
    ModelDFSLt1_VLR10.3 <- rbind(c(0:0), ModelDFSLt1_VLR10.2)
    ModelDFSLt1_VLR10.4 <- rbind(c(0:0), ModelDFSLt1_VLR10.3)
    ModelDFSLt1_VLR10.5 <- rbind(c(0:0), ModelDFSLt1_VLR10.4)
    ModelDFSLt1_VLR10.6 <- rbind(c(0:0), ModelDFSLt1_VLR10.5)
    ModelDFSLt1_VLR10.7 <- rbind(c(0:0), ModelDFSLt1_VLR10.6)
    ModelDFSLt1_VLR10.8 <- rbind(c(0:0), ModelDFSLt1_VLR10.7)
    ModelDFSLt1_VLR10.9 <- rbind(c(0:0), ModelDFSLt1_VLR10.8)
    ModelDFSLt1_VLR10.10 <- rbind(c(0:0), ModelDFSLt1_VLR10.9)
    ModelDFSLt1_VLR10.11 <- rbind(c(0:0), ModelDFSLt1_VLR10.10)
    ModelDFSLt1_VLR10.12 <- rbind(c(0:0), ModelDFSLt1_VLR10.11)
    ModelDFSLt1_VLR10.13 <- ModelDFSLt1_VLR10.12[-nrow(ModelDFSLt1_VLR10.12),]
    ModelDFSLt1_VLR10.14 <- ModelDFSLt1_VLR10.13[-nrow(ModelDFSLt1_VLR10.13),]
    ModelDFSLt1_VLR10.15 <- ModelDFSLt1_VLR10.14[-nrow(ModelDFSLt1_VLR10.14),]
    ModelDFSLt1_VLR10.16 <- ModelDFSLt1_VLR10.15[-nrow(ModelDFSLt1_VLR10.15),]
    ModelDFSLt1_VLR10.17 <- ModelDFSLt1_VLR10.16[-nrow(ModelDFSLt1_VLR10.16),]
    ModelDFSLt1_VLR10.18 <- ModelDFSLt1_VLR10.17[-nrow(ModelDFSLt1_VLR10.17),]
    ModelDFSLt1_VLR10.19 <- ModelDFSLt1_VLR10.18[-nrow(ModelDFSLt1_VLR10.18),]
    ModelDFSLt1_VLR10.20 <- ModelDFSLt1_VLR10.19[-nrow(ModelDFSLt1_VLR10.19),]
    ModelDFSLt1_VLR10.21 <- ModelDFSLt1_VLR10.20[-nrow(ModelDFSLt1_VLR10.20),]
    ModelDFSLt1_VLR10.22 <- ModelDFSLt1_VLR10.21[-nrow(ModelDFSLt1_VLR10.21),]
    ModelDFSLt1_VLR10.23 <- ModelDFSLt1_VLR10.22[-nrow(ModelDFSLt1_VLR10.22),]
    ModelDFSLt1_VLR10.24 <- ModelDFSLt1_VLR10.23[-nrow(ModelDFSLt1_VLR10.23),]

    ModelDFSLt1_VLR10 <- ModelDFSLt1_VLR10.24 #Create model t=x+1

    #Subtract model (t=x) - (t=x+1)
    ModelDFSL1y_VLR10 <- ModelDFSLt0_VLR10 - ModelDFSLt1_VLR10

    #Re-do Month Number column because the substraction was also applied to it
    ModelDFSL1y_VLR10$MNumber <- seq(from = 1, to = SimulationLength_months)

    #This model will be called VLR10P because implies a one-off input of C
    ModelDFSL_VLR10P <- ModelDFSL1y_VLR10

    #Export the dataframe
    write_xlsx(ModelDFSL_VLR10P,"VXP_Models\\ModelDFSL_R_VLR10P.xlsx")


    #Plot 3: Interactive Yearly CO2 emissions #
    MY <- 12
    ModelDFSL_VLR10P_YCO2 <- ModelDFSL_VLR10P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VLR10)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLR10P_YCO2) <- c("Year", "Months", "AnnualCO2_VLR10")

    #Plot 3: Interactive Yearly CO2 emissions considering a delay
    GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
    ModelDFSL_VLR10P_YCO2D <- merge(ModelDFSL_VLR10P_YCO2, GWP100delay, by = "Year")
    ModelDFSL_VLR10P_YCO2D$AnnualCO2D_VLR10 <- ModelDFSL_VLR10P_YCO2D$AnnualCO2_VLR10 * ModelDFSL_VLR10P_YCO2D$GWP100

    #Plot 4: Interactive Yearly C emissions #
    MY <- 12
    ModelDFSL_VLR10P_YC <- ModelDFSL_VLR10P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VLR10)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLR10P_YC) <- c("Year", "Months", "CEmissions_VLR10")

    #Plot 5: Interactive Yearly C tails (remaining C in Soil) #
    MY <- 12
    ModelDFSL_VLR10P_YCT <- ModelDFSL_VLR10P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VLR10)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLR10P_YCT) <- c("Year", "Months", "CTail_VLR10")

    #Save Dataframes for Plots 3.1, 3.2, 4 and 5
    write_xlsx(ModelDFSL_VLR10P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VLR10P.xlsx") #Yearly CO2 emissions (no delay)
    write_xlsx(ModelDFSL_VLR10P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VLR10P.xlsx") #Yearly CO2 emissions (delay)
    write_xlsx(ModelDFSL_VLR10P_YC,"CEmissions_P\\ModelDFSL_R_CE_VLR10P.xlsx") #Yearly C emissions
    write_xlsx(ModelDFSL_VLR10P_YCT,"CTails_P\\ModelDFSL_R_CT_VLR10P.xlsx") #Yearly C emissions



  }
  else if(Scope == "VLN"){
    #### 9) Model Combinations - Litter; No Tillage, 0-100% (+10%) Clay ####
    #### 9.1 - VLN0) Litter; 0%clay; No Tillage ####
    #The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
    fT_VLN0=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
    fW_VLN0=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                            S.Thick = soil.thick, pClay = clay0,
                            pE = 1.0, bare = FALSE)$b #Moisture effects per month
    xi.frame_VLN0=data.frame(years,rep(fT_VLN0*fW_VLN0,length.out=length(years)))

    #To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
    Model_VLN0=SoilR::RothCModel(
      t=years, #Simulation Length
      ks=c(k.DPM = 10*NTRM, k.RPM = 0.3*NTRM, k.BIO = 0.66*NTRM, k.HUM = 0.02*NTRM, k.IOM = 0*NTRM), #Decomposition rates for the different pools
      C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
      In=Scalar_LitterCinputs*1, #Amount of litter inputs by time
      FYM = Scalar_ManureCinputs*0, #Amount of Farm Yard Manure by time
      clay=clay0, #Percent clay in mineral soil
      xi=xi.frame_VLN0) #Loads the model

    Ct_VLN0=getC(Model_VLN0) #Calculates stocks for each pool per month

    VEC_Lit_VLN0 <- rep(M_Scalar_LitterCinputs*1, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
    VEC_Man_VLN0 <- rep(M_Scalar_ManureCinputs*0, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

    VEC_LitDF_VLN0 <- as.data.frame(VEC_Lit_VLN0) #Converting the Litter vector to a data frame
    VEC_LitDF_VLN0$MNumber <- seq(from = 1, to = SimulationLength_months)
    VEC_ManDF_VLN0 <- as.data.frame(VEC_Man_VLN0) #Converting the Manure vector to a data frame
    VEC_ManDF_VLN0$MNumber <- seq(from = 1, to = SimulationLength_months)

    sapply(VEC_LitDF_VLN0, class) #Check that class is numeric
    sapply(VEC_ManDF_VLN0, class) #Check that class is numeric
    LitterCinputs_VLN0=VEC_LitDF_VLN0   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    ManureCinputs_VLN0=VEC_ManDF_VLN0 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    MCinputs_VLN0 <- merge(LitterCinputs_VLN0, ManureCinputs_VLN0, by = "MNumber")
    MCinputs_VLN0$MInput_VLN0 <- MCinputs_VLN0$VEC_Lit_VLN0 + MCinputs_VLN0$VEC_Man_VLN0

    #Change names of litter and manure columns for more common ones
    colnames(MCinputs_VLN0)[which(names(MCinputs_VLN0) == "VEC_Lit_VLN0")] <- "LitterC_VLN0"
    colnames(MCinputs_VLN0)[which(names(MCinputs_VLN0) == "VEC_Man_VLN0")] <- "ManureC_VLN0"

    #Create a dataframe with the data considering the simulation length
    ModelDF_VLN0 <- as.data.frame(Ct_VLN0)
    colnames(ModelDF_VLN0) <- c('DPM_VLN0','RPM_VLN0','BIO_VLN0', 'HUM_VLN0', 'IOM_VLN0')
    ModelDFS_VLN0 <- ModelDF_VLN0[1:SimulationLength_months, ]

    #Create a column with the number of month of analysis
    ModelDFS_VLN0$MNumber <- seq(from = 1, to = SimulationLength_months)

    #Create a column that sums all pools
    ModelDFS_VLN0$AllPools_VLN0 <- ModelDFS_VLN0$DPM_VLN0 + ModelDFS_VLN0$RPM_VLN0 + ModelDFS_VLN0$BIO_VLN0 + ModelDFS_VLN0$HUM_VLN0 + ModelDFS_VLN0$IOM_VLN0

    #Create a column that sums all pools except IOM (static)
    ModelDFS_VLN0$AllPools_noIOM_VLN0 <- ModelDFS_VLN0$DPM_VLN0 + ModelDFS_VLN0$RPM_VLN0 + ModelDFS_VLN0$BIO_VLN0 + ModelDFS_VLN0$HUM_VLN0

    #Create a column that add the monthly input of C (manure and litter separately)
    ModelDFSL_VLN0 <- merge(ModelDFS_VLN0, MCinputs_VLN0, by = "MNumber")

    ModelDFSL_VLN0$MInput_VLN0 <- ModelDFSL_VLN0$LitterC_VLN0 + ModelDFSL_VLN0$ManureC_VLN0
    #ModelDF_SL$MInput[1] <- 0

    #Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
    ModelDFSL_VLN0$CTails_VLN0 <- ModelDFSL_VLN0$AllPools_noIOM_VLN0 + ModelDFSL_VLN0$MInput_VLN0

    #Create Monthly Accumulated input of C
    ModelDFSL_VLN0$AccumInput_VLN0 = ModelDFSL_VLN0$AccumInput_VLN0=cumsum(ModelDFSL_VLN0$MInput_VLN0)

    #Create Monthly Growths for each carbon pool
    ModelDFSL_VLN0$MGrowth_DPM_VLN0 <- ave(ModelDFSL_VLN0$DPM_VLN0, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLN0$MGrowth_RPM_VLN0 <- ave(ModelDFSL_VLN0$RPM_VLN0, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLN0$MGrowth_BIO_VLN0 <- ave(ModelDFSL_VLN0$BIO_VLN0, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLN0$MGrowth_HUM_VLN0 <- ave(ModelDFSL_VLN0$HUM_VLN0, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLN0$MGrowth_IOM_VLN0 <- ave(ModelDFSL_VLN0$IOM_VLN0, FUN = function(x) c(0, diff(x)))

    #Create column for Monthly and Accumulated C-CO2 emissions
    ModelDFSL_VLN0$M_CCO2_VLN0 <- ModelDFSL_VLN0$MInput_VLN0 - ModelDFSL_VLN0$MGrowth_DPM_VLN0 - ModelDFSL_VLN0$MGrowth_RPM_VLN0 - ModelDFSL_VLN0$MGrowth_BIO_VLN0 - ModelDFSL_VLN0$MGrowth_HUM_VLN0
    ModelDFSL_VLN0$Accum_CCO2_VLN0 <- ModelDFSL_VLN0$AccumInput_VLN0 - ModelDFSL_VLN0$AllPools_noIOM_VLN0

    #Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
    ModelDFSL_VLN0$M_CCO2_VLN0[1] <- 0
    ModelDFSL_VLN0$Accum_CCO2_VLN0[1] <- 0

    #Balance validation
    ModelDFSL_VLN0$Balance_VLN0 <- ModelDFSL_VLN0$AccumInput_VLN0 - ModelDFSL_VLN0$Accum_CCO2_VLN0 - (ModelDFSL_VLN0$DPM_VLN0 + ModelDFSL_VLN0$RPM_VLN0 + ModelDFSL_VLN0$BIO_VLN0 + ModelDFSL_VLN0$HUM_VLN0)

    #Convert C-CO2 emissions into CO2 emissions
    ModelDFSL_VLN0$M_CO2_VLN0 <- ModelDFSL_VLN0$M_CCO2_VLN0 * 44/12
    ModelDFSL_VLN0$Accum_CO2_VLN0 <- ModelDFSL_VLN0$Accum_CCO2_VLN0 * 44/12

    #This model will be called VLN0C because implies a continuous input of C
    ModelDFSL_VLN0C <- ModelDFSL_VLN0

    #Export the dataframe
    write_xlsx(ModelDFSL_VLN0C,"VXC_Models\\ModelDFSL_R_VLN0C.xlsx")

    #Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
    #Create two equal models by using the above general script
    #Create model t=x
    ModelDFSLt0_VLN0 <- ModelDFSL_VLN0 #Create model t=x

    #Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
    ModelDFSLt1_VLN0.1 <- rbind(c(0:0), ModelDFSLt0_VLN0)
    ModelDFSLt1_VLN0.2 <- rbind(c(0:0), ModelDFSLt1_VLN0.1)
    ModelDFSLt1_VLN0.3 <- rbind(c(0:0), ModelDFSLt1_VLN0.2)
    ModelDFSLt1_VLN0.4 <- rbind(c(0:0), ModelDFSLt1_VLN0.3)
    ModelDFSLt1_VLN0.5 <- rbind(c(0:0), ModelDFSLt1_VLN0.4)
    ModelDFSLt1_VLN0.6 <- rbind(c(0:0), ModelDFSLt1_VLN0.5)
    ModelDFSLt1_VLN0.7 <- rbind(c(0:0), ModelDFSLt1_VLN0.6)
    ModelDFSLt1_VLN0.8 <- rbind(c(0:0), ModelDFSLt1_VLN0.7)
    ModelDFSLt1_VLN0.9 <- rbind(c(0:0), ModelDFSLt1_VLN0.8)
    ModelDFSLt1_VLN0.10 <- rbind(c(0:0), ModelDFSLt1_VLN0.9)
    ModelDFSLt1_VLN0.11 <- rbind(c(0:0), ModelDFSLt1_VLN0.10)
    ModelDFSLt1_VLN0.12 <- rbind(c(0:0), ModelDFSLt1_VLN0.11)
    ModelDFSLt1_VLN0.13 <- ModelDFSLt1_VLN0.12[-nrow(ModelDFSLt1_VLN0.12),]
    ModelDFSLt1_VLN0.14 <- ModelDFSLt1_VLN0.13[-nrow(ModelDFSLt1_VLN0.13),]
    ModelDFSLt1_VLN0.15 <- ModelDFSLt1_VLN0.14[-nrow(ModelDFSLt1_VLN0.14),]
    ModelDFSLt1_VLN0.16 <- ModelDFSLt1_VLN0.15[-nrow(ModelDFSLt1_VLN0.15),]
    ModelDFSLt1_VLN0.17 <- ModelDFSLt1_VLN0.16[-nrow(ModelDFSLt1_VLN0.16),]
    ModelDFSLt1_VLN0.18 <- ModelDFSLt1_VLN0.17[-nrow(ModelDFSLt1_VLN0.17),]
    ModelDFSLt1_VLN0.19 <- ModelDFSLt1_VLN0.18[-nrow(ModelDFSLt1_VLN0.18),]
    ModelDFSLt1_VLN0.20 <- ModelDFSLt1_VLN0.19[-nrow(ModelDFSLt1_VLN0.19),]
    ModelDFSLt1_VLN0.21 <- ModelDFSLt1_VLN0.20[-nrow(ModelDFSLt1_VLN0.20),]
    ModelDFSLt1_VLN0.22 <- ModelDFSLt1_VLN0.21[-nrow(ModelDFSLt1_VLN0.21),]
    ModelDFSLt1_VLN0.23 <- ModelDFSLt1_VLN0.22[-nrow(ModelDFSLt1_VLN0.22),]
    ModelDFSLt1_VLN0.24 <- ModelDFSLt1_VLN0.23[-nrow(ModelDFSLt1_VLN0.23),]

    ModelDFSLt1_VLN0 <- ModelDFSLt1_VLN0.24 #Create model t=x+1

    #Subtract model (t=x) - (t=x+1)
    ModelDFSL1y_VLN0 <- ModelDFSLt0_VLN0 - ModelDFSLt1_VLN0

    #Re-do Month Number column because the substraction was also applied to it
    ModelDFSL1y_VLN0$MNumber <- seq(from = 1, to = SimulationLength_months)

    #This model will be called VLN0P because implies a one-off input of C
    ModelDFSL_VLN0P <- ModelDFSL1y_VLN0

    #Export the dataframe
    write_xlsx(ModelDFSL_VLN0P,"VXP_Models\\ModelDFSL_R_VLN0P.xlsx")

    #Plot 3.1: Interactive Yearly CO2 emissions #
    MY <- 12
    ModelDFSL_VLN0P_YCO2 <- ModelDFSL_VLN0P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VLN0)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLN0P_YCO2) <- c("Year", "Months", "AnnualCO2_VLN_0")

    #Plot 3.2: Interactive Yearly CO2 emissions considering a delay
    GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
    ModelDFSL_VLN0P_YCO2D <- merge(ModelDFSL_VLN0P_YCO2, GWP100delay, by = "Year")
    ModelDFSL_VLN0P_YCO2D$AnnualCO2D_VLN_0 <- ModelDFSL_VLN0P_YCO2D$AnnualCO2_VLN_0 * ModelDFSL_VLN0P_YCO2D$GWP100

    #Plot 4: Interactive Yearly C emissions #
    MY <- 12
    ModelDFSL_VLN0P_YC <- ModelDFSL_VLN0P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VLN0)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLN0P_YC) <- c("Year", "Months", "CEmissions_VLN_0")

    #Plot 5: Interactive Yearly C tails (remaining C in Soil) #
    MY <- 12
    ModelDFSL_VLN0P_YCT <- ModelDFSL_VLN0P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VLN0)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLN0P_YCT) <- c("Year", "Months", "CTail_VLN_0")

    #Save Dataframes for Plots 3.1, 3.2, 4 and 5
    write_xlsx(ModelDFSL_VLN0P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VLN0P.xlsx") #Yearly CO2 emissions (no delay)
    write_xlsx(ModelDFSL_VLN0P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VLN0P.xlsx") #Yearly CO2 emissions (delay)
    write_xlsx(ModelDFSL_VLN0P_YC,"CEmissions_P\\ModelDFSL_R_CE_VLN0P.xlsx") #Yearly C emissions
    write_xlsx(ModelDFSL_VLN0P_YCT,"CTails_P\\ModelDFSL_R_CT_VLN0P.xlsx") #Yearly C emissions


    #### 9.2 - VLN1) Litter; 10%clay; No Tillage ####
    #The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
    fT_VLN1=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
    fW_VLN1=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                            S.Thick = soil.thick, pClay = clay100*0.1,
                            pE = 1.0, bare = FALSE)$b #Moisture effects per month
    xi.frame_VLN1=data.frame(years,rep(fT_VLN1*fW_VLN1,length.out=length(years)))

    #To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
    Model_VLN1=SoilR::RothCModel(
      t=years, #Simulation Length
      ks=c(k.DPM = 10*NTRM, k.RPM = 0.3*NTRM, k.BIO = 0.66*NTRM, k.HUM = 0.02*NTRM, k.IOM = 0*NTRM), #Decomposition rates for the different pools
      C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
      In=Scalar_LitterCinputs*1, #Amount of litter inputs by time
      FYM = Scalar_ManureCinputs*0, #Amount of Farm Yard Manure by time
      clay=clay100*0.1, #Percent clay in mineral soil
      xi=xi.frame_VLN1) #Loads the model

    Ct_VLN1=getC(Model_VLN1) #Calculates stocks for each pool per month

    #The results can be plotted with the commands
    matplot(years, Ct_VLN1, type="l", lty=1, col=1:5,
            xlab="Time (years)", ylab="C stocks (Mg/ha)")
    legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
           lty=1, col=1:5, bty="n")

    VEC_Lit_VLN1 <- rep(M_Scalar_LitterCinputs*1, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
    VEC_Man_VLN1 <- rep(M_Scalar_ManureCinputs*0, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

    VEC_LitDF_VLN1 <- as.data.frame(VEC_Lit_VLN1) #Converting the Litter vector to a data frame
    VEC_LitDF_VLN1$MNumber <- seq(from = 1, to = SimulationLength_months)
    VEC_ManDF_VLN1 <- as.data.frame(VEC_Man_VLN1) #Converting the Manure vector to a data frame
    VEC_ManDF_VLN1$MNumber <- seq(from = 1, to = SimulationLength_months)

    sapply(VEC_LitDF_VLN1, class) #Check that class is numeric
    sapply(VEC_ManDF_VLN1, class) #Check that class is numeric
    LitterCinputs_VLN1=VEC_LitDF_VLN1   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    ManureCinputs_VLN1=VEC_ManDF_VLN1 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    MCinputs_VLN1 <- merge(LitterCinputs_VLN1, ManureCinputs_VLN1, by = "MNumber")
    MCinputs_VLN1$MInput_VLN1 <- MCinputs_VLN1$VEC_Lit_VLN1 + MCinputs_VLN1$VEC_Man_VLN1

    #Change names of litter and manure columns for more common ones
    colnames(MCinputs_VLN1)[which(names(MCinputs_VLN1) == "VEC_Lit_VLN1")] <- "LitterC_VLN1"
    colnames(MCinputs_VLN1)[which(names(MCinputs_VLN1) == "VEC_Man_VLN1")] <- "ManureC_VLN1"

    #Create a dataframe with the data considering the simulation length
    ModelDF_VLN1 <- as.data.frame(Ct_VLN1)
    colnames(ModelDF_VLN1) <- c('DPM_VLN1','RPM_VLN1','BIO_VLN1', 'HUM_VLN1', 'IOM_VLN1')
    ModelDFS_VLN1 <- ModelDF_VLN1[1:SimulationLength_months, ]

    #Create a column with the number of month of analysis
    ModelDFS_VLN1$MNumber <- seq(from = 1, to = SimulationLength_months)

    #Create a column that sums all pools
    ModelDFS_VLN1$AllPools_VLN1 <- ModelDFS_VLN1$DPM_VLN1 + ModelDFS_VLN1$RPM_VLN1 + ModelDFS_VLN1$BIO_VLN1 + ModelDFS_VLN1$HUM_VLN1 + ModelDFS_VLN1$IOM_VLN1

    #Create a column that sums all pools except IOM (static)
    ModelDFS_VLN1$AllPools_noIOM_VLN1 <- ModelDFS_VLN1$DPM_VLN1 + ModelDFS_VLN1$RPM_VLN1 + ModelDFS_VLN1$BIO_VLN1 + ModelDFS_VLN1$HUM_VLN1

    #Create a column that add the monthly input of C (manure and litter separately)
    ModelDFSL_VLN1 <- merge(ModelDFS_VLN1, MCinputs_VLN1, by = "MNumber")

    ModelDFSL_VLN1$MInput_VLN1 <- ModelDFSL_VLN1$LitterC_VLN1 + ModelDFSL_VLN1$ManureC_VLN1
    #ModelDF_SL$MInput[1] <- 0

    #Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
    ModelDFSL_VLN1$CTails_VLN1 <- ModelDFSL_VLN1$AllPools_noIOM_VLN1 + ModelDFSL_VLN1$MInput_VLN1

    #Create Monthly Accumulated input of C
    ModelDFSL_VLN1$AccumInput_VLN1 = ModelDFSL_VLN1$AccumInput_VLN1=cumsum(ModelDFSL_VLN1$MInput_VLN1)

    #Create Monthly Growths for each carbon pool
    ModelDFSL_VLN1$MGrowth_DPM_VLN1 <- ave(ModelDFSL_VLN1$DPM_VLN1, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLN1$MGrowth_RPM_VLN1 <- ave(ModelDFSL_VLN1$RPM_VLN1, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLN1$MGrowth_BIO_VLN1 <- ave(ModelDFSL_VLN1$BIO_VLN1, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLN1$MGrowth_HUM_VLN1 <- ave(ModelDFSL_VLN1$HUM_VLN1, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLN1$MGrowth_IOM_VLN1 <- ave(ModelDFSL_VLN1$IOM_VLN1, FUN = function(x) c(0, diff(x)))

    #Create column for Monthly and Accumulated C-CO2 emissions
    ModelDFSL_VLN1$M_CCO2_VLN1 <- ModelDFSL_VLN1$MInput_VLN1 - ModelDFSL_VLN1$MGrowth_DPM_VLN1 - ModelDFSL_VLN1$MGrowth_RPM_VLN1 - ModelDFSL_VLN1$MGrowth_BIO_VLN1 - ModelDFSL_VLN1$MGrowth_HUM_VLN1
    ModelDFSL_VLN1$Accum_CCO2_VLN1 <- ModelDFSL_VLN1$AccumInput_VLN1 - ModelDFSL_VLN1$AllPools_noIOM_VLN1

    #Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
    ModelDFSL_VLN1$M_CCO2_VLN1[1] <- 0
    ModelDFSL_VLN1$Accum_CCO2_VLN1[1] <- 0

    #Balance validation
    ModelDFSL_VLN1$Balance_VLN1 <- ModelDFSL_VLN1$AccumInput_VLN1 - ModelDFSL_VLN1$Accum_CCO2_VLN1 - (ModelDFSL_VLN1$DPM_VLN1 + ModelDFSL_VLN1$RPM_VLN1 + ModelDFSL_VLN1$BIO_VLN1 + ModelDFSL_VLN1$HUM_VLN1)

    #Convert C-CO2 emissions into CO2 emissions
    ModelDFSL_VLN1$M_CO2_VLN1 <- ModelDFSL_VLN1$M_CCO2_VLN1 * 44/12
    ModelDFSL_VLN1$Accum_CO2_VLN1 <- ModelDFSL_VLN1$Accum_CCO2_VLN1 * 44/12

    #This model will be called VLN1C because implies a continuous input of C
    ModelDFSL_VLN1C <- ModelDFSL_VLN1

    #Export the dataframe
    write_xlsx(ModelDFSL_VLN1C,"VXC_Models\\ModelDFSL_R_VLN1C.xlsx")

    #Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
    #Create two equal models by using the above general script
    #Create model t=x
    ModelDFSLt0_VLN1 <- ModelDFSL_VLN1 #Create model t=x

    #Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
    ModelDFSLt1_VLN1.1 <- rbind(c(0:0), ModelDFSLt0_VLN1)
    ModelDFSLt1_VLN1.2 <- rbind(c(0:0), ModelDFSLt1_VLN1.1)
    ModelDFSLt1_VLN1.3 <- rbind(c(0:0), ModelDFSLt1_VLN1.2)
    ModelDFSLt1_VLN1.4 <- rbind(c(0:0), ModelDFSLt1_VLN1.3)
    ModelDFSLt1_VLN1.5 <- rbind(c(0:0), ModelDFSLt1_VLN1.4)
    ModelDFSLt1_VLN1.6 <- rbind(c(0:0), ModelDFSLt1_VLN1.5)
    ModelDFSLt1_VLN1.7 <- rbind(c(0:0), ModelDFSLt1_VLN1.6)
    ModelDFSLt1_VLN1.8 <- rbind(c(0:0), ModelDFSLt1_VLN1.7)
    ModelDFSLt1_VLN1.9 <- rbind(c(0:0), ModelDFSLt1_VLN1.8)
    ModelDFSLt1_VLN1.10 <- rbind(c(0:0), ModelDFSLt1_VLN1.9)
    ModelDFSLt1_VLN1.11 <- rbind(c(0:0), ModelDFSLt1_VLN1.10)
    ModelDFSLt1_VLN1.12 <- rbind(c(0:0), ModelDFSLt1_VLN1.11)
    ModelDFSLt1_VLN1.13 <- ModelDFSLt1_VLN1.12[-nrow(ModelDFSLt1_VLN1.12),]
    ModelDFSLt1_VLN1.14 <- ModelDFSLt1_VLN1.13[-nrow(ModelDFSLt1_VLN1.13),]
    ModelDFSLt1_VLN1.15 <- ModelDFSLt1_VLN1.14[-nrow(ModelDFSLt1_VLN1.14),]
    ModelDFSLt1_VLN1.16 <- ModelDFSLt1_VLN1.15[-nrow(ModelDFSLt1_VLN1.15),]
    ModelDFSLt1_VLN1.17 <- ModelDFSLt1_VLN1.16[-nrow(ModelDFSLt1_VLN1.16),]
    ModelDFSLt1_VLN1.18 <- ModelDFSLt1_VLN1.17[-nrow(ModelDFSLt1_VLN1.17),]
    ModelDFSLt1_VLN1.19 <- ModelDFSLt1_VLN1.18[-nrow(ModelDFSLt1_VLN1.18),]
    ModelDFSLt1_VLN1.20 <- ModelDFSLt1_VLN1.19[-nrow(ModelDFSLt1_VLN1.19),]
    ModelDFSLt1_VLN1.21 <- ModelDFSLt1_VLN1.20[-nrow(ModelDFSLt1_VLN1.20),]
    ModelDFSLt1_VLN1.22 <- ModelDFSLt1_VLN1.21[-nrow(ModelDFSLt1_VLN1.21),]
    ModelDFSLt1_VLN1.23 <- ModelDFSLt1_VLN1.22[-nrow(ModelDFSLt1_VLN1.22),]
    ModelDFSLt1_VLN1.24 <- ModelDFSLt1_VLN1.23[-nrow(ModelDFSLt1_VLN1.23),]

    ModelDFSLt1_VLN1 <- ModelDFSLt1_VLN1.24 #Create model t=x+1

    #Subtract model (t=x) - (t=x+1)
    ModelDFSL1y_VLN1 <- ModelDFSLt0_VLN1 - ModelDFSLt1_VLN1

    #Re-do Month Number column because the substraction was also applied to it
    ModelDFSL1y_VLN1$MNumber <- seq(from = 1, to = SimulationLength_months)

    #This model will be called VLN1P because implies a one-off input of C
    ModelDFSL_VLN1P <- ModelDFSL1y_VLN1

    #Export the dataframe
    write_xlsx(ModelDFSL_VLN1P,"VXP_Models\\ModelDFSL_R_VLN1P.xlsx")

    #Plot 3: Interactive Yearly CO2 emissions #
    MY <- 12
    ModelDFSL_VLN1P_YCO2 <- ModelDFSL_VLN1P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VLN1)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLN1P_YCO2) <- c("Year", "Months", "AnnualCO2_VLN_1")

    #Plot 3: Interactive Yearly CO2 emissions considering a delay
    GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
    ModelDFSL_VLN1P_YCO2D <- merge(ModelDFSL_VLN1P_YCO2, GWP100delay, by = "Year")
    ModelDFSL_VLN1P_YCO2D$AnnualCO2D_VLN_1 <- ModelDFSL_VLN1P_YCO2D$AnnualCO2_VLN_1 * ModelDFSL_VLN1P_YCO2D$GWP100

    #Plot 4: Interactive Yearly C emissions #
    MY <- 12
    ModelDFSL_VLN1P_YC <- ModelDFSL_VLN1P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VLN1)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLN1P_YC) <- c("Year", "Months", "CEmissions_VLN_1")

    #Plot 5: Interactive Yearly C tails (remaining C in Soil) #
    MY <- 12
    ModelDFSL_VLN1P_YCT <- ModelDFSL_VLN1P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VLN1)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLN1P_YCT) <- c("Year", "Months", "CTail_VLN_1")

    #Save Dataframes for Plots 3.1, 3.2, 4 and 5
    write_xlsx(ModelDFSL_VLN1P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VLN1P.xlsx") #Yearly CO2 emissions (no delay)
    write_xlsx(ModelDFSL_VLN1P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VLN1P.xlsx") #Yearly CO2 emissions (delay)
    write_xlsx(ModelDFSL_VLN1P_YC,"CEmissions_P\\ModelDFSL_R_CE_VLN1P.xlsx") #Yearly C emissions
    write_xlsx(ModelDFSL_VLN1P_YCT,"CTails_P\\ModelDFSL_R_CT_VLN1P.xlsx") #Yearly C emissions



    #### 9.3 - VLN2) Litter; 20%clay; No Tillage ####
    #The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
    fT_VLN2=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
    fW_VLN2=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                            S.Thick = soil.thick, pClay = clay100*0.2,
                            pE = 1.0, bare = FALSE)$b #Moisture effects per month
    xi.frame_VLN2=data.frame(years,rep(fT_VLN2*fW_VLN2,length.out=length(years)))

    #To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
    Model_VLN2=SoilR::RothCModel(
      t=years, #Simulation Length
      ks=c(k.DPM = 10*NTRM, k.RPM = 0.3*NTRM, k.BIO = 0.66*NTRM, k.HUM = 0.02*NTRM, k.IOM = 0*NTRM), #Decomposition rates for the different pools
      C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
      In=Scalar_LitterCinputs*1, #Amount of litter inputs by time
      FYM = Scalar_ManureCinputs*0, #Amount of Farm Yard Manure by time
      clay=clay100*0.2, #Percent clay in mineral soil
      xi=xi.frame_VLN2) #Loads the model

    Ct_VLN2=getC(Model_VLN2) #Calculates stocks for each pool per month

    #The results can be plotted with the commands
    matplot(years, Ct_VLN2, type="l", lty=1, col=1:5,
            xlab="Time (years)", ylab="C stocks (Mg/ha)")
    legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
           lty=1, col=1:5, bty="n")

    VEC_Lit_VLN2 <- rep(M_Scalar_LitterCinputs*1, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
    VEC_Man_VLN2 <- rep(M_Scalar_ManureCinputs*0, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

    VEC_LitDF_VLN2 <- as.data.frame(VEC_Lit_VLN2) #Converting the Litter vector to a data frame
    VEC_LitDF_VLN2$MNumber <- seq(from = 1, to = SimulationLength_months)
    VEC_ManDF_VLN2 <- as.data.frame(VEC_Man_VLN2) #Converting the Manure vector to a data frame
    VEC_ManDF_VLN2$MNumber <- seq(from = 1, to = SimulationLength_months)

    sapply(VEC_LitDF_VLN2, class) #Check that class is numeric
    sapply(VEC_ManDF_VLN2, class) #Check that class is numeric
    LitterCinputs_VLN2=VEC_LitDF_VLN2   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    ManureCinputs_VLN2=VEC_ManDF_VLN2 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    MCinputs_VLN2 <- merge(LitterCinputs_VLN2, ManureCinputs_VLN2, by = "MNumber")
    MCinputs_VLN2$MInput_VLN2 <- MCinputs_VLN2$VEC_Lit_VLN2 + MCinputs_VLN2$VEC_Man_VLN2

    #Change names of litter and manure columns for more common ones
    colnames(MCinputs_VLN2)[which(names(MCinputs_VLN2) == "VEC_Lit_VLN2")] <- "LitterC_VLN2"
    colnames(MCinputs_VLN2)[which(names(MCinputs_VLN2) == "VEC_Man_VLN2")] <- "ManureC_VLN2"

    #Create a dataframe with the data considering the simulation length
    ModelDF_VLN2 <- as.data.frame(Ct_VLN2)
    colnames(ModelDF_VLN2) <- c('DPM_VLN2','RPM_VLN2','BIO_VLN2', 'HUM_VLN2', 'IOM_VLN2')
    ModelDFS_VLN2 <- ModelDF_VLN2[1:SimulationLength_months, ]

    #Create a column with the number of month of analysis
    ModelDFS_VLN2$MNumber <- seq(from = 1, to = SimulationLength_months)

    #Create a column that sums all pools
    ModelDFS_VLN2$AllPools_VLN2 <- ModelDFS_VLN2$DPM_VLN2 + ModelDFS_VLN2$RPM_VLN2 + ModelDFS_VLN2$BIO_VLN2 + ModelDFS_VLN2$HUM_VLN2 + ModelDFS_VLN2$IOM_VLN2

    #Create a column that sums all pools except IOM (static)
    ModelDFS_VLN2$AllPools_noIOM_VLN2 <- ModelDFS_VLN2$DPM_VLN2 + ModelDFS_VLN2$RPM_VLN2 + ModelDFS_VLN2$BIO_VLN2 + ModelDFS_VLN2$HUM_VLN2

    #Create a column that add the monthly input of C (manure and litter separately)
    ModelDFSL_VLN2 <- merge(ModelDFS_VLN2, MCinputs_VLN2, by = "MNumber")

    ModelDFSL_VLN2$MInput_VLN2 <- ModelDFSL_VLN2$LitterC_VLN2 + ModelDFSL_VLN2$ManureC_VLN2
    #ModelDF_SL$MInput[1] <- 0

    #Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
    ModelDFSL_VLN2$CTails_VLN2 <- ModelDFSL_VLN2$AllPools_noIOM_VLN2 + ModelDFSL_VLN2$MInput_VLN2

    #Create Monthly Accumulated input of C
    ModelDFSL_VLN2$AccumInput_VLN2 = ModelDFSL_VLN2$AccumInput_VLN2=cumsum(ModelDFSL_VLN2$MInput_VLN2)

    #Create Monthly Growths for each carbon pool
    ModelDFSL_VLN2$MGrowth_DPM_VLN2 <- ave(ModelDFSL_VLN2$DPM_VLN2, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLN2$MGrowth_RPM_VLN2 <- ave(ModelDFSL_VLN2$RPM_VLN2, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLN2$MGrowth_BIO_VLN2 <- ave(ModelDFSL_VLN2$BIO_VLN2, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLN2$MGrowth_HUM_VLN2 <- ave(ModelDFSL_VLN2$HUM_VLN2, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLN2$MGrowth_IOM_VLN2 <- ave(ModelDFSL_VLN2$IOM_VLN2, FUN = function(x) c(0, diff(x)))

    #Create column for Monthly and Accumulated C-CO2 emissions
    ModelDFSL_VLN2$M_CCO2_VLN2 <- ModelDFSL_VLN2$MInput_VLN2 - ModelDFSL_VLN2$MGrowth_DPM_VLN2 - ModelDFSL_VLN2$MGrowth_RPM_VLN2 - ModelDFSL_VLN2$MGrowth_BIO_VLN2 - ModelDFSL_VLN2$MGrowth_HUM_VLN2
    ModelDFSL_VLN2$Accum_CCO2_VLN2 <- ModelDFSL_VLN2$AccumInput_VLN2 - ModelDFSL_VLN2$AllPools_noIOM_VLN2

    #Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
    ModelDFSL_VLN2$M_CCO2_VLN2[1] <- 0
    ModelDFSL_VLN2$Accum_CCO2_VLN2[1] <- 0

    #Balance validation
    ModelDFSL_VLN2$Balance_VLN2 <- ModelDFSL_VLN2$AccumInput_VLN2 - ModelDFSL_VLN2$Accum_CCO2_VLN2 - (ModelDFSL_VLN2$DPM_VLN2 + ModelDFSL_VLN2$RPM_VLN2 + ModelDFSL_VLN2$BIO_VLN2 + ModelDFSL_VLN2$HUM_VLN2)

    #Convert C-CO2 emissions into CO2 emissions
    ModelDFSL_VLN2$M_CO2_VLN2 <- ModelDFSL_VLN2$M_CCO2_VLN2 * 44/12
    ModelDFSL_VLN2$Accum_CO2_VLN2 <- ModelDFSL_VLN2$Accum_CCO2_VLN2 * 44/12

    #This model will be called VLN2C because implies a continuous input of C
    ModelDFSL_VLN2C <- ModelDFSL_VLN2

    #Export the dataframe
    write_xlsx(ModelDFSL_VLN2C,"VXC_Models\\ModelDFSL_R_VLN2C.xlsx")

    #Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
    #Create two equal models by using the above general script
    #Create model t=x
    ModelDFSLt0_VLN2 <- ModelDFSL_VLN2 #Create model t=x

    #Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
    ModelDFSLt1_VLN2.1 <- rbind(c(0:0), ModelDFSLt0_VLN2)
    ModelDFSLt1_VLN2.2 <- rbind(c(0:0), ModelDFSLt1_VLN2.1)
    ModelDFSLt1_VLN2.3 <- rbind(c(0:0), ModelDFSLt1_VLN2.2)
    ModelDFSLt1_VLN2.4 <- rbind(c(0:0), ModelDFSLt1_VLN2.3)
    ModelDFSLt1_VLN2.5 <- rbind(c(0:0), ModelDFSLt1_VLN2.4)
    ModelDFSLt1_VLN2.6 <- rbind(c(0:0), ModelDFSLt1_VLN2.5)
    ModelDFSLt1_VLN2.7 <- rbind(c(0:0), ModelDFSLt1_VLN2.6)
    ModelDFSLt1_VLN2.8 <- rbind(c(0:0), ModelDFSLt1_VLN2.7)
    ModelDFSLt1_VLN2.9 <- rbind(c(0:0), ModelDFSLt1_VLN2.8)
    ModelDFSLt1_VLN2.10 <- rbind(c(0:0), ModelDFSLt1_VLN2.9)
    ModelDFSLt1_VLN2.11 <- rbind(c(0:0), ModelDFSLt1_VLN2.10)
    ModelDFSLt1_VLN2.12 <- rbind(c(0:0), ModelDFSLt1_VLN2.11)
    ModelDFSLt1_VLN2.13 <- ModelDFSLt1_VLN2.12[-nrow(ModelDFSLt1_VLN2.12),]
    ModelDFSLt1_VLN2.14 <- ModelDFSLt1_VLN2.13[-nrow(ModelDFSLt1_VLN2.13),]
    ModelDFSLt1_VLN2.15 <- ModelDFSLt1_VLN2.14[-nrow(ModelDFSLt1_VLN2.14),]
    ModelDFSLt1_VLN2.16 <- ModelDFSLt1_VLN2.15[-nrow(ModelDFSLt1_VLN2.15),]
    ModelDFSLt1_VLN2.17 <- ModelDFSLt1_VLN2.16[-nrow(ModelDFSLt1_VLN2.16),]
    ModelDFSLt1_VLN2.18 <- ModelDFSLt1_VLN2.17[-nrow(ModelDFSLt1_VLN2.17),]
    ModelDFSLt1_VLN2.19 <- ModelDFSLt1_VLN2.18[-nrow(ModelDFSLt1_VLN2.18),]
    ModelDFSLt1_VLN2.20 <- ModelDFSLt1_VLN2.19[-nrow(ModelDFSLt1_VLN2.19),]
    ModelDFSLt1_VLN2.21 <- ModelDFSLt1_VLN2.20[-nrow(ModelDFSLt1_VLN2.20),]
    ModelDFSLt1_VLN2.22 <- ModelDFSLt1_VLN2.21[-nrow(ModelDFSLt1_VLN2.21),]
    ModelDFSLt1_VLN2.23 <- ModelDFSLt1_VLN2.22[-nrow(ModelDFSLt1_VLN2.22),]
    ModelDFSLt1_VLN2.24 <- ModelDFSLt1_VLN2.23[-nrow(ModelDFSLt1_VLN2.23),]

    ModelDFSLt1_VLN2 <- ModelDFSLt1_VLN2.24 #Create model t=x+1

    #Subtract model (t=x) - (t=x+1)
    ModelDFSL1y_VLN2 <- ModelDFSLt0_VLN2 - ModelDFSLt1_VLN2

    #Re-do Month Number column because the substraction was also applied to it
    ModelDFSL1y_VLN2$MNumber <- seq(from = 1, to = SimulationLength_months)

    #This model will be called VLN2P because implies a one-off input of C
    ModelDFSL_VLN2P <- ModelDFSL1y_VLN2

    #Export the dataframe
    write_xlsx(ModelDFSL_VLN2P,"VXP_Models\\ModelDFSL_R_VLN2P.xlsx")

    #Plot 3: Interactive Yearly CO2 emissions #
    MY <- 12
    ModelDFSL_VLN2P_YCO2 <- ModelDFSL_VLN2P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VLN2)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLN2P_YCO2) <- c("Year", "Months", "AnnualCO2_VLN_2")

    #Plot 3: Interactive Yearly CO2 emissions considering a delay
    GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
    ModelDFSL_VLN2P_YCO2D <- merge(ModelDFSL_VLN2P_YCO2, GWP100delay, by = "Year")
    ModelDFSL_VLN2P_YCO2D$AnnualCO2D_VLN_2 <- ModelDFSL_VLN2P_YCO2D$AnnualCO2_VLN_2 * ModelDFSL_VLN2P_YCO2D$GWP100

    #Plot 4: Interactive Yearly C emissions #
    MY <- 12
    ModelDFSL_VLN2P_YC <- ModelDFSL_VLN2P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VLN2)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLN2P_YC) <- c("Year", "Months", "CEmissions_VLN_2")

    #Plot 5: Interactive Yearly C tails (remaining C in Soil) #
    MY <- 12
    ModelDFSL_VLN2P_YCT <- ModelDFSL_VLN2P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VLN2)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLN2P_YCT) <- c("Year", "Months", "CTail_VLN_2")

    #Save Dataframes for Plots 3.1, 3.2, 4 and 5
    write_xlsx(ModelDFSL_VLN2P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VLN2P.xlsx") #Yearly CO2 emissions (no delay)
    write_xlsx(ModelDFSL_VLN2P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VLN2P.xlsx") #Yearly CO2 emissions (delay)
    write_xlsx(ModelDFSL_VLN2P_YC,"CEmissions_P\\ModelDFSL_R_CE_VLN2P.xlsx") #Yearly C emissions
    write_xlsx(ModelDFSL_VLN2P_YCT,"CTails_P\\ModelDFSL_R_CT_VLN2P.xlsx") #Yearly C emissions



    #### 9.4 - VLN3) Litter; 30%clay; No Tillage ####
    #The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
    fT_VLN3=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
    fW_VLN3=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                            S.Thick = soil.thick, pClay = clay100*0.3,
                            pE = 1.0, bare = FALSE)$b #Moisture effects per month
    xi.frame_VLN3=data.frame(years,rep(fT_VLN3*fW_VLN3,length.out=length(years)))

    #To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
    Model_VLN3=SoilR::RothCModel(
      t=years, #Simulation Length
      ks=c(k.DPM = 10*NTRM, k.RPM = 0.3*NTRM, k.BIO = 0.66*NTRM, k.HUM = 0.02*NTRM, k.IOM = 0*NTRM), #Decomposition rates for the different pools
      C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
      In=Scalar_LitterCinputs*1, #Amount of litter inputs by time
      FYM = Scalar_ManureCinputs*0, #Amount of Farm Yard Manure by time
      clay=clay100*0.3, #Percent clay in mineral soil
      xi=xi.frame_VLN3) #Loads the model

    Ct_VLN3=getC(Model_VLN3) #Calculates stocks for each pool per month

    #The results can be plotted with the commands
    matplot(years, Ct_VLN3, type="l", lty=1, col=1:5,
            xlab="Time (years)", ylab="C stocks (Mg/ha)")
    legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
           lty=1, col=1:5, bty="n")

    VEC_Lit_VLN3 <- rep(M_Scalar_LitterCinputs*1, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
    VEC_Man_VLN3 <- rep(M_Scalar_ManureCinputs*0, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

    VEC_LitDF_VLN3 <- as.data.frame(VEC_Lit_VLN3) #Converting the Litter vector to a data frame
    VEC_LitDF_VLN3$MNumber <- seq(from = 1, to = SimulationLength_months)
    VEC_ManDF_VLN3 <- as.data.frame(VEC_Man_VLN3) #Converting the Manure vector to a data frame
    VEC_ManDF_VLN3$MNumber <- seq(from = 1, to = SimulationLength_months)

    sapply(VEC_LitDF_VLN3, class) #Check that class is numeric
    sapply(VEC_ManDF_VLN3, class) #Check that class is numeric
    LitterCinputs_VLN3=VEC_LitDF_VLN3   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    ManureCinputs_VLN3=VEC_ManDF_VLN3 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    MCinputs_VLN3 <- merge(LitterCinputs_VLN3, ManureCinputs_VLN3, by = "MNumber")
    MCinputs_VLN3$MInput_VLN3 <- MCinputs_VLN3$VEC_Lit_VLN3 + MCinputs_VLN3$VEC_Man_VLN3

    #Change names of litter and manure columns for more common ones
    colnames(MCinputs_VLN3)[which(names(MCinputs_VLN3) == "VEC_Lit_VLN3")] <- "LitterC_VLN3"
    colnames(MCinputs_VLN3)[which(names(MCinputs_VLN3) == "VEC_Man_VLN3")] <- "ManureC_VLN3"

    #Create a dataframe with the data considering the simulation length
    ModelDF_VLN3 <- as.data.frame(Ct_VLN3)
    colnames(ModelDF_VLN3) <- c('DPM_VLN3','RPM_VLN3','BIO_VLN3', 'HUM_VLN3', 'IOM_VLN3')
    ModelDFS_VLN3 <- ModelDF_VLN3[1:SimulationLength_months, ]

    #Create a column with the number of month of analysis
    ModelDFS_VLN3$MNumber <- seq(from = 1, to = SimulationLength_months)

    #Create a column that sums all pools
    ModelDFS_VLN3$AllPools_VLN3 <- ModelDFS_VLN3$DPM_VLN3 + ModelDFS_VLN3$RPM_VLN3 + ModelDFS_VLN3$BIO_VLN3 + ModelDFS_VLN3$HUM_VLN3 + ModelDFS_VLN3$IOM_VLN3

    #Create a column that sums all pools except IOM (static)
    ModelDFS_VLN3$AllPools_noIOM_VLN3 <- ModelDFS_VLN3$DPM_VLN3 + ModelDFS_VLN3$RPM_VLN3 + ModelDFS_VLN3$BIO_VLN3 + ModelDFS_VLN3$HUM_VLN3

    #Create a column that add the monthly input of C (manure and litter separately)
    ModelDFSL_VLN3 <- merge(ModelDFS_VLN3, MCinputs_VLN3, by = "MNumber")

    ModelDFSL_VLN3$MInput_VLN3 <- ModelDFSL_VLN3$LitterC_VLN3 + ModelDFSL_VLN3$ManureC_VLN3
    #ModelDF_SL$MInput[1] <- 0

    #Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
    ModelDFSL_VLN3$CTails_VLN3 <- ModelDFSL_VLN3$AllPools_noIOM_VLN3 + ModelDFSL_VLN3$MInput_VLN3

    #Create Monthly Accumulated input of C
    ModelDFSL_VLN3$AccumInput_VLN3 = ModelDFSL_VLN3$AccumInput_VLN3=cumsum(ModelDFSL_VLN3$MInput_VLN3)

    #Create Monthly Growths for each carbon pool
    ModelDFSL_VLN3$MGrowth_DPM_VLN3 <- ave(ModelDFSL_VLN3$DPM_VLN3, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLN3$MGrowth_RPM_VLN3 <- ave(ModelDFSL_VLN3$RPM_VLN3, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLN3$MGrowth_BIO_VLN3 <- ave(ModelDFSL_VLN3$BIO_VLN3, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLN3$MGrowth_HUM_VLN3 <- ave(ModelDFSL_VLN3$HUM_VLN3, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLN3$MGrowth_IOM_VLN3 <- ave(ModelDFSL_VLN3$IOM_VLN3, FUN = function(x) c(0, diff(x)))

    #Create column for Monthly and Accumulated C-CO2 emissions
    ModelDFSL_VLN3$M_CCO2_VLN3 <- ModelDFSL_VLN3$MInput_VLN3 - ModelDFSL_VLN3$MGrowth_DPM_VLN3 - ModelDFSL_VLN3$MGrowth_RPM_VLN3 - ModelDFSL_VLN3$MGrowth_BIO_VLN3 - ModelDFSL_VLN3$MGrowth_HUM_VLN3
    ModelDFSL_VLN3$Accum_CCO2_VLN3 <- ModelDFSL_VLN3$AccumInput_VLN3 - ModelDFSL_VLN3$AllPools_noIOM_VLN3

    #Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
    ModelDFSL_VLN3$M_CCO2_VLN3[1] <- 0
    ModelDFSL_VLN3$Accum_CCO2_VLN3[1] <- 0

    #Balance validation
    ModelDFSL_VLN3$Balance_VLN3 <- ModelDFSL_VLN3$AccumInput_VLN3 - ModelDFSL_VLN3$Accum_CCO2_VLN3 - (ModelDFSL_VLN3$DPM_VLN3 + ModelDFSL_VLN3$RPM_VLN3 + ModelDFSL_VLN3$BIO_VLN3 + ModelDFSL_VLN3$HUM_VLN3)

    #Convert C-CO2 emissions into CO2 emissions
    ModelDFSL_VLN3$M_CO2_VLN3 <- ModelDFSL_VLN3$M_CCO2_VLN3 * 44/12
    ModelDFSL_VLN3$Accum_CO2_VLN3 <- ModelDFSL_VLN3$Accum_CCO2_VLN3 * 44/12

    #This model will be called VLN3C because implies a continuous input of C
    ModelDFSL_VLN3C <- ModelDFSL_VLN3

    #Export the dataframe
    write_xlsx(ModelDFSL_VLN3C,"VXC_Models\\ModelDFSL_R_VLN3C.xlsx")

    #Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
    #Create two equal models by using the above general script
    #Create model t=x
    ModelDFSLt0_VLN3 <- ModelDFSL_VLN3 #Create model t=x

    #Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
    ModelDFSLt1_VLN3.1 <- rbind(c(0:0), ModelDFSLt0_VLN3)
    ModelDFSLt1_VLN3.2 <- rbind(c(0:0), ModelDFSLt1_VLN3.1)
    ModelDFSLt1_VLN3.3 <- rbind(c(0:0), ModelDFSLt1_VLN3.2)
    ModelDFSLt1_VLN3.4 <- rbind(c(0:0), ModelDFSLt1_VLN3.3)
    ModelDFSLt1_VLN3.5 <- rbind(c(0:0), ModelDFSLt1_VLN3.4)
    ModelDFSLt1_VLN3.6 <- rbind(c(0:0), ModelDFSLt1_VLN3.5)
    ModelDFSLt1_VLN3.7 <- rbind(c(0:0), ModelDFSLt1_VLN3.6)
    ModelDFSLt1_VLN3.8 <- rbind(c(0:0), ModelDFSLt1_VLN3.7)
    ModelDFSLt1_VLN3.9 <- rbind(c(0:0), ModelDFSLt1_VLN3.8)
    ModelDFSLt1_VLN3.10 <- rbind(c(0:0), ModelDFSLt1_VLN3.9)
    ModelDFSLt1_VLN3.11 <- rbind(c(0:0), ModelDFSLt1_VLN3.10)
    ModelDFSLt1_VLN3.12 <- rbind(c(0:0), ModelDFSLt1_VLN3.11)
    ModelDFSLt1_VLN3.13 <- ModelDFSLt1_VLN3.12[-nrow(ModelDFSLt1_VLN3.12),]
    ModelDFSLt1_VLN3.14 <- ModelDFSLt1_VLN3.13[-nrow(ModelDFSLt1_VLN3.13),]
    ModelDFSLt1_VLN3.15 <- ModelDFSLt1_VLN3.14[-nrow(ModelDFSLt1_VLN3.14),]
    ModelDFSLt1_VLN3.16 <- ModelDFSLt1_VLN3.15[-nrow(ModelDFSLt1_VLN3.15),]
    ModelDFSLt1_VLN3.17 <- ModelDFSLt1_VLN3.16[-nrow(ModelDFSLt1_VLN3.16),]
    ModelDFSLt1_VLN3.18 <- ModelDFSLt1_VLN3.17[-nrow(ModelDFSLt1_VLN3.17),]
    ModelDFSLt1_VLN3.19 <- ModelDFSLt1_VLN3.18[-nrow(ModelDFSLt1_VLN3.18),]
    ModelDFSLt1_VLN3.20 <- ModelDFSLt1_VLN3.19[-nrow(ModelDFSLt1_VLN3.19),]
    ModelDFSLt1_VLN3.21 <- ModelDFSLt1_VLN3.20[-nrow(ModelDFSLt1_VLN3.20),]
    ModelDFSLt1_VLN3.22 <- ModelDFSLt1_VLN3.21[-nrow(ModelDFSLt1_VLN3.21),]
    ModelDFSLt1_VLN3.23 <- ModelDFSLt1_VLN3.22[-nrow(ModelDFSLt1_VLN3.22),]
    ModelDFSLt1_VLN3.24 <- ModelDFSLt1_VLN3.23[-nrow(ModelDFSLt1_VLN3.23),]

    ModelDFSLt1_VLN3 <- ModelDFSLt1_VLN3.24 #Create model t=x+1

    #Subtract model (t=x) - (t=x+1)
    ModelDFSL1y_VLN3 <- ModelDFSLt0_VLN3 - ModelDFSLt1_VLN3

    #Re-do Month Number column because the substraction was also applied to it
    ModelDFSL1y_VLN3$MNumber <- seq(from = 1, to = SimulationLength_months)

    #This model will be called VLN3P because implies a one-off input of C
    ModelDFSL_VLN3P <- ModelDFSL1y_VLN3

    #Export the dataframe
    write_xlsx(ModelDFSL_VLN3P,"VXP_Models\\ModelDFSL_R_VLN3P.xlsx")

    #Plot 3: Interactive Yearly CO2 emissions #
    MY <- 12
    ModelDFSL_VLN3P_YCO2 <- ModelDFSL_VLN3P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VLN3)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLN3P_YCO2) <- c("Year", "Months", "AnnualCO2_VLN_3")

    #Plot 3: Interactive Yearly CO2 emissions considering a delay
    GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
    ModelDFSL_VLN3P_YCO2D <- merge(ModelDFSL_VLN3P_YCO2, GWP100delay, by = "Year")
    ModelDFSL_VLN3P_YCO2D$AnnualCO2D_VLN_3 <- ModelDFSL_VLN3P_YCO2D$AnnualCO2_VLN_3 * ModelDFSL_VLN3P_YCO2D$GWP100

    #Plot 4: Interactive Yearly C emissions #
    MY <- 12
    ModelDFSL_VLN3P_YC <- ModelDFSL_VLN3P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VLN3)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLN3P_YC) <- c("Year", "Months", "CEmissions_VLN_3")

    #Plot 5: Interactive Yearly C tails (remaining C in Soil) #
    MY <- 12
    ModelDFSL_VLN3P_YCT <- ModelDFSL_VLN3P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VLN3)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLN3P_YCT) <- c("Year", "Months", "CTail_VLN_3")

    #Save Dataframes for Plots 3.1, 3.2, 4 and 5
    write_xlsx(ModelDFSL_VLN3P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VLN3P.xlsx") #Yearly CO2 emissions (no delay)
    write_xlsx(ModelDFSL_VLN3P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VLN3P.xlsx") #Yearly CO2 emissions (delay)
    write_xlsx(ModelDFSL_VLN3P_YC,"CEmissions_P\\ModelDFSL_R_CE_VLN3P.xlsx") #Yearly C emissions
    write_xlsx(ModelDFSL_VLN3P_YCT,"CTails_P\\ModelDFSL_R_CT_VLN3P.xlsx") #Yearly C emissions



    #### 9.5 - VLN4) Litter; 40%clay; No Tillage ####
    #The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
    fT_VLN4=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
    fW_VLN4=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                            S.Thick = soil.thick, pClay = clay100*0.4,
                            pE = 1.0, bare = FALSE)$b #Moisture effects per month
    xi.frame_VLN4=data.frame(years,rep(fT_VLN4*fW_VLN4,length.out=length(years)))

    #To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
    Model_VLN4=SoilR::RothCModel(
      t=years, #Simulation Length
      ks=c(k.DPM = 10*NTRM, k.RPM = 0.3*NTRM, k.BIO = 0.66*NTRM, k.HUM = 0.02*NTRM, k.IOM = 0*NTRM), #Decomposition rates for the different pools
      C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
      In=Scalar_LitterCinputs*1, #Amount of litter inputs by time
      FYM = Scalar_ManureCinputs*0, #Amount of Farm Yard Manure by time
      clay=clay100*0.4, #Percent clay in mineral soil
      xi=xi.frame_VLN4) #Loads the model

    Ct_VLN4=getC(Model_VLN4) #Calculates stocks for each pool per month

    #The results can be plotted with the commands
    matplot(years, Ct_VLN4, type="l", lty=1, col=1:5,
            xlab="Time (years)", ylab="C stocks (Mg/ha)")
    legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
           lty=1, col=1:5, bty="n")

    VEC_Lit_VLN4 <- rep(M_Scalar_LitterCinputs*1, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
    VEC_Man_VLN4 <- rep(M_Scalar_ManureCinputs*0, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

    VEC_LitDF_VLN4 <- as.data.frame(VEC_Lit_VLN4) #Converting the Litter vector to a data frame
    VEC_LitDF_VLN4$MNumber <- seq(from = 1, to = SimulationLength_months)
    VEC_ManDF_VLN4 <- as.data.frame(VEC_Man_VLN4) #Converting the Manure vector to a data frame
    VEC_ManDF_VLN4$MNumber <- seq(from = 1, to = SimulationLength_months)

    sapply(VEC_LitDF_VLN4, class) #Check that class is numeric
    sapply(VEC_ManDF_VLN4, class) #Check that class is numeric
    LitterCinputs_VLN4=VEC_LitDF_VLN4   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    ManureCinputs_VLN4=VEC_ManDF_VLN4 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    MCinputs_VLN4 <- merge(LitterCinputs_VLN4, ManureCinputs_VLN4, by = "MNumber")
    MCinputs_VLN4$MInput_VLN4 <- MCinputs_VLN4$VEC_Lit_VLN4 + MCinputs_VLN4$VEC_Man_VLN4

    #Change names of litter and manure columns for more common ones
    colnames(MCinputs_VLN4)[which(names(MCinputs_VLN4) == "VEC_Lit_VLN4")] <- "LitterC_VLN4"
    colnames(MCinputs_VLN4)[which(names(MCinputs_VLN4) == "VEC_Man_VLN4")] <- "ManureC_VLN4"

    #Create a dataframe with the data considering the simulation length
    ModelDF_VLN4 <- as.data.frame(Ct_VLN4)
    colnames(ModelDF_VLN4) <- c('DPM_VLN4','RPM_VLN4','BIO_VLN4', 'HUM_VLN4', 'IOM_VLN4')
    ModelDFS_VLN4 <- ModelDF_VLN4[1:SimulationLength_months, ]

    #Create a column with the number of month of analysis
    ModelDFS_VLN4$MNumber <- seq(from = 1, to = SimulationLength_months)

    #Create a column that sums all pools
    ModelDFS_VLN4$AllPools_VLN4 <- ModelDFS_VLN4$DPM_VLN4 + ModelDFS_VLN4$RPM_VLN4 + ModelDFS_VLN4$BIO_VLN4 + ModelDFS_VLN4$HUM_VLN4 + ModelDFS_VLN4$IOM_VLN4

    #Create a column that sums all pools except IOM (static)
    ModelDFS_VLN4$AllPools_noIOM_VLN4 <- ModelDFS_VLN4$DPM_VLN4 + ModelDFS_VLN4$RPM_VLN4 + ModelDFS_VLN4$BIO_VLN4 + ModelDFS_VLN4$HUM_VLN4

    #Create a column that add the monthly input of C (manure and litter separately)
    ModelDFSL_VLN4 <- merge(ModelDFS_VLN4, MCinputs_VLN4, by = "MNumber")

    ModelDFSL_VLN4$MInput_VLN4 <- ModelDFSL_VLN4$LitterC_VLN4 + ModelDFSL_VLN4$ManureC_VLN4
    #ModelDF_SL$MInput[1] <- 0

    #Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
    ModelDFSL_VLN4$CTails_VLN4 <- ModelDFSL_VLN4$AllPools_noIOM_VLN4 + ModelDFSL_VLN4$MInput_VLN4

    #Create Monthly Accumulated input of C
    ModelDFSL_VLN4$AccumInput_VLN4 = ModelDFSL_VLN4$AccumInput_VLN4=cumsum(ModelDFSL_VLN4$MInput_VLN4)

    #Create Monthly Growths for each carbon pool
    ModelDFSL_VLN4$MGrowth_DPM_VLN4 <- ave(ModelDFSL_VLN4$DPM_VLN4, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLN4$MGrowth_RPM_VLN4 <- ave(ModelDFSL_VLN4$RPM_VLN4, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLN4$MGrowth_BIO_VLN4 <- ave(ModelDFSL_VLN4$BIO_VLN4, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLN4$MGrowth_HUM_VLN4 <- ave(ModelDFSL_VLN4$HUM_VLN4, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLN4$MGrowth_IOM_VLN4 <- ave(ModelDFSL_VLN4$IOM_VLN4, FUN = function(x) c(0, diff(x)))

    #Create column for Monthly and Accumulated C-CO2 emissions
    ModelDFSL_VLN4$M_CCO2_VLN4 <- ModelDFSL_VLN4$MInput_VLN4 - ModelDFSL_VLN4$MGrowth_DPM_VLN4 - ModelDFSL_VLN4$MGrowth_RPM_VLN4 - ModelDFSL_VLN4$MGrowth_BIO_VLN4 - ModelDFSL_VLN4$MGrowth_HUM_VLN4
    ModelDFSL_VLN4$Accum_CCO2_VLN4 <- ModelDFSL_VLN4$AccumInput_VLN4 - ModelDFSL_VLN4$AllPools_noIOM_VLN4

    #Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
    ModelDFSL_VLN4$M_CCO2_VLN4[1] <- 0
    ModelDFSL_VLN4$Accum_CCO2_VLN4[1] <- 0

    #Balance validation
    ModelDFSL_VLN4$Balance_VLN4 <- ModelDFSL_VLN4$AccumInput_VLN4 - ModelDFSL_VLN4$Accum_CCO2_VLN4 - (ModelDFSL_VLN4$DPM_VLN4 + ModelDFSL_VLN4$RPM_VLN4 + ModelDFSL_VLN4$BIO_VLN4 + ModelDFSL_VLN4$HUM_VLN4)

    #Convert C-CO2 emissions into CO2 emissions
    ModelDFSL_VLN4$M_CO2_VLN4 <- ModelDFSL_VLN4$M_CCO2_VLN4 * 44/12
    ModelDFSL_VLN4$Accum_CO2_VLN4 <- ModelDFSL_VLN4$Accum_CCO2_VLN4 * 44/12

    #This model will be called VLN4C because implies a continuous input of C
    ModelDFSL_VLN4C <- ModelDFSL_VLN4

    #Export the dataframe
    write_xlsx(ModelDFSL_VLN4C,"VXC_Models\\ModelDFSL_R_VLN4C.xlsx")

    #Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
    #Create two equal models by using the above general script
    #Create model t=x
    ModelDFSLt0_VLN4 <- ModelDFSL_VLN4 #Create model t=x

    #Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
    ModelDFSLt1_VLN4.1 <- rbind(c(0:0), ModelDFSLt0_VLN4)
    ModelDFSLt1_VLN4.2 <- rbind(c(0:0), ModelDFSLt1_VLN4.1)
    ModelDFSLt1_VLN4.3 <- rbind(c(0:0), ModelDFSLt1_VLN4.2)
    ModelDFSLt1_VLN4.4 <- rbind(c(0:0), ModelDFSLt1_VLN4.3)
    ModelDFSLt1_VLN4.5 <- rbind(c(0:0), ModelDFSLt1_VLN4.4)
    ModelDFSLt1_VLN4.6 <- rbind(c(0:0), ModelDFSLt1_VLN4.5)
    ModelDFSLt1_VLN4.7 <- rbind(c(0:0), ModelDFSLt1_VLN4.6)
    ModelDFSLt1_VLN4.8 <- rbind(c(0:0), ModelDFSLt1_VLN4.7)
    ModelDFSLt1_VLN4.9 <- rbind(c(0:0), ModelDFSLt1_VLN4.8)
    ModelDFSLt1_VLN4.10 <- rbind(c(0:0), ModelDFSLt1_VLN4.9)
    ModelDFSLt1_VLN4.11 <- rbind(c(0:0), ModelDFSLt1_VLN4.10)
    ModelDFSLt1_VLN4.12 <- rbind(c(0:0), ModelDFSLt1_VLN4.11)
    ModelDFSLt1_VLN4.13 <- ModelDFSLt1_VLN4.12[-nrow(ModelDFSLt1_VLN4.12),]
    ModelDFSLt1_VLN4.14 <- ModelDFSLt1_VLN4.13[-nrow(ModelDFSLt1_VLN4.13),]
    ModelDFSLt1_VLN4.15 <- ModelDFSLt1_VLN4.14[-nrow(ModelDFSLt1_VLN4.14),]
    ModelDFSLt1_VLN4.16 <- ModelDFSLt1_VLN4.15[-nrow(ModelDFSLt1_VLN4.15),]
    ModelDFSLt1_VLN4.17 <- ModelDFSLt1_VLN4.16[-nrow(ModelDFSLt1_VLN4.16),]
    ModelDFSLt1_VLN4.18 <- ModelDFSLt1_VLN4.17[-nrow(ModelDFSLt1_VLN4.17),]
    ModelDFSLt1_VLN4.19 <- ModelDFSLt1_VLN4.18[-nrow(ModelDFSLt1_VLN4.18),]
    ModelDFSLt1_VLN4.20 <- ModelDFSLt1_VLN4.19[-nrow(ModelDFSLt1_VLN4.19),]
    ModelDFSLt1_VLN4.21 <- ModelDFSLt1_VLN4.20[-nrow(ModelDFSLt1_VLN4.20),]
    ModelDFSLt1_VLN4.22 <- ModelDFSLt1_VLN4.21[-nrow(ModelDFSLt1_VLN4.21),]
    ModelDFSLt1_VLN4.23 <- ModelDFSLt1_VLN4.22[-nrow(ModelDFSLt1_VLN4.22),]
    ModelDFSLt1_VLN4.24 <- ModelDFSLt1_VLN4.23[-nrow(ModelDFSLt1_VLN4.23),]

    ModelDFSLt1_VLN4 <- ModelDFSLt1_VLN4.24 #Create model t=x+1

    #Subtract model (t=x) - (t=x+1)
    ModelDFSL1y_VLN4 <- ModelDFSLt0_VLN4 - ModelDFSLt1_VLN4

    #Re-do Month Number column because the substraction was also applied to it
    ModelDFSL1y_VLN4$MNumber <- seq(from = 1, to = SimulationLength_months)

    #This model will be called VLN4P because implies a one-off input of C
    ModelDFSL_VLN4P <- ModelDFSL1y_VLN4

    #Export the dataframe
    write_xlsx(ModelDFSL_VLN4P,"VXP_Models\\ModelDFSL_R_VLN4P.xlsx")

    #Plot 3: Interactive Yearly CO2 emissions #
    MY <- 12
    ModelDFSL_VLN4P_YCO2 <- ModelDFSL_VLN4P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VLN4)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLN4P_YCO2) <- c("Year", "Months", "AnnualCO2_VLN_4")

    #Plot 3: Interactive Yearly CO2 emissions considering a delay
    GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
    ModelDFSL_VLN4P_YCO2D <- merge(ModelDFSL_VLN4P_YCO2, GWP100delay, by = "Year")
    ModelDFSL_VLN4P_YCO2D$AnnualCO2D_VLN_4 <- ModelDFSL_VLN4P_YCO2D$AnnualCO2_VLN_4 * ModelDFSL_VLN4P_YCO2D$GWP100

    #Plot 4: Interactive Yearly C emissions #
    MY <- 12
    ModelDFSL_VLN4P_YC <- ModelDFSL_VLN4P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VLN4)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLN4P_YC) <- c("Year", "Months", "CEmissions_VLN_4")

    #Plot 5: Interactive Yearly C tails (remaining C in Soil) #
    MY <- 12
    ModelDFSL_VLN4P_YCT <- ModelDFSL_VLN4P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VLN4)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLN4P_YCT) <- c("Year", "Months", "CTail_VLN_4")

    #Save Dataframes for Plots 3.1, 3.2, 4 and 5
    write_xlsx(ModelDFSL_VLN4P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VLN4P.xlsx") #Yearly CO2 emissions (no delay)
    write_xlsx(ModelDFSL_VLN4P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VLN4P.xlsx") #Yearly CO2 emissions (delay)
    write_xlsx(ModelDFSL_VLN4P_YC,"CEmissions_P\\ModelDFSL_R_CE_VLN4P.xlsx") #Yearly C emissions
    write_xlsx(ModelDFSL_VLN4P_YCT,"CTails_P\\ModelDFSL_R_CT_VLN4P.xlsx") #Yearly C emissions



    #### 9.6 - VLN5) Litter; 50%clay; No Tillage ####
    #The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
    fT_VLN5=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
    fW_VLN5=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                            S.Thick = soil.thick, pClay = clay100*0.5,
                            pE = 1.0, bare = FALSE)$b #Moisture effects per month
    xi.frame_VLN5=data.frame(years,rep(fT_VLN5*fW_VLN5,length.out=length(years)))

    #To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
    Model_VLN5=SoilR::RothCModel(
      t=years, #Simulation Length
      ks=c(k.DPM = 10*NTRM, k.RPM = 0.3*NTRM, k.BIO = 0.66*NTRM, k.HUM = 0.02*NTRM, k.IOM = 0*NTRM), #Decomposition rates for the different pools
      C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
      In=Scalar_LitterCinputs*1, #Amount of litter inputs by time
      FYM = Scalar_ManureCinputs*0, #Amount of Farm Yard Manure by time
      clay=clay100*0.5, #Percent clay in mineral soil
      xi=xi.frame_VLN5) #Loads the model

    Ct_VLN5=getC(Model_VLN5) #Calculates stocks for each pool per month

    #The results can be plotted with the commands
    matplot(years, Ct_VLN5, type="l", lty=1, col=1:5,
            xlab="Time (years)", ylab="C stocks (Mg/ha)")
    legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
           lty=1, col=1:5, bty="n")

    VEC_Lit_VLN5 <- rep(M_Scalar_LitterCinputs*1, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
    VEC_Man_VLN5 <- rep(M_Scalar_ManureCinputs*0, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

    VEC_LitDF_VLN5 <- as.data.frame(VEC_Lit_VLN5) #Converting the Litter vector to a data frame
    VEC_LitDF_VLN5$MNumber <- seq(from = 1, to = SimulationLength_months)
    VEC_ManDF_VLN5 <- as.data.frame(VEC_Man_VLN5) #Converting the Manure vector to a data frame
    VEC_ManDF_VLN5$MNumber <- seq(from = 1, to = SimulationLength_months)

    sapply(VEC_LitDF_VLN5, class) #Check that class is numeric
    sapply(VEC_ManDF_VLN5, class) #Check that class is numeric
    LitterCinputs_VLN5=VEC_LitDF_VLN5   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    ManureCinputs_VLN5=VEC_ManDF_VLN5 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    MCinputs_VLN5 <- merge(LitterCinputs_VLN5, ManureCinputs_VLN5, by = "MNumber")
    MCinputs_VLN5$MInput_VLN5 <- MCinputs_VLN5$VEC_Lit_VLN5 + MCinputs_VLN5$VEC_Man_VLN5

    #Change names of litter and manure columns for more common ones
    colnames(MCinputs_VLN5)[which(names(MCinputs_VLN5) == "VEC_Lit_VLN5")] <- "LitterC_VLN5"
    colnames(MCinputs_VLN5)[which(names(MCinputs_VLN5) == "VEC_Man_VLN5")] <- "ManureC_VLN5"

    #Create a dataframe with the data considering the simulation length
    ModelDF_VLN5 <- as.data.frame(Ct_VLN5)
    colnames(ModelDF_VLN5) <- c('DPM_VLN5','RPM_VLN5','BIO_VLN5', 'HUM_VLN5', 'IOM_VLN5')
    ModelDFS_VLN5 <- ModelDF_VLN5[1:SimulationLength_months, ]

    #Create a column with the number of month of analysis
    ModelDFS_VLN5$MNumber <- seq(from = 1, to = SimulationLength_months)

    #Create a column that sums all pools
    ModelDFS_VLN5$AllPools_VLN5 <- ModelDFS_VLN5$DPM_VLN5 + ModelDFS_VLN5$RPM_VLN5 + ModelDFS_VLN5$BIO_VLN5 + ModelDFS_VLN5$HUM_VLN5 + ModelDFS_VLN5$IOM_VLN5

    #Create a column that sums all pools except IOM (static)
    ModelDFS_VLN5$AllPools_noIOM_VLN5 <- ModelDFS_VLN5$DPM_VLN5 + ModelDFS_VLN5$RPM_VLN5 + ModelDFS_VLN5$BIO_VLN5 + ModelDFS_VLN5$HUM_VLN5

    #Create a column that add the monthly input of C (manure and litter separately)
    ModelDFSL_VLN5 <- merge(ModelDFS_VLN5, MCinputs_VLN5, by = "MNumber")

    ModelDFSL_VLN5$MInput_VLN5 <- ModelDFSL_VLN5$LitterC_VLN5 + ModelDFSL_VLN5$ManureC_VLN5
    #ModelDF_SL$MInput[1] <- 0

    #Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
    ModelDFSL_VLN5$CTails_VLN5 <- ModelDFSL_VLN5$AllPools_noIOM_VLN5 + ModelDFSL_VLN5$MInput_VLN5

    #Create Monthly Accumulated input of C
    ModelDFSL_VLN5$AccumInput_VLN5 = ModelDFSL_VLN5$AccumInput_VLN5=cumsum(ModelDFSL_VLN5$MInput_VLN5)

    #Create Monthly Growths for each carbon pool
    ModelDFSL_VLN5$MGrowth_DPM_VLN5 <- ave(ModelDFSL_VLN5$DPM_VLN5, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLN5$MGrowth_RPM_VLN5 <- ave(ModelDFSL_VLN5$RPM_VLN5, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLN5$MGrowth_BIO_VLN5 <- ave(ModelDFSL_VLN5$BIO_VLN5, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLN5$MGrowth_HUM_VLN5 <- ave(ModelDFSL_VLN5$HUM_VLN5, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLN5$MGrowth_IOM_VLN5 <- ave(ModelDFSL_VLN5$IOM_VLN5, FUN = function(x) c(0, diff(x)))

    #Create column for Monthly and Accumulated C-CO2 emissions
    ModelDFSL_VLN5$M_CCO2_VLN5 <- ModelDFSL_VLN5$MInput_VLN5 - ModelDFSL_VLN5$MGrowth_DPM_VLN5 - ModelDFSL_VLN5$MGrowth_RPM_VLN5 - ModelDFSL_VLN5$MGrowth_BIO_VLN5 - ModelDFSL_VLN5$MGrowth_HUM_VLN5
    ModelDFSL_VLN5$Accum_CCO2_VLN5 <- ModelDFSL_VLN5$AccumInput_VLN5 - ModelDFSL_VLN5$AllPools_noIOM_VLN5

    #Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
    ModelDFSL_VLN5$M_CCO2_VLN5[1] <- 0
    ModelDFSL_VLN5$Accum_CCO2_VLN5[1] <- 0

    #Balance validation
    ModelDFSL_VLN5$Balance_VLN5 <- ModelDFSL_VLN5$AccumInput_VLN5 - ModelDFSL_VLN5$Accum_CCO2_VLN5 - (ModelDFSL_VLN5$DPM_VLN5 + ModelDFSL_VLN5$RPM_VLN5 + ModelDFSL_VLN5$BIO_VLN5 + ModelDFSL_VLN5$HUM_VLN5)

    #Convert C-CO2 emissions into CO2 emissions
    ModelDFSL_VLN5$M_CO2_VLN5 <- ModelDFSL_VLN5$M_CCO2_VLN5 * 44/12
    ModelDFSL_VLN5$Accum_CO2_VLN5 <- ModelDFSL_VLN5$Accum_CCO2_VLN5 * 44/12

    #This model will be called VLN5C because implies a continuous input of C
    ModelDFSL_VLN5C <- ModelDFSL_VLN5

    #Export the dataframe
    write_xlsx(ModelDFSL_VLN5C,"VXC_Models\\ModelDFSL_R_VLN5C.xlsx")

    #Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
    #Create two equal models by using the above general script
    #Create model t=x
    ModelDFSLt0_VLN5 <- ModelDFSL_VLN5 #Create model t=x

    #Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
    ModelDFSLt1_VLN5.1 <- rbind(c(0:0), ModelDFSLt0_VLN5)
    ModelDFSLt1_VLN5.2 <- rbind(c(0:0), ModelDFSLt1_VLN5.1)
    ModelDFSLt1_VLN5.3 <- rbind(c(0:0), ModelDFSLt1_VLN5.2)
    ModelDFSLt1_VLN5.4 <- rbind(c(0:0), ModelDFSLt1_VLN5.3)
    ModelDFSLt1_VLN5.5 <- rbind(c(0:0), ModelDFSLt1_VLN5.4)
    ModelDFSLt1_VLN5.6 <- rbind(c(0:0), ModelDFSLt1_VLN5.5)
    ModelDFSLt1_VLN5.7 <- rbind(c(0:0), ModelDFSLt1_VLN5.6)
    ModelDFSLt1_VLN5.8 <- rbind(c(0:0), ModelDFSLt1_VLN5.7)
    ModelDFSLt1_VLN5.9 <- rbind(c(0:0), ModelDFSLt1_VLN5.8)
    ModelDFSLt1_VLN5.10 <- rbind(c(0:0), ModelDFSLt1_VLN5.9)
    ModelDFSLt1_VLN5.11 <- rbind(c(0:0), ModelDFSLt1_VLN5.10)
    ModelDFSLt1_VLN5.12 <- rbind(c(0:0), ModelDFSLt1_VLN5.11)
    ModelDFSLt1_VLN5.13 <- ModelDFSLt1_VLN5.12[-nrow(ModelDFSLt1_VLN5.12),]
    ModelDFSLt1_VLN5.14 <- ModelDFSLt1_VLN5.13[-nrow(ModelDFSLt1_VLN5.13),]
    ModelDFSLt1_VLN5.15 <- ModelDFSLt1_VLN5.14[-nrow(ModelDFSLt1_VLN5.14),]
    ModelDFSLt1_VLN5.16 <- ModelDFSLt1_VLN5.15[-nrow(ModelDFSLt1_VLN5.15),]
    ModelDFSLt1_VLN5.17 <- ModelDFSLt1_VLN5.16[-nrow(ModelDFSLt1_VLN5.16),]
    ModelDFSLt1_VLN5.18 <- ModelDFSLt1_VLN5.17[-nrow(ModelDFSLt1_VLN5.17),]
    ModelDFSLt1_VLN5.19 <- ModelDFSLt1_VLN5.18[-nrow(ModelDFSLt1_VLN5.18),]
    ModelDFSLt1_VLN5.20 <- ModelDFSLt1_VLN5.19[-nrow(ModelDFSLt1_VLN5.19),]
    ModelDFSLt1_VLN5.21 <- ModelDFSLt1_VLN5.20[-nrow(ModelDFSLt1_VLN5.20),]
    ModelDFSLt1_VLN5.22 <- ModelDFSLt1_VLN5.21[-nrow(ModelDFSLt1_VLN5.21),]
    ModelDFSLt1_VLN5.23 <- ModelDFSLt1_VLN5.22[-nrow(ModelDFSLt1_VLN5.22),]
    ModelDFSLt1_VLN5.24 <- ModelDFSLt1_VLN5.23[-nrow(ModelDFSLt1_VLN5.23),]

    ModelDFSLt1_VLN5 <- ModelDFSLt1_VLN5.24 #Create model t=x+1

    #Subtract model (t=x) - (t=x+1)
    ModelDFSL1y_VLN5 <- ModelDFSLt0_VLN5 - ModelDFSLt1_VLN5

    #Re-do Month Number column because the substraction was also applied to it
    ModelDFSL1y_VLN5$MNumber <- seq(from = 1, to = SimulationLength_months)

    #This model will be called VLN5P because implies a one-off input of C
    ModelDFSL_VLN5P <- ModelDFSL1y_VLN5

    #Export the dataframe
    write_xlsx(ModelDFSL_VLN5P,"VXP_Models\\ModelDFSL_R_VLN5P.xlsx")


    #Plot 3: Interactive Yearly CO2 emissions #
    MY <- 12
    ModelDFSL_VLN5P_YCO2 <- ModelDFSL_VLN5P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VLN5)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLN5P_YCO2) <- c("Year", "Months", "AnnualCO2_VLN_5")


    #Plot 3: Interactive Yearly CO2 emissions considering a delay
    GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
    ModelDFSL_VLN5P_YCO2D <- merge(ModelDFSL_VLN5P_YCO2, GWP100delay, by = "Year")
    ModelDFSL_VLN5P_YCO2D$AnnualCO2D_VLN_5 <- ModelDFSL_VLN5P_YCO2D$AnnualCO2_VLN_5 * ModelDFSL_VLN5P_YCO2D$GWP100

    #Plot 4: Interactive Yearly C emissions #
    MY <- 12
    ModelDFSL_VLN5P_YC <- ModelDFSL_VLN5P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VLN5)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLN5P_YC) <- c("Year", "Months", "CEmissions_VLN_5")


    #Plot 5: Interactive Yearly C tails (remaining C in Soil) #
    MY <- 12
    ModelDFSL_VLN5P_YCT <- ModelDFSL_VLN5P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VLN5)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLN5P_YCT) <- c("Year", "Months", "CTail_VLN_5")

    #Save Dataframes for Plots 3.1, 3.2, 4 and 5
    write_xlsx(ModelDFSL_VLN5P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VLN5P.xlsx") #Yearly CO2 emissions (no delay)
    write_xlsx(ModelDFSL_VLN5P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VLN5P.xlsx") #Yearly CO2 emissions (delay)
    write_xlsx(ModelDFSL_VLN5P_YC,"CEmissions_P\\ModelDFSL_R_CE_VLN5P.xlsx") #Yearly C emissions
    write_xlsx(ModelDFSL_VLN5P_YCT,"CTails_P\\ModelDFSL_R_CT_VLN5P.xlsx") #Yearly C emissions



    #### 9.7 - VLN6) Litter; 60%clay; No Tillage ####
    #The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
    fT_VLN6=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
    fW_VLN6=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                            S.Thick = soil.thick, pClay = clay100*0.6,
                            pE = 1.0, bare = FALSE)$b #Moisture effects per month
    xi.frame_VLN6=data.frame(years,rep(fT_VLN6*fW_VLN6,length.out=length(years)))

    #To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
    Model_VLN6=SoilR::RothCModel(
      t=years, #Simulation Length
      ks=c(k.DPM = 10*NTRM, k.RPM = 0.3*NTRM, k.BIO = 0.66*NTRM, k.HUM = 0.02*NTRM, k.IOM = 0*NTRM), #Decomposition rates for the different pools
      C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
      In=Scalar_LitterCinputs*1, #Amount of litter inputs by time
      FYM = Scalar_ManureCinputs*0, #Amount of Farm Yard Manure by time
      clay=clay100*0.6, #Percent clay in mineral soil
      xi=xi.frame_VLN6) #Loads the model

    Ct_VLN6=getC(Model_VLN6) #Calculates stocks for each pool per month

    #The results can be plotted with the commands
    matplot(years, Ct_VLN6, type="l", lty=1, col=1:5,
            xlab="Time (years)", ylab="C stocks (Mg/ha)")
    legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
           lty=1, col=1:5, bty="n")

    VEC_Lit_VLN6 <- rep(M_Scalar_LitterCinputs*1, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
    VEC_Man_VLN6 <- rep(M_Scalar_ManureCinputs*0, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

    VEC_LitDF_VLN6 <- as.data.frame(VEC_Lit_VLN6) #Converting the Litter vector to a data frame
    VEC_LitDF_VLN6$MNumber <- seq(from = 1, to = SimulationLength_months)
    VEC_ManDF_VLN6 <- as.data.frame(VEC_Man_VLN6) #Converting the Manure vector to a data frame
    VEC_ManDF_VLN6$MNumber <- seq(from = 1, to = SimulationLength_months)

    sapply(VEC_LitDF_VLN6, class) #Check that class is numeric
    sapply(VEC_ManDF_VLN6, class) #Check that class is numeric
    LitterCinputs_VLN6=VEC_LitDF_VLN6   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    ManureCinputs_VLN6=VEC_ManDF_VLN6 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    MCinputs_VLN6 <- merge(LitterCinputs_VLN6, ManureCinputs_VLN6, by = "MNumber")
    MCinputs_VLN6$MInput_VLN6 <- MCinputs_VLN6$VEC_Lit_VLN6 + MCinputs_VLN6$VEC_Man_VLN6

    #Change names of litter and manure columns for more common ones
    colnames(MCinputs_VLN6)[which(names(MCinputs_VLN6) == "VEC_Lit_VLN6")] <- "LitterC_VLN6"
    colnames(MCinputs_VLN6)[which(names(MCinputs_VLN6) == "VEC_Man_VLN6")] <- "ManureC_VLN6"

    #Create a dataframe with the data considering the simulation length
    ModelDF_VLN6 <- as.data.frame(Ct_VLN6)
    colnames(ModelDF_VLN6) <- c('DPM_VLN6','RPM_VLN6','BIO_VLN6', 'HUM_VLN6', 'IOM_VLN6')
    ModelDFS_VLN6 <- ModelDF_VLN6[1:SimulationLength_months, ]

    #Create a column with the number of month of analysis
    ModelDFS_VLN6$MNumber <- seq(from = 1, to = SimulationLength_months)

    #Create a column that sums all pools
    ModelDFS_VLN6$AllPools_VLN6 <- ModelDFS_VLN6$DPM_VLN6 + ModelDFS_VLN6$RPM_VLN6 + ModelDFS_VLN6$BIO_VLN6 + ModelDFS_VLN6$HUM_VLN6 + ModelDFS_VLN6$IOM_VLN6

    #Create a column that sums all pools except IOM (static)
    ModelDFS_VLN6$AllPools_noIOM_VLN6 <- ModelDFS_VLN6$DPM_VLN6 + ModelDFS_VLN6$RPM_VLN6 + ModelDFS_VLN6$BIO_VLN6 + ModelDFS_VLN6$HUM_VLN6

    #Create a column that add the monthly input of C (manure and litter separately)
    ModelDFSL_VLN6 <- merge(ModelDFS_VLN6, MCinputs_VLN6, by = "MNumber")

    ModelDFSL_VLN6$MInput_VLN6 <- ModelDFSL_VLN6$LitterC_VLN6 + ModelDFSL_VLN6$ManureC_VLN6
    #ModelDF_SL$MInput[1] <- 0

    #Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
    ModelDFSL_VLN6$CTails_VLN6 <- ModelDFSL_VLN6$AllPools_noIOM_VLN6 + ModelDFSL_VLN6$MInput_VLN6

    #Create Monthly Accumulated input of C
    ModelDFSL_VLN6$AccumInput_VLN6 = ModelDFSL_VLN6$AccumInput_VLN6=cumsum(ModelDFSL_VLN6$MInput_VLN6)

    #Create Monthly Growths for each carbon pool
    ModelDFSL_VLN6$MGrowth_DPM_VLN6 <- ave(ModelDFSL_VLN6$DPM_VLN6, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLN6$MGrowth_RPM_VLN6 <- ave(ModelDFSL_VLN6$RPM_VLN6, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLN6$MGrowth_BIO_VLN6 <- ave(ModelDFSL_VLN6$BIO_VLN6, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLN6$MGrowth_HUM_VLN6 <- ave(ModelDFSL_VLN6$HUM_VLN6, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLN6$MGrowth_IOM_VLN6 <- ave(ModelDFSL_VLN6$IOM_VLN6, FUN = function(x) c(0, diff(x)))

    #Create column for Monthly and Accumulated C-CO2 emissions
    ModelDFSL_VLN6$M_CCO2_VLN6 <- ModelDFSL_VLN6$MInput_VLN6 - ModelDFSL_VLN6$MGrowth_DPM_VLN6 - ModelDFSL_VLN6$MGrowth_RPM_VLN6 - ModelDFSL_VLN6$MGrowth_BIO_VLN6 - ModelDFSL_VLN6$MGrowth_HUM_VLN6
    ModelDFSL_VLN6$Accum_CCO2_VLN6 <- ModelDFSL_VLN6$AccumInput_VLN6 - ModelDFSL_VLN6$AllPools_noIOM_VLN6

    #Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
    ModelDFSL_VLN6$M_CCO2_VLN6[1] <- 0
    ModelDFSL_VLN6$Accum_CCO2_VLN6[1] <- 0

    #Balance validation
    ModelDFSL_VLN6$Balance_VLN6 <- ModelDFSL_VLN6$AccumInput_VLN6 - ModelDFSL_VLN6$Accum_CCO2_VLN6 - (ModelDFSL_VLN6$DPM_VLN6 + ModelDFSL_VLN6$RPM_VLN6 + ModelDFSL_VLN6$BIO_VLN6 + ModelDFSL_VLN6$HUM_VLN6)

    #Convert C-CO2 emissions into CO2 emissions
    ModelDFSL_VLN6$M_CO2_VLN6 <- ModelDFSL_VLN6$M_CCO2_VLN6 * 44/12
    ModelDFSL_VLN6$Accum_CO2_VLN6 <- ModelDFSL_VLN6$Accum_CCO2_VLN6 * 44/12

    #This model will be called VLN6C because implies a continuous input of C
    ModelDFSL_VLN6C <- ModelDFSL_VLN6

    #Export the dataframe
    write_xlsx(ModelDFSL_VLN6C,"VXC_Models\\ModelDFSL_R_VLN6C.xlsx")

    #Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
    #Create two equal models by using the above general script
    #Create model t=x
    ModelDFSLt0_VLN6 <- ModelDFSL_VLN6 #Create model t=x

    #Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
    ModelDFSLt1_VLN6.1 <- rbind(c(0:0), ModelDFSLt0_VLN6)
    ModelDFSLt1_VLN6.2 <- rbind(c(0:0), ModelDFSLt1_VLN6.1)
    ModelDFSLt1_VLN6.3 <- rbind(c(0:0), ModelDFSLt1_VLN6.2)
    ModelDFSLt1_VLN6.4 <- rbind(c(0:0), ModelDFSLt1_VLN6.3)
    ModelDFSLt1_VLN6.5 <- rbind(c(0:0), ModelDFSLt1_VLN6.4)
    ModelDFSLt1_VLN6.6 <- rbind(c(0:0), ModelDFSLt1_VLN6.5)
    ModelDFSLt1_VLN6.7 <- rbind(c(0:0), ModelDFSLt1_VLN6.6)
    ModelDFSLt1_VLN6.8 <- rbind(c(0:0), ModelDFSLt1_VLN6.7)
    ModelDFSLt1_VLN6.9 <- rbind(c(0:0), ModelDFSLt1_VLN6.8)
    ModelDFSLt1_VLN6.10 <- rbind(c(0:0), ModelDFSLt1_VLN6.9)
    ModelDFSLt1_VLN6.11 <- rbind(c(0:0), ModelDFSLt1_VLN6.10)
    ModelDFSLt1_VLN6.12 <- rbind(c(0:0), ModelDFSLt1_VLN6.11)
    ModelDFSLt1_VLN6.13 <- ModelDFSLt1_VLN6.12[-nrow(ModelDFSLt1_VLN6.12),]
    ModelDFSLt1_VLN6.14 <- ModelDFSLt1_VLN6.13[-nrow(ModelDFSLt1_VLN6.13),]
    ModelDFSLt1_VLN6.15 <- ModelDFSLt1_VLN6.14[-nrow(ModelDFSLt1_VLN6.14),]
    ModelDFSLt1_VLN6.16 <- ModelDFSLt1_VLN6.15[-nrow(ModelDFSLt1_VLN6.15),]
    ModelDFSLt1_VLN6.17 <- ModelDFSLt1_VLN6.16[-nrow(ModelDFSLt1_VLN6.16),]
    ModelDFSLt1_VLN6.18 <- ModelDFSLt1_VLN6.17[-nrow(ModelDFSLt1_VLN6.17),]
    ModelDFSLt1_VLN6.19 <- ModelDFSLt1_VLN6.18[-nrow(ModelDFSLt1_VLN6.18),]
    ModelDFSLt1_VLN6.20 <- ModelDFSLt1_VLN6.19[-nrow(ModelDFSLt1_VLN6.19),]
    ModelDFSLt1_VLN6.21 <- ModelDFSLt1_VLN6.20[-nrow(ModelDFSLt1_VLN6.20),]
    ModelDFSLt1_VLN6.22 <- ModelDFSLt1_VLN6.21[-nrow(ModelDFSLt1_VLN6.21),]
    ModelDFSLt1_VLN6.23 <- ModelDFSLt1_VLN6.22[-nrow(ModelDFSLt1_VLN6.22),]
    ModelDFSLt1_VLN6.24 <- ModelDFSLt1_VLN6.23[-nrow(ModelDFSLt1_VLN6.23),]

    ModelDFSLt1_VLN6 <- ModelDFSLt1_VLN6.24 #Create model t=x+1

    #Subtract model (t=x) - (t=x+1)
    ModelDFSL1y_VLN6 <- ModelDFSLt0_VLN6 - ModelDFSLt1_VLN6

    #Re-do Month Number column because the substraction was also applied to it
    ModelDFSL1y_VLN6$MNumber <- seq(from = 1, to = SimulationLength_months)

    #This model will be called VLN6P because implies a one-off input of C
    ModelDFSL_VLN6P <- ModelDFSL1y_VLN6

    #Export the dataframe
    write_xlsx(ModelDFSL_VLN6P,"VXP_Models\\ModelDFSL_R_VLN6P.xlsx")

    #Plot 3: Interactive Yearly CO2 emissions #
    MY <- 12
    ModelDFSL_VLN6P_YCO2 <- ModelDFSL_VLN6P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VLN6)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLN6P_YCO2) <- c("Year", "Months", "AnnualCO2_VLN_6")


    #Plot 3: Interactive Yearly CO2 emissions considering a delay
    GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
    ModelDFSL_VLN6P_YCO2D <- merge(ModelDFSL_VLN6P_YCO2, GWP100delay, by = "Year")
    ModelDFSL_VLN6P_YCO2D$AnnualCO2D_VLN_6 <- ModelDFSL_VLN6P_YCO2D$AnnualCO2_VLN_6 * ModelDFSL_VLN6P_YCO2D$GWP100

    #Plot 4: Interactive Yearly C emissions #
    MY <- 12
    ModelDFSL_VLN6P_YC <- ModelDFSL_VLN6P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VLN6)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLN6P_YC) <- c("Year", "Months", "CEmissions_VLN_6")


    #Plot 5: Interactive Yearly C tails (remaining C in Soil) #
    MY <- 12
    ModelDFSL_VLN6P_YCT <- ModelDFSL_VLN6P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VLN6)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLN6P_YCT) <- c("Year", "Months", "CTail_VLN_6")

    #Save Dataframes for Plots 3.1, 3.2, 4 and 5
    write_xlsx(ModelDFSL_VLN6P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VLN6P.xlsx") #Yearly CO2 emissions (no delay)
    write_xlsx(ModelDFSL_VLN6P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VLN6P.xlsx") #Yearly CO2 emissions (delay)
    write_xlsx(ModelDFSL_VLN6P_YC,"CEmissions_P\\ModelDFSL_R_CE_VLN6P.xlsx") #Yearly C emissions
    write_xlsx(ModelDFSL_VLN6P_YCT,"CTails_P\\ModelDFSL_R_CT_VLN6P.xlsx") #Yearly C emissions



    #### 9.8 - VLN7) Litter; 70%clay; No Tillage ####
    #The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
    fT_VLN7=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
    fW_VLN7=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                            S.Thick = soil.thick, pClay = clay100*0.7,
                            pE = 1.0, bare = FALSE)$b #Moisture effects per month
    xi.frame_VLN7=data.frame(years,rep(fT_VLN7*fW_VLN7,length.out=length(years)))

    #To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
    Model_VLN7=SoilR::RothCModel(
      t=years, #Simulation Length
      ks=c(k.DPM = 10*NTRM, k.RPM = 0.3*NTRM, k.BIO = 0.66*NTRM, k.HUM = 0.02*NTRM, k.IOM = 0*NTRM), #Decomposition rates for the different pools
      C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
      In=Scalar_LitterCinputs*1, #Amount of litter inputs by time
      FYM = Scalar_ManureCinputs*0, #Amount of Farm Yard Manure by time
      clay=clay100*0.7, #Percent clay in mineral soil
      xi=xi.frame_VLN7) #Loads the model

    Ct_VLN7=getC(Model_VLN7) #Calculates stocks for each pool per month

    #The results can be plotted with the commands
    matplot(years, Ct_VLN7, type="l", lty=1, col=1:5,
            xlab="Time (years)", ylab="C stocks (Mg/ha)")
    legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
           lty=1, col=1:5, bty="n")

    VEC_Lit_VLN7 <- rep(M_Scalar_LitterCinputs*1, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
    VEC_Man_VLN7 <- rep(M_Scalar_ManureCinputs*0, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

    VEC_LitDF_VLN7 <- as.data.frame(VEC_Lit_VLN7) #Converting the Litter vector to a data frame
    VEC_LitDF_VLN7$MNumber <- seq(from = 1, to = SimulationLength_months)
    VEC_ManDF_VLN7 <- as.data.frame(VEC_Man_VLN7) #Converting the Manure vector to a data frame
    VEC_ManDF_VLN7$MNumber <- seq(from = 1, to = SimulationLength_months)

    sapply(VEC_LitDF_VLN7, class) #Check that class is numeric
    sapply(VEC_ManDF_VLN7, class) #Check that class is numeric
    LitterCinputs_VLN7=VEC_LitDF_VLN7   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    ManureCinputs_VLN7=VEC_ManDF_VLN7 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    MCinputs_VLN7 <- merge(LitterCinputs_VLN7, ManureCinputs_VLN7, by = "MNumber")
    MCinputs_VLN7$MInput_VLN7 <- MCinputs_VLN7$VEC_Lit_VLN7 + MCinputs_VLN7$VEC_Man_VLN7

    #Change names of litter and manure columns for more common ones
    colnames(MCinputs_VLN7)[which(names(MCinputs_VLN7) == "VEC_Lit_VLN7")] <- "LitterC_VLN7"
    colnames(MCinputs_VLN7)[which(names(MCinputs_VLN7) == "VEC_Man_VLN7")] <- "ManureC_VLN7"

    #Create a dataframe with the data considering the simulation length
    ModelDF_VLN7 <- as.data.frame(Ct_VLN7)
    colnames(ModelDF_VLN7) <- c('DPM_VLN7','RPM_VLN7','BIO_VLN7', 'HUM_VLN7', 'IOM_VLN7')
    ModelDFS_VLN7 <- ModelDF_VLN7[1:SimulationLength_months, ]

    #Create a column with the number of month of analysis
    ModelDFS_VLN7$MNumber <- seq(from = 1, to = SimulationLength_months)

    #Create a column that sums all pools
    ModelDFS_VLN7$AllPools_VLN7 <- ModelDFS_VLN7$DPM_VLN7 + ModelDFS_VLN7$RPM_VLN7 + ModelDFS_VLN7$BIO_VLN7 + ModelDFS_VLN7$HUM_VLN7 + ModelDFS_VLN7$IOM_VLN7

    #Create a column that sums all pools except IOM (static)
    ModelDFS_VLN7$AllPools_noIOM_VLN7 <- ModelDFS_VLN7$DPM_VLN7 + ModelDFS_VLN7$RPM_VLN7 + ModelDFS_VLN7$BIO_VLN7 + ModelDFS_VLN7$HUM_VLN7

    #Create a column that add the monthly input of C (manure and litter separately)
    ModelDFSL_VLN7 <- merge(ModelDFS_VLN7, MCinputs_VLN7, by = "MNumber")

    ModelDFSL_VLN7$MInput_VLN7 <- ModelDFSL_VLN7$LitterC_VLN7 + ModelDFSL_VLN7$ManureC_VLN7
    #ModelDF_SL$MInput[1] <- 0

    #Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
    ModelDFSL_VLN7$CTails_VLN7 <- ModelDFSL_VLN7$AllPools_noIOM_VLN7 + ModelDFSL_VLN7$MInput_VLN7

    #Create Monthly Accumulated input of C
    ModelDFSL_VLN7$AccumInput_VLN7 = ModelDFSL_VLN7$AccumInput_VLN7=cumsum(ModelDFSL_VLN7$MInput_VLN7)

    #Create Monthly Growths for each carbon pool
    ModelDFSL_VLN7$MGrowth_DPM_VLN7 <- ave(ModelDFSL_VLN7$DPM_VLN7, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLN7$MGrowth_RPM_VLN7 <- ave(ModelDFSL_VLN7$RPM_VLN7, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLN7$MGrowth_BIO_VLN7 <- ave(ModelDFSL_VLN7$BIO_VLN7, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLN7$MGrowth_HUM_VLN7 <- ave(ModelDFSL_VLN7$HUM_VLN7, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLN7$MGrowth_IOM_VLN7 <- ave(ModelDFSL_VLN7$IOM_VLN7, FUN = function(x) c(0, diff(x)))

    #Create column for Monthly and Accumulated C-CO2 emissions
    ModelDFSL_VLN7$M_CCO2_VLN7 <- ModelDFSL_VLN7$MInput_VLN7 - ModelDFSL_VLN7$MGrowth_DPM_VLN7 - ModelDFSL_VLN7$MGrowth_RPM_VLN7 - ModelDFSL_VLN7$MGrowth_BIO_VLN7 - ModelDFSL_VLN7$MGrowth_HUM_VLN7
    ModelDFSL_VLN7$Accum_CCO2_VLN7 <- ModelDFSL_VLN7$AccumInput_VLN7 - ModelDFSL_VLN7$AllPools_noIOM_VLN7

    #Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
    ModelDFSL_VLN7$M_CCO2_VLN7[1] <- 0
    ModelDFSL_VLN7$Accum_CCO2_VLN7[1] <- 0

    #Balance validation
    ModelDFSL_VLN7$Balance_VLN7 <- ModelDFSL_VLN7$AccumInput_VLN7 - ModelDFSL_VLN7$Accum_CCO2_VLN7 - (ModelDFSL_VLN7$DPM_VLN7 + ModelDFSL_VLN7$RPM_VLN7 + ModelDFSL_VLN7$BIO_VLN7 + ModelDFSL_VLN7$HUM_VLN7)

    #Convert C-CO2 emissions into CO2 emissions
    ModelDFSL_VLN7$M_CO2_VLN7 <- ModelDFSL_VLN7$M_CCO2_VLN7 * 44/12
    ModelDFSL_VLN7$Accum_CO2_VLN7 <- ModelDFSL_VLN7$Accum_CCO2_VLN7 * 44/12

    #This model will be called VLN7C because implies a continuous input of C
    ModelDFSL_VLN7C <- ModelDFSL_VLN7

    #Export the dataframe
    write_xlsx(ModelDFSL_VLN7C,"VXC_Models\\ModelDFSL_R_VLN7C.xlsx")

    #Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
    #Create two equal models by using the above general script
    #Create model t=x
    ModelDFSLt0_VLN7 <- ModelDFSL_VLN7 #Create model t=x

    #Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
    ModelDFSLt1_VLN7.1 <- rbind(c(0:0), ModelDFSLt0_VLN7)
    ModelDFSLt1_VLN7.2 <- rbind(c(0:0), ModelDFSLt1_VLN7.1)
    ModelDFSLt1_VLN7.3 <- rbind(c(0:0), ModelDFSLt1_VLN7.2)
    ModelDFSLt1_VLN7.4 <- rbind(c(0:0), ModelDFSLt1_VLN7.3)
    ModelDFSLt1_VLN7.5 <- rbind(c(0:0), ModelDFSLt1_VLN7.4)
    ModelDFSLt1_VLN7.6 <- rbind(c(0:0), ModelDFSLt1_VLN7.5)
    ModelDFSLt1_VLN7.7 <- rbind(c(0:0), ModelDFSLt1_VLN7.6)
    ModelDFSLt1_VLN7.8 <- rbind(c(0:0), ModelDFSLt1_VLN7.7)
    ModelDFSLt1_VLN7.9 <- rbind(c(0:0), ModelDFSLt1_VLN7.8)
    ModelDFSLt1_VLN7.10 <- rbind(c(0:0), ModelDFSLt1_VLN7.9)
    ModelDFSLt1_VLN7.11 <- rbind(c(0:0), ModelDFSLt1_VLN7.10)
    ModelDFSLt1_VLN7.12 <- rbind(c(0:0), ModelDFSLt1_VLN7.11)
    ModelDFSLt1_VLN7.13 <- ModelDFSLt1_VLN7.12[-nrow(ModelDFSLt1_VLN7.12),]
    ModelDFSLt1_VLN7.14 <- ModelDFSLt1_VLN7.13[-nrow(ModelDFSLt1_VLN7.13),]
    ModelDFSLt1_VLN7.15 <- ModelDFSLt1_VLN7.14[-nrow(ModelDFSLt1_VLN7.14),]
    ModelDFSLt1_VLN7.16 <- ModelDFSLt1_VLN7.15[-nrow(ModelDFSLt1_VLN7.15),]
    ModelDFSLt1_VLN7.17 <- ModelDFSLt1_VLN7.16[-nrow(ModelDFSLt1_VLN7.16),]
    ModelDFSLt1_VLN7.18 <- ModelDFSLt1_VLN7.17[-nrow(ModelDFSLt1_VLN7.17),]
    ModelDFSLt1_VLN7.19 <- ModelDFSLt1_VLN7.18[-nrow(ModelDFSLt1_VLN7.18),]
    ModelDFSLt1_VLN7.20 <- ModelDFSLt1_VLN7.19[-nrow(ModelDFSLt1_VLN7.19),]
    ModelDFSLt1_VLN7.21 <- ModelDFSLt1_VLN7.20[-nrow(ModelDFSLt1_VLN7.20),]
    ModelDFSLt1_VLN7.22 <- ModelDFSLt1_VLN7.21[-nrow(ModelDFSLt1_VLN7.21),]
    ModelDFSLt1_VLN7.23 <- ModelDFSLt1_VLN7.22[-nrow(ModelDFSLt1_VLN7.22),]
    ModelDFSLt1_VLN7.24 <- ModelDFSLt1_VLN7.23[-nrow(ModelDFSLt1_VLN7.23),]

    ModelDFSLt1_VLN7 <- ModelDFSLt1_VLN7.24 #Create model t=x+1

    #Subtract model (t=x) - (t=x+1)
    ModelDFSL1y_VLN7 <- ModelDFSLt0_VLN7 - ModelDFSLt1_VLN7

    #Re-do Month Number column because the substraction was also applied to it
    ModelDFSL1y_VLN7$MNumber <- seq(from = 1, to = SimulationLength_months)

    #This model will be called VLN7P because implies a one-off input of C
    ModelDFSL_VLN7P <- ModelDFSL1y_VLN7

    #Export the dataframe
    write_xlsx(ModelDFSL_VLN7P,"VXP_Models\\ModelDFSL_R_VLN7P.xlsx")

    #Plot 3: Interactive Yearly CO2 emissions #
    MY <- 12
    ModelDFSL_VLN7P_YCO2 <- ModelDFSL_VLN7P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VLN7)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLN7P_YCO2) <- c("Year", "Months", "AnnualCO2_VLN_7")


    #Plot 3: Interactive Yearly CO2 emissions considering a delay
    GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
    ModelDFSL_VLN7P_YCO2D <- merge(ModelDFSL_VLN7P_YCO2, GWP100delay, by = "Year")
    ModelDFSL_VLN7P_YCO2D$AnnualCO2D_VLN_7 <- ModelDFSL_VLN7P_YCO2D$AnnualCO2_VLN_7 * ModelDFSL_VLN7P_YCO2D$GWP100

    #Plot 4: Interactive Yearly C emissions #
    MY <- 12
    ModelDFSL_VLN7P_YC <- ModelDFSL_VLN7P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VLN7)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLN7P_YC) <- c("Year", "Months", "CEmissions_VLN_7")


    #Plot 5: Interactive Yearly C tails (remaining C in Soil) #
    MY <- 12
    ModelDFSL_VLN7P_YCT <- ModelDFSL_VLN7P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VLN7)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLN7P_YCT) <- c("Year", "Months", "CTail_VLN_7")


    #Save Dataframes for Plots 3.1, 3.2, 4 and 5
    write_xlsx(ModelDFSL_VLN7P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VLN7P.xlsx") #Yearly CO2 emissions (no delay)
    write_xlsx(ModelDFSL_VLN7P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VLN7P.xlsx") #Yearly CO2 emissions (delay)
    write_xlsx(ModelDFSL_VLN7P_YC,"CEmissions_P\\ModelDFSL_R_CE_VLN7P.xlsx") #Yearly C emissions
    write_xlsx(ModelDFSL_VLN7P_YCT,"CTails_P\\ModelDFSL_R_CT_VLN7P.xlsx") #Yearly C emissions



    #### 9.9 - VLN8) Litter; 80%clay; No Tillage ####
    #The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
    fT_VLN8=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
    fW_VLN8=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                            S.Thick = soil.thick, pClay = clay100*0.8,
                            pE = 1.0, bare = FALSE)$b #Moisture effects per month
    xi.frame_VLN8=data.frame(years,rep(fT_VLN8*fW_VLN8,length.out=length(years)))

    #To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
    Model_VLN8=SoilR::RothCModel(
      t=years, #Simulation Length
      ks=c(k.DPM = 10*NTRM, k.RPM = 0.3*NTRM, k.BIO = 0.66*NTRM, k.HUM = 0.02*NTRM, k.IOM = 0*NTRM), #Decomposition rates for the different pools
      C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
      In=Scalar_LitterCinputs*1, #Amount of litter inputs by time
      FYM = Scalar_ManureCinputs*0, #Amount of Farm Yard Manure by time
      clay=clay100*0.8, #Percent clay in mineral soil
      xi=xi.frame_VLN8) #Loads the model

    Ct_VLN8=getC(Model_VLN8) #Calculates stocks for each pool per month

    #The results can be plotted with the commands
    matplot(years, Ct_VLN8, type="l", lty=1, col=1:5,
            xlab="Time (years)", ylab="C stocks (Mg/ha)")
    legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
           lty=1, col=1:5, bty="n")

    VEC_Lit_VLN8 <- rep(M_Scalar_LitterCinputs*1, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
    VEC_Man_VLN8 <- rep(M_Scalar_ManureCinputs*0, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

    VEC_LitDF_VLN8 <- as.data.frame(VEC_Lit_VLN8) #Converting the Litter vector to a data frame
    VEC_LitDF_VLN8$MNumber <- seq(from = 1, to = SimulationLength_months)
    VEC_ManDF_VLN8 <- as.data.frame(VEC_Man_VLN8) #Converting the Manure vector to a data frame
    VEC_ManDF_VLN8$MNumber <- seq(from = 1, to = SimulationLength_months)

    sapply(VEC_LitDF_VLN8, class) #Check that class is numeric
    sapply(VEC_ManDF_VLN8, class) #Check that class is numeric
    LitterCinputs_VLN8=VEC_LitDF_VLN8   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    ManureCinputs_VLN8=VEC_ManDF_VLN8 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    MCinputs_VLN8 <- merge(LitterCinputs_VLN8, ManureCinputs_VLN8, by = "MNumber")
    MCinputs_VLN8$MInput_VLN8 <- MCinputs_VLN8$VEC_Lit_VLN8 + MCinputs_VLN8$VEC_Man_VLN8

    #Change names of litter and manure columns for more common ones
    colnames(MCinputs_VLN8)[which(names(MCinputs_VLN8) == "VEC_Lit_VLN8")] <- "LitterC_VLN8"
    colnames(MCinputs_VLN8)[which(names(MCinputs_VLN8) == "VEC_Man_VLN8")] <- "ManureC_VLN8"

    #Create a dataframe with the data considering the simulation length
    ModelDF_VLN8 <- as.data.frame(Ct_VLN8)
    colnames(ModelDF_VLN8) <- c('DPM_VLN8','RPM_VLN8','BIO_VLN8', 'HUM_VLN8', 'IOM_VLN8')
    ModelDFS_VLN8 <- ModelDF_VLN8[1:SimulationLength_months, ]

    #Create a column with the number of month of analysis
    ModelDFS_VLN8$MNumber <- seq(from = 1, to = SimulationLength_months)

    #Create a column that sums all pools
    ModelDFS_VLN8$AllPools_VLN8 <- ModelDFS_VLN8$DPM_VLN8 + ModelDFS_VLN8$RPM_VLN8 + ModelDFS_VLN8$BIO_VLN8 + ModelDFS_VLN8$HUM_VLN8 + ModelDFS_VLN8$IOM_VLN8

    #Create a column that sums all pools except IOM (static)
    ModelDFS_VLN8$AllPools_noIOM_VLN8 <- ModelDFS_VLN8$DPM_VLN8 + ModelDFS_VLN8$RPM_VLN8 + ModelDFS_VLN8$BIO_VLN8 + ModelDFS_VLN8$HUM_VLN8

    #Create a column that add the monthly input of C (manure and litter separately)
    ModelDFSL_VLN8 <- merge(ModelDFS_VLN8, MCinputs_VLN8, by = "MNumber")

    ModelDFSL_VLN8$MInput_VLN8 <- ModelDFSL_VLN8$LitterC_VLN8 + ModelDFSL_VLN8$ManureC_VLN8
    #ModelDF_SL$MInput[1] <- 0

    #Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
    ModelDFSL_VLN8$CTails_VLN8 <- ModelDFSL_VLN8$AllPools_noIOM_VLN8 + ModelDFSL_VLN8$MInput_VLN8

    #Create Monthly Accumulated input of C
    ModelDFSL_VLN8$AccumInput_VLN8 = ModelDFSL_VLN8$AccumInput_VLN8=cumsum(ModelDFSL_VLN8$MInput_VLN8)

    #Create Monthly Growths for each carbon pool
    ModelDFSL_VLN8$MGrowth_DPM_VLN8 <- ave(ModelDFSL_VLN8$DPM_VLN8, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLN8$MGrowth_RPM_VLN8 <- ave(ModelDFSL_VLN8$RPM_VLN8, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLN8$MGrowth_BIO_VLN8 <- ave(ModelDFSL_VLN8$BIO_VLN8, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLN8$MGrowth_HUM_VLN8 <- ave(ModelDFSL_VLN8$HUM_VLN8, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLN8$MGrowth_IOM_VLN8 <- ave(ModelDFSL_VLN8$IOM_VLN8, FUN = function(x) c(0, diff(x)))

    #Create column for Monthly and Accumulated C-CO2 emissions
    ModelDFSL_VLN8$M_CCO2_VLN8 <- ModelDFSL_VLN8$MInput_VLN8 - ModelDFSL_VLN8$MGrowth_DPM_VLN8 - ModelDFSL_VLN8$MGrowth_RPM_VLN8 - ModelDFSL_VLN8$MGrowth_BIO_VLN8 - ModelDFSL_VLN8$MGrowth_HUM_VLN8
    ModelDFSL_VLN8$Accum_CCO2_VLN8 <- ModelDFSL_VLN8$AccumInput_VLN8 - ModelDFSL_VLN8$AllPools_noIOM_VLN8

    #Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
    ModelDFSL_VLN8$M_CCO2_VLN8[1] <- 0
    ModelDFSL_VLN8$Accum_CCO2_VLN8[1] <- 0

    #Balance validation
    ModelDFSL_VLN8$Balance_VLN8 <- ModelDFSL_VLN8$AccumInput_VLN8 - ModelDFSL_VLN8$Accum_CCO2_VLN8 - (ModelDFSL_VLN8$DPM_VLN8 + ModelDFSL_VLN8$RPM_VLN8 + ModelDFSL_VLN8$BIO_VLN8 + ModelDFSL_VLN8$HUM_VLN8)

    #Convert C-CO2 emissions into CO2 emissions
    ModelDFSL_VLN8$M_CO2_VLN8 <- ModelDFSL_VLN8$M_CCO2_VLN8 * 44/12
    ModelDFSL_VLN8$Accum_CO2_VLN8 <- ModelDFSL_VLN8$Accum_CCO2_VLN8 * 44/12

    #This model will be called VLN8C because implies a continuous input of C
    ModelDFSL_VLN8C <- ModelDFSL_VLN8

    #Export the dataframe
    write_xlsx(ModelDFSL_VLN8C,"VXC_Models\\ModelDFSL_R_VLN8C.xlsx")

    #Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
    #Create two equal models by using the above general script
    #Create model t=x
    ModelDFSLt0_VLN8 <- ModelDFSL_VLN8 #Create model t=x

    #Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
    ModelDFSLt1_VLN8.1 <- rbind(c(0:0), ModelDFSLt0_VLN8)
    ModelDFSLt1_VLN8.2 <- rbind(c(0:0), ModelDFSLt1_VLN8.1)
    ModelDFSLt1_VLN8.3 <- rbind(c(0:0), ModelDFSLt1_VLN8.2)
    ModelDFSLt1_VLN8.4 <- rbind(c(0:0), ModelDFSLt1_VLN8.3)
    ModelDFSLt1_VLN8.5 <- rbind(c(0:0), ModelDFSLt1_VLN8.4)
    ModelDFSLt1_VLN8.6 <- rbind(c(0:0), ModelDFSLt1_VLN8.5)
    ModelDFSLt1_VLN8.7 <- rbind(c(0:0), ModelDFSLt1_VLN8.6)
    ModelDFSLt1_VLN8.8 <- rbind(c(0:0), ModelDFSLt1_VLN8.7)
    ModelDFSLt1_VLN8.9 <- rbind(c(0:0), ModelDFSLt1_VLN8.8)
    ModelDFSLt1_VLN8.10 <- rbind(c(0:0), ModelDFSLt1_VLN8.9)
    ModelDFSLt1_VLN8.11 <- rbind(c(0:0), ModelDFSLt1_VLN8.10)
    ModelDFSLt1_VLN8.12 <- rbind(c(0:0), ModelDFSLt1_VLN8.11)
    ModelDFSLt1_VLN8.13 <- ModelDFSLt1_VLN8.12[-nrow(ModelDFSLt1_VLN8.12),]
    ModelDFSLt1_VLN8.14 <- ModelDFSLt1_VLN8.13[-nrow(ModelDFSLt1_VLN8.13),]
    ModelDFSLt1_VLN8.15 <- ModelDFSLt1_VLN8.14[-nrow(ModelDFSLt1_VLN8.14),]
    ModelDFSLt1_VLN8.16 <- ModelDFSLt1_VLN8.15[-nrow(ModelDFSLt1_VLN8.15),]
    ModelDFSLt1_VLN8.17 <- ModelDFSLt1_VLN8.16[-nrow(ModelDFSLt1_VLN8.16),]
    ModelDFSLt1_VLN8.18 <- ModelDFSLt1_VLN8.17[-nrow(ModelDFSLt1_VLN8.17),]
    ModelDFSLt1_VLN8.19 <- ModelDFSLt1_VLN8.18[-nrow(ModelDFSLt1_VLN8.18),]
    ModelDFSLt1_VLN8.20 <- ModelDFSLt1_VLN8.19[-nrow(ModelDFSLt1_VLN8.19),]
    ModelDFSLt1_VLN8.21 <- ModelDFSLt1_VLN8.20[-nrow(ModelDFSLt1_VLN8.20),]
    ModelDFSLt1_VLN8.22 <- ModelDFSLt1_VLN8.21[-nrow(ModelDFSLt1_VLN8.21),]
    ModelDFSLt1_VLN8.23 <- ModelDFSLt1_VLN8.22[-nrow(ModelDFSLt1_VLN8.22),]
    ModelDFSLt1_VLN8.24 <- ModelDFSLt1_VLN8.23[-nrow(ModelDFSLt1_VLN8.23),]

    ModelDFSLt1_VLN8 <- ModelDFSLt1_VLN8.24 #Create model t=x+1

    #Subtract model (t=x) - (t=x+1)
    ModelDFSL1y_VLN8 <- ModelDFSLt0_VLN8 - ModelDFSLt1_VLN8

    #Re-do Month Number column because the substraction was also applied to it
    ModelDFSL1y_VLN8$MNumber <- seq(from = 1, to = SimulationLength_months)

    #This model will be called VLN8P because implies a one-off input of C
    ModelDFSL_VLN8P <- ModelDFSL1y_VLN8

    #Export the dataframe
    write_xlsx(ModelDFSL_VLN8P,"VXP_Models\\ModelDFSL_R_VLN8P.xlsx")


    #Plot 3: Interactive Yearly CO2 emissions #
    MY <- 12
    ModelDFSL_VLN8P_YCO2 <- ModelDFSL_VLN8P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VLN8)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLN8P_YCO2) <- c("Year", "Months", "AnnualCO2_VLN_8")

    #Plot 3: Interactive Yearly CO2 emissions considering a delay
    GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
    ModelDFSL_VLN8P_YCO2D <- merge(ModelDFSL_VLN8P_YCO2, GWP100delay, by = "Year")
    ModelDFSL_VLN8P_YCO2D$AnnualCO2D_VLN_8 <- ModelDFSL_VLN8P_YCO2D$AnnualCO2_VLN_8 * ModelDFSL_VLN8P_YCO2D$GWP100


    #Plot 4: Interactive Yearly C emissions #
    MY <- 12
    ModelDFSL_VLN8P_YC <- ModelDFSL_VLN8P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VLN8)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLN8P_YC) <- c("Year", "Months", "CEmissions_VLN_8")

    #Plot 5: Interactive Yearly C tails (remaining C in Soil) #
    MY <- 12
    ModelDFSL_VLN8P_YCT <- ModelDFSL_VLN8P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VLN8)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLN8P_YCT) <- c("Year", "Months", "CTail_VLN_8")

    #Save Dataframes for Plots 3.1, 3.2, 4 and 5
    write_xlsx(ModelDFSL_VLN8P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VLN8P.xlsx") #Yearly CO2 emissions (no delay)
    write_xlsx(ModelDFSL_VLN8P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VLN8P.xlsx") #Yearly CO2 emissions (delay)
    write_xlsx(ModelDFSL_VLN8P_YC,"CEmissions_P\\ModelDFSL_R_CE_VLN8P.xlsx") #Yearly C emissions
    write_xlsx(ModelDFSL_VLN8P_YCT,"CTails_P\\ModelDFSL_R_CT_VLN8P.xlsx") #Yearly C emissions



    #### 9.10 - VLN9) Litter; 90%clay; No Tillage ####
    #The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
    fT_VLN9=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
    fW_VLN9=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                            S.Thick = soil.thick, pClay = clay100*0.9,
                            pE = 1.0, bare = FALSE)$b #Moisture effects per month
    xi.frame_VLN9=data.frame(years,rep(fT_VLN9*fW_VLN9,length.out=length(years)))

    #To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
    Model_VLN9=SoilR::RothCModel(
      t=years, #Simulation Length
      ks=c(k.DPM = 10*NTRM, k.RPM = 0.3*NTRM, k.BIO = 0.66*NTRM, k.HUM = 0.02*NTRM, k.IOM = 0*NTRM), #Decomposition rates for the different pools
      C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
      In=Scalar_LitterCinputs*1, #Amount of litter inputs by time
      FYM = Scalar_ManureCinputs*0, #Amount of Farm Yard Manure by time
      clay=clay100*0.9, #Percent clay in mineral soil
      xi=xi.frame_VLN9) #Loads the model

    Ct_VLN9=getC(Model_VLN9) #Calculates stocks for each pool per month

    #The results can be plotted with the commands
    matplot(years, Ct_VLN9, type="l", lty=1, col=1:5,
            xlab="Time (years)", ylab="C stocks (Mg/ha)")
    legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
           lty=1, col=1:5, bty="n")

    VEC_Lit_VLN9 <- rep(M_Scalar_LitterCinputs*1, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
    VEC_Man_VLN9 <- rep(M_Scalar_ManureCinputs*0, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

    VEC_LitDF_VLN9 <- as.data.frame(VEC_Lit_VLN9) #Converting the Litter vector to a data frame
    VEC_LitDF_VLN9$MNumber <- seq(from = 1, to = SimulationLength_months)
    VEC_ManDF_VLN9 <- as.data.frame(VEC_Man_VLN9) #Converting the Manure vector to a data frame
    VEC_ManDF_VLN9$MNumber <- seq(from = 1, to = SimulationLength_months)

    sapply(VEC_LitDF_VLN9, class) #Check that class is numeric
    sapply(VEC_ManDF_VLN9, class) #Check that class is numeric
    LitterCinputs_VLN9=VEC_LitDF_VLN9   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    ManureCinputs_VLN9=VEC_ManDF_VLN9 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    MCinputs_VLN9 <- merge(LitterCinputs_VLN9, ManureCinputs_VLN9, by = "MNumber")
    MCinputs_VLN9$MInput_VLN9 <- MCinputs_VLN9$VEC_Lit_VLN9 + MCinputs_VLN9$VEC_Man_VLN9

    #Change names of litter and manure columns for more common ones
    colnames(MCinputs_VLN9)[which(names(MCinputs_VLN9) == "VEC_Lit_VLN9")] <- "LitterC_VLN9"
    colnames(MCinputs_VLN9)[which(names(MCinputs_VLN9) == "VEC_Man_VLN9")] <- "ManureC_VLN9"

    #Create a dataframe with the data considering the simulation length
    ModelDF_VLN9 <- as.data.frame(Ct_VLN9)
    colnames(ModelDF_VLN9) <- c('DPM_VLN9','RPM_VLN9','BIO_VLN9', 'HUM_VLN9', 'IOM_VLN9')
    ModelDFS_VLN9 <- ModelDF_VLN9[1:SimulationLength_months, ]

    #Create a column with the number of month of analysis
    ModelDFS_VLN9$MNumber <- seq(from = 1, to = SimulationLength_months)

    #Create a column that sums all pools
    ModelDFS_VLN9$AllPools_VLN9 <- ModelDFS_VLN9$DPM_VLN9 + ModelDFS_VLN9$RPM_VLN9 + ModelDFS_VLN9$BIO_VLN9 + ModelDFS_VLN9$HUM_VLN9 + ModelDFS_VLN9$IOM_VLN9

    #Create a column that sums all pools except IOM (static)
    ModelDFS_VLN9$AllPools_noIOM_VLN9 <- ModelDFS_VLN9$DPM_VLN9 + ModelDFS_VLN9$RPM_VLN9 + ModelDFS_VLN9$BIO_VLN9 + ModelDFS_VLN9$HUM_VLN9

    #Create a column that add the monthly input of C (manure and litter separately)
    ModelDFSL_VLN9 <- merge(ModelDFS_VLN9, MCinputs_VLN9, by = "MNumber")

    ModelDFSL_VLN9$MInput_VLN9 <- ModelDFSL_VLN9$LitterC_VLN9 + ModelDFSL_VLN9$ManureC_VLN9
    #ModelDF_SL$MInput[1] <- 0

    #Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
    ModelDFSL_VLN9$CTails_VLN9 <- ModelDFSL_VLN9$AllPools_noIOM_VLN9 + ModelDFSL_VLN9$MInput_VLN9

    #Create Monthly Accumulated input of C
    ModelDFSL_VLN9$AccumInput_VLN9 = ModelDFSL_VLN9$AccumInput_VLN9=cumsum(ModelDFSL_VLN9$MInput_VLN9)

    #Create Monthly Growths for each carbon pool
    ModelDFSL_VLN9$MGrowth_DPM_VLN9 <- ave(ModelDFSL_VLN9$DPM_VLN9, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLN9$MGrowth_RPM_VLN9 <- ave(ModelDFSL_VLN9$RPM_VLN9, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLN9$MGrowth_BIO_VLN9 <- ave(ModelDFSL_VLN9$BIO_VLN9, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLN9$MGrowth_HUM_VLN9 <- ave(ModelDFSL_VLN9$HUM_VLN9, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLN9$MGrowth_IOM_VLN9 <- ave(ModelDFSL_VLN9$IOM_VLN9, FUN = function(x) c(0, diff(x)))

    #Create column for Monthly and Accumulated C-CO2 emissions
    ModelDFSL_VLN9$M_CCO2_VLN9 <- ModelDFSL_VLN9$MInput_VLN9 - ModelDFSL_VLN9$MGrowth_DPM_VLN9 - ModelDFSL_VLN9$MGrowth_RPM_VLN9 - ModelDFSL_VLN9$MGrowth_BIO_VLN9 - ModelDFSL_VLN9$MGrowth_HUM_VLN9
    ModelDFSL_VLN9$Accum_CCO2_VLN9 <- ModelDFSL_VLN9$AccumInput_VLN9 - ModelDFSL_VLN9$AllPools_noIOM_VLN9

    #Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
    ModelDFSL_VLN9$M_CCO2_VLN9[1] <- 0
    ModelDFSL_VLN9$Accum_CCO2_VLN9[1] <- 0

    #Balance validation
    ModelDFSL_VLN9$Balance_VLN9 <- ModelDFSL_VLN9$AccumInput_VLN9 - ModelDFSL_VLN9$Accum_CCO2_VLN9 - (ModelDFSL_VLN9$DPM_VLN9 + ModelDFSL_VLN9$RPM_VLN9 + ModelDFSL_VLN9$BIO_VLN9 + ModelDFSL_VLN9$HUM_VLN9)

    #Convert C-CO2 emissions into CO2 emissions
    ModelDFSL_VLN9$M_CO2_VLN9 <- ModelDFSL_VLN9$M_CCO2_VLN9 * 44/12
    ModelDFSL_VLN9$Accum_CO2_VLN9 <- ModelDFSL_VLN9$Accum_CCO2_VLN9 * 44/12

    #This model will be called VLN9C because implies a continuous input of C
    ModelDFSL_VLN9C <- ModelDFSL_VLN9

    #Export the dataframe
    write_xlsx(ModelDFSL_VLN9C,"VXC_Models\\ModelDFSL_R_VLN9C.xlsx")

    #Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
    #Create two equal models by using the above general script
    #Create model t=x
    ModelDFSLt0_VLN9 <- ModelDFSL_VLN9 #Create model t=x

    #Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
    ModelDFSLt1_VLN9.1 <- rbind(c(0:0), ModelDFSLt0_VLN9)
    ModelDFSLt1_VLN9.2 <- rbind(c(0:0), ModelDFSLt1_VLN9.1)
    ModelDFSLt1_VLN9.3 <- rbind(c(0:0), ModelDFSLt1_VLN9.2)
    ModelDFSLt1_VLN9.4 <- rbind(c(0:0), ModelDFSLt1_VLN9.3)
    ModelDFSLt1_VLN9.5 <- rbind(c(0:0), ModelDFSLt1_VLN9.4)
    ModelDFSLt1_VLN9.6 <- rbind(c(0:0), ModelDFSLt1_VLN9.5)
    ModelDFSLt1_VLN9.7 <- rbind(c(0:0), ModelDFSLt1_VLN9.6)
    ModelDFSLt1_VLN9.8 <- rbind(c(0:0), ModelDFSLt1_VLN9.7)
    ModelDFSLt1_VLN9.9 <- rbind(c(0:0), ModelDFSLt1_VLN9.8)
    ModelDFSLt1_VLN9.10 <- rbind(c(0:0), ModelDFSLt1_VLN9.9)
    ModelDFSLt1_VLN9.11 <- rbind(c(0:0), ModelDFSLt1_VLN9.10)
    ModelDFSLt1_VLN9.12 <- rbind(c(0:0), ModelDFSLt1_VLN9.11)
    ModelDFSLt1_VLN9.13 <- ModelDFSLt1_VLN9.12[-nrow(ModelDFSLt1_VLN9.12),]
    ModelDFSLt1_VLN9.14 <- ModelDFSLt1_VLN9.13[-nrow(ModelDFSLt1_VLN9.13),]
    ModelDFSLt1_VLN9.15 <- ModelDFSLt1_VLN9.14[-nrow(ModelDFSLt1_VLN9.14),]
    ModelDFSLt1_VLN9.16 <- ModelDFSLt1_VLN9.15[-nrow(ModelDFSLt1_VLN9.15),]
    ModelDFSLt1_VLN9.17 <- ModelDFSLt1_VLN9.16[-nrow(ModelDFSLt1_VLN9.16),]
    ModelDFSLt1_VLN9.18 <- ModelDFSLt1_VLN9.17[-nrow(ModelDFSLt1_VLN9.17),]
    ModelDFSLt1_VLN9.19 <- ModelDFSLt1_VLN9.18[-nrow(ModelDFSLt1_VLN9.18),]
    ModelDFSLt1_VLN9.20 <- ModelDFSLt1_VLN9.19[-nrow(ModelDFSLt1_VLN9.19),]
    ModelDFSLt1_VLN9.21 <- ModelDFSLt1_VLN9.20[-nrow(ModelDFSLt1_VLN9.20),]
    ModelDFSLt1_VLN9.22 <- ModelDFSLt1_VLN9.21[-nrow(ModelDFSLt1_VLN9.21),]
    ModelDFSLt1_VLN9.23 <- ModelDFSLt1_VLN9.22[-nrow(ModelDFSLt1_VLN9.22),]
    ModelDFSLt1_VLN9.24 <- ModelDFSLt1_VLN9.23[-nrow(ModelDFSLt1_VLN9.23),]

    ModelDFSLt1_VLN9 <- ModelDFSLt1_VLN9.24 #Create model t=x+1

    #Subtract model (t=x) - (t=x+1)
    ModelDFSL1y_VLN9 <- ModelDFSLt0_VLN9 - ModelDFSLt1_VLN9

    #Re-do Month Number column because the substraction was also applied to it
    ModelDFSL1y_VLN9$MNumber <- seq(from = 1, to = SimulationLength_months)

    #This model will be called VLN9P because implies a one-off input of C
    ModelDFSL_VLN9P <- ModelDFSL1y_VLN9

    #Export the dataframe
    write_xlsx(ModelDFSL_VLN9P,"VXP_Models\\ModelDFSL_R_VLN9P.xlsx")


    #Plot 3: Interactive Yearly CO2 emissions #
    MY <- 12
    ModelDFSL_VLN9P_YCO2 <- ModelDFSL_VLN9P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VLN9)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLN9P_YCO2) <- c("Year", "Months", "AnnualCO2_VLN_9")

    #Plot 3: Interactive Yearly CO2 emissions considering a delay
    GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
    ModelDFSL_VLN9P_YCO2D <- merge(ModelDFSL_VLN9P_YCO2, GWP100delay, by = "Year")
    ModelDFSL_VLN9P_YCO2D$AnnualCO2D_VLN_9 <- ModelDFSL_VLN9P_YCO2D$AnnualCO2_VLN_9 * ModelDFSL_VLN9P_YCO2D$GWP100


    #Plot 4: Interactive Yearly C emissions #
    MY <- 12
    ModelDFSL_VLN9P_YC <- ModelDFSL_VLN9P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VLN9)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLN9P_YC) <- c("Year", "Months", "CEmissions_VLN_9")

    #Plot 5: Interactive Yearly C tails (remaining C in Soil) #
    MY <- 12
    ModelDFSL_VLN9P_YCT <- ModelDFSL_VLN9P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VLN9)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLN9P_YCT) <- c("Year", "Months", "CTail_VLN_9")

    #Save Dataframes for Plots 3.1, 3.2, 4 and 5
    write_xlsx(ModelDFSL_VLN9P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VLN9P.xlsx") #Yearly CO2 emissions (no delay)
    write_xlsx(ModelDFSL_VLN9P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VLN9P.xlsx") #Yearly CO2 emissions (delay)
    write_xlsx(ModelDFSL_VLN9P_YC,"CEmissions_P\\ModelDFSL_R_CE_VLN9P.xlsx") #Yearly C emissions
    write_xlsx(ModelDFSL_VLN9P_YCT,"CTails_P\\ModelDFSL_R_CT_VLN9P.xlsx") #Yearly C emissions



    #### 9.11 - VLN10) Litter; 100%clay; No Tillage ####
    #The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
    fT_VLN10=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
    fW_VLN10=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                             S.Thick = soil.thick, pClay = clay100,
                             pE = 1.0, bare = FALSE)$b #Moisture effects per month
    xi.frame_VLN10=data.frame(years,rep(fT_VLN10*fW_VLN10,length.out=length(years)))

    #To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
    Model_VLN10=SoilR::RothCModel(
      t=years, #Simulation Length
      ks=c(k.DPM = 10*NTRM, k.RPM = 0.3*NTRM, k.BIO = 0.66*NTRM, k.HUM = 0.02*NTRM, k.IOM = 0*NTRM), #Decomposition rates for the different pools
      C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
      In=Scalar_LitterCinputs*1, #Amount of litter inputs by time
      FYM = Scalar_ManureCinputs*0, #Amount of Farm Yard Manure by time
      clay=clay100, #Percent clay in mineral soil
      xi=xi.frame_VLN10) #Loads the model

    Ct_VLN10=getC(Model_VLN10) #Calculates stocks for each pool per month

    #The results can be plotted with the commands
    matplot(years, Ct_VLN10, type="l", lty=1, col=1:5,
            xlab="Time (years)", ylab="C stocks (Mg/ha)")
    legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
           lty=1, col=1:5, bty="n")

    VEC_Lit_VLN10 <- rep(M_Scalar_LitterCinputs*1, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
    VEC_Man_VLN10 <- rep(M_Scalar_ManureCinputs*0, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

    VEC_LitDF_VLN10 <- as.data.frame(VEC_Lit_VLN10) #Converting the Litter vector to a data frame
    VEC_LitDF_VLN10$MNumber <- seq(from = 1, to = SimulationLength_months)
    VEC_ManDF_VLN10 <- as.data.frame(VEC_Man_VLN10) #Converting the Manure vector to a data frame
    VEC_ManDF_VLN10$MNumber <- seq(from = 1, to = SimulationLength_months)

    sapply(VEC_LitDF_VLN10, class) #Check that class is numeric
    sapply(VEC_ManDF_VLN10, class) #Check that class is numeric
    LitterCinputs_VLN10=VEC_LitDF_VLN10   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    ManureCinputs_VLN10=VEC_ManDF_VLN10 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    MCinputs_VLN10 <- merge(LitterCinputs_VLN10, ManureCinputs_VLN10, by = "MNumber")
    MCinputs_VLN10$MInput_VLN10 <- MCinputs_VLN10$VEC_Lit_VLN10 + MCinputs_VLN10$VEC_Man_VLN10

    #Change names of litter and manure columns for more common ones
    colnames(MCinputs_VLN10)[which(names(MCinputs_VLN10) == "VEC_Lit_VLN10")] <- "LitterC_VLN10"
    colnames(MCinputs_VLN10)[which(names(MCinputs_VLN10) == "VEC_Man_VLN10")] <- "ManureC_VLN10"

    #Create a dataframe with the data considering the simulation length
    ModelDF_VLN10 <- as.data.frame(Ct_VLN10)
    colnames(ModelDF_VLN10) <- c('DPM_VLN10','RPM_VLN10','BIO_VLN10', 'HUM_VLN10', 'IOM_VLN10')
    ModelDFS_VLN10 <- ModelDF_VLN10[1:SimulationLength_months, ]

    #Create a column with the number of month of analysis
    ModelDFS_VLN10$MNumber <- seq(from = 1, to = SimulationLength_months)

    #Create a column that sums all pools
    ModelDFS_VLN10$AllPools_VLN10 <- ModelDFS_VLN10$DPM_VLN10 + ModelDFS_VLN10$RPM_VLN10 + ModelDFS_VLN10$BIO_VLN10 + ModelDFS_VLN10$HUM_VLN10 + ModelDFS_VLN10$IOM_VLN10

    #Create a column that sums all pools except IOM (static)
    ModelDFS_VLN10$AllPools_noIOM_VLN10 <- ModelDFS_VLN10$DPM_VLN10 + ModelDFS_VLN10$RPM_VLN10 + ModelDFS_VLN10$BIO_VLN10 + ModelDFS_VLN10$HUM_VLN10

    #Create a column that add the monthly input of C (manure and litter separately)
    ModelDFSL_VLN10 <- merge(ModelDFS_VLN10, MCinputs_VLN10, by = "MNumber")

    ModelDFSL_VLN10$MInput_VLN10 <- ModelDFSL_VLN10$LitterC_VLN10 + ModelDFSL_VLN10$ManureC_VLN10
    #ModelDF_SL$MInput[1] <- 0

    #Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
    ModelDFSL_VLN10$CTails_VLN10 <- ModelDFSL_VLN10$AllPools_noIOM_VLN10 + ModelDFSL_VLN10$MInput_VLN10

    #Create Monthly Accumulated input of C
    ModelDFSL_VLN10$AccumInput_VLN10 = ModelDFSL_VLN10$AccumInput_VLN10=cumsum(ModelDFSL_VLN10$MInput_VLN10)

    #Create Monthly Growths for each carbon pool
    ModelDFSL_VLN10$MGrowth_DPM_VLN10 <- ave(ModelDFSL_VLN10$DPM_VLN10, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLN10$MGrowth_RPM_VLN10 <- ave(ModelDFSL_VLN10$RPM_VLN10, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLN10$MGrowth_BIO_VLN10 <- ave(ModelDFSL_VLN10$BIO_VLN10, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLN10$MGrowth_HUM_VLN10 <- ave(ModelDFSL_VLN10$HUM_VLN10, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VLN10$MGrowth_IOM_VLN10 <- ave(ModelDFSL_VLN10$IOM_VLN10, FUN = function(x) c(0, diff(x)))

    #Create column for Monthly and Accumulated C-CO2 emissions
    ModelDFSL_VLN10$M_CCO2_VLN10 <- ModelDFSL_VLN10$MInput_VLN10 - ModelDFSL_VLN10$MGrowth_DPM_VLN10 - ModelDFSL_VLN10$MGrowth_RPM_VLN10 - ModelDFSL_VLN10$MGrowth_BIO_VLN10 - ModelDFSL_VLN10$MGrowth_HUM_VLN10
    ModelDFSL_VLN10$Accum_CCO2_VLN10 <- ModelDFSL_VLN10$AccumInput_VLN10 - ModelDFSL_VLN10$AllPools_noIOM_VLN10

    #Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
    ModelDFSL_VLN10$M_CCO2_VLN10[1] <- 0
    ModelDFSL_VLN10$Accum_CCO2_VLN10[1] <- 0

    #Balance validation
    ModelDFSL_VLN10$Balance_VLN10 <- ModelDFSL_VLN10$AccumInput_VLN10 - ModelDFSL_VLN10$Accum_CCO2_VLN10 - (ModelDFSL_VLN10$DPM_VLN10 + ModelDFSL_VLN10$RPM_VLN10 + ModelDFSL_VLN10$BIO_VLN10 + ModelDFSL_VLN10$HUM_VLN10)

    #Convert C-CO2 emissions into CO2 emissions
    ModelDFSL_VLN10$M_CO2_VLN10 <- ModelDFSL_VLN10$M_CCO2_VLN10 * 44/12
    ModelDFSL_VLN10$Accum_CO2_VLN10 <- ModelDFSL_VLN10$Accum_CCO2_VLN10 * 44/12

    #This model will be called VLN10C because implies a continuous input of C
    ModelDFSL_VLN10C <- ModelDFSL_VLN10

    #Export the dataframe
    write_xlsx(ModelDFSL_VLN10C,"VXC_Models\\ModelDFSL_R_VLN10C.xlsx")

    #Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
    #Create two equal models by using the above general script
    #Create model t=x
    ModelDFSLt0_VLN10 <- ModelDFSL_VLN10 #Create model t=x

    #Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
    ModelDFSLt1_VLN10.1 <- rbind(c(0:0), ModelDFSLt0_VLN10)
    ModelDFSLt1_VLN10.2 <- rbind(c(0:0), ModelDFSLt1_VLN10.1)
    ModelDFSLt1_VLN10.3 <- rbind(c(0:0), ModelDFSLt1_VLN10.2)
    ModelDFSLt1_VLN10.4 <- rbind(c(0:0), ModelDFSLt1_VLN10.3)
    ModelDFSLt1_VLN10.5 <- rbind(c(0:0), ModelDFSLt1_VLN10.4)
    ModelDFSLt1_VLN10.6 <- rbind(c(0:0), ModelDFSLt1_VLN10.5)
    ModelDFSLt1_VLN10.7 <- rbind(c(0:0), ModelDFSLt1_VLN10.6)
    ModelDFSLt1_VLN10.8 <- rbind(c(0:0), ModelDFSLt1_VLN10.7)
    ModelDFSLt1_VLN10.9 <- rbind(c(0:0), ModelDFSLt1_VLN10.8)
    ModelDFSLt1_VLN10.10 <- rbind(c(0:0), ModelDFSLt1_VLN10.9)
    ModelDFSLt1_VLN10.11 <- rbind(c(0:0), ModelDFSLt1_VLN10.10)
    ModelDFSLt1_VLN10.12 <- rbind(c(0:0), ModelDFSLt1_VLN10.11)
    ModelDFSLt1_VLN10.13 <- ModelDFSLt1_VLN10.12[-nrow(ModelDFSLt1_VLN10.12),]
    ModelDFSLt1_VLN10.14 <- ModelDFSLt1_VLN10.13[-nrow(ModelDFSLt1_VLN10.13),]
    ModelDFSLt1_VLN10.15 <- ModelDFSLt1_VLN10.14[-nrow(ModelDFSLt1_VLN10.14),]
    ModelDFSLt1_VLN10.16 <- ModelDFSLt1_VLN10.15[-nrow(ModelDFSLt1_VLN10.15),]
    ModelDFSLt1_VLN10.17 <- ModelDFSLt1_VLN10.16[-nrow(ModelDFSLt1_VLN10.16),]
    ModelDFSLt1_VLN10.18 <- ModelDFSLt1_VLN10.17[-nrow(ModelDFSLt1_VLN10.17),]
    ModelDFSLt1_VLN10.19 <- ModelDFSLt1_VLN10.18[-nrow(ModelDFSLt1_VLN10.18),]
    ModelDFSLt1_VLN10.20 <- ModelDFSLt1_VLN10.19[-nrow(ModelDFSLt1_VLN10.19),]
    ModelDFSLt1_VLN10.21 <- ModelDFSLt1_VLN10.20[-nrow(ModelDFSLt1_VLN10.20),]
    ModelDFSLt1_VLN10.22 <- ModelDFSLt1_VLN10.21[-nrow(ModelDFSLt1_VLN10.21),]
    ModelDFSLt1_VLN10.23 <- ModelDFSLt1_VLN10.22[-nrow(ModelDFSLt1_VLN10.22),]
    ModelDFSLt1_VLN10.24 <- ModelDFSLt1_VLN10.23[-nrow(ModelDFSLt1_VLN10.23),]

    ModelDFSLt1_VLN10 <- ModelDFSLt1_VLN10.24 #Create model t=x+1

    #Subtract model (t=x) - (t=x+1)
    ModelDFSL1y_VLN10 <- ModelDFSLt0_VLN10 - ModelDFSLt1_VLN10

    #Re-do Month Number column because the substraction was also applied to it
    ModelDFSL1y_VLN10$MNumber <- seq(from = 1, to = SimulationLength_months)

    #This model will be called VLN10P because implies a one-off input of C
    ModelDFSL_VLN10P <- ModelDFSL1y_VLN10

    #Export the dataframe
    write_xlsx(ModelDFSL_VLN10P,"VXP_Models\\ModelDFSL_R_VLN10P.xlsx")


    #Plot 3: Interactive Yearly CO2 emissions #
    MY <- 12
    ModelDFSL_VLN10P_YCO2 <- ModelDFSL_VLN10P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VLN10)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLN10P_YCO2) <- c("Year", "Months", "AnnualCO2_VLN10")

    #Plot 3: Interactive Yearly CO2 emissions considering a delay
    GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
    ModelDFSL_VLN10P_YCO2D <- merge(ModelDFSL_VLN10P_YCO2, GWP100delay, by = "Year")
    ModelDFSL_VLN10P_YCO2D$AnnualCO2D_VLN10 <- ModelDFSL_VLN10P_YCO2D$AnnualCO2_VLN10 * ModelDFSL_VLN10P_YCO2D$GWP100

    #Plot 4: Interactive Yearly C emissions #
    MY <- 12
    ModelDFSL_VLN10P_YC <- ModelDFSL_VLN10P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VLN10)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLN10P_YC) <- c("Year", "Months", "CEmissions_VLN10")

    #Plot 5: Interactive Yearly C tails (remaining C in Soil) #
    MY <- 12
    ModelDFSL_VLN10P_YCT <- ModelDFSL_VLN10P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VLN10)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VLN10P_YCT) <- c("Year", "Months", "CTail_VLN10")

    #Save Dataframes for Plots 3.1, 3.2, 4 and 5
    write_xlsx(ModelDFSL_VLN10P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VLN10P.xlsx") #Yearly CO2 emissions (no delay)
    write_xlsx(ModelDFSL_VLN10P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VLN10P.xlsx") #Yearly CO2 emissions (delay)
    write_xlsx(ModelDFSL_VLN10P_YC,"CEmissions_P\\ModelDFSL_R_CE_VLN10P.xlsx") #Yearly C emissions
    write_xlsx(ModelDFSL_VLN10P_YCT,"CTails_P\\ModelDFSL_R_CT_VLN10P.xlsx") #Yearly C emissions

  }
  else if(Scope == "VMC"){
    #### 10) Model Combinations - Manure; Conventional Tillage, 0-100% (+10%) Clay ####
    #### 10.1 - VMC0) Manure; 0%clay; Conventional tillage ####
    #The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
    fT_VMC0=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
    fW_VMC0=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                            S.Thick = soil.thick, pClay = clay0,
                            pE = 1.0, bare = FALSE)$b #Moisture effects per month
    xi.frame_VMC0=data.frame(years,rep(fT_VMC0*fW_VMC0,length.out=length(years)))

    #To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
    Model_VMC0=SoilR::RothCModel(
      t=years, #Simulation Length
      ks=c(k.DPM = 10*CTRM, k.RPM = 0.3*CTRM, k.BIO = 0.66*CTRM, k.HUM = 0.02*CTRM, k.IOM = 0*CTRM), #Decomposition rates for the different pools
      C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
      In=Scalar_LitterCinputs*0, #Amount of litter inputs by time
      FYM = Scalar_ManureCinputs*1, #Amount of Farm Yard Manure by time
      clay=clay0, #Percent clay in mineral soil
      xi=xi.frame_VMC0) #Loads the model

    Ct_VMC0=getC(Model_VMC0) #Calculates stocks for each pool per month

    VEC_Lit_VMC0 <- rep(M_Scalar_LitterCinputs*0, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
    VEC_Man_VMC0 <- rep(M_Scalar_ManureCinputs*1, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

    VEC_LitDF_VMC0 <- as.data.frame(VEC_Lit_VMC0) #Converting the Litter vector to a data frame
    VEC_LitDF_VMC0$MNumber <- seq(from = 1, to = SimulationLength_months)
    VEC_ManDF_VMC0 <- as.data.frame(VEC_Man_VMC0) #Converting the Manure vector to a data frame
    VEC_ManDF_VMC0$MNumber <- seq(from = 1, to = SimulationLength_months)

    sapply(VEC_LitDF_VMC0, class) #Check that class is numeric
    sapply(VEC_ManDF_VMC0, class) #Check that class is numeric
    LitterCinputs_VMC0=VEC_LitDF_VMC0   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    ManureCinputs_VMC0=VEC_ManDF_VMC0 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    MCinputs_VMC0 <- merge(LitterCinputs_VMC0, ManureCinputs_VMC0, by = "MNumber")
    MCinputs_VMC0$MInput_VMC0 <- MCinputs_VMC0$VEC_Lit_VMC0 + MCinputs_VMC0$VEC_Man_VMC0

    #Change names of litter and manure columns for more common ones
    colnames(MCinputs_VMC0)[which(names(MCinputs_VMC0) == "VEC_Lit_VMC0")] <- "LitterC_VMC0"
    colnames(MCinputs_VMC0)[which(names(MCinputs_VMC0) == "VEC_Man_VMC0")] <- "ManureC_VMC0"

    #Create a dataframe with the data considering the simulation length
    ModelDF_VMC0 <- as.data.frame(Ct_VMC0)
    colnames(ModelDF_VMC0) <- c('DPM_VMC0','RPM_VMC0','BIO_VMC0', 'HUM_VMC0', 'IOM_VMC0')
    ModelDFS_VMC0 <- ModelDF_VMC0[1:SimulationLength_months, ]

    #Create a column with the number of month of analysis
    ModelDFS_VMC0$MNumber <- seq(from = 1, to = SimulationLength_months)

    #Create a column that sums all pools
    ModelDFS_VMC0$AllPools_VMC0 <- ModelDFS_VMC0$DPM_VMC0 + ModelDFS_VMC0$RPM_VMC0 + ModelDFS_VMC0$BIO_VMC0 + ModelDFS_VMC0$HUM_VMC0 + ModelDFS_VMC0$IOM_VMC0

    #Create a column that sums all pools except IOM (static)
    ModelDFS_VMC0$AllPools_noIOM_VMC0 <- ModelDFS_VMC0$DPM_VMC0 + ModelDFS_VMC0$RPM_VMC0 + ModelDFS_VMC0$BIO_VMC0 + ModelDFS_VMC0$HUM_VMC0

    #Create a column that add the monthly input of C (manure and litter separately)
    ModelDFSL_VMC0 <- merge(ModelDFS_VMC0, MCinputs_VMC0, by = "MNumber")

    ModelDFSL_VMC0$MInput_VMC0 <- ModelDFSL_VMC0$LitterC_VMC0 + ModelDFSL_VMC0$ManureC_VMC0
    #ModelDF_SL$MInput[1] <- 0

    #Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
    ModelDFSL_VMC0$CTails_VMC0 <- ModelDFSL_VMC0$AllPools_noIOM_VMC0 + ModelDFSL_VMC0$MInput_VMC0

    #Create Monthly Accumulated input of C
    ModelDFSL_VMC0$AccumInput_VMC0 = ModelDFSL_VMC0$AccumInput_VMC0=cumsum(ModelDFSL_VMC0$MInput_VMC0)

    #Create Monthly Growths for each carbon pool
    ModelDFSL_VMC0$MGrowth_DPM_VMC0 <- ave(ModelDFSL_VMC0$DPM_VMC0, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMC0$MGrowth_RPM_VMC0 <- ave(ModelDFSL_VMC0$RPM_VMC0, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMC0$MGrowth_BIO_VMC0 <- ave(ModelDFSL_VMC0$BIO_VMC0, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMC0$MGrowth_HUM_VMC0 <- ave(ModelDFSL_VMC0$HUM_VMC0, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMC0$MGrowth_IOM_VMC0 <- ave(ModelDFSL_VMC0$IOM_VMC0, FUN = function(x) c(0, diff(x)))

    #Create column for Monthly and Accumulated C-CO2 emissions
    ModelDFSL_VMC0$M_CCO2_VMC0 <- ModelDFSL_VMC0$MInput_VMC0 - ModelDFSL_VMC0$MGrowth_DPM_VMC0 - ModelDFSL_VMC0$MGrowth_RPM_VMC0 - ModelDFSL_VMC0$MGrowth_BIO_VMC0 - ModelDFSL_VMC0$MGrowth_HUM_VMC0
    ModelDFSL_VMC0$Accum_CCO2_VMC0 <- ModelDFSL_VMC0$AccumInput_VMC0 - ModelDFSL_VMC0$AllPools_noIOM_VMC0

    #Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
    ModelDFSL_VMC0$M_CCO2_VMC0[1] <- 0
    ModelDFSL_VMC0$Accum_CCO2_VMC0[1] <- 0

    #Balance validation
    ModelDFSL_VMC0$Balance_VMC0 <- ModelDFSL_VMC0$AccumInput_VMC0 - ModelDFSL_VMC0$Accum_CCO2_VMC0 - (ModelDFSL_VMC0$DPM_VMC0 + ModelDFSL_VMC0$RPM_VMC0 + ModelDFSL_VMC0$BIO_VMC0 + ModelDFSL_VMC0$HUM_VMC0)

    #Convert C-CO2 emissions into CO2 emissions
    ModelDFSL_VMC0$M_CO2_VMC0 <- ModelDFSL_VMC0$M_CCO2_VMC0 * 44/12
    ModelDFSL_VMC0$Accum_CO2_VMC0 <- ModelDFSL_VMC0$Accum_CCO2_VMC0 * 44/12

    #This model will be called VMC0C because implies a continuous input of C
    ModelDFSL_VMC0C <- ModelDFSL_VMC0

    #Export the dataframe
    write_xlsx(ModelDFSL_VMC0C,"VXC_Models\\ModelDFSL_R_VMC0C.xlsx")

    #Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
    #Create two equal models by using the above general script
    #Create model t=x
    ModelDFSLt0_VMC0 <- ModelDFSL_VMC0 #Create model t=x

    #Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
    ModelDFSLt1_VMC0.1 <- rbind(c(0:0), ModelDFSLt0_VMC0)
    ModelDFSLt1_VMC0.2 <- rbind(c(0:0), ModelDFSLt1_VMC0.1)
    ModelDFSLt1_VMC0.3 <- rbind(c(0:0), ModelDFSLt1_VMC0.2)
    ModelDFSLt1_VMC0.4 <- rbind(c(0:0), ModelDFSLt1_VMC0.3)
    ModelDFSLt1_VMC0.5 <- rbind(c(0:0), ModelDFSLt1_VMC0.4)
    ModelDFSLt1_VMC0.6 <- rbind(c(0:0), ModelDFSLt1_VMC0.5)
    ModelDFSLt1_VMC0.7 <- rbind(c(0:0), ModelDFSLt1_VMC0.6)
    ModelDFSLt1_VMC0.8 <- rbind(c(0:0), ModelDFSLt1_VMC0.7)
    ModelDFSLt1_VMC0.9 <- rbind(c(0:0), ModelDFSLt1_VMC0.8)
    ModelDFSLt1_VMC0.10 <- rbind(c(0:0), ModelDFSLt1_VMC0.9)
    ModelDFSLt1_VMC0.11 <- rbind(c(0:0), ModelDFSLt1_VMC0.10)
    ModelDFSLt1_VMC0.12 <- rbind(c(0:0), ModelDFSLt1_VMC0.11)
    ModelDFSLt1_VMC0.13 <- ModelDFSLt1_VMC0.12[-nrow(ModelDFSLt1_VMC0.12),]
    ModelDFSLt1_VMC0.14 <- ModelDFSLt1_VMC0.13[-nrow(ModelDFSLt1_VMC0.13),]
    ModelDFSLt1_VMC0.15 <- ModelDFSLt1_VMC0.14[-nrow(ModelDFSLt1_VMC0.14),]
    ModelDFSLt1_VMC0.16 <- ModelDFSLt1_VMC0.15[-nrow(ModelDFSLt1_VMC0.15),]
    ModelDFSLt1_VMC0.17 <- ModelDFSLt1_VMC0.16[-nrow(ModelDFSLt1_VMC0.16),]
    ModelDFSLt1_VMC0.18 <- ModelDFSLt1_VMC0.17[-nrow(ModelDFSLt1_VMC0.17),]
    ModelDFSLt1_VMC0.19 <- ModelDFSLt1_VMC0.18[-nrow(ModelDFSLt1_VMC0.18),]
    ModelDFSLt1_VMC0.20 <- ModelDFSLt1_VMC0.19[-nrow(ModelDFSLt1_VMC0.19),]
    ModelDFSLt1_VMC0.21 <- ModelDFSLt1_VMC0.20[-nrow(ModelDFSLt1_VMC0.20),]
    ModelDFSLt1_VMC0.22 <- ModelDFSLt1_VMC0.21[-nrow(ModelDFSLt1_VMC0.21),]
    ModelDFSLt1_VMC0.23 <- ModelDFSLt1_VMC0.22[-nrow(ModelDFSLt1_VMC0.22),]
    ModelDFSLt1_VMC0.24 <- ModelDFSLt1_VMC0.23[-nrow(ModelDFSLt1_VMC0.23),]

    ModelDFSLt1_VMC0 <- ModelDFSLt1_VMC0.24 #Create model t=x+1

    #Subtract model (t=x) - (t=x+1)
    ModelDFSL1y_VMC0 <- ModelDFSLt0_VMC0 - ModelDFSLt1_VMC0

    #Re-do Month Number column because the substraction was also applied to it
    ModelDFSL1y_VMC0$MNumber <- seq(from = 1, to = SimulationLength_months)

    #This model will be called VMC0P because implies a one-off input of C
    ModelDFSL_VMC0P <- ModelDFSL1y_VMC0

    #Export the dataframe
    write_xlsx(ModelDFSL_VMC0P,"VXP_Models\\ModelDFSL_R_VMC0P.xlsx")

    #Plot 3.1: Interactive Yearly CO2 emissions #
    MY <- 12
    ModelDFSL_VMC0P_YCO2 <- ModelDFSL_VMC0P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VMC0)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMC0P_YCO2) <- c("Year", "Months", "AnnualCO2_VMC_0")

    #Plot 3.2: Interactive Yearly CO2 emissions considering a delay
    GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
    ModelDFSL_VMC0P_YCO2D <- merge(ModelDFSL_VMC0P_YCO2, GWP100delay, by = "Year")
    ModelDFSL_VMC0P_YCO2D$AnnualCO2D_VMC_0 <- ModelDFSL_VMC0P_YCO2D$AnnualCO2_VMC_0 * ModelDFSL_VMC0P_YCO2D$GWP100

    #Plot 4: Interactive Yearly C emissions #
    MY <- 12
    ModelDFSL_VMC0P_YC <- ModelDFSL_VMC0P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VMC0)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMC0P_YC) <- c("Year", "Months", "CEmissions_VMC_0")

    #Plot 5: Interactive Yearly C tails (remaining C in Soil) #
    MY <- 12
    ModelDFSL_VMC0P_YCT <- ModelDFSL_VMC0P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VMC0)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMC0P_YCT) <- c("Year", "Months", "CTail_VMC_0")

    #Save Dataframes for Plots 3.1, 3.2, 4 and 5
    write_xlsx(ModelDFSL_VMC0P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VMC0P.xlsx") #Yearly CO2 emissions (no delay)
    write_xlsx(ModelDFSL_VMC0P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VMC0P.xlsx") #Yearly CO2 emissions (delay)
    write_xlsx(ModelDFSL_VMC0P_YC,"CEmissions_P\\ModelDFSL_R_CE_VMC0P.xlsx") #Yearly C emissions
    write_xlsx(ModelDFSL_VMC0P_YCT,"CTails_P\\ModelDFSL_R_CT_VMC0P.xlsx") #Yearly C emissions


    #### 10.2 - VMC1) Manure; 10%clay; Conventional tillage ####
    #The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
    fT_VMC1=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
    fW_VMC1=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                            S.Thick = soil.thick, pClay = clay100*0.1,
                            pE = 1.0, bare = FALSE)$b #Moisture effects per month
    xi.frame_VMC1=data.frame(years,rep(fT_VMC1*fW_VMC1,length.out=length(years)))

    #To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
    Model_VMC1=SoilR::RothCModel(
      t=years, #Simulation Length
      ks=c(k.DPM = 10*CTRM, k.RPM = 0.3*CTRM, k.BIO = 0.66*CTRM, k.HUM = 0.02*CTRM, k.IOM = 0*CTRM), #Decomposition rates for the different pools
      C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
      In=Scalar_LitterCinputs*0, #Amount of litter inputs by time
      FYM = Scalar_ManureCinputs*1, #Amount of Farm Yard Manure by time
      clay=clay100*0.1, #Percent clay in mineral soil
      xi=xi.frame_VMC1) #Loads the model

    Ct_VMC1=getC(Model_VMC1) #Calculates stocks for each pool per month

    #The results can be plotted with the commands
    matplot(years, Ct_VMC1, type="l", lty=1, col=1:5,
            xlab="Time (years)", ylab="C stocks (Mg/ha)")
    legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
           lty=1, col=1:5, bty="n")

    VEC_Lit_VMC1 <- rep(M_Scalar_LitterCinputs*0, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
    VEC_Man_VMC1 <- rep(M_Scalar_ManureCinputs*1, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

    VEC_LitDF_VMC1 <- as.data.frame(VEC_Lit_VMC1) #Converting the Litter vector to a data frame
    VEC_LitDF_VMC1$MNumber <- seq(from = 1, to = SimulationLength_months)
    VEC_ManDF_VMC1 <- as.data.frame(VEC_Man_VMC1) #Converting the Manure vector to a data frame
    VEC_ManDF_VMC1$MNumber <- seq(from = 1, to = SimulationLength_months)

    sapply(VEC_LitDF_VMC1, class) #Check that class is numeric
    sapply(VEC_ManDF_VMC1, class) #Check that class is numeric
    LitterCinputs_VMC1=VEC_LitDF_VMC1   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    ManureCinputs_VMC1=VEC_ManDF_VMC1 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    MCinputs_VMC1 <- merge(LitterCinputs_VMC1, ManureCinputs_VMC1, by = "MNumber")
    MCinputs_VMC1$MInput_VMC1 <- MCinputs_VMC1$VEC_Lit_VMC1 + MCinputs_VMC1$VEC_Man_VMC1

    #Change names of litter and manure columns for more common ones
    colnames(MCinputs_VMC1)[which(names(MCinputs_VMC1) == "VEC_Lit_VMC1")] <- "LitterC_VMC1"
    colnames(MCinputs_VMC1)[which(names(MCinputs_VMC1) == "VEC_Man_VMC1")] <- "ManureC_VMC1"

    #Create a dataframe with the data considering the simulation length
    ModelDF_VMC1 <- as.data.frame(Ct_VMC1)
    colnames(ModelDF_VMC1) <- c('DPM_VMC1','RPM_VMC1','BIO_VMC1', 'HUM_VMC1', 'IOM_VMC1')
    ModelDFS_VMC1 <- ModelDF_VMC1[1:SimulationLength_months, ]

    #Create a column with the number of month of analysis
    ModelDFS_VMC1$MNumber <- seq(from = 1, to = SimulationLength_months)

    #Create a column that sums all pools
    ModelDFS_VMC1$AllPools_VMC1 <- ModelDFS_VMC1$DPM_VMC1 + ModelDFS_VMC1$RPM_VMC1 + ModelDFS_VMC1$BIO_VMC1 + ModelDFS_VMC1$HUM_VMC1 + ModelDFS_VMC1$IOM_VMC1

    #Create a column that sums all pools except IOM (static)
    ModelDFS_VMC1$AllPools_noIOM_VMC1 <- ModelDFS_VMC1$DPM_VMC1 + ModelDFS_VMC1$RPM_VMC1 + ModelDFS_VMC1$BIO_VMC1 + ModelDFS_VMC1$HUM_VMC1

    #Create a column that add the monthly input of C (manure and litter separately)
    ModelDFSL_VMC1 <- merge(ModelDFS_VMC1, MCinputs_VMC1, by = "MNumber")

    ModelDFSL_VMC1$MInput_VMC1 <- ModelDFSL_VMC1$LitterC_VMC1 + ModelDFSL_VMC1$ManureC_VMC1
    #ModelDF_SL$MInput[1] <- 0

    #Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
    ModelDFSL_VMC1$CTails_VMC1 <- ModelDFSL_VMC1$AllPools_noIOM_VMC1 + ModelDFSL_VMC1$MInput_VMC1

    #Create Monthly Accumulated input of C
    ModelDFSL_VMC1$AccumInput_VMC1 = ModelDFSL_VMC1$AccumInput_VMC1=cumsum(ModelDFSL_VMC1$MInput_VMC1)

    #Create Monthly Growths for each carbon pool
    ModelDFSL_VMC1$MGrowth_DPM_VMC1 <- ave(ModelDFSL_VMC1$DPM_VMC1, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMC1$MGrowth_RPM_VMC1 <- ave(ModelDFSL_VMC1$RPM_VMC1, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMC1$MGrowth_BIO_VMC1 <- ave(ModelDFSL_VMC1$BIO_VMC1, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMC1$MGrowth_HUM_VMC1 <- ave(ModelDFSL_VMC1$HUM_VMC1, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMC1$MGrowth_IOM_VMC1 <- ave(ModelDFSL_VMC1$IOM_VMC1, FUN = function(x) c(0, diff(x)))

    #Create column for Monthly and Accumulated C-CO2 emissions
    ModelDFSL_VMC1$M_CCO2_VMC1 <- ModelDFSL_VMC1$MInput_VMC1 - ModelDFSL_VMC1$MGrowth_DPM_VMC1 - ModelDFSL_VMC1$MGrowth_RPM_VMC1 - ModelDFSL_VMC1$MGrowth_BIO_VMC1 - ModelDFSL_VMC1$MGrowth_HUM_VMC1
    ModelDFSL_VMC1$Accum_CCO2_VMC1 <- ModelDFSL_VMC1$AccumInput_VMC1 - ModelDFSL_VMC1$AllPools_noIOM_VMC1

    #Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
    ModelDFSL_VMC1$M_CCO2_VMC1[1] <- 0
    ModelDFSL_VMC1$Accum_CCO2_VMC1[1] <- 0

    #Balance validation
    ModelDFSL_VMC1$Balance_VMC1 <- ModelDFSL_VMC1$AccumInput_VMC1 - ModelDFSL_VMC1$Accum_CCO2_VMC1 - (ModelDFSL_VMC1$DPM_VMC1 + ModelDFSL_VMC1$RPM_VMC1 + ModelDFSL_VMC1$BIO_VMC1 + ModelDFSL_VMC1$HUM_VMC1)

    #Convert C-CO2 emissions into CO2 emissions
    ModelDFSL_VMC1$M_CO2_VMC1 <- ModelDFSL_VMC1$M_CCO2_VMC1 * 44/12
    ModelDFSL_VMC1$Accum_CO2_VMC1 <- ModelDFSL_VMC1$Accum_CCO2_VMC1 * 44/12

    #This model will be called VMC1C because implies a continuous input of C
    ModelDFSL_VMC1C <- ModelDFSL_VMC1

    #Export the dataframe
    write_xlsx(ModelDFSL_VMC1C,"VXC_Models\\ModelDFSL_R_VMC1C.xlsx")

    #Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
    #Create two equal models by using the above general script
    #Create model t=x
    ModelDFSLt0_VMC1 <- ModelDFSL_VMC1 #Create model t=x

    #Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
    ModelDFSLt1_VMC1.1 <- rbind(c(0:0), ModelDFSLt0_VMC1)
    ModelDFSLt1_VMC1.2 <- rbind(c(0:0), ModelDFSLt1_VMC1.1)
    ModelDFSLt1_VMC1.3 <- rbind(c(0:0), ModelDFSLt1_VMC1.2)
    ModelDFSLt1_VMC1.4 <- rbind(c(0:0), ModelDFSLt1_VMC1.3)
    ModelDFSLt1_VMC1.5 <- rbind(c(0:0), ModelDFSLt1_VMC1.4)
    ModelDFSLt1_VMC1.6 <- rbind(c(0:0), ModelDFSLt1_VMC1.5)
    ModelDFSLt1_VMC1.7 <- rbind(c(0:0), ModelDFSLt1_VMC1.6)
    ModelDFSLt1_VMC1.8 <- rbind(c(0:0), ModelDFSLt1_VMC1.7)
    ModelDFSLt1_VMC1.9 <- rbind(c(0:0), ModelDFSLt1_VMC1.8)
    ModelDFSLt1_VMC1.10 <- rbind(c(0:0), ModelDFSLt1_VMC1.9)
    ModelDFSLt1_VMC1.11 <- rbind(c(0:0), ModelDFSLt1_VMC1.10)
    ModelDFSLt1_VMC1.12 <- rbind(c(0:0), ModelDFSLt1_VMC1.11)
    ModelDFSLt1_VMC1.13 <- ModelDFSLt1_VMC1.12[-nrow(ModelDFSLt1_VMC1.12),]
    ModelDFSLt1_VMC1.14 <- ModelDFSLt1_VMC1.13[-nrow(ModelDFSLt1_VMC1.13),]
    ModelDFSLt1_VMC1.15 <- ModelDFSLt1_VMC1.14[-nrow(ModelDFSLt1_VMC1.14),]
    ModelDFSLt1_VMC1.16 <- ModelDFSLt1_VMC1.15[-nrow(ModelDFSLt1_VMC1.15),]
    ModelDFSLt1_VMC1.17 <- ModelDFSLt1_VMC1.16[-nrow(ModelDFSLt1_VMC1.16),]
    ModelDFSLt1_VMC1.18 <- ModelDFSLt1_VMC1.17[-nrow(ModelDFSLt1_VMC1.17),]
    ModelDFSLt1_VMC1.19 <- ModelDFSLt1_VMC1.18[-nrow(ModelDFSLt1_VMC1.18),]
    ModelDFSLt1_VMC1.20 <- ModelDFSLt1_VMC1.19[-nrow(ModelDFSLt1_VMC1.19),]
    ModelDFSLt1_VMC1.21 <- ModelDFSLt1_VMC1.20[-nrow(ModelDFSLt1_VMC1.20),]
    ModelDFSLt1_VMC1.22 <- ModelDFSLt1_VMC1.21[-nrow(ModelDFSLt1_VMC1.21),]
    ModelDFSLt1_VMC1.23 <- ModelDFSLt1_VMC1.22[-nrow(ModelDFSLt1_VMC1.22),]
    ModelDFSLt1_VMC1.24 <- ModelDFSLt1_VMC1.23[-nrow(ModelDFSLt1_VMC1.23),]

    ModelDFSLt1_VMC1 <- ModelDFSLt1_VMC1.24 #Create model t=x+1

    #Subtract model (t=x) - (t=x+1)
    ModelDFSL1y_VMC1 <- ModelDFSLt0_VMC1 - ModelDFSLt1_VMC1

    #Re-do Month Number column because the substraction was also applied to it
    ModelDFSL1y_VMC1$MNumber <- seq(from = 1, to = SimulationLength_months)

    #This model will be called VMC1P because implies a one-off input of C
    ModelDFSL_VMC1P <- ModelDFSL1y_VMC1

    #Export the dataframe
    write_xlsx(ModelDFSL_VMC1P,"VXP_Models\\ModelDFSL_R_VMC1P.xlsx")

    #Plot 3: Interactive Yearly CO2 emissions #
    MY <- 12
    ModelDFSL_VMC1P_YCO2 <- ModelDFSL_VMC1P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VMC1)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMC1P_YCO2) <- c("Year", "Months", "AnnualCO2_VMC_1")

    #Plot 3: Interactive Yearly CO2 emissions considering a delay
    GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
    ModelDFSL_VMC1P_YCO2D <- merge(ModelDFSL_VMC1P_YCO2, GWP100delay, by = "Year")
    ModelDFSL_VMC1P_YCO2D$AnnualCO2D_VMC_1 <- ModelDFSL_VMC1P_YCO2D$AnnualCO2_VMC_1 * ModelDFSL_VMC1P_YCO2D$GWP100

    #Plot 4: Interactive Yearly C emissions #
    MY <- 12
    ModelDFSL_VMC1P_YC <- ModelDFSL_VMC1P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VMC1)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMC1P_YC) <- c("Year", "Months", "CEmissions_VMC_1")

    #Plot 5: Interactive Yearly C tails (remaining C in Soil) #
    MY <- 12
    ModelDFSL_VMC1P_YCT <- ModelDFSL_VMC1P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VMC1)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMC1P_YCT) <- c("Year", "Months", "CTail_VMC_1")

    #Save Dataframes for Plots 3.1, 3.2, 4 and 5
    write_xlsx(ModelDFSL_VMC1P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VMC1P.xlsx") #Yearly CO2 emissions (no delay)
    write_xlsx(ModelDFSL_VMC1P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VMC1P.xlsx") #Yearly CO2 emissions (delay)
    write_xlsx(ModelDFSL_VMC1P_YC,"CEmissions_P\\ModelDFSL_R_CE_VMC1P.xlsx") #Yearly C emissions
    write_xlsx(ModelDFSL_VMC1P_YCT,"CTails_P\\ModelDFSL_R_CT_VMC1P.xlsx") #Yearly C emissions



    #### 10.3 - VMC2) Manure; 20%clay; Conventional tillage ####
    #The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
    fT_VMC2=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
    fW_VMC2=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                            S.Thick = soil.thick, pClay = clay100*0.2,
                            pE = 1.0, bare = FALSE)$b #Moisture effects per month
    xi.frame_VMC2=data.frame(years,rep(fT_VMC2*fW_VMC2,length.out=length(years)))

    #To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
    Model_VMC2=SoilR::RothCModel(
      t=years, #Simulation Length
      ks=c(k.DPM = 10*CTRM, k.RPM = 0.3*CTRM, k.BIO = 0.66*CTRM, k.HUM = 0.02*CTRM, k.IOM = 0*CTRM), #Decomposition rates for the different pools
      C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
      In=Scalar_LitterCinputs*0, #Amount of litter inputs by time
      FYM = Scalar_ManureCinputs*1, #Amount of Farm Yard Manure by time
      clay=clay100*0.2, #Percent clay in mineral soil
      xi=xi.frame_VMC2) #Loads the model

    Ct_VMC2=getC(Model_VMC2) #Calculates stocks for each pool per month

    #The results can be plotted with the commands
    matplot(years, Ct_VMC2, type="l", lty=1, col=1:5,
            xlab="Time (years)", ylab="C stocks (Mg/ha)")
    legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
           lty=1, col=1:5, bty="n")

    VEC_Lit_VMC2 <- rep(M_Scalar_LitterCinputs*0, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
    VEC_Man_VMC2 <- rep(M_Scalar_ManureCinputs*1, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

    VEC_LitDF_VMC2 <- as.data.frame(VEC_Lit_VMC2) #Converting the Litter vector to a data frame
    VEC_LitDF_VMC2$MNumber <- seq(from = 1, to = SimulationLength_months)
    VEC_ManDF_VMC2 <- as.data.frame(VEC_Man_VMC2) #Converting the Manure vector to a data frame
    VEC_ManDF_VMC2$MNumber <- seq(from = 1, to = SimulationLength_months)

    sapply(VEC_LitDF_VMC2, class) #Check that class is numeric
    sapply(VEC_ManDF_VMC2, class) #Check that class is numeric
    LitterCinputs_VMC2=VEC_LitDF_VMC2   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    ManureCinputs_VMC2=VEC_ManDF_VMC2 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    MCinputs_VMC2 <- merge(LitterCinputs_VMC2, ManureCinputs_VMC2, by = "MNumber")
    MCinputs_VMC2$MInput_VMC2 <- MCinputs_VMC2$VEC_Lit_VMC2 + MCinputs_VMC2$VEC_Man_VMC2

    #Change names of litter and manure columns for more common ones
    colnames(MCinputs_VMC2)[which(names(MCinputs_VMC2) == "VEC_Lit_VMC2")] <- "LitterC_VMC2"
    colnames(MCinputs_VMC2)[which(names(MCinputs_VMC2) == "VEC_Man_VMC2")] <- "ManureC_VMC2"

    #Create a dataframe with the data considering the simulation length
    ModelDF_VMC2 <- as.data.frame(Ct_VMC2)
    colnames(ModelDF_VMC2) <- c('DPM_VMC2','RPM_VMC2','BIO_VMC2', 'HUM_VMC2', 'IOM_VMC2')
    ModelDFS_VMC2 <- ModelDF_VMC2[1:SimulationLength_months, ]

    #Create a column with the number of month of analysis
    ModelDFS_VMC2$MNumber <- seq(from = 1, to = SimulationLength_months)

    #Create a column that sums all pools
    ModelDFS_VMC2$AllPools_VMC2 <- ModelDFS_VMC2$DPM_VMC2 + ModelDFS_VMC2$RPM_VMC2 + ModelDFS_VMC2$BIO_VMC2 + ModelDFS_VMC2$HUM_VMC2 + ModelDFS_VMC2$IOM_VMC2

    #Create a column that sums all pools except IOM (static)
    ModelDFS_VMC2$AllPools_noIOM_VMC2 <- ModelDFS_VMC2$DPM_VMC2 + ModelDFS_VMC2$RPM_VMC2 + ModelDFS_VMC2$BIO_VMC2 + ModelDFS_VMC2$HUM_VMC2

    #Create a column that add the monthly input of C (manure and litter separately)
    ModelDFSL_VMC2 <- merge(ModelDFS_VMC2, MCinputs_VMC2, by = "MNumber")

    ModelDFSL_VMC2$MInput_VMC2 <- ModelDFSL_VMC2$LitterC_VMC2 + ModelDFSL_VMC2$ManureC_VMC2
    #ModelDF_SL$MInput[1] <- 0

    #Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
    ModelDFSL_VMC2$CTails_VMC2 <- ModelDFSL_VMC2$AllPools_noIOM_VMC2 + ModelDFSL_VMC2$MInput_VMC2

    #Create Monthly Accumulated input of C
    ModelDFSL_VMC2$AccumInput_VMC2 = ModelDFSL_VMC2$AccumInput_VMC2=cumsum(ModelDFSL_VMC2$MInput_VMC2)

    #Create Monthly Growths for each carbon pool
    ModelDFSL_VMC2$MGrowth_DPM_VMC2 <- ave(ModelDFSL_VMC2$DPM_VMC2, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMC2$MGrowth_RPM_VMC2 <- ave(ModelDFSL_VMC2$RPM_VMC2, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMC2$MGrowth_BIO_VMC2 <- ave(ModelDFSL_VMC2$BIO_VMC2, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMC2$MGrowth_HUM_VMC2 <- ave(ModelDFSL_VMC2$HUM_VMC2, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMC2$MGrowth_IOM_VMC2 <- ave(ModelDFSL_VMC2$IOM_VMC2, FUN = function(x) c(0, diff(x)))

    #Create column for Monthly and Accumulated C-CO2 emissions
    ModelDFSL_VMC2$M_CCO2_VMC2 <- ModelDFSL_VMC2$MInput_VMC2 - ModelDFSL_VMC2$MGrowth_DPM_VMC2 - ModelDFSL_VMC2$MGrowth_RPM_VMC2 - ModelDFSL_VMC2$MGrowth_BIO_VMC2 - ModelDFSL_VMC2$MGrowth_HUM_VMC2
    ModelDFSL_VMC2$Accum_CCO2_VMC2 <- ModelDFSL_VMC2$AccumInput_VMC2 - ModelDFSL_VMC2$AllPools_noIOM_VMC2

    #Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
    ModelDFSL_VMC2$M_CCO2_VMC2[1] <- 0
    ModelDFSL_VMC2$Accum_CCO2_VMC2[1] <- 0

    #Balance validation
    ModelDFSL_VMC2$Balance_VMC2 <- ModelDFSL_VMC2$AccumInput_VMC2 - ModelDFSL_VMC2$Accum_CCO2_VMC2 - (ModelDFSL_VMC2$DPM_VMC2 + ModelDFSL_VMC2$RPM_VMC2 + ModelDFSL_VMC2$BIO_VMC2 + ModelDFSL_VMC2$HUM_VMC2)

    #Convert C-CO2 emissions into CO2 emissions
    ModelDFSL_VMC2$M_CO2_VMC2 <- ModelDFSL_VMC2$M_CCO2_VMC2 * 44/12
    ModelDFSL_VMC2$Accum_CO2_VMC2 <- ModelDFSL_VMC2$Accum_CCO2_VMC2 * 44/12

    #This model will be called VMC2C because implies a continuous input of C
    ModelDFSL_VMC2C <- ModelDFSL_VMC2

    #Export the dataframe
    write_xlsx(ModelDFSL_VMC2C,"VXC_Models\\ModelDFSL_R_VMC2C.xlsx")

    #Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
    #Create two equal models by using the above general script
    #Create model t=x
    ModelDFSLt0_VMC2 <- ModelDFSL_VMC2 #Create model t=x

    #Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
    ModelDFSLt1_VMC2.1 <- rbind(c(0:0), ModelDFSLt0_VMC2)
    ModelDFSLt1_VMC2.2 <- rbind(c(0:0), ModelDFSLt1_VMC2.1)
    ModelDFSLt1_VMC2.3 <- rbind(c(0:0), ModelDFSLt1_VMC2.2)
    ModelDFSLt1_VMC2.4 <- rbind(c(0:0), ModelDFSLt1_VMC2.3)
    ModelDFSLt1_VMC2.5 <- rbind(c(0:0), ModelDFSLt1_VMC2.4)
    ModelDFSLt1_VMC2.6 <- rbind(c(0:0), ModelDFSLt1_VMC2.5)
    ModelDFSLt1_VMC2.7 <- rbind(c(0:0), ModelDFSLt1_VMC2.6)
    ModelDFSLt1_VMC2.8 <- rbind(c(0:0), ModelDFSLt1_VMC2.7)
    ModelDFSLt1_VMC2.9 <- rbind(c(0:0), ModelDFSLt1_VMC2.8)
    ModelDFSLt1_VMC2.10 <- rbind(c(0:0), ModelDFSLt1_VMC2.9)
    ModelDFSLt1_VMC2.11 <- rbind(c(0:0), ModelDFSLt1_VMC2.10)
    ModelDFSLt1_VMC2.12 <- rbind(c(0:0), ModelDFSLt1_VMC2.11)
    ModelDFSLt1_VMC2.13 <- ModelDFSLt1_VMC2.12[-nrow(ModelDFSLt1_VMC2.12),]
    ModelDFSLt1_VMC2.14 <- ModelDFSLt1_VMC2.13[-nrow(ModelDFSLt1_VMC2.13),]
    ModelDFSLt1_VMC2.15 <- ModelDFSLt1_VMC2.14[-nrow(ModelDFSLt1_VMC2.14),]
    ModelDFSLt1_VMC2.16 <- ModelDFSLt1_VMC2.15[-nrow(ModelDFSLt1_VMC2.15),]
    ModelDFSLt1_VMC2.17 <- ModelDFSLt1_VMC2.16[-nrow(ModelDFSLt1_VMC2.16),]
    ModelDFSLt1_VMC2.18 <- ModelDFSLt1_VMC2.17[-nrow(ModelDFSLt1_VMC2.17),]
    ModelDFSLt1_VMC2.19 <- ModelDFSLt1_VMC2.18[-nrow(ModelDFSLt1_VMC2.18),]
    ModelDFSLt1_VMC2.20 <- ModelDFSLt1_VMC2.19[-nrow(ModelDFSLt1_VMC2.19),]
    ModelDFSLt1_VMC2.21 <- ModelDFSLt1_VMC2.20[-nrow(ModelDFSLt1_VMC2.20),]
    ModelDFSLt1_VMC2.22 <- ModelDFSLt1_VMC2.21[-nrow(ModelDFSLt1_VMC2.21),]
    ModelDFSLt1_VMC2.23 <- ModelDFSLt1_VMC2.22[-nrow(ModelDFSLt1_VMC2.22),]
    ModelDFSLt1_VMC2.24 <- ModelDFSLt1_VMC2.23[-nrow(ModelDFSLt1_VMC2.23),]

    ModelDFSLt1_VMC2 <- ModelDFSLt1_VMC2.24 #Create model t=x+1

    #Subtract model (t=x) - (t=x+1)
    ModelDFSL1y_VMC2 <- ModelDFSLt0_VMC2 - ModelDFSLt1_VMC2

    #Re-do Month Number column because the substraction was also applied to it
    ModelDFSL1y_VMC2$MNumber <- seq(from = 1, to = SimulationLength_months)

    #This model will be called VMC2P because implies a one-off input of C
    ModelDFSL_VMC2P <- ModelDFSL1y_VMC2

    #Export the dataframe
    write_xlsx(ModelDFSL_VMC2P,"VXP_Models\\ModelDFSL_R_VMC2P.xlsx")

    #Plot 3: Interactive Yearly CO2 emissions #
    MY <- 12
    ModelDFSL_VMC2P_YCO2 <- ModelDFSL_VMC2P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VMC2)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMC2P_YCO2) <- c("Year", "Months", "AnnualCO2_VMC_2")

    #Plot 3: Interactive Yearly CO2 emissions considering a delay
    GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
    ModelDFSL_VMC2P_YCO2D <- merge(ModelDFSL_VMC2P_YCO2, GWP100delay, by = "Year")
    ModelDFSL_VMC2P_YCO2D$AnnualCO2D_VMC_2 <- ModelDFSL_VMC2P_YCO2D$AnnualCO2_VMC_2 * ModelDFSL_VMC2P_YCO2D$GWP100

    #Plot 4: Interactive Yearly C emissions #
    MY <- 12
    ModelDFSL_VMC2P_YC <- ModelDFSL_VMC2P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VMC2)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMC2P_YC) <- c("Year", "Months", "CEmissions_VMC_2")

    #Plot 5: Interactive Yearly C tails (remaining C in Soil) #
    MY <- 12
    ModelDFSL_VMC2P_YCT <- ModelDFSL_VMC2P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VMC2)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMC2P_YCT) <- c("Year", "Months", "CTail_VMC_2")

    #Save Dataframes for Plots 3.1, 3.2, 4 and 5
    write_xlsx(ModelDFSL_VMC2P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VMC2P.xlsx") #Yearly CO2 emissions (no delay)
    write_xlsx(ModelDFSL_VMC2P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VMC2P.xlsx") #Yearly CO2 emissions (delay)
    write_xlsx(ModelDFSL_VMC2P_YC,"CEmissions_P\\ModelDFSL_R_CE_VMC2P.xlsx") #Yearly C emissions
    write_xlsx(ModelDFSL_VMC2P_YCT,"CTails_P\\ModelDFSL_R_CT_VMC2P.xlsx") #Yearly C emissions



    #### 10.4 - VMC3) Manure; 30%clay; Conventional tillage ####
    #The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
    fT_VMC3=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
    fW_VMC3=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                            S.Thick = soil.thick, pClay = clay100*0.3,
                            pE = 1.0, bare = FALSE)$b #Moisture effects per month
    xi.frame_VMC3=data.frame(years,rep(fT_VMC3*fW_VMC3,length.out=length(years)))

    #To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
    Model_VMC3=SoilR::RothCModel(
      t=years, #Simulation Length
      ks=c(k.DPM = 10*CTRM, k.RPM = 0.3*CTRM, k.BIO = 0.66*CTRM, k.HUM = 0.02*CTRM, k.IOM = 0*CTRM), #Decomposition rates for the different pools
      C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
      In=Scalar_LitterCinputs*0, #Amount of litter inputs by time
      FYM = Scalar_ManureCinputs*1, #Amount of Farm Yard Manure by time
      clay=clay100*0.3, #Percent clay in mineral soil
      xi=xi.frame_VMC3) #Loads the model

    Ct_VMC3=getC(Model_VMC3) #Calculates stocks for each pool per month

    #The results can be plotted with the commands
    matplot(years, Ct_VMC3, type="l", lty=1, col=1:5,
            xlab="Time (years)", ylab="C stocks (Mg/ha)")
    legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
           lty=1, col=1:5, bty="n")

    VEC_Lit_VMC3 <- rep(M_Scalar_LitterCinputs*0, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
    VEC_Man_VMC3 <- rep(M_Scalar_ManureCinputs*1, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

    VEC_LitDF_VMC3 <- as.data.frame(VEC_Lit_VMC3) #Converting the Litter vector to a data frame
    VEC_LitDF_VMC3$MNumber <- seq(from = 1, to = SimulationLength_months)
    VEC_ManDF_VMC3 <- as.data.frame(VEC_Man_VMC3) #Converting the Manure vector to a data frame
    VEC_ManDF_VMC3$MNumber <- seq(from = 1, to = SimulationLength_months)

    sapply(VEC_LitDF_VMC3, class) #Check that class is numeric
    sapply(VEC_ManDF_VMC3, class) #Check that class is numeric
    LitterCinputs_VMC3=VEC_LitDF_VMC3   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    ManureCinputs_VMC3=VEC_ManDF_VMC3 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    MCinputs_VMC3 <- merge(LitterCinputs_VMC3, ManureCinputs_VMC3, by = "MNumber")
    MCinputs_VMC3$MInput_VMC3 <- MCinputs_VMC3$VEC_Lit_VMC3 + MCinputs_VMC3$VEC_Man_VMC3

    #Change names of litter and manure columns for more common ones
    colnames(MCinputs_VMC3)[which(names(MCinputs_VMC3) == "VEC_Lit_VMC3")] <- "LitterC_VMC3"
    colnames(MCinputs_VMC3)[which(names(MCinputs_VMC3) == "VEC_Man_VMC3")] <- "ManureC_VMC3"

    #Create a dataframe with the data considering the simulation length
    ModelDF_VMC3 <- as.data.frame(Ct_VMC3)
    colnames(ModelDF_VMC3) <- c('DPM_VMC3','RPM_VMC3','BIO_VMC3', 'HUM_VMC3', 'IOM_VMC3')
    ModelDFS_VMC3 <- ModelDF_VMC3[1:SimulationLength_months, ]

    #Create a column with the number of month of analysis
    ModelDFS_VMC3$MNumber <- seq(from = 1, to = SimulationLength_months)

    #Create a column that sums all pools
    ModelDFS_VMC3$AllPools_VMC3 <- ModelDFS_VMC3$DPM_VMC3 + ModelDFS_VMC3$RPM_VMC3 + ModelDFS_VMC3$BIO_VMC3 + ModelDFS_VMC3$HUM_VMC3 + ModelDFS_VMC3$IOM_VMC3

    #Create a column that sums all pools except IOM (static)
    ModelDFS_VMC3$AllPools_noIOM_VMC3 <- ModelDFS_VMC3$DPM_VMC3 + ModelDFS_VMC3$RPM_VMC3 + ModelDFS_VMC3$BIO_VMC3 + ModelDFS_VMC3$HUM_VMC3

    #Create a column that add the monthly input of C (manure and litter separately)
    ModelDFSL_VMC3 <- merge(ModelDFS_VMC3, MCinputs_VMC3, by = "MNumber")

    ModelDFSL_VMC3$MInput_VMC3 <- ModelDFSL_VMC3$LitterC_VMC3 + ModelDFSL_VMC3$ManureC_VMC3
    #ModelDF_SL$MInput[1] <- 0

    #Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
    ModelDFSL_VMC3$CTails_VMC3 <- ModelDFSL_VMC3$AllPools_noIOM_VMC3 + ModelDFSL_VMC3$MInput_VMC3

    #Create Monthly Accumulated input of C
    ModelDFSL_VMC3$AccumInput_VMC3 = ModelDFSL_VMC3$AccumInput_VMC3=cumsum(ModelDFSL_VMC3$MInput_VMC3)

    #Create Monthly Growths for each carbon pool
    ModelDFSL_VMC3$MGrowth_DPM_VMC3 <- ave(ModelDFSL_VMC3$DPM_VMC3, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMC3$MGrowth_RPM_VMC3 <- ave(ModelDFSL_VMC3$RPM_VMC3, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMC3$MGrowth_BIO_VMC3 <- ave(ModelDFSL_VMC3$BIO_VMC3, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMC3$MGrowth_HUM_VMC3 <- ave(ModelDFSL_VMC3$HUM_VMC3, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMC3$MGrowth_IOM_VMC3 <- ave(ModelDFSL_VMC3$IOM_VMC3, FUN = function(x) c(0, diff(x)))

    #Create column for Monthly and Accumulated C-CO2 emissions
    ModelDFSL_VMC3$M_CCO2_VMC3 <- ModelDFSL_VMC3$MInput_VMC3 - ModelDFSL_VMC3$MGrowth_DPM_VMC3 - ModelDFSL_VMC3$MGrowth_RPM_VMC3 - ModelDFSL_VMC3$MGrowth_BIO_VMC3 - ModelDFSL_VMC3$MGrowth_HUM_VMC3
    ModelDFSL_VMC3$Accum_CCO2_VMC3 <- ModelDFSL_VMC3$AccumInput_VMC3 - ModelDFSL_VMC3$AllPools_noIOM_VMC3

    #Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
    ModelDFSL_VMC3$M_CCO2_VMC3[1] <- 0
    ModelDFSL_VMC3$Accum_CCO2_VMC3[1] <- 0

    #Balance validation
    ModelDFSL_VMC3$Balance_VMC3 <- ModelDFSL_VMC3$AccumInput_VMC3 - ModelDFSL_VMC3$Accum_CCO2_VMC3 - (ModelDFSL_VMC3$DPM_VMC3 + ModelDFSL_VMC3$RPM_VMC3 + ModelDFSL_VMC3$BIO_VMC3 + ModelDFSL_VMC3$HUM_VMC3)

    #Convert C-CO2 emissions into CO2 emissions
    ModelDFSL_VMC3$M_CO2_VMC3 <- ModelDFSL_VMC3$M_CCO2_VMC3 * 44/12
    ModelDFSL_VMC3$Accum_CO2_VMC3 <- ModelDFSL_VMC3$Accum_CCO2_VMC3 * 44/12

    #This model will be called VMC3C because implies a continuous input of C
    ModelDFSL_VMC3C <- ModelDFSL_VMC3

    #Export the dataframe
    write_xlsx(ModelDFSL_VMC3C,"VXC_Models\\ModelDFSL_R_VMC3C.xlsx")

    #Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
    #Create two equal models by using the above general script
    #Create model t=x
    ModelDFSLt0_VMC3 <- ModelDFSL_VMC3 #Create model t=x

    #Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
    ModelDFSLt1_VMC3.1 <- rbind(c(0:0), ModelDFSLt0_VMC3)
    ModelDFSLt1_VMC3.2 <- rbind(c(0:0), ModelDFSLt1_VMC3.1)
    ModelDFSLt1_VMC3.3 <- rbind(c(0:0), ModelDFSLt1_VMC3.2)
    ModelDFSLt1_VMC3.4 <- rbind(c(0:0), ModelDFSLt1_VMC3.3)
    ModelDFSLt1_VMC3.5 <- rbind(c(0:0), ModelDFSLt1_VMC3.4)
    ModelDFSLt1_VMC3.6 <- rbind(c(0:0), ModelDFSLt1_VMC3.5)
    ModelDFSLt1_VMC3.7 <- rbind(c(0:0), ModelDFSLt1_VMC3.6)
    ModelDFSLt1_VMC3.8 <- rbind(c(0:0), ModelDFSLt1_VMC3.7)
    ModelDFSLt1_VMC3.9 <- rbind(c(0:0), ModelDFSLt1_VMC3.8)
    ModelDFSLt1_VMC3.10 <- rbind(c(0:0), ModelDFSLt1_VMC3.9)
    ModelDFSLt1_VMC3.11 <- rbind(c(0:0), ModelDFSLt1_VMC3.10)
    ModelDFSLt1_VMC3.12 <- rbind(c(0:0), ModelDFSLt1_VMC3.11)
    ModelDFSLt1_VMC3.13 <- ModelDFSLt1_VMC3.12[-nrow(ModelDFSLt1_VMC3.12),]
    ModelDFSLt1_VMC3.14 <- ModelDFSLt1_VMC3.13[-nrow(ModelDFSLt1_VMC3.13),]
    ModelDFSLt1_VMC3.15 <- ModelDFSLt1_VMC3.14[-nrow(ModelDFSLt1_VMC3.14),]
    ModelDFSLt1_VMC3.16 <- ModelDFSLt1_VMC3.15[-nrow(ModelDFSLt1_VMC3.15),]
    ModelDFSLt1_VMC3.17 <- ModelDFSLt1_VMC3.16[-nrow(ModelDFSLt1_VMC3.16),]
    ModelDFSLt1_VMC3.18 <- ModelDFSLt1_VMC3.17[-nrow(ModelDFSLt1_VMC3.17),]
    ModelDFSLt1_VMC3.19 <- ModelDFSLt1_VMC3.18[-nrow(ModelDFSLt1_VMC3.18),]
    ModelDFSLt1_VMC3.20 <- ModelDFSLt1_VMC3.19[-nrow(ModelDFSLt1_VMC3.19),]
    ModelDFSLt1_VMC3.21 <- ModelDFSLt1_VMC3.20[-nrow(ModelDFSLt1_VMC3.20),]
    ModelDFSLt1_VMC3.22 <- ModelDFSLt1_VMC3.21[-nrow(ModelDFSLt1_VMC3.21),]
    ModelDFSLt1_VMC3.23 <- ModelDFSLt1_VMC3.22[-nrow(ModelDFSLt1_VMC3.22),]
    ModelDFSLt1_VMC3.24 <- ModelDFSLt1_VMC3.23[-nrow(ModelDFSLt1_VMC3.23),]

    ModelDFSLt1_VMC3 <- ModelDFSLt1_VMC3.24 #Create model t=x+1

    #Subtract model (t=x) - (t=x+1)
    ModelDFSL1y_VMC3 <- ModelDFSLt0_VMC3 - ModelDFSLt1_VMC3

    #Re-do Month Number column because the substraction was also applied to it
    ModelDFSL1y_VMC3$MNumber <- seq(from = 1, to = SimulationLength_months)

    #This model will be called VMC3P because implies a one-off input of C
    ModelDFSL_VMC3P <- ModelDFSL1y_VMC3

    #Export the dataframe
    write_xlsx(ModelDFSL_VMC3P,"VXP_Models\\ModelDFSL_R_VMC3P.xlsx")

    #Plot 3: Interactive Yearly CO2 emissions #
    MY <- 12
    ModelDFSL_VMC3P_YCO2 <- ModelDFSL_VMC3P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VMC3)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMC3P_YCO2) <- c("Year", "Months", "AnnualCO2_VMC_3")

    #Plot 3: Interactive Yearly CO2 emissions considering a delay
    GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
    ModelDFSL_VMC3P_YCO2D <- merge(ModelDFSL_VMC3P_YCO2, GWP100delay, by = "Year")
    ModelDFSL_VMC3P_YCO2D$AnnualCO2D_VMC_3 <- ModelDFSL_VMC3P_YCO2D$AnnualCO2_VMC_3 * ModelDFSL_VMC3P_YCO2D$GWP100

    #Plot 4: Interactive Yearly C emissions #
    MY <- 12
    ModelDFSL_VMC3P_YC <- ModelDFSL_VMC3P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VMC3)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMC3P_YC) <- c("Year", "Months", "CEmissions_VMC_3")

    #Plot 5: Interactive Yearly C tails (remaining C in Soil) #
    MY <- 12
    ModelDFSL_VMC3P_YCT <- ModelDFSL_VMC3P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VMC3)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMC3P_YCT) <- c("Year", "Months", "CTail_VMC_3")

    #Save Dataframes for Plots 3.1, 3.2, 4 and 5
    write_xlsx(ModelDFSL_VMC3P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VMC3P.xlsx") #Yearly CO2 emissions (no delay)
    write_xlsx(ModelDFSL_VMC3P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VMC3P.xlsx") #Yearly CO2 emissions (delay)
    write_xlsx(ModelDFSL_VMC3P_YC,"CEmissions_P\\ModelDFSL_R_CE_VMC3P.xlsx") #Yearly C emissions
    write_xlsx(ModelDFSL_VMC3P_YCT,"CTails_P\\ModelDFSL_R_CT_VMC3P.xlsx") #Yearly C emissions



    #### 10.5 - VMC4) Manure; 40%clay; Conventional tillage ####
    #The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
    fT_VMC4=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
    fW_VMC4=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                            S.Thick = soil.thick, pClay = clay100*0.4,
                            pE = 1.0, bare = FALSE)$b #Moisture effects per month
    xi.frame_VMC4=data.frame(years,rep(fT_VMC4*fW_VMC4,length.out=length(years)))

    #To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
    Model_VMC4=SoilR::RothCModel(
      t=years, #Simulation Length
      ks=c(k.DPM = 10*CTRM, k.RPM = 0.3*CTRM, k.BIO = 0.66*CTRM, k.HUM = 0.02*CTRM, k.IOM = 0*CTRM), #Decomposition rates for the different pools
      C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
      In=Scalar_LitterCinputs*0, #Amount of litter inputs by time
      FYM = Scalar_ManureCinputs*1, #Amount of Farm Yard Manure by time
      clay=clay100*0.4, #Percent clay in mineral soil
      xi=xi.frame_VMC4) #Loads the model

    Ct_VMC4=getC(Model_VMC4) #Calculates stocks for each pool per month

    #The results can be plotted with the commands
    matplot(years, Ct_VMC4, type="l", lty=1, col=1:5,
            xlab="Time (years)", ylab="C stocks (Mg/ha)")
    legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
           lty=1, col=1:5, bty="n")

    VEC_Lit_VMC4 <- rep(M_Scalar_LitterCinputs*0, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
    VEC_Man_VMC4 <- rep(M_Scalar_ManureCinputs*1, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

    VEC_LitDF_VMC4 <- as.data.frame(VEC_Lit_VMC4) #Converting the Litter vector to a data frame
    VEC_LitDF_VMC4$MNumber <- seq(from = 1, to = SimulationLength_months)
    VEC_ManDF_VMC4 <- as.data.frame(VEC_Man_VMC4) #Converting the Manure vector to a data frame
    VEC_ManDF_VMC4$MNumber <- seq(from = 1, to = SimulationLength_months)

    sapply(VEC_LitDF_VMC4, class) #Check that class is numeric
    sapply(VEC_ManDF_VMC4, class) #Check that class is numeric
    LitterCinputs_VMC4=VEC_LitDF_VMC4   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    ManureCinputs_VMC4=VEC_ManDF_VMC4 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    MCinputs_VMC4 <- merge(LitterCinputs_VMC4, ManureCinputs_VMC4, by = "MNumber")
    MCinputs_VMC4$MInput_VMC4 <- MCinputs_VMC4$VEC_Lit_VMC4 + MCinputs_VMC4$VEC_Man_VMC4

    #Change names of litter and manure columns for more common ones
    colnames(MCinputs_VMC4)[which(names(MCinputs_VMC4) == "VEC_Lit_VMC4")] <- "LitterC_VMC4"
    colnames(MCinputs_VMC4)[which(names(MCinputs_VMC4) == "VEC_Man_VMC4")] <- "ManureC_VMC4"

    #Create a dataframe with the data considering the simulation length
    ModelDF_VMC4 <- as.data.frame(Ct_VMC4)
    colnames(ModelDF_VMC4) <- c('DPM_VMC4','RPM_VMC4','BIO_VMC4', 'HUM_VMC4', 'IOM_VMC4')
    ModelDFS_VMC4 <- ModelDF_VMC4[1:SimulationLength_months, ]

    #Create a column with the number of month of analysis
    ModelDFS_VMC4$MNumber <- seq(from = 1, to = SimulationLength_months)

    #Create a column that sums all pools
    ModelDFS_VMC4$AllPools_VMC4 <- ModelDFS_VMC4$DPM_VMC4 + ModelDFS_VMC4$RPM_VMC4 + ModelDFS_VMC4$BIO_VMC4 + ModelDFS_VMC4$HUM_VMC4 + ModelDFS_VMC4$IOM_VMC4

    #Create a column that sums all pools except IOM (static)
    ModelDFS_VMC4$AllPools_noIOM_VMC4 <- ModelDFS_VMC4$DPM_VMC4 + ModelDFS_VMC4$RPM_VMC4 + ModelDFS_VMC4$BIO_VMC4 + ModelDFS_VMC4$HUM_VMC4

    #Create a column that add the monthly input of C (manure and litter separately)
    ModelDFSL_VMC4 <- merge(ModelDFS_VMC4, MCinputs_VMC4, by = "MNumber")

    ModelDFSL_VMC4$MInput_VMC4 <- ModelDFSL_VMC4$LitterC_VMC4 + ModelDFSL_VMC4$ManureC_VMC4
    #ModelDF_SL$MInput[1] <- 0

    #Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
    ModelDFSL_VMC4$CTails_VMC4 <- ModelDFSL_VMC4$AllPools_noIOM_VMC4 + ModelDFSL_VMC4$MInput_VMC4

    #Create Monthly Accumulated input of C
    ModelDFSL_VMC4$AccumInput_VMC4 = ModelDFSL_VMC4$AccumInput_VMC4=cumsum(ModelDFSL_VMC4$MInput_VMC4)

    #Create Monthly Growths for each carbon pool
    ModelDFSL_VMC4$MGrowth_DPM_VMC4 <- ave(ModelDFSL_VMC4$DPM_VMC4, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMC4$MGrowth_RPM_VMC4 <- ave(ModelDFSL_VMC4$RPM_VMC4, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMC4$MGrowth_BIO_VMC4 <- ave(ModelDFSL_VMC4$BIO_VMC4, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMC4$MGrowth_HUM_VMC4 <- ave(ModelDFSL_VMC4$HUM_VMC4, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMC4$MGrowth_IOM_VMC4 <- ave(ModelDFSL_VMC4$IOM_VMC4, FUN = function(x) c(0, diff(x)))

    #Create column for Monthly and Accumulated C-CO2 emissions
    ModelDFSL_VMC4$M_CCO2_VMC4 <- ModelDFSL_VMC4$MInput_VMC4 - ModelDFSL_VMC4$MGrowth_DPM_VMC4 - ModelDFSL_VMC4$MGrowth_RPM_VMC4 - ModelDFSL_VMC4$MGrowth_BIO_VMC4 - ModelDFSL_VMC4$MGrowth_HUM_VMC4
    ModelDFSL_VMC4$Accum_CCO2_VMC4 <- ModelDFSL_VMC4$AccumInput_VMC4 - ModelDFSL_VMC4$AllPools_noIOM_VMC4

    #Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
    ModelDFSL_VMC4$M_CCO2_VMC4[1] <- 0
    ModelDFSL_VMC4$Accum_CCO2_VMC4[1] <- 0

    #Balance validation
    ModelDFSL_VMC4$Balance_VMC4 <- ModelDFSL_VMC4$AccumInput_VMC4 - ModelDFSL_VMC4$Accum_CCO2_VMC4 - (ModelDFSL_VMC4$DPM_VMC4 + ModelDFSL_VMC4$RPM_VMC4 + ModelDFSL_VMC4$BIO_VMC4 + ModelDFSL_VMC4$HUM_VMC4)

    #Convert C-CO2 emissions into CO2 emissions
    ModelDFSL_VMC4$M_CO2_VMC4 <- ModelDFSL_VMC4$M_CCO2_VMC4 * 44/12
    ModelDFSL_VMC4$Accum_CO2_VMC4 <- ModelDFSL_VMC4$Accum_CCO2_VMC4 * 44/12

    #This model will be called VMC4C because implies a continuous input of C
    ModelDFSL_VMC4C <- ModelDFSL_VMC4

    #Export the dataframe
    write_xlsx(ModelDFSL_VMC4C,"VXC_Models\\ModelDFSL_R_VMC4C.xlsx")

    #Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
    #Create two equal models by using the above general script
    #Create model t=x
    ModelDFSLt0_VMC4 <- ModelDFSL_VMC4 #Create model t=x

    #Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
    ModelDFSLt1_VMC4.1 <- rbind(c(0:0), ModelDFSLt0_VMC4)
    ModelDFSLt1_VMC4.2 <- rbind(c(0:0), ModelDFSLt1_VMC4.1)
    ModelDFSLt1_VMC4.3 <- rbind(c(0:0), ModelDFSLt1_VMC4.2)
    ModelDFSLt1_VMC4.4 <- rbind(c(0:0), ModelDFSLt1_VMC4.3)
    ModelDFSLt1_VMC4.5 <- rbind(c(0:0), ModelDFSLt1_VMC4.4)
    ModelDFSLt1_VMC4.6 <- rbind(c(0:0), ModelDFSLt1_VMC4.5)
    ModelDFSLt1_VMC4.7 <- rbind(c(0:0), ModelDFSLt1_VMC4.6)
    ModelDFSLt1_VMC4.8 <- rbind(c(0:0), ModelDFSLt1_VMC4.7)
    ModelDFSLt1_VMC4.9 <- rbind(c(0:0), ModelDFSLt1_VMC4.8)
    ModelDFSLt1_VMC4.10 <- rbind(c(0:0), ModelDFSLt1_VMC4.9)
    ModelDFSLt1_VMC4.11 <- rbind(c(0:0), ModelDFSLt1_VMC4.10)
    ModelDFSLt1_VMC4.12 <- rbind(c(0:0), ModelDFSLt1_VMC4.11)
    ModelDFSLt1_VMC4.13 <- ModelDFSLt1_VMC4.12[-nrow(ModelDFSLt1_VMC4.12),]
    ModelDFSLt1_VMC4.14 <- ModelDFSLt1_VMC4.13[-nrow(ModelDFSLt1_VMC4.13),]
    ModelDFSLt1_VMC4.15 <- ModelDFSLt1_VMC4.14[-nrow(ModelDFSLt1_VMC4.14),]
    ModelDFSLt1_VMC4.16 <- ModelDFSLt1_VMC4.15[-nrow(ModelDFSLt1_VMC4.15),]
    ModelDFSLt1_VMC4.17 <- ModelDFSLt1_VMC4.16[-nrow(ModelDFSLt1_VMC4.16),]
    ModelDFSLt1_VMC4.18 <- ModelDFSLt1_VMC4.17[-nrow(ModelDFSLt1_VMC4.17),]
    ModelDFSLt1_VMC4.19 <- ModelDFSLt1_VMC4.18[-nrow(ModelDFSLt1_VMC4.18),]
    ModelDFSLt1_VMC4.20 <- ModelDFSLt1_VMC4.19[-nrow(ModelDFSLt1_VMC4.19),]
    ModelDFSLt1_VMC4.21 <- ModelDFSLt1_VMC4.20[-nrow(ModelDFSLt1_VMC4.20),]
    ModelDFSLt1_VMC4.22 <- ModelDFSLt1_VMC4.21[-nrow(ModelDFSLt1_VMC4.21),]
    ModelDFSLt1_VMC4.23 <- ModelDFSLt1_VMC4.22[-nrow(ModelDFSLt1_VMC4.22),]
    ModelDFSLt1_VMC4.24 <- ModelDFSLt1_VMC4.23[-nrow(ModelDFSLt1_VMC4.23),]

    ModelDFSLt1_VMC4 <- ModelDFSLt1_VMC4.24 #Create model t=x+1

    #Subtract model (t=x) - (t=x+1)
    ModelDFSL1y_VMC4 <- ModelDFSLt0_VMC4 - ModelDFSLt1_VMC4

    #Re-do Month Number column because the substraction was also applied to it
    ModelDFSL1y_VMC4$MNumber <- seq(from = 1, to = SimulationLength_months)

    #This model will be called VMC4P because implies a one-off input of C
    ModelDFSL_VMC4P <- ModelDFSL1y_VMC4

    #Export the dataframe
    write_xlsx(ModelDFSL_VMC4P,"VXP_Models\\ModelDFSL_R_VMC4P.xlsx")

    #Plot 3: Interactive Yearly CO2 emissions #
    MY <- 12
    ModelDFSL_VMC4P_YCO2 <- ModelDFSL_VMC4P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VMC4)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMC4P_YCO2) <- c("Year", "Months", "AnnualCO2_VMC_4")

    #Plot 3: Interactive Yearly CO2 emissions considering a delay
    GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
    ModelDFSL_VMC4P_YCO2D <- merge(ModelDFSL_VMC4P_YCO2, GWP100delay, by = "Year")
    ModelDFSL_VMC4P_YCO2D$AnnualCO2D_VMC_4 <- ModelDFSL_VMC4P_YCO2D$AnnualCO2_VMC_4 * ModelDFSL_VMC4P_YCO2D$GWP100

    #Plot 4: Interactive Yearly C emissions #
    MY <- 12
    ModelDFSL_VMC4P_YC <- ModelDFSL_VMC4P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VMC4)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMC4P_YC) <- c("Year", "Months", "CEmissions_VMC_4")

    #Plot 5: Interactive Yearly C tails (remaining C in Soil) #
    MY <- 12
    ModelDFSL_VMC4P_YCT <- ModelDFSL_VMC4P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VMC4)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMC4P_YCT) <- c("Year", "Months", "CTail_VMC_4")

    #Save Dataframes for Plots 3.1, 3.2, 4 and 5
    write_xlsx(ModelDFSL_VMC4P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VMC4P.xlsx") #Yearly CO2 emissions (no delay)
    write_xlsx(ModelDFSL_VMC4P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VMC4P.xlsx") #Yearly CO2 emissions (delay)
    write_xlsx(ModelDFSL_VMC4P_YC,"CEmissions_P\\ModelDFSL_R_CE_VMC4P.xlsx") #Yearly C emissions
    write_xlsx(ModelDFSL_VMC4P_YCT,"CTails_P\\ModelDFSL_R_CT_VMC4P.xlsx") #Yearly C emissions



    #### 10.6 - VMC5) Manure; 50%clay; Conventional tillage ####
    #The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
    fT_VMC5=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
    fW_VMC5=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                            S.Thick = soil.thick, pClay = clay100*0.5,
                            pE = 1.0, bare = FALSE)$b #Moisture effects per month
    xi.frame_VMC5=data.frame(years,rep(fT_VMC5*fW_VMC5,length.out=length(years)))

    #To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
    Model_VMC5=SoilR::RothCModel(
      t=years, #Simulation Length
      ks=c(k.DPM = 10*CTRM, k.RPM = 0.3*CTRM, k.BIO = 0.66*CTRM, k.HUM = 0.02*CTRM, k.IOM = 0*CTRM), #Decomposition rates for the different pools
      C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
      In=Scalar_LitterCinputs*0, #Amount of litter inputs by time
      FYM = Scalar_ManureCinputs*1, #Amount of Farm Yard Manure by time
      clay=clay100*0.5, #Percent clay in mineral soil
      xi=xi.frame_VMC5) #Loads the model

    Ct_VMC5=getC(Model_VMC5) #Calculates stocks for each pool per month

    #The results can be plotted with the commands
    matplot(years, Ct_VMC5, type="l", lty=1, col=1:5,
            xlab="Time (years)", ylab="C stocks (Mg/ha)")
    legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
           lty=1, col=1:5, bty="n")

    VEC_Lit_VMC5 <- rep(M_Scalar_LitterCinputs*0, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
    VEC_Man_VMC5 <- rep(M_Scalar_ManureCinputs*1, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

    VEC_LitDF_VMC5 <- as.data.frame(VEC_Lit_VMC5) #Converting the Litter vector to a data frame
    VEC_LitDF_VMC5$MNumber <- seq(from = 1, to = SimulationLength_months)
    VEC_ManDF_VMC5 <- as.data.frame(VEC_Man_VMC5) #Converting the Manure vector to a data frame
    VEC_ManDF_VMC5$MNumber <- seq(from = 1, to = SimulationLength_months)

    sapply(VEC_LitDF_VMC5, class) #Check that class is numeric
    sapply(VEC_ManDF_VMC5, class) #Check that class is numeric
    LitterCinputs_VMC5=VEC_LitDF_VMC5   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    ManureCinputs_VMC5=VEC_ManDF_VMC5 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    MCinputs_VMC5 <- merge(LitterCinputs_VMC5, ManureCinputs_VMC5, by = "MNumber")
    MCinputs_VMC5$MInput_VMC5 <- MCinputs_VMC5$VEC_Lit_VMC5 + MCinputs_VMC5$VEC_Man_VMC5

    #Change names of litter and manure columns for more common ones
    colnames(MCinputs_VMC5)[which(names(MCinputs_VMC5) == "VEC_Lit_VMC5")] <- "LitterC_VMC5"
    colnames(MCinputs_VMC5)[which(names(MCinputs_VMC5) == "VEC_Man_VMC5")] <- "ManureC_VMC5"

    #Create a dataframe with the data considering the simulation length
    ModelDF_VMC5 <- as.data.frame(Ct_VMC5)
    colnames(ModelDF_VMC5) <- c('DPM_VMC5','RPM_VMC5','BIO_VMC5', 'HUM_VMC5', 'IOM_VMC5')
    ModelDFS_VMC5 <- ModelDF_VMC5[1:SimulationLength_months, ]

    #Create a column with the number of month of analysis
    ModelDFS_VMC5$MNumber <- seq(from = 1, to = SimulationLength_months)

    #Create a column that sums all pools
    ModelDFS_VMC5$AllPools_VMC5 <- ModelDFS_VMC5$DPM_VMC5 + ModelDFS_VMC5$RPM_VMC5 + ModelDFS_VMC5$BIO_VMC5 + ModelDFS_VMC5$HUM_VMC5 + ModelDFS_VMC5$IOM_VMC5

    #Create a column that sums all pools except IOM (static)
    ModelDFS_VMC5$AllPools_noIOM_VMC5 <- ModelDFS_VMC5$DPM_VMC5 + ModelDFS_VMC5$RPM_VMC5 + ModelDFS_VMC5$BIO_VMC5 + ModelDFS_VMC5$HUM_VMC5

    #Create a column that add the monthly input of C (manure and litter separately)
    ModelDFSL_VMC5 <- merge(ModelDFS_VMC5, MCinputs_VMC5, by = "MNumber")

    ModelDFSL_VMC5$MInput_VMC5 <- ModelDFSL_VMC5$LitterC_VMC5 + ModelDFSL_VMC5$ManureC_VMC5
    #ModelDF_SL$MInput[1] <- 0

    #Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
    ModelDFSL_VMC5$CTails_VMC5 <- ModelDFSL_VMC5$AllPools_noIOM_VMC5 + ModelDFSL_VMC5$MInput_VMC5

    #Create Monthly Accumulated input of C
    ModelDFSL_VMC5$AccumInput_VMC5 = ModelDFSL_VMC5$AccumInput_VMC5=cumsum(ModelDFSL_VMC5$MInput_VMC5)

    #Create Monthly Growths for each carbon pool
    ModelDFSL_VMC5$MGrowth_DPM_VMC5 <- ave(ModelDFSL_VMC5$DPM_VMC5, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMC5$MGrowth_RPM_VMC5 <- ave(ModelDFSL_VMC5$RPM_VMC5, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMC5$MGrowth_BIO_VMC5 <- ave(ModelDFSL_VMC5$BIO_VMC5, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMC5$MGrowth_HUM_VMC5 <- ave(ModelDFSL_VMC5$HUM_VMC5, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMC5$MGrowth_IOM_VMC5 <- ave(ModelDFSL_VMC5$IOM_VMC5, FUN = function(x) c(0, diff(x)))

    #Create column for Monthly and Accumulated C-CO2 emissions
    ModelDFSL_VMC5$M_CCO2_VMC5 <- ModelDFSL_VMC5$MInput_VMC5 - ModelDFSL_VMC5$MGrowth_DPM_VMC5 - ModelDFSL_VMC5$MGrowth_RPM_VMC5 - ModelDFSL_VMC5$MGrowth_BIO_VMC5 - ModelDFSL_VMC5$MGrowth_HUM_VMC5
    ModelDFSL_VMC5$Accum_CCO2_VMC5 <- ModelDFSL_VMC5$AccumInput_VMC5 - ModelDFSL_VMC5$AllPools_noIOM_VMC5

    #Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
    ModelDFSL_VMC5$M_CCO2_VMC5[1] <- 0
    ModelDFSL_VMC5$Accum_CCO2_VMC5[1] <- 0

    #Balance validation
    ModelDFSL_VMC5$Balance_VMC5 <- ModelDFSL_VMC5$AccumInput_VMC5 - ModelDFSL_VMC5$Accum_CCO2_VMC5 - (ModelDFSL_VMC5$DPM_VMC5 + ModelDFSL_VMC5$RPM_VMC5 + ModelDFSL_VMC5$BIO_VMC5 + ModelDFSL_VMC5$HUM_VMC5)

    #Convert C-CO2 emissions into CO2 emissions
    ModelDFSL_VMC5$M_CO2_VMC5 <- ModelDFSL_VMC5$M_CCO2_VMC5 * 44/12
    ModelDFSL_VMC5$Accum_CO2_VMC5 <- ModelDFSL_VMC5$Accum_CCO2_VMC5 * 44/12

    #This model will be called VMC5C because implies a continuous input of C
    ModelDFSL_VMC5C <- ModelDFSL_VMC5

    #Export the dataframe
    write_xlsx(ModelDFSL_VMC5C,"VXC_Models\\ModelDFSL_R_VMC5C.xlsx")

    #Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
    #Create two equal models by using the above general script
    #Create model t=x
    ModelDFSLt0_VMC5 <- ModelDFSL_VMC5 #Create model t=x

    #Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
    ModelDFSLt1_VMC5.1 <- rbind(c(0:0), ModelDFSLt0_VMC5)
    ModelDFSLt1_VMC5.2 <- rbind(c(0:0), ModelDFSLt1_VMC5.1)
    ModelDFSLt1_VMC5.3 <- rbind(c(0:0), ModelDFSLt1_VMC5.2)
    ModelDFSLt1_VMC5.4 <- rbind(c(0:0), ModelDFSLt1_VMC5.3)
    ModelDFSLt1_VMC5.5 <- rbind(c(0:0), ModelDFSLt1_VMC5.4)
    ModelDFSLt1_VMC5.6 <- rbind(c(0:0), ModelDFSLt1_VMC5.5)
    ModelDFSLt1_VMC5.7 <- rbind(c(0:0), ModelDFSLt1_VMC5.6)
    ModelDFSLt1_VMC5.8 <- rbind(c(0:0), ModelDFSLt1_VMC5.7)
    ModelDFSLt1_VMC5.9 <- rbind(c(0:0), ModelDFSLt1_VMC5.8)
    ModelDFSLt1_VMC5.10 <- rbind(c(0:0), ModelDFSLt1_VMC5.9)
    ModelDFSLt1_VMC5.11 <- rbind(c(0:0), ModelDFSLt1_VMC5.10)
    ModelDFSLt1_VMC5.12 <- rbind(c(0:0), ModelDFSLt1_VMC5.11)
    ModelDFSLt1_VMC5.13 <- ModelDFSLt1_VMC5.12[-nrow(ModelDFSLt1_VMC5.12),]
    ModelDFSLt1_VMC5.14 <- ModelDFSLt1_VMC5.13[-nrow(ModelDFSLt1_VMC5.13),]
    ModelDFSLt1_VMC5.15 <- ModelDFSLt1_VMC5.14[-nrow(ModelDFSLt1_VMC5.14),]
    ModelDFSLt1_VMC5.16 <- ModelDFSLt1_VMC5.15[-nrow(ModelDFSLt1_VMC5.15),]
    ModelDFSLt1_VMC5.17 <- ModelDFSLt1_VMC5.16[-nrow(ModelDFSLt1_VMC5.16),]
    ModelDFSLt1_VMC5.18 <- ModelDFSLt1_VMC5.17[-nrow(ModelDFSLt1_VMC5.17),]
    ModelDFSLt1_VMC5.19 <- ModelDFSLt1_VMC5.18[-nrow(ModelDFSLt1_VMC5.18),]
    ModelDFSLt1_VMC5.20 <- ModelDFSLt1_VMC5.19[-nrow(ModelDFSLt1_VMC5.19),]
    ModelDFSLt1_VMC5.21 <- ModelDFSLt1_VMC5.20[-nrow(ModelDFSLt1_VMC5.20),]
    ModelDFSLt1_VMC5.22 <- ModelDFSLt1_VMC5.21[-nrow(ModelDFSLt1_VMC5.21),]
    ModelDFSLt1_VMC5.23 <- ModelDFSLt1_VMC5.22[-nrow(ModelDFSLt1_VMC5.22),]
    ModelDFSLt1_VMC5.24 <- ModelDFSLt1_VMC5.23[-nrow(ModelDFSLt1_VMC5.23),]

    ModelDFSLt1_VMC5 <- ModelDFSLt1_VMC5.24 #Create model t=x+1

    #Subtract model (t=x) - (t=x+1)
    ModelDFSL1y_VMC5 <- ModelDFSLt0_VMC5 - ModelDFSLt1_VMC5

    #Re-do Month Number column because the substraction was also applied to it
    ModelDFSL1y_VMC5$MNumber <- seq(from = 1, to = SimulationLength_months)

    #This model will be called VMC5P because implies a one-off input of C
    ModelDFSL_VMC5P <- ModelDFSL1y_VMC5

    #Export the dataframe
    write_xlsx(ModelDFSL_VMC5P,"VXP_Models\\ModelDFSL_R_VMC5P.xlsx")


    #Plot 3: Interactive Yearly CO2 emissions #
    MY <- 12
    ModelDFSL_VMC5P_YCO2 <- ModelDFSL_VMC5P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VMC5)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMC5P_YCO2) <- c("Year", "Months", "AnnualCO2_VMC_5")


    #Plot 3: Interactive Yearly CO2 emissions considering a delay
    GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
    ModelDFSL_VMC5P_YCO2D <- merge(ModelDFSL_VMC5P_YCO2, GWP100delay, by = "Year")
    ModelDFSL_VMC5P_YCO2D$AnnualCO2D_VMC_5 <- ModelDFSL_VMC5P_YCO2D$AnnualCO2_VMC_5 * ModelDFSL_VMC5P_YCO2D$GWP100

    #Plot 4: Interactive Yearly C emissions #
    MY <- 12
    ModelDFSL_VMC5P_YC <- ModelDFSL_VMC5P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VMC5)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMC5P_YC) <- c("Year", "Months", "CEmissions_VMC_5")


    #Plot 5: Interactive Yearly C tails (remaining C in Soil) #
    MY <- 12
    ModelDFSL_VMC5P_YCT <- ModelDFSL_VMC5P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VMC5)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMC5P_YCT) <- c("Year", "Months", "CTail_VMC_5")

    #Save Dataframes for Plots 3.1, 3.2, 4 and 5
    write_xlsx(ModelDFSL_VMC5P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VMC5P.xlsx") #Yearly CO2 emissions (no delay)
    write_xlsx(ModelDFSL_VMC5P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VMC5P.xlsx") #Yearly CO2 emissions (delay)
    write_xlsx(ModelDFSL_VMC5P_YC,"CEmissions_P\\ModelDFSL_R_CE_VMC5P.xlsx") #Yearly C emissions
    write_xlsx(ModelDFSL_VMC5P_YCT,"CTails_P\\ModelDFSL_R_CT_VMC5P.xlsx") #Yearly C emissions



    #### 10.7 - VMC6) Manure; 60%clay; Conventional tillage ####
    #The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
    fT_VMC6=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
    fW_VMC6=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                            S.Thick = soil.thick, pClay = clay100*0.6,
                            pE = 1.0, bare = FALSE)$b #Moisture effects per month
    xi.frame_VMC6=data.frame(years,rep(fT_VMC6*fW_VMC6,length.out=length(years)))

    #To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
    Model_VMC6=SoilR::RothCModel(
      t=years, #Simulation Length
      ks=c(k.DPM = 10*CTRM, k.RPM = 0.3*CTRM, k.BIO = 0.66*CTRM, k.HUM = 0.02*CTRM, k.IOM = 0*CTRM), #Decomposition rates for the different pools
      C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
      In=Scalar_LitterCinputs*0, #Amount of litter inputs by time
      FYM = Scalar_ManureCinputs*1, #Amount of Farm Yard Manure by time
      clay=clay100*0.6, #Percent clay in mineral soil
      xi=xi.frame_VMC6) #Loads the model

    Ct_VMC6=getC(Model_VMC6) #Calculates stocks for each pool per month

    #The results can be plotted with the commands
    matplot(years, Ct_VMC6, type="l", lty=1, col=1:5,
            xlab="Time (years)", ylab="C stocks (Mg/ha)")
    legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
           lty=1, col=1:5, bty="n")

    VEC_Lit_VMC6 <- rep(M_Scalar_LitterCinputs*0, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
    VEC_Man_VMC6 <- rep(M_Scalar_ManureCinputs*1, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

    VEC_LitDF_VMC6 <- as.data.frame(VEC_Lit_VMC6) #Converting the Litter vector to a data frame
    VEC_LitDF_VMC6$MNumber <- seq(from = 1, to = SimulationLength_months)
    VEC_ManDF_VMC6 <- as.data.frame(VEC_Man_VMC6) #Converting the Manure vector to a data frame
    VEC_ManDF_VMC6$MNumber <- seq(from = 1, to = SimulationLength_months)

    sapply(VEC_LitDF_VMC6, class) #Check that class is numeric
    sapply(VEC_ManDF_VMC6, class) #Check that class is numeric
    LitterCinputs_VMC6=VEC_LitDF_VMC6   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    ManureCinputs_VMC6=VEC_ManDF_VMC6 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    MCinputs_VMC6 <- merge(LitterCinputs_VMC6, ManureCinputs_VMC6, by = "MNumber")
    MCinputs_VMC6$MInput_VMC6 <- MCinputs_VMC6$VEC_Lit_VMC6 + MCinputs_VMC6$VEC_Man_VMC6

    #Change names of litter and manure columns for more common ones
    colnames(MCinputs_VMC6)[which(names(MCinputs_VMC6) == "VEC_Lit_VMC6")] <- "LitterC_VMC6"
    colnames(MCinputs_VMC6)[which(names(MCinputs_VMC6) == "VEC_Man_VMC6")] <- "ManureC_VMC6"

    #Create a dataframe with the data considering the simulation length
    ModelDF_VMC6 <- as.data.frame(Ct_VMC6)
    colnames(ModelDF_VMC6) <- c('DPM_VMC6','RPM_VMC6','BIO_VMC6', 'HUM_VMC6', 'IOM_VMC6')
    ModelDFS_VMC6 <- ModelDF_VMC6[1:SimulationLength_months, ]

    #Create a column with the number of month of analysis
    ModelDFS_VMC6$MNumber <- seq(from = 1, to = SimulationLength_months)

    #Create a column that sums all pools
    ModelDFS_VMC6$AllPools_VMC6 <- ModelDFS_VMC6$DPM_VMC6 + ModelDFS_VMC6$RPM_VMC6 + ModelDFS_VMC6$BIO_VMC6 + ModelDFS_VMC6$HUM_VMC6 + ModelDFS_VMC6$IOM_VMC6

    #Create a column that sums all pools except IOM (static)
    ModelDFS_VMC6$AllPools_noIOM_VMC6 <- ModelDFS_VMC6$DPM_VMC6 + ModelDFS_VMC6$RPM_VMC6 + ModelDFS_VMC6$BIO_VMC6 + ModelDFS_VMC6$HUM_VMC6

    #Create a column that add the monthly input of C (manure and litter separately)
    ModelDFSL_VMC6 <- merge(ModelDFS_VMC6, MCinputs_VMC6, by = "MNumber")

    ModelDFSL_VMC6$MInput_VMC6 <- ModelDFSL_VMC6$LitterC_VMC6 + ModelDFSL_VMC6$ManureC_VMC6
    #ModelDF_SL$MInput[1] <- 0

    #Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
    ModelDFSL_VMC6$CTails_VMC6 <- ModelDFSL_VMC6$AllPools_noIOM_VMC6 + ModelDFSL_VMC6$MInput_VMC6

    #Create Monthly Accumulated input of C
    ModelDFSL_VMC6$AccumInput_VMC6 = ModelDFSL_VMC6$AccumInput_VMC6=cumsum(ModelDFSL_VMC6$MInput_VMC6)

    #Create Monthly Growths for each carbon pool
    ModelDFSL_VMC6$MGrowth_DPM_VMC6 <- ave(ModelDFSL_VMC6$DPM_VMC6, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMC6$MGrowth_RPM_VMC6 <- ave(ModelDFSL_VMC6$RPM_VMC6, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMC6$MGrowth_BIO_VMC6 <- ave(ModelDFSL_VMC6$BIO_VMC6, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMC6$MGrowth_HUM_VMC6 <- ave(ModelDFSL_VMC6$HUM_VMC6, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMC6$MGrowth_IOM_VMC6 <- ave(ModelDFSL_VMC6$IOM_VMC6, FUN = function(x) c(0, diff(x)))

    #Create column for Monthly and Accumulated C-CO2 emissions
    ModelDFSL_VMC6$M_CCO2_VMC6 <- ModelDFSL_VMC6$MInput_VMC6 - ModelDFSL_VMC6$MGrowth_DPM_VMC6 - ModelDFSL_VMC6$MGrowth_RPM_VMC6 - ModelDFSL_VMC6$MGrowth_BIO_VMC6 - ModelDFSL_VMC6$MGrowth_HUM_VMC6
    ModelDFSL_VMC6$Accum_CCO2_VMC6 <- ModelDFSL_VMC6$AccumInput_VMC6 - ModelDFSL_VMC6$AllPools_noIOM_VMC6

    #Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
    ModelDFSL_VMC6$M_CCO2_VMC6[1] <- 0
    ModelDFSL_VMC6$Accum_CCO2_VMC6[1] <- 0

    #Balance validation
    ModelDFSL_VMC6$Balance_VMC6 <- ModelDFSL_VMC6$AccumInput_VMC6 - ModelDFSL_VMC6$Accum_CCO2_VMC6 - (ModelDFSL_VMC6$DPM_VMC6 + ModelDFSL_VMC6$RPM_VMC6 + ModelDFSL_VMC6$BIO_VMC6 + ModelDFSL_VMC6$HUM_VMC6)

    #Convert C-CO2 emissions into CO2 emissions
    ModelDFSL_VMC6$M_CO2_VMC6 <- ModelDFSL_VMC6$M_CCO2_VMC6 * 44/12
    ModelDFSL_VMC6$Accum_CO2_VMC6 <- ModelDFSL_VMC6$Accum_CCO2_VMC6 * 44/12

    #This model will be called VMC6C because implies a continuous input of C
    ModelDFSL_VMC6C <- ModelDFSL_VMC6

    #Export the dataframe
    write_xlsx(ModelDFSL_VMC6C,"VXC_Models\\ModelDFSL_R_VMC6C.xlsx")

    #Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
    #Create two equal models by using the above general script
    #Create model t=x
    ModelDFSLt0_VMC6 <- ModelDFSL_VMC6 #Create model t=x

    #Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
    ModelDFSLt1_VMC6.1 <- rbind(c(0:0), ModelDFSLt0_VMC6)
    ModelDFSLt1_VMC6.2 <- rbind(c(0:0), ModelDFSLt1_VMC6.1)
    ModelDFSLt1_VMC6.3 <- rbind(c(0:0), ModelDFSLt1_VMC6.2)
    ModelDFSLt1_VMC6.4 <- rbind(c(0:0), ModelDFSLt1_VMC6.3)
    ModelDFSLt1_VMC6.5 <- rbind(c(0:0), ModelDFSLt1_VMC6.4)
    ModelDFSLt1_VMC6.6 <- rbind(c(0:0), ModelDFSLt1_VMC6.5)
    ModelDFSLt1_VMC6.7 <- rbind(c(0:0), ModelDFSLt1_VMC6.6)
    ModelDFSLt1_VMC6.8 <- rbind(c(0:0), ModelDFSLt1_VMC6.7)
    ModelDFSLt1_VMC6.9 <- rbind(c(0:0), ModelDFSLt1_VMC6.8)
    ModelDFSLt1_VMC6.10 <- rbind(c(0:0), ModelDFSLt1_VMC6.9)
    ModelDFSLt1_VMC6.11 <- rbind(c(0:0), ModelDFSLt1_VMC6.10)
    ModelDFSLt1_VMC6.12 <- rbind(c(0:0), ModelDFSLt1_VMC6.11)
    ModelDFSLt1_VMC6.13 <- ModelDFSLt1_VMC6.12[-nrow(ModelDFSLt1_VMC6.12),]
    ModelDFSLt1_VMC6.14 <- ModelDFSLt1_VMC6.13[-nrow(ModelDFSLt1_VMC6.13),]
    ModelDFSLt1_VMC6.15 <- ModelDFSLt1_VMC6.14[-nrow(ModelDFSLt1_VMC6.14),]
    ModelDFSLt1_VMC6.16 <- ModelDFSLt1_VMC6.15[-nrow(ModelDFSLt1_VMC6.15),]
    ModelDFSLt1_VMC6.17 <- ModelDFSLt1_VMC6.16[-nrow(ModelDFSLt1_VMC6.16),]
    ModelDFSLt1_VMC6.18 <- ModelDFSLt1_VMC6.17[-nrow(ModelDFSLt1_VMC6.17),]
    ModelDFSLt1_VMC6.19 <- ModelDFSLt1_VMC6.18[-nrow(ModelDFSLt1_VMC6.18),]
    ModelDFSLt1_VMC6.20 <- ModelDFSLt1_VMC6.19[-nrow(ModelDFSLt1_VMC6.19),]
    ModelDFSLt1_VMC6.21 <- ModelDFSLt1_VMC6.20[-nrow(ModelDFSLt1_VMC6.20),]
    ModelDFSLt1_VMC6.22 <- ModelDFSLt1_VMC6.21[-nrow(ModelDFSLt1_VMC6.21),]
    ModelDFSLt1_VMC6.23 <- ModelDFSLt1_VMC6.22[-nrow(ModelDFSLt1_VMC6.22),]
    ModelDFSLt1_VMC6.24 <- ModelDFSLt1_VMC6.23[-nrow(ModelDFSLt1_VMC6.23),]

    ModelDFSLt1_VMC6 <- ModelDFSLt1_VMC6.24 #Create model t=x+1

    #Subtract model (t=x) - (t=x+1)
    ModelDFSL1y_VMC6 <- ModelDFSLt0_VMC6 - ModelDFSLt1_VMC6

    #Re-do Month Number column because the substraction was also applied to it
    ModelDFSL1y_VMC6$MNumber <- seq(from = 1, to = SimulationLength_months)

    #This model will be called VMC6P because implies a one-off input of C
    ModelDFSL_VMC6P <- ModelDFSL1y_VMC6

    #Export the dataframe
    write_xlsx(ModelDFSL_VMC6P,"VXP_Models\\ModelDFSL_R_VMC6P.xlsx")

    #Plot 3: Interactive Yearly CO2 emissions #
    MY <- 12
    ModelDFSL_VMC6P_YCO2 <- ModelDFSL_VMC6P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VMC6)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMC6P_YCO2) <- c("Year", "Months", "AnnualCO2_VMC_6")


    #Plot 3: Interactive Yearly CO2 emissions considering a delay
    GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
    ModelDFSL_VMC6P_YCO2D <- merge(ModelDFSL_VMC6P_YCO2, GWP100delay, by = "Year")
    ModelDFSL_VMC6P_YCO2D$AnnualCO2D_VMC_6 <- ModelDFSL_VMC6P_YCO2D$AnnualCO2_VMC_6 * ModelDFSL_VMC6P_YCO2D$GWP100

    #Plot 4: Interactive Yearly C emissions #
    MY <- 12
    ModelDFSL_VMC6P_YC <- ModelDFSL_VMC6P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VMC6)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMC6P_YC) <- c("Year", "Months", "CEmissions_VMC_6")


    #Plot 5: Interactive Yearly C tails (remaining C in Soil) #
    MY <- 12
    ModelDFSL_VMC6P_YCT <- ModelDFSL_VMC6P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VMC6)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMC6P_YCT) <- c("Year", "Months", "CTail_VMC_6")

    #Save Dataframes for Plots 3.1, 3.2, 4 and 5
    write_xlsx(ModelDFSL_VMC6P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VMC6P.xlsx") #Yearly CO2 emissions (no delay)
    write_xlsx(ModelDFSL_VMC6P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VMC6P.xlsx") #Yearly CO2 emissions (delay)
    write_xlsx(ModelDFSL_VMC6P_YC,"CEmissions_P\\ModelDFSL_R_CE_VMC6P.xlsx") #Yearly C emissions
    write_xlsx(ModelDFSL_VMC6P_YCT,"CTails_P\\ModelDFSL_R_CT_VMC6P.xlsx") #Yearly C emissions



    #### 10.8 - VMC7) Manure; 70%clay; Conventional tillage ####
    #The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
    fT_VMC7=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
    fW_VMC7=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                            S.Thick = soil.thick, pClay = clay100*0.7,
                            pE = 1.0, bare = FALSE)$b #Moisture effects per month
    xi.frame_VMC7=data.frame(years,rep(fT_VMC7*fW_VMC7,length.out=length(years)))

    #To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
    Model_VMC7=SoilR::RothCModel(
      t=years, #Simulation Length
      ks=c(k.DPM = 10*CTRM, k.RPM = 0.3*CTRM, k.BIO = 0.66*CTRM, k.HUM = 0.02*CTRM, k.IOM = 0*CTRM), #Decomposition rates for the different pools
      C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
      In=Scalar_LitterCinputs*0, #Amount of litter inputs by time
      FYM = Scalar_ManureCinputs*1, #Amount of Farm Yard Manure by time
      clay=clay100*0.7, #Percent clay in mineral soil
      xi=xi.frame_VMC7) #Loads the model

    Ct_VMC7=getC(Model_VMC7) #Calculates stocks for each pool per month

    #The results can be plotted with the commands
    matplot(years, Ct_VMC7, type="l", lty=1, col=1:5,
            xlab="Time (years)", ylab="C stocks (Mg/ha)")
    legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
           lty=1, col=1:5, bty="n")

    VEC_Lit_VMC7 <- rep(M_Scalar_LitterCinputs*0, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
    VEC_Man_VMC7 <- rep(M_Scalar_ManureCinputs*1, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

    VEC_LitDF_VMC7 <- as.data.frame(VEC_Lit_VMC7) #Converting the Litter vector to a data frame
    VEC_LitDF_VMC7$MNumber <- seq(from = 1, to = SimulationLength_months)
    VEC_ManDF_VMC7 <- as.data.frame(VEC_Man_VMC7) #Converting the Manure vector to a data frame
    VEC_ManDF_VMC7$MNumber <- seq(from = 1, to = SimulationLength_months)

    sapply(VEC_LitDF_VMC7, class) #Check that class is numeric
    sapply(VEC_ManDF_VMC7, class) #Check that class is numeric
    LitterCinputs_VMC7=VEC_LitDF_VMC7   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    ManureCinputs_VMC7=VEC_ManDF_VMC7 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    MCinputs_VMC7 <- merge(LitterCinputs_VMC7, ManureCinputs_VMC7, by = "MNumber")
    MCinputs_VMC7$MInput_VMC7 <- MCinputs_VMC7$VEC_Lit_VMC7 + MCinputs_VMC7$VEC_Man_VMC7

    #Change names of litter and manure columns for more common ones
    colnames(MCinputs_VMC7)[which(names(MCinputs_VMC7) == "VEC_Lit_VMC7")] <- "LitterC_VMC7"
    colnames(MCinputs_VMC7)[which(names(MCinputs_VMC7) == "VEC_Man_VMC7")] <- "ManureC_VMC7"

    #Create a dataframe with the data considering the simulation length
    ModelDF_VMC7 <- as.data.frame(Ct_VMC7)
    colnames(ModelDF_VMC7) <- c('DPM_VMC7','RPM_VMC7','BIO_VMC7', 'HUM_VMC7', 'IOM_VMC7')
    ModelDFS_VMC7 <- ModelDF_VMC7[1:SimulationLength_months, ]

    #Create a column with the number of month of analysis
    ModelDFS_VMC7$MNumber <- seq(from = 1, to = SimulationLength_months)

    #Create a column that sums all pools
    ModelDFS_VMC7$AllPools_VMC7 <- ModelDFS_VMC7$DPM_VMC7 + ModelDFS_VMC7$RPM_VMC7 + ModelDFS_VMC7$BIO_VMC7 + ModelDFS_VMC7$HUM_VMC7 + ModelDFS_VMC7$IOM_VMC7

    #Create a column that sums all pools except IOM (static)
    ModelDFS_VMC7$AllPools_noIOM_VMC7 <- ModelDFS_VMC7$DPM_VMC7 + ModelDFS_VMC7$RPM_VMC7 + ModelDFS_VMC7$BIO_VMC7 + ModelDFS_VMC7$HUM_VMC7

    #Create a column that add the monthly input of C (manure and litter separately)
    ModelDFSL_VMC7 <- merge(ModelDFS_VMC7, MCinputs_VMC7, by = "MNumber")

    ModelDFSL_VMC7$MInput_VMC7 <- ModelDFSL_VMC7$LitterC_VMC7 + ModelDFSL_VMC7$ManureC_VMC7
    #ModelDF_SL$MInput[1] <- 0

    #Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
    ModelDFSL_VMC7$CTails_VMC7 <- ModelDFSL_VMC7$AllPools_noIOM_VMC7 + ModelDFSL_VMC7$MInput_VMC7

    #Create Monthly Accumulated input of C
    ModelDFSL_VMC7$AccumInput_VMC7 = ModelDFSL_VMC7$AccumInput_VMC7=cumsum(ModelDFSL_VMC7$MInput_VMC7)

    #Create Monthly Growths for each carbon pool
    ModelDFSL_VMC7$MGrowth_DPM_VMC7 <- ave(ModelDFSL_VMC7$DPM_VMC7, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMC7$MGrowth_RPM_VMC7 <- ave(ModelDFSL_VMC7$RPM_VMC7, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMC7$MGrowth_BIO_VMC7 <- ave(ModelDFSL_VMC7$BIO_VMC7, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMC7$MGrowth_HUM_VMC7 <- ave(ModelDFSL_VMC7$HUM_VMC7, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMC7$MGrowth_IOM_VMC7 <- ave(ModelDFSL_VMC7$IOM_VMC7, FUN = function(x) c(0, diff(x)))

    #Create column for Monthly and Accumulated C-CO2 emissions
    ModelDFSL_VMC7$M_CCO2_VMC7 <- ModelDFSL_VMC7$MInput_VMC7 - ModelDFSL_VMC7$MGrowth_DPM_VMC7 - ModelDFSL_VMC7$MGrowth_RPM_VMC7 - ModelDFSL_VMC7$MGrowth_BIO_VMC7 - ModelDFSL_VMC7$MGrowth_HUM_VMC7
    ModelDFSL_VMC7$Accum_CCO2_VMC7 <- ModelDFSL_VMC7$AccumInput_VMC7 - ModelDFSL_VMC7$AllPools_noIOM_VMC7

    #Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
    ModelDFSL_VMC7$M_CCO2_VMC7[1] <- 0
    ModelDFSL_VMC7$Accum_CCO2_VMC7[1] <- 0

    #Balance validation
    ModelDFSL_VMC7$Balance_VMC7 <- ModelDFSL_VMC7$AccumInput_VMC7 - ModelDFSL_VMC7$Accum_CCO2_VMC7 - (ModelDFSL_VMC7$DPM_VMC7 + ModelDFSL_VMC7$RPM_VMC7 + ModelDFSL_VMC7$BIO_VMC7 + ModelDFSL_VMC7$HUM_VMC7)

    #Convert C-CO2 emissions into CO2 emissions
    ModelDFSL_VMC7$M_CO2_VMC7 <- ModelDFSL_VMC7$M_CCO2_VMC7 * 44/12
    ModelDFSL_VMC7$Accum_CO2_VMC7 <- ModelDFSL_VMC7$Accum_CCO2_VMC7 * 44/12

    #This model will be called VMC7C because implies a continuous input of C
    ModelDFSL_VMC7C <- ModelDFSL_VMC7

    #Export the dataframe
    write_xlsx(ModelDFSL_VMC7C,"VXC_Models\\ModelDFSL_R_VMC7C.xlsx")

    #Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
    #Create two equal models by using the above general script
    #Create model t=x
    ModelDFSLt0_VMC7 <- ModelDFSL_VMC7 #Create model t=x

    #Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
    ModelDFSLt1_VMC7.1 <- rbind(c(0:0), ModelDFSLt0_VMC7)
    ModelDFSLt1_VMC7.2 <- rbind(c(0:0), ModelDFSLt1_VMC7.1)
    ModelDFSLt1_VMC7.3 <- rbind(c(0:0), ModelDFSLt1_VMC7.2)
    ModelDFSLt1_VMC7.4 <- rbind(c(0:0), ModelDFSLt1_VMC7.3)
    ModelDFSLt1_VMC7.5 <- rbind(c(0:0), ModelDFSLt1_VMC7.4)
    ModelDFSLt1_VMC7.6 <- rbind(c(0:0), ModelDFSLt1_VMC7.5)
    ModelDFSLt1_VMC7.7 <- rbind(c(0:0), ModelDFSLt1_VMC7.6)
    ModelDFSLt1_VMC7.8 <- rbind(c(0:0), ModelDFSLt1_VMC7.7)
    ModelDFSLt1_VMC7.9 <- rbind(c(0:0), ModelDFSLt1_VMC7.8)
    ModelDFSLt1_VMC7.10 <- rbind(c(0:0), ModelDFSLt1_VMC7.9)
    ModelDFSLt1_VMC7.11 <- rbind(c(0:0), ModelDFSLt1_VMC7.10)
    ModelDFSLt1_VMC7.12 <- rbind(c(0:0), ModelDFSLt1_VMC7.11)
    ModelDFSLt1_VMC7.13 <- ModelDFSLt1_VMC7.12[-nrow(ModelDFSLt1_VMC7.12),]
    ModelDFSLt1_VMC7.14 <- ModelDFSLt1_VMC7.13[-nrow(ModelDFSLt1_VMC7.13),]
    ModelDFSLt1_VMC7.15 <- ModelDFSLt1_VMC7.14[-nrow(ModelDFSLt1_VMC7.14),]
    ModelDFSLt1_VMC7.16 <- ModelDFSLt1_VMC7.15[-nrow(ModelDFSLt1_VMC7.15),]
    ModelDFSLt1_VMC7.17 <- ModelDFSLt1_VMC7.16[-nrow(ModelDFSLt1_VMC7.16),]
    ModelDFSLt1_VMC7.18 <- ModelDFSLt1_VMC7.17[-nrow(ModelDFSLt1_VMC7.17),]
    ModelDFSLt1_VMC7.19 <- ModelDFSLt1_VMC7.18[-nrow(ModelDFSLt1_VMC7.18),]
    ModelDFSLt1_VMC7.20 <- ModelDFSLt1_VMC7.19[-nrow(ModelDFSLt1_VMC7.19),]
    ModelDFSLt1_VMC7.21 <- ModelDFSLt1_VMC7.20[-nrow(ModelDFSLt1_VMC7.20),]
    ModelDFSLt1_VMC7.22 <- ModelDFSLt1_VMC7.21[-nrow(ModelDFSLt1_VMC7.21),]
    ModelDFSLt1_VMC7.23 <- ModelDFSLt1_VMC7.22[-nrow(ModelDFSLt1_VMC7.22),]
    ModelDFSLt1_VMC7.24 <- ModelDFSLt1_VMC7.23[-nrow(ModelDFSLt1_VMC7.23),]

    ModelDFSLt1_VMC7 <- ModelDFSLt1_VMC7.24 #Create model t=x+1

    #Subtract model (t=x) - (t=x+1)
    ModelDFSL1y_VMC7 <- ModelDFSLt0_VMC7 - ModelDFSLt1_VMC7

    #Re-do Month Number column because the substraction was also applied to it
    ModelDFSL1y_VMC7$MNumber <- seq(from = 1, to = SimulationLength_months)

    #This model will be called VMC7P because implies a one-off input of C
    ModelDFSL_VMC7P <- ModelDFSL1y_VMC7

    #Export the dataframe
    write_xlsx(ModelDFSL_VMC7P,"VXP_Models\\ModelDFSL_R_VMC7P.xlsx")

    #Plot 3: Interactive Yearly CO2 emissions #
    MY <- 12
    ModelDFSL_VMC7P_YCO2 <- ModelDFSL_VMC7P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VMC7)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMC7P_YCO2) <- c("Year", "Months", "AnnualCO2_VMC_7")


    #Plot 3: Interactive Yearly CO2 emissions considering a delay
    GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
    ModelDFSL_VMC7P_YCO2D <- merge(ModelDFSL_VMC7P_YCO2, GWP100delay, by = "Year")
    ModelDFSL_VMC7P_YCO2D$AnnualCO2D_VMC_7 <- ModelDFSL_VMC7P_YCO2D$AnnualCO2_VMC_7 * ModelDFSL_VMC7P_YCO2D$GWP100

    #Plot 4: Interactive Yearly C emissions #
    MY <- 12
    ModelDFSL_VMC7P_YC <- ModelDFSL_VMC7P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VMC7)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMC7P_YC) <- c("Year", "Months", "CEmissions_VMC_7")


    #Plot 5: Interactive Yearly C tails (remaining C in Soil) #
    MY <- 12
    ModelDFSL_VMC7P_YCT <- ModelDFSL_VMC7P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VMC7)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMC7P_YCT) <- c("Year", "Months", "CTail_VMC_7")


    #Save Dataframes for Plots 3.1, 3.2, 4 and 5
    write_xlsx(ModelDFSL_VMC7P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VMC7P.xlsx") #Yearly CO2 emissions (no delay)
    write_xlsx(ModelDFSL_VMC7P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VMC7P.xlsx") #Yearly CO2 emissions (delay)
    write_xlsx(ModelDFSL_VMC7P_YC,"CEmissions_P\\ModelDFSL_R_CE_VMC7P.xlsx") #Yearly C emissions
    write_xlsx(ModelDFSL_VMC7P_YCT,"CTails_P\\ModelDFSL_R_CT_VMC7P.xlsx") #Yearly C emissions



    #### 10.9 - VMC8) Manure; 80%clay; Conventional tillage ####
    #The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
    fT_VMC8=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
    fW_VMC8=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                            S.Thick = soil.thick, pClay = clay100*0.8,
                            pE = 1.0, bare = FALSE)$b #Moisture effects per month
    xi.frame_VMC8=data.frame(years,rep(fT_VMC8*fW_VMC8,length.out=length(years)))

    #To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
    Model_VMC8=SoilR::RothCModel(
      t=years, #Simulation Length
      ks=c(k.DPM = 10*CTRM, k.RPM = 0.3*CTRM, k.BIO = 0.66*CTRM, k.HUM = 0.02*CTRM, k.IOM = 0*CTRM), #Decomposition rates for the different pools
      C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
      In=Scalar_LitterCinputs*0, #Amount of litter inputs by time
      FYM = Scalar_ManureCinputs*1, #Amount of Farm Yard Manure by time
      clay=clay100*0.8, #Percent clay in mineral soil
      xi=xi.frame_VMC8) #Loads the model

    Ct_VMC8=getC(Model_VMC8) #Calculates stocks for each pool per month

    #The results can be plotted with the commands
    matplot(years, Ct_VMC8, type="l", lty=1, col=1:5,
            xlab="Time (years)", ylab="C stocks (Mg/ha)")
    legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
           lty=1, col=1:5, bty="n")

    VEC_Lit_VMC8 <- rep(M_Scalar_LitterCinputs*0, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
    VEC_Man_VMC8 <- rep(M_Scalar_ManureCinputs*1, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

    VEC_LitDF_VMC8 <- as.data.frame(VEC_Lit_VMC8) #Converting the Litter vector to a data frame
    VEC_LitDF_VMC8$MNumber <- seq(from = 1, to = SimulationLength_months)
    VEC_ManDF_VMC8 <- as.data.frame(VEC_Man_VMC8) #Converting the Manure vector to a data frame
    VEC_ManDF_VMC8$MNumber <- seq(from = 1, to = SimulationLength_months)

    sapply(VEC_LitDF_VMC8, class) #Check that class is numeric
    sapply(VEC_ManDF_VMC8, class) #Check that class is numeric
    LitterCinputs_VMC8=VEC_LitDF_VMC8   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    ManureCinputs_VMC8=VEC_ManDF_VMC8 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    MCinputs_VMC8 <- merge(LitterCinputs_VMC8, ManureCinputs_VMC8, by = "MNumber")
    MCinputs_VMC8$MInput_VMC8 <- MCinputs_VMC8$VEC_Lit_VMC8 + MCinputs_VMC8$VEC_Man_VMC8

    #Change names of litter and manure columns for more common ones
    colnames(MCinputs_VMC8)[which(names(MCinputs_VMC8) == "VEC_Lit_VMC8")] <- "LitterC_VMC8"
    colnames(MCinputs_VMC8)[which(names(MCinputs_VMC8) == "VEC_Man_VMC8")] <- "ManureC_VMC8"

    #Create a dataframe with the data considering the simulation length
    ModelDF_VMC8 <- as.data.frame(Ct_VMC8)
    colnames(ModelDF_VMC8) <- c('DPM_VMC8','RPM_VMC8','BIO_VMC8', 'HUM_VMC8', 'IOM_VMC8')
    ModelDFS_VMC8 <- ModelDF_VMC8[1:SimulationLength_months, ]

    #Create a column with the number of month of analysis
    ModelDFS_VMC8$MNumber <- seq(from = 1, to = SimulationLength_months)

    #Create a column that sums all pools
    ModelDFS_VMC8$AllPools_VMC8 <- ModelDFS_VMC8$DPM_VMC8 + ModelDFS_VMC8$RPM_VMC8 + ModelDFS_VMC8$BIO_VMC8 + ModelDFS_VMC8$HUM_VMC8 + ModelDFS_VMC8$IOM_VMC8

    #Create a column that sums all pools except IOM (static)
    ModelDFS_VMC8$AllPools_noIOM_VMC8 <- ModelDFS_VMC8$DPM_VMC8 + ModelDFS_VMC8$RPM_VMC8 + ModelDFS_VMC8$BIO_VMC8 + ModelDFS_VMC8$HUM_VMC8

    #Create a column that add the monthly input of C (manure and litter separately)
    ModelDFSL_VMC8 <- merge(ModelDFS_VMC8, MCinputs_VMC8, by = "MNumber")

    ModelDFSL_VMC8$MInput_VMC8 <- ModelDFSL_VMC8$LitterC_VMC8 + ModelDFSL_VMC8$ManureC_VMC8
    #ModelDF_SL$MInput[1] <- 0

    #Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
    ModelDFSL_VMC8$CTails_VMC8 <- ModelDFSL_VMC8$AllPools_noIOM_VMC8 + ModelDFSL_VMC8$MInput_VMC8

    #Create Monthly Accumulated input of C
    ModelDFSL_VMC8$AccumInput_VMC8 = ModelDFSL_VMC8$AccumInput_VMC8=cumsum(ModelDFSL_VMC8$MInput_VMC8)

    #Create Monthly Growths for each carbon pool
    ModelDFSL_VMC8$MGrowth_DPM_VMC8 <- ave(ModelDFSL_VMC8$DPM_VMC8, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMC8$MGrowth_RPM_VMC8 <- ave(ModelDFSL_VMC8$RPM_VMC8, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMC8$MGrowth_BIO_VMC8 <- ave(ModelDFSL_VMC8$BIO_VMC8, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMC8$MGrowth_HUM_VMC8 <- ave(ModelDFSL_VMC8$HUM_VMC8, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMC8$MGrowth_IOM_VMC8 <- ave(ModelDFSL_VMC8$IOM_VMC8, FUN = function(x) c(0, diff(x)))

    #Create column for Monthly and Accumulated C-CO2 emissions
    ModelDFSL_VMC8$M_CCO2_VMC8 <- ModelDFSL_VMC8$MInput_VMC8 - ModelDFSL_VMC8$MGrowth_DPM_VMC8 - ModelDFSL_VMC8$MGrowth_RPM_VMC8 - ModelDFSL_VMC8$MGrowth_BIO_VMC8 - ModelDFSL_VMC8$MGrowth_HUM_VMC8
    ModelDFSL_VMC8$Accum_CCO2_VMC8 <- ModelDFSL_VMC8$AccumInput_VMC8 - ModelDFSL_VMC8$AllPools_noIOM_VMC8

    #Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
    ModelDFSL_VMC8$M_CCO2_VMC8[1] <- 0
    ModelDFSL_VMC8$Accum_CCO2_VMC8[1] <- 0

    #Balance validation
    ModelDFSL_VMC8$Balance_VMC8 <- ModelDFSL_VMC8$AccumInput_VMC8 - ModelDFSL_VMC8$Accum_CCO2_VMC8 - (ModelDFSL_VMC8$DPM_VMC8 + ModelDFSL_VMC8$RPM_VMC8 + ModelDFSL_VMC8$BIO_VMC8 + ModelDFSL_VMC8$HUM_VMC8)

    #Convert C-CO2 emissions into CO2 emissions
    ModelDFSL_VMC8$M_CO2_VMC8 <- ModelDFSL_VMC8$M_CCO2_VMC8 * 44/12
    ModelDFSL_VMC8$Accum_CO2_VMC8 <- ModelDFSL_VMC8$Accum_CCO2_VMC8 * 44/12

    #This model will be called VMC8C because implies a continuous input of C
    ModelDFSL_VMC8C <- ModelDFSL_VMC8

    #Export the dataframe
    write_xlsx(ModelDFSL_VMC8C,"VXC_Models\\ModelDFSL_R_VMC8C.xlsx")

    #Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
    #Create two equal models by using the above general script
    #Create model t=x
    ModelDFSLt0_VMC8 <- ModelDFSL_VMC8 #Create model t=x

    #Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
    ModelDFSLt1_VMC8.1 <- rbind(c(0:0), ModelDFSLt0_VMC8)
    ModelDFSLt1_VMC8.2 <- rbind(c(0:0), ModelDFSLt1_VMC8.1)
    ModelDFSLt1_VMC8.3 <- rbind(c(0:0), ModelDFSLt1_VMC8.2)
    ModelDFSLt1_VMC8.4 <- rbind(c(0:0), ModelDFSLt1_VMC8.3)
    ModelDFSLt1_VMC8.5 <- rbind(c(0:0), ModelDFSLt1_VMC8.4)
    ModelDFSLt1_VMC8.6 <- rbind(c(0:0), ModelDFSLt1_VMC8.5)
    ModelDFSLt1_VMC8.7 <- rbind(c(0:0), ModelDFSLt1_VMC8.6)
    ModelDFSLt1_VMC8.8 <- rbind(c(0:0), ModelDFSLt1_VMC8.7)
    ModelDFSLt1_VMC8.9 <- rbind(c(0:0), ModelDFSLt1_VMC8.8)
    ModelDFSLt1_VMC8.10 <- rbind(c(0:0), ModelDFSLt1_VMC8.9)
    ModelDFSLt1_VMC8.11 <- rbind(c(0:0), ModelDFSLt1_VMC8.10)
    ModelDFSLt1_VMC8.12 <- rbind(c(0:0), ModelDFSLt1_VMC8.11)
    ModelDFSLt1_VMC8.13 <- ModelDFSLt1_VMC8.12[-nrow(ModelDFSLt1_VMC8.12),]
    ModelDFSLt1_VMC8.14 <- ModelDFSLt1_VMC8.13[-nrow(ModelDFSLt1_VMC8.13),]
    ModelDFSLt1_VMC8.15 <- ModelDFSLt1_VMC8.14[-nrow(ModelDFSLt1_VMC8.14),]
    ModelDFSLt1_VMC8.16 <- ModelDFSLt1_VMC8.15[-nrow(ModelDFSLt1_VMC8.15),]
    ModelDFSLt1_VMC8.17 <- ModelDFSLt1_VMC8.16[-nrow(ModelDFSLt1_VMC8.16),]
    ModelDFSLt1_VMC8.18 <- ModelDFSLt1_VMC8.17[-nrow(ModelDFSLt1_VMC8.17),]
    ModelDFSLt1_VMC8.19 <- ModelDFSLt1_VMC8.18[-nrow(ModelDFSLt1_VMC8.18),]
    ModelDFSLt1_VMC8.20 <- ModelDFSLt1_VMC8.19[-nrow(ModelDFSLt1_VMC8.19),]
    ModelDFSLt1_VMC8.21 <- ModelDFSLt1_VMC8.20[-nrow(ModelDFSLt1_VMC8.20),]
    ModelDFSLt1_VMC8.22 <- ModelDFSLt1_VMC8.21[-nrow(ModelDFSLt1_VMC8.21),]
    ModelDFSLt1_VMC8.23 <- ModelDFSLt1_VMC8.22[-nrow(ModelDFSLt1_VMC8.22),]
    ModelDFSLt1_VMC8.24 <- ModelDFSLt1_VMC8.23[-nrow(ModelDFSLt1_VMC8.23),]

    ModelDFSLt1_VMC8 <- ModelDFSLt1_VMC8.24 #Create model t=x+1

    #Subtract model (t=x) - (t=x+1)
    ModelDFSL1y_VMC8 <- ModelDFSLt0_VMC8 - ModelDFSLt1_VMC8

    #Re-do Month Number column because the substraction was also applied to it
    ModelDFSL1y_VMC8$MNumber <- seq(from = 1, to = SimulationLength_months)

    #This model will be called VMC8P because implies a one-off input of C
    ModelDFSL_VMC8P <- ModelDFSL1y_VMC8

    #Export the dataframe
    write_xlsx(ModelDFSL_VMC8P,"VXP_Models\\ModelDFSL_R_VMC8P.xlsx")


    #Plot 3: Interactive Yearly CO2 emissions #
    MY <- 12
    ModelDFSL_VMC8P_YCO2 <- ModelDFSL_VMC8P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VMC8)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMC8P_YCO2) <- c("Year", "Months", "AnnualCO2_VMC_8")

    #Plot 3: Interactive Yearly CO2 emissions considering a delay
    GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
    ModelDFSL_VMC8P_YCO2D <- merge(ModelDFSL_VMC8P_YCO2, GWP100delay, by = "Year")
    ModelDFSL_VMC8P_YCO2D$AnnualCO2D_VMC_8 <- ModelDFSL_VMC8P_YCO2D$AnnualCO2_VMC_8 * ModelDFSL_VMC8P_YCO2D$GWP100


    #Plot 4: Interactive Yearly C emissions #
    MY <- 12
    ModelDFSL_VMC8P_YC <- ModelDFSL_VMC8P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VMC8)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMC8P_YC) <- c("Year", "Months", "CEmissions_VMC_8")

    #Plot 5: Interactive Yearly C tails (remaining C in Soil) #
    MY <- 12
    ModelDFSL_VMC8P_YCT <- ModelDFSL_VMC8P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VMC8)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMC8P_YCT) <- c("Year", "Months", "CTail_VMC_8")

    #Save Dataframes for Plots 3.1, 3.2, 4 and 5
    write_xlsx(ModelDFSL_VMC8P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VMC8P.xlsx") #Yearly CO2 emissions (no delay)
    write_xlsx(ModelDFSL_VMC8P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VMC8P.xlsx") #Yearly CO2 emissions (delay)
    write_xlsx(ModelDFSL_VMC8P_YC,"CEmissions_P\\ModelDFSL_R_CE_VMC8P.xlsx") #Yearly C emissions
    write_xlsx(ModelDFSL_VMC8P_YCT,"CTails_P\\ModelDFSL_R_CT_VMC8P.xlsx") #Yearly C emissions



    #### 10.10 - VMC9) Manure; 90%clay; Conventional tillage ####
    #The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
    fT_VMC9=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
    fW_VMC9=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                            S.Thick = soil.thick, pClay = clay100*0.9,
                            pE = 1.0, bare = FALSE)$b #Moisture effects per month
    xi.frame_VMC9=data.frame(years,rep(fT_VMC9*fW_VMC9,length.out=length(years)))

    #To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
    Model_VMC9=SoilR::RothCModel(
      t=years, #Simulation Length
      ks=c(k.DPM = 10*CTRM, k.RPM = 0.3*CTRM, k.BIO = 0.66*CTRM, k.HUM = 0.02*CTRM, k.IOM = 0*CTRM), #Decomposition rates for the different pools
      C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
      In=Scalar_LitterCinputs*0, #Amount of litter inputs by time
      FYM = Scalar_ManureCinputs*1, #Amount of Farm Yard Manure by time
      clay=clay100*0.9, #Percent clay in mineral soil
      xi=xi.frame_VMC9) #Loads the model

    Ct_VMC9=getC(Model_VMC9) #Calculates stocks for each pool per month

    #The results can be plotted with the commands
    matplot(years, Ct_VMC9, type="l", lty=1, col=1:5,
            xlab="Time (years)", ylab="C stocks (Mg/ha)")
    legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
           lty=1, col=1:5, bty="n")

    VEC_Lit_VMC9 <- rep(M_Scalar_LitterCinputs*0, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
    VEC_Man_VMC9 <- rep(M_Scalar_ManureCinputs*1, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

    VEC_LitDF_VMC9 <- as.data.frame(VEC_Lit_VMC9) #Converting the Litter vector to a data frame
    VEC_LitDF_VMC9$MNumber <- seq(from = 1, to = SimulationLength_months)
    VEC_ManDF_VMC9 <- as.data.frame(VEC_Man_VMC9) #Converting the Manure vector to a data frame
    VEC_ManDF_VMC9$MNumber <- seq(from = 1, to = SimulationLength_months)

    sapply(VEC_LitDF_VMC9, class) #Check that class is numeric
    sapply(VEC_ManDF_VMC9, class) #Check that class is numeric
    LitterCinputs_VMC9=VEC_LitDF_VMC9   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    ManureCinputs_VMC9=VEC_ManDF_VMC9 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    MCinputs_VMC9 <- merge(LitterCinputs_VMC9, ManureCinputs_VMC9, by = "MNumber")
    MCinputs_VMC9$MInput_VMC9 <- MCinputs_VMC9$VEC_Lit_VMC9 + MCinputs_VMC9$VEC_Man_VMC9

    #Change names of litter and manure columns for more common ones
    colnames(MCinputs_VMC9)[which(names(MCinputs_VMC9) == "VEC_Lit_VMC9")] <- "LitterC_VMC9"
    colnames(MCinputs_VMC9)[which(names(MCinputs_VMC9) == "VEC_Man_VMC9")] <- "ManureC_VMC9"

    #Create a dataframe with the data considering the simulation length
    ModelDF_VMC9 <- as.data.frame(Ct_VMC9)
    colnames(ModelDF_VMC9) <- c('DPM_VMC9','RPM_VMC9','BIO_VMC9', 'HUM_VMC9', 'IOM_VMC9')
    ModelDFS_VMC9 <- ModelDF_VMC9[1:SimulationLength_months, ]

    #Create a column with the number of month of analysis
    ModelDFS_VMC9$MNumber <- seq(from = 1, to = SimulationLength_months)

    #Create a column that sums all pools
    ModelDFS_VMC9$AllPools_VMC9 <- ModelDFS_VMC9$DPM_VMC9 + ModelDFS_VMC9$RPM_VMC9 + ModelDFS_VMC9$BIO_VMC9 + ModelDFS_VMC9$HUM_VMC9 + ModelDFS_VMC9$IOM_VMC9

    #Create a column that sums all pools except IOM (static)
    ModelDFS_VMC9$AllPools_noIOM_VMC9 <- ModelDFS_VMC9$DPM_VMC9 + ModelDFS_VMC9$RPM_VMC9 + ModelDFS_VMC9$BIO_VMC9 + ModelDFS_VMC9$HUM_VMC9

    #Create a column that add the monthly input of C (manure and litter separately)
    ModelDFSL_VMC9 <- merge(ModelDFS_VMC9, MCinputs_VMC9, by = "MNumber")

    ModelDFSL_VMC9$MInput_VMC9 <- ModelDFSL_VMC9$LitterC_VMC9 + ModelDFSL_VMC9$ManureC_VMC9
    #ModelDF_SL$MInput[1] <- 0

    #Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
    ModelDFSL_VMC9$CTails_VMC9 <- ModelDFSL_VMC9$AllPools_noIOM_VMC9 + ModelDFSL_VMC9$MInput_VMC9

    #Create Monthly Accumulated input of C
    ModelDFSL_VMC9$AccumInput_VMC9 = ModelDFSL_VMC9$AccumInput_VMC9=cumsum(ModelDFSL_VMC9$MInput_VMC9)

    #Create Monthly Growths for each carbon pool
    ModelDFSL_VMC9$MGrowth_DPM_VMC9 <- ave(ModelDFSL_VMC9$DPM_VMC9, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMC9$MGrowth_RPM_VMC9 <- ave(ModelDFSL_VMC9$RPM_VMC9, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMC9$MGrowth_BIO_VMC9 <- ave(ModelDFSL_VMC9$BIO_VMC9, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMC9$MGrowth_HUM_VMC9 <- ave(ModelDFSL_VMC9$HUM_VMC9, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMC9$MGrowth_IOM_VMC9 <- ave(ModelDFSL_VMC9$IOM_VMC9, FUN = function(x) c(0, diff(x)))

    #Create column for Monthly and Accumulated C-CO2 emissions
    ModelDFSL_VMC9$M_CCO2_VMC9 <- ModelDFSL_VMC9$MInput_VMC9 - ModelDFSL_VMC9$MGrowth_DPM_VMC9 - ModelDFSL_VMC9$MGrowth_RPM_VMC9 - ModelDFSL_VMC9$MGrowth_BIO_VMC9 - ModelDFSL_VMC9$MGrowth_HUM_VMC9
    ModelDFSL_VMC9$Accum_CCO2_VMC9 <- ModelDFSL_VMC9$AccumInput_VMC9 - ModelDFSL_VMC9$AllPools_noIOM_VMC9

    #Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
    ModelDFSL_VMC9$M_CCO2_VMC9[1] <- 0
    ModelDFSL_VMC9$Accum_CCO2_VMC9[1] <- 0

    #Balance validation
    ModelDFSL_VMC9$Balance_VMC9 <- ModelDFSL_VMC9$AccumInput_VMC9 - ModelDFSL_VMC9$Accum_CCO2_VMC9 - (ModelDFSL_VMC9$DPM_VMC9 + ModelDFSL_VMC9$RPM_VMC9 + ModelDFSL_VMC9$BIO_VMC9 + ModelDFSL_VMC9$HUM_VMC9)

    #Convert C-CO2 emissions into CO2 emissions
    ModelDFSL_VMC9$M_CO2_VMC9 <- ModelDFSL_VMC9$M_CCO2_VMC9 * 44/12
    ModelDFSL_VMC9$Accum_CO2_VMC9 <- ModelDFSL_VMC9$Accum_CCO2_VMC9 * 44/12

    #This model will be called VMC9C because implies a continuous input of C
    ModelDFSL_VMC9C <- ModelDFSL_VMC9

    #Export the dataframe
    write_xlsx(ModelDFSL_VMC9C,"VXC_Models\\ModelDFSL_R_VMC9C.xlsx")

    #Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
    #Create two equal models by using the above general script
    #Create model t=x
    ModelDFSLt0_VMC9 <- ModelDFSL_VMC9 #Create model t=x

    #Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
    ModelDFSLt1_VMC9.1 <- rbind(c(0:0), ModelDFSLt0_VMC9)
    ModelDFSLt1_VMC9.2 <- rbind(c(0:0), ModelDFSLt1_VMC9.1)
    ModelDFSLt1_VMC9.3 <- rbind(c(0:0), ModelDFSLt1_VMC9.2)
    ModelDFSLt1_VMC9.4 <- rbind(c(0:0), ModelDFSLt1_VMC9.3)
    ModelDFSLt1_VMC9.5 <- rbind(c(0:0), ModelDFSLt1_VMC9.4)
    ModelDFSLt1_VMC9.6 <- rbind(c(0:0), ModelDFSLt1_VMC9.5)
    ModelDFSLt1_VMC9.7 <- rbind(c(0:0), ModelDFSLt1_VMC9.6)
    ModelDFSLt1_VMC9.8 <- rbind(c(0:0), ModelDFSLt1_VMC9.7)
    ModelDFSLt1_VMC9.9 <- rbind(c(0:0), ModelDFSLt1_VMC9.8)
    ModelDFSLt1_VMC9.10 <- rbind(c(0:0), ModelDFSLt1_VMC9.9)
    ModelDFSLt1_VMC9.11 <- rbind(c(0:0), ModelDFSLt1_VMC9.10)
    ModelDFSLt1_VMC9.12 <- rbind(c(0:0), ModelDFSLt1_VMC9.11)
    ModelDFSLt1_VMC9.13 <- ModelDFSLt1_VMC9.12[-nrow(ModelDFSLt1_VMC9.12),]
    ModelDFSLt1_VMC9.14 <- ModelDFSLt1_VMC9.13[-nrow(ModelDFSLt1_VMC9.13),]
    ModelDFSLt1_VMC9.15 <- ModelDFSLt1_VMC9.14[-nrow(ModelDFSLt1_VMC9.14),]
    ModelDFSLt1_VMC9.16 <- ModelDFSLt1_VMC9.15[-nrow(ModelDFSLt1_VMC9.15),]
    ModelDFSLt1_VMC9.17 <- ModelDFSLt1_VMC9.16[-nrow(ModelDFSLt1_VMC9.16),]
    ModelDFSLt1_VMC9.18 <- ModelDFSLt1_VMC9.17[-nrow(ModelDFSLt1_VMC9.17),]
    ModelDFSLt1_VMC9.19 <- ModelDFSLt1_VMC9.18[-nrow(ModelDFSLt1_VMC9.18),]
    ModelDFSLt1_VMC9.20 <- ModelDFSLt1_VMC9.19[-nrow(ModelDFSLt1_VMC9.19),]
    ModelDFSLt1_VMC9.21 <- ModelDFSLt1_VMC9.20[-nrow(ModelDFSLt1_VMC9.20),]
    ModelDFSLt1_VMC9.22 <- ModelDFSLt1_VMC9.21[-nrow(ModelDFSLt1_VMC9.21),]
    ModelDFSLt1_VMC9.23 <- ModelDFSLt1_VMC9.22[-nrow(ModelDFSLt1_VMC9.22),]
    ModelDFSLt1_VMC9.24 <- ModelDFSLt1_VMC9.23[-nrow(ModelDFSLt1_VMC9.23),]

    ModelDFSLt1_VMC9 <- ModelDFSLt1_VMC9.24 #Create model t=x+1

    #Subtract model (t=x) - (t=x+1)
    ModelDFSL1y_VMC9 <- ModelDFSLt0_VMC9 - ModelDFSLt1_VMC9

    #Re-do Month Number column because the substraction was also applied to it
    ModelDFSL1y_VMC9$MNumber <- seq(from = 1, to = SimulationLength_months)

    #This model will be called VMC9P because implies a one-off input of C
    ModelDFSL_VMC9P <- ModelDFSL1y_VMC9

    #Export the dataframe
    write_xlsx(ModelDFSL_VMC9P,"VXP_Models\\ModelDFSL_R_VMC9P.xlsx")


    #Plot 3: Interactive Yearly CO2 emissions #
    MY <- 12
    ModelDFSL_VMC9P_YCO2 <- ModelDFSL_VMC9P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VMC9)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMC9P_YCO2) <- c("Year", "Months", "AnnualCO2_VMC_9")

    #Plot 3: Interactive Yearly CO2 emissions considering a delay
    GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
    ModelDFSL_VMC9P_YCO2D <- merge(ModelDFSL_VMC9P_YCO2, GWP100delay, by = "Year")
    ModelDFSL_VMC9P_YCO2D$AnnualCO2D_VMC_9 <- ModelDFSL_VMC9P_YCO2D$AnnualCO2_VMC_9 * ModelDFSL_VMC9P_YCO2D$GWP100


    #Plot 4: Interactive Yearly C emissions #
    MY <- 12
    ModelDFSL_VMC9P_YC <- ModelDFSL_VMC9P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VMC9)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMC9P_YC) <- c("Year", "Months", "CEmissions_VMC_9")

    #Plot 5: Interactive Yearly C tails (remaining C in Soil) #
    MY <- 12
    ModelDFSL_VMC9P_YCT <- ModelDFSL_VMC9P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VMC9)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMC9P_YCT) <- c("Year", "Months", "CTail_VMC_9")

    #Save Dataframes for Plots 3.1, 3.2, 4 and 5
    write_xlsx(ModelDFSL_VMC9P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VMC9P.xlsx") #Yearly CO2 emissions (no delay)
    write_xlsx(ModelDFSL_VMC9P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VMC9P.xlsx") #Yearly CO2 emissions (delay)
    write_xlsx(ModelDFSL_VMC9P_YC,"CEmissions_P\\ModelDFSL_R_CE_VMC9P.xlsx") #Yearly C emissions
    write_xlsx(ModelDFSL_VMC9P_YCT,"CTails_P\\ModelDFSL_R_CT_VMC9P.xlsx") #Yearly C emissions



    #### 10.11 - VMC10) Manure; 100%clay; Conventional tillage ####
    #The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
    fT_VMC10=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
    fW_VMC10=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                             S.Thick = soil.thick, pClay = clay100,
                             pE = 1.0, bare = FALSE)$b #Moisture effects per month
    xi.frame_VMC10=data.frame(years,rep(fT_VMC10*fW_VMC10,length.out=length(years)))

    #To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
    Model_VMC10=SoilR::RothCModel(
      t=years, #Simulation Length
      ks=c(k.DPM = 10*CTRM, k.RPM = 0.3*CTRM, k.BIO = 0.66*CTRM, k.HUM = 0.02*CTRM, k.IOM = 0*CTRM), #Decomposition rates for the different pools
      C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
      In=Scalar_LitterCinputs*0, #Amount of litter inputs by time
      FYM = Scalar_ManureCinputs*1, #Amount of Farm Yard Manure by time
      clay=clay100, #Percent clay in mineral soil
      xi=xi.frame_VMC10) #Loads the model

    Ct_VMC10=getC(Model_VMC10) #Calculates stocks for each pool per month

    #The results can be plotted with the commands
    matplot(years, Ct_VMC10, type="l", lty=1, col=1:5,
            xlab="Time (years)", ylab="C stocks (Mg/ha)")
    legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
           lty=1, col=1:5, bty="n")

    VEC_Lit_VMC10 <- rep(M_Scalar_LitterCinputs*0, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
    VEC_Man_VMC10 <- rep(M_Scalar_ManureCinputs*1, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

    VEC_LitDF_VMC10 <- as.data.frame(VEC_Lit_VMC10) #Converting the Litter vector to a data frame
    VEC_LitDF_VMC10$MNumber <- seq(from = 1, to = SimulationLength_months)
    VEC_ManDF_VMC10 <- as.data.frame(VEC_Man_VMC10) #Converting the Manure vector to a data frame
    VEC_ManDF_VMC10$MNumber <- seq(from = 1, to = SimulationLength_months)

    sapply(VEC_LitDF_VMC10, class) #Check that class is numeric
    sapply(VEC_ManDF_VMC10, class) #Check that class is numeric
    LitterCinputs_VMC10=VEC_LitDF_VMC10   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    ManureCinputs_VMC10=VEC_ManDF_VMC10 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    MCinputs_VMC10 <- merge(LitterCinputs_VMC10, ManureCinputs_VMC10, by = "MNumber")
    MCinputs_VMC10$MInput_VMC10 <- MCinputs_VMC10$VEC_Lit_VMC10 + MCinputs_VMC10$VEC_Man_VMC10

    #Change names of litter and manure columns for more common ones
    colnames(MCinputs_VMC10)[which(names(MCinputs_VMC10) == "VEC_Lit_VMC10")] <- "LitterC_VMC10"
    colnames(MCinputs_VMC10)[which(names(MCinputs_VMC10) == "VEC_Man_VMC10")] <- "ManureC_VMC10"

    #Create a dataframe with the data considering the simulation length
    ModelDF_VMC10 <- as.data.frame(Ct_VMC10)
    colnames(ModelDF_VMC10) <- c('DPM_VMC10','RPM_VMC10','BIO_VMC10', 'HUM_VMC10', 'IOM_VMC10')
    ModelDFS_VMC10 <- ModelDF_VMC10[1:SimulationLength_months, ]

    #Create a column with the number of month of analysis
    ModelDFS_VMC10$MNumber <- seq(from = 1, to = SimulationLength_months)

    #Create a column that sums all pools
    ModelDFS_VMC10$AllPools_VMC10 <- ModelDFS_VMC10$DPM_VMC10 + ModelDFS_VMC10$RPM_VMC10 + ModelDFS_VMC10$BIO_VMC10 + ModelDFS_VMC10$HUM_VMC10 + ModelDFS_VMC10$IOM_VMC10

    #Create a column that sums all pools except IOM (static)
    ModelDFS_VMC10$AllPools_noIOM_VMC10 <- ModelDFS_VMC10$DPM_VMC10 + ModelDFS_VMC10$RPM_VMC10 + ModelDFS_VMC10$BIO_VMC10 + ModelDFS_VMC10$HUM_VMC10

    #Create a column that add the monthly input of C (manure and litter separately)
    ModelDFSL_VMC10 <- merge(ModelDFS_VMC10, MCinputs_VMC10, by = "MNumber")

    ModelDFSL_VMC10$MInput_VMC10 <- ModelDFSL_VMC10$LitterC_VMC10 + ModelDFSL_VMC10$ManureC_VMC10
    #ModelDF_SL$MInput[1] <- 0

    #Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
    ModelDFSL_VMC10$CTails_VMC10 <- ModelDFSL_VMC10$AllPools_noIOM_VMC10 + ModelDFSL_VMC10$MInput_VMC10

    #Create Monthly Accumulated input of C
    ModelDFSL_VMC10$AccumInput_VMC10 = ModelDFSL_VMC10$AccumInput_VMC10=cumsum(ModelDFSL_VMC10$MInput_VMC10)

    #Create Monthly Growths for each carbon pool
    ModelDFSL_VMC10$MGrowth_DPM_VMC10 <- ave(ModelDFSL_VMC10$DPM_VMC10, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMC10$MGrowth_RPM_VMC10 <- ave(ModelDFSL_VMC10$RPM_VMC10, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMC10$MGrowth_BIO_VMC10 <- ave(ModelDFSL_VMC10$BIO_VMC10, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMC10$MGrowth_HUM_VMC10 <- ave(ModelDFSL_VMC10$HUM_VMC10, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMC10$MGrowth_IOM_VMC10 <- ave(ModelDFSL_VMC10$IOM_VMC10, FUN = function(x) c(0, diff(x)))

    #Create column for Monthly and Accumulated C-CO2 emissions
    ModelDFSL_VMC10$M_CCO2_VMC10 <- ModelDFSL_VMC10$MInput_VMC10 - ModelDFSL_VMC10$MGrowth_DPM_VMC10 - ModelDFSL_VMC10$MGrowth_RPM_VMC10 - ModelDFSL_VMC10$MGrowth_BIO_VMC10 - ModelDFSL_VMC10$MGrowth_HUM_VMC10
    ModelDFSL_VMC10$Accum_CCO2_VMC10 <- ModelDFSL_VMC10$AccumInput_VMC10 - ModelDFSL_VMC10$AllPools_noIOM_VMC10

    #Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
    ModelDFSL_VMC10$M_CCO2_VMC10[1] <- 0
    ModelDFSL_VMC10$Accum_CCO2_VMC10[1] <- 0

    #Balance validation
    ModelDFSL_VMC10$Balance_VMC10 <- ModelDFSL_VMC10$AccumInput_VMC10 - ModelDFSL_VMC10$Accum_CCO2_VMC10 - (ModelDFSL_VMC10$DPM_VMC10 + ModelDFSL_VMC10$RPM_VMC10 + ModelDFSL_VMC10$BIO_VMC10 + ModelDFSL_VMC10$HUM_VMC10)

    #Convert C-CO2 emissions into CO2 emissions
    ModelDFSL_VMC10$M_CO2_VMC10 <- ModelDFSL_VMC10$M_CCO2_VMC10 * 44/12
    ModelDFSL_VMC10$Accum_CO2_VMC10 <- ModelDFSL_VMC10$Accum_CCO2_VMC10 * 44/12

    #This model will be called VMC10C because implies a continuous input of C
    ModelDFSL_VMC10C <- ModelDFSL_VMC10

    #Export the dataframe
    write_xlsx(ModelDFSL_VMC10C,"VXC_Models\\ModelDFSL_R_VMC10C.xlsx")

    #Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
    #Create two equal models by using the above general script
    #Create model t=x
    ModelDFSLt0_VMC10 <- ModelDFSL_VMC10 #Create model t=x

    #Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
    ModelDFSLt1_VMC10.1 <- rbind(c(0:0), ModelDFSLt0_VMC10)
    ModelDFSLt1_VMC10.2 <- rbind(c(0:0), ModelDFSLt1_VMC10.1)
    ModelDFSLt1_VMC10.3 <- rbind(c(0:0), ModelDFSLt1_VMC10.2)
    ModelDFSLt1_VMC10.4 <- rbind(c(0:0), ModelDFSLt1_VMC10.3)
    ModelDFSLt1_VMC10.5 <- rbind(c(0:0), ModelDFSLt1_VMC10.4)
    ModelDFSLt1_VMC10.6 <- rbind(c(0:0), ModelDFSLt1_VMC10.5)
    ModelDFSLt1_VMC10.7 <- rbind(c(0:0), ModelDFSLt1_VMC10.6)
    ModelDFSLt1_VMC10.8 <- rbind(c(0:0), ModelDFSLt1_VMC10.7)
    ModelDFSLt1_VMC10.9 <- rbind(c(0:0), ModelDFSLt1_VMC10.8)
    ModelDFSLt1_VMC10.10 <- rbind(c(0:0), ModelDFSLt1_VMC10.9)
    ModelDFSLt1_VMC10.11 <- rbind(c(0:0), ModelDFSLt1_VMC10.10)
    ModelDFSLt1_VMC10.12 <- rbind(c(0:0), ModelDFSLt1_VMC10.11)
    ModelDFSLt1_VMC10.13 <- ModelDFSLt1_VMC10.12[-nrow(ModelDFSLt1_VMC10.12),]
    ModelDFSLt1_VMC10.14 <- ModelDFSLt1_VMC10.13[-nrow(ModelDFSLt1_VMC10.13),]
    ModelDFSLt1_VMC10.15 <- ModelDFSLt1_VMC10.14[-nrow(ModelDFSLt1_VMC10.14),]
    ModelDFSLt1_VMC10.16 <- ModelDFSLt1_VMC10.15[-nrow(ModelDFSLt1_VMC10.15),]
    ModelDFSLt1_VMC10.17 <- ModelDFSLt1_VMC10.16[-nrow(ModelDFSLt1_VMC10.16),]
    ModelDFSLt1_VMC10.18 <- ModelDFSLt1_VMC10.17[-nrow(ModelDFSLt1_VMC10.17),]
    ModelDFSLt1_VMC10.19 <- ModelDFSLt1_VMC10.18[-nrow(ModelDFSLt1_VMC10.18),]
    ModelDFSLt1_VMC10.20 <- ModelDFSLt1_VMC10.19[-nrow(ModelDFSLt1_VMC10.19),]
    ModelDFSLt1_VMC10.21 <- ModelDFSLt1_VMC10.20[-nrow(ModelDFSLt1_VMC10.20),]
    ModelDFSLt1_VMC10.22 <- ModelDFSLt1_VMC10.21[-nrow(ModelDFSLt1_VMC10.21),]
    ModelDFSLt1_VMC10.23 <- ModelDFSLt1_VMC10.22[-nrow(ModelDFSLt1_VMC10.22),]
    ModelDFSLt1_VMC10.24 <- ModelDFSLt1_VMC10.23[-nrow(ModelDFSLt1_VMC10.23),]

    ModelDFSLt1_VMC10 <- ModelDFSLt1_VMC10.24 #Create model t=x+1

    #Subtract model (t=x) - (t=x+1)
    ModelDFSL1y_VMC10 <- ModelDFSLt0_VMC10 - ModelDFSLt1_VMC10

    #Re-do Month Number column because the substraction was also applied to it
    ModelDFSL1y_VMC10$MNumber <- seq(from = 1, to = SimulationLength_months)

    #This model will be called VMC10P because implies a one-off input of C
    ModelDFSL_VMC10P <- ModelDFSL1y_VMC10

    #Export the dataframe
    write_xlsx(ModelDFSL_VMC10P,"VXP_Models\\ModelDFSL_R_VMC10P.xlsx")


    #Plot 3: Interactive Yearly CO2 emissions #
    MY <- 12
    ModelDFSL_VMC10P_YCO2 <- ModelDFSL_VMC10P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VMC10)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMC10P_YCO2) <- c("Year", "Months", "AnnualCO2_VMC10")

    #Plot 3: Interactive Yearly CO2 emissions considering a delay
    GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
    ModelDFSL_VMC10P_YCO2D <- merge(ModelDFSL_VMC10P_YCO2, GWP100delay, by = "Year")
    ModelDFSL_VMC10P_YCO2D$AnnualCO2D_VMC10 <- ModelDFSL_VMC10P_YCO2D$AnnualCO2_VMC10 * ModelDFSL_VMC10P_YCO2D$GWP100

    #Plot 4: Interactive Yearly C emissions #
    MY <- 12
    ModelDFSL_VMC10P_YC <- ModelDFSL_VMC10P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VMC10)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMC10P_YC) <- c("Year", "Months", "CEmissions_VMC10")

    #Plot 5: Interactive Yearly C tails (remaining C in Soil) #
    MY <- 12
    ModelDFSL_VMC10P_YCT <- ModelDFSL_VMC10P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VMC10)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMC10P_YCT) <- c("Year", "Months", "CTail_VMC10")

    #Save Dataframes for Plots 3.1, 3.2, 4 and 5
    write_xlsx(ModelDFSL_VMC10P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VMC10P.xlsx") #Yearly CO2 emissions (no delay)
    write_xlsx(ModelDFSL_VMC10P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VMC10P.xlsx") #Yearly CO2 emissions (delay)
    write_xlsx(ModelDFSL_VMC10P_YC,"CEmissions_P\\ModelDFSL_R_CE_VMC10P.xlsx") #Yearly C emissions
    write_xlsx(ModelDFSL_VMC10P_YCT,"CTails_P\\ModelDFSL_R_CT_VMC10P.xlsx") #Yearly C emissions

  }
  else if(Scope == "VMR"){
    #### 11) Model Combinations - Manure; Reduced Tillage, 0-100% (+10%) Clay ####
    #### 11.1 - VMR0) Manure; 0%clay; Reduced Tillage ####
    #The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
    fT_VMR0=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
    fW_VMR0=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                            S.Thick = soil.thick, pClay = clay0,
                            pE = 1.0, bare = FALSE)$b #Moisture effects per month
    xi.frame_VMR0=data.frame(years,rep(fT_VMR0*fW_VMR0,length.out=length(years)))

    #To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
    Model_VMR0=SoilR::RothCModel(
      t=years, #Simulation Length
      ks=c(k.DPM = 10*RTRM, k.RPM = 0.3*RTRM, k.BIO = 0.66*RTRM, k.HUM = 0.02*RTRM, k.IOM = 0*RTRM), #Decomposition rates for the different pools
      C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
      In=Scalar_LitterCinputs*0, #Amount of litter inputs by time
      FYM = Scalar_ManureCinputs*1, #Amount of Farm Yard Manure by time
      clay=clay0, #Percent clay in mineral soil
      xi=xi.frame_VMR0) #Loads the model

    Ct_VMR0=getC(Model_VMR0) #Calculates stocks for each pool per month

    VEC_Lit_VMR0 <- rep(M_Scalar_LitterCinputs*0, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
    VEC_Man_VMR0 <- rep(M_Scalar_ManureCinputs*1, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

    VEC_LitDF_VMR0 <- as.data.frame(VEC_Lit_VMR0) #Converting the Litter vector to a data frame
    VEC_LitDF_VMR0$MNumber <- seq(from = 1, to = SimulationLength_months)
    VEC_ManDF_VMR0 <- as.data.frame(VEC_Man_VMR0) #Converting the Manure vector to a data frame
    VEC_ManDF_VMR0$MNumber <- seq(from = 1, to = SimulationLength_months)

    sapply(VEC_LitDF_VMR0, class) #Check that class is numeric
    sapply(VEC_ManDF_VMR0, class) #Check that class is numeric
    LitterCinputs_VMR0=VEC_LitDF_VMR0   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    ManureCinputs_VMR0=VEC_ManDF_VMR0 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    MCinputs_VMR0 <- merge(LitterCinputs_VMR0, ManureCinputs_VMR0, by = "MNumber")
    MCinputs_VMR0$MInput_VMR0 <- MCinputs_VMR0$VEC_Lit_VMR0 + MCinputs_VMR0$VEC_Man_VMR0

    #Change names of litter and manure columns for more common ones
    colnames(MCinputs_VMR0)[which(names(MCinputs_VMR0) == "VEC_Lit_VMR0")] <- "LitterC_VMR0"
    colnames(MCinputs_VMR0)[which(names(MCinputs_VMR0) == "VEC_Man_VMR0")] <- "ManureC_VMR0"

    #Create a dataframe with the data considering the simulation length
    ModelDF_VMR0 <- as.data.frame(Ct_VMR0)
    colnames(ModelDF_VMR0) <- c('DPM_VMR0','RPM_VMR0','BIO_VMR0', 'HUM_VMR0', 'IOM_VMR0')
    ModelDFS_VMR0 <- ModelDF_VMR0[1:SimulationLength_months, ]

    #Create a column with the number of month of analysis
    ModelDFS_VMR0$MNumber <- seq(from = 1, to = SimulationLength_months)

    #Create a column that sums all pools
    ModelDFS_VMR0$AllPools_VMR0 <- ModelDFS_VMR0$DPM_VMR0 + ModelDFS_VMR0$RPM_VMR0 + ModelDFS_VMR0$BIO_VMR0 + ModelDFS_VMR0$HUM_VMR0 + ModelDFS_VMR0$IOM_VMR0

    #Create a column that sums all pools except IOM (static)
    ModelDFS_VMR0$AllPools_noIOM_VMR0 <- ModelDFS_VMR0$DPM_VMR0 + ModelDFS_VMR0$RPM_VMR0 + ModelDFS_VMR0$BIO_VMR0 + ModelDFS_VMR0$HUM_VMR0

    #Create a column that add the monthly input of C (manure and litter separately)
    ModelDFSL_VMR0 <- merge(ModelDFS_VMR0, MCinputs_VMR0, by = "MNumber")

    ModelDFSL_VMR0$MInput_VMR0 <- ModelDFSL_VMR0$LitterC_VMR0 + ModelDFSL_VMR0$ManureC_VMR0
    #ModelDF_SL$MInput[1] <- 0

    #Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
    ModelDFSL_VMR0$CTails_VMR0 <- ModelDFSL_VMR0$AllPools_noIOM_VMR0 + ModelDFSL_VMR0$MInput_VMR0

    #Create Monthly Accumulated input of C
    ModelDFSL_VMR0$AccumInput_VMR0 = ModelDFSL_VMR0$AccumInput_VMR0=cumsum(ModelDFSL_VMR0$MInput_VMR0)

    #Create Monthly Growths for each carbon pool
    ModelDFSL_VMR0$MGrowth_DPM_VMR0 <- ave(ModelDFSL_VMR0$DPM_VMR0, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMR0$MGrowth_RPM_VMR0 <- ave(ModelDFSL_VMR0$RPM_VMR0, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMR0$MGrowth_BIO_VMR0 <- ave(ModelDFSL_VMR0$BIO_VMR0, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMR0$MGrowth_HUM_VMR0 <- ave(ModelDFSL_VMR0$HUM_VMR0, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMR0$MGrowth_IOM_VMR0 <- ave(ModelDFSL_VMR0$IOM_VMR0, FUN = function(x) c(0, diff(x)))

    #Create column for Monthly and Accumulated C-CO2 emissions
    ModelDFSL_VMR0$M_CCO2_VMR0 <- ModelDFSL_VMR0$MInput_VMR0 - ModelDFSL_VMR0$MGrowth_DPM_VMR0 - ModelDFSL_VMR0$MGrowth_RPM_VMR0 - ModelDFSL_VMR0$MGrowth_BIO_VMR0 - ModelDFSL_VMR0$MGrowth_HUM_VMR0
    ModelDFSL_VMR0$Accum_CCO2_VMR0 <- ModelDFSL_VMR0$AccumInput_VMR0 - ModelDFSL_VMR0$AllPools_noIOM_VMR0

    #Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
    ModelDFSL_VMR0$M_CCO2_VMR0[1] <- 0
    ModelDFSL_VMR0$Accum_CCO2_VMR0[1] <- 0

    #Balance validation
    ModelDFSL_VMR0$Balance_VMR0 <- ModelDFSL_VMR0$AccumInput_VMR0 - ModelDFSL_VMR0$Accum_CCO2_VMR0 - (ModelDFSL_VMR0$DPM_VMR0 + ModelDFSL_VMR0$RPM_VMR0 + ModelDFSL_VMR0$BIO_VMR0 + ModelDFSL_VMR0$HUM_VMR0)

    #Convert C-CO2 emissions into CO2 emissions
    ModelDFSL_VMR0$M_CO2_VMR0 <- ModelDFSL_VMR0$M_CCO2_VMR0 * 44/12
    ModelDFSL_VMR0$Accum_CO2_VMR0 <- ModelDFSL_VMR0$Accum_CCO2_VMR0 * 44/12

    #This model will be called VMR0C because implies a continuous input of C
    ModelDFSL_VMR0C <- ModelDFSL_VMR0

    #Export the dataframe
    write_xlsx(ModelDFSL_VMR0C,"VXC_Models\\ModelDFSL_R_VMR0C.xlsx")

    #Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
    #Create two equal models by using the above general script
    #Create model t=x
    ModelDFSLt0_VMR0 <- ModelDFSL_VMR0 #Create model t=x

    #Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
    ModelDFSLt1_VMR0.1 <- rbind(c(0:0), ModelDFSLt0_VMR0)
    ModelDFSLt1_VMR0.2 <- rbind(c(0:0), ModelDFSLt1_VMR0.1)
    ModelDFSLt1_VMR0.3 <- rbind(c(0:0), ModelDFSLt1_VMR0.2)
    ModelDFSLt1_VMR0.4 <- rbind(c(0:0), ModelDFSLt1_VMR0.3)
    ModelDFSLt1_VMR0.5 <- rbind(c(0:0), ModelDFSLt1_VMR0.4)
    ModelDFSLt1_VMR0.6 <- rbind(c(0:0), ModelDFSLt1_VMR0.5)
    ModelDFSLt1_VMR0.7 <- rbind(c(0:0), ModelDFSLt1_VMR0.6)
    ModelDFSLt1_VMR0.8 <- rbind(c(0:0), ModelDFSLt1_VMR0.7)
    ModelDFSLt1_VMR0.9 <- rbind(c(0:0), ModelDFSLt1_VMR0.8)
    ModelDFSLt1_VMR0.10 <- rbind(c(0:0), ModelDFSLt1_VMR0.9)
    ModelDFSLt1_VMR0.11 <- rbind(c(0:0), ModelDFSLt1_VMR0.10)
    ModelDFSLt1_VMR0.12 <- rbind(c(0:0), ModelDFSLt1_VMR0.11)
    ModelDFSLt1_VMR0.13 <- ModelDFSLt1_VMR0.12[-nrow(ModelDFSLt1_VMR0.12),]
    ModelDFSLt1_VMR0.14 <- ModelDFSLt1_VMR0.13[-nrow(ModelDFSLt1_VMR0.13),]
    ModelDFSLt1_VMR0.15 <- ModelDFSLt1_VMR0.14[-nrow(ModelDFSLt1_VMR0.14),]
    ModelDFSLt1_VMR0.16 <- ModelDFSLt1_VMR0.15[-nrow(ModelDFSLt1_VMR0.15),]
    ModelDFSLt1_VMR0.17 <- ModelDFSLt1_VMR0.16[-nrow(ModelDFSLt1_VMR0.16),]
    ModelDFSLt1_VMR0.18 <- ModelDFSLt1_VMR0.17[-nrow(ModelDFSLt1_VMR0.17),]
    ModelDFSLt1_VMR0.19 <- ModelDFSLt1_VMR0.18[-nrow(ModelDFSLt1_VMR0.18),]
    ModelDFSLt1_VMR0.20 <- ModelDFSLt1_VMR0.19[-nrow(ModelDFSLt1_VMR0.19),]
    ModelDFSLt1_VMR0.21 <- ModelDFSLt1_VMR0.20[-nrow(ModelDFSLt1_VMR0.20),]
    ModelDFSLt1_VMR0.22 <- ModelDFSLt1_VMR0.21[-nrow(ModelDFSLt1_VMR0.21),]
    ModelDFSLt1_VMR0.23 <- ModelDFSLt1_VMR0.22[-nrow(ModelDFSLt1_VMR0.22),]
    ModelDFSLt1_VMR0.24 <- ModelDFSLt1_VMR0.23[-nrow(ModelDFSLt1_VMR0.23),]

    ModelDFSLt1_VMR0 <- ModelDFSLt1_VMR0.24 #Create model t=x+1

    #Subtract model (t=x) - (t=x+1)
    ModelDFSL1y_VMR0 <- ModelDFSLt0_VMR0 - ModelDFSLt1_VMR0

    #Re-do Month Number column because the substraction was also applied to it
    ModelDFSL1y_VMR0$MNumber <- seq(from = 1, to = SimulationLength_months)

    #This model will be called VMR0P because implies a one-off input of C
    ModelDFSL_VMR0P <- ModelDFSL1y_VMR0

    #Export the dataframe
    write_xlsx(ModelDFSL_VMR0P,"VXP_Models\\ModelDFSL_R_VMR0P.xlsx")

    #Plot 3.1: Interactive Yearly CO2 emissions #
    MY <- 12
    ModelDFSL_VMR0P_YCO2 <- ModelDFSL_VMR0P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VMR0)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMR0P_YCO2) <- c("Year", "Months", "AnnualCO2_VMR_0")

    #Plot 3.2: Interactive Yearly CO2 emissions considering a delay
    GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
    ModelDFSL_VMR0P_YCO2D <- merge(ModelDFSL_VMR0P_YCO2, GWP100delay, by = "Year")
    ModelDFSL_VMR0P_YCO2D$AnnualCO2D_VMR_0 <- ModelDFSL_VMR0P_YCO2D$AnnualCO2_VMR_0 * ModelDFSL_VMR0P_YCO2D$GWP100

    #Plot 4: Interactive Yearly C emissions #
    MY <- 12
    ModelDFSL_VMR0P_YC <- ModelDFSL_VMR0P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VMR0)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMR0P_YC) <- c("Year", "Months", "CEmissions_VMR_0")

    #Plot 5: Interactive Yearly C tails (remaining C in Soil) #
    MY <- 12
    ModelDFSL_VMR0P_YCT <- ModelDFSL_VMR0P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VMR0)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMR0P_YCT) <- c("Year", "Months", "CTail_VMR_0")

    #Save Dataframes for Plots 3.1, 3.2, 4 and 5
    write_xlsx(ModelDFSL_VMR0P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VMR0P.xlsx") #Yearly CO2 emissions (no delay)
    write_xlsx(ModelDFSL_VMR0P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VMR0P.xlsx") #Yearly CO2 emissions (delay)
    write_xlsx(ModelDFSL_VMR0P_YC,"CEmissions_P\\ModelDFSL_R_CE_VMR0P.xlsx") #Yearly C emissions
    write_xlsx(ModelDFSL_VMR0P_YCT,"CTails_P\\ModelDFSL_R_CT_VMR0P.xlsx") #Yearly C emissions


    #### 11.2 - VMR1) Manure; 10%clay; Reduced Tillage ####
    #The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
    fT_VMR1=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
    fW_VMR1=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                            S.Thick = soil.thick, pClay = clay100*0.1,
                            pE = 1.0, bare = FALSE)$b #Moisture effects per month
    xi.frame_VMR1=data.frame(years,rep(fT_VMR1*fW_VMR1,length.out=length(years)))

    #To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
    Model_VMR1=SoilR::RothCModel(
      t=years, #Simulation Length
      ks=c(k.DPM = 10*RTRM, k.RPM = 0.3*RTRM, k.BIO = 0.66*RTRM, k.HUM = 0.02*RTRM, k.IOM = 0*RTRM), #Decomposition rates for the different pools
      C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
      In=Scalar_LitterCinputs*0, #Amount of litter inputs by time
      FYM = Scalar_ManureCinputs*1, #Amount of Farm Yard Manure by time
      clay=clay100*0.1, #Percent clay in mineral soil
      xi=xi.frame_VMR1) #Loads the model

    Ct_VMR1=getC(Model_VMR1) #Calculates stocks for each pool per month

    #The results can be plotted with the commands
    matplot(years, Ct_VMR1, type="l", lty=1, col=1:5,
            xlab="Time (years)", ylab="C stocks (Mg/ha)")
    legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
           lty=1, col=1:5, bty="n")

    VEC_Lit_VMR1 <- rep(M_Scalar_LitterCinputs*0, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
    VEC_Man_VMR1 <- rep(M_Scalar_ManureCinputs*1, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

    VEC_LitDF_VMR1 <- as.data.frame(VEC_Lit_VMR1) #Converting the Litter vector to a data frame
    VEC_LitDF_VMR1$MNumber <- seq(from = 1, to = SimulationLength_months)
    VEC_ManDF_VMR1 <- as.data.frame(VEC_Man_VMR1) #Converting the Manure vector to a data frame
    VEC_ManDF_VMR1$MNumber <- seq(from = 1, to = SimulationLength_months)

    sapply(VEC_LitDF_VMR1, class) #Check that class is numeric
    sapply(VEC_ManDF_VMR1, class) #Check that class is numeric
    LitterCinputs_VMR1=VEC_LitDF_VMR1   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    ManureCinputs_VMR1=VEC_ManDF_VMR1 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    MCinputs_VMR1 <- merge(LitterCinputs_VMR1, ManureCinputs_VMR1, by = "MNumber")
    MCinputs_VMR1$MInput_VMR1 <- MCinputs_VMR1$VEC_Lit_VMR1 + MCinputs_VMR1$VEC_Man_VMR1

    #Change names of litter and manure columns for more common ones
    colnames(MCinputs_VMR1)[which(names(MCinputs_VMR1) == "VEC_Lit_VMR1")] <- "LitterC_VMR1"
    colnames(MCinputs_VMR1)[which(names(MCinputs_VMR1) == "VEC_Man_VMR1")] <- "ManureC_VMR1"

    #Create a dataframe with the data considering the simulation length
    ModelDF_VMR1 <- as.data.frame(Ct_VMR1)
    colnames(ModelDF_VMR1) <- c('DPM_VMR1','RPM_VMR1','BIO_VMR1', 'HUM_VMR1', 'IOM_VMR1')
    ModelDFS_VMR1 <- ModelDF_VMR1[1:SimulationLength_months, ]

    #Create a column with the number of month of analysis
    ModelDFS_VMR1$MNumber <- seq(from = 1, to = SimulationLength_months)

    #Create a column that sums all pools
    ModelDFS_VMR1$AllPools_VMR1 <- ModelDFS_VMR1$DPM_VMR1 + ModelDFS_VMR1$RPM_VMR1 + ModelDFS_VMR1$BIO_VMR1 + ModelDFS_VMR1$HUM_VMR1 + ModelDFS_VMR1$IOM_VMR1

    #Create a column that sums all pools except IOM (static)
    ModelDFS_VMR1$AllPools_noIOM_VMR1 <- ModelDFS_VMR1$DPM_VMR1 + ModelDFS_VMR1$RPM_VMR1 + ModelDFS_VMR1$BIO_VMR1 + ModelDFS_VMR1$HUM_VMR1

    #Create a column that add the monthly input of C (manure and litter separately)
    ModelDFSL_VMR1 <- merge(ModelDFS_VMR1, MCinputs_VMR1, by = "MNumber")

    ModelDFSL_VMR1$MInput_VMR1 <- ModelDFSL_VMR1$LitterC_VMR1 + ModelDFSL_VMR1$ManureC_VMR1
    #ModelDF_SL$MInput[1] <- 0

    #Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
    ModelDFSL_VMR1$CTails_VMR1 <- ModelDFSL_VMR1$AllPools_noIOM_VMR1 + ModelDFSL_VMR1$MInput_VMR1

    #Create Monthly Accumulated input of C
    ModelDFSL_VMR1$AccumInput_VMR1 = ModelDFSL_VMR1$AccumInput_VMR1=cumsum(ModelDFSL_VMR1$MInput_VMR1)

    #Create Monthly Growths for each carbon pool
    ModelDFSL_VMR1$MGrowth_DPM_VMR1 <- ave(ModelDFSL_VMR1$DPM_VMR1, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMR1$MGrowth_RPM_VMR1 <- ave(ModelDFSL_VMR1$RPM_VMR1, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMR1$MGrowth_BIO_VMR1 <- ave(ModelDFSL_VMR1$BIO_VMR1, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMR1$MGrowth_HUM_VMR1 <- ave(ModelDFSL_VMR1$HUM_VMR1, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMR1$MGrowth_IOM_VMR1 <- ave(ModelDFSL_VMR1$IOM_VMR1, FUN = function(x) c(0, diff(x)))

    #Create column for Monthly and Accumulated C-CO2 emissions
    ModelDFSL_VMR1$M_CCO2_VMR1 <- ModelDFSL_VMR1$MInput_VMR1 - ModelDFSL_VMR1$MGrowth_DPM_VMR1 - ModelDFSL_VMR1$MGrowth_RPM_VMR1 - ModelDFSL_VMR1$MGrowth_BIO_VMR1 - ModelDFSL_VMR1$MGrowth_HUM_VMR1
    ModelDFSL_VMR1$Accum_CCO2_VMR1 <- ModelDFSL_VMR1$AccumInput_VMR1 - ModelDFSL_VMR1$AllPools_noIOM_VMR1

    #Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
    ModelDFSL_VMR1$M_CCO2_VMR1[1] <- 0
    ModelDFSL_VMR1$Accum_CCO2_VMR1[1] <- 0

    #Balance validation
    ModelDFSL_VMR1$Balance_VMR1 <- ModelDFSL_VMR1$AccumInput_VMR1 - ModelDFSL_VMR1$Accum_CCO2_VMR1 - (ModelDFSL_VMR1$DPM_VMR1 + ModelDFSL_VMR1$RPM_VMR1 + ModelDFSL_VMR1$BIO_VMR1 + ModelDFSL_VMR1$HUM_VMR1)

    #Convert C-CO2 emissions into CO2 emissions
    ModelDFSL_VMR1$M_CO2_VMR1 <- ModelDFSL_VMR1$M_CCO2_VMR1 * 44/12
    ModelDFSL_VMR1$Accum_CO2_VMR1 <- ModelDFSL_VMR1$Accum_CCO2_VMR1 * 44/12

    #This model will be called VMR1C because implies a continuous input of C
    ModelDFSL_VMR1C <- ModelDFSL_VMR1

    #Export the dataframe
    write_xlsx(ModelDFSL_VMR1C,"VXC_Models\\ModelDFSL_R_VMR1C.xlsx")

    #Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
    #Create two equal models by using the above general script
    #Create model t=x
    ModelDFSLt0_VMR1 <- ModelDFSL_VMR1 #Create model t=x

    #Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
    ModelDFSLt1_VMR1.1 <- rbind(c(0:0), ModelDFSLt0_VMR1)
    ModelDFSLt1_VMR1.2 <- rbind(c(0:0), ModelDFSLt1_VMR1.1)
    ModelDFSLt1_VMR1.3 <- rbind(c(0:0), ModelDFSLt1_VMR1.2)
    ModelDFSLt1_VMR1.4 <- rbind(c(0:0), ModelDFSLt1_VMR1.3)
    ModelDFSLt1_VMR1.5 <- rbind(c(0:0), ModelDFSLt1_VMR1.4)
    ModelDFSLt1_VMR1.6 <- rbind(c(0:0), ModelDFSLt1_VMR1.5)
    ModelDFSLt1_VMR1.7 <- rbind(c(0:0), ModelDFSLt1_VMR1.6)
    ModelDFSLt1_VMR1.8 <- rbind(c(0:0), ModelDFSLt1_VMR1.7)
    ModelDFSLt1_VMR1.9 <- rbind(c(0:0), ModelDFSLt1_VMR1.8)
    ModelDFSLt1_VMR1.10 <- rbind(c(0:0), ModelDFSLt1_VMR1.9)
    ModelDFSLt1_VMR1.11 <- rbind(c(0:0), ModelDFSLt1_VMR1.10)
    ModelDFSLt1_VMR1.12 <- rbind(c(0:0), ModelDFSLt1_VMR1.11)
    ModelDFSLt1_VMR1.13 <- ModelDFSLt1_VMR1.12[-nrow(ModelDFSLt1_VMR1.12),]
    ModelDFSLt1_VMR1.14 <- ModelDFSLt1_VMR1.13[-nrow(ModelDFSLt1_VMR1.13),]
    ModelDFSLt1_VMR1.15 <- ModelDFSLt1_VMR1.14[-nrow(ModelDFSLt1_VMR1.14),]
    ModelDFSLt1_VMR1.16 <- ModelDFSLt1_VMR1.15[-nrow(ModelDFSLt1_VMR1.15),]
    ModelDFSLt1_VMR1.17 <- ModelDFSLt1_VMR1.16[-nrow(ModelDFSLt1_VMR1.16),]
    ModelDFSLt1_VMR1.18 <- ModelDFSLt1_VMR1.17[-nrow(ModelDFSLt1_VMR1.17),]
    ModelDFSLt1_VMR1.19 <- ModelDFSLt1_VMR1.18[-nrow(ModelDFSLt1_VMR1.18),]
    ModelDFSLt1_VMR1.20 <- ModelDFSLt1_VMR1.19[-nrow(ModelDFSLt1_VMR1.19),]
    ModelDFSLt1_VMR1.21 <- ModelDFSLt1_VMR1.20[-nrow(ModelDFSLt1_VMR1.20),]
    ModelDFSLt1_VMR1.22 <- ModelDFSLt1_VMR1.21[-nrow(ModelDFSLt1_VMR1.21),]
    ModelDFSLt1_VMR1.23 <- ModelDFSLt1_VMR1.22[-nrow(ModelDFSLt1_VMR1.22),]
    ModelDFSLt1_VMR1.24 <- ModelDFSLt1_VMR1.23[-nrow(ModelDFSLt1_VMR1.23),]

    ModelDFSLt1_VMR1 <- ModelDFSLt1_VMR1.24 #Create model t=x+1

    #Subtract model (t=x) - (t=x+1)
    ModelDFSL1y_VMR1 <- ModelDFSLt0_VMR1 - ModelDFSLt1_VMR1

    #Re-do Month Number column because the substraction was also applied to it
    ModelDFSL1y_VMR1$MNumber <- seq(from = 1, to = SimulationLength_months)

    #This model will be called VMR1P because implies a one-off input of C
    ModelDFSL_VMR1P <- ModelDFSL1y_VMR1

    #Export the dataframe
    write_xlsx(ModelDFSL_VMR1P,"VXP_Models\\ModelDFSL_R_VMR1P.xlsx")

    #Plot 3: Interactive Yearly CO2 emissions #
    MY <- 12
    ModelDFSL_VMR1P_YCO2 <- ModelDFSL_VMR1P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VMR1)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMR1P_YCO2) <- c("Year", "Months", "AnnualCO2_VMR_1")

    #Plot 3: Interactive Yearly CO2 emissions considering a delay
    GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
    ModelDFSL_VMR1P_YCO2D <- merge(ModelDFSL_VMR1P_YCO2, GWP100delay, by = "Year")
    ModelDFSL_VMR1P_YCO2D$AnnualCO2D_VMR_1 <- ModelDFSL_VMR1P_YCO2D$AnnualCO2_VMR_1 * ModelDFSL_VMR1P_YCO2D$GWP100

    #Plot 4: Interactive Yearly C emissions #
    MY <- 12
    ModelDFSL_VMR1P_YC <- ModelDFSL_VMR1P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VMR1)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMR1P_YC) <- c("Year", "Months", "CEmissions_VMR_1")

    #Plot 5: Interactive Yearly C tails (remaining C in Soil) #
    MY <- 12
    ModelDFSL_VMR1P_YCT <- ModelDFSL_VMR1P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VMR1)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMR1P_YCT) <- c("Year", "Months", "CTail_VMR_1")

    #Save Dataframes for Plots 3.1, 3.2, 4 and 5
    write_xlsx(ModelDFSL_VMR1P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VMR1P.xlsx") #Yearly CO2 emissions (no delay)
    write_xlsx(ModelDFSL_VMR1P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VMR1P.xlsx") #Yearly CO2 emissions (delay)
    write_xlsx(ModelDFSL_VMR1P_YC,"CEmissions_P\\ModelDFSL_R_CE_VMR1P.xlsx") #Yearly C emissions
    write_xlsx(ModelDFSL_VMR1P_YCT,"CTails_P\\ModelDFSL_R_CT_VMR1P.xlsx") #Yearly C emissions



    #### 11.3 - VMR2) Manure; 20%clay; Reduced Tillage ####
    #The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
    fT_VMR2=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
    fW_VMR2=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                            S.Thick = soil.thick, pClay = clay100*0.2,
                            pE = 1.0, bare = FALSE)$b #Moisture effects per month
    xi.frame_VMR2=data.frame(years,rep(fT_VMR2*fW_VMR2,length.out=length(years)))

    #To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
    Model_VMR2=SoilR::RothCModel(
      t=years, #Simulation Length
      ks=c(k.DPM = 10*RTRM, k.RPM = 0.3*RTRM, k.BIO = 0.66*RTRM, k.HUM = 0.02*RTRM, k.IOM = 0*RTRM), #Decomposition rates for the different pools
      C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
      In=Scalar_LitterCinputs*0, #Amount of litter inputs by time
      FYM = Scalar_ManureCinputs*1, #Amount of Farm Yard Manure by time
      clay=clay100*0.2, #Percent clay in mineral soil
      xi=xi.frame_VMR2) #Loads the model

    Ct_VMR2=getC(Model_VMR2) #Calculates stocks for each pool per month

    #The results can be plotted with the commands
    matplot(years, Ct_VMR2, type="l", lty=1, col=1:5,
            xlab="Time (years)", ylab="C stocks (Mg/ha)")
    legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
           lty=1, col=1:5, bty="n")

    VEC_Lit_VMR2 <- rep(M_Scalar_LitterCinputs*0, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
    VEC_Man_VMR2 <- rep(M_Scalar_ManureCinputs*1, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

    VEC_LitDF_VMR2 <- as.data.frame(VEC_Lit_VMR2) #Converting the Litter vector to a data frame
    VEC_LitDF_VMR2$MNumber <- seq(from = 1, to = SimulationLength_months)
    VEC_ManDF_VMR2 <- as.data.frame(VEC_Man_VMR2) #Converting the Manure vector to a data frame
    VEC_ManDF_VMR2$MNumber <- seq(from = 1, to = SimulationLength_months)

    sapply(VEC_LitDF_VMR2, class) #Check that class is numeric
    sapply(VEC_ManDF_VMR2, class) #Check that class is numeric
    LitterCinputs_VMR2=VEC_LitDF_VMR2   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    ManureCinputs_VMR2=VEC_ManDF_VMR2 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    MCinputs_VMR2 <- merge(LitterCinputs_VMR2, ManureCinputs_VMR2, by = "MNumber")
    MCinputs_VMR2$MInput_VMR2 <- MCinputs_VMR2$VEC_Lit_VMR2 + MCinputs_VMR2$VEC_Man_VMR2

    #Change names of litter and manure columns for more common ones
    colnames(MCinputs_VMR2)[which(names(MCinputs_VMR2) == "VEC_Lit_VMR2")] <- "LitterC_VMR2"
    colnames(MCinputs_VMR2)[which(names(MCinputs_VMR2) == "VEC_Man_VMR2")] <- "ManureC_VMR2"

    #Create a dataframe with the data considering the simulation length
    ModelDF_VMR2 <- as.data.frame(Ct_VMR2)
    colnames(ModelDF_VMR2) <- c('DPM_VMR2','RPM_VMR2','BIO_VMR2', 'HUM_VMR2', 'IOM_VMR2')
    ModelDFS_VMR2 <- ModelDF_VMR2[1:SimulationLength_months, ]

    #Create a column with the number of month of analysis
    ModelDFS_VMR2$MNumber <- seq(from = 1, to = SimulationLength_months)

    #Create a column that sums all pools
    ModelDFS_VMR2$AllPools_VMR2 <- ModelDFS_VMR2$DPM_VMR2 + ModelDFS_VMR2$RPM_VMR2 + ModelDFS_VMR2$BIO_VMR2 + ModelDFS_VMR2$HUM_VMR2 + ModelDFS_VMR2$IOM_VMR2

    #Create a column that sums all pools except IOM (static)
    ModelDFS_VMR2$AllPools_noIOM_VMR2 <- ModelDFS_VMR2$DPM_VMR2 + ModelDFS_VMR2$RPM_VMR2 + ModelDFS_VMR2$BIO_VMR2 + ModelDFS_VMR2$HUM_VMR2

    #Create a column that add the monthly input of C (manure and litter separately)
    ModelDFSL_VMR2 <- merge(ModelDFS_VMR2, MCinputs_VMR2, by = "MNumber")

    ModelDFSL_VMR2$MInput_VMR2 <- ModelDFSL_VMR2$LitterC_VMR2 + ModelDFSL_VMR2$ManureC_VMR2
    #ModelDF_SL$MInput[1] <- 0

    #Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
    ModelDFSL_VMR2$CTails_VMR2 <- ModelDFSL_VMR2$AllPools_noIOM_VMR2 + ModelDFSL_VMR2$MInput_VMR2

    #Create Monthly Accumulated input of C
    ModelDFSL_VMR2$AccumInput_VMR2 = ModelDFSL_VMR2$AccumInput_VMR2=cumsum(ModelDFSL_VMR2$MInput_VMR2)

    #Create Monthly Growths for each carbon pool
    ModelDFSL_VMR2$MGrowth_DPM_VMR2 <- ave(ModelDFSL_VMR2$DPM_VMR2, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMR2$MGrowth_RPM_VMR2 <- ave(ModelDFSL_VMR2$RPM_VMR2, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMR2$MGrowth_BIO_VMR2 <- ave(ModelDFSL_VMR2$BIO_VMR2, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMR2$MGrowth_HUM_VMR2 <- ave(ModelDFSL_VMR2$HUM_VMR2, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMR2$MGrowth_IOM_VMR2 <- ave(ModelDFSL_VMR2$IOM_VMR2, FUN = function(x) c(0, diff(x)))

    #Create column for Monthly and Accumulated C-CO2 emissions
    ModelDFSL_VMR2$M_CCO2_VMR2 <- ModelDFSL_VMR2$MInput_VMR2 - ModelDFSL_VMR2$MGrowth_DPM_VMR2 - ModelDFSL_VMR2$MGrowth_RPM_VMR2 - ModelDFSL_VMR2$MGrowth_BIO_VMR2 - ModelDFSL_VMR2$MGrowth_HUM_VMR2
    ModelDFSL_VMR2$Accum_CCO2_VMR2 <- ModelDFSL_VMR2$AccumInput_VMR2 - ModelDFSL_VMR2$AllPools_noIOM_VMR2

    #Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
    ModelDFSL_VMR2$M_CCO2_VMR2[1] <- 0
    ModelDFSL_VMR2$Accum_CCO2_VMR2[1] <- 0

    #Balance validation
    ModelDFSL_VMR2$Balance_VMR2 <- ModelDFSL_VMR2$AccumInput_VMR2 - ModelDFSL_VMR2$Accum_CCO2_VMR2 - (ModelDFSL_VMR2$DPM_VMR2 + ModelDFSL_VMR2$RPM_VMR2 + ModelDFSL_VMR2$BIO_VMR2 + ModelDFSL_VMR2$HUM_VMR2)

    #Convert C-CO2 emissions into CO2 emissions
    ModelDFSL_VMR2$M_CO2_VMR2 <- ModelDFSL_VMR2$M_CCO2_VMR2 * 44/12
    ModelDFSL_VMR2$Accum_CO2_VMR2 <- ModelDFSL_VMR2$Accum_CCO2_VMR2 * 44/12

    #This model will be called VMR2C because implies a continuous input of C
    ModelDFSL_VMR2C <- ModelDFSL_VMR2

    #Export the dataframe
    write_xlsx(ModelDFSL_VMR2C,"VXC_Models\\ModelDFSL_R_VMR2C.xlsx")

    #Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
    #Create two equal models by using the above general script
    #Create model t=x
    ModelDFSLt0_VMR2 <- ModelDFSL_VMR2 #Create model t=x

    #Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
    ModelDFSLt1_VMR2.1 <- rbind(c(0:0), ModelDFSLt0_VMR2)
    ModelDFSLt1_VMR2.2 <- rbind(c(0:0), ModelDFSLt1_VMR2.1)
    ModelDFSLt1_VMR2.3 <- rbind(c(0:0), ModelDFSLt1_VMR2.2)
    ModelDFSLt1_VMR2.4 <- rbind(c(0:0), ModelDFSLt1_VMR2.3)
    ModelDFSLt1_VMR2.5 <- rbind(c(0:0), ModelDFSLt1_VMR2.4)
    ModelDFSLt1_VMR2.6 <- rbind(c(0:0), ModelDFSLt1_VMR2.5)
    ModelDFSLt1_VMR2.7 <- rbind(c(0:0), ModelDFSLt1_VMR2.6)
    ModelDFSLt1_VMR2.8 <- rbind(c(0:0), ModelDFSLt1_VMR2.7)
    ModelDFSLt1_VMR2.9 <- rbind(c(0:0), ModelDFSLt1_VMR2.8)
    ModelDFSLt1_VMR2.10 <- rbind(c(0:0), ModelDFSLt1_VMR2.9)
    ModelDFSLt1_VMR2.11 <- rbind(c(0:0), ModelDFSLt1_VMR2.10)
    ModelDFSLt1_VMR2.12 <- rbind(c(0:0), ModelDFSLt1_VMR2.11)
    ModelDFSLt1_VMR2.13 <- ModelDFSLt1_VMR2.12[-nrow(ModelDFSLt1_VMR2.12),]
    ModelDFSLt1_VMR2.14 <- ModelDFSLt1_VMR2.13[-nrow(ModelDFSLt1_VMR2.13),]
    ModelDFSLt1_VMR2.15 <- ModelDFSLt1_VMR2.14[-nrow(ModelDFSLt1_VMR2.14),]
    ModelDFSLt1_VMR2.16 <- ModelDFSLt1_VMR2.15[-nrow(ModelDFSLt1_VMR2.15),]
    ModelDFSLt1_VMR2.17 <- ModelDFSLt1_VMR2.16[-nrow(ModelDFSLt1_VMR2.16),]
    ModelDFSLt1_VMR2.18 <- ModelDFSLt1_VMR2.17[-nrow(ModelDFSLt1_VMR2.17),]
    ModelDFSLt1_VMR2.19 <- ModelDFSLt1_VMR2.18[-nrow(ModelDFSLt1_VMR2.18),]
    ModelDFSLt1_VMR2.20 <- ModelDFSLt1_VMR2.19[-nrow(ModelDFSLt1_VMR2.19),]
    ModelDFSLt1_VMR2.21 <- ModelDFSLt1_VMR2.20[-nrow(ModelDFSLt1_VMR2.20),]
    ModelDFSLt1_VMR2.22 <- ModelDFSLt1_VMR2.21[-nrow(ModelDFSLt1_VMR2.21),]
    ModelDFSLt1_VMR2.23 <- ModelDFSLt1_VMR2.22[-nrow(ModelDFSLt1_VMR2.22),]
    ModelDFSLt1_VMR2.24 <- ModelDFSLt1_VMR2.23[-nrow(ModelDFSLt1_VMR2.23),]

    ModelDFSLt1_VMR2 <- ModelDFSLt1_VMR2.24 #Create model t=x+1

    #Subtract model (t=x) - (t=x+1)
    ModelDFSL1y_VMR2 <- ModelDFSLt0_VMR2 - ModelDFSLt1_VMR2

    #Re-do Month Number column because the substraction was also applied to it
    ModelDFSL1y_VMR2$MNumber <- seq(from = 1, to = SimulationLength_months)

    #This model will be called VMR2P because implies a one-off input of C
    ModelDFSL_VMR2P <- ModelDFSL1y_VMR2

    #Export the dataframe
    write_xlsx(ModelDFSL_VMR2P,"VXP_Models\\ModelDFSL_R_VMR2P.xlsx")

    #Plot 3: Interactive Yearly CO2 emissions #
    MY <- 12
    ModelDFSL_VMR2P_YCO2 <- ModelDFSL_VMR2P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VMR2)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMR2P_YCO2) <- c("Year", "Months", "AnnualCO2_VMR_2")

    #Plot 3: Interactive Yearly CO2 emissions considering a delay
    GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
    ModelDFSL_VMR2P_YCO2D <- merge(ModelDFSL_VMR2P_YCO2, GWP100delay, by = "Year")
    ModelDFSL_VMR2P_YCO2D$AnnualCO2D_VMR_2 <- ModelDFSL_VMR2P_YCO2D$AnnualCO2_VMR_2 * ModelDFSL_VMR2P_YCO2D$GWP100

    #Plot 4: Interactive Yearly C emissions #
    MY <- 12
    ModelDFSL_VMR2P_YC <- ModelDFSL_VMR2P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VMR2)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMR2P_YC) <- c("Year", "Months", "CEmissions_VMR_2")

    #Plot 5: Interactive Yearly C tails (remaining C in Soil) #
    MY <- 12
    ModelDFSL_VMR2P_YCT <- ModelDFSL_VMR2P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VMR2)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMR2P_YCT) <- c("Year", "Months", "CTail_VMR_2")

    #Save Dataframes for Plots 3.1, 3.2, 4 and 5
    write_xlsx(ModelDFSL_VMR2P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VMR2P.xlsx") #Yearly CO2 emissions (no delay)
    write_xlsx(ModelDFSL_VMR2P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VMR2P.xlsx") #Yearly CO2 emissions (delay)
    write_xlsx(ModelDFSL_VMR2P_YC,"CEmissions_P\\ModelDFSL_R_CE_VMR2P.xlsx") #Yearly C emissions
    write_xlsx(ModelDFSL_VMR2P_YCT,"CTails_P\\ModelDFSL_R_CT_VMR2P.xlsx") #Yearly C emissions



    #### 11.4 - VMR3) Manure; 30%clay; Reduced Tillage ####
    #The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
    fT_VMR3=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
    fW_VMR3=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                            S.Thick = soil.thick, pClay = clay100*0.3,
                            pE = 1.0, bare = FALSE)$b #Moisture effects per month
    xi.frame_VMR3=data.frame(years,rep(fT_VMR3*fW_VMR3,length.out=length(years)))

    #To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
    Model_VMR3=SoilR::RothCModel(
      t=years, #Simulation Length
      ks=c(k.DPM = 10*RTRM, k.RPM = 0.3*RTRM, k.BIO = 0.66*RTRM, k.HUM = 0.02*RTRM, k.IOM = 0*RTRM), #Decomposition rates for the different pools
      C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
      In=Scalar_LitterCinputs*0, #Amount of litter inputs by time
      FYM = Scalar_ManureCinputs*1, #Amount of Farm Yard Manure by time
      clay=clay100*0.3, #Percent clay in mineral soil
      xi=xi.frame_VMR3) #Loads the model

    Ct_VMR3=getC(Model_VMR3) #Calculates stocks for each pool per month

    #The results can be plotted with the commands
    matplot(years, Ct_VMR3, type="l", lty=1, col=1:5,
            xlab="Time (years)", ylab="C stocks (Mg/ha)")
    legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
           lty=1, col=1:5, bty="n")

    VEC_Lit_VMR3 <- rep(M_Scalar_LitterCinputs*0, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
    VEC_Man_VMR3 <- rep(M_Scalar_ManureCinputs*1, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

    VEC_LitDF_VMR3 <- as.data.frame(VEC_Lit_VMR3) #Converting the Litter vector to a data frame
    VEC_LitDF_VMR3$MNumber <- seq(from = 1, to = SimulationLength_months)
    VEC_ManDF_VMR3 <- as.data.frame(VEC_Man_VMR3) #Converting the Manure vector to a data frame
    VEC_ManDF_VMR3$MNumber <- seq(from = 1, to = SimulationLength_months)

    sapply(VEC_LitDF_VMR3, class) #Check that class is numeric
    sapply(VEC_ManDF_VMR3, class) #Check that class is numeric
    LitterCinputs_VMR3=VEC_LitDF_VMR3   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    ManureCinputs_VMR3=VEC_ManDF_VMR3 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    MCinputs_VMR3 <- merge(LitterCinputs_VMR3, ManureCinputs_VMR3, by = "MNumber")
    MCinputs_VMR3$MInput_VMR3 <- MCinputs_VMR3$VEC_Lit_VMR3 + MCinputs_VMR3$VEC_Man_VMR3

    #Change names of litter and manure columns for more common ones
    colnames(MCinputs_VMR3)[which(names(MCinputs_VMR3) == "VEC_Lit_VMR3")] <- "LitterC_VMR3"
    colnames(MCinputs_VMR3)[which(names(MCinputs_VMR3) == "VEC_Man_VMR3")] <- "ManureC_VMR3"

    #Create a dataframe with the data considering the simulation length
    ModelDF_VMR3 <- as.data.frame(Ct_VMR3)
    colnames(ModelDF_VMR3) <- c('DPM_VMR3','RPM_VMR3','BIO_VMR3', 'HUM_VMR3', 'IOM_VMR3')
    ModelDFS_VMR3 <- ModelDF_VMR3[1:SimulationLength_months, ]

    #Create a column with the number of month of analysis
    ModelDFS_VMR3$MNumber <- seq(from = 1, to = SimulationLength_months)

    #Create a column that sums all pools
    ModelDFS_VMR3$AllPools_VMR3 <- ModelDFS_VMR3$DPM_VMR3 + ModelDFS_VMR3$RPM_VMR3 + ModelDFS_VMR3$BIO_VMR3 + ModelDFS_VMR3$HUM_VMR3 + ModelDFS_VMR3$IOM_VMR3

    #Create a column that sums all pools except IOM (static)
    ModelDFS_VMR3$AllPools_noIOM_VMR3 <- ModelDFS_VMR3$DPM_VMR3 + ModelDFS_VMR3$RPM_VMR3 + ModelDFS_VMR3$BIO_VMR3 + ModelDFS_VMR3$HUM_VMR3

    #Create a column that add the monthly input of C (manure and litter separately)
    ModelDFSL_VMR3 <- merge(ModelDFS_VMR3, MCinputs_VMR3, by = "MNumber")

    ModelDFSL_VMR3$MInput_VMR3 <- ModelDFSL_VMR3$LitterC_VMR3 + ModelDFSL_VMR3$ManureC_VMR3
    #ModelDF_SL$MInput[1] <- 0

    #Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
    ModelDFSL_VMR3$CTails_VMR3 <- ModelDFSL_VMR3$AllPools_noIOM_VMR3 + ModelDFSL_VMR3$MInput_VMR3

    #Create Monthly Accumulated input of C
    ModelDFSL_VMR3$AccumInput_VMR3 = ModelDFSL_VMR3$AccumInput_VMR3=cumsum(ModelDFSL_VMR3$MInput_VMR3)

    #Create Monthly Growths for each carbon pool
    ModelDFSL_VMR3$MGrowth_DPM_VMR3 <- ave(ModelDFSL_VMR3$DPM_VMR3, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMR3$MGrowth_RPM_VMR3 <- ave(ModelDFSL_VMR3$RPM_VMR3, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMR3$MGrowth_BIO_VMR3 <- ave(ModelDFSL_VMR3$BIO_VMR3, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMR3$MGrowth_HUM_VMR3 <- ave(ModelDFSL_VMR3$HUM_VMR3, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMR3$MGrowth_IOM_VMR3 <- ave(ModelDFSL_VMR3$IOM_VMR3, FUN = function(x) c(0, diff(x)))

    #Create column for Monthly and Accumulated C-CO2 emissions
    ModelDFSL_VMR3$M_CCO2_VMR3 <- ModelDFSL_VMR3$MInput_VMR3 - ModelDFSL_VMR3$MGrowth_DPM_VMR3 - ModelDFSL_VMR3$MGrowth_RPM_VMR3 - ModelDFSL_VMR3$MGrowth_BIO_VMR3 - ModelDFSL_VMR3$MGrowth_HUM_VMR3
    ModelDFSL_VMR3$Accum_CCO2_VMR3 <- ModelDFSL_VMR3$AccumInput_VMR3 - ModelDFSL_VMR3$AllPools_noIOM_VMR3

    #Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
    ModelDFSL_VMR3$M_CCO2_VMR3[1] <- 0
    ModelDFSL_VMR3$Accum_CCO2_VMR3[1] <- 0

    #Balance validation
    ModelDFSL_VMR3$Balance_VMR3 <- ModelDFSL_VMR3$AccumInput_VMR3 - ModelDFSL_VMR3$Accum_CCO2_VMR3 - (ModelDFSL_VMR3$DPM_VMR3 + ModelDFSL_VMR3$RPM_VMR3 + ModelDFSL_VMR3$BIO_VMR3 + ModelDFSL_VMR3$HUM_VMR3)

    #Convert C-CO2 emissions into CO2 emissions
    ModelDFSL_VMR3$M_CO2_VMR3 <- ModelDFSL_VMR3$M_CCO2_VMR3 * 44/12
    ModelDFSL_VMR3$Accum_CO2_VMR3 <- ModelDFSL_VMR3$Accum_CCO2_VMR3 * 44/12

    #This model will be called VMR3C because implies a continuous input of C
    ModelDFSL_VMR3C <- ModelDFSL_VMR3

    #Export the dataframe
    write_xlsx(ModelDFSL_VMR3C,"VXC_Models\\ModelDFSL_R_VMR3C.xlsx")

    #Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
    #Create two equal models by using the above general script
    #Create model t=x
    ModelDFSLt0_VMR3 <- ModelDFSL_VMR3 #Create model t=x

    #Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
    ModelDFSLt1_VMR3.1 <- rbind(c(0:0), ModelDFSLt0_VMR3)
    ModelDFSLt1_VMR3.2 <- rbind(c(0:0), ModelDFSLt1_VMR3.1)
    ModelDFSLt1_VMR3.3 <- rbind(c(0:0), ModelDFSLt1_VMR3.2)
    ModelDFSLt1_VMR3.4 <- rbind(c(0:0), ModelDFSLt1_VMR3.3)
    ModelDFSLt1_VMR3.5 <- rbind(c(0:0), ModelDFSLt1_VMR3.4)
    ModelDFSLt1_VMR3.6 <- rbind(c(0:0), ModelDFSLt1_VMR3.5)
    ModelDFSLt1_VMR3.7 <- rbind(c(0:0), ModelDFSLt1_VMR3.6)
    ModelDFSLt1_VMR3.8 <- rbind(c(0:0), ModelDFSLt1_VMR3.7)
    ModelDFSLt1_VMR3.9 <- rbind(c(0:0), ModelDFSLt1_VMR3.8)
    ModelDFSLt1_VMR3.10 <- rbind(c(0:0), ModelDFSLt1_VMR3.9)
    ModelDFSLt1_VMR3.11 <- rbind(c(0:0), ModelDFSLt1_VMR3.10)
    ModelDFSLt1_VMR3.12 <- rbind(c(0:0), ModelDFSLt1_VMR3.11)
    ModelDFSLt1_VMR3.13 <- ModelDFSLt1_VMR3.12[-nrow(ModelDFSLt1_VMR3.12),]
    ModelDFSLt1_VMR3.14 <- ModelDFSLt1_VMR3.13[-nrow(ModelDFSLt1_VMR3.13),]
    ModelDFSLt1_VMR3.15 <- ModelDFSLt1_VMR3.14[-nrow(ModelDFSLt1_VMR3.14),]
    ModelDFSLt1_VMR3.16 <- ModelDFSLt1_VMR3.15[-nrow(ModelDFSLt1_VMR3.15),]
    ModelDFSLt1_VMR3.17 <- ModelDFSLt1_VMR3.16[-nrow(ModelDFSLt1_VMR3.16),]
    ModelDFSLt1_VMR3.18 <- ModelDFSLt1_VMR3.17[-nrow(ModelDFSLt1_VMR3.17),]
    ModelDFSLt1_VMR3.19 <- ModelDFSLt1_VMR3.18[-nrow(ModelDFSLt1_VMR3.18),]
    ModelDFSLt1_VMR3.20 <- ModelDFSLt1_VMR3.19[-nrow(ModelDFSLt1_VMR3.19),]
    ModelDFSLt1_VMR3.21 <- ModelDFSLt1_VMR3.20[-nrow(ModelDFSLt1_VMR3.20),]
    ModelDFSLt1_VMR3.22 <- ModelDFSLt1_VMR3.21[-nrow(ModelDFSLt1_VMR3.21),]
    ModelDFSLt1_VMR3.23 <- ModelDFSLt1_VMR3.22[-nrow(ModelDFSLt1_VMR3.22),]
    ModelDFSLt1_VMR3.24 <- ModelDFSLt1_VMR3.23[-nrow(ModelDFSLt1_VMR3.23),]

    ModelDFSLt1_VMR3 <- ModelDFSLt1_VMR3.24 #Create model t=x+1

    #Subtract model (t=x) - (t=x+1)
    ModelDFSL1y_VMR3 <- ModelDFSLt0_VMR3 - ModelDFSLt1_VMR3

    #Re-do Month Number column because the substraction was also applied to it
    ModelDFSL1y_VMR3$MNumber <- seq(from = 1, to = SimulationLength_months)

    #This model will be called VMR3P because implies a one-off input of C
    ModelDFSL_VMR3P <- ModelDFSL1y_VMR3

    #Export the dataframe
    write_xlsx(ModelDFSL_VMR3P,"VXP_Models\\ModelDFSL_R_VMR3P.xlsx")

    #Plot 3: Interactive Yearly CO2 emissions #
    MY <- 12
    ModelDFSL_VMR3P_YCO2 <- ModelDFSL_VMR3P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VMR3)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMR3P_YCO2) <- c("Year", "Months", "AnnualCO2_VMR_3")

    #Plot 3: Interactive Yearly CO2 emissions considering a delay
    GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
    ModelDFSL_VMR3P_YCO2D <- merge(ModelDFSL_VMR3P_YCO2, GWP100delay, by = "Year")
    ModelDFSL_VMR3P_YCO2D$AnnualCO2D_VMR_3 <- ModelDFSL_VMR3P_YCO2D$AnnualCO2_VMR_3 * ModelDFSL_VMR3P_YCO2D$GWP100

    #Plot 4: Interactive Yearly C emissions #
    MY <- 12
    ModelDFSL_VMR3P_YC <- ModelDFSL_VMR3P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VMR3)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMR3P_YC) <- c("Year", "Months", "CEmissions_VMR_3")

    #Plot 5: Interactive Yearly C tails (remaining C in Soil) #
    MY <- 12
    ModelDFSL_VMR3P_YCT <- ModelDFSL_VMR3P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VMR3)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMR3P_YCT) <- c("Year", "Months", "CTail_VMR_3")

    #Save Dataframes for Plots 3.1, 3.2, 4 and 5
    write_xlsx(ModelDFSL_VMR3P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VMR3P.xlsx") #Yearly CO2 emissions (no delay)
    write_xlsx(ModelDFSL_VMR3P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VMR3P.xlsx") #Yearly CO2 emissions (delay)
    write_xlsx(ModelDFSL_VMR3P_YC,"CEmissions_P\\ModelDFSL_R_CE_VMR3P.xlsx") #Yearly C emissions
    write_xlsx(ModelDFSL_VMR3P_YCT,"CTails_P\\ModelDFSL_R_CT_VMR3P.xlsx") #Yearly C emissions



    #### 11.5 - VMR4) Manure; 40%clay; Reduced Tillage ####
    #The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
    fT_VMR4=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
    fW_VMR4=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                            S.Thick = soil.thick, pClay = clay100*0.4,
                            pE = 1.0, bare = FALSE)$b #Moisture effects per month
    xi.frame_VMR4=data.frame(years,rep(fT_VMR4*fW_VMR4,length.out=length(years)))

    #To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
    Model_VMR4=SoilR::RothCModel(
      t=years, #Simulation Length
      ks=c(k.DPM = 10*RTRM, k.RPM = 0.3*RTRM, k.BIO = 0.66*RTRM, k.HUM = 0.02*RTRM, k.IOM = 0*RTRM), #Decomposition rates for the different pools
      C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
      In=Scalar_LitterCinputs*0, #Amount of litter inputs by time
      FYM = Scalar_ManureCinputs*1, #Amount of Farm Yard Manure by time
      clay=clay100*0.4, #Percent clay in mineral soil
      xi=xi.frame_VMR4) #Loads the model

    Ct_VMR4=getC(Model_VMR4) #Calculates stocks for each pool per month

    #The results can be plotted with the commands
    matplot(years, Ct_VMR4, type="l", lty=1, col=1:5,
            xlab="Time (years)", ylab="C stocks (Mg/ha)")
    legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
           lty=1, col=1:5, bty="n")

    VEC_Lit_VMR4 <- rep(M_Scalar_LitterCinputs*0, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
    VEC_Man_VMR4 <- rep(M_Scalar_ManureCinputs*1, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

    VEC_LitDF_VMR4 <- as.data.frame(VEC_Lit_VMR4) #Converting the Litter vector to a data frame
    VEC_LitDF_VMR4$MNumber <- seq(from = 1, to = SimulationLength_months)
    VEC_ManDF_VMR4 <- as.data.frame(VEC_Man_VMR4) #Converting the Manure vector to a data frame
    VEC_ManDF_VMR4$MNumber <- seq(from = 1, to = SimulationLength_months)

    sapply(VEC_LitDF_VMR4, class) #Check that class is numeric
    sapply(VEC_ManDF_VMR4, class) #Check that class is numeric
    LitterCinputs_VMR4=VEC_LitDF_VMR4   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    ManureCinputs_VMR4=VEC_ManDF_VMR4 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    MCinputs_VMR4 <- merge(LitterCinputs_VMR4, ManureCinputs_VMR4, by = "MNumber")
    MCinputs_VMR4$MInput_VMR4 <- MCinputs_VMR4$VEC_Lit_VMR4 + MCinputs_VMR4$VEC_Man_VMR4

    #Change names of litter and manure columns for more common ones
    colnames(MCinputs_VMR4)[which(names(MCinputs_VMR4) == "VEC_Lit_VMR4")] <- "LitterC_VMR4"
    colnames(MCinputs_VMR4)[which(names(MCinputs_VMR4) == "VEC_Man_VMR4")] <- "ManureC_VMR4"

    #Create a dataframe with the data considering the simulation length
    ModelDF_VMR4 <- as.data.frame(Ct_VMR4)
    colnames(ModelDF_VMR4) <- c('DPM_VMR4','RPM_VMR4','BIO_VMR4', 'HUM_VMR4', 'IOM_VMR4')
    ModelDFS_VMR4 <- ModelDF_VMR4[1:SimulationLength_months, ]

    #Create a column with the number of month of analysis
    ModelDFS_VMR4$MNumber <- seq(from = 1, to = SimulationLength_months)

    #Create a column that sums all pools
    ModelDFS_VMR4$AllPools_VMR4 <- ModelDFS_VMR4$DPM_VMR4 + ModelDFS_VMR4$RPM_VMR4 + ModelDFS_VMR4$BIO_VMR4 + ModelDFS_VMR4$HUM_VMR4 + ModelDFS_VMR4$IOM_VMR4

    #Create a column that sums all pools except IOM (static)
    ModelDFS_VMR4$AllPools_noIOM_VMR4 <- ModelDFS_VMR4$DPM_VMR4 + ModelDFS_VMR4$RPM_VMR4 + ModelDFS_VMR4$BIO_VMR4 + ModelDFS_VMR4$HUM_VMR4

    #Create a column that add the monthly input of C (manure and litter separately)
    ModelDFSL_VMR4 <- merge(ModelDFS_VMR4, MCinputs_VMR4, by = "MNumber")

    ModelDFSL_VMR4$MInput_VMR4 <- ModelDFSL_VMR4$LitterC_VMR4 + ModelDFSL_VMR4$ManureC_VMR4
    #ModelDF_SL$MInput[1] <- 0

    #Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
    ModelDFSL_VMR4$CTails_VMR4 <- ModelDFSL_VMR4$AllPools_noIOM_VMR4 + ModelDFSL_VMR4$MInput_VMR4

    #Create Monthly Accumulated input of C
    ModelDFSL_VMR4$AccumInput_VMR4 = ModelDFSL_VMR4$AccumInput_VMR4=cumsum(ModelDFSL_VMR4$MInput_VMR4)

    #Create Monthly Growths for each carbon pool
    ModelDFSL_VMR4$MGrowth_DPM_VMR4 <- ave(ModelDFSL_VMR4$DPM_VMR4, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMR4$MGrowth_RPM_VMR4 <- ave(ModelDFSL_VMR4$RPM_VMR4, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMR4$MGrowth_BIO_VMR4 <- ave(ModelDFSL_VMR4$BIO_VMR4, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMR4$MGrowth_HUM_VMR4 <- ave(ModelDFSL_VMR4$HUM_VMR4, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMR4$MGrowth_IOM_VMR4 <- ave(ModelDFSL_VMR4$IOM_VMR4, FUN = function(x) c(0, diff(x)))

    #Create column for Monthly and Accumulated C-CO2 emissions
    ModelDFSL_VMR4$M_CCO2_VMR4 <- ModelDFSL_VMR4$MInput_VMR4 - ModelDFSL_VMR4$MGrowth_DPM_VMR4 - ModelDFSL_VMR4$MGrowth_RPM_VMR4 - ModelDFSL_VMR4$MGrowth_BIO_VMR4 - ModelDFSL_VMR4$MGrowth_HUM_VMR4
    ModelDFSL_VMR4$Accum_CCO2_VMR4 <- ModelDFSL_VMR4$AccumInput_VMR4 - ModelDFSL_VMR4$AllPools_noIOM_VMR4

    #Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
    ModelDFSL_VMR4$M_CCO2_VMR4[1] <- 0
    ModelDFSL_VMR4$Accum_CCO2_VMR4[1] <- 0

    #Balance validation
    ModelDFSL_VMR4$Balance_VMR4 <- ModelDFSL_VMR4$AccumInput_VMR4 - ModelDFSL_VMR4$Accum_CCO2_VMR4 - (ModelDFSL_VMR4$DPM_VMR4 + ModelDFSL_VMR4$RPM_VMR4 + ModelDFSL_VMR4$BIO_VMR4 + ModelDFSL_VMR4$HUM_VMR4)

    #Convert C-CO2 emissions into CO2 emissions
    ModelDFSL_VMR4$M_CO2_VMR4 <- ModelDFSL_VMR4$M_CCO2_VMR4 * 44/12
    ModelDFSL_VMR4$Accum_CO2_VMR4 <- ModelDFSL_VMR4$Accum_CCO2_VMR4 * 44/12

    #This model will be called VMR4C because implies a continuous input of C
    ModelDFSL_VMR4C <- ModelDFSL_VMR4

    #Export the dataframe
    write_xlsx(ModelDFSL_VMR4C,"VXC_Models\\ModelDFSL_R_VMR4C.xlsx")

    #Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
    #Create two equal models by using the above general script
    #Create model t=x
    ModelDFSLt0_VMR4 <- ModelDFSL_VMR4 #Create model t=x

    #Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
    ModelDFSLt1_VMR4.1 <- rbind(c(0:0), ModelDFSLt0_VMR4)
    ModelDFSLt1_VMR4.2 <- rbind(c(0:0), ModelDFSLt1_VMR4.1)
    ModelDFSLt1_VMR4.3 <- rbind(c(0:0), ModelDFSLt1_VMR4.2)
    ModelDFSLt1_VMR4.4 <- rbind(c(0:0), ModelDFSLt1_VMR4.3)
    ModelDFSLt1_VMR4.5 <- rbind(c(0:0), ModelDFSLt1_VMR4.4)
    ModelDFSLt1_VMR4.6 <- rbind(c(0:0), ModelDFSLt1_VMR4.5)
    ModelDFSLt1_VMR4.7 <- rbind(c(0:0), ModelDFSLt1_VMR4.6)
    ModelDFSLt1_VMR4.8 <- rbind(c(0:0), ModelDFSLt1_VMR4.7)
    ModelDFSLt1_VMR4.9 <- rbind(c(0:0), ModelDFSLt1_VMR4.8)
    ModelDFSLt1_VMR4.10 <- rbind(c(0:0), ModelDFSLt1_VMR4.9)
    ModelDFSLt1_VMR4.11 <- rbind(c(0:0), ModelDFSLt1_VMR4.10)
    ModelDFSLt1_VMR4.12 <- rbind(c(0:0), ModelDFSLt1_VMR4.11)
    ModelDFSLt1_VMR4.13 <- ModelDFSLt1_VMR4.12[-nrow(ModelDFSLt1_VMR4.12),]
    ModelDFSLt1_VMR4.14 <- ModelDFSLt1_VMR4.13[-nrow(ModelDFSLt1_VMR4.13),]
    ModelDFSLt1_VMR4.15 <- ModelDFSLt1_VMR4.14[-nrow(ModelDFSLt1_VMR4.14),]
    ModelDFSLt1_VMR4.16 <- ModelDFSLt1_VMR4.15[-nrow(ModelDFSLt1_VMR4.15),]
    ModelDFSLt1_VMR4.17 <- ModelDFSLt1_VMR4.16[-nrow(ModelDFSLt1_VMR4.16),]
    ModelDFSLt1_VMR4.18 <- ModelDFSLt1_VMR4.17[-nrow(ModelDFSLt1_VMR4.17),]
    ModelDFSLt1_VMR4.19 <- ModelDFSLt1_VMR4.18[-nrow(ModelDFSLt1_VMR4.18),]
    ModelDFSLt1_VMR4.20 <- ModelDFSLt1_VMR4.19[-nrow(ModelDFSLt1_VMR4.19),]
    ModelDFSLt1_VMR4.21 <- ModelDFSLt1_VMR4.20[-nrow(ModelDFSLt1_VMR4.20),]
    ModelDFSLt1_VMR4.22 <- ModelDFSLt1_VMR4.21[-nrow(ModelDFSLt1_VMR4.21),]
    ModelDFSLt1_VMR4.23 <- ModelDFSLt1_VMR4.22[-nrow(ModelDFSLt1_VMR4.22),]
    ModelDFSLt1_VMR4.24 <- ModelDFSLt1_VMR4.23[-nrow(ModelDFSLt1_VMR4.23),]

    ModelDFSLt1_VMR4 <- ModelDFSLt1_VMR4.24 #Create model t=x+1

    #Subtract model (t=x) - (t=x+1)
    ModelDFSL1y_VMR4 <- ModelDFSLt0_VMR4 - ModelDFSLt1_VMR4

    #Re-do Month Number column because the substraction was also applied to it
    ModelDFSL1y_VMR4$MNumber <- seq(from = 1, to = SimulationLength_months)

    #This model will be called VMR4P because implies a one-off input of C
    ModelDFSL_VMR4P <- ModelDFSL1y_VMR4

    #Export the dataframe
    write_xlsx(ModelDFSL_VMR4P,"VXP_Models\\ModelDFSL_R_VMR4P.xlsx")

    #Plot 3: Interactive Yearly CO2 emissions #
    MY <- 12
    ModelDFSL_VMR4P_YCO2 <- ModelDFSL_VMR4P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VMR4)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMR4P_YCO2) <- c("Year", "Months", "AnnualCO2_VMR_4")

    #Plot 3: Interactive Yearly CO2 emissions considering a delay
    GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
    ModelDFSL_VMR4P_YCO2D <- merge(ModelDFSL_VMR4P_YCO2, GWP100delay, by = "Year")
    ModelDFSL_VMR4P_YCO2D$AnnualCO2D_VMR_4 <- ModelDFSL_VMR4P_YCO2D$AnnualCO2_VMR_4 * ModelDFSL_VMR4P_YCO2D$GWP100

    #Plot 4: Interactive Yearly C emissions #
    MY <- 12
    ModelDFSL_VMR4P_YC <- ModelDFSL_VMR4P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VMR4)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMR4P_YC) <- c("Year", "Months", "CEmissions_VMR_4")

    #Plot 5: Interactive Yearly C tails (remaining C in Soil) #
    MY <- 12
    ModelDFSL_VMR4P_YCT <- ModelDFSL_VMR4P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VMR4)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMR4P_YCT) <- c("Year", "Months", "CTail_VMR_4")

    #Save Dataframes for Plots 3.1, 3.2, 4 and 5
    write_xlsx(ModelDFSL_VMR4P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VMR4P.xlsx") #Yearly CO2 emissions (no delay)
    write_xlsx(ModelDFSL_VMR4P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VMR4P.xlsx") #Yearly CO2 emissions (delay)
    write_xlsx(ModelDFSL_VMR4P_YC,"CEmissions_P\\ModelDFSL_R_CE_VMR4P.xlsx") #Yearly C emissions
    write_xlsx(ModelDFSL_VMR4P_YCT,"CTails_P\\ModelDFSL_R_CT_VMR4P.xlsx") #Yearly C emissions



    #### 11.6 - VMR5) Manure; 50%clay; Reduced Tillage ####
    #The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
    fT_VMR5=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
    fW_VMR5=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                            S.Thick = soil.thick, pClay = clay100*0.5,
                            pE = 1.0, bare = FALSE)$b #Moisture effects per month
    xi.frame_VMR5=data.frame(years,rep(fT_VMR5*fW_VMR5,length.out=length(years)))

    #To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
    Model_VMR5=SoilR::RothCModel(
      t=years, #Simulation Length
      ks=c(k.DPM = 10*RTRM, k.RPM = 0.3*RTRM, k.BIO = 0.66*RTRM, k.HUM = 0.02*RTRM, k.IOM = 0*RTRM), #Decomposition rates for the different pools
      C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
      In=Scalar_LitterCinputs*0, #Amount of litter inputs by time
      FYM = Scalar_ManureCinputs*1, #Amount of Farm Yard Manure by time
      clay=clay100*0.5, #Percent clay in mineral soil
      xi=xi.frame_VMR5) #Loads the model

    Ct_VMR5=getC(Model_VMR5) #Calculates stocks for each pool per month

    #The results can be plotted with the commands
    matplot(years, Ct_VMR5, type="l", lty=1, col=1:5,
            xlab="Time (years)", ylab="C stocks (Mg/ha)")
    legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
           lty=1, col=1:5, bty="n")

    VEC_Lit_VMR5 <- rep(M_Scalar_LitterCinputs*0, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
    VEC_Man_VMR5 <- rep(M_Scalar_ManureCinputs*1, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

    VEC_LitDF_VMR5 <- as.data.frame(VEC_Lit_VMR5) #Converting the Litter vector to a data frame
    VEC_LitDF_VMR5$MNumber <- seq(from = 1, to = SimulationLength_months)
    VEC_ManDF_VMR5 <- as.data.frame(VEC_Man_VMR5) #Converting the Manure vector to a data frame
    VEC_ManDF_VMR5$MNumber <- seq(from = 1, to = SimulationLength_months)

    sapply(VEC_LitDF_VMR5, class) #Check that class is numeric
    sapply(VEC_ManDF_VMR5, class) #Check that class is numeric
    LitterCinputs_VMR5=VEC_LitDF_VMR5   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    ManureCinputs_VMR5=VEC_ManDF_VMR5 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    MCinputs_VMR5 <- merge(LitterCinputs_VMR5, ManureCinputs_VMR5, by = "MNumber")
    MCinputs_VMR5$MInput_VMR5 <- MCinputs_VMR5$VEC_Lit_VMR5 + MCinputs_VMR5$VEC_Man_VMR5

    #Change names of litter and manure columns for more common ones
    colnames(MCinputs_VMR5)[which(names(MCinputs_VMR5) == "VEC_Lit_VMR5")] <- "LitterC_VMR5"
    colnames(MCinputs_VMR5)[which(names(MCinputs_VMR5) == "VEC_Man_VMR5")] <- "ManureC_VMR5"

    #Create a dataframe with the data considering the simulation length
    ModelDF_VMR5 <- as.data.frame(Ct_VMR5)
    colnames(ModelDF_VMR5) <- c('DPM_VMR5','RPM_VMR5','BIO_VMR5', 'HUM_VMR5', 'IOM_VMR5')
    ModelDFS_VMR5 <- ModelDF_VMR5[1:SimulationLength_months, ]

    #Create a column with the number of month of analysis
    ModelDFS_VMR5$MNumber <- seq(from = 1, to = SimulationLength_months)

    #Create a column that sums all pools
    ModelDFS_VMR5$AllPools_VMR5 <- ModelDFS_VMR5$DPM_VMR5 + ModelDFS_VMR5$RPM_VMR5 + ModelDFS_VMR5$BIO_VMR5 + ModelDFS_VMR5$HUM_VMR5 + ModelDFS_VMR5$IOM_VMR5

    #Create a column that sums all pools except IOM (static)
    ModelDFS_VMR5$AllPools_noIOM_VMR5 <- ModelDFS_VMR5$DPM_VMR5 + ModelDFS_VMR5$RPM_VMR5 + ModelDFS_VMR5$BIO_VMR5 + ModelDFS_VMR5$HUM_VMR5

    #Create a column that add the monthly input of C (manure and litter separately)
    ModelDFSL_VMR5 <- merge(ModelDFS_VMR5, MCinputs_VMR5, by = "MNumber")

    ModelDFSL_VMR5$MInput_VMR5 <- ModelDFSL_VMR5$LitterC_VMR5 + ModelDFSL_VMR5$ManureC_VMR5
    #ModelDF_SL$MInput[1] <- 0

    #Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
    ModelDFSL_VMR5$CTails_VMR5 <- ModelDFSL_VMR5$AllPools_noIOM_VMR5 + ModelDFSL_VMR5$MInput_VMR5

    #Create Monthly Accumulated input of C
    ModelDFSL_VMR5$AccumInput_VMR5 = ModelDFSL_VMR5$AccumInput_VMR5=cumsum(ModelDFSL_VMR5$MInput_VMR5)

    #Create Monthly Growths for each carbon pool
    ModelDFSL_VMR5$MGrowth_DPM_VMR5 <- ave(ModelDFSL_VMR5$DPM_VMR5, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMR5$MGrowth_RPM_VMR5 <- ave(ModelDFSL_VMR5$RPM_VMR5, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMR5$MGrowth_BIO_VMR5 <- ave(ModelDFSL_VMR5$BIO_VMR5, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMR5$MGrowth_HUM_VMR5 <- ave(ModelDFSL_VMR5$HUM_VMR5, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMR5$MGrowth_IOM_VMR5 <- ave(ModelDFSL_VMR5$IOM_VMR5, FUN = function(x) c(0, diff(x)))

    #Create column for Monthly and Accumulated C-CO2 emissions
    ModelDFSL_VMR5$M_CCO2_VMR5 <- ModelDFSL_VMR5$MInput_VMR5 - ModelDFSL_VMR5$MGrowth_DPM_VMR5 - ModelDFSL_VMR5$MGrowth_RPM_VMR5 - ModelDFSL_VMR5$MGrowth_BIO_VMR5 - ModelDFSL_VMR5$MGrowth_HUM_VMR5
    ModelDFSL_VMR5$Accum_CCO2_VMR5 <- ModelDFSL_VMR5$AccumInput_VMR5 - ModelDFSL_VMR5$AllPools_noIOM_VMR5

    #Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
    ModelDFSL_VMR5$M_CCO2_VMR5[1] <- 0
    ModelDFSL_VMR5$Accum_CCO2_VMR5[1] <- 0

    #Balance validation
    ModelDFSL_VMR5$Balance_VMR5 <- ModelDFSL_VMR5$AccumInput_VMR5 - ModelDFSL_VMR5$Accum_CCO2_VMR5 - (ModelDFSL_VMR5$DPM_VMR5 + ModelDFSL_VMR5$RPM_VMR5 + ModelDFSL_VMR5$BIO_VMR5 + ModelDFSL_VMR5$HUM_VMR5)

    #Convert C-CO2 emissions into CO2 emissions
    ModelDFSL_VMR5$M_CO2_VMR5 <- ModelDFSL_VMR5$M_CCO2_VMR5 * 44/12
    ModelDFSL_VMR5$Accum_CO2_VMR5 <- ModelDFSL_VMR5$Accum_CCO2_VMR5 * 44/12

    #This model will be called VMR5C because implies a continuous input of C
    ModelDFSL_VMR5C <- ModelDFSL_VMR5

    #Export the dataframe
    write_xlsx(ModelDFSL_VMR5C,"VXC_Models\\ModelDFSL_R_VMR5C.xlsx")

    #Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
    #Create two equal models by using the above general script
    #Create model t=x
    ModelDFSLt0_VMR5 <- ModelDFSL_VMR5 #Create model t=x

    #Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
    ModelDFSLt1_VMR5.1 <- rbind(c(0:0), ModelDFSLt0_VMR5)
    ModelDFSLt1_VMR5.2 <- rbind(c(0:0), ModelDFSLt1_VMR5.1)
    ModelDFSLt1_VMR5.3 <- rbind(c(0:0), ModelDFSLt1_VMR5.2)
    ModelDFSLt1_VMR5.4 <- rbind(c(0:0), ModelDFSLt1_VMR5.3)
    ModelDFSLt1_VMR5.5 <- rbind(c(0:0), ModelDFSLt1_VMR5.4)
    ModelDFSLt1_VMR5.6 <- rbind(c(0:0), ModelDFSLt1_VMR5.5)
    ModelDFSLt1_VMR5.7 <- rbind(c(0:0), ModelDFSLt1_VMR5.6)
    ModelDFSLt1_VMR5.8 <- rbind(c(0:0), ModelDFSLt1_VMR5.7)
    ModelDFSLt1_VMR5.9 <- rbind(c(0:0), ModelDFSLt1_VMR5.8)
    ModelDFSLt1_VMR5.10 <- rbind(c(0:0), ModelDFSLt1_VMR5.9)
    ModelDFSLt1_VMR5.11 <- rbind(c(0:0), ModelDFSLt1_VMR5.10)
    ModelDFSLt1_VMR5.12 <- rbind(c(0:0), ModelDFSLt1_VMR5.11)
    ModelDFSLt1_VMR5.13 <- ModelDFSLt1_VMR5.12[-nrow(ModelDFSLt1_VMR5.12),]
    ModelDFSLt1_VMR5.14 <- ModelDFSLt1_VMR5.13[-nrow(ModelDFSLt1_VMR5.13),]
    ModelDFSLt1_VMR5.15 <- ModelDFSLt1_VMR5.14[-nrow(ModelDFSLt1_VMR5.14),]
    ModelDFSLt1_VMR5.16 <- ModelDFSLt1_VMR5.15[-nrow(ModelDFSLt1_VMR5.15),]
    ModelDFSLt1_VMR5.17 <- ModelDFSLt1_VMR5.16[-nrow(ModelDFSLt1_VMR5.16),]
    ModelDFSLt1_VMR5.18 <- ModelDFSLt1_VMR5.17[-nrow(ModelDFSLt1_VMR5.17),]
    ModelDFSLt1_VMR5.19 <- ModelDFSLt1_VMR5.18[-nrow(ModelDFSLt1_VMR5.18),]
    ModelDFSLt1_VMR5.20 <- ModelDFSLt1_VMR5.19[-nrow(ModelDFSLt1_VMR5.19),]
    ModelDFSLt1_VMR5.21 <- ModelDFSLt1_VMR5.20[-nrow(ModelDFSLt1_VMR5.20),]
    ModelDFSLt1_VMR5.22 <- ModelDFSLt1_VMR5.21[-nrow(ModelDFSLt1_VMR5.21),]
    ModelDFSLt1_VMR5.23 <- ModelDFSLt1_VMR5.22[-nrow(ModelDFSLt1_VMR5.22),]
    ModelDFSLt1_VMR5.24 <- ModelDFSLt1_VMR5.23[-nrow(ModelDFSLt1_VMR5.23),]

    ModelDFSLt1_VMR5 <- ModelDFSLt1_VMR5.24 #Create model t=x+1

    #Subtract model (t=x) - (t=x+1)
    ModelDFSL1y_VMR5 <- ModelDFSLt0_VMR5 - ModelDFSLt1_VMR5

    #Re-do Month Number column because the substraction was also applied to it
    ModelDFSL1y_VMR5$MNumber <- seq(from = 1, to = SimulationLength_months)

    #This model will be called VMR5P because implies a one-off input of C
    ModelDFSL_VMR5P <- ModelDFSL1y_VMR5

    #Export the dataframe
    write_xlsx(ModelDFSL_VMR5P,"VXP_Models\\ModelDFSL_R_VMR5P.xlsx")


    #Plot 3: Interactive Yearly CO2 emissions #
    MY <- 12
    ModelDFSL_VMR5P_YCO2 <- ModelDFSL_VMR5P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VMR5)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMR5P_YCO2) <- c("Year", "Months", "AnnualCO2_VMR_5")


    #Plot 3: Interactive Yearly CO2 emissions considering a delay
    GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
    ModelDFSL_VMR5P_YCO2D <- merge(ModelDFSL_VMR5P_YCO2, GWP100delay, by = "Year")
    ModelDFSL_VMR5P_YCO2D$AnnualCO2D_VMR_5 <- ModelDFSL_VMR5P_YCO2D$AnnualCO2_VMR_5 * ModelDFSL_VMR5P_YCO2D$GWP100

    #Plot 4: Interactive Yearly C emissions #
    MY <- 12
    ModelDFSL_VMR5P_YC <- ModelDFSL_VMR5P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VMR5)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMR5P_YC) <- c("Year", "Months", "CEmissions_VMR_5")


    #Plot 5: Interactive Yearly C tails (remaining C in Soil) #
    MY <- 12
    ModelDFSL_VMR5P_YCT <- ModelDFSL_VMR5P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VMR5)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMR5P_YCT) <- c("Year", "Months", "CTail_VMR_5")

    #Save Dataframes for Plots 3.1, 3.2, 4 and 5
    write_xlsx(ModelDFSL_VMR5P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VMR5P.xlsx") #Yearly CO2 emissions (no delay)
    write_xlsx(ModelDFSL_VMR5P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VMR5P.xlsx") #Yearly CO2 emissions (delay)
    write_xlsx(ModelDFSL_VMR5P_YC,"CEmissions_P\\ModelDFSL_R_CE_VMR5P.xlsx") #Yearly C emissions
    write_xlsx(ModelDFSL_VMR5P_YCT,"CTails_P\\ModelDFSL_R_CT_VMR5P.xlsx") #Yearly C emissions



    #### 11.7 - VMR6) Manure; 60%clay; Reduced Tillage ####
    #The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
    fT_VMR6=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
    fW_VMR6=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                            S.Thick = soil.thick, pClay = clay100*0.6,
                            pE = 1.0, bare = FALSE)$b #Moisture effects per month
    xi.frame_VMR6=data.frame(years,rep(fT_VMR6*fW_VMR6,length.out=length(years)))

    #To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
    Model_VMR6=SoilR::RothCModel(
      t=years, #Simulation Length
      ks=c(k.DPM = 10*RTRM, k.RPM = 0.3*RTRM, k.BIO = 0.66*RTRM, k.HUM = 0.02*RTRM, k.IOM = 0*RTRM), #Decomposition rates for the different pools
      C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
      In=Scalar_LitterCinputs*0, #Amount of litter inputs by time
      FYM = Scalar_ManureCinputs*1, #Amount of Farm Yard Manure by time
      clay=clay100*0.6, #Percent clay in mineral soil
      xi=xi.frame_VMR6) #Loads the model

    Ct_VMR6=getC(Model_VMR6) #Calculates stocks for each pool per month

    #The results can be plotted with the commands
    matplot(years, Ct_VMR6, type="l", lty=1, col=1:5,
            xlab="Time (years)", ylab="C stocks (Mg/ha)")
    legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
           lty=1, col=1:5, bty="n")

    VEC_Lit_VMR6 <- rep(M_Scalar_LitterCinputs*0, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
    VEC_Man_VMR6 <- rep(M_Scalar_ManureCinputs*1, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

    VEC_LitDF_VMR6 <- as.data.frame(VEC_Lit_VMR6) #Converting the Litter vector to a data frame
    VEC_LitDF_VMR6$MNumber <- seq(from = 1, to = SimulationLength_months)
    VEC_ManDF_VMR6 <- as.data.frame(VEC_Man_VMR6) #Converting the Manure vector to a data frame
    VEC_ManDF_VMR6$MNumber <- seq(from = 1, to = SimulationLength_months)

    sapply(VEC_LitDF_VMR6, class) #Check that class is numeric
    sapply(VEC_ManDF_VMR6, class) #Check that class is numeric
    LitterCinputs_VMR6=VEC_LitDF_VMR6   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    ManureCinputs_VMR6=VEC_ManDF_VMR6 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    MCinputs_VMR6 <- merge(LitterCinputs_VMR6, ManureCinputs_VMR6, by = "MNumber")
    MCinputs_VMR6$MInput_VMR6 <- MCinputs_VMR6$VEC_Lit_VMR6 + MCinputs_VMR6$VEC_Man_VMR6

    #Change names of litter and manure columns for more common ones
    colnames(MCinputs_VMR6)[which(names(MCinputs_VMR6) == "VEC_Lit_VMR6")] <- "LitterC_VMR6"
    colnames(MCinputs_VMR6)[which(names(MCinputs_VMR6) == "VEC_Man_VMR6")] <- "ManureC_VMR6"

    #Create a dataframe with the data considering the simulation length
    ModelDF_VMR6 <- as.data.frame(Ct_VMR6)
    colnames(ModelDF_VMR6) <- c('DPM_VMR6','RPM_VMR6','BIO_VMR6', 'HUM_VMR6', 'IOM_VMR6')
    ModelDFS_VMR6 <- ModelDF_VMR6[1:SimulationLength_months, ]

    #Create a column with the number of month of analysis
    ModelDFS_VMR6$MNumber <- seq(from = 1, to = SimulationLength_months)

    #Create a column that sums all pools
    ModelDFS_VMR6$AllPools_VMR6 <- ModelDFS_VMR6$DPM_VMR6 + ModelDFS_VMR6$RPM_VMR6 + ModelDFS_VMR6$BIO_VMR6 + ModelDFS_VMR6$HUM_VMR6 + ModelDFS_VMR6$IOM_VMR6

    #Create a column that sums all pools except IOM (static)
    ModelDFS_VMR6$AllPools_noIOM_VMR6 <- ModelDFS_VMR6$DPM_VMR6 + ModelDFS_VMR6$RPM_VMR6 + ModelDFS_VMR6$BIO_VMR6 + ModelDFS_VMR6$HUM_VMR6

    #Create a column that add the monthly input of C (manure and litter separately)
    ModelDFSL_VMR6 <- merge(ModelDFS_VMR6, MCinputs_VMR6, by = "MNumber")

    ModelDFSL_VMR6$MInput_VMR6 <- ModelDFSL_VMR6$LitterC_VMR6 + ModelDFSL_VMR6$ManureC_VMR6
    #ModelDF_SL$MInput[1] <- 0

    #Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
    ModelDFSL_VMR6$CTails_VMR6 <- ModelDFSL_VMR6$AllPools_noIOM_VMR6 + ModelDFSL_VMR6$MInput_VMR6

    #Create Monthly Accumulated input of C
    ModelDFSL_VMR6$AccumInput_VMR6 = ModelDFSL_VMR6$AccumInput_VMR6=cumsum(ModelDFSL_VMR6$MInput_VMR6)

    #Create Monthly Growths for each carbon pool
    ModelDFSL_VMR6$MGrowth_DPM_VMR6 <- ave(ModelDFSL_VMR6$DPM_VMR6, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMR6$MGrowth_RPM_VMR6 <- ave(ModelDFSL_VMR6$RPM_VMR6, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMR6$MGrowth_BIO_VMR6 <- ave(ModelDFSL_VMR6$BIO_VMR6, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMR6$MGrowth_HUM_VMR6 <- ave(ModelDFSL_VMR6$HUM_VMR6, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMR6$MGrowth_IOM_VMR6 <- ave(ModelDFSL_VMR6$IOM_VMR6, FUN = function(x) c(0, diff(x)))

    #Create column for Monthly and Accumulated C-CO2 emissions
    ModelDFSL_VMR6$M_CCO2_VMR6 <- ModelDFSL_VMR6$MInput_VMR6 - ModelDFSL_VMR6$MGrowth_DPM_VMR6 - ModelDFSL_VMR6$MGrowth_RPM_VMR6 - ModelDFSL_VMR6$MGrowth_BIO_VMR6 - ModelDFSL_VMR6$MGrowth_HUM_VMR6
    ModelDFSL_VMR6$Accum_CCO2_VMR6 <- ModelDFSL_VMR6$AccumInput_VMR6 - ModelDFSL_VMR6$AllPools_noIOM_VMR6

    #Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
    ModelDFSL_VMR6$M_CCO2_VMR6[1] <- 0
    ModelDFSL_VMR6$Accum_CCO2_VMR6[1] <- 0

    #Balance validation
    ModelDFSL_VMR6$Balance_VMR6 <- ModelDFSL_VMR6$AccumInput_VMR6 - ModelDFSL_VMR6$Accum_CCO2_VMR6 - (ModelDFSL_VMR6$DPM_VMR6 + ModelDFSL_VMR6$RPM_VMR6 + ModelDFSL_VMR6$BIO_VMR6 + ModelDFSL_VMR6$HUM_VMR6)

    #Convert C-CO2 emissions into CO2 emissions
    ModelDFSL_VMR6$M_CO2_VMR6 <- ModelDFSL_VMR6$M_CCO2_VMR6 * 44/12
    ModelDFSL_VMR6$Accum_CO2_VMR6 <- ModelDFSL_VMR6$Accum_CCO2_VMR6 * 44/12

    #This model will be called VMR6C because implies a continuous input of C
    ModelDFSL_VMR6C <- ModelDFSL_VMR6

    #Export the dataframe
    write_xlsx(ModelDFSL_VMR6C,"VXC_Models\\ModelDFSL_R_VMR6C.xlsx")

    #Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
    #Create two equal models by using the above general script
    #Create model t=x
    ModelDFSLt0_VMR6 <- ModelDFSL_VMR6 #Create model t=x

    #Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
    ModelDFSLt1_VMR6.1 <- rbind(c(0:0), ModelDFSLt0_VMR6)
    ModelDFSLt1_VMR6.2 <- rbind(c(0:0), ModelDFSLt1_VMR6.1)
    ModelDFSLt1_VMR6.3 <- rbind(c(0:0), ModelDFSLt1_VMR6.2)
    ModelDFSLt1_VMR6.4 <- rbind(c(0:0), ModelDFSLt1_VMR6.3)
    ModelDFSLt1_VMR6.5 <- rbind(c(0:0), ModelDFSLt1_VMR6.4)
    ModelDFSLt1_VMR6.6 <- rbind(c(0:0), ModelDFSLt1_VMR6.5)
    ModelDFSLt1_VMR6.7 <- rbind(c(0:0), ModelDFSLt1_VMR6.6)
    ModelDFSLt1_VMR6.8 <- rbind(c(0:0), ModelDFSLt1_VMR6.7)
    ModelDFSLt1_VMR6.9 <- rbind(c(0:0), ModelDFSLt1_VMR6.8)
    ModelDFSLt1_VMR6.10 <- rbind(c(0:0), ModelDFSLt1_VMR6.9)
    ModelDFSLt1_VMR6.11 <- rbind(c(0:0), ModelDFSLt1_VMR6.10)
    ModelDFSLt1_VMR6.12 <- rbind(c(0:0), ModelDFSLt1_VMR6.11)
    ModelDFSLt1_VMR6.13 <- ModelDFSLt1_VMR6.12[-nrow(ModelDFSLt1_VMR6.12),]
    ModelDFSLt1_VMR6.14 <- ModelDFSLt1_VMR6.13[-nrow(ModelDFSLt1_VMR6.13),]
    ModelDFSLt1_VMR6.15 <- ModelDFSLt1_VMR6.14[-nrow(ModelDFSLt1_VMR6.14),]
    ModelDFSLt1_VMR6.16 <- ModelDFSLt1_VMR6.15[-nrow(ModelDFSLt1_VMR6.15),]
    ModelDFSLt1_VMR6.17 <- ModelDFSLt1_VMR6.16[-nrow(ModelDFSLt1_VMR6.16),]
    ModelDFSLt1_VMR6.18 <- ModelDFSLt1_VMR6.17[-nrow(ModelDFSLt1_VMR6.17),]
    ModelDFSLt1_VMR6.19 <- ModelDFSLt1_VMR6.18[-nrow(ModelDFSLt1_VMR6.18),]
    ModelDFSLt1_VMR6.20 <- ModelDFSLt1_VMR6.19[-nrow(ModelDFSLt1_VMR6.19),]
    ModelDFSLt1_VMR6.21 <- ModelDFSLt1_VMR6.20[-nrow(ModelDFSLt1_VMR6.20),]
    ModelDFSLt1_VMR6.22 <- ModelDFSLt1_VMR6.21[-nrow(ModelDFSLt1_VMR6.21),]
    ModelDFSLt1_VMR6.23 <- ModelDFSLt1_VMR6.22[-nrow(ModelDFSLt1_VMR6.22),]
    ModelDFSLt1_VMR6.24 <- ModelDFSLt1_VMR6.23[-nrow(ModelDFSLt1_VMR6.23),]

    ModelDFSLt1_VMR6 <- ModelDFSLt1_VMR6.24 #Create model t=x+1

    #Subtract model (t=x) - (t=x+1)
    ModelDFSL1y_VMR6 <- ModelDFSLt0_VMR6 - ModelDFSLt1_VMR6

    #Re-do Month Number column because the substraction was also applied to it
    ModelDFSL1y_VMR6$MNumber <- seq(from = 1, to = SimulationLength_months)

    #This model will be called VMR6P because implies a one-off input of C
    ModelDFSL_VMR6P <- ModelDFSL1y_VMR6

    #Export the dataframe
    write_xlsx(ModelDFSL_VMR6P,"VXP_Models\\ModelDFSL_R_VMR6P.xlsx")

    #Plot 3: Interactive Yearly CO2 emissions #
    MY <- 12
    ModelDFSL_VMR6P_YCO2 <- ModelDFSL_VMR6P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VMR6)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMR6P_YCO2) <- c("Year", "Months", "AnnualCO2_VMR_6")


    #Plot 3: Interactive Yearly CO2 emissions considering a delay
    GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
    ModelDFSL_VMR6P_YCO2D <- merge(ModelDFSL_VMR6P_YCO2, GWP100delay, by = "Year")
    ModelDFSL_VMR6P_YCO2D$AnnualCO2D_VMR_6 <- ModelDFSL_VMR6P_YCO2D$AnnualCO2_VMR_6 * ModelDFSL_VMR6P_YCO2D$GWP100

    #Plot 4: Interactive Yearly C emissions #
    MY <- 12
    ModelDFSL_VMR6P_YC <- ModelDFSL_VMR6P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VMR6)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMR6P_YC) <- c("Year", "Months", "CEmissions_VMR_6")


    #Plot 5: Interactive Yearly C tails (remaining C in Soil) #
    MY <- 12
    ModelDFSL_VMR6P_YCT <- ModelDFSL_VMR6P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VMR6)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMR6P_YCT) <- c("Year", "Months", "CTail_VMR_6")

    #Save Dataframes for Plots 3.1, 3.2, 4 and 5
    write_xlsx(ModelDFSL_VMR6P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VMR6P.xlsx") #Yearly CO2 emissions (no delay)
    write_xlsx(ModelDFSL_VMR6P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VMR6P.xlsx") #Yearly CO2 emissions (delay)
    write_xlsx(ModelDFSL_VMR6P_YC,"CEmissions_P\\ModelDFSL_R_CE_VMR6P.xlsx") #Yearly C emissions
    write_xlsx(ModelDFSL_VMR6P_YCT,"CTails_P\\ModelDFSL_R_CT_VMR6P.xlsx") #Yearly C emissions



    #### 11.8 - VMR7) Manure; 70%clay; Reduced Tillage ####
    #The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
    fT_VMR7=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
    fW_VMR7=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                            S.Thick = soil.thick, pClay = clay100*0.7,
                            pE = 1.0, bare = FALSE)$b #Moisture effects per month
    xi.frame_VMR7=data.frame(years,rep(fT_VMR7*fW_VMR7,length.out=length(years)))

    #To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
    Model_VMR7=SoilR::RothCModel(
      t=years, #Simulation Length
      ks=c(k.DPM = 10*RTRM, k.RPM = 0.3*RTRM, k.BIO = 0.66*RTRM, k.HUM = 0.02*RTRM, k.IOM = 0*RTRM), #Decomposition rates for the different pools
      C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
      In=Scalar_LitterCinputs*0, #Amount of litter inputs by time
      FYM = Scalar_ManureCinputs*1, #Amount of Farm Yard Manure by time
      clay=clay100*0.7, #Percent clay in mineral soil
      xi=xi.frame_VMR7) #Loads the model

    Ct_VMR7=getC(Model_VMR7) #Calculates stocks for each pool per month

    #The results can be plotted with the commands
    matplot(years, Ct_VMR7, type="l", lty=1, col=1:5,
            xlab="Time (years)", ylab="C stocks (Mg/ha)")
    legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
           lty=1, col=1:5, bty="n")

    VEC_Lit_VMR7 <- rep(M_Scalar_LitterCinputs*0, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
    VEC_Man_VMR7 <- rep(M_Scalar_ManureCinputs*1, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

    VEC_LitDF_VMR7 <- as.data.frame(VEC_Lit_VMR7) #Converting the Litter vector to a data frame
    VEC_LitDF_VMR7$MNumber <- seq(from = 1, to = SimulationLength_months)
    VEC_ManDF_VMR7 <- as.data.frame(VEC_Man_VMR7) #Converting the Manure vector to a data frame
    VEC_ManDF_VMR7$MNumber <- seq(from = 1, to = SimulationLength_months)

    sapply(VEC_LitDF_VMR7, class) #Check that class is numeric
    sapply(VEC_ManDF_VMR7, class) #Check that class is numeric
    LitterCinputs_VMR7=VEC_LitDF_VMR7   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    ManureCinputs_VMR7=VEC_ManDF_VMR7 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    MCinputs_VMR7 <- merge(LitterCinputs_VMR7, ManureCinputs_VMR7, by = "MNumber")
    MCinputs_VMR7$MInput_VMR7 <- MCinputs_VMR7$VEC_Lit_VMR7 + MCinputs_VMR7$VEC_Man_VMR7

    #Change names of litter and manure columns for more common ones
    colnames(MCinputs_VMR7)[which(names(MCinputs_VMR7) == "VEC_Lit_VMR7")] <- "LitterC_VMR7"
    colnames(MCinputs_VMR7)[which(names(MCinputs_VMR7) == "VEC_Man_VMR7")] <- "ManureC_VMR7"

    #Create a dataframe with the data considering the simulation length
    ModelDF_VMR7 <- as.data.frame(Ct_VMR7)
    colnames(ModelDF_VMR7) <- c('DPM_VMR7','RPM_VMR7','BIO_VMR7', 'HUM_VMR7', 'IOM_VMR7')
    ModelDFS_VMR7 <- ModelDF_VMR7[1:SimulationLength_months, ]

    #Create a column with the number of month of analysis
    ModelDFS_VMR7$MNumber <- seq(from = 1, to = SimulationLength_months)

    #Create a column that sums all pools
    ModelDFS_VMR7$AllPools_VMR7 <- ModelDFS_VMR7$DPM_VMR7 + ModelDFS_VMR7$RPM_VMR7 + ModelDFS_VMR7$BIO_VMR7 + ModelDFS_VMR7$HUM_VMR7 + ModelDFS_VMR7$IOM_VMR7

    #Create a column that sums all pools except IOM (static)
    ModelDFS_VMR7$AllPools_noIOM_VMR7 <- ModelDFS_VMR7$DPM_VMR7 + ModelDFS_VMR7$RPM_VMR7 + ModelDFS_VMR7$BIO_VMR7 + ModelDFS_VMR7$HUM_VMR7

    #Create a column that add the monthly input of C (manure and litter separately)
    ModelDFSL_VMR7 <- merge(ModelDFS_VMR7, MCinputs_VMR7, by = "MNumber")

    ModelDFSL_VMR7$MInput_VMR7 <- ModelDFSL_VMR7$LitterC_VMR7 + ModelDFSL_VMR7$ManureC_VMR7
    #ModelDF_SL$MInput[1] <- 0

    #Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
    ModelDFSL_VMR7$CTails_VMR7 <- ModelDFSL_VMR7$AllPools_noIOM_VMR7 + ModelDFSL_VMR7$MInput_VMR7

    #Create Monthly Accumulated input of C
    ModelDFSL_VMR7$AccumInput_VMR7 = ModelDFSL_VMR7$AccumInput_VMR7=cumsum(ModelDFSL_VMR7$MInput_VMR7)

    #Create Monthly Growths for each carbon pool
    ModelDFSL_VMR7$MGrowth_DPM_VMR7 <- ave(ModelDFSL_VMR7$DPM_VMR7, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMR7$MGrowth_RPM_VMR7 <- ave(ModelDFSL_VMR7$RPM_VMR7, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMR7$MGrowth_BIO_VMR7 <- ave(ModelDFSL_VMR7$BIO_VMR7, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMR7$MGrowth_HUM_VMR7 <- ave(ModelDFSL_VMR7$HUM_VMR7, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMR7$MGrowth_IOM_VMR7 <- ave(ModelDFSL_VMR7$IOM_VMR7, FUN = function(x) c(0, diff(x)))

    #Create column for Monthly and Accumulated C-CO2 emissions
    ModelDFSL_VMR7$M_CCO2_VMR7 <- ModelDFSL_VMR7$MInput_VMR7 - ModelDFSL_VMR7$MGrowth_DPM_VMR7 - ModelDFSL_VMR7$MGrowth_RPM_VMR7 - ModelDFSL_VMR7$MGrowth_BIO_VMR7 - ModelDFSL_VMR7$MGrowth_HUM_VMR7
    ModelDFSL_VMR7$Accum_CCO2_VMR7 <- ModelDFSL_VMR7$AccumInput_VMR7 - ModelDFSL_VMR7$AllPools_noIOM_VMR7

    #Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
    ModelDFSL_VMR7$M_CCO2_VMR7[1] <- 0
    ModelDFSL_VMR7$Accum_CCO2_VMR7[1] <- 0

    #Balance validation
    ModelDFSL_VMR7$Balance_VMR7 <- ModelDFSL_VMR7$AccumInput_VMR7 - ModelDFSL_VMR7$Accum_CCO2_VMR7 - (ModelDFSL_VMR7$DPM_VMR7 + ModelDFSL_VMR7$RPM_VMR7 + ModelDFSL_VMR7$BIO_VMR7 + ModelDFSL_VMR7$HUM_VMR7)

    #Convert C-CO2 emissions into CO2 emissions
    ModelDFSL_VMR7$M_CO2_VMR7 <- ModelDFSL_VMR7$M_CCO2_VMR7 * 44/12
    ModelDFSL_VMR7$Accum_CO2_VMR7 <- ModelDFSL_VMR7$Accum_CCO2_VMR7 * 44/12

    #This model will be called VMR7C because implies a continuous input of C
    ModelDFSL_VMR7C <- ModelDFSL_VMR7

    #Export the dataframe
    write_xlsx(ModelDFSL_VMR7C,"VXC_Models\\ModelDFSL_R_VMR7C.xlsx")

    #Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
    #Create two equal models by using the above general script
    #Create model t=x
    ModelDFSLt0_VMR7 <- ModelDFSL_VMR7 #Create model t=x

    #Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
    ModelDFSLt1_VMR7.1 <- rbind(c(0:0), ModelDFSLt0_VMR7)
    ModelDFSLt1_VMR7.2 <- rbind(c(0:0), ModelDFSLt1_VMR7.1)
    ModelDFSLt1_VMR7.3 <- rbind(c(0:0), ModelDFSLt1_VMR7.2)
    ModelDFSLt1_VMR7.4 <- rbind(c(0:0), ModelDFSLt1_VMR7.3)
    ModelDFSLt1_VMR7.5 <- rbind(c(0:0), ModelDFSLt1_VMR7.4)
    ModelDFSLt1_VMR7.6 <- rbind(c(0:0), ModelDFSLt1_VMR7.5)
    ModelDFSLt1_VMR7.7 <- rbind(c(0:0), ModelDFSLt1_VMR7.6)
    ModelDFSLt1_VMR7.8 <- rbind(c(0:0), ModelDFSLt1_VMR7.7)
    ModelDFSLt1_VMR7.9 <- rbind(c(0:0), ModelDFSLt1_VMR7.8)
    ModelDFSLt1_VMR7.10 <- rbind(c(0:0), ModelDFSLt1_VMR7.9)
    ModelDFSLt1_VMR7.11 <- rbind(c(0:0), ModelDFSLt1_VMR7.10)
    ModelDFSLt1_VMR7.12 <- rbind(c(0:0), ModelDFSLt1_VMR7.11)
    ModelDFSLt1_VMR7.13 <- ModelDFSLt1_VMR7.12[-nrow(ModelDFSLt1_VMR7.12),]
    ModelDFSLt1_VMR7.14 <- ModelDFSLt1_VMR7.13[-nrow(ModelDFSLt1_VMR7.13),]
    ModelDFSLt1_VMR7.15 <- ModelDFSLt1_VMR7.14[-nrow(ModelDFSLt1_VMR7.14),]
    ModelDFSLt1_VMR7.16 <- ModelDFSLt1_VMR7.15[-nrow(ModelDFSLt1_VMR7.15),]
    ModelDFSLt1_VMR7.17 <- ModelDFSLt1_VMR7.16[-nrow(ModelDFSLt1_VMR7.16),]
    ModelDFSLt1_VMR7.18 <- ModelDFSLt1_VMR7.17[-nrow(ModelDFSLt1_VMR7.17),]
    ModelDFSLt1_VMR7.19 <- ModelDFSLt1_VMR7.18[-nrow(ModelDFSLt1_VMR7.18),]
    ModelDFSLt1_VMR7.20 <- ModelDFSLt1_VMR7.19[-nrow(ModelDFSLt1_VMR7.19),]
    ModelDFSLt1_VMR7.21 <- ModelDFSLt1_VMR7.20[-nrow(ModelDFSLt1_VMR7.20),]
    ModelDFSLt1_VMR7.22 <- ModelDFSLt1_VMR7.21[-nrow(ModelDFSLt1_VMR7.21),]
    ModelDFSLt1_VMR7.23 <- ModelDFSLt1_VMR7.22[-nrow(ModelDFSLt1_VMR7.22),]
    ModelDFSLt1_VMR7.24 <- ModelDFSLt1_VMR7.23[-nrow(ModelDFSLt1_VMR7.23),]

    ModelDFSLt1_VMR7 <- ModelDFSLt1_VMR7.24 #Create model t=x+1

    #Subtract model (t=x) - (t=x+1)
    ModelDFSL1y_VMR7 <- ModelDFSLt0_VMR7 - ModelDFSLt1_VMR7

    #Re-do Month Number column because the substraction was also applied to it
    ModelDFSL1y_VMR7$MNumber <- seq(from = 1, to = SimulationLength_months)

    #This model will be called VMR7P because implies a one-off input of C
    ModelDFSL_VMR7P <- ModelDFSL1y_VMR7

    #Export the dataframe
    write_xlsx(ModelDFSL_VMR7P,"VXP_Models\\ModelDFSL_R_VMR7P.xlsx")

    #Plot 3: Interactive Yearly CO2 emissions #
    MY <- 12
    ModelDFSL_VMR7P_YCO2 <- ModelDFSL_VMR7P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VMR7)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMR7P_YCO2) <- c("Year", "Months", "AnnualCO2_VMR_7")


    #Plot 3: Interactive Yearly CO2 emissions considering a delay
    GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
    ModelDFSL_VMR7P_YCO2D <- merge(ModelDFSL_VMR7P_YCO2, GWP100delay, by = "Year")
    ModelDFSL_VMR7P_YCO2D$AnnualCO2D_VMR_7 <- ModelDFSL_VMR7P_YCO2D$AnnualCO2_VMR_7 * ModelDFSL_VMR7P_YCO2D$GWP100

    #Plot 4: Interactive Yearly C emissions #
    MY <- 12
    ModelDFSL_VMR7P_YC <- ModelDFSL_VMR7P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VMR7)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMR7P_YC) <- c("Year", "Months", "CEmissions_VMR_7")


    #Plot 5: Interactive Yearly C tails (remaining C in Soil) #
    MY <- 12
    ModelDFSL_VMR7P_YCT <- ModelDFSL_VMR7P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VMR7)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMR7P_YCT) <- c("Year", "Months", "CTail_VMR_7")


    #Save Dataframes for Plots 3.1, 3.2, 4 and 5
    write_xlsx(ModelDFSL_VMR7P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VMR7P.xlsx") #Yearly CO2 emissions (no delay)
    write_xlsx(ModelDFSL_VMR7P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VMR7P.xlsx") #Yearly CO2 emissions (delay)
    write_xlsx(ModelDFSL_VMR7P_YC,"CEmissions_P\\ModelDFSL_R_CE_VMR7P.xlsx") #Yearly C emissions
    write_xlsx(ModelDFSL_VMR7P_YCT,"CTails_P\\ModelDFSL_R_CT_VMR7P.xlsx") #Yearly C emissions



    #### 11.9 - VMR8) Manure; 80%clay; Reduced Tillage ####
    #The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
    fT_VMR8=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
    fW_VMR8=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                            S.Thick = soil.thick, pClay = clay100*0.8,
                            pE = 1.0, bare = FALSE)$b #Moisture effects per month
    xi.frame_VMR8=data.frame(years,rep(fT_VMR8*fW_VMR8,length.out=length(years)))

    #To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
    Model_VMR8=SoilR::RothCModel(
      t=years, #Simulation Length
      ks=c(k.DPM = 10*RTRM, k.RPM = 0.3*RTRM, k.BIO = 0.66*RTRM, k.HUM = 0.02*RTRM, k.IOM = 0*RTRM), #Decomposition rates for the different pools
      C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
      In=Scalar_LitterCinputs*0, #Amount of litter inputs by time
      FYM = Scalar_ManureCinputs*1, #Amount of Farm Yard Manure by time
      clay=clay100*0.8, #Percent clay in mineral soil
      xi=xi.frame_VMR8) #Loads the model

    Ct_VMR8=getC(Model_VMR8) #Calculates stocks for each pool per month

    #The results can be plotted with the commands
    matplot(years, Ct_VMR8, type="l", lty=1, col=1:5,
            xlab="Time (years)", ylab="C stocks (Mg/ha)")
    legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
           lty=1, col=1:5, bty="n")

    VEC_Lit_VMR8 <- rep(M_Scalar_LitterCinputs*0, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
    VEC_Man_VMR8 <- rep(M_Scalar_ManureCinputs*1, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

    VEC_LitDF_VMR8 <- as.data.frame(VEC_Lit_VMR8) #Converting the Litter vector to a data frame
    VEC_LitDF_VMR8$MNumber <- seq(from = 1, to = SimulationLength_months)
    VEC_ManDF_VMR8 <- as.data.frame(VEC_Man_VMR8) #Converting the Manure vector to a data frame
    VEC_ManDF_VMR8$MNumber <- seq(from = 1, to = SimulationLength_months)

    sapply(VEC_LitDF_VMR8, class) #Check that class is numeric
    sapply(VEC_ManDF_VMR8, class) #Check that class is numeric
    LitterCinputs_VMR8=VEC_LitDF_VMR8   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    ManureCinputs_VMR8=VEC_ManDF_VMR8 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    MCinputs_VMR8 <- merge(LitterCinputs_VMR8, ManureCinputs_VMR8, by = "MNumber")
    MCinputs_VMR8$MInput_VMR8 <- MCinputs_VMR8$VEC_Lit_VMR8 + MCinputs_VMR8$VEC_Man_VMR8

    #Change names of litter and manure columns for more common ones
    colnames(MCinputs_VMR8)[which(names(MCinputs_VMR8) == "VEC_Lit_VMR8")] <- "LitterC_VMR8"
    colnames(MCinputs_VMR8)[which(names(MCinputs_VMR8) == "VEC_Man_VMR8")] <- "ManureC_VMR8"

    #Create a dataframe with the data considering the simulation length
    ModelDF_VMR8 <- as.data.frame(Ct_VMR8)
    colnames(ModelDF_VMR8) <- c('DPM_VMR8','RPM_VMR8','BIO_VMR8', 'HUM_VMR8', 'IOM_VMR8')
    ModelDFS_VMR8 <- ModelDF_VMR8[1:SimulationLength_months, ]

    #Create a column with the number of month of analysis
    ModelDFS_VMR8$MNumber <- seq(from = 1, to = SimulationLength_months)

    #Create a column that sums all pools
    ModelDFS_VMR8$AllPools_VMR8 <- ModelDFS_VMR8$DPM_VMR8 + ModelDFS_VMR8$RPM_VMR8 + ModelDFS_VMR8$BIO_VMR8 + ModelDFS_VMR8$HUM_VMR8 + ModelDFS_VMR8$IOM_VMR8

    #Create a column that sums all pools except IOM (static)
    ModelDFS_VMR8$AllPools_noIOM_VMR8 <- ModelDFS_VMR8$DPM_VMR8 + ModelDFS_VMR8$RPM_VMR8 + ModelDFS_VMR8$BIO_VMR8 + ModelDFS_VMR8$HUM_VMR8

    #Create a column that add the monthly input of C (manure and litter separately)
    ModelDFSL_VMR8 <- merge(ModelDFS_VMR8, MCinputs_VMR8, by = "MNumber")

    ModelDFSL_VMR8$MInput_VMR8 <- ModelDFSL_VMR8$LitterC_VMR8 + ModelDFSL_VMR8$ManureC_VMR8
    #ModelDF_SL$MInput[1] <- 0

    #Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
    ModelDFSL_VMR8$CTails_VMR8 <- ModelDFSL_VMR8$AllPools_noIOM_VMR8 + ModelDFSL_VMR8$MInput_VMR8

    #Create Monthly Accumulated input of C
    ModelDFSL_VMR8$AccumInput_VMR8 = ModelDFSL_VMR8$AccumInput_VMR8=cumsum(ModelDFSL_VMR8$MInput_VMR8)

    #Create Monthly Growths for each carbon pool
    ModelDFSL_VMR8$MGrowth_DPM_VMR8 <- ave(ModelDFSL_VMR8$DPM_VMR8, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMR8$MGrowth_RPM_VMR8 <- ave(ModelDFSL_VMR8$RPM_VMR8, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMR8$MGrowth_BIO_VMR8 <- ave(ModelDFSL_VMR8$BIO_VMR8, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMR8$MGrowth_HUM_VMR8 <- ave(ModelDFSL_VMR8$HUM_VMR8, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMR8$MGrowth_IOM_VMR8 <- ave(ModelDFSL_VMR8$IOM_VMR8, FUN = function(x) c(0, diff(x)))

    #Create column for Monthly and Accumulated C-CO2 emissions
    ModelDFSL_VMR8$M_CCO2_VMR8 <- ModelDFSL_VMR8$MInput_VMR8 - ModelDFSL_VMR8$MGrowth_DPM_VMR8 - ModelDFSL_VMR8$MGrowth_RPM_VMR8 - ModelDFSL_VMR8$MGrowth_BIO_VMR8 - ModelDFSL_VMR8$MGrowth_HUM_VMR8
    ModelDFSL_VMR8$Accum_CCO2_VMR8 <- ModelDFSL_VMR8$AccumInput_VMR8 - ModelDFSL_VMR8$AllPools_noIOM_VMR8

    #Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
    ModelDFSL_VMR8$M_CCO2_VMR8[1] <- 0
    ModelDFSL_VMR8$Accum_CCO2_VMR8[1] <- 0

    #Balance validation
    ModelDFSL_VMR8$Balance_VMR8 <- ModelDFSL_VMR8$AccumInput_VMR8 - ModelDFSL_VMR8$Accum_CCO2_VMR8 - (ModelDFSL_VMR8$DPM_VMR8 + ModelDFSL_VMR8$RPM_VMR8 + ModelDFSL_VMR8$BIO_VMR8 + ModelDFSL_VMR8$HUM_VMR8)

    #Convert C-CO2 emissions into CO2 emissions
    ModelDFSL_VMR8$M_CO2_VMR8 <- ModelDFSL_VMR8$M_CCO2_VMR8 * 44/12
    ModelDFSL_VMR8$Accum_CO2_VMR8 <- ModelDFSL_VMR8$Accum_CCO2_VMR8 * 44/12

    #This model will be called VMR8C because implies a continuous input of C
    ModelDFSL_VMR8C <- ModelDFSL_VMR8

    #Export the dataframe
    write_xlsx(ModelDFSL_VMR8C,"VXC_Models\\ModelDFSL_R_VMR8C.xlsx")

    #Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
    #Create two equal models by using the above general script
    #Create model t=x
    ModelDFSLt0_VMR8 <- ModelDFSL_VMR8 #Create model t=x

    #Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
    ModelDFSLt1_VMR8.1 <- rbind(c(0:0), ModelDFSLt0_VMR8)
    ModelDFSLt1_VMR8.2 <- rbind(c(0:0), ModelDFSLt1_VMR8.1)
    ModelDFSLt1_VMR8.3 <- rbind(c(0:0), ModelDFSLt1_VMR8.2)
    ModelDFSLt1_VMR8.4 <- rbind(c(0:0), ModelDFSLt1_VMR8.3)
    ModelDFSLt1_VMR8.5 <- rbind(c(0:0), ModelDFSLt1_VMR8.4)
    ModelDFSLt1_VMR8.6 <- rbind(c(0:0), ModelDFSLt1_VMR8.5)
    ModelDFSLt1_VMR8.7 <- rbind(c(0:0), ModelDFSLt1_VMR8.6)
    ModelDFSLt1_VMR8.8 <- rbind(c(0:0), ModelDFSLt1_VMR8.7)
    ModelDFSLt1_VMR8.9 <- rbind(c(0:0), ModelDFSLt1_VMR8.8)
    ModelDFSLt1_VMR8.10 <- rbind(c(0:0), ModelDFSLt1_VMR8.9)
    ModelDFSLt1_VMR8.11 <- rbind(c(0:0), ModelDFSLt1_VMR8.10)
    ModelDFSLt1_VMR8.12 <- rbind(c(0:0), ModelDFSLt1_VMR8.11)
    ModelDFSLt1_VMR8.13 <- ModelDFSLt1_VMR8.12[-nrow(ModelDFSLt1_VMR8.12),]
    ModelDFSLt1_VMR8.14 <- ModelDFSLt1_VMR8.13[-nrow(ModelDFSLt1_VMR8.13),]
    ModelDFSLt1_VMR8.15 <- ModelDFSLt1_VMR8.14[-nrow(ModelDFSLt1_VMR8.14),]
    ModelDFSLt1_VMR8.16 <- ModelDFSLt1_VMR8.15[-nrow(ModelDFSLt1_VMR8.15),]
    ModelDFSLt1_VMR8.17 <- ModelDFSLt1_VMR8.16[-nrow(ModelDFSLt1_VMR8.16),]
    ModelDFSLt1_VMR8.18 <- ModelDFSLt1_VMR8.17[-nrow(ModelDFSLt1_VMR8.17),]
    ModelDFSLt1_VMR8.19 <- ModelDFSLt1_VMR8.18[-nrow(ModelDFSLt1_VMR8.18),]
    ModelDFSLt1_VMR8.20 <- ModelDFSLt1_VMR8.19[-nrow(ModelDFSLt1_VMR8.19),]
    ModelDFSLt1_VMR8.21 <- ModelDFSLt1_VMR8.20[-nrow(ModelDFSLt1_VMR8.20),]
    ModelDFSLt1_VMR8.22 <- ModelDFSLt1_VMR8.21[-nrow(ModelDFSLt1_VMR8.21),]
    ModelDFSLt1_VMR8.23 <- ModelDFSLt1_VMR8.22[-nrow(ModelDFSLt1_VMR8.22),]
    ModelDFSLt1_VMR8.24 <- ModelDFSLt1_VMR8.23[-nrow(ModelDFSLt1_VMR8.23),]

    ModelDFSLt1_VMR8 <- ModelDFSLt1_VMR8.24 #Create model t=x+1

    #Subtract model (t=x) - (t=x+1)
    ModelDFSL1y_VMR8 <- ModelDFSLt0_VMR8 - ModelDFSLt1_VMR8

    #Re-do Month Number column because the substraction was also applied to it
    ModelDFSL1y_VMR8$MNumber <- seq(from = 1, to = SimulationLength_months)

    #This model will be called VMR8P because implies a one-off input of C
    ModelDFSL_VMR8P <- ModelDFSL1y_VMR8

    #Export the dataframe
    write_xlsx(ModelDFSL_VMR8P,"VXP_Models\\ModelDFSL_R_VMR8P.xlsx")


    #Plot 3: Interactive Yearly CO2 emissions #
    MY <- 12
    ModelDFSL_VMR8P_YCO2 <- ModelDFSL_VMR8P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VMR8)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMR8P_YCO2) <- c("Year", "Months", "AnnualCO2_VMR_8")

    #Plot 3: Interactive Yearly CO2 emissions considering a delay
    GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
    ModelDFSL_VMR8P_YCO2D <- merge(ModelDFSL_VMR8P_YCO2, GWP100delay, by = "Year")
    ModelDFSL_VMR8P_YCO2D$AnnualCO2D_VMR_8 <- ModelDFSL_VMR8P_YCO2D$AnnualCO2_VMR_8 * ModelDFSL_VMR8P_YCO2D$GWP100


    #Plot 4: Interactive Yearly C emissions #
    MY <- 12
    ModelDFSL_VMR8P_YC <- ModelDFSL_VMR8P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VMR8)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMR8P_YC) <- c("Year", "Months", "CEmissions_VMR_8")

    #Plot 5: Interactive Yearly C tails (remaining C in Soil) #
    MY <- 12
    ModelDFSL_VMR8P_YCT <- ModelDFSL_VMR8P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VMR8)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMR8P_YCT) <- c("Year", "Months", "CTail_VMR_8")

    #Save Dataframes for Plots 3.1, 3.2, 4 and 5
    write_xlsx(ModelDFSL_VMR8P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VMR8P.xlsx") #Yearly CO2 emissions (no delay)
    write_xlsx(ModelDFSL_VMR8P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VMR8P.xlsx") #Yearly CO2 emissions (delay)
    write_xlsx(ModelDFSL_VMR8P_YC,"CEmissions_P\\ModelDFSL_R_CE_VMR8P.xlsx") #Yearly C emissions
    write_xlsx(ModelDFSL_VMR8P_YCT,"CTails_P\\ModelDFSL_R_CT_VMR8P.xlsx") #Yearly C emissions



    #### 11.10 - VMR9) Manure; 90%clay; Reduced Tillage ####
    #The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
    fT_VMR9=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
    fW_VMR9=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                            S.Thick = soil.thick, pClay = clay100*0.9,
                            pE = 1.0, bare = FALSE)$b #Moisture effects per month
    xi.frame_VMR9=data.frame(years,rep(fT_VMR9*fW_VMR9,length.out=length(years)))

    #To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
    Model_VMR9=SoilR::RothCModel(
      t=years, #Simulation Length
      ks=c(k.DPM = 10*RTRM, k.RPM = 0.3*RTRM, k.BIO = 0.66*RTRM, k.HUM = 0.02*RTRM, k.IOM = 0*RTRM), #Decomposition rates for the different pools
      C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
      In=Scalar_LitterCinputs*0, #Amount of litter inputs by time
      FYM = Scalar_ManureCinputs*1, #Amount of Farm Yard Manure by time
      clay=clay100*0.9, #Percent clay in mineral soil
      xi=xi.frame_VMR9) #Loads the model

    Ct_VMR9=getC(Model_VMR9) #Calculates stocks for each pool per month

    #The results can be plotted with the commands
    matplot(years, Ct_VMR9, type="l", lty=1, col=1:5,
            xlab="Time (years)", ylab="C stocks (Mg/ha)")
    legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
           lty=1, col=1:5, bty="n")

    VEC_Lit_VMR9 <- rep(M_Scalar_LitterCinputs*0, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
    VEC_Man_VMR9 <- rep(M_Scalar_ManureCinputs*1, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

    VEC_LitDF_VMR9 <- as.data.frame(VEC_Lit_VMR9) #Converting the Litter vector to a data frame
    VEC_LitDF_VMR9$MNumber <- seq(from = 1, to = SimulationLength_months)
    VEC_ManDF_VMR9 <- as.data.frame(VEC_Man_VMR9) #Converting the Manure vector to a data frame
    VEC_ManDF_VMR9$MNumber <- seq(from = 1, to = SimulationLength_months)

    sapply(VEC_LitDF_VMR9, class) #Check that class is numeric
    sapply(VEC_ManDF_VMR9, class) #Check that class is numeric
    LitterCinputs_VMR9=VEC_LitDF_VMR9   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    ManureCinputs_VMR9=VEC_ManDF_VMR9 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    MCinputs_VMR9 <- merge(LitterCinputs_VMR9, ManureCinputs_VMR9, by = "MNumber")
    MCinputs_VMR9$MInput_VMR9 <- MCinputs_VMR9$VEC_Lit_VMR9 + MCinputs_VMR9$VEC_Man_VMR9

    #Change names of litter and manure columns for more common ones
    colnames(MCinputs_VMR9)[which(names(MCinputs_VMR9) == "VEC_Lit_VMR9")] <- "LitterC_VMR9"
    colnames(MCinputs_VMR9)[which(names(MCinputs_VMR9) == "VEC_Man_VMR9")] <- "ManureC_VMR9"

    #Create a dataframe with the data considering the simulation length
    ModelDF_VMR9 <- as.data.frame(Ct_VMR9)
    colnames(ModelDF_VMR9) <- c('DPM_VMR9','RPM_VMR9','BIO_VMR9', 'HUM_VMR9', 'IOM_VMR9')
    ModelDFS_VMR9 <- ModelDF_VMR9[1:SimulationLength_months, ]

    #Create a column with the number of month of analysis
    ModelDFS_VMR9$MNumber <- seq(from = 1, to = SimulationLength_months)

    #Create a column that sums all pools
    ModelDFS_VMR9$AllPools_VMR9 <- ModelDFS_VMR9$DPM_VMR9 + ModelDFS_VMR9$RPM_VMR9 + ModelDFS_VMR9$BIO_VMR9 + ModelDFS_VMR9$HUM_VMR9 + ModelDFS_VMR9$IOM_VMR9

    #Create a column that sums all pools except IOM (static)
    ModelDFS_VMR9$AllPools_noIOM_VMR9 <- ModelDFS_VMR9$DPM_VMR9 + ModelDFS_VMR9$RPM_VMR9 + ModelDFS_VMR9$BIO_VMR9 + ModelDFS_VMR9$HUM_VMR9

    #Create a column that add the monthly input of C (manure and litter separately)
    ModelDFSL_VMR9 <- merge(ModelDFS_VMR9, MCinputs_VMR9, by = "MNumber")

    ModelDFSL_VMR9$MInput_VMR9 <- ModelDFSL_VMR9$LitterC_VMR9 + ModelDFSL_VMR9$ManureC_VMR9
    #ModelDF_SL$MInput[1] <- 0

    #Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
    ModelDFSL_VMR9$CTails_VMR9 <- ModelDFSL_VMR9$AllPools_noIOM_VMR9 + ModelDFSL_VMR9$MInput_VMR9

    #Create Monthly Accumulated input of C
    ModelDFSL_VMR9$AccumInput_VMR9 = ModelDFSL_VMR9$AccumInput_VMR9=cumsum(ModelDFSL_VMR9$MInput_VMR9)

    #Create Monthly Growths for each carbon pool
    ModelDFSL_VMR9$MGrowth_DPM_VMR9 <- ave(ModelDFSL_VMR9$DPM_VMR9, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMR9$MGrowth_RPM_VMR9 <- ave(ModelDFSL_VMR9$RPM_VMR9, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMR9$MGrowth_BIO_VMR9 <- ave(ModelDFSL_VMR9$BIO_VMR9, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMR9$MGrowth_HUM_VMR9 <- ave(ModelDFSL_VMR9$HUM_VMR9, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMR9$MGrowth_IOM_VMR9 <- ave(ModelDFSL_VMR9$IOM_VMR9, FUN = function(x) c(0, diff(x)))

    #Create column for Monthly and Accumulated C-CO2 emissions
    ModelDFSL_VMR9$M_CCO2_VMR9 <- ModelDFSL_VMR9$MInput_VMR9 - ModelDFSL_VMR9$MGrowth_DPM_VMR9 - ModelDFSL_VMR9$MGrowth_RPM_VMR9 - ModelDFSL_VMR9$MGrowth_BIO_VMR9 - ModelDFSL_VMR9$MGrowth_HUM_VMR9
    ModelDFSL_VMR9$Accum_CCO2_VMR9 <- ModelDFSL_VMR9$AccumInput_VMR9 - ModelDFSL_VMR9$AllPools_noIOM_VMR9

    #Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
    ModelDFSL_VMR9$M_CCO2_VMR9[1] <- 0
    ModelDFSL_VMR9$Accum_CCO2_VMR9[1] <- 0

    #Balance validation
    ModelDFSL_VMR9$Balance_VMR9 <- ModelDFSL_VMR9$AccumInput_VMR9 - ModelDFSL_VMR9$Accum_CCO2_VMR9 - (ModelDFSL_VMR9$DPM_VMR9 + ModelDFSL_VMR9$RPM_VMR9 + ModelDFSL_VMR9$BIO_VMR9 + ModelDFSL_VMR9$HUM_VMR9)

    #Convert C-CO2 emissions into CO2 emissions
    ModelDFSL_VMR9$M_CO2_VMR9 <- ModelDFSL_VMR9$M_CCO2_VMR9 * 44/12
    ModelDFSL_VMR9$Accum_CO2_VMR9 <- ModelDFSL_VMR9$Accum_CCO2_VMR9 * 44/12

    #This model will be called VMR9C because implies a continuous input of C
    ModelDFSL_VMR9C <- ModelDFSL_VMR9

    #Export the dataframe
    write_xlsx(ModelDFSL_VMR9C,"VXC_Models\\ModelDFSL_R_VMR9C.xlsx")

    #Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
    #Create two equal models by using the above general script
    #Create model t=x
    ModelDFSLt0_VMR9 <- ModelDFSL_VMR9 #Create model t=x

    #Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
    ModelDFSLt1_VMR9.1 <- rbind(c(0:0), ModelDFSLt0_VMR9)
    ModelDFSLt1_VMR9.2 <- rbind(c(0:0), ModelDFSLt1_VMR9.1)
    ModelDFSLt1_VMR9.3 <- rbind(c(0:0), ModelDFSLt1_VMR9.2)
    ModelDFSLt1_VMR9.4 <- rbind(c(0:0), ModelDFSLt1_VMR9.3)
    ModelDFSLt1_VMR9.5 <- rbind(c(0:0), ModelDFSLt1_VMR9.4)
    ModelDFSLt1_VMR9.6 <- rbind(c(0:0), ModelDFSLt1_VMR9.5)
    ModelDFSLt1_VMR9.7 <- rbind(c(0:0), ModelDFSLt1_VMR9.6)
    ModelDFSLt1_VMR9.8 <- rbind(c(0:0), ModelDFSLt1_VMR9.7)
    ModelDFSLt1_VMR9.9 <- rbind(c(0:0), ModelDFSLt1_VMR9.8)
    ModelDFSLt1_VMR9.10 <- rbind(c(0:0), ModelDFSLt1_VMR9.9)
    ModelDFSLt1_VMR9.11 <- rbind(c(0:0), ModelDFSLt1_VMR9.10)
    ModelDFSLt1_VMR9.12 <- rbind(c(0:0), ModelDFSLt1_VMR9.11)
    ModelDFSLt1_VMR9.13 <- ModelDFSLt1_VMR9.12[-nrow(ModelDFSLt1_VMR9.12),]
    ModelDFSLt1_VMR9.14 <- ModelDFSLt1_VMR9.13[-nrow(ModelDFSLt1_VMR9.13),]
    ModelDFSLt1_VMR9.15 <- ModelDFSLt1_VMR9.14[-nrow(ModelDFSLt1_VMR9.14),]
    ModelDFSLt1_VMR9.16 <- ModelDFSLt1_VMR9.15[-nrow(ModelDFSLt1_VMR9.15),]
    ModelDFSLt1_VMR9.17 <- ModelDFSLt1_VMR9.16[-nrow(ModelDFSLt1_VMR9.16),]
    ModelDFSLt1_VMR9.18 <- ModelDFSLt1_VMR9.17[-nrow(ModelDFSLt1_VMR9.17),]
    ModelDFSLt1_VMR9.19 <- ModelDFSLt1_VMR9.18[-nrow(ModelDFSLt1_VMR9.18),]
    ModelDFSLt1_VMR9.20 <- ModelDFSLt1_VMR9.19[-nrow(ModelDFSLt1_VMR9.19),]
    ModelDFSLt1_VMR9.21 <- ModelDFSLt1_VMR9.20[-nrow(ModelDFSLt1_VMR9.20),]
    ModelDFSLt1_VMR9.22 <- ModelDFSLt1_VMR9.21[-nrow(ModelDFSLt1_VMR9.21),]
    ModelDFSLt1_VMR9.23 <- ModelDFSLt1_VMR9.22[-nrow(ModelDFSLt1_VMR9.22),]
    ModelDFSLt1_VMR9.24 <- ModelDFSLt1_VMR9.23[-nrow(ModelDFSLt1_VMR9.23),]

    ModelDFSLt1_VMR9 <- ModelDFSLt1_VMR9.24 #Create model t=x+1

    #Subtract model (t=x) - (t=x+1)
    ModelDFSL1y_VMR9 <- ModelDFSLt0_VMR9 - ModelDFSLt1_VMR9

    #Re-do Month Number column because the substraction was also applied to it
    ModelDFSL1y_VMR9$MNumber <- seq(from = 1, to = SimulationLength_months)

    #This model will be called VMR9P because implies a one-off input of C
    ModelDFSL_VMR9P <- ModelDFSL1y_VMR9

    #Export the dataframe
    write_xlsx(ModelDFSL_VMR9P,"VXP_Models\\ModelDFSL_R_VMR9P.xlsx")


    #Plot 3: Interactive Yearly CO2 emissions #
    MY <- 12
    ModelDFSL_VMR9P_YCO2 <- ModelDFSL_VMR9P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VMR9)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMR9P_YCO2) <- c("Year", "Months", "AnnualCO2_VMR_9")

    #Plot 3: Interactive Yearly CO2 emissions considering a delay
    GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
    ModelDFSL_VMR9P_YCO2D <- merge(ModelDFSL_VMR9P_YCO2, GWP100delay, by = "Year")
    ModelDFSL_VMR9P_YCO2D$AnnualCO2D_VMR_9 <- ModelDFSL_VMR9P_YCO2D$AnnualCO2_VMR_9 * ModelDFSL_VMR9P_YCO2D$GWP100


    #Plot 4: Interactive Yearly C emissions #
    MY <- 12
    ModelDFSL_VMR9P_YC <- ModelDFSL_VMR9P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VMR9)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMR9P_YC) <- c("Year", "Months", "CEmissions_VMR_9")

    #Plot 5: Interactive Yearly C tails (remaining C in Soil) #
    MY <- 12
    ModelDFSL_VMR9P_YCT <- ModelDFSL_VMR9P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VMR9)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMR9P_YCT) <- c("Year", "Months", "CTail_VMR_9")

    #Save Dataframes for Plots 3.1, 3.2, 4 and 5
    write_xlsx(ModelDFSL_VMR9P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VMR9P.xlsx") #Yearly CO2 emissions (no delay)
    write_xlsx(ModelDFSL_VMR9P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VMR9P.xlsx") #Yearly CO2 emissions (delay)
    write_xlsx(ModelDFSL_VMR9P_YC,"CEmissions_P\\ModelDFSL_R_CE_VMR9P.xlsx") #Yearly C emissions
    write_xlsx(ModelDFSL_VMR9P_YCT,"CTails_P\\ModelDFSL_R_CT_VMR9P.xlsx") #Yearly C emissions



    #### 11.11 - VMR10) Manure; 100%clay; Reduced Tillage ####
    #The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
    fT_VMR10=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
    fW_VMR10=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                             S.Thick = soil.thick, pClay = clay100,
                             pE = 1.0, bare = FALSE)$b #Moisture effects per month
    xi.frame_VMR10=data.frame(years,rep(fT_VMR10*fW_VMR10,length.out=length(years)))

    #To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
    Model_VMR10=SoilR::RothCModel(
      t=years, #Simulation Length
      ks=c(k.DPM = 10*RTRM, k.RPM = 0.3*RTRM, k.BIO = 0.66*RTRM, k.HUM = 0.02*RTRM, k.IOM = 0*RTRM), #Decomposition rates for the different pools
      C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
      In=Scalar_LitterCinputs*0, #Amount of litter inputs by time
      FYM = Scalar_ManureCinputs*1, #Amount of Farm Yard Manure by time
      clay=clay100, #Percent clay in mineral soil
      xi=xi.frame_VMR10) #Loads the model

    Ct_VMR10=getC(Model_VMR10) #Calculates stocks for each pool per month

    #The results can be plotted with the commands
    matplot(years, Ct_VMR10, type="l", lty=1, col=1:5,
            xlab="Time (years)", ylab="C stocks (Mg/ha)")
    legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
           lty=1, col=1:5, bty="n")

    VEC_Lit_VMR10 <- rep(M_Scalar_LitterCinputs*0, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
    VEC_Man_VMR10 <- rep(M_Scalar_ManureCinputs*1, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

    VEC_LitDF_VMR10 <- as.data.frame(VEC_Lit_VMR10) #Converting the Litter vector to a data frame
    VEC_LitDF_VMR10$MNumber <- seq(from = 1, to = SimulationLength_months)
    VEC_ManDF_VMR10 <- as.data.frame(VEC_Man_VMR10) #Converting the Manure vector to a data frame
    VEC_ManDF_VMR10$MNumber <- seq(from = 1, to = SimulationLength_months)

    sapply(VEC_LitDF_VMR10, class) #Check that class is numeric
    sapply(VEC_ManDF_VMR10, class) #Check that class is numeric
    LitterCinputs_VMR10=VEC_LitDF_VMR10   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    ManureCinputs_VMR10=VEC_ManDF_VMR10 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    MCinputs_VMR10 <- merge(LitterCinputs_VMR10, ManureCinputs_VMR10, by = "MNumber")
    MCinputs_VMR10$MInput_VMR10 <- MCinputs_VMR10$VEC_Lit_VMR10 + MCinputs_VMR10$VEC_Man_VMR10

    #Change names of litter and manure columns for more common ones
    colnames(MCinputs_VMR10)[which(names(MCinputs_VMR10) == "VEC_Lit_VMR10")] <- "LitterC_VMR10"
    colnames(MCinputs_VMR10)[which(names(MCinputs_VMR10) == "VEC_Man_VMR10")] <- "ManureC_VMR10"

    #Create a dataframe with the data considering the simulation length
    ModelDF_VMR10 <- as.data.frame(Ct_VMR10)
    colnames(ModelDF_VMR10) <- c('DPM_VMR10','RPM_VMR10','BIO_VMR10', 'HUM_VMR10', 'IOM_VMR10')
    ModelDFS_VMR10 <- ModelDF_VMR10[1:SimulationLength_months, ]

    #Create a column with the number of month of analysis
    ModelDFS_VMR10$MNumber <- seq(from = 1, to = SimulationLength_months)

    #Create a column that sums all pools
    ModelDFS_VMR10$AllPools_VMR10 <- ModelDFS_VMR10$DPM_VMR10 + ModelDFS_VMR10$RPM_VMR10 + ModelDFS_VMR10$BIO_VMR10 + ModelDFS_VMR10$HUM_VMR10 + ModelDFS_VMR10$IOM_VMR10

    #Create a column that sums all pools except IOM (static)
    ModelDFS_VMR10$AllPools_noIOM_VMR10 <- ModelDFS_VMR10$DPM_VMR10 + ModelDFS_VMR10$RPM_VMR10 + ModelDFS_VMR10$BIO_VMR10 + ModelDFS_VMR10$HUM_VMR10

    #Create a column that add the monthly input of C (manure and litter separately)
    ModelDFSL_VMR10 <- merge(ModelDFS_VMR10, MCinputs_VMR10, by = "MNumber")

    ModelDFSL_VMR10$MInput_VMR10 <- ModelDFSL_VMR10$LitterC_VMR10 + ModelDFSL_VMR10$ManureC_VMR10
    #ModelDF_SL$MInput[1] <- 0

    #Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
    ModelDFSL_VMR10$CTails_VMR10 <- ModelDFSL_VMR10$AllPools_noIOM_VMR10 + ModelDFSL_VMR10$MInput_VMR10

    #Create Monthly Accumulated input of C
    ModelDFSL_VMR10$AccumInput_VMR10 = ModelDFSL_VMR10$AccumInput_VMR10=cumsum(ModelDFSL_VMR10$MInput_VMR10)

    #Create Monthly Growths for each carbon pool
    ModelDFSL_VMR10$MGrowth_DPM_VMR10 <- ave(ModelDFSL_VMR10$DPM_VMR10, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMR10$MGrowth_RPM_VMR10 <- ave(ModelDFSL_VMR10$RPM_VMR10, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMR10$MGrowth_BIO_VMR10 <- ave(ModelDFSL_VMR10$BIO_VMR10, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMR10$MGrowth_HUM_VMR10 <- ave(ModelDFSL_VMR10$HUM_VMR10, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMR10$MGrowth_IOM_VMR10 <- ave(ModelDFSL_VMR10$IOM_VMR10, FUN = function(x) c(0, diff(x)))

    #Create column for Monthly and Accumulated C-CO2 emissions
    ModelDFSL_VMR10$M_CCO2_VMR10 <- ModelDFSL_VMR10$MInput_VMR10 - ModelDFSL_VMR10$MGrowth_DPM_VMR10 - ModelDFSL_VMR10$MGrowth_RPM_VMR10 - ModelDFSL_VMR10$MGrowth_BIO_VMR10 - ModelDFSL_VMR10$MGrowth_HUM_VMR10
    ModelDFSL_VMR10$Accum_CCO2_VMR10 <- ModelDFSL_VMR10$AccumInput_VMR10 - ModelDFSL_VMR10$AllPools_noIOM_VMR10

    #Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
    ModelDFSL_VMR10$M_CCO2_VMR10[1] <- 0
    ModelDFSL_VMR10$Accum_CCO2_VMR10[1] <- 0

    #Balance validation
    ModelDFSL_VMR10$Balance_VMR10 <- ModelDFSL_VMR10$AccumInput_VMR10 - ModelDFSL_VMR10$Accum_CCO2_VMR10 - (ModelDFSL_VMR10$DPM_VMR10 + ModelDFSL_VMR10$RPM_VMR10 + ModelDFSL_VMR10$BIO_VMR10 + ModelDFSL_VMR10$HUM_VMR10)

    #Convert C-CO2 emissions into CO2 emissions
    ModelDFSL_VMR10$M_CO2_VMR10 <- ModelDFSL_VMR10$M_CCO2_VMR10 * 44/12
    ModelDFSL_VMR10$Accum_CO2_VMR10 <- ModelDFSL_VMR10$Accum_CCO2_VMR10 * 44/12

    #This model will be called VMR10C because implies a continuous input of C
    ModelDFSL_VMR10C <- ModelDFSL_VMR10

    #Export the dataframe
    write_xlsx(ModelDFSL_VMR10C,"VXC_Models\\ModelDFSL_R_VMR10C.xlsx")

    #Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
    #Create two equal models by using the above general script
    #Create model t=x
    ModelDFSLt0_VMR10 <- ModelDFSL_VMR10 #Create model t=x

    #Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
    ModelDFSLt1_VMR10.1 <- rbind(c(0:0), ModelDFSLt0_VMR10)
    ModelDFSLt1_VMR10.2 <- rbind(c(0:0), ModelDFSLt1_VMR10.1)
    ModelDFSLt1_VMR10.3 <- rbind(c(0:0), ModelDFSLt1_VMR10.2)
    ModelDFSLt1_VMR10.4 <- rbind(c(0:0), ModelDFSLt1_VMR10.3)
    ModelDFSLt1_VMR10.5 <- rbind(c(0:0), ModelDFSLt1_VMR10.4)
    ModelDFSLt1_VMR10.6 <- rbind(c(0:0), ModelDFSLt1_VMR10.5)
    ModelDFSLt1_VMR10.7 <- rbind(c(0:0), ModelDFSLt1_VMR10.6)
    ModelDFSLt1_VMR10.8 <- rbind(c(0:0), ModelDFSLt1_VMR10.7)
    ModelDFSLt1_VMR10.9 <- rbind(c(0:0), ModelDFSLt1_VMR10.8)
    ModelDFSLt1_VMR10.10 <- rbind(c(0:0), ModelDFSLt1_VMR10.9)
    ModelDFSLt1_VMR10.11 <- rbind(c(0:0), ModelDFSLt1_VMR10.10)
    ModelDFSLt1_VMR10.12 <- rbind(c(0:0), ModelDFSLt1_VMR10.11)
    ModelDFSLt1_VMR10.13 <- ModelDFSLt1_VMR10.12[-nrow(ModelDFSLt1_VMR10.12),]
    ModelDFSLt1_VMR10.14 <- ModelDFSLt1_VMR10.13[-nrow(ModelDFSLt1_VMR10.13),]
    ModelDFSLt1_VMR10.15 <- ModelDFSLt1_VMR10.14[-nrow(ModelDFSLt1_VMR10.14),]
    ModelDFSLt1_VMR10.16 <- ModelDFSLt1_VMR10.15[-nrow(ModelDFSLt1_VMR10.15),]
    ModelDFSLt1_VMR10.17 <- ModelDFSLt1_VMR10.16[-nrow(ModelDFSLt1_VMR10.16),]
    ModelDFSLt1_VMR10.18 <- ModelDFSLt1_VMR10.17[-nrow(ModelDFSLt1_VMR10.17),]
    ModelDFSLt1_VMR10.19 <- ModelDFSLt1_VMR10.18[-nrow(ModelDFSLt1_VMR10.18),]
    ModelDFSLt1_VMR10.20 <- ModelDFSLt1_VMR10.19[-nrow(ModelDFSLt1_VMR10.19),]
    ModelDFSLt1_VMR10.21 <- ModelDFSLt1_VMR10.20[-nrow(ModelDFSLt1_VMR10.20),]
    ModelDFSLt1_VMR10.22 <- ModelDFSLt1_VMR10.21[-nrow(ModelDFSLt1_VMR10.21),]
    ModelDFSLt1_VMR10.23 <- ModelDFSLt1_VMR10.22[-nrow(ModelDFSLt1_VMR10.22),]
    ModelDFSLt1_VMR10.24 <- ModelDFSLt1_VMR10.23[-nrow(ModelDFSLt1_VMR10.23),]

    ModelDFSLt1_VMR10 <- ModelDFSLt1_VMR10.24 #Create model t=x+1

    #Subtract model (t=x) - (t=x+1)
    ModelDFSL1y_VMR10 <- ModelDFSLt0_VMR10 - ModelDFSLt1_VMR10

    #Re-do Month Number column because the substraction was also applied to it
    ModelDFSL1y_VMR10$MNumber <- seq(from = 1, to = SimulationLength_months)

    #This model will be called VMR10P because implies a one-off input of C
    ModelDFSL_VMR10P <- ModelDFSL1y_VMR10

    #Export the dataframe
    write_xlsx(ModelDFSL_VMR10P,"VXP_Models\\ModelDFSL_R_VMR10P.xlsx")


    #Plot 3: Interactive Yearly CO2 emissions #
    MY <- 12
    ModelDFSL_VMR10P_YCO2 <- ModelDFSL_VMR10P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VMR10)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMR10P_YCO2) <- c("Year", "Months", "AnnualCO2_VMR10")

    #Plot 3: Interactive Yearly CO2 emissions considering a delay
    GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
    ModelDFSL_VMR10P_YCO2D <- merge(ModelDFSL_VMR10P_YCO2, GWP100delay, by = "Year")
    ModelDFSL_VMR10P_YCO2D$AnnualCO2D_VMR10 <- ModelDFSL_VMR10P_YCO2D$AnnualCO2_VMR10 * ModelDFSL_VMR10P_YCO2D$GWP100

    #Plot 4: Interactive Yearly C emissions #
    MY <- 12
    ModelDFSL_VMR10P_YC <- ModelDFSL_VMR10P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VMR10)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMR10P_YC) <- c("Year", "Months", "CEmissions_VMR10")

    #Plot 5: Interactive Yearly C tails (remaining C in Soil) #
    MY <- 12
    ModelDFSL_VMR10P_YCT <- ModelDFSL_VMR10P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VMR10)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMR10P_YCT) <- c("Year", "Months", "CTail_VMR10")

    #Save Dataframes for Plots 3.1, 3.2, 4 and 5
    write_xlsx(ModelDFSL_VMR10P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VMR10P.xlsx") #Yearly CO2 emissions (no delay)
    write_xlsx(ModelDFSL_VMR10P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VMR10P.xlsx") #Yearly CO2 emissions (delay)
    write_xlsx(ModelDFSL_VMR10P_YC,"CEmissions_P\\ModelDFSL_R_CE_VMR10P.xlsx") #Yearly C emissions
    write_xlsx(ModelDFSL_VMR10P_YCT,"CTails_P\\ModelDFSL_R_CT_VMR10P.xlsx") #Yearly C emissions

  }
  else if(Scope == "VMN"){
    #### 12) Model Combinations - Manure; No Tillage, 0-100% (+10%) Clay ####
    #### 12.1 - VMN0) Manure; 0%clay; No Tillage ####
    #The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
    fT_VMN0=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
    fW_VMN0=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                            S.Thick = soil.thick, pClay = clay0,
                            pE = 1.0, bare = FALSE)$b #Moisture effects per month
    xi.frame_VMN0=data.frame(years,rep(fT_VMN0*fW_VMN0,length.out=length(years)))

    #To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
    Model_VMN0=SoilR::RothCModel(
      t=years, #Simulation Length
      ks=c(k.DPM = 10*NTRM, k.RPM = 0.3*NTRM, k.BIO = 0.66*NTRM, k.HUM = 0.02*NTRM, k.IOM = 0*NTRM), #Decomposition rates for the different pools
      C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
      In=Scalar_LitterCinputs*0, #Amount of litter inputs by time
      FYM = Scalar_ManureCinputs*1, #Amount of Farm Yard Manure by time
      clay=clay0, #Percent clay in mineral soil
      xi=xi.frame_VMN0) #Loads the model

    Ct_VMN0=getC(Model_VMN0) #Calculates stocks for each pool per month

    VEC_Lit_VMN0 <- rep(M_Scalar_LitterCinputs*0, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
    VEC_Man_VMN0 <- rep(M_Scalar_ManureCinputs*1, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

    VEC_LitDF_VMN0 <- as.data.frame(VEC_Lit_VMN0) #Converting the Litter vector to a data frame
    VEC_LitDF_VMN0$MNumber <- seq(from = 1, to = SimulationLength_months)
    VEC_ManDF_VMN0 <- as.data.frame(VEC_Man_VMN0) #Converting the Manure vector to a data frame
    VEC_ManDF_VMN0$MNumber <- seq(from = 1, to = SimulationLength_months)

    sapply(VEC_LitDF_VMN0, class) #Check that class is numeric
    sapply(VEC_ManDF_VMN0, class) #Check that class is numeric
    LitterCinputs_VMN0=VEC_LitDF_VMN0   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    ManureCinputs_VMN0=VEC_ManDF_VMN0 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    MCinputs_VMN0 <- merge(LitterCinputs_VMN0, ManureCinputs_VMN0, by = "MNumber")
    MCinputs_VMN0$MInput_VMN0 <- MCinputs_VMN0$VEC_Lit_VMN0 + MCinputs_VMN0$VEC_Man_VMN0

    #Change names of litter and manure columns for more common ones
    colnames(MCinputs_VMN0)[which(names(MCinputs_VMN0) == "VEC_Lit_VMN0")] <- "LitterC_VMN0"
    colnames(MCinputs_VMN0)[which(names(MCinputs_VMN0) == "VEC_Man_VMN0")] <- "ManureC_VMN0"

    #Create a dataframe with the data considering the simulation length
    ModelDF_VMN0 <- as.data.frame(Ct_VMN0)
    colnames(ModelDF_VMN0) <- c('DPM_VMN0','RPM_VMN0','BIO_VMN0', 'HUM_VMN0', 'IOM_VMN0')
    ModelDFS_VMN0 <- ModelDF_VMN0[1:SimulationLength_months, ]

    #Create a column with the number of month of analysis
    ModelDFS_VMN0$MNumber <- seq(from = 1, to = SimulationLength_months)

    #Create a column that sums all pools
    ModelDFS_VMN0$AllPools_VMN0 <- ModelDFS_VMN0$DPM_VMN0 + ModelDFS_VMN0$RPM_VMN0 + ModelDFS_VMN0$BIO_VMN0 + ModelDFS_VMN0$HUM_VMN0 + ModelDFS_VMN0$IOM_VMN0

    #Create a column that sums all pools except IOM (static)
    ModelDFS_VMN0$AllPools_noIOM_VMN0 <- ModelDFS_VMN0$DPM_VMN0 + ModelDFS_VMN0$RPM_VMN0 + ModelDFS_VMN0$BIO_VMN0 + ModelDFS_VMN0$HUM_VMN0

    #Create a column that add the monthly input of C (manure and litter separately)
    ModelDFSL_VMN0 <- merge(ModelDFS_VMN0, MCinputs_VMN0, by = "MNumber")

    ModelDFSL_VMN0$MInput_VMN0 <- ModelDFSL_VMN0$LitterC_VMN0 + ModelDFSL_VMN0$ManureC_VMN0
    #ModelDF_SL$MInput[1] <- 0

    #Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
    ModelDFSL_VMN0$CTails_VMN0 <- ModelDFSL_VMN0$AllPools_noIOM_VMN0 + ModelDFSL_VMN0$MInput_VMN0

    #Create Monthly Accumulated input of C
    ModelDFSL_VMN0$AccumInput_VMN0 = ModelDFSL_VMN0$AccumInput_VMN0=cumsum(ModelDFSL_VMN0$MInput_VMN0)

    #Create Monthly Growths for each carbon pool
    ModelDFSL_VMN0$MGrowth_DPM_VMN0 <- ave(ModelDFSL_VMN0$DPM_VMN0, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMN0$MGrowth_RPM_VMN0 <- ave(ModelDFSL_VMN0$RPM_VMN0, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMN0$MGrowth_BIO_VMN0 <- ave(ModelDFSL_VMN0$BIO_VMN0, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMN0$MGrowth_HUM_VMN0 <- ave(ModelDFSL_VMN0$HUM_VMN0, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMN0$MGrowth_IOM_VMN0 <- ave(ModelDFSL_VMN0$IOM_VMN0, FUN = function(x) c(0, diff(x)))

    #Create column for Monthly and Accumulated C-CO2 emissions
    ModelDFSL_VMN0$M_CCO2_VMN0 <- ModelDFSL_VMN0$MInput_VMN0 - ModelDFSL_VMN0$MGrowth_DPM_VMN0 - ModelDFSL_VMN0$MGrowth_RPM_VMN0 - ModelDFSL_VMN0$MGrowth_BIO_VMN0 - ModelDFSL_VMN0$MGrowth_HUM_VMN0
    ModelDFSL_VMN0$Accum_CCO2_VMN0 <- ModelDFSL_VMN0$AccumInput_VMN0 - ModelDFSL_VMN0$AllPools_noIOM_VMN0

    #Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
    ModelDFSL_VMN0$M_CCO2_VMN0[1] <- 0
    ModelDFSL_VMN0$Accum_CCO2_VMN0[1] <- 0

    #Balance validation
    ModelDFSL_VMN0$Balance_VMN0 <- ModelDFSL_VMN0$AccumInput_VMN0 - ModelDFSL_VMN0$Accum_CCO2_VMN0 - (ModelDFSL_VMN0$DPM_VMN0 + ModelDFSL_VMN0$RPM_VMN0 + ModelDFSL_VMN0$BIO_VMN0 + ModelDFSL_VMN0$HUM_VMN0)

    #Convert C-CO2 emissions into CO2 emissions
    ModelDFSL_VMN0$M_CO2_VMN0 <- ModelDFSL_VMN0$M_CCO2_VMN0 * 44/12
    ModelDFSL_VMN0$Accum_CO2_VMN0 <- ModelDFSL_VMN0$Accum_CCO2_VMN0 * 44/12

    #This model will be called VMN0C because implies a continuous input of C
    ModelDFSL_VMN0C <- ModelDFSL_VMN0

    #Export the dataframe
    write_xlsx(ModelDFSL_VMN0C,"VXC_Models\\ModelDFSL_R_VMN0C.xlsx")

    #Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
    #Create two equal models by using the above general script
    #Create model t=x
    ModelDFSLt0_VMN0 <- ModelDFSL_VMN0 #Create model t=x

    #Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
    ModelDFSLt1_VMN0.1 <- rbind(c(0:0), ModelDFSLt0_VMN0)
    ModelDFSLt1_VMN0.2 <- rbind(c(0:0), ModelDFSLt1_VMN0.1)
    ModelDFSLt1_VMN0.3 <- rbind(c(0:0), ModelDFSLt1_VMN0.2)
    ModelDFSLt1_VMN0.4 <- rbind(c(0:0), ModelDFSLt1_VMN0.3)
    ModelDFSLt1_VMN0.5 <- rbind(c(0:0), ModelDFSLt1_VMN0.4)
    ModelDFSLt1_VMN0.6 <- rbind(c(0:0), ModelDFSLt1_VMN0.5)
    ModelDFSLt1_VMN0.7 <- rbind(c(0:0), ModelDFSLt1_VMN0.6)
    ModelDFSLt1_VMN0.8 <- rbind(c(0:0), ModelDFSLt1_VMN0.7)
    ModelDFSLt1_VMN0.9 <- rbind(c(0:0), ModelDFSLt1_VMN0.8)
    ModelDFSLt1_VMN0.10 <- rbind(c(0:0), ModelDFSLt1_VMN0.9)
    ModelDFSLt1_VMN0.11 <- rbind(c(0:0), ModelDFSLt1_VMN0.10)
    ModelDFSLt1_VMN0.12 <- rbind(c(0:0), ModelDFSLt1_VMN0.11)
    ModelDFSLt1_VMN0.13 <- ModelDFSLt1_VMN0.12[-nrow(ModelDFSLt1_VMN0.12),]
    ModelDFSLt1_VMN0.14 <- ModelDFSLt1_VMN0.13[-nrow(ModelDFSLt1_VMN0.13),]
    ModelDFSLt1_VMN0.15 <- ModelDFSLt1_VMN0.14[-nrow(ModelDFSLt1_VMN0.14),]
    ModelDFSLt1_VMN0.16 <- ModelDFSLt1_VMN0.15[-nrow(ModelDFSLt1_VMN0.15),]
    ModelDFSLt1_VMN0.17 <- ModelDFSLt1_VMN0.16[-nrow(ModelDFSLt1_VMN0.16),]
    ModelDFSLt1_VMN0.18 <- ModelDFSLt1_VMN0.17[-nrow(ModelDFSLt1_VMN0.17),]
    ModelDFSLt1_VMN0.19 <- ModelDFSLt1_VMN0.18[-nrow(ModelDFSLt1_VMN0.18),]
    ModelDFSLt1_VMN0.20 <- ModelDFSLt1_VMN0.19[-nrow(ModelDFSLt1_VMN0.19),]
    ModelDFSLt1_VMN0.21 <- ModelDFSLt1_VMN0.20[-nrow(ModelDFSLt1_VMN0.20),]
    ModelDFSLt1_VMN0.22 <- ModelDFSLt1_VMN0.21[-nrow(ModelDFSLt1_VMN0.21),]
    ModelDFSLt1_VMN0.23 <- ModelDFSLt1_VMN0.22[-nrow(ModelDFSLt1_VMN0.22),]
    ModelDFSLt1_VMN0.24 <- ModelDFSLt1_VMN0.23[-nrow(ModelDFSLt1_VMN0.23),]

    ModelDFSLt1_VMN0 <- ModelDFSLt1_VMN0.24 #Create model t=x+1

    #Subtract model (t=x) - (t=x+1)
    ModelDFSL1y_VMN0 <- ModelDFSLt0_VMN0 - ModelDFSLt1_VMN0

    #Re-do Month Number column because the substraction was also applied to it
    ModelDFSL1y_VMN0$MNumber <- seq(from = 1, to = SimulationLength_months)

    #This model will be called VMN0P because implies a one-off input of C
    ModelDFSL_VMN0P <- ModelDFSL1y_VMN0

    #Export the dataframe
    write_xlsx(ModelDFSL_VMN0P,"VXP_Models\\ModelDFSL_R_VMN0P.xlsx")

    #Plot 3.1: Interactive Yearly CO2 emissions #
    MY <- 12
    ModelDFSL_VMN0P_YCO2 <- ModelDFSL_VMN0P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VMN0)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMN0P_YCO2) <- c("Year", "Months", "AnnualCO2_VMN_0")

    #Plot 3.2: Interactive Yearly CO2 emissions considering a delay
    GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
    ModelDFSL_VMN0P_YCO2D <- merge(ModelDFSL_VMN0P_YCO2, GWP100delay, by = "Year")
    ModelDFSL_VMN0P_YCO2D$AnnualCO2D_VMN_0 <- ModelDFSL_VMN0P_YCO2D$AnnualCO2_VMN_0 * ModelDFSL_VMN0P_YCO2D$GWP100

    #Plot 4: Interactive Yearly C emissions #
    MY <- 12
    ModelDFSL_VMN0P_YC <- ModelDFSL_VMN0P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VMN0)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMN0P_YC) <- c("Year", "Months", "CEmissions_VMN_0")

    #Plot 5: Interactive Yearly C tails (remaining C in Soil) #
    MY <- 12
    ModelDFSL_VMN0P_YCT <- ModelDFSL_VMN0P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VMN0)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMN0P_YCT) <- c("Year", "Months", "CTail_VMN_0")

    #Save Dataframes for Plots 3.1, 3.2, 4 and 5
    write_xlsx(ModelDFSL_VMN0P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VMN0P.xlsx") #Yearly CO2 emissions (no delay)
    write_xlsx(ModelDFSL_VMN0P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VMN0P.xlsx") #Yearly CO2 emissions (delay)
    write_xlsx(ModelDFSL_VMN0P_YC,"CEmissions_P\\ModelDFSL_R_CE_VMN0P.xlsx") #Yearly C emissions
    write_xlsx(ModelDFSL_VMN0P_YCT,"CTails_P\\ModelDFSL_R_CT_VMN0P.xlsx") #Yearly C emissions


    #### 12.2 - VMN1) Manure; 10%clay; No Tillage ####
    #The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
    fT_VMN1=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
    fW_VMN1=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                            S.Thick = soil.thick, pClay = clay100*0.1,
                            pE = 1.0, bare = FALSE)$b #Moisture effects per month
    xi.frame_VMN1=data.frame(years,rep(fT_VMN1*fW_VMN1,length.out=length(years)))

    #To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
    Model_VMN1=SoilR::RothCModel(
      t=years, #Simulation Length
      ks=c(k.DPM = 10*NTRM, k.RPM = 0.3*NTRM, k.BIO = 0.66*NTRM, k.HUM = 0.02*NTRM, k.IOM = 0*NTRM), #Decomposition rates for the different pools
      C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
      In=Scalar_LitterCinputs*0, #Amount of litter inputs by time
      FYM = Scalar_ManureCinputs*1, #Amount of Farm Yard Manure by time
      clay=clay100*0.1, #Percent clay in mineral soil
      xi=xi.frame_VMN1) #Loads the model

    Ct_VMN1=getC(Model_VMN1) #Calculates stocks for each pool per month

    #The results can be plotted with the commands
    matplot(years, Ct_VMN1, type="l", lty=1, col=1:5,
            xlab="Time (years)", ylab="C stocks (Mg/ha)")
    legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
           lty=1, col=1:5, bty="n")

    VEC_Lit_VMN1 <- rep(M_Scalar_LitterCinputs*0, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
    VEC_Man_VMN1 <- rep(M_Scalar_ManureCinputs*1, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

    VEC_LitDF_VMN1 <- as.data.frame(VEC_Lit_VMN1) #Converting the Litter vector to a data frame
    VEC_LitDF_VMN1$MNumber <- seq(from = 1, to = SimulationLength_months)
    VEC_ManDF_VMN1 <- as.data.frame(VEC_Man_VMN1) #Converting the Manure vector to a data frame
    VEC_ManDF_VMN1$MNumber <- seq(from = 1, to = SimulationLength_months)

    sapply(VEC_LitDF_VMN1, class) #Check that class is numeric
    sapply(VEC_ManDF_VMN1, class) #Check that class is numeric
    LitterCinputs_VMN1=VEC_LitDF_VMN1   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    ManureCinputs_VMN1=VEC_ManDF_VMN1 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    MCinputs_VMN1 <- merge(LitterCinputs_VMN1, ManureCinputs_VMN1, by = "MNumber")
    MCinputs_VMN1$MInput_VMN1 <- MCinputs_VMN1$VEC_Lit_VMN1 + MCinputs_VMN1$VEC_Man_VMN1

    #Change names of litter and manure columns for more common ones
    colnames(MCinputs_VMN1)[which(names(MCinputs_VMN1) == "VEC_Lit_VMN1")] <- "LitterC_VMN1"
    colnames(MCinputs_VMN1)[which(names(MCinputs_VMN1) == "VEC_Man_VMN1")] <- "ManureC_VMN1"

    #Create a dataframe with the data considering the simulation length
    ModelDF_VMN1 <- as.data.frame(Ct_VMN1)
    colnames(ModelDF_VMN1) <- c('DPM_VMN1','RPM_VMN1','BIO_VMN1', 'HUM_VMN1', 'IOM_VMN1')
    ModelDFS_VMN1 <- ModelDF_VMN1[1:SimulationLength_months, ]

    #Create a column with the number of month of analysis
    ModelDFS_VMN1$MNumber <- seq(from = 1, to = SimulationLength_months)

    #Create a column that sums all pools
    ModelDFS_VMN1$AllPools_VMN1 <- ModelDFS_VMN1$DPM_VMN1 + ModelDFS_VMN1$RPM_VMN1 + ModelDFS_VMN1$BIO_VMN1 + ModelDFS_VMN1$HUM_VMN1 + ModelDFS_VMN1$IOM_VMN1

    #Create a column that sums all pools except IOM (static)
    ModelDFS_VMN1$AllPools_noIOM_VMN1 <- ModelDFS_VMN1$DPM_VMN1 + ModelDFS_VMN1$RPM_VMN1 + ModelDFS_VMN1$BIO_VMN1 + ModelDFS_VMN1$HUM_VMN1

    #Create a column that add the monthly input of C (manure and litter separately)
    ModelDFSL_VMN1 <- merge(ModelDFS_VMN1, MCinputs_VMN1, by = "MNumber")

    ModelDFSL_VMN1$MInput_VMN1 <- ModelDFSL_VMN1$LitterC_VMN1 + ModelDFSL_VMN1$ManureC_VMN1
    #ModelDF_SL$MInput[1] <- 0

    #Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
    ModelDFSL_VMN1$CTails_VMN1 <- ModelDFSL_VMN1$AllPools_noIOM_VMN1 + ModelDFSL_VMN1$MInput_VMN1

    #Create Monthly Accumulated input of C
    ModelDFSL_VMN1$AccumInput_VMN1 = ModelDFSL_VMN1$AccumInput_VMN1=cumsum(ModelDFSL_VMN1$MInput_VMN1)

    #Create Monthly Growths for each carbon pool
    ModelDFSL_VMN1$MGrowth_DPM_VMN1 <- ave(ModelDFSL_VMN1$DPM_VMN1, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMN1$MGrowth_RPM_VMN1 <- ave(ModelDFSL_VMN1$RPM_VMN1, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMN1$MGrowth_BIO_VMN1 <- ave(ModelDFSL_VMN1$BIO_VMN1, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMN1$MGrowth_HUM_VMN1 <- ave(ModelDFSL_VMN1$HUM_VMN1, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMN1$MGrowth_IOM_VMN1 <- ave(ModelDFSL_VMN1$IOM_VMN1, FUN = function(x) c(0, diff(x)))

    #Create column for Monthly and Accumulated C-CO2 emissions
    ModelDFSL_VMN1$M_CCO2_VMN1 <- ModelDFSL_VMN1$MInput_VMN1 - ModelDFSL_VMN1$MGrowth_DPM_VMN1 - ModelDFSL_VMN1$MGrowth_RPM_VMN1 - ModelDFSL_VMN1$MGrowth_BIO_VMN1 - ModelDFSL_VMN1$MGrowth_HUM_VMN1
    ModelDFSL_VMN1$Accum_CCO2_VMN1 <- ModelDFSL_VMN1$AccumInput_VMN1 - ModelDFSL_VMN1$AllPools_noIOM_VMN1

    #Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
    ModelDFSL_VMN1$M_CCO2_VMN1[1] <- 0
    ModelDFSL_VMN1$Accum_CCO2_VMN1[1] <- 0

    #Balance validation
    ModelDFSL_VMN1$Balance_VMN1 <- ModelDFSL_VMN1$AccumInput_VMN1 - ModelDFSL_VMN1$Accum_CCO2_VMN1 - (ModelDFSL_VMN1$DPM_VMN1 + ModelDFSL_VMN1$RPM_VMN1 + ModelDFSL_VMN1$BIO_VMN1 + ModelDFSL_VMN1$HUM_VMN1)

    #Convert C-CO2 emissions into CO2 emissions
    ModelDFSL_VMN1$M_CO2_VMN1 <- ModelDFSL_VMN1$M_CCO2_VMN1 * 44/12
    ModelDFSL_VMN1$Accum_CO2_VMN1 <- ModelDFSL_VMN1$Accum_CCO2_VMN1 * 44/12

    #This model will be called VMN1C because implies a continuous input of C
    ModelDFSL_VMN1C <- ModelDFSL_VMN1

    #Export the dataframe
    write_xlsx(ModelDFSL_VMN1C,"VXC_Models\\ModelDFSL_R_VMN1C.xlsx")

    #Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
    #Create two equal models by using the above general script
    #Create model t=x
    ModelDFSLt0_VMN1 <- ModelDFSL_VMN1 #Create model t=x

    #Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
    ModelDFSLt1_VMN1.1 <- rbind(c(0:0), ModelDFSLt0_VMN1)
    ModelDFSLt1_VMN1.2 <- rbind(c(0:0), ModelDFSLt1_VMN1.1)
    ModelDFSLt1_VMN1.3 <- rbind(c(0:0), ModelDFSLt1_VMN1.2)
    ModelDFSLt1_VMN1.4 <- rbind(c(0:0), ModelDFSLt1_VMN1.3)
    ModelDFSLt1_VMN1.5 <- rbind(c(0:0), ModelDFSLt1_VMN1.4)
    ModelDFSLt1_VMN1.6 <- rbind(c(0:0), ModelDFSLt1_VMN1.5)
    ModelDFSLt1_VMN1.7 <- rbind(c(0:0), ModelDFSLt1_VMN1.6)
    ModelDFSLt1_VMN1.8 <- rbind(c(0:0), ModelDFSLt1_VMN1.7)
    ModelDFSLt1_VMN1.9 <- rbind(c(0:0), ModelDFSLt1_VMN1.8)
    ModelDFSLt1_VMN1.10 <- rbind(c(0:0), ModelDFSLt1_VMN1.9)
    ModelDFSLt1_VMN1.11 <- rbind(c(0:0), ModelDFSLt1_VMN1.10)
    ModelDFSLt1_VMN1.12 <- rbind(c(0:0), ModelDFSLt1_VMN1.11)
    ModelDFSLt1_VMN1.13 <- ModelDFSLt1_VMN1.12[-nrow(ModelDFSLt1_VMN1.12),]
    ModelDFSLt1_VMN1.14 <- ModelDFSLt1_VMN1.13[-nrow(ModelDFSLt1_VMN1.13),]
    ModelDFSLt1_VMN1.15 <- ModelDFSLt1_VMN1.14[-nrow(ModelDFSLt1_VMN1.14),]
    ModelDFSLt1_VMN1.16 <- ModelDFSLt1_VMN1.15[-nrow(ModelDFSLt1_VMN1.15),]
    ModelDFSLt1_VMN1.17 <- ModelDFSLt1_VMN1.16[-nrow(ModelDFSLt1_VMN1.16),]
    ModelDFSLt1_VMN1.18 <- ModelDFSLt1_VMN1.17[-nrow(ModelDFSLt1_VMN1.17),]
    ModelDFSLt1_VMN1.19 <- ModelDFSLt1_VMN1.18[-nrow(ModelDFSLt1_VMN1.18),]
    ModelDFSLt1_VMN1.20 <- ModelDFSLt1_VMN1.19[-nrow(ModelDFSLt1_VMN1.19),]
    ModelDFSLt1_VMN1.21 <- ModelDFSLt1_VMN1.20[-nrow(ModelDFSLt1_VMN1.20),]
    ModelDFSLt1_VMN1.22 <- ModelDFSLt1_VMN1.21[-nrow(ModelDFSLt1_VMN1.21),]
    ModelDFSLt1_VMN1.23 <- ModelDFSLt1_VMN1.22[-nrow(ModelDFSLt1_VMN1.22),]
    ModelDFSLt1_VMN1.24 <- ModelDFSLt1_VMN1.23[-nrow(ModelDFSLt1_VMN1.23),]

    ModelDFSLt1_VMN1 <- ModelDFSLt1_VMN1.24 #Create model t=x+1

    #Subtract model (t=x) - (t=x+1)
    ModelDFSL1y_VMN1 <- ModelDFSLt0_VMN1 - ModelDFSLt1_VMN1

    #Re-do Month Number column because the substraction was also applied to it
    ModelDFSL1y_VMN1$MNumber <- seq(from = 1, to = SimulationLength_months)

    #This model will be called VMN1P because implies a one-off input of C
    ModelDFSL_VMN1P <- ModelDFSL1y_VMN1

    #Export the dataframe
    write_xlsx(ModelDFSL_VMN1P,"VXP_Models\\ModelDFSL_R_VMN1P.xlsx")

    #Plot 3: Interactive Yearly CO2 emissions #
    MY <- 12
    ModelDFSL_VMN1P_YCO2 <- ModelDFSL_VMN1P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VMN1)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMN1P_YCO2) <- c("Year", "Months", "AnnualCO2_VMN_1")

    #Plot 3: Interactive Yearly CO2 emissions considering a delay
    GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
    ModelDFSL_VMN1P_YCO2D <- merge(ModelDFSL_VMN1P_YCO2, GWP100delay, by = "Year")
    ModelDFSL_VMN1P_YCO2D$AnnualCO2D_VMN_1 <- ModelDFSL_VMN1P_YCO2D$AnnualCO2_VMN_1 * ModelDFSL_VMN1P_YCO2D$GWP100

    #Plot 4: Interactive Yearly C emissions #
    MY <- 12
    ModelDFSL_VMN1P_YC <- ModelDFSL_VMN1P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VMN1)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMN1P_YC) <- c("Year", "Months", "CEmissions_VMN_1")

    #Plot 5: Interactive Yearly C tails (remaining C in Soil) #
    MY <- 12
    ModelDFSL_VMN1P_YCT <- ModelDFSL_VMN1P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VMN1)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMN1P_YCT) <- c("Year", "Months", "CTail_VMN_1")

    #Save Dataframes for Plots 3.1, 3.2, 4 and 5
    write_xlsx(ModelDFSL_VMN1P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VMN1P.xlsx") #Yearly CO2 emissions (no delay)
    write_xlsx(ModelDFSL_VMN1P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VMN1P.xlsx") #Yearly CO2 emissions (delay)
    write_xlsx(ModelDFSL_VMN1P_YC,"CEmissions_P\\ModelDFSL_R_CE_VMN1P.xlsx") #Yearly C emissions
    write_xlsx(ModelDFSL_VMN1P_YCT,"CTails_P\\ModelDFSL_R_CT_VMN1P.xlsx") #Yearly C emissions



    #### 12.3 - VMN2) Manure; 20%clay; No Tillage ####
    #The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
    fT_VMN2=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
    fW_VMN2=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                            S.Thick = soil.thick, pClay = clay100*0.2,
                            pE = 1.0, bare = FALSE)$b #Moisture effects per month
    xi.frame_VMN2=data.frame(years,rep(fT_VMN2*fW_VMN2,length.out=length(years)))

    #To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
    Model_VMN2=SoilR::RothCModel(
      t=years, #Simulation Length
      ks=c(k.DPM = 10*NTRM, k.RPM = 0.3*NTRM, k.BIO = 0.66*NTRM, k.HUM = 0.02*NTRM, k.IOM = 0*NTRM), #Decomposition rates for the different pools
      C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
      In=Scalar_LitterCinputs*0, #Amount of litter inputs by time
      FYM = Scalar_ManureCinputs*1, #Amount of Farm Yard Manure by time
      clay=clay100*0.2, #Percent clay in mineral soil
      xi=xi.frame_VMN2) #Loads the model

    Ct_VMN2=getC(Model_VMN2) #Calculates stocks for each pool per month

    #The results can be plotted with the commands
    matplot(years, Ct_VMN2, type="l", lty=1, col=1:5,
            xlab="Time (years)", ylab="C stocks (Mg/ha)")
    legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
           lty=1, col=1:5, bty="n")

    VEC_Lit_VMN2 <- rep(M_Scalar_LitterCinputs*0, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
    VEC_Man_VMN2 <- rep(M_Scalar_ManureCinputs*1, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

    VEC_LitDF_VMN2 <- as.data.frame(VEC_Lit_VMN2) #Converting the Litter vector to a data frame
    VEC_LitDF_VMN2$MNumber <- seq(from = 1, to = SimulationLength_months)
    VEC_ManDF_VMN2 <- as.data.frame(VEC_Man_VMN2) #Converting the Manure vector to a data frame
    VEC_ManDF_VMN2$MNumber <- seq(from = 1, to = SimulationLength_months)

    sapply(VEC_LitDF_VMN2, class) #Check that class is numeric
    sapply(VEC_ManDF_VMN2, class) #Check that class is numeric
    LitterCinputs_VMN2=VEC_LitDF_VMN2   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    ManureCinputs_VMN2=VEC_ManDF_VMN2 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    MCinputs_VMN2 <- merge(LitterCinputs_VMN2, ManureCinputs_VMN2, by = "MNumber")
    MCinputs_VMN2$MInput_VMN2 <- MCinputs_VMN2$VEC_Lit_VMN2 + MCinputs_VMN2$VEC_Man_VMN2

    #Change names of litter and manure columns for more common ones
    colnames(MCinputs_VMN2)[which(names(MCinputs_VMN2) == "VEC_Lit_VMN2")] <- "LitterC_VMN2"
    colnames(MCinputs_VMN2)[which(names(MCinputs_VMN2) == "VEC_Man_VMN2")] <- "ManureC_VMN2"

    #Create a dataframe with the data considering the simulation length
    ModelDF_VMN2 <- as.data.frame(Ct_VMN2)
    colnames(ModelDF_VMN2) <- c('DPM_VMN2','RPM_VMN2','BIO_VMN2', 'HUM_VMN2', 'IOM_VMN2')
    ModelDFS_VMN2 <- ModelDF_VMN2[1:SimulationLength_months, ]

    #Create a column with the number of month of analysis
    ModelDFS_VMN2$MNumber <- seq(from = 1, to = SimulationLength_months)

    #Create a column that sums all pools
    ModelDFS_VMN2$AllPools_VMN2 <- ModelDFS_VMN2$DPM_VMN2 + ModelDFS_VMN2$RPM_VMN2 + ModelDFS_VMN2$BIO_VMN2 + ModelDFS_VMN2$HUM_VMN2 + ModelDFS_VMN2$IOM_VMN2

    #Create a column that sums all pools except IOM (static)
    ModelDFS_VMN2$AllPools_noIOM_VMN2 <- ModelDFS_VMN2$DPM_VMN2 + ModelDFS_VMN2$RPM_VMN2 + ModelDFS_VMN2$BIO_VMN2 + ModelDFS_VMN2$HUM_VMN2

    #Create a column that add the monthly input of C (manure and litter separately)
    ModelDFSL_VMN2 <- merge(ModelDFS_VMN2, MCinputs_VMN2, by = "MNumber")

    ModelDFSL_VMN2$MInput_VMN2 <- ModelDFSL_VMN2$LitterC_VMN2 + ModelDFSL_VMN2$ManureC_VMN2
    #ModelDF_SL$MInput[1] <- 0

    #Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
    ModelDFSL_VMN2$CTails_VMN2 <- ModelDFSL_VMN2$AllPools_noIOM_VMN2 + ModelDFSL_VMN2$MInput_VMN2

    #Create Monthly Accumulated input of C
    ModelDFSL_VMN2$AccumInput_VMN2 = ModelDFSL_VMN2$AccumInput_VMN2=cumsum(ModelDFSL_VMN2$MInput_VMN2)

    #Create Monthly Growths for each carbon pool
    ModelDFSL_VMN2$MGrowth_DPM_VMN2 <- ave(ModelDFSL_VMN2$DPM_VMN2, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMN2$MGrowth_RPM_VMN2 <- ave(ModelDFSL_VMN2$RPM_VMN2, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMN2$MGrowth_BIO_VMN2 <- ave(ModelDFSL_VMN2$BIO_VMN2, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMN2$MGrowth_HUM_VMN2 <- ave(ModelDFSL_VMN2$HUM_VMN2, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMN2$MGrowth_IOM_VMN2 <- ave(ModelDFSL_VMN2$IOM_VMN2, FUN = function(x) c(0, diff(x)))

    #Create column for Monthly and Accumulated C-CO2 emissions
    ModelDFSL_VMN2$M_CCO2_VMN2 <- ModelDFSL_VMN2$MInput_VMN2 - ModelDFSL_VMN2$MGrowth_DPM_VMN2 - ModelDFSL_VMN2$MGrowth_RPM_VMN2 - ModelDFSL_VMN2$MGrowth_BIO_VMN2 - ModelDFSL_VMN2$MGrowth_HUM_VMN2
    ModelDFSL_VMN2$Accum_CCO2_VMN2 <- ModelDFSL_VMN2$AccumInput_VMN2 - ModelDFSL_VMN2$AllPools_noIOM_VMN2

    #Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
    ModelDFSL_VMN2$M_CCO2_VMN2[1] <- 0
    ModelDFSL_VMN2$Accum_CCO2_VMN2[1] <- 0

    #Balance validation
    ModelDFSL_VMN2$Balance_VMN2 <- ModelDFSL_VMN2$AccumInput_VMN2 - ModelDFSL_VMN2$Accum_CCO2_VMN2 - (ModelDFSL_VMN2$DPM_VMN2 + ModelDFSL_VMN2$RPM_VMN2 + ModelDFSL_VMN2$BIO_VMN2 + ModelDFSL_VMN2$HUM_VMN2)

    #Convert C-CO2 emissions into CO2 emissions
    ModelDFSL_VMN2$M_CO2_VMN2 <- ModelDFSL_VMN2$M_CCO2_VMN2 * 44/12
    ModelDFSL_VMN2$Accum_CO2_VMN2 <- ModelDFSL_VMN2$Accum_CCO2_VMN2 * 44/12

    #This model will be called VMN2C because implies a continuous input of C
    ModelDFSL_VMN2C <- ModelDFSL_VMN2

    #Export the dataframe
    write_xlsx(ModelDFSL_VMN2C,"VXC_Models\\ModelDFSL_R_VMN2C.xlsx")

    #Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
    #Create two equal models by using the above general script
    #Create model t=x
    ModelDFSLt0_VMN2 <- ModelDFSL_VMN2 #Create model t=x

    #Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
    ModelDFSLt1_VMN2.1 <- rbind(c(0:0), ModelDFSLt0_VMN2)
    ModelDFSLt1_VMN2.2 <- rbind(c(0:0), ModelDFSLt1_VMN2.1)
    ModelDFSLt1_VMN2.3 <- rbind(c(0:0), ModelDFSLt1_VMN2.2)
    ModelDFSLt1_VMN2.4 <- rbind(c(0:0), ModelDFSLt1_VMN2.3)
    ModelDFSLt1_VMN2.5 <- rbind(c(0:0), ModelDFSLt1_VMN2.4)
    ModelDFSLt1_VMN2.6 <- rbind(c(0:0), ModelDFSLt1_VMN2.5)
    ModelDFSLt1_VMN2.7 <- rbind(c(0:0), ModelDFSLt1_VMN2.6)
    ModelDFSLt1_VMN2.8 <- rbind(c(0:0), ModelDFSLt1_VMN2.7)
    ModelDFSLt1_VMN2.9 <- rbind(c(0:0), ModelDFSLt1_VMN2.8)
    ModelDFSLt1_VMN2.10 <- rbind(c(0:0), ModelDFSLt1_VMN2.9)
    ModelDFSLt1_VMN2.11 <- rbind(c(0:0), ModelDFSLt1_VMN2.10)
    ModelDFSLt1_VMN2.12 <- rbind(c(0:0), ModelDFSLt1_VMN2.11)
    ModelDFSLt1_VMN2.13 <- ModelDFSLt1_VMN2.12[-nrow(ModelDFSLt1_VMN2.12),]
    ModelDFSLt1_VMN2.14 <- ModelDFSLt1_VMN2.13[-nrow(ModelDFSLt1_VMN2.13),]
    ModelDFSLt1_VMN2.15 <- ModelDFSLt1_VMN2.14[-nrow(ModelDFSLt1_VMN2.14),]
    ModelDFSLt1_VMN2.16 <- ModelDFSLt1_VMN2.15[-nrow(ModelDFSLt1_VMN2.15),]
    ModelDFSLt1_VMN2.17 <- ModelDFSLt1_VMN2.16[-nrow(ModelDFSLt1_VMN2.16),]
    ModelDFSLt1_VMN2.18 <- ModelDFSLt1_VMN2.17[-nrow(ModelDFSLt1_VMN2.17),]
    ModelDFSLt1_VMN2.19 <- ModelDFSLt1_VMN2.18[-nrow(ModelDFSLt1_VMN2.18),]
    ModelDFSLt1_VMN2.20 <- ModelDFSLt1_VMN2.19[-nrow(ModelDFSLt1_VMN2.19),]
    ModelDFSLt1_VMN2.21 <- ModelDFSLt1_VMN2.20[-nrow(ModelDFSLt1_VMN2.20),]
    ModelDFSLt1_VMN2.22 <- ModelDFSLt1_VMN2.21[-nrow(ModelDFSLt1_VMN2.21),]
    ModelDFSLt1_VMN2.23 <- ModelDFSLt1_VMN2.22[-nrow(ModelDFSLt1_VMN2.22),]
    ModelDFSLt1_VMN2.24 <- ModelDFSLt1_VMN2.23[-nrow(ModelDFSLt1_VMN2.23),]

    ModelDFSLt1_VMN2 <- ModelDFSLt1_VMN2.24 #Create model t=x+1

    #Subtract model (t=x) - (t=x+1)
    ModelDFSL1y_VMN2 <- ModelDFSLt0_VMN2 - ModelDFSLt1_VMN2

    #Re-do Month Number column because the substraction was also applied to it
    ModelDFSL1y_VMN2$MNumber <- seq(from = 1, to = SimulationLength_months)

    #This model will be called VMN2P because implies a one-off input of C
    ModelDFSL_VMN2P <- ModelDFSL1y_VMN2

    #Export the dataframe
    write_xlsx(ModelDFSL_VMN2P,"VXP_Models\\ModelDFSL_R_VMN2P.xlsx")

    #Plot 3: Interactive Yearly CO2 emissions #
    MY <- 12
    ModelDFSL_VMN2P_YCO2 <- ModelDFSL_VMN2P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VMN2)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMN2P_YCO2) <- c("Year", "Months", "AnnualCO2_VMN_2")

    #Plot 3: Interactive Yearly CO2 emissions considering a delay
    GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
    ModelDFSL_VMN2P_YCO2D <- merge(ModelDFSL_VMN2P_YCO2, GWP100delay, by = "Year")
    ModelDFSL_VMN2P_YCO2D$AnnualCO2D_VMN_2 <- ModelDFSL_VMN2P_YCO2D$AnnualCO2_VMN_2 * ModelDFSL_VMN2P_YCO2D$GWP100

    #Plot 4: Interactive Yearly C emissions #
    MY <- 12
    ModelDFSL_VMN2P_YC <- ModelDFSL_VMN2P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VMN2)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMN2P_YC) <- c("Year", "Months", "CEmissions_VMN_2")

    #Plot 5: Interactive Yearly C tails (remaining C in Soil) #
    MY <- 12
    ModelDFSL_VMN2P_YCT <- ModelDFSL_VMN2P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VMN2)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMN2P_YCT) <- c("Year", "Months", "CTail_VMN_2")

    #Save Dataframes for Plots 3.1, 3.2, 4 and 5
    write_xlsx(ModelDFSL_VMN2P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VMN2P.xlsx") #Yearly CO2 emissions (no delay)
    write_xlsx(ModelDFSL_VMN2P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VMN2P.xlsx") #Yearly CO2 emissions (delay)
    write_xlsx(ModelDFSL_VMN2P_YC,"CEmissions_P\\ModelDFSL_R_CE_VMN2P.xlsx") #Yearly C emissions
    write_xlsx(ModelDFSL_VMN2P_YCT,"CTails_P\\ModelDFSL_R_CT_VMN2P.xlsx") #Yearly C emissions



    #### 12.4 - VMN3) Manure; 30%clay; No Tillage ####
    #The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
    fT_VMN3=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
    fW_VMN3=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                            S.Thick = soil.thick, pClay = clay100*0.3,
                            pE = 1.0, bare = FALSE)$b #Moisture effects per month
    xi.frame_VMN3=data.frame(years,rep(fT_VMN3*fW_VMN3,length.out=length(years)))

    #To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
    Model_VMN3=SoilR::RothCModel(
      t=years, #Simulation Length
      ks=c(k.DPM = 10*NTRM, k.RPM = 0.3*NTRM, k.BIO = 0.66*NTRM, k.HUM = 0.02*NTRM, k.IOM = 0*NTRM), #Decomposition rates for the different pools
      C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
      In=Scalar_LitterCinputs*0, #Amount of litter inputs by time
      FYM = Scalar_ManureCinputs*1, #Amount of Farm Yard Manure by time
      clay=clay100*0.3, #Percent clay in mineral soil
      xi=xi.frame_VMN3) #Loads the model

    Ct_VMN3=getC(Model_VMN3) #Calculates stocks for each pool per month

    #The results can be plotted with the commands
    matplot(years, Ct_VMN3, type="l", lty=1, col=1:5,
            xlab="Time (years)", ylab="C stocks (Mg/ha)")
    legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
           lty=1, col=1:5, bty="n")

    VEC_Lit_VMN3 <- rep(M_Scalar_LitterCinputs*0, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
    VEC_Man_VMN3 <- rep(M_Scalar_ManureCinputs*1, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

    VEC_LitDF_VMN3 <- as.data.frame(VEC_Lit_VMN3) #Converting the Litter vector to a data frame
    VEC_LitDF_VMN3$MNumber <- seq(from = 1, to = SimulationLength_months)
    VEC_ManDF_VMN3 <- as.data.frame(VEC_Man_VMN3) #Converting the Manure vector to a data frame
    VEC_ManDF_VMN3$MNumber <- seq(from = 1, to = SimulationLength_months)

    sapply(VEC_LitDF_VMN3, class) #Check that class is numeric
    sapply(VEC_ManDF_VMN3, class) #Check that class is numeric
    LitterCinputs_VMN3=VEC_LitDF_VMN3   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    ManureCinputs_VMN3=VEC_ManDF_VMN3 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    MCinputs_VMN3 <- merge(LitterCinputs_VMN3, ManureCinputs_VMN3, by = "MNumber")
    MCinputs_VMN3$MInput_VMN3 <- MCinputs_VMN3$VEC_Lit_VMN3 + MCinputs_VMN3$VEC_Man_VMN3

    #Change names of litter and manure columns for more common ones
    colnames(MCinputs_VMN3)[which(names(MCinputs_VMN3) == "VEC_Lit_VMN3")] <- "LitterC_VMN3"
    colnames(MCinputs_VMN3)[which(names(MCinputs_VMN3) == "VEC_Man_VMN3")] <- "ManureC_VMN3"

    #Create a dataframe with the data considering the simulation length
    ModelDF_VMN3 <- as.data.frame(Ct_VMN3)
    colnames(ModelDF_VMN3) <- c('DPM_VMN3','RPM_VMN3','BIO_VMN3', 'HUM_VMN3', 'IOM_VMN3')
    ModelDFS_VMN3 <- ModelDF_VMN3[1:SimulationLength_months, ]

    #Create a column with the number of month of analysis
    ModelDFS_VMN3$MNumber <- seq(from = 1, to = SimulationLength_months)

    #Create a column that sums all pools
    ModelDFS_VMN3$AllPools_VMN3 <- ModelDFS_VMN3$DPM_VMN3 + ModelDFS_VMN3$RPM_VMN3 + ModelDFS_VMN3$BIO_VMN3 + ModelDFS_VMN3$HUM_VMN3 + ModelDFS_VMN3$IOM_VMN3

    #Create a column that sums all pools except IOM (static)
    ModelDFS_VMN3$AllPools_noIOM_VMN3 <- ModelDFS_VMN3$DPM_VMN3 + ModelDFS_VMN3$RPM_VMN3 + ModelDFS_VMN3$BIO_VMN3 + ModelDFS_VMN3$HUM_VMN3

    #Create a column that add the monthly input of C (manure and litter separately)
    ModelDFSL_VMN3 <- merge(ModelDFS_VMN3, MCinputs_VMN3, by = "MNumber")

    ModelDFSL_VMN3$MInput_VMN3 <- ModelDFSL_VMN3$LitterC_VMN3 + ModelDFSL_VMN3$ManureC_VMN3
    #ModelDF_SL$MInput[1] <- 0

    #Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
    ModelDFSL_VMN3$CTails_VMN3 <- ModelDFSL_VMN3$AllPools_noIOM_VMN3 + ModelDFSL_VMN3$MInput_VMN3

    #Create Monthly Accumulated input of C
    ModelDFSL_VMN3$AccumInput_VMN3 = ModelDFSL_VMN3$AccumInput_VMN3=cumsum(ModelDFSL_VMN3$MInput_VMN3)

    #Create Monthly Growths for each carbon pool
    ModelDFSL_VMN3$MGrowth_DPM_VMN3 <- ave(ModelDFSL_VMN3$DPM_VMN3, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMN3$MGrowth_RPM_VMN3 <- ave(ModelDFSL_VMN3$RPM_VMN3, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMN3$MGrowth_BIO_VMN3 <- ave(ModelDFSL_VMN3$BIO_VMN3, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMN3$MGrowth_HUM_VMN3 <- ave(ModelDFSL_VMN3$HUM_VMN3, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMN3$MGrowth_IOM_VMN3 <- ave(ModelDFSL_VMN3$IOM_VMN3, FUN = function(x) c(0, diff(x)))

    #Create column for Monthly and Accumulated C-CO2 emissions
    ModelDFSL_VMN3$M_CCO2_VMN3 <- ModelDFSL_VMN3$MInput_VMN3 - ModelDFSL_VMN3$MGrowth_DPM_VMN3 - ModelDFSL_VMN3$MGrowth_RPM_VMN3 - ModelDFSL_VMN3$MGrowth_BIO_VMN3 - ModelDFSL_VMN3$MGrowth_HUM_VMN3
    ModelDFSL_VMN3$Accum_CCO2_VMN3 <- ModelDFSL_VMN3$AccumInput_VMN3 - ModelDFSL_VMN3$AllPools_noIOM_VMN3

    #Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
    ModelDFSL_VMN3$M_CCO2_VMN3[1] <- 0
    ModelDFSL_VMN3$Accum_CCO2_VMN3[1] <- 0

    #Balance validation
    ModelDFSL_VMN3$Balance_VMN3 <- ModelDFSL_VMN3$AccumInput_VMN3 - ModelDFSL_VMN3$Accum_CCO2_VMN3 - (ModelDFSL_VMN3$DPM_VMN3 + ModelDFSL_VMN3$RPM_VMN3 + ModelDFSL_VMN3$BIO_VMN3 + ModelDFSL_VMN3$HUM_VMN3)

    #Convert C-CO2 emissions into CO2 emissions
    ModelDFSL_VMN3$M_CO2_VMN3 <- ModelDFSL_VMN3$M_CCO2_VMN3 * 44/12
    ModelDFSL_VMN3$Accum_CO2_VMN3 <- ModelDFSL_VMN3$Accum_CCO2_VMN3 * 44/12

    #This model will be called VMN3C because implies a continuous input of C
    ModelDFSL_VMN3C <- ModelDFSL_VMN3

    #Export the dataframe
    write_xlsx(ModelDFSL_VMN3C,"VXC_Models\\ModelDFSL_R_VMN3C.xlsx")

    #Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
    #Create two equal models by using the above general script
    #Create model t=x
    ModelDFSLt0_VMN3 <- ModelDFSL_VMN3 #Create model t=x

    #Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
    ModelDFSLt1_VMN3.1 <- rbind(c(0:0), ModelDFSLt0_VMN3)
    ModelDFSLt1_VMN3.2 <- rbind(c(0:0), ModelDFSLt1_VMN3.1)
    ModelDFSLt1_VMN3.3 <- rbind(c(0:0), ModelDFSLt1_VMN3.2)
    ModelDFSLt1_VMN3.4 <- rbind(c(0:0), ModelDFSLt1_VMN3.3)
    ModelDFSLt1_VMN3.5 <- rbind(c(0:0), ModelDFSLt1_VMN3.4)
    ModelDFSLt1_VMN3.6 <- rbind(c(0:0), ModelDFSLt1_VMN3.5)
    ModelDFSLt1_VMN3.7 <- rbind(c(0:0), ModelDFSLt1_VMN3.6)
    ModelDFSLt1_VMN3.8 <- rbind(c(0:0), ModelDFSLt1_VMN3.7)
    ModelDFSLt1_VMN3.9 <- rbind(c(0:0), ModelDFSLt1_VMN3.8)
    ModelDFSLt1_VMN3.10 <- rbind(c(0:0), ModelDFSLt1_VMN3.9)
    ModelDFSLt1_VMN3.11 <- rbind(c(0:0), ModelDFSLt1_VMN3.10)
    ModelDFSLt1_VMN3.12 <- rbind(c(0:0), ModelDFSLt1_VMN3.11)
    ModelDFSLt1_VMN3.13 <- ModelDFSLt1_VMN3.12[-nrow(ModelDFSLt1_VMN3.12),]
    ModelDFSLt1_VMN3.14 <- ModelDFSLt1_VMN3.13[-nrow(ModelDFSLt1_VMN3.13),]
    ModelDFSLt1_VMN3.15 <- ModelDFSLt1_VMN3.14[-nrow(ModelDFSLt1_VMN3.14),]
    ModelDFSLt1_VMN3.16 <- ModelDFSLt1_VMN3.15[-nrow(ModelDFSLt1_VMN3.15),]
    ModelDFSLt1_VMN3.17 <- ModelDFSLt1_VMN3.16[-nrow(ModelDFSLt1_VMN3.16),]
    ModelDFSLt1_VMN3.18 <- ModelDFSLt1_VMN3.17[-nrow(ModelDFSLt1_VMN3.17),]
    ModelDFSLt1_VMN3.19 <- ModelDFSLt1_VMN3.18[-nrow(ModelDFSLt1_VMN3.18),]
    ModelDFSLt1_VMN3.20 <- ModelDFSLt1_VMN3.19[-nrow(ModelDFSLt1_VMN3.19),]
    ModelDFSLt1_VMN3.21 <- ModelDFSLt1_VMN3.20[-nrow(ModelDFSLt1_VMN3.20),]
    ModelDFSLt1_VMN3.22 <- ModelDFSLt1_VMN3.21[-nrow(ModelDFSLt1_VMN3.21),]
    ModelDFSLt1_VMN3.23 <- ModelDFSLt1_VMN3.22[-nrow(ModelDFSLt1_VMN3.22),]
    ModelDFSLt1_VMN3.24 <- ModelDFSLt1_VMN3.23[-nrow(ModelDFSLt1_VMN3.23),]

    ModelDFSLt1_VMN3 <- ModelDFSLt1_VMN3.24 #Create model t=x+1

    #Subtract model (t=x) - (t=x+1)
    ModelDFSL1y_VMN3 <- ModelDFSLt0_VMN3 - ModelDFSLt1_VMN3

    #Re-do Month Number column because the substraction was also applied to it
    ModelDFSL1y_VMN3$MNumber <- seq(from = 1, to = SimulationLength_months)

    #This model will be called VMN3P because implies a one-off input of C
    ModelDFSL_VMN3P <- ModelDFSL1y_VMN3

    #Export the dataframe
    write_xlsx(ModelDFSL_VMN3P,"VXP_Models\\ModelDFSL_R_VMN3P.xlsx")

    #Plot 3: Interactive Yearly CO2 emissions #
    MY <- 12
    ModelDFSL_VMN3P_YCO2 <- ModelDFSL_VMN3P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VMN3)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMN3P_YCO2) <- c("Year", "Months", "AnnualCO2_VMN_3")

    #Plot 3: Interactive Yearly CO2 emissions considering a delay
    GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
    ModelDFSL_VMN3P_YCO2D <- merge(ModelDFSL_VMN3P_YCO2, GWP100delay, by = "Year")
    ModelDFSL_VMN3P_YCO2D$AnnualCO2D_VMN_3 <- ModelDFSL_VMN3P_YCO2D$AnnualCO2_VMN_3 * ModelDFSL_VMN3P_YCO2D$GWP100

    #Plot 4: Interactive Yearly C emissions #
    MY <- 12
    ModelDFSL_VMN3P_YC <- ModelDFSL_VMN3P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VMN3)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMN3P_YC) <- c("Year", "Months", "CEmissions_VMN_3")

    #Plot 5: Interactive Yearly C tails (remaining C in Soil) #
    MY <- 12
    ModelDFSL_VMN3P_YCT <- ModelDFSL_VMN3P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VMN3)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMN3P_YCT) <- c("Year", "Months", "CTail_VMN_3")

    #Save Dataframes for Plots 3.1, 3.2, 4 and 5
    write_xlsx(ModelDFSL_VMN3P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VMN3P.xlsx") #Yearly CO2 emissions (no delay)
    write_xlsx(ModelDFSL_VMN3P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VMN3P.xlsx") #Yearly CO2 emissions (delay)
    write_xlsx(ModelDFSL_VMN3P_YC,"CEmissions_P\\ModelDFSL_R_CE_VMN3P.xlsx") #Yearly C emissions
    write_xlsx(ModelDFSL_VMN3P_YCT,"CTails_P\\ModelDFSL_R_CT_VMN3P.xlsx") #Yearly C emissions



    #### 12.5 - VMN4) Manure; 40%clay; No Tillage ####
    #The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
    fT_VMN4=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
    fW_VMN4=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                            S.Thick = soil.thick, pClay = clay100*0.4,
                            pE = 1.0, bare = FALSE)$b #Moisture effects per month
    xi.frame_VMN4=data.frame(years,rep(fT_VMN4*fW_VMN4,length.out=length(years)))

    #To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
    Model_VMN4=SoilR::RothCModel(
      t=years, #Simulation Length
      ks=c(k.DPM = 10*NTRM, k.RPM = 0.3*NTRM, k.BIO = 0.66*NTRM, k.HUM = 0.02*NTRM, k.IOM = 0*NTRM), #Decomposition rates for the different pools
      C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
      In=Scalar_LitterCinputs*0, #Amount of litter inputs by time
      FYM = Scalar_ManureCinputs*1, #Amount of Farm Yard Manure by time
      clay=clay100*0.4, #Percent clay in mineral soil
      xi=xi.frame_VMN4) #Loads the model

    Ct_VMN4=getC(Model_VMN4) #Calculates stocks for each pool per month

    #The results can be plotted with the commands
    matplot(years, Ct_VMN4, type="l", lty=1, col=1:5,
            xlab="Time (years)", ylab="C stocks (Mg/ha)")
    legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
           lty=1, col=1:5, bty="n")

    VEC_Lit_VMN4 <- rep(M_Scalar_LitterCinputs*0, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
    VEC_Man_VMN4 <- rep(M_Scalar_ManureCinputs*1, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

    VEC_LitDF_VMN4 <- as.data.frame(VEC_Lit_VMN4) #Converting the Litter vector to a data frame
    VEC_LitDF_VMN4$MNumber <- seq(from = 1, to = SimulationLength_months)
    VEC_ManDF_VMN4 <- as.data.frame(VEC_Man_VMN4) #Converting the Manure vector to a data frame
    VEC_ManDF_VMN4$MNumber <- seq(from = 1, to = SimulationLength_months)

    sapply(VEC_LitDF_VMN4, class) #Check that class is numeric
    sapply(VEC_ManDF_VMN4, class) #Check that class is numeric
    LitterCinputs_VMN4=VEC_LitDF_VMN4   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    ManureCinputs_VMN4=VEC_ManDF_VMN4 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    MCinputs_VMN4 <- merge(LitterCinputs_VMN4, ManureCinputs_VMN4, by = "MNumber")
    MCinputs_VMN4$MInput_VMN4 <- MCinputs_VMN4$VEC_Lit_VMN4 + MCinputs_VMN4$VEC_Man_VMN4

    #Change names of litter and manure columns for more common ones
    colnames(MCinputs_VMN4)[which(names(MCinputs_VMN4) == "VEC_Lit_VMN4")] <- "LitterC_VMN4"
    colnames(MCinputs_VMN4)[which(names(MCinputs_VMN4) == "VEC_Man_VMN4")] <- "ManureC_VMN4"

    #Create a dataframe with the data considering the simulation length
    ModelDF_VMN4 <- as.data.frame(Ct_VMN4)
    colnames(ModelDF_VMN4) <- c('DPM_VMN4','RPM_VMN4','BIO_VMN4', 'HUM_VMN4', 'IOM_VMN4')
    ModelDFS_VMN4 <- ModelDF_VMN4[1:SimulationLength_months, ]

    #Create a column with the number of month of analysis
    ModelDFS_VMN4$MNumber <- seq(from = 1, to = SimulationLength_months)

    #Create a column that sums all pools
    ModelDFS_VMN4$AllPools_VMN4 <- ModelDFS_VMN4$DPM_VMN4 + ModelDFS_VMN4$RPM_VMN4 + ModelDFS_VMN4$BIO_VMN4 + ModelDFS_VMN4$HUM_VMN4 + ModelDFS_VMN4$IOM_VMN4

    #Create a column that sums all pools except IOM (static)
    ModelDFS_VMN4$AllPools_noIOM_VMN4 <- ModelDFS_VMN4$DPM_VMN4 + ModelDFS_VMN4$RPM_VMN4 + ModelDFS_VMN4$BIO_VMN4 + ModelDFS_VMN4$HUM_VMN4

    #Create a column that add the monthly input of C (manure and litter separately)
    ModelDFSL_VMN4 <- merge(ModelDFS_VMN4, MCinputs_VMN4, by = "MNumber")

    ModelDFSL_VMN4$MInput_VMN4 <- ModelDFSL_VMN4$LitterC_VMN4 + ModelDFSL_VMN4$ManureC_VMN4
    #ModelDF_SL$MInput[1] <- 0

    #Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
    ModelDFSL_VMN4$CTails_VMN4 <- ModelDFSL_VMN4$AllPools_noIOM_VMN4 + ModelDFSL_VMN4$MInput_VMN4

    #Create Monthly Accumulated input of C
    ModelDFSL_VMN4$AccumInput_VMN4 = ModelDFSL_VMN4$AccumInput_VMN4=cumsum(ModelDFSL_VMN4$MInput_VMN4)

    #Create Monthly Growths for each carbon pool
    ModelDFSL_VMN4$MGrowth_DPM_VMN4 <- ave(ModelDFSL_VMN4$DPM_VMN4, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMN4$MGrowth_RPM_VMN4 <- ave(ModelDFSL_VMN4$RPM_VMN4, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMN4$MGrowth_BIO_VMN4 <- ave(ModelDFSL_VMN4$BIO_VMN4, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMN4$MGrowth_HUM_VMN4 <- ave(ModelDFSL_VMN4$HUM_VMN4, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMN4$MGrowth_IOM_VMN4 <- ave(ModelDFSL_VMN4$IOM_VMN4, FUN = function(x) c(0, diff(x)))

    #Create column for Monthly and Accumulated C-CO2 emissions
    ModelDFSL_VMN4$M_CCO2_VMN4 <- ModelDFSL_VMN4$MInput_VMN4 - ModelDFSL_VMN4$MGrowth_DPM_VMN4 - ModelDFSL_VMN4$MGrowth_RPM_VMN4 - ModelDFSL_VMN4$MGrowth_BIO_VMN4 - ModelDFSL_VMN4$MGrowth_HUM_VMN4
    ModelDFSL_VMN4$Accum_CCO2_VMN4 <- ModelDFSL_VMN4$AccumInput_VMN4 - ModelDFSL_VMN4$AllPools_noIOM_VMN4

    #Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
    ModelDFSL_VMN4$M_CCO2_VMN4[1] <- 0
    ModelDFSL_VMN4$Accum_CCO2_VMN4[1] <- 0

    #Balance validation
    ModelDFSL_VMN4$Balance_VMN4 <- ModelDFSL_VMN4$AccumInput_VMN4 - ModelDFSL_VMN4$Accum_CCO2_VMN4 - (ModelDFSL_VMN4$DPM_VMN4 + ModelDFSL_VMN4$RPM_VMN4 + ModelDFSL_VMN4$BIO_VMN4 + ModelDFSL_VMN4$HUM_VMN4)

    #Convert C-CO2 emissions into CO2 emissions
    ModelDFSL_VMN4$M_CO2_VMN4 <- ModelDFSL_VMN4$M_CCO2_VMN4 * 44/12
    ModelDFSL_VMN4$Accum_CO2_VMN4 <- ModelDFSL_VMN4$Accum_CCO2_VMN4 * 44/12

    #This model will be called VMN4C because implies a continuous input of C
    ModelDFSL_VMN4C <- ModelDFSL_VMN4

    #Export the dataframe
    write_xlsx(ModelDFSL_VMN4C,"VXC_Models\\ModelDFSL_R_VMN4C.xlsx")

    #Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
    #Create two equal models by using the above general script
    #Create model t=x
    ModelDFSLt0_VMN4 <- ModelDFSL_VMN4 #Create model t=x

    #Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
    ModelDFSLt1_VMN4.1 <- rbind(c(0:0), ModelDFSLt0_VMN4)
    ModelDFSLt1_VMN4.2 <- rbind(c(0:0), ModelDFSLt1_VMN4.1)
    ModelDFSLt1_VMN4.3 <- rbind(c(0:0), ModelDFSLt1_VMN4.2)
    ModelDFSLt1_VMN4.4 <- rbind(c(0:0), ModelDFSLt1_VMN4.3)
    ModelDFSLt1_VMN4.5 <- rbind(c(0:0), ModelDFSLt1_VMN4.4)
    ModelDFSLt1_VMN4.6 <- rbind(c(0:0), ModelDFSLt1_VMN4.5)
    ModelDFSLt1_VMN4.7 <- rbind(c(0:0), ModelDFSLt1_VMN4.6)
    ModelDFSLt1_VMN4.8 <- rbind(c(0:0), ModelDFSLt1_VMN4.7)
    ModelDFSLt1_VMN4.9 <- rbind(c(0:0), ModelDFSLt1_VMN4.8)
    ModelDFSLt1_VMN4.10 <- rbind(c(0:0), ModelDFSLt1_VMN4.9)
    ModelDFSLt1_VMN4.11 <- rbind(c(0:0), ModelDFSLt1_VMN4.10)
    ModelDFSLt1_VMN4.12 <- rbind(c(0:0), ModelDFSLt1_VMN4.11)
    ModelDFSLt1_VMN4.13 <- ModelDFSLt1_VMN4.12[-nrow(ModelDFSLt1_VMN4.12),]
    ModelDFSLt1_VMN4.14 <- ModelDFSLt1_VMN4.13[-nrow(ModelDFSLt1_VMN4.13),]
    ModelDFSLt1_VMN4.15 <- ModelDFSLt1_VMN4.14[-nrow(ModelDFSLt1_VMN4.14),]
    ModelDFSLt1_VMN4.16 <- ModelDFSLt1_VMN4.15[-nrow(ModelDFSLt1_VMN4.15),]
    ModelDFSLt1_VMN4.17 <- ModelDFSLt1_VMN4.16[-nrow(ModelDFSLt1_VMN4.16),]
    ModelDFSLt1_VMN4.18 <- ModelDFSLt1_VMN4.17[-nrow(ModelDFSLt1_VMN4.17),]
    ModelDFSLt1_VMN4.19 <- ModelDFSLt1_VMN4.18[-nrow(ModelDFSLt1_VMN4.18),]
    ModelDFSLt1_VMN4.20 <- ModelDFSLt1_VMN4.19[-nrow(ModelDFSLt1_VMN4.19),]
    ModelDFSLt1_VMN4.21 <- ModelDFSLt1_VMN4.20[-nrow(ModelDFSLt1_VMN4.20),]
    ModelDFSLt1_VMN4.22 <- ModelDFSLt1_VMN4.21[-nrow(ModelDFSLt1_VMN4.21),]
    ModelDFSLt1_VMN4.23 <- ModelDFSLt1_VMN4.22[-nrow(ModelDFSLt1_VMN4.22),]
    ModelDFSLt1_VMN4.24 <- ModelDFSLt1_VMN4.23[-nrow(ModelDFSLt1_VMN4.23),]

    ModelDFSLt1_VMN4 <- ModelDFSLt1_VMN4.24 #Create model t=x+1

    #Subtract model (t=x) - (t=x+1)
    ModelDFSL1y_VMN4 <- ModelDFSLt0_VMN4 - ModelDFSLt1_VMN4

    #Re-do Month Number column because the substraction was also applied to it
    ModelDFSL1y_VMN4$MNumber <- seq(from = 1, to = SimulationLength_months)

    #This model will be called VMN4P because implies a one-off input of C
    ModelDFSL_VMN4P <- ModelDFSL1y_VMN4

    #Export the dataframe
    write_xlsx(ModelDFSL_VMN4P,"VXP_Models\\ModelDFSL_R_VMN4P.xlsx")

    #Plot 3: Interactive Yearly CO2 emissions #
    MY <- 12
    ModelDFSL_VMN4P_YCO2 <- ModelDFSL_VMN4P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VMN4)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMN4P_YCO2) <- c("Year", "Months", "AnnualCO2_VMN_4")

    #Plot 3: Interactive Yearly CO2 emissions considering a delay
    GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
    ModelDFSL_VMN4P_YCO2D <- merge(ModelDFSL_VMN4P_YCO2, GWP100delay, by = "Year")
    ModelDFSL_VMN4P_YCO2D$AnnualCO2D_VMN_4 <- ModelDFSL_VMN4P_YCO2D$AnnualCO2_VMN_4 * ModelDFSL_VMN4P_YCO2D$GWP100

    #Plot 4: Interactive Yearly C emissions #
    MY <- 12
    ModelDFSL_VMN4P_YC <- ModelDFSL_VMN4P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VMN4)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMN4P_YC) <- c("Year", "Months", "CEmissions_VMN_4")

    #Plot 5: Interactive Yearly C tails (remaining C in Soil) #
    MY <- 12
    ModelDFSL_VMN4P_YCT <- ModelDFSL_VMN4P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VMN4)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMN4P_YCT) <- c("Year", "Months", "CTail_VMN_4")

    #Save Dataframes for Plots 3.1, 3.2, 4 and 5
    write_xlsx(ModelDFSL_VMN4P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VMN4P.xlsx") #Yearly CO2 emissions (no delay)
    write_xlsx(ModelDFSL_VMN4P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VMN4P.xlsx") #Yearly CO2 emissions (delay)
    write_xlsx(ModelDFSL_VMN4P_YC,"CEmissions_P\\ModelDFSL_R_CE_VMN4P.xlsx") #Yearly C emissions
    write_xlsx(ModelDFSL_VMN4P_YCT,"CTails_P\\ModelDFSL_R_CT_VMN4P.xlsx") #Yearly C emissions



    #### 12.6 - VMN5) Manure; 50%clay; No Tillage ####
    #The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
    fT_VMN5=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
    fW_VMN5=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                            S.Thick = soil.thick, pClay = clay100*0.5,
                            pE = 1.0, bare = FALSE)$b #Moisture effects per month
    xi.frame_VMN5=data.frame(years,rep(fT_VMN5*fW_VMN5,length.out=length(years)))

    #To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
    Model_VMN5=SoilR::RothCModel(
      t=years, #Simulation Length
      ks=c(k.DPM = 10*NTRM, k.RPM = 0.3*NTRM, k.BIO = 0.66*NTRM, k.HUM = 0.02*NTRM, k.IOM = 0*NTRM), #Decomposition rates for the different pools
      C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
      In=Scalar_LitterCinputs*0, #Amount of litter inputs by time
      FYM = Scalar_ManureCinputs*1, #Amount of Farm Yard Manure by time
      clay=clay100*0.5, #Percent clay in mineral soil
      xi=xi.frame_VMN5) #Loads the model

    Ct_VMN5=getC(Model_VMN5) #Calculates stocks for each pool per month

    #The results can be plotted with the commands
    matplot(years, Ct_VMN5, type="l", lty=1, col=1:5,
            xlab="Time (years)", ylab="C stocks (Mg/ha)")
    legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
           lty=1, col=1:5, bty="n")

    VEC_Lit_VMN5 <- rep(M_Scalar_LitterCinputs*0, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
    VEC_Man_VMN5 <- rep(M_Scalar_ManureCinputs*1, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

    VEC_LitDF_VMN5 <- as.data.frame(VEC_Lit_VMN5) #Converting the Litter vector to a data frame
    VEC_LitDF_VMN5$MNumber <- seq(from = 1, to = SimulationLength_months)
    VEC_ManDF_VMN5 <- as.data.frame(VEC_Man_VMN5) #Converting the Manure vector to a data frame
    VEC_ManDF_VMN5$MNumber <- seq(from = 1, to = SimulationLength_months)

    sapply(VEC_LitDF_VMN5, class) #Check that class is numeric
    sapply(VEC_ManDF_VMN5, class) #Check that class is numeric
    LitterCinputs_VMN5=VEC_LitDF_VMN5   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    ManureCinputs_VMN5=VEC_ManDF_VMN5 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    MCinputs_VMN5 <- merge(LitterCinputs_VMN5, ManureCinputs_VMN5, by = "MNumber")
    MCinputs_VMN5$MInput_VMN5 <- MCinputs_VMN5$VEC_Lit_VMN5 + MCinputs_VMN5$VEC_Man_VMN5

    #Change names of litter and manure columns for more common ones
    colnames(MCinputs_VMN5)[which(names(MCinputs_VMN5) == "VEC_Lit_VMN5")] <- "LitterC_VMN5"
    colnames(MCinputs_VMN5)[which(names(MCinputs_VMN5) == "VEC_Man_VMN5")] <- "ManureC_VMN5"

    #Create a dataframe with the data considering the simulation length
    ModelDF_VMN5 <- as.data.frame(Ct_VMN5)
    colnames(ModelDF_VMN5) <- c('DPM_VMN5','RPM_VMN5','BIO_VMN5', 'HUM_VMN5', 'IOM_VMN5')
    ModelDFS_VMN5 <- ModelDF_VMN5[1:SimulationLength_months, ]

    #Create a column with the number of month of analysis
    ModelDFS_VMN5$MNumber <- seq(from = 1, to = SimulationLength_months)

    #Create a column that sums all pools
    ModelDFS_VMN5$AllPools_VMN5 <- ModelDFS_VMN5$DPM_VMN5 + ModelDFS_VMN5$RPM_VMN5 + ModelDFS_VMN5$BIO_VMN5 + ModelDFS_VMN5$HUM_VMN5 + ModelDFS_VMN5$IOM_VMN5

    #Create a column that sums all pools except IOM (static)
    ModelDFS_VMN5$AllPools_noIOM_VMN5 <- ModelDFS_VMN5$DPM_VMN5 + ModelDFS_VMN5$RPM_VMN5 + ModelDFS_VMN5$BIO_VMN5 + ModelDFS_VMN5$HUM_VMN5

    #Create a column that add the monthly input of C (manure and litter separately)
    ModelDFSL_VMN5 <- merge(ModelDFS_VMN5, MCinputs_VMN5, by = "MNumber")

    ModelDFSL_VMN5$MInput_VMN5 <- ModelDFSL_VMN5$LitterC_VMN5 + ModelDFSL_VMN5$ManureC_VMN5
    #ModelDF_SL$MInput[1] <- 0

    #Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
    ModelDFSL_VMN5$CTails_VMN5 <- ModelDFSL_VMN5$AllPools_noIOM_VMN5 + ModelDFSL_VMN5$MInput_VMN5

    #Create Monthly Accumulated input of C
    ModelDFSL_VMN5$AccumInput_VMN5 = ModelDFSL_VMN5$AccumInput_VMN5=cumsum(ModelDFSL_VMN5$MInput_VMN5)

    #Create Monthly Growths for each carbon pool
    ModelDFSL_VMN5$MGrowth_DPM_VMN5 <- ave(ModelDFSL_VMN5$DPM_VMN5, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMN5$MGrowth_RPM_VMN5 <- ave(ModelDFSL_VMN5$RPM_VMN5, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMN5$MGrowth_BIO_VMN5 <- ave(ModelDFSL_VMN5$BIO_VMN5, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMN5$MGrowth_HUM_VMN5 <- ave(ModelDFSL_VMN5$HUM_VMN5, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMN5$MGrowth_IOM_VMN5 <- ave(ModelDFSL_VMN5$IOM_VMN5, FUN = function(x) c(0, diff(x)))

    #Create column for Monthly and Accumulated C-CO2 emissions
    ModelDFSL_VMN5$M_CCO2_VMN5 <- ModelDFSL_VMN5$MInput_VMN5 - ModelDFSL_VMN5$MGrowth_DPM_VMN5 - ModelDFSL_VMN5$MGrowth_RPM_VMN5 - ModelDFSL_VMN5$MGrowth_BIO_VMN5 - ModelDFSL_VMN5$MGrowth_HUM_VMN5
    ModelDFSL_VMN5$Accum_CCO2_VMN5 <- ModelDFSL_VMN5$AccumInput_VMN5 - ModelDFSL_VMN5$AllPools_noIOM_VMN5

    #Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
    ModelDFSL_VMN5$M_CCO2_VMN5[1] <- 0
    ModelDFSL_VMN5$Accum_CCO2_VMN5[1] <- 0

    #Balance validation
    ModelDFSL_VMN5$Balance_VMN5 <- ModelDFSL_VMN5$AccumInput_VMN5 - ModelDFSL_VMN5$Accum_CCO2_VMN5 - (ModelDFSL_VMN5$DPM_VMN5 + ModelDFSL_VMN5$RPM_VMN5 + ModelDFSL_VMN5$BIO_VMN5 + ModelDFSL_VMN5$HUM_VMN5)

    #Convert C-CO2 emissions into CO2 emissions
    ModelDFSL_VMN5$M_CO2_VMN5 <- ModelDFSL_VMN5$M_CCO2_VMN5 * 44/12
    ModelDFSL_VMN5$Accum_CO2_VMN5 <- ModelDFSL_VMN5$Accum_CCO2_VMN5 * 44/12

    #This model will be called VMN5C because implies a continuous input of C
    ModelDFSL_VMN5C <- ModelDFSL_VMN5

    #Export the dataframe
    write_xlsx(ModelDFSL_VMN5C,"VXC_Models\\ModelDFSL_R_VMN5C.xlsx")

    #Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
    #Create two equal models by using the above general script
    #Create model t=x
    ModelDFSLt0_VMN5 <- ModelDFSL_VMN5 #Create model t=x

    #Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
    ModelDFSLt1_VMN5.1 <- rbind(c(0:0), ModelDFSLt0_VMN5)
    ModelDFSLt1_VMN5.2 <- rbind(c(0:0), ModelDFSLt1_VMN5.1)
    ModelDFSLt1_VMN5.3 <- rbind(c(0:0), ModelDFSLt1_VMN5.2)
    ModelDFSLt1_VMN5.4 <- rbind(c(0:0), ModelDFSLt1_VMN5.3)
    ModelDFSLt1_VMN5.5 <- rbind(c(0:0), ModelDFSLt1_VMN5.4)
    ModelDFSLt1_VMN5.6 <- rbind(c(0:0), ModelDFSLt1_VMN5.5)
    ModelDFSLt1_VMN5.7 <- rbind(c(0:0), ModelDFSLt1_VMN5.6)
    ModelDFSLt1_VMN5.8 <- rbind(c(0:0), ModelDFSLt1_VMN5.7)
    ModelDFSLt1_VMN5.9 <- rbind(c(0:0), ModelDFSLt1_VMN5.8)
    ModelDFSLt1_VMN5.10 <- rbind(c(0:0), ModelDFSLt1_VMN5.9)
    ModelDFSLt1_VMN5.11 <- rbind(c(0:0), ModelDFSLt1_VMN5.10)
    ModelDFSLt1_VMN5.12 <- rbind(c(0:0), ModelDFSLt1_VMN5.11)
    ModelDFSLt1_VMN5.13 <- ModelDFSLt1_VMN5.12[-nrow(ModelDFSLt1_VMN5.12),]
    ModelDFSLt1_VMN5.14 <- ModelDFSLt1_VMN5.13[-nrow(ModelDFSLt1_VMN5.13),]
    ModelDFSLt1_VMN5.15 <- ModelDFSLt1_VMN5.14[-nrow(ModelDFSLt1_VMN5.14),]
    ModelDFSLt1_VMN5.16 <- ModelDFSLt1_VMN5.15[-nrow(ModelDFSLt1_VMN5.15),]
    ModelDFSLt1_VMN5.17 <- ModelDFSLt1_VMN5.16[-nrow(ModelDFSLt1_VMN5.16),]
    ModelDFSLt1_VMN5.18 <- ModelDFSLt1_VMN5.17[-nrow(ModelDFSLt1_VMN5.17),]
    ModelDFSLt1_VMN5.19 <- ModelDFSLt1_VMN5.18[-nrow(ModelDFSLt1_VMN5.18),]
    ModelDFSLt1_VMN5.20 <- ModelDFSLt1_VMN5.19[-nrow(ModelDFSLt1_VMN5.19),]
    ModelDFSLt1_VMN5.21 <- ModelDFSLt1_VMN5.20[-nrow(ModelDFSLt1_VMN5.20),]
    ModelDFSLt1_VMN5.22 <- ModelDFSLt1_VMN5.21[-nrow(ModelDFSLt1_VMN5.21),]
    ModelDFSLt1_VMN5.23 <- ModelDFSLt1_VMN5.22[-nrow(ModelDFSLt1_VMN5.22),]
    ModelDFSLt1_VMN5.24 <- ModelDFSLt1_VMN5.23[-nrow(ModelDFSLt1_VMN5.23),]

    ModelDFSLt1_VMN5 <- ModelDFSLt1_VMN5.24 #Create model t=x+1

    #Subtract model (t=x) - (t=x+1)
    ModelDFSL1y_VMN5 <- ModelDFSLt0_VMN5 - ModelDFSLt1_VMN5

    #Re-do Month Number column because the substraction was also applied to it
    ModelDFSL1y_VMN5$MNumber <- seq(from = 1, to = SimulationLength_months)

    #This model will be called VMN5P because implies a one-off input of C
    ModelDFSL_VMN5P <- ModelDFSL1y_VMN5

    #Export the dataframe
    write_xlsx(ModelDFSL_VMN5P,"VXP_Models\\ModelDFSL_R_VMN5P.xlsx")


    #Plot 3: Interactive Yearly CO2 emissions #
    MY <- 12
    ModelDFSL_VMN5P_YCO2 <- ModelDFSL_VMN5P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VMN5)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMN5P_YCO2) <- c("Year", "Months", "AnnualCO2_VMN_5")


    #Plot 3: Interactive Yearly CO2 emissions considering a delay
    GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
    ModelDFSL_VMN5P_YCO2D <- merge(ModelDFSL_VMN5P_YCO2, GWP100delay, by = "Year")
    ModelDFSL_VMN5P_YCO2D$AnnualCO2D_VMN_5 <- ModelDFSL_VMN5P_YCO2D$AnnualCO2_VMN_5 * ModelDFSL_VMN5P_YCO2D$GWP100

    #Plot 4: Interactive Yearly C emissions #
    MY <- 12
    ModelDFSL_VMN5P_YC <- ModelDFSL_VMN5P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VMN5)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMN5P_YC) <- c("Year", "Months", "CEmissions_VMN_5")


    #Plot 5: Interactive Yearly C tails (remaining C in Soil) #
    MY <- 12
    ModelDFSL_VMN5P_YCT <- ModelDFSL_VMN5P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VMN5)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMN5P_YCT) <- c("Year", "Months", "CTail_VMN_5")

    #Save Dataframes for Plots 3.1, 3.2, 4 and 5
    write_xlsx(ModelDFSL_VMN5P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VMN5P.xlsx") #Yearly CO2 emissions (no delay)
    write_xlsx(ModelDFSL_VMN5P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VMN5P.xlsx") #Yearly CO2 emissions (delay)
    write_xlsx(ModelDFSL_VMN5P_YC,"CEmissions_P\\ModelDFSL_R_CE_VMN5P.xlsx") #Yearly C emissions
    write_xlsx(ModelDFSL_VMN5P_YCT,"CTails_P\\ModelDFSL_R_CT_VMN5P.xlsx") #Yearly C emissions



    #### 12.7 - VMN6) Manure; 60%clay; No Tillage ####
    #The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
    fT_VMN6=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
    fW_VMN6=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                            S.Thick = soil.thick, pClay = clay100*0.6,
                            pE = 1.0, bare = FALSE)$b #Moisture effects per month
    xi.frame_VMN6=data.frame(years,rep(fT_VMN6*fW_VMN6,length.out=length(years)))

    #To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
    Model_VMN6=SoilR::RothCModel(
      t=years, #Simulation Length
      ks=c(k.DPM = 10*NTRM, k.RPM = 0.3*NTRM, k.BIO = 0.66*NTRM, k.HUM = 0.02*NTRM, k.IOM = 0*NTRM), #Decomposition rates for the different pools
      C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
      In=Scalar_LitterCinputs*0, #Amount of litter inputs by time
      FYM = Scalar_ManureCinputs*1, #Amount of Farm Yard Manure by time
      clay=clay100*0.6, #Percent clay in mineral soil
      xi=xi.frame_VMN6) #Loads the model

    Ct_VMN6=getC(Model_VMN6) #Calculates stocks for each pool per month

    #The results can be plotted with the commands
    matplot(years, Ct_VMN6, type="l", lty=1, col=1:5,
            xlab="Time (years)", ylab="C stocks (Mg/ha)")
    legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
           lty=1, col=1:5, bty="n")

    VEC_Lit_VMN6 <- rep(M_Scalar_LitterCinputs*0, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
    VEC_Man_VMN6 <- rep(M_Scalar_ManureCinputs*1, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

    VEC_LitDF_VMN6 <- as.data.frame(VEC_Lit_VMN6) #Converting the Litter vector to a data frame
    VEC_LitDF_VMN6$MNumber <- seq(from = 1, to = SimulationLength_months)
    VEC_ManDF_VMN6 <- as.data.frame(VEC_Man_VMN6) #Converting the Manure vector to a data frame
    VEC_ManDF_VMN6$MNumber <- seq(from = 1, to = SimulationLength_months)

    sapply(VEC_LitDF_VMN6, class) #Check that class is numeric
    sapply(VEC_ManDF_VMN6, class) #Check that class is numeric
    LitterCinputs_VMN6=VEC_LitDF_VMN6   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    ManureCinputs_VMN6=VEC_ManDF_VMN6 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    MCinputs_VMN6 <- merge(LitterCinputs_VMN6, ManureCinputs_VMN6, by = "MNumber")
    MCinputs_VMN6$MInput_VMN6 <- MCinputs_VMN6$VEC_Lit_VMN6 + MCinputs_VMN6$VEC_Man_VMN6

    #Change names of litter and manure columns for more common ones
    colnames(MCinputs_VMN6)[which(names(MCinputs_VMN6) == "VEC_Lit_VMN6")] <- "LitterC_VMN6"
    colnames(MCinputs_VMN6)[which(names(MCinputs_VMN6) == "VEC_Man_VMN6")] <- "ManureC_VMN6"

    #Create a dataframe with the data considering the simulation length
    ModelDF_VMN6 <- as.data.frame(Ct_VMN6)
    colnames(ModelDF_VMN6) <- c('DPM_VMN6','RPM_VMN6','BIO_VMN6', 'HUM_VMN6', 'IOM_VMN6')
    ModelDFS_VMN6 <- ModelDF_VMN6[1:SimulationLength_months, ]

    #Create a column with the number of month of analysis
    ModelDFS_VMN6$MNumber <- seq(from = 1, to = SimulationLength_months)

    #Create a column that sums all pools
    ModelDFS_VMN6$AllPools_VMN6 <- ModelDFS_VMN6$DPM_VMN6 + ModelDFS_VMN6$RPM_VMN6 + ModelDFS_VMN6$BIO_VMN6 + ModelDFS_VMN6$HUM_VMN6 + ModelDFS_VMN6$IOM_VMN6

    #Create a column that sums all pools except IOM (static)
    ModelDFS_VMN6$AllPools_noIOM_VMN6 <- ModelDFS_VMN6$DPM_VMN6 + ModelDFS_VMN6$RPM_VMN6 + ModelDFS_VMN6$BIO_VMN6 + ModelDFS_VMN6$HUM_VMN6

    #Create a column that add the monthly input of C (manure and litter separately)
    ModelDFSL_VMN6 <- merge(ModelDFS_VMN6, MCinputs_VMN6, by = "MNumber")

    ModelDFSL_VMN6$MInput_VMN6 <- ModelDFSL_VMN6$LitterC_VMN6 + ModelDFSL_VMN6$ManureC_VMN6
    #ModelDF_SL$MInput[1] <- 0

    #Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
    ModelDFSL_VMN6$CTails_VMN6 <- ModelDFSL_VMN6$AllPools_noIOM_VMN6 + ModelDFSL_VMN6$MInput_VMN6

    #Create Monthly Accumulated input of C
    ModelDFSL_VMN6$AccumInput_VMN6 = ModelDFSL_VMN6$AccumInput_VMN6=cumsum(ModelDFSL_VMN6$MInput_VMN6)

    #Create Monthly Growths for each carbon pool
    ModelDFSL_VMN6$MGrowth_DPM_VMN6 <- ave(ModelDFSL_VMN6$DPM_VMN6, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMN6$MGrowth_RPM_VMN6 <- ave(ModelDFSL_VMN6$RPM_VMN6, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMN6$MGrowth_BIO_VMN6 <- ave(ModelDFSL_VMN6$BIO_VMN6, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMN6$MGrowth_HUM_VMN6 <- ave(ModelDFSL_VMN6$HUM_VMN6, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMN6$MGrowth_IOM_VMN6 <- ave(ModelDFSL_VMN6$IOM_VMN6, FUN = function(x) c(0, diff(x)))

    #Create column for Monthly and Accumulated C-CO2 emissions
    ModelDFSL_VMN6$M_CCO2_VMN6 <- ModelDFSL_VMN6$MInput_VMN6 - ModelDFSL_VMN6$MGrowth_DPM_VMN6 - ModelDFSL_VMN6$MGrowth_RPM_VMN6 - ModelDFSL_VMN6$MGrowth_BIO_VMN6 - ModelDFSL_VMN6$MGrowth_HUM_VMN6
    ModelDFSL_VMN6$Accum_CCO2_VMN6 <- ModelDFSL_VMN6$AccumInput_VMN6 - ModelDFSL_VMN6$AllPools_noIOM_VMN6

    #Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
    ModelDFSL_VMN6$M_CCO2_VMN6[1] <- 0
    ModelDFSL_VMN6$Accum_CCO2_VMN6[1] <- 0

    #Balance validation
    ModelDFSL_VMN6$Balance_VMN6 <- ModelDFSL_VMN6$AccumInput_VMN6 - ModelDFSL_VMN6$Accum_CCO2_VMN6 - (ModelDFSL_VMN6$DPM_VMN6 + ModelDFSL_VMN6$RPM_VMN6 + ModelDFSL_VMN6$BIO_VMN6 + ModelDFSL_VMN6$HUM_VMN6)

    #Convert C-CO2 emissions into CO2 emissions
    ModelDFSL_VMN6$M_CO2_VMN6 <- ModelDFSL_VMN6$M_CCO2_VMN6 * 44/12
    ModelDFSL_VMN6$Accum_CO2_VMN6 <- ModelDFSL_VMN6$Accum_CCO2_VMN6 * 44/12

    #This model will be called VMN6C because implies a continuous input of C
    ModelDFSL_VMN6C <- ModelDFSL_VMN6

    #Export the dataframe
    write_xlsx(ModelDFSL_VMN6C,"VXC_Models\\ModelDFSL_R_VMN6C.xlsx")

    #Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
    #Create two equal models by using the above general script
    #Create model t=x
    ModelDFSLt0_VMN6 <- ModelDFSL_VMN6 #Create model t=x

    #Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
    ModelDFSLt1_VMN6.1 <- rbind(c(0:0), ModelDFSLt0_VMN6)
    ModelDFSLt1_VMN6.2 <- rbind(c(0:0), ModelDFSLt1_VMN6.1)
    ModelDFSLt1_VMN6.3 <- rbind(c(0:0), ModelDFSLt1_VMN6.2)
    ModelDFSLt1_VMN6.4 <- rbind(c(0:0), ModelDFSLt1_VMN6.3)
    ModelDFSLt1_VMN6.5 <- rbind(c(0:0), ModelDFSLt1_VMN6.4)
    ModelDFSLt1_VMN6.6 <- rbind(c(0:0), ModelDFSLt1_VMN6.5)
    ModelDFSLt1_VMN6.7 <- rbind(c(0:0), ModelDFSLt1_VMN6.6)
    ModelDFSLt1_VMN6.8 <- rbind(c(0:0), ModelDFSLt1_VMN6.7)
    ModelDFSLt1_VMN6.9 <- rbind(c(0:0), ModelDFSLt1_VMN6.8)
    ModelDFSLt1_VMN6.10 <- rbind(c(0:0), ModelDFSLt1_VMN6.9)
    ModelDFSLt1_VMN6.11 <- rbind(c(0:0), ModelDFSLt1_VMN6.10)
    ModelDFSLt1_VMN6.12 <- rbind(c(0:0), ModelDFSLt1_VMN6.11)
    ModelDFSLt1_VMN6.13 <- ModelDFSLt1_VMN6.12[-nrow(ModelDFSLt1_VMN6.12),]
    ModelDFSLt1_VMN6.14 <- ModelDFSLt1_VMN6.13[-nrow(ModelDFSLt1_VMN6.13),]
    ModelDFSLt1_VMN6.15 <- ModelDFSLt1_VMN6.14[-nrow(ModelDFSLt1_VMN6.14),]
    ModelDFSLt1_VMN6.16 <- ModelDFSLt1_VMN6.15[-nrow(ModelDFSLt1_VMN6.15),]
    ModelDFSLt1_VMN6.17 <- ModelDFSLt1_VMN6.16[-nrow(ModelDFSLt1_VMN6.16),]
    ModelDFSLt1_VMN6.18 <- ModelDFSLt1_VMN6.17[-nrow(ModelDFSLt1_VMN6.17),]
    ModelDFSLt1_VMN6.19 <- ModelDFSLt1_VMN6.18[-nrow(ModelDFSLt1_VMN6.18),]
    ModelDFSLt1_VMN6.20 <- ModelDFSLt1_VMN6.19[-nrow(ModelDFSLt1_VMN6.19),]
    ModelDFSLt1_VMN6.21 <- ModelDFSLt1_VMN6.20[-nrow(ModelDFSLt1_VMN6.20),]
    ModelDFSLt1_VMN6.22 <- ModelDFSLt1_VMN6.21[-nrow(ModelDFSLt1_VMN6.21),]
    ModelDFSLt1_VMN6.23 <- ModelDFSLt1_VMN6.22[-nrow(ModelDFSLt1_VMN6.22),]
    ModelDFSLt1_VMN6.24 <- ModelDFSLt1_VMN6.23[-nrow(ModelDFSLt1_VMN6.23),]

    ModelDFSLt1_VMN6 <- ModelDFSLt1_VMN6.24 #Create model t=x+1

    #Subtract model (t=x) - (t=x+1)
    ModelDFSL1y_VMN6 <- ModelDFSLt0_VMN6 - ModelDFSLt1_VMN6

    #Re-do Month Number column because the substraction was also applied to it
    ModelDFSL1y_VMN6$MNumber <- seq(from = 1, to = SimulationLength_months)

    #This model will be called VMN6P because implies a one-off input of C
    ModelDFSL_VMN6P <- ModelDFSL1y_VMN6

    #Export the dataframe
    write_xlsx(ModelDFSL_VMN6P,"VXP_Models\\ModelDFSL_R_VMN6P.xlsx")

    #Plot 3: Interactive Yearly CO2 emissions #
    MY <- 12
    ModelDFSL_VMN6P_YCO2 <- ModelDFSL_VMN6P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VMN6)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMN6P_YCO2) <- c("Year", "Months", "AnnualCO2_VMN_6")


    #Plot 3: Interactive Yearly CO2 emissions considering a delay
    GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
    ModelDFSL_VMN6P_YCO2D <- merge(ModelDFSL_VMN6P_YCO2, GWP100delay, by = "Year")
    ModelDFSL_VMN6P_YCO2D$AnnualCO2D_VMN_6 <- ModelDFSL_VMN6P_YCO2D$AnnualCO2_VMN_6 * ModelDFSL_VMN6P_YCO2D$GWP100

    #Plot 4: Interactive Yearly C emissions #
    MY <- 12
    ModelDFSL_VMN6P_YC <- ModelDFSL_VMN6P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VMN6)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMN6P_YC) <- c("Year", "Months", "CEmissions_VMN_6")


    #Plot 5: Interactive Yearly C tails (remaining C in Soil) #
    MY <- 12
    ModelDFSL_VMN6P_YCT <- ModelDFSL_VMN6P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VMN6)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMN6P_YCT) <- c("Year", "Months", "CTail_VMN_6")

    #Save Dataframes for Plots 3.1, 3.2, 4 and 5
    write_xlsx(ModelDFSL_VMN6P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VMN6P.xlsx") #Yearly CO2 emissions (no delay)
    write_xlsx(ModelDFSL_VMN6P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VMN6P.xlsx") #Yearly CO2 emissions (delay)
    write_xlsx(ModelDFSL_VMN6P_YC,"CEmissions_P\\ModelDFSL_R_CE_VMN6P.xlsx") #Yearly C emissions
    write_xlsx(ModelDFSL_VMN6P_YCT,"CTails_P\\ModelDFSL_R_CT_VMN6P.xlsx") #Yearly C emissions



    #### 12.8 - VMN7) Manure; 70%clay; No Tillage ####
    #The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
    fT_VMN7=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
    fW_VMN7=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                            S.Thick = soil.thick, pClay = clay100*0.7,
                            pE = 1.0, bare = FALSE)$b #Moisture effects per month
    xi.frame_VMN7=data.frame(years,rep(fT_VMN7*fW_VMN7,length.out=length(years)))

    #To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
    Model_VMN7=SoilR::RothCModel(
      t=years, #Simulation Length
      ks=c(k.DPM = 10*NTRM, k.RPM = 0.3*NTRM, k.BIO = 0.66*NTRM, k.HUM = 0.02*NTRM, k.IOM = 0*NTRM), #Decomposition rates for the different pools
      C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
      In=Scalar_LitterCinputs*0, #Amount of litter inputs by time
      FYM = Scalar_ManureCinputs*1, #Amount of Farm Yard Manure by time
      clay=clay100*0.7, #Percent clay in mineral soil
      xi=xi.frame_VMN7) #Loads the model

    Ct_VMN7=getC(Model_VMN7) #Calculates stocks for each pool per month

    #The results can be plotted with the commands
    matplot(years, Ct_VMN7, type="l", lty=1, col=1:5,
            xlab="Time (years)", ylab="C stocks (Mg/ha)")
    legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
           lty=1, col=1:5, bty="n")

    VEC_Lit_VMN7 <- rep(M_Scalar_LitterCinputs*0, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
    VEC_Man_VMN7 <- rep(M_Scalar_ManureCinputs*1, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

    VEC_LitDF_VMN7 <- as.data.frame(VEC_Lit_VMN7) #Converting the Litter vector to a data frame
    VEC_LitDF_VMN7$MNumber <- seq(from = 1, to = SimulationLength_months)
    VEC_ManDF_VMN7 <- as.data.frame(VEC_Man_VMN7) #Converting the Manure vector to a data frame
    VEC_ManDF_VMN7$MNumber <- seq(from = 1, to = SimulationLength_months)

    sapply(VEC_LitDF_VMN7, class) #Check that class is numeric
    sapply(VEC_ManDF_VMN7, class) #Check that class is numeric
    LitterCinputs_VMN7=VEC_LitDF_VMN7   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    ManureCinputs_VMN7=VEC_ManDF_VMN7 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    MCinputs_VMN7 <- merge(LitterCinputs_VMN7, ManureCinputs_VMN7, by = "MNumber")
    MCinputs_VMN7$MInput_VMN7 <- MCinputs_VMN7$VEC_Lit_VMN7 + MCinputs_VMN7$VEC_Man_VMN7

    #Change names of litter and manure columns for more common ones
    colnames(MCinputs_VMN7)[which(names(MCinputs_VMN7) == "VEC_Lit_VMN7")] <- "LitterC_VMN7"
    colnames(MCinputs_VMN7)[which(names(MCinputs_VMN7) == "VEC_Man_VMN7")] <- "ManureC_VMN7"

    #Create a dataframe with the data considering the simulation length
    ModelDF_VMN7 <- as.data.frame(Ct_VMN7)
    colnames(ModelDF_VMN7) <- c('DPM_VMN7','RPM_VMN7','BIO_VMN7', 'HUM_VMN7', 'IOM_VMN7')
    ModelDFS_VMN7 <- ModelDF_VMN7[1:SimulationLength_months, ]

    #Create a column with the number of month of analysis
    ModelDFS_VMN7$MNumber <- seq(from = 1, to = SimulationLength_months)

    #Create a column that sums all pools
    ModelDFS_VMN7$AllPools_VMN7 <- ModelDFS_VMN7$DPM_VMN7 + ModelDFS_VMN7$RPM_VMN7 + ModelDFS_VMN7$BIO_VMN7 + ModelDFS_VMN7$HUM_VMN7 + ModelDFS_VMN7$IOM_VMN7

    #Create a column that sums all pools except IOM (static)
    ModelDFS_VMN7$AllPools_noIOM_VMN7 <- ModelDFS_VMN7$DPM_VMN7 + ModelDFS_VMN7$RPM_VMN7 + ModelDFS_VMN7$BIO_VMN7 + ModelDFS_VMN7$HUM_VMN7

    #Create a column that add the monthly input of C (manure and litter separately)
    ModelDFSL_VMN7 <- merge(ModelDFS_VMN7, MCinputs_VMN7, by = "MNumber")

    ModelDFSL_VMN7$MInput_VMN7 <- ModelDFSL_VMN7$LitterC_VMN7 + ModelDFSL_VMN7$ManureC_VMN7
    #ModelDF_SL$MInput[1] <- 0

    #Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
    ModelDFSL_VMN7$CTails_VMN7 <- ModelDFSL_VMN7$AllPools_noIOM_VMN7 + ModelDFSL_VMN7$MInput_VMN7

    #Create Monthly Accumulated input of C
    ModelDFSL_VMN7$AccumInput_VMN7 = ModelDFSL_VMN7$AccumInput_VMN7=cumsum(ModelDFSL_VMN7$MInput_VMN7)

    #Create Monthly Growths for each carbon pool
    ModelDFSL_VMN7$MGrowth_DPM_VMN7 <- ave(ModelDFSL_VMN7$DPM_VMN7, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMN7$MGrowth_RPM_VMN7 <- ave(ModelDFSL_VMN7$RPM_VMN7, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMN7$MGrowth_BIO_VMN7 <- ave(ModelDFSL_VMN7$BIO_VMN7, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMN7$MGrowth_HUM_VMN7 <- ave(ModelDFSL_VMN7$HUM_VMN7, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMN7$MGrowth_IOM_VMN7 <- ave(ModelDFSL_VMN7$IOM_VMN7, FUN = function(x) c(0, diff(x)))

    #Create column for Monthly and Accumulated C-CO2 emissions
    ModelDFSL_VMN7$M_CCO2_VMN7 <- ModelDFSL_VMN7$MInput_VMN7 - ModelDFSL_VMN7$MGrowth_DPM_VMN7 - ModelDFSL_VMN7$MGrowth_RPM_VMN7 - ModelDFSL_VMN7$MGrowth_BIO_VMN7 - ModelDFSL_VMN7$MGrowth_HUM_VMN7
    ModelDFSL_VMN7$Accum_CCO2_VMN7 <- ModelDFSL_VMN7$AccumInput_VMN7 - ModelDFSL_VMN7$AllPools_noIOM_VMN7

    #Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
    ModelDFSL_VMN7$M_CCO2_VMN7[1] <- 0
    ModelDFSL_VMN7$Accum_CCO2_VMN7[1] <- 0

    #Balance validation
    ModelDFSL_VMN7$Balance_VMN7 <- ModelDFSL_VMN7$AccumInput_VMN7 - ModelDFSL_VMN7$Accum_CCO2_VMN7 - (ModelDFSL_VMN7$DPM_VMN7 + ModelDFSL_VMN7$RPM_VMN7 + ModelDFSL_VMN7$BIO_VMN7 + ModelDFSL_VMN7$HUM_VMN7)

    #Convert C-CO2 emissions into CO2 emissions
    ModelDFSL_VMN7$M_CO2_VMN7 <- ModelDFSL_VMN7$M_CCO2_VMN7 * 44/12
    ModelDFSL_VMN7$Accum_CO2_VMN7 <- ModelDFSL_VMN7$Accum_CCO2_VMN7 * 44/12

    #This model will be called VMN7C because implies a continuous input of C
    ModelDFSL_VMN7C <- ModelDFSL_VMN7

    #Export the dataframe
    write_xlsx(ModelDFSL_VMN7C,"VXC_Models\\ModelDFSL_R_VMN7C.xlsx")

    #Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
    #Create two equal models by using the above general script
    #Create model t=x
    ModelDFSLt0_VMN7 <- ModelDFSL_VMN7 #Create model t=x

    #Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
    ModelDFSLt1_VMN7.1 <- rbind(c(0:0), ModelDFSLt0_VMN7)
    ModelDFSLt1_VMN7.2 <- rbind(c(0:0), ModelDFSLt1_VMN7.1)
    ModelDFSLt1_VMN7.3 <- rbind(c(0:0), ModelDFSLt1_VMN7.2)
    ModelDFSLt1_VMN7.4 <- rbind(c(0:0), ModelDFSLt1_VMN7.3)
    ModelDFSLt1_VMN7.5 <- rbind(c(0:0), ModelDFSLt1_VMN7.4)
    ModelDFSLt1_VMN7.6 <- rbind(c(0:0), ModelDFSLt1_VMN7.5)
    ModelDFSLt1_VMN7.7 <- rbind(c(0:0), ModelDFSLt1_VMN7.6)
    ModelDFSLt1_VMN7.8 <- rbind(c(0:0), ModelDFSLt1_VMN7.7)
    ModelDFSLt1_VMN7.9 <- rbind(c(0:0), ModelDFSLt1_VMN7.8)
    ModelDFSLt1_VMN7.10 <- rbind(c(0:0), ModelDFSLt1_VMN7.9)
    ModelDFSLt1_VMN7.11 <- rbind(c(0:0), ModelDFSLt1_VMN7.10)
    ModelDFSLt1_VMN7.12 <- rbind(c(0:0), ModelDFSLt1_VMN7.11)
    ModelDFSLt1_VMN7.13 <- ModelDFSLt1_VMN7.12[-nrow(ModelDFSLt1_VMN7.12),]
    ModelDFSLt1_VMN7.14 <- ModelDFSLt1_VMN7.13[-nrow(ModelDFSLt1_VMN7.13),]
    ModelDFSLt1_VMN7.15 <- ModelDFSLt1_VMN7.14[-nrow(ModelDFSLt1_VMN7.14),]
    ModelDFSLt1_VMN7.16 <- ModelDFSLt1_VMN7.15[-nrow(ModelDFSLt1_VMN7.15),]
    ModelDFSLt1_VMN7.17 <- ModelDFSLt1_VMN7.16[-nrow(ModelDFSLt1_VMN7.16),]
    ModelDFSLt1_VMN7.18 <- ModelDFSLt1_VMN7.17[-nrow(ModelDFSLt1_VMN7.17),]
    ModelDFSLt1_VMN7.19 <- ModelDFSLt1_VMN7.18[-nrow(ModelDFSLt1_VMN7.18),]
    ModelDFSLt1_VMN7.20 <- ModelDFSLt1_VMN7.19[-nrow(ModelDFSLt1_VMN7.19),]
    ModelDFSLt1_VMN7.21 <- ModelDFSLt1_VMN7.20[-nrow(ModelDFSLt1_VMN7.20),]
    ModelDFSLt1_VMN7.22 <- ModelDFSLt1_VMN7.21[-nrow(ModelDFSLt1_VMN7.21),]
    ModelDFSLt1_VMN7.23 <- ModelDFSLt1_VMN7.22[-nrow(ModelDFSLt1_VMN7.22),]
    ModelDFSLt1_VMN7.24 <- ModelDFSLt1_VMN7.23[-nrow(ModelDFSLt1_VMN7.23),]

    ModelDFSLt1_VMN7 <- ModelDFSLt1_VMN7.24 #Create model t=x+1

    #Subtract model (t=x) - (t=x+1)
    ModelDFSL1y_VMN7 <- ModelDFSLt0_VMN7 - ModelDFSLt1_VMN7

    #Re-do Month Number column because the substraction was also applied to it
    ModelDFSL1y_VMN7$MNumber <- seq(from = 1, to = SimulationLength_months)

    #This model will be called VMN7P because implies a one-off input of C
    ModelDFSL_VMN7P <- ModelDFSL1y_VMN7

    #Export the dataframe
    write_xlsx(ModelDFSL_VMN7P,"VXP_Models\\ModelDFSL_R_VMN7P.xlsx")

    #Plot 3: Interactive Yearly CO2 emissions #
    MY <- 12
    ModelDFSL_VMN7P_YCO2 <- ModelDFSL_VMN7P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VMN7)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMN7P_YCO2) <- c("Year", "Months", "AnnualCO2_VMN_7")


    #Plot 3: Interactive Yearly CO2 emissions considering a delay
    GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
    ModelDFSL_VMN7P_YCO2D <- merge(ModelDFSL_VMN7P_YCO2, GWP100delay, by = "Year")
    ModelDFSL_VMN7P_YCO2D$AnnualCO2D_VMN_7 <- ModelDFSL_VMN7P_YCO2D$AnnualCO2_VMN_7 * ModelDFSL_VMN7P_YCO2D$GWP100

    #Plot 4: Interactive Yearly C emissions #
    MY <- 12
    ModelDFSL_VMN7P_YC <- ModelDFSL_VMN7P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VMN7)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMN7P_YC) <- c("Year", "Months", "CEmissions_VMN_7")


    #Plot 5: Interactive Yearly C tails (remaining C in Soil) #
    MY <- 12
    ModelDFSL_VMN7P_YCT <- ModelDFSL_VMN7P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VMN7)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMN7P_YCT) <- c("Year", "Months", "CTail_VMN_7")


    #Save Dataframes for Plots 3.1, 3.2, 4 and 5
    write_xlsx(ModelDFSL_VMN7P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VMN7P.xlsx") #Yearly CO2 emissions (no delay)
    write_xlsx(ModelDFSL_VMN7P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VMN7P.xlsx") #Yearly CO2 emissions (delay)
    write_xlsx(ModelDFSL_VMN7P_YC,"CEmissions_P\\ModelDFSL_R_CE_VMN7P.xlsx") #Yearly C emissions
    write_xlsx(ModelDFSL_VMN7P_YCT,"CTails_P\\ModelDFSL_R_CT_VMN7P.xlsx") #Yearly C emissions



    #### 12.9 - VMN8) Manure; 80%clay; No Tillage ####
    #The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
    fT_VMN8=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
    fW_VMN8=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                            S.Thick = soil.thick, pClay = clay100*0.8,
                            pE = 1.0, bare = FALSE)$b #Moisture effects per month
    xi.frame_VMN8=data.frame(years,rep(fT_VMN8*fW_VMN8,length.out=length(years)))

    #To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
    Model_VMN8=SoilR::RothCModel(
      t=years, #Simulation Length
      ks=c(k.DPM = 10*NTRM, k.RPM = 0.3*NTRM, k.BIO = 0.66*NTRM, k.HUM = 0.02*NTRM, k.IOM = 0*NTRM), #Decomposition rates for the different pools
      C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
      In=Scalar_LitterCinputs*0, #Amount of litter inputs by time
      FYM = Scalar_ManureCinputs*1, #Amount of Farm Yard Manure by time
      clay=clay100*0.8, #Percent clay in mineral soil
      xi=xi.frame_VMN8) #Loads the model

    Ct_VMN8=getC(Model_VMN8) #Calculates stocks for each pool per month

    #The results can be plotted with the commands
    matplot(years, Ct_VMN8, type="l", lty=1, col=1:5,
            xlab="Time (years)", ylab="C stocks (Mg/ha)")
    legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
           lty=1, col=1:5, bty="n")

    VEC_Lit_VMN8 <- rep(M_Scalar_LitterCinputs*0, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
    VEC_Man_VMN8 <- rep(M_Scalar_ManureCinputs*1, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

    VEC_LitDF_VMN8 <- as.data.frame(VEC_Lit_VMN8) #Converting the Litter vector to a data frame
    VEC_LitDF_VMN8$MNumber <- seq(from = 1, to = SimulationLength_months)
    VEC_ManDF_VMN8 <- as.data.frame(VEC_Man_VMN8) #Converting the Manure vector to a data frame
    VEC_ManDF_VMN8$MNumber <- seq(from = 1, to = SimulationLength_months)

    sapply(VEC_LitDF_VMN8, class) #Check that class is numeric
    sapply(VEC_ManDF_VMN8, class) #Check that class is numeric
    LitterCinputs_VMN8=VEC_LitDF_VMN8   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    ManureCinputs_VMN8=VEC_ManDF_VMN8 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    MCinputs_VMN8 <- merge(LitterCinputs_VMN8, ManureCinputs_VMN8, by = "MNumber")
    MCinputs_VMN8$MInput_VMN8 <- MCinputs_VMN8$VEC_Lit_VMN8 + MCinputs_VMN8$VEC_Man_VMN8

    #Change names of litter and manure columns for more common ones
    colnames(MCinputs_VMN8)[which(names(MCinputs_VMN8) == "VEC_Lit_VMN8")] <- "LitterC_VMN8"
    colnames(MCinputs_VMN8)[which(names(MCinputs_VMN8) == "VEC_Man_VMN8")] <- "ManureC_VMN8"

    #Create a dataframe with the data considering the simulation length
    ModelDF_VMN8 <- as.data.frame(Ct_VMN8)
    colnames(ModelDF_VMN8) <- c('DPM_VMN8','RPM_VMN8','BIO_VMN8', 'HUM_VMN8', 'IOM_VMN8')
    ModelDFS_VMN8 <- ModelDF_VMN8[1:SimulationLength_months, ]

    #Create a column with the number of month of analysis
    ModelDFS_VMN8$MNumber <- seq(from = 1, to = SimulationLength_months)

    #Create a column that sums all pools
    ModelDFS_VMN8$AllPools_VMN8 <- ModelDFS_VMN8$DPM_VMN8 + ModelDFS_VMN8$RPM_VMN8 + ModelDFS_VMN8$BIO_VMN8 + ModelDFS_VMN8$HUM_VMN8 + ModelDFS_VMN8$IOM_VMN8

    #Create a column that sums all pools except IOM (static)
    ModelDFS_VMN8$AllPools_noIOM_VMN8 <- ModelDFS_VMN8$DPM_VMN8 + ModelDFS_VMN8$RPM_VMN8 + ModelDFS_VMN8$BIO_VMN8 + ModelDFS_VMN8$HUM_VMN8

    #Create a column that add the monthly input of C (manure and litter separately)
    ModelDFSL_VMN8 <- merge(ModelDFS_VMN8, MCinputs_VMN8, by = "MNumber")

    ModelDFSL_VMN8$MInput_VMN8 <- ModelDFSL_VMN8$LitterC_VMN8 + ModelDFSL_VMN8$ManureC_VMN8
    #ModelDF_SL$MInput[1] <- 0

    #Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
    ModelDFSL_VMN8$CTails_VMN8 <- ModelDFSL_VMN8$AllPools_noIOM_VMN8 + ModelDFSL_VMN8$MInput_VMN8

    #Create Monthly Accumulated input of C
    ModelDFSL_VMN8$AccumInput_VMN8 = ModelDFSL_VMN8$AccumInput_VMN8=cumsum(ModelDFSL_VMN8$MInput_VMN8)

    #Create Monthly Growths for each carbon pool
    ModelDFSL_VMN8$MGrowth_DPM_VMN8 <- ave(ModelDFSL_VMN8$DPM_VMN8, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMN8$MGrowth_RPM_VMN8 <- ave(ModelDFSL_VMN8$RPM_VMN8, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMN8$MGrowth_BIO_VMN8 <- ave(ModelDFSL_VMN8$BIO_VMN8, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMN8$MGrowth_HUM_VMN8 <- ave(ModelDFSL_VMN8$HUM_VMN8, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMN8$MGrowth_IOM_VMN8 <- ave(ModelDFSL_VMN8$IOM_VMN8, FUN = function(x) c(0, diff(x)))

    #Create column for Monthly and Accumulated C-CO2 emissions
    ModelDFSL_VMN8$M_CCO2_VMN8 <- ModelDFSL_VMN8$MInput_VMN8 - ModelDFSL_VMN8$MGrowth_DPM_VMN8 - ModelDFSL_VMN8$MGrowth_RPM_VMN8 - ModelDFSL_VMN8$MGrowth_BIO_VMN8 - ModelDFSL_VMN8$MGrowth_HUM_VMN8
    ModelDFSL_VMN8$Accum_CCO2_VMN8 <- ModelDFSL_VMN8$AccumInput_VMN8 - ModelDFSL_VMN8$AllPools_noIOM_VMN8

    #Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
    ModelDFSL_VMN8$M_CCO2_VMN8[1] <- 0
    ModelDFSL_VMN8$Accum_CCO2_VMN8[1] <- 0

    #Balance validation
    ModelDFSL_VMN8$Balance_VMN8 <- ModelDFSL_VMN8$AccumInput_VMN8 - ModelDFSL_VMN8$Accum_CCO2_VMN8 - (ModelDFSL_VMN8$DPM_VMN8 + ModelDFSL_VMN8$RPM_VMN8 + ModelDFSL_VMN8$BIO_VMN8 + ModelDFSL_VMN8$HUM_VMN8)

    #Convert C-CO2 emissions into CO2 emissions
    ModelDFSL_VMN8$M_CO2_VMN8 <- ModelDFSL_VMN8$M_CCO2_VMN8 * 44/12
    ModelDFSL_VMN8$Accum_CO2_VMN8 <- ModelDFSL_VMN8$Accum_CCO2_VMN8 * 44/12

    #This model will be called VMN8C because implies a continuous input of C
    ModelDFSL_VMN8C <- ModelDFSL_VMN8

    #Export the dataframe
    write_xlsx(ModelDFSL_VMN8C,"VXC_Models\\ModelDFSL_R_VMN8C.xlsx")

    #Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
    #Create two equal models by using the above general script
    #Create model t=x
    ModelDFSLt0_VMN8 <- ModelDFSL_VMN8 #Create model t=x

    #Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
    ModelDFSLt1_VMN8.1 <- rbind(c(0:0), ModelDFSLt0_VMN8)
    ModelDFSLt1_VMN8.2 <- rbind(c(0:0), ModelDFSLt1_VMN8.1)
    ModelDFSLt1_VMN8.3 <- rbind(c(0:0), ModelDFSLt1_VMN8.2)
    ModelDFSLt1_VMN8.4 <- rbind(c(0:0), ModelDFSLt1_VMN8.3)
    ModelDFSLt1_VMN8.5 <- rbind(c(0:0), ModelDFSLt1_VMN8.4)
    ModelDFSLt1_VMN8.6 <- rbind(c(0:0), ModelDFSLt1_VMN8.5)
    ModelDFSLt1_VMN8.7 <- rbind(c(0:0), ModelDFSLt1_VMN8.6)
    ModelDFSLt1_VMN8.8 <- rbind(c(0:0), ModelDFSLt1_VMN8.7)
    ModelDFSLt1_VMN8.9 <- rbind(c(0:0), ModelDFSLt1_VMN8.8)
    ModelDFSLt1_VMN8.10 <- rbind(c(0:0), ModelDFSLt1_VMN8.9)
    ModelDFSLt1_VMN8.11 <- rbind(c(0:0), ModelDFSLt1_VMN8.10)
    ModelDFSLt1_VMN8.12 <- rbind(c(0:0), ModelDFSLt1_VMN8.11)
    ModelDFSLt1_VMN8.13 <- ModelDFSLt1_VMN8.12[-nrow(ModelDFSLt1_VMN8.12),]
    ModelDFSLt1_VMN8.14 <- ModelDFSLt1_VMN8.13[-nrow(ModelDFSLt1_VMN8.13),]
    ModelDFSLt1_VMN8.15 <- ModelDFSLt1_VMN8.14[-nrow(ModelDFSLt1_VMN8.14),]
    ModelDFSLt1_VMN8.16 <- ModelDFSLt1_VMN8.15[-nrow(ModelDFSLt1_VMN8.15),]
    ModelDFSLt1_VMN8.17 <- ModelDFSLt1_VMN8.16[-nrow(ModelDFSLt1_VMN8.16),]
    ModelDFSLt1_VMN8.18 <- ModelDFSLt1_VMN8.17[-nrow(ModelDFSLt1_VMN8.17),]
    ModelDFSLt1_VMN8.19 <- ModelDFSLt1_VMN8.18[-nrow(ModelDFSLt1_VMN8.18),]
    ModelDFSLt1_VMN8.20 <- ModelDFSLt1_VMN8.19[-nrow(ModelDFSLt1_VMN8.19),]
    ModelDFSLt1_VMN8.21 <- ModelDFSLt1_VMN8.20[-nrow(ModelDFSLt1_VMN8.20),]
    ModelDFSLt1_VMN8.22 <- ModelDFSLt1_VMN8.21[-nrow(ModelDFSLt1_VMN8.21),]
    ModelDFSLt1_VMN8.23 <- ModelDFSLt1_VMN8.22[-nrow(ModelDFSLt1_VMN8.22),]
    ModelDFSLt1_VMN8.24 <- ModelDFSLt1_VMN8.23[-nrow(ModelDFSLt1_VMN8.23),]

    ModelDFSLt1_VMN8 <- ModelDFSLt1_VMN8.24 #Create model t=x+1

    #Subtract model (t=x) - (t=x+1)
    ModelDFSL1y_VMN8 <- ModelDFSLt0_VMN8 - ModelDFSLt1_VMN8

    #Re-do Month Number column because the substraction was also applied to it
    ModelDFSL1y_VMN8$MNumber <- seq(from = 1, to = SimulationLength_months)

    #This model will be called VMN8P because implies a one-off input of C
    ModelDFSL_VMN8P <- ModelDFSL1y_VMN8

    #Export the dataframe
    write_xlsx(ModelDFSL_VMN8P,"VXP_Models\\ModelDFSL_R_VMN8P.xlsx")


    #Plot 3: Interactive Yearly CO2 emissions #
    MY <- 12
    ModelDFSL_VMN8P_YCO2 <- ModelDFSL_VMN8P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VMN8)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMN8P_YCO2) <- c("Year", "Months", "AnnualCO2_VMN_8")

    #Plot 3: Interactive Yearly CO2 emissions considering a delay
    GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
    ModelDFSL_VMN8P_YCO2D <- merge(ModelDFSL_VMN8P_YCO2, GWP100delay, by = "Year")
    ModelDFSL_VMN8P_YCO2D$AnnualCO2D_VMN_8 <- ModelDFSL_VMN8P_YCO2D$AnnualCO2_VMN_8 * ModelDFSL_VMN8P_YCO2D$GWP100


    #Plot 4: Interactive Yearly C emissions #
    MY <- 12
    ModelDFSL_VMN8P_YC <- ModelDFSL_VMN8P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VMN8)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMN8P_YC) <- c("Year", "Months", "CEmissions_VMN_8")

    #Plot 5: Interactive Yearly C tails (remaining C in Soil) #
    MY <- 12
    ModelDFSL_VMN8P_YCT <- ModelDFSL_VMN8P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VMN8)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMN8P_YCT) <- c("Year", "Months", "CTail_VMN_8")

    #Save Dataframes for Plots 3.1, 3.2, 4 and 5
    write_xlsx(ModelDFSL_VMN8P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VMN8P.xlsx") #Yearly CO2 emissions (no delay)
    write_xlsx(ModelDFSL_VMN8P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VMN8P.xlsx") #Yearly CO2 emissions (delay)
    write_xlsx(ModelDFSL_VMN8P_YC,"CEmissions_P\\ModelDFSL_R_CE_VMN8P.xlsx") #Yearly C emissions
    write_xlsx(ModelDFSL_VMN8P_YCT,"CTails_P\\ModelDFSL_R_CT_VMN8P.xlsx") #Yearly C emissions



    #### 12.10 - VMN9) Manure; 90%clay; No Tillage ####
    #The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
    fT_VMN9=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
    fW_VMN9=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                            S.Thick = soil.thick, pClay = clay100*0.9,
                            pE = 1.0, bare = FALSE)$b #Moisture effects per month
    xi.frame_VMN9=data.frame(years,rep(fT_VMN9*fW_VMN9,length.out=length(years)))

    #To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
    Model_VMN9=SoilR::RothCModel(
      t=years, #Simulation Length
      ks=c(k.DPM = 10*NTRM, k.RPM = 0.3*NTRM, k.BIO = 0.66*NTRM, k.HUM = 0.02*NTRM, k.IOM = 0*NTRM), #Decomposition rates for the different pools
      C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
      In=Scalar_LitterCinputs*0, #Amount of litter inputs by time
      FYM = Scalar_ManureCinputs*1, #Amount of Farm Yard Manure by time
      clay=clay100*0.9, #Percent clay in mineral soil
      xi=xi.frame_VMN9) #Loads the model

    Ct_VMN9=getC(Model_VMN9) #Calculates stocks for each pool per month

    #The results can be plotted with the commands
    matplot(years, Ct_VMN9, type="l", lty=1, col=1:5,
            xlab="Time (years)", ylab="C stocks (Mg/ha)")
    legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
           lty=1, col=1:5, bty="n")

    VEC_Lit_VMN9 <- rep(M_Scalar_LitterCinputs*0, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
    VEC_Man_VMN9 <- rep(M_Scalar_ManureCinputs*1, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

    VEC_LitDF_VMN9 <- as.data.frame(VEC_Lit_VMN9) #Converting the Litter vector to a data frame
    VEC_LitDF_VMN9$MNumber <- seq(from = 1, to = SimulationLength_months)
    VEC_ManDF_VMN9 <- as.data.frame(VEC_Man_VMN9) #Converting the Manure vector to a data frame
    VEC_ManDF_VMN9$MNumber <- seq(from = 1, to = SimulationLength_months)

    sapply(VEC_LitDF_VMN9, class) #Check that class is numeric
    sapply(VEC_ManDF_VMN9, class) #Check that class is numeric
    LitterCinputs_VMN9=VEC_LitDF_VMN9   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    ManureCinputs_VMN9=VEC_ManDF_VMN9 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    MCinputs_VMN9 <- merge(LitterCinputs_VMN9, ManureCinputs_VMN9, by = "MNumber")
    MCinputs_VMN9$MInput_VMN9 <- MCinputs_VMN9$VEC_Lit_VMN9 + MCinputs_VMN9$VEC_Man_VMN9

    #Change names of litter and manure columns for more common ones
    colnames(MCinputs_VMN9)[which(names(MCinputs_VMN9) == "VEC_Lit_VMN9")] <- "LitterC_VMN9"
    colnames(MCinputs_VMN9)[which(names(MCinputs_VMN9) == "VEC_Man_VMN9")] <- "ManureC_VMN9"

    #Create a dataframe with the data considering the simulation length
    ModelDF_VMN9 <- as.data.frame(Ct_VMN9)
    colnames(ModelDF_VMN9) <- c('DPM_VMN9','RPM_VMN9','BIO_VMN9', 'HUM_VMN9', 'IOM_VMN9')
    ModelDFS_VMN9 <- ModelDF_VMN9[1:SimulationLength_months, ]

    #Create a column with the number of month of analysis
    ModelDFS_VMN9$MNumber <- seq(from = 1, to = SimulationLength_months)

    #Create a column that sums all pools
    ModelDFS_VMN9$AllPools_VMN9 <- ModelDFS_VMN9$DPM_VMN9 + ModelDFS_VMN9$RPM_VMN9 + ModelDFS_VMN9$BIO_VMN9 + ModelDFS_VMN9$HUM_VMN9 + ModelDFS_VMN9$IOM_VMN9

    #Create a column that sums all pools except IOM (static)
    ModelDFS_VMN9$AllPools_noIOM_VMN9 <- ModelDFS_VMN9$DPM_VMN9 + ModelDFS_VMN9$RPM_VMN9 + ModelDFS_VMN9$BIO_VMN9 + ModelDFS_VMN9$HUM_VMN9

    #Create a column that add the monthly input of C (manure and litter separately)
    ModelDFSL_VMN9 <- merge(ModelDFS_VMN9, MCinputs_VMN9, by = "MNumber")

    ModelDFSL_VMN9$MInput_VMN9 <- ModelDFSL_VMN9$LitterC_VMN9 + ModelDFSL_VMN9$ManureC_VMN9
    #ModelDF_SL$MInput[1] <- 0

    #Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
    ModelDFSL_VMN9$CTails_VMN9 <- ModelDFSL_VMN9$AllPools_noIOM_VMN9 + ModelDFSL_VMN9$MInput_VMN9

    #Create Monthly Accumulated input of C
    ModelDFSL_VMN9$AccumInput_VMN9 = ModelDFSL_VMN9$AccumInput_VMN9=cumsum(ModelDFSL_VMN9$MInput_VMN9)

    #Create Monthly Growths for each carbon pool
    ModelDFSL_VMN9$MGrowth_DPM_VMN9 <- ave(ModelDFSL_VMN9$DPM_VMN9, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMN9$MGrowth_RPM_VMN9 <- ave(ModelDFSL_VMN9$RPM_VMN9, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMN9$MGrowth_BIO_VMN9 <- ave(ModelDFSL_VMN9$BIO_VMN9, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMN9$MGrowth_HUM_VMN9 <- ave(ModelDFSL_VMN9$HUM_VMN9, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMN9$MGrowth_IOM_VMN9 <- ave(ModelDFSL_VMN9$IOM_VMN9, FUN = function(x) c(0, diff(x)))

    #Create column for Monthly and Accumulated C-CO2 emissions
    ModelDFSL_VMN9$M_CCO2_VMN9 <- ModelDFSL_VMN9$MInput_VMN9 - ModelDFSL_VMN9$MGrowth_DPM_VMN9 - ModelDFSL_VMN9$MGrowth_RPM_VMN9 - ModelDFSL_VMN9$MGrowth_BIO_VMN9 - ModelDFSL_VMN9$MGrowth_HUM_VMN9
    ModelDFSL_VMN9$Accum_CCO2_VMN9 <- ModelDFSL_VMN9$AccumInput_VMN9 - ModelDFSL_VMN9$AllPools_noIOM_VMN9

    #Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
    ModelDFSL_VMN9$M_CCO2_VMN9[1] <- 0
    ModelDFSL_VMN9$Accum_CCO2_VMN9[1] <- 0

    #Balance validation
    ModelDFSL_VMN9$Balance_VMN9 <- ModelDFSL_VMN9$AccumInput_VMN9 - ModelDFSL_VMN9$Accum_CCO2_VMN9 - (ModelDFSL_VMN9$DPM_VMN9 + ModelDFSL_VMN9$RPM_VMN9 + ModelDFSL_VMN9$BIO_VMN9 + ModelDFSL_VMN9$HUM_VMN9)

    #Convert C-CO2 emissions into CO2 emissions
    ModelDFSL_VMN9$M_CO2_VMN9 <- ModelDFSL_VMN9$M_CCO2_VMN9 * 44/12
    ModelDFSL_VMN9$Accum_CO2_VMN9 <- ModelDFSL_VMN9$Accum_CCO2_VMN9 * 44/12

    #This model will be called VMN9C because implies a continuous input of C
    ModelDFSL_VMN9C <- ModelDFSL_VMN9

    #Export the dataframe
    write_xlsx(ModelDFSL_VMN9C,"VXC_Models\\ModelDFSL_R_VMN9C.xlsx")

    #Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
    #Create two equal models by using the above general script
    #Create model t=x
    ModelDFSLt0_VMN9 <- ModelDFSL_VMN9 #Create model t=x

    #Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
    ModelDFSLt1_VMN9.1 <- rbind(c(0:0), ModelDFSLt0_VMN9)
    ModelDFSLt1_VMN9.2 <- rbind(c(0:0), ModelDFSLt1_VMN9.1)
    ModelDFSLt1_VMN9.3 <- rbind(c(0:0), ModelDFSLt1_VMN9.2)
    ModelDFSLt1_VMN9.4 <- rbind(c(0:0), ModelDFSLt1_VMN9.3)
    ModelDFSLt1_VMN9.5 <- rbind(c(0:0), ModelDFSLt1_VMN9.4)
    ModelDFSLt1_VMN9.6 <- rbind(c(0:0), ModelDFSLt1_VMN9.5)
    ModelDFSLt1_VMN9.7 <- rbind(c(0:0), ModelDFSLt1_VMN9.6)
    ModelDFSLt1_VMN9.8 <- rbind(c(0:0), ModelDFSLt1_VMN9.7)
    ModelDFSLt1_VMN9.9 <- rbind(c(0:0), ModelDFSLt1_VMN9.8)
    ModelDFSLt1_VMN9.10 <- rbind(c(0:0), ModelDFSLt1_VMN9.9)
    ModelDFSLt1_VMN9.11 <- rbind(c(0:0), ModelDFSLt1_VMN9.10)
    ModelDFSLt1_VMN9.12 <- rbind(c(0:0), ModelDFSLt1_VMN9.11)
    ModelDFSLt1_VMN9.13 <- ModelDFSLt1_VMN9.12[-nrow(ModelDFSLt1_VMN9.12),]
    ModelDFSLt1_VMN9.14 <- ModelDFSLt1_VMN9.13[-nrow(ModelDFSLt1_VMN9.13),]
    ModelDFSLt1_VMN9.15 <- ModelDFSLt1_VMN9.14[-nrow(ModelDFSLt1_VMN9.14),]
    ModelDFSLt1_VMN9.16 <- ModelDFSLt1_VMN9.15[-nrow(ModelDFSLt1_VMN9.15),]
    ModelDFSLt1_VMN9.17 <- ModelDFSLt1_VMN9.16[-nrow(ModelDFSLt1_VMN9.16),]
    ModelDFSLt1_VMN9.18 <- ModelDFSLt1_VMN9.17[-nrow(ModelDFSLt1_VMN9.17),]
    ModelDFSLt1_VMN9.19 <- ModelDFSLt1_VMN9.18[-nrow(ModelDFSLt1_VMN9.18),]
    ModelDFSLt1_VMN9.20 <- ModelDFSLt1_VMN9.19[-nrow(ModelDFSLt1_VMN9.19),]
    ModelDFSLt1_VMN9.21 <- ModelDFSLt1_VMN9.20[-nrow(ModelDFSLt1_VMN9.20),]
    ModelDFSLt1_VMN9.22 <- ModelDFSLt1_VMN9.21[-nrow(ModelDFSLt1_VMN9.21),]
    ModelDFSLt1_VMN9.23 <- ModelDFSLt1_VMN9.22[-nrow(ModelDFSLt1_VMN9.22),]
    ModelDFSLt1_VMN9.24 <- ModelDFSLt1_VMN9.23[-nrow(ModelDFSLt1_VMN9.23),]

    ModelDFSLt1_VMN9 <- ModelDFSLt1_VMN9.24 #Create model t=x+1

    #Subtract model (t=x) - (t=x+1)
    ModelDFSL1y_VMN9 <- ModelDFSLt0_VMN9 - ModelDFSLt1_VMN9

    #Re-do Month Number column because the substraction was also applied to it
    ModelDFSL1y_VMN9$MNumber <- seq(from = 1, to = SimulationLength_months)

    #This model will be called VMN9P because implies a one-off input of C
    ModelDFSL_VMN9P <- ModelDFSL1y_VMN9

    #Export the dataframe
    write_xlsx(ModelDFSL_VMN9P,"VXP_Models\\ModelDFSL_R_VMN9P.xlsx")


    #Plot 3: Interactive Yearly CO2 emissions #
    MY <- 12
    ModelDFSL_VMN9P_YCO2 <- ModelDFSL_VMN9P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VMN9)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMN9P_YCO2) <- c("Year", "Months", "AnnualCO2_VMN_9")

    #Plot 3: Interactive Yearly CO2 emissions considering a delay
    GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
    ModelDFSL_VMN9P_YCO2D <- merge(ModelDFSL_VMN9P_YCO2, GWP100delay, by = "Year")
    ModelDFSL_VMN9P_YCO2D$AnnualCO2D_VMN_9 <- ModelDFSL_VMN9P_YCO2D$AnnualCO2_VMN_9 * ModelDFSL_VMN9P_YCO2D$GWP100


    #Plot 4: Interactive Yearly C emissions #
    MY <- 12
    ModelDFSL_VMN9P_YC <- ModelDFSL_VMN9P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VMN9)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMN9P_YC) <- c("Year", "Months", "CEmissions_VMN_9")

    #Plot 5: Interactive Yearly C tails (remaining C in Soil) #
    MY <- 12
    ModelDFSL_VMN9P_YCT <- ModelDFSL_VMN9P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VMN9)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMN9P_YCT) <- c("Year", "Months", "CTail_VMN_9")

    #Save Dataframes for Plots 3.1, 3.2, 4 and 5
    write_xlsx(ModelDFSL_VMN9P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VMN9P.xlsx") #Yearly CO2 emissions (no delay)
    write_xlsx(ModelDFSL_VMN9P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VMN9P.xlsx") #Yearly CO2 emissions (delay)
    write_xlsx(ModelDFSL_VMN9P_YC,"CEmissions_P\\ModelDFSL_R_CE_VMN9P.xlsx") #Yearly C emissions
    write_xlsx(ModelDFSL_VMN9P_YCT,"CTails_P\\ModelDFSL_R_CT_VMN9P.xlsx") #Yearly C emissions



    #### 12.11 - VMN10) Manure; 100%clay; No Tillage ####
    #The effects of climate on decomposition can be calculated now with the functions SoilR::fT.RothC and SoilR::fW.RothC as
    fT_VMN10=SoilR::fT.RothC(Temp[,2]) #Temperature effects per month
    fW_VMN10=SoilR::fW.RothC(P=(Precip[,2]), E=(Evp[,2]),
                             S.Thick = soil.thick, pClay = clay100,
                             pE = 1.0, bare = FALSE)$b #Moisture effects per month
    xi.frame_VMN10=data.frame(years,rep(fT_VMN10*fW_VMN10,length.out=length(years)))

    #To run the model, we use the function SoilR::RothCModel to initialize the model and create a SoilR Model object to which we will solve to calculate C stocks for each pool as
    Model_VMN10=SoilR::RothCModel(
      t=years, #Simulation Length
      ks=c(k.DPM = 10*NTRM, k.RPM = 0.3*NTRM, k.BIO = 0.66*NTRM, k.HUM = 0.02*NTRM, k.IOM = 0*NTRM), #Decomposition rates for the different pools
      C0=c(DPM=0, RPM=0, BIO=0, HUM=0, IOM=0), #Initial amount of carbon for the 5 pools
      In=Scalar_LitterCinputs*0, #Amount of litter inputs by time
      FYM = Scalar_ManureCinputs*1, #Amount of Farm Yard Manure by time
      clay=clay100, #Percent clay in mineral soil
      xi=xi.frame_VMN10) #Loads the model

    Ct_VMN10=getC(Model_VMN10) #Calculates stocks for each pool per month

    #The results can be plotted with the commands
    matplot(years, Ct_VMN10, type="l", lty=1, col=1:5,
            xlab="Time (years)", ylab="C stocks (Mg/ha)")
    legend("topleft", c("DPM", "RPM", "BIO", "HUM", "IOM"),
           lty=1, col=1:5, bty="n")

    VEC_Lit_VMN10 <- rep(M_Scalar_LitterCinputs*0, SimulationLength_months) #Creating a vector for Litter Inputs of Length equal of Simulation Length (in months)
    VEC_Man_VMN10 <- rep(M_Scalar_ManureCinputs*1, SimulationLength_months) #Creating a vector for Manure Inputs of Length equal of Simulation Length (in months)

    VEC_LitDF_VMN10 <- as.data.frame(VEC_Lit_VMN10) #Converting the Litter vector to a data frame
    VEC_LitDF_VMN10$MNumber <- seq(from = 1, to = SimulationLength_months)
    VEC_ManDF_VMN10 <- as.data.frame(VEC_Man_VMN10) #Converting the Manure vector to a data frame
    VEC_ManDF_VMN10$MNumber <- seq(from = 1, to = SimulationLength_months)

    sapply(VEC_LitDF_VMN10, class) #Check that class is numeric
    sapply(VEC_ManDF_VMN10, class) #Check that class is numeric
    LitterCinputs_VMN10=VEC_LitDF_VMN10   #Litter MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    ManureCinputs_VMN10=VEC_ManDF_VMN10 #Manure MONTHLY C inputs to soil in Mg/ha/yr - please note that Mg is megagrams, not milligrams
    MCinputs_VMN10 <- merge(LitterCinputs_VMN10, ManureCinputs_VMN10, by = "MNumber")
    MCinputs_VMN10$MInput_VMN10 <- MCinputs_VMN10$VEC_Lit_VMN10 + MCinputs_VMN10$VEC_Man_VMN10

    #Change names of litter and manure columns for more common ones
    colnames(MCinputs_VMN10)[which(names(MCinputs_VMN10) == "VEC_Lit_VMN10")] <- "LitterC_VMN10"
    colnames(MCinputs_VMN10)[which(names(MCinputs_VMN10) == "VEC_Man_VMN10")] <- "ManureC_VMN10"

    #Create a dataframe with the data considering the simulation length
    ModelDF_VMN10 <- as.data.frame(Ct_VMN10)
    colnames(ModelDF_VMN10) <- c('DPM_VMN10','RPM_VMN10','BIO_VMN10', 'HUM_VMN10', 'IOM_VMN10')
    ModelDFS_VMN10 <- ModelDF_VMN10[1:SimulationLength_months, ]

    #Create a column with the number of month of analysis
    ModelDFS_VMN10$MNumber <- seq(from = 1, to = SimulationLength_months)

    #Create a column that sums all pools
    ModelDFS_VMN10$AllPools_VMN10 <- ModelDFS_VMN10$DPM_VMN10 + ModelDFS_VMN10$RPM_VMN10 + ModelDFS_VMN10$BIO_VMN10 + ModelDFS_VMN10$HUM_VMN10 + ModelDFS_VMN10$IOM_VMN10

    #Create a column that sums all pools except IOM (static)
    ModelDFS_VMN10$AllPools_noIOM_VMN10 <- ModelDFS_VMN10$DPM_VMN10 + ModelDFS_VMN10$RPM_VMN10 + ModelDFS_VMN10$BIO_VMN10 + ModelDFS_VMN10$HUM_VMN10

    #Create a column that add the monthly input of C (manure and litter separately)
    ModelDFSL_VMN10 <- merge(ModelDFS_VMN10, MCinputs_VMN10, by = "MNumber")

    ModelDFSL_VMN10$MInput_VMN10 <- ModelDFSL_VMN10$LitterC_VMN10 + ModelDFSL_VMN10$ManureC_VMN10
    #ModelDF_SL$MInput[1] <- 0

    #Create a column that add the monthly C tail (carbon in pools (no IOM) + Monthly input of C)
    ModelDFSL_VMN10$CTails_VMN10 <- ModelDFSL_VMN10$AllPools_noIOM_VMN10 + ModelDFSL_VMN10$MInput_VMN10

    #Create Monthly Accumulated input of C
    ModelDFSL_VMN10$AccumInput_VMN10 = ModelDFSL_VMN10$AccumInput_VMN10=cumsum(ModelDFSL_VMN10$MInput_VMN10)

    #Create Monthly Growths for each carbon pool
    ModelDFSL_VMN10$MGrowth_DPM_VMN10 <- ave(ModelDFSL_VMN10$DPM_VMN10, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMN10$MGrowth_RPM_VMN10 <- ave(ModelDFSL_VMN10$RPM_VMN10, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMN10$MGrowth_BIO_VMN10 <- ave(ModelDFSL_VMN10$BIO_VMN10, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMN10$MGrowth_HUM_VMN10 <- ave(ModelDFSL_VMN10$HUM_VMN10, FUN = function(x) c(0, diff(x)))
    ModelDFSL_VMN10$MGrowth_IOM_VMN10 <- ave(ModelDFSL_VMN10$IOM_VMN10, FUN = function(x) c(0, diff(x)))

    #Create column for Monthly and Accumulated C-CO2 emissions
    ModelDFSL_VMN10$M_CCO2_VMN10 <- ModelDFSL_VMN10$MInput_VMN10 - ModelDFSL_VMN10$MGrowth_DPM_VMN10 - ModelDFSL_VMN10$MGrowth_RPM_VMN10 - ModelDFSL_VMN10$MGrowth_BIO_VMN10 - ModelDFSL_VMN10$MGrowth_HUM_VMN10
    ModelDFSL_VMN10$Accum_CCO2_VMN10 <- ModelDFSL_VMN10$AccumInput_VMN10 - ModelDFSL_VMN10$AllPools_noIOM_VMN10

    #Set M_CCO2 and Accum_CCO2 first row value to 0 since otherwise it's an error since these parameters are calculated through balance
    ModelDFSL_VMN10$M_CCO2_VMN10[1] <- 0
    ModelDFSL_VMN10$Accum_CCO2_VMN10[1] <- 0

    #Balance validation
    ModelDFSL_VMN10$Balance_VMN10 <- ModelDFSL_VMN10$AccumInput_VMN10 - ModelDFSL_VMN10$Accum_CCO2_VMN10 - (ModelDFSL_VMN10$DPM_VMN10 + ModelDFSL_VMN10$RPM_VMN10 + ModelDFSL_VMN10$BIO_VMN10 + ModelDFSL_VMN10$HUM_VMN10)

    #Convert C-CO2 emissions into CO2 emissions
    ModelDFSL_VMN10$M_CO2_VMN10 <- ModelDFSL_VMN10$M_CCO2_VMN10 * 44/12
    ModelDFSL_VMN10$Accum_CO2_VMN10 <- ModelDFSL_VMN10$Accum_CCO2_VMN10 * 44/12

    #This model will be called VMN10C because implies a continuous input of C
    ModelDFSL_VMN10C <- ModelDFSL_VMN10

    #Export the dataframe
    write_xlsx(ModelDFSL_VMN10C,"VXC_Models\\ModelDFSL_R_VMN10C.xlsx")

    #Subtracting two models (t=x)-(t=x+1) to obtain the effect of a single year
    #Create two equal models by using the above general script
    #Create model t=x
    ModelDFSLt0_VMN10 <- ModelDFSL_VMN10 #Create model t=x

    #Create model t=x+1 by adding 12 rows full of zeros at the beginning and deleting the last 12 rows
    ModelDFSLt1_VMN10.1 <- rbind(c(0:0), ModelDFSLt0_VMN10)
    ModelDFSLt1_VMN10.2 <- rbind(c(0:0), ModelDFSLt1_VMN10.1)
    ModelDFSLt1_VMN10.3 <- rbind(c(0:0), ModelDFSLt1_VMN10.2)
    ModelDFSLt1_VMN10.4 <- rbind(c(0:0), ModelDFSLt1_VMN10.3)
    ModelDFSLt1_VMN10.5 <- rbind(c(0:0), ModelDFSLt1_VMN10.4)
    ModelDFSLt1_VMN10.6 <- rbind(c(0:0), ModelDFSLt1_VMN10.5)
    ModelDFSLt1_VMN10.7 <- rbind(c(0:0), ModelDFSLt1_VMN10.6)
    ModelDFSLt1_VMN10.8 <- rbind(c(0:0), ModelDFSLt1_VMN10.7)
    ModelDFSLt1_VMN10.9 <- rbind(c(0:0), ModelDFSLt1_VMN10.8)
    ModelDFSLt1_VMN10.10 <- rbind(c(0:0), ModelDFSLt1_VMN10.9)
    ModelDFSLt1_VMN10.11 <- rbind(c(0:0), ModelDFSLt1_VMN10.10)
    ModelDFSLt1_VMN10.12 <- rbind(c(0:0), ModelDFSLt1_VMN10.11)
    ModelDFSLt1_VMN10.13 <- ModelDFSLt1_VMN10.12[-nrow(ModelDFSLt1_VMN10.12),]
    ModelDFSLt1_VMN10.14 <- ModelDFSLt1_VMN10.13[-nrow(ModelDFSLt1_VMN10.13),]
    ModelDFSLt1_VMN10.15 <- ModelDFSLt1_VMN10.14[-nrow(ModelDFSLt1_VMN10.14),]
    ModelDFSLt1_VMN10.16 <- ModelDFSLt1_VMN10.15[-nrow(ModelDFSLt1_VMN10.15),]
    ModelDFSLt1_VMN10.17 <- ModelDFSLt1_VMN10.16[-nrow(ModelDFSLt1_VMN10.16),]
    ModelDFSLt1_VMN10.18 <- ModelDFSLt1_VMN10.17[-nrow(ModelDFSLt1_VMN10.17),]
    ModelDFSLt1_VMN10.19 <- ModelDFSLt1_VMN10.18[-nrow(ModelDFSLt1_VMN10.18),]
    ModelDFSLt1_VMN10.20 <- ModelDFSLt1_VMN10.19[-nrow(ModelDFSLt1_VMN10.19),]
    ModelDFSLt1_VMN10.21 <- ModelDFSLt1_VMN10.20[-nrow(ModelDFSLt1_VMN10.20),]
    ModelDFSLt1_VMN10.22 <- ModelDFSLt1_VMN10.21[-nrow(ModelDFSLt1_VMN10.21),]
    ModelDFSLt1_VMN10.23 <- ModelDFSLt1_VMN10.22[-nrow(ModelDFSLt1_VMN10.22),]
    ModelDFSLt1_VMN10.24 <- ModelDFSLt1_VMN10.23[-nrow(ModelDFSLt1_VMN10.23),]

    ModelDFSLt1_VMN10 <- ModelDFSLt1_VMN10.24 #Create model t=x+1

    #Subtract model (t=x) - (t=x+1)
    ModelDFSL1y_VMN10 <- ModelDFSLt0_VMN10 - ModelDFSLt1_VMN10

    #Re-do Month Number column because the substraction was also applied to it
    ModelDFSL1y_VMN10$MNumber <- seq(from = 1, to = SimulationLength_months)

    #This model will be called VMN10P because implies a one-off input of C
    ModelDFSL_VMN10P <- ModelDFSL1y_VMN10

    #Export the dataframe
    write_xlsx(ModelDFSL_VMN10P,"VXP_Models\\ModelDFSL_R_VMN10P.xlsx")


    #Plot 3: Interactive Yearly CO2 emissions #
    MY <- 12
    ModelDFSL_VMN10P_YCO2 <- ModelDFSL_VMN10P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CO2_VMN10)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMN10P_YCO2) <- c("Year", "Months", "AnnualCO2_VMN10")

    #Plot 3: Interactive Yearly CO2 emissions considering a delay
    GWP100delay <- data.frame(   Year = 1:100,   GWP100 = c(     0.9923, 0.9846, 0.9768, 0.9690, 0.9612,     0.9534, 0.9456, 0.9378, 0.9299, 0.9220,     0.9141, 0.9062, 0.8982, 0.8902, 0.8822,     0.8742, 0.8662, 0.8581, 0.8500, 0.8419,     0.8338, 0.8256, 0.8174, 0.8092, 0.8010,     0.7927, 0.7844, 0.7761, 0.7677, 0.7594,     0.7509, 0.7425, 0.7340, 0.7255, 0.7170,     0.7084, 0.6998, 0.6912, 0.6825, 0.6738,     0.6650, 0.6562, 0.6474, 0.6385, 0.6296,     0.6207, 0.6117, 0.6027, 0.5936, 0.5845,     0.5753, 0.5661, 0.5568, 0.5475, 0.5381,     0.5287, 0.5193, 0.5097, 0.5002, 0.4905,     0.4808, 0.4711, 0.4613, 0.4514, 0.4415,     0.4315, 0.4214, 0.4113, 0.4011, 0.3908,     0.3804, 0.3700, 0.3595, 0.3489, 0.3382,     0.3275, 0.3166, 0.3057, 0.2947, 0.2835,     0.2723, 0.2609, 0.2495, 0.2379, 0.2262,     0.2143, 0.2023, 0.1902, 0.1778, 0.1653,     0.1525, 0.1395, 0.1262, 0.1125, 0.0985,     0.0839, 0.0688, 0.0531, 0.0365, 0.0188   ) )
    ModelDFSL_VMN10P_YCO2D <- merge(ModelDFSL_VMN10P_YCO2, GWP100delay, by = "Year")
    ModelDFSL_VMN10P_YCO2D$AnnualCO2D_VMN10 <- ModelDFSL_VMN10P_YCO2D$AnnualCO2_VMN10 * ModelDFSL_VMN10P_YCO2D$GWP100

    #Plot 4: Interactive Yearly C emissions #
    MY <- 12
    ModelDFSL_VMN10P_YC <- ModelDFSL_VMN10P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), sum = sum(M_CCO2_VMN10)) #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMN10P_YC) <- c("Year", "Months", "CEmissions_VMN10")

    #Plot 5: Interactive Yearly C tails (remaining C in Soil) #
    MY <- 12
    ModelDFSL_VMN10P_YCT <- ModelDFSL_VMN10P %>%
      group_by(grp = as.integer(gl(n(), MY, n()))) %>%
      summarise(range = str_c(first(MNumber), last(MNumber), sep=" -- "), last = last(AllPools_noIOM_VMN10)) #Here is last because AllPools_nIOM is the size of the C pools #https://stackoverflow.com/questions/59505473/sum-every-3-rows
    colnames(ModelDFSL_VMN10P_YCT) <- c("Year", "Months", "CTail_VMN10")

    #Save Dataframes for Plots 3.1, 3.2, 4 and 5
    write_xlsx(ModelDFSL_VMN10P_YCO2,"CO2Emissions_P_NoDelay\\ModelDFSL_R_CO2_VMN10P.xlsx") #Yearly CO2 emissions (no delay)
    write_xlsx(ModelDFSL_VMN10P_YCO2D,"CO2Emissions_P_Delay\\ModelDFSL_R_CO2D_VMN10P.xlsx") #Yearly CO2 emissions (delay)
    write_xlsx(ModelDFSL_VMN10P_YC,"CEmissions_P\\ModelDFSL_R_CE_VMN10P.xlsx") #Yearly C emissions
    write_xlsx(ModelDFSL_VMN10P_YCT,"CTails_P\\ModelDFSL_R_CT_VMN10P.xlsx") #Yearly C emissions

  }
}
